(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var wE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function xl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function SE(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var iv={exports:{}},Yc={},sv={exports:{}},Fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wl=Symbol.for("react.element"),Yx=Symbol.for("react.portal"),Xx=Symbol.for("react.fragment"),Kx=Symbol.for("react.strict_mode"),Qx=Symbol.for("react.profiler"),Zx=Symbol.for("react.provider"),qx=Symbol.for("react.context"),Jx=Symbol.for("react.forward_ref"),e6=Symbol.for("react.suspense"),t6=Symbol.for("react.memo"),n6=Symbol.for("react.lazy"),E1=Symbol.iterator;function r6(t){return t===null||typeof t!="object"?null:(t=E1&&t[E1]||t["@@iterator"],typeof t=="function"?t:null)}var ov={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},av=Object.assign,lv={};function Oo(t,e,n){this.props=t,this.context=e,this.refs=lv,this.updater=n||ov}Oo.prototype.isReactComponent={};Oo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Oo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function uv(){}uv.prototype=Oo.prototype;function Tp(t,e,n){this.props=t,this.context=e,this.refs=lv,this.updater=n||ov}var Ep=Tp.prototype=new uv;Ep.constructor=Tp;av(Ep,Oo.prototype);Ep.isPureReactComponent=!0;var N1=Array.isArray,cv=Object.prototype.hasOwnProperty,Np={current:null},dv={key:!0,ref:!0,__self:!0,__source:!0};function fv(t,e,n){var r,i={},s=null,l=null;if(e!=null)for(r in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(s=""+e.key),e)cv.call(e,r)&&!dv.hasOwnProperty(r)&&(i[r]=e[r]);var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){for(var u=Array(c),f=0;f<c;f++)u[f]=arguments[f+2];i.children=u}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)i[r]===void 0&&(i[r]=c[r]);return{$$typeof:wl,type:t,key:s,ref:l,props:i,_owner:Np.current}}function i6(t,e){return{$$typeof:wl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Pp(t){return typeof t=="object"&&t!==null&&t.$$typeof===wl}function s6(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var P1=/\/+/g;function mh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?s6(""+t.key):e.toString(36)}function Xu(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case wl:case Yx:l=!0}}if(l)return l=t,i=i(l),t=r===""?"."+mh(l,0):r,N1(i)?(n="",t!=null&&(n=t.replace(P1,"$&/")+"/"),Xu(i,e,n,"",function(f){return f})):i!=null&&(Pp(i)&&(i=i6(i,n+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(P1,"$&/")+"/")+t)),e.push(i)),1;if(l=0,r=r===""?".":r+":",N1(t))for(var c=0;c<t.length;c++){s=t[c];var u=r+mh(s,c);l+=Xu(s,e,n,u,i)}else if(u=r6(t),typeof u=="function")for(t=u.call(t),c=0;!(s=t.next()).done;)s=s.value,u=r+mh(s,c++),l+=Xu(s,e,n,u,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function bu(t,e,n){if(t==null)return t;var r=[],i=0;return Xu(t,r,"","",function(s){return e.call(n,s,i++)}),r}function o6(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var un={current:null},Ku={transition:null},a6={ReactCurrentDispatcher:un,ReactCurrentBatchConfig:Ku,ReactCurrentOwner:Np};function hv(){throw Error("act(...) is not supported in production builds of React.")}Fe.Children={map:bu,forEach:function(t,e,n){bu(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return bu(t,function(){e++}),e},toArray:function(t){return bu(t,function(e){return e})||[]},only:function(t){if(!Pp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Fe.Component=Oo;Fe.Fragment=Xx;Fe.Profiler=Qx;Fe.PureComponent=Tp;Fe.StrictMode=Kx;Fe.Suspense=e6;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=a6;Fe.act=hv;Fe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=av({},t.props),i=t.key,s=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,l=Np.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(u in e)cv.call(e,u)&&!dv.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&c!==void 0?c[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var f=0;f<u;f++)c[f]=arguments[f+2];r.children=c}return{$$typeof:wl,type:t.type,key:i,ref:s,props:r,_owner:l}};Fe.createContext=function(t){return t={$$typeof:qx,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Zx,_context:t},t.Consumer=t};Fe.createElement=fv;Fe.createFactory=function(t){var e=fv.bind(null,t);return e.type=t,e};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(t){return{$$typeof:Jx,render:t}};Fe.isValidElement=Pp;Fe.lazy=function(t){return{$$typeof:n6,_payload:{_status:-1,_result:t},_init:o6}};Fe.memo=function(t,e){return{$$typeof:t6,type:t,compare:e===void 0?null:e}};Fe.startTransition=function(t){var e=Ku.transition;Ku.transition={};try{t()}finally{Ku.transition=e}};Fe.unstable_act=hv;Fe.useCallback=function(t,e){return un.current.useCallback(t,e)};Fe.useContext=function(t){return un.current.useContext(t)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(t){return un.current.useDeferredValue(t)};Fe.useEffect=function(t,e){return un.current.useEffect(t,e)};Fe.useId=function(){return un.current.useId()};Fe.useImperativeHandle=function(t,e,n){return un.current.useImperativeHandle(t,e,n)};Fe.useInsertionEffect=function(t,e){return un.current.useInsertionEffect(t,e)};Fe.useLayoutEffect=function(t,e){return un.current.useLayoutEffect(t,e)};Fe.useMemo=function(t,e){return un.current.useMemo(t,e)};Fe.useReducer=function(t,e,n){return un.current.useReducer(t,e,n)};Fe.useRef=function(t){return un.current.useRef(t)};Fe.useState=function(t){return un.current.useState(t)};Fe.useSyncExternalStore=function(t,e,n){return un.current.useSyncExternalStore(t,e,n)};Fe.useTransition=function(){return un.current.useTransition()};Fe.version="18.3.1";sv.exports=Fe;var O=sv.exports;const tn=xl(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l6=O,u6=Symbol.for("react.element"),c6=Symbol.for("react.fragment"),d6=Object.prototype.hasOwnProperty,f6=l6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h6={key:!0,ref:!0,__self:!0,__source:!0};function pv(t,e,n){var r,i={},s=null,l=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)d6.call(e,r)&&!h6.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:u6,type:t,key:s,ref:l,props:i,_owner:f6.current}}Yc.Fragment=c6;Yc.jsx=pv;Yc.jsxs=pv;iv.exports=Yc;var E=iv.exports,g0={},gv={exports:{}},Ln={},mv={exports:{}},yv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,Y){var X=F.length;F.push(Y);e:for(;0<X;){var te=X-1>>>1,K=F[te];if(0<i(K,Y))F[te]=Y,F[X]=K,X=te;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var Y=F[0],X=F.pop();if(X!==Y){F[0]=X;e:for(var te=0,K=F.length,ee=K>>>1;te<ee;){var ne=2*(te+1)-1,ce=F[ne],de=ne+1,B=F[de];if(0>i(ce,X))de<K&&0>i(B,ce)?(F[te]=B,F[de]=X,te=de):(F[te]=ce,F[ne]=X,te=ne);else if(de<K&&0>i(B,X))F[te]=B,F[de]=X,te=de;else break e}}return Y}function i(F,Y){var X=F.sortIndex-Y.sortIndex;return X!==0?X:F.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var u=[],f=[],p=1,m=null,w=3,y=!1,x=!1,b=!1,_=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function h(F){for(var Y=n(f);Y!==null;){if(Y.callback===null)r(f);else if(Y.startTime<=F)r(f),Y.sortIndex=Y.expirationTime,e(u,Y);else break;Y=n(f)}}function k(F){if(b=!1,h(F),!x)if(n(u)!==null)x=!0,U(C);else{var Y=n(f);Y!==null&&G(k,Y.startTime-F)}}function C(F,Y){x=!1,b&&(b=!1,S(M),M=-1),y=!0;var X=w;try{for(h(Y),m=n(u);m!==null&&(!(m.expirationTime>Y)||F&&!j());){var te=m.callback;if(typeof te=="function"){m.callback=null,w=m.priorityLevel;var K=te(m.expirationTime<=Y);Y=t.unstable_now(),typeof K=="function"?m.callback=K:m===n(u)&&r(u),h(Y)}else r(u);m=n(u)}if(m!==null)var ee=!0;else{var ne=n(f);ne!==null&&G(k,ne.startTime-Y),ee=!1}return ee}finally{m=null,w=X,y=!1}}var N=!1,A=null,M=-1,R=5,I=-1;function j(){return!(t.unstable_now()-I<R)}function z(){if(A!==null){var F=t.unstable_now();I=F;var Y=!0;try{Y=A(!0,F)}finally{Y?W():(N=!1,A=null)}}else N=!1}var W;if(typeof T=="function")W=function(){T(z)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,D=V.port2;V.port1.onmessage=z,W=function(){D.postMessage(null)}}else W=function(){_(z,0)};function U(F){A=F,N||(N=!0,W())}function G(F,Y){M=_(function(){F(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){x||y||(x=!0,U(C))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return w},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(F){switch(w){case 1:case 2:case 3:var Y=3;break;default:Y=w}var X=w;w=Y;try{return F()}finally{w=X}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,Y){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var X=w;w=F;try{return Y()}finally{w=X}},t.unstable_scheduleCallback=function(F,Y,X){var te=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?te+X:te):X=te,F){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=X+K,F={id:p++,callback:Y,priorityLevel:F,startTime:X,expirationTime:K,sortIndex:-1},X>te?(F.sortIndex=X,e(f,F),n(u)===null&&F===n(f)&&(b?(S(M),M=-1):b=!0,G(k,X-te))):(F.sortIndex=K,e(u,F),x||y||(x=!0,U(C))),F},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(F){var Y=w;return function(){var X=w;w=Y;try{return F.apply(this,arguments)}finally{w=X}}}})(yv);mv.exports=yv;var Oa=mv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p6=O,Rn=Oa;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vv=new Set,Za={};function Ps(t,e){To(t,e),To(t+"Capture",e)}function To(t,e){for(Za[t]=e,t=0;t<e.length;t++)vv.add(e[t])}var ii=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),m0=Object.prototype.hasOwnProperty,g6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,M1={},A1={};function m6(t){return m0.call(A1,t)?!0:m0.call(M1,t)?!1:g6.test(t)?A1[t]=!0:(M1[t]=!0,!1)}function y6(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function v6(t,e,n,r){if(e===null||typeof e>"u"||y6(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function cn(t,e,n,r,i,s,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=l}var Ht={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ht[t]=new cn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ht[e]=new cn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ht[t]=new cn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ht[t]=new cn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ht[t]=new cn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ht[t]=new cn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ht[t]=new cn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ht[t]=new cn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ht[t]=new cn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Mp=/[\-:]([a-z])/g;function Ap(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Mp,Ap);Ht[e]=new cn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Mp,Ap);Ht[e]=new cn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Mp,Ap);Ht[e]=new cn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ht[t]=new cn(t,1,!1,t.toLowerCase(),null,!1,!1)});Ht.xlinkHref=new cn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ht[t]=new cn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ip(t,e,n,r){var i=Ht.hasOwnProperty(e)?Ht[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(v6(e,n,i,r)&&(n=null),r||i===null?m6(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var li=p6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Cu=Symbol.for("react.element"),so=Symbol.for("react.portal"),oo=Symbol.for("react.fragment"),Rp=Symbol.for("react.strict_mode"),y0=Symbol.for("react.profiler"),xv=Symbol.for("react.provider"),wv=Symbol.for("react.context"),Lp=Symbol.for("react.forward_ref"),v0=Symbol.for("react.suspense"),x0=Symbol.for("react.suspense_list"),jp=Symbol.for("react.memo"),Pi=Symbol.for("react.lazy"),Sv=Symbol.for("react.offscreen"),I1=Symbol.iterator;function ma(t){return t===null||typeof t!="object"?null:(t=I1&&t[I1]||t["@@iterator"],typeof t=="function"?t:null)}var ht=Object.assign,yh;function Ia(t){if(yh===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);yh=e&&e[1]||""}return`
`+yh+t}var vh=!1;function xh(t,e){if(!t||vh)return"";vh=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(f){var r=f}Reflect.construct(t,[],e)}else{try{e.call()}catch(f){r=f}t.call(e.prototype)}else{try{throw Error()}catch(f){r=f}t()}}catch(f){if(f&&r&&typeof f.stack=="string"){for(var i=f.stack.split(`
`),s=r.stack.split(`
`),l=i.length-1,c=s.length-1;1<=l&&0<=c&&i[l]!==s[c];)c--;for(;1<=l&&0<=c;l--,c--)if(i[l]!==s[c]){if(l!==1||c!==1)do if(l--,c--,0>c||i[l]!==s[c]){var u=`
`+i[l].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=l&&0<=c);break}}}finally{vh=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ia(t):""}function x6(t){switch(t.tag){case 5:return Ia(t.type);case 16:return Ia("Lazy");case 13:return Ia("Suspense");case 19:return Ia("SuspenseList");case 0:case 2:case 15:return t=xh(t.type,!1),t;case 11:return t=xh(t.type.render,!1),t;case 1:return t=xh(t.type,!0),t;default:return""}}function w0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case oo:return"Fragment";case so:return"Portal";case y0:return"Profiler";case Rp:return"StrictMode";case v0:return"Suspense";case x0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case wv:return(t.displayName||"Context")+".Consumer";case xv:return(t._context.displayName||"Context")+".Provider";case Lp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case jp:return e=t.displayName||null,e!==null?e:w0(t.type)||"Memo";case Pi:e=t._payload,t=t._init;try{return w0(t(e))}catch{}}return null}function w6(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return w0(e);case 8:return e===Rp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function $i(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _v(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function S6(t){var e=_v(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(l){r=""+l,s.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Tu(t){t._valueTracker||(t._valueTracker=S6(t))}function kv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=_v(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function fc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function S0(t,e){var n=e.checked;return ht({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function R1(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=$i(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bv(t,e){e=e.checked,e!=null&&Ip(t,"checked",e,!1)}function _0(t,e){bv(t,e);var n=$i(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?k0(t,e.type,n):e.hasOwnProperty("defaultValue")&&k0(t,e.type,$i(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function L1(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function k0(t,e,n){(e!=="number"||fc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ra=Array.isArray;function xo(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+$i(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function b0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return ht({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function j1(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ae(92));if(Ra(n)){if(1<n.length)throw Error(ae(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:$i(n)}}function Cv(t,e){var n=$i(e.value),r=$i(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function F1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Tv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function C0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Tv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Eu,Ev=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Eu=Eu||document.createElement("div"),Eu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Eu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Da={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_6=["Webkit","ms","Moz","O"];Object.keys(Da).forEach(function(t){_6.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Da[e]=Da[t]})});function Nv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Da.hasOwnProperty(t)&&Da[t]?(""+e).trim():e+"px"}function Pv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Nv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var k6=ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function T0(t,e){if(e){if(k6[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function E0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var N0=null;function Fp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var P0=null,wo=null,So=null;function O1(t){if(t=kl(t)){if(typeof P0!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=qc(e),P0(t.stateNode,t.type,e))}}function Mv(t){wo?So?So.push(t):So=[t]:wo=t}function Av(){if(wo){var t=wo,e=So;if(So=wo=null,O1(t),e)for(t=0;t<e.length;t++)O1(e[t])}}function Iv(t,e){return t(e)}function Rv(){}var wh=!1;function Lv(t,e,n){if(wh)return t(e,n);wh=!0;try{return Iv(t,e,n)}finally{wh=!1,(wo!==null||So!==null)&&(Rv(),Av())}}function Ja(t,e){var n=t.stateNode;if(n===null)return null;var r=qc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ae(231,e,typeof n));return n}var M0=!1;if(ii)try{var ya={};Object.defineProperty(ya,"passive",{get:function(){M0=!0}}),window.addEventListener("test",ya,ya),window.removeEventListener("test",ya,ya)}catch{M0=!1}function b6(t,e,n,r,i,s,l,c,u){var f=Array.prototype.slice.call(arguments,3);try{e.apply(n,f)}catch(p){this.onError(p)}}var za=!1,hc=null,pc=!1,A0=null,C6={onError:function(t){za=!0,hc=t}};function T6(t,e,n,r,i,s,l,c,u){za=!1,hc=null,b6.apply(C6,arguments)}function E6(t,e,n,r,i,s,l,c,u){if(T6.apply(this,arguments),za){if(za){var f=hc;za=!1,hc=null}else throw Error(ae(198));pc||(pc=!0,A0=f)}}function Ms(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function jv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function D1(t){if(Ms(t)!==t)throw Error(ae(188))}function N6(t){var e=t.alternate;if(!e){if(e=Ms(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return D1(i),t;if(s===r)return D1(i),e;s=s.sibling}throw Error(ae(188))}if(n.return!==r.return)n=i,r=s;else{for(var l=!1,c=i.child;c;){if(c===n){l=!0,n=i,r=s;break}if(c===r){l=!0,r=i,n=s;break}c=c.sibling}if(!l){for(c=s.child;c;){if(c===n){l=!0,n=s,r=i;break}if(c===r){l=!0,r=s,n=i;break}c=c.sibling}if(!l)throw Error(ae(189))}}if(n.alternate!==r)throw Error(ae(190))}if(n.tag!==3)throw Error(ae(188));return n.stateNode.current===n?t:e}function Fv(t){return t=N6(t),t!==null?Ov(t):null}function Ov(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Ov(t);if(e!==null)return e;t=t.sibling}return null}var Dv=Rn.unstable_scheduleCallback,z1=Rn.unstable_cancelCallback,P6=Rn.unstable_shouldYield,M6=Rn.unstable_requestPaint,St=Rn.unstable_now,A6=Rn.unstable_getCurrentPriorityLevel,Op=Rn.unstable_ImmediatePriority,zv=Rn.unstable_UserBlockingPriority,gc=Rn.unstable_NormalPriority,I6=Rn.unstable_LowPriority,Bv=Rn.unstable_IdlePriority,Xc=null,Fr=null;function R6(t){if(Fr&&typeof Fr.onCommitFiberRoot=="function")try{Fr.onCommitFiberRoot(Xc,t,void 0,(t.current.flags&128)===128)}catch{}}var gr=Math.clz32?Math.clz32:F6,L6=Math.log,j6=Math.LN2;function F6(t){return t>>>=0,t===0?32:31-(L6(t)/j6|0)|0}var Nu=64,Pu=4194304;function La(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function mc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,l=n&268435455;if(l!==0){var c=l&~i;c!==0?r=La(c):(s&=l,s!==0&&(r=La(s)))}else l=n&~i,l!==0?r=La(l):s!==0&&(r=La(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-gr(e),i=1<<n,r|=t[n],e&=~i;return r}function O6(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function D6(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var l=31-gr(s),c=1<<l,u=i[l];u===-1?(!(c&n)||c&r)&&(i[l]=O6(c,e)):u<=e&&(t.expiredLanes|=c),s&=~c}}function I0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Uv(){var t=Nu;return Nu<<=1,!(Nu&4194240)&&(Nu=64),t}function Sh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Sl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-gr(e),t[e]=n}function z6(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-gr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Dp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-gr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var He=0;function Gv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Vv,zp,Wv,$v,Hv,R0=!1,Mu=[],Fi=null,Oi=null,Di=null,el=new Map,tl=new Map,Ii=[],B6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function B1(t,e){switch(t){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":Oi=null;break;case"mouseover":case"mouseout":Di=null;break;case"pointerover":case"pointerout":el.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":tl.delete(e.pointerId)}}function va(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=kl(e),e!==null&&zp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function U6(t,e,n,r,i){switch(e){case"focusin":return Fi=va(Fi,t,e,n,r,i),!0;case"dragenter":return Oi=va(Oi,t,e,n,r,i),!0;case"mouseover":return Di=va(Di,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return el.set(s,va(el.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,tl.set(s,va(tl.get(s)||null,t,e,n,r,i)),!0}return!1}function Yv(t){var e=xs(t.target);if(e!==null){var n=Ms(e);if(n!==null){if(e=n.tag,e===13){if(e=jv(n),e!==null){t.blockedOn=e,Hv(t.priority,function(){Wv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qu(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=L0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);N0=r,n.target.dispatchEvent(r),N0=null}else return e=kl(n),e!==null&&zp(e),t.blockedOn=n,!1;e.shift()}return!0}function U1(t,e,n){Qu(t)&&n.delete(e)}function G6(){R0=!1,Fi!==null&&Qu(Fi)&&(Fi=null),Oi!==null&&Qu(Oi)&&(Oi=null),Di!==null&&Qu(Di)&&(Di=null),el.forEach(U1),tl.forEach(U1)}function xa(t,e){t.blockedOn===e&&(t.blockedOn=null,R0||(R0=!0,Rn.unstable_scheduleCallback(Rn.unstable_NormalPriority,G6)))}function nl(t){function e(i){return xa(i,t)}if(0<Mu.length){xa(Mu[0],t);for(var n=1;n<Mu.length;n++){var r=Mu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Fi!==null&&xa(Fi,t),Oi!==null&&xa(Oi,t),Di!==null&&xa(Di,t),el.forEach(e),tl.forEach(e),n=0;n<Ii.length;n++)r=Ii[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ii.length&&(n=Ii[0],n.blockedOn===null);)Yv(n),n.blockedOn===null&&Ii.shift()}var _o=li.ReactCurrentBatchConfig,yc=!0;function V6(t,e,n,r){var i=He,s=_o.transition;_o.transition=null;try{He=1,Bp(t,e,n,r)}finally{He=i,_o.transition=s}}function W6(t,e,n,r){var i=He,s=_o.transition;_o.transition=null;try{He=4,Bp(t,e,n,r)}finally{He=i,_o.transition=s}}function Bp(t,e,n,r){if(yc){var i=L0(t,e,n,r);if(i===null)Ah(t,e,r,vc,n),B1(t,r);else if(U6(i,t,e,n,r))r.stopPropagation();else if(B1(t,r),e&4&&-1<B6.indexOf(t)){for(;i!==null;){var s=kl(i);if(s!==null&&Vv(s),s=L0(t,e,n,r),s===null&&Ah(t,e,r,vc,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Ah(t,e,r,null,n)}}var vc=null;function L0(t,e,n,r){if(vc=null,t=Fp(r),t=xs(t),t!==null)if(e=Ms(t),e===null)t=null;else if(n=e.tag,n===13){if(t=jv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return vc=t,null}function Xv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(A6()){case Op:return 1;case zv:return 4;case gc:case I6:return 16;case Bv:return 536870912;default:return 16}default:return 16}}var Li=null,Up=null,Zu=null;function Kv(){if(Zu)return Zu;var t,e=Up,n=e.length,r,i="value"in Li?Li.value:Li.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var l=n-t;for(r=1;r<=l&&e[n-r]===i[s-r];r++);return Zu=i.slice(t,1<r?1-r:void 0)}function qu(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Au(){return!0}function G1(){return!1}function jn(t){function e(n,r,i,s,l){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=l,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(s):s[c]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Au:G1,this.isPropagationStopped=G1,this}return ht(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Au)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Au)},persist:function(){},isPersistent:Au}),e}var Do={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gp=jn(Do),_l=ht({},Do,{view:0,detail:0}),$6=jn(_l),_h,kh,wa,Kc=ht({},_l,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==wa&&(wa&&t.type==="mousemove"?(_h=t.screenX-wa.screenX,kh=t.screenY-wa.screenY):kh=_h=0,wa=t),_h)},movementY:function(t){return"movementY"in t?t.movementY:kh}}),V1=jn(Kc),H6=ht({},Kc,{dataTransfer:0}),Y6=jn(H6),X6=ht({},_l,{relatedTarget:0}),bh=jn(X6),K6=ht({},Do,{animationName:0,elapsedTime:0,pseudoElement:0}),Q6=jn(K6),Z6=ht({},Do,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),q6=jn(Z6),J6=ht({},Do,{data:0}),W1=jn(J6),e8={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},t8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},n8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function r8(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=n8[t])?!!e[t]:!1}function Vp(){return r8}var i8=ht({},_l,{key:function(t){if(t.key){var e=e8[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=qu(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?t8[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vp,charCode:function(t){return t.type==="keypress"?qu(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?qu(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),s8=jn(i8),o8=ht({},Kc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$1=jn(o8),a8=ht({},_l,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vp}),l8=jn(a8),u8=ht({},Do,{propertyName:0,elapsedTime:0,pseudoElement:0}),c8=jn(u8),d8=ht({},Kc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),f8=jn(d8),h8=[9,13,27,32],Wp=ii&&"CompositionEvent"in window,Ba=null;ii&&"documentMode"in document&&(Ba=document.documentMode);var p8=ii&&"TextEvent"in window&&!Ba,Qv=ii&&(!Wp||Ba&&8<Ba&&11>=Ba),H1=String.fromCharCode(32),Y1=!1;function Zv(t,e){switch(t){case"keyup":return h8.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ao=!1;function g8(t,e){switch(t){case"compositionend":return qv(e);case"keypress":return e.which!==32?null:(Y1=!0,H1);case"textInput":return t=e.data,t===H1&&Y1?null:t;default:return null}}function m8(t,e){if(ao)return t==="compositionend"||!Wp&&Zv(t,e)?(t=Kv(),Zu=Up=Li=null,ao=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Qv&&e.locale!=="ko"?null:e.data;default:return null}}var y8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function X1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!y8[t.type]:e==="textarea"}function Jv(t,e,n,r){Mv(r),e=xc(e,"onChange"),0<e.length&&(n=new Gp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ua=null,rl=null;function v8(t){c3(t,0)}function Qc(t){var e=co(t);if(kv(e))return t}function x8(t,e){if(t==="change")return e}var e3=!1;if(ii){var Ch;if(ii){var Th="oninput"in document;if(!Th){var K1=document.createElement("div");K1.setAttribute("oninput","return;"),Th=typeof K1.oninput=="function"}Ch=Th}else Ch=!1;e3=Ch&&(!document.documentMode||9<document.documentMode)}function Q1(){Ua&&(Ua.detachEvent("onpropertychange",t3),rl=Ua=null)}function t3(t){if(t.propertyName==="value"&&Qc(rl)){var e=[];Jv(e,rl,t,Fp(t)),Lv(v8,e)}}function w8(t,e,n){t==="focusin"?(Q1(),Ua=e,rl=n,Ua.attachEvent("onpropertychange",t3)):t==="focusout"&&Q1()}function S8(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Qc(rl)}function _8(t,e){if(t==="click")return Qc(e)}function k8(t,e){if(t==="input"||t==="change")return Qc(e)}function b8(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var vr=typeof Object.is=="function"?Object.is:b8;function il(t,e){if(vr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!m0.call(e,i)||!vr(t[i],e[i]))return!1}return!0}function Z1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function q1(t,e){var n=Z1(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Z1(n)}}function n3(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?n3(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function r3(){for(var t=window,e=fc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=fc(t.document)}return e}function $p(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function C8(t){var e=r3(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&n3(n.ownerDocument.documentElement,n)){if(r!==null&&$p(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=q1(n,s);var l=q1(n,r);i&&l&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var T8=ii&&"documentMode"in document&&11>=document.documentMode,lo=null,j0=null,Ga=null,F0=!1;function J1(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;F0||lo==null||lo!==fc(r)||(r=lo,"selectionStart"in r&&$p(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ga&&il(Ga,r)||(Ga=r,r=xc(j0,"onSelect"),0<r.length&&(e=new Gp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=lo)))}function Iu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var uo={animationend:Iu("Animation","AnimationEnd"),animationiteration:Iu("Animation","AnimationIteration"),animationstart:Iu("Animation","AnimationStart"),transitionend:Iu("Transition","TransitionEnd")},Eh={},i3={};ii&&(i3=document.createElement("div").style,"AnimationEvent"in window||(delete uo.animationend.animation,delete uo.animationiteration.animation,delete uo.animationstart.animation),"TransitionEvent"in window||delete uo.transitionend.transition);function Zc(t){if(Eh[t])return Eh[t];if(!uo[t])return t;var e=uo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in i3)return Eh[t]=e[n];return t}var s3=Zc("animationend"),o3=Zc("animationiteration"),a3=Zc("animationstart"),l3=Zc("transitionend"),u3=new Map,ey="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xi(t,e){u3.set(t,e),Ps(e,[t])}for(var Nh=0;Nh<ey.length;Nh++){var Ph=ey[Nh],E8=Ph.toLowerCase(),N8=Ph[0].toUpperCase()+Ph.slice(1);Xi(E8,"on"+N8)}Xi(s3,"onAnimationEnd");Xi(o3,"onAnimationIteration");Xi(a3,"onAnimationStart");Xi("dblclick","onDoubleClick");Xi("focusin","onFocus");Xi("focusout","onBlur");Xi(l3,"onTransitionEnd");To("onMouseEnter",["mouseout","mouseover"]);To("onMouseLeave",["mouseout","mouseover"]);To("onPointerEnter",["pointerout","pointerover"]);To("onPointerLeave",["pointerout","pointerover"]);Ps("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ps("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ps("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ps("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ps("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ps("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P8=new Set("cancel close invalid load scroll toggle".split(" ").concat(ja));function ty(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,E6(r,e,void 0,t),t.currentTarget=null}function c3(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var l=r.length-1;0<=l;l--){var c=r[l],u=c.instance,f=c.currentTarget;if(c=c.listener,u!==s&&i.isPropagationStopped())break e;ty(i,c,f),s=u}else for(l=0;l<r.length;l++){if(c=r[l],u=c.instance,f=c.currentTarget,c=c.listener,u!==s&&i.isPropagationStopped())break e;ty(i,c,f),s=u}}}if(pc)throw t=A0,pc=!1,A0=null,t}function tt(t,e){var n=e[U0];n===void 0&&(n=e[U0]=new Set);var r=t+"__bubble";n.has(r)||(d3(e,t,2,!1),n.add(r))}function Mh(t,e,n){var r=0;e&&(r|=4),d3(n,t,r,e)}var Ru="_reactListening"+Math.random().toString(36).slice(2);function sl(t){if(!t[Ru]){t[Ru]=!0,vv.forEach(function(n){n!=="selectionchange"&&(P8.has(n)||Mh(n,!1,t),Mh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ru]||(e[Ru]=!0,Mh("selectionchange",!1,e))}}function d3(t,e,n,r){switch(Xv(e)){case 1:var i=V6;break;case 4:i=W6;break;default:i=Bp}n=i.bind(null,e,n,t),i=void 0,!M0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Ah(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===i||c.nodeType===8&&c.parentNode===i)break;if(l===4)for(l=r.return;l!==null;){var u=l.tag;if((u===3||u===4)&&(u=l.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;l=l.return}for(;c!==null;){if(l=xs(c),l===null)return;if(u=l.tag,u===5||u===6){r=s=l;continue e}c=c.parentNode}}r=r.return}Lv(function(){var f=s,p=Fp(n),m=[];e:{var w=u3.get(t);if(w!==void 0){var y=Gp,x=t;switch(t){case"keypress":if(qu(n)===0)break e;case"keydown":case"keyup":y=s8;break;case"focusin":x="focus",y=bh;break;case"focusout":x="blur",y=bh;break;case"beforeblur":case"afterblur":y=bh;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=V1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=Y6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=l8;break;case s3:case o3:case a3:y=Q6;break;case l3:y=c8;break;case"scroll":y=$6;break;case"wheel":y=f8;break;case"copy":case"cut":case"paste":y=q6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=$1}var b=(e&4)!==0,_=!b&&t==="scroll",S=b?w!==null?w+"Capture":null:w;b=[];for(var T=f,h;T!==null;){h=T;var k=h.stateNode;if(h.tag===5&&k!==null&&(h=k,S!==null&&(k=Ja(T,S),k!=null&&b.push(ol(T,k,h)))),_)break;T=T.return}0<b.length&&(w=new y(w,x,null,n,p),m.push({event:w,listeners:b}))}}if(!(e&7)){e:{if(w=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",w&&n!==N0&&(x=n.relatedTarget||n.fromElement)&&(xs(x)||x[si]))break e;if((y||w)&&(w=p.window===p?p:(w=p.ownerDocument)?w.defaultView||w.parentWindow:window,y?(x=n.relatedTarget||n.toElement,y=f,x=x?xs(x):null,x!==null&&(_=Ms(x),x!==_||x.tag!==5&&x.tag!==6)&&(x=null)):(y=null,x=f),y!==x)){if(b=V1,k="onMouseLeave",S="onMouseEnter",T="mouse",(t==="pointerout"||t==="pointerover")&&(b=$1,k="onPointerLeave",S="onPointerEnter",T="pointer"),_=y==null?w:co(y),h=x==null?w:co(x),w=new b(k,T+"leave",y,n,p),w.target=_,w.relatedTarget=h,k=null,xs(p)===f&&(b=new b(S,T+"enter",x,n,p),b.target=h,b.relatedTarget=_,k=b),_=k,y&&x)t:{for(b=y,S=x,T=0,h=b;h;h=eo(h))T++;for(h=0,k=S;k;k=eo(k))h++;for(;0<T-h;)b=eo(b),T--;for(;0<h-T;)S=eo(S),h--;for(;T--;){if(b===S||S!==null&&b===S.alternate)break t;b=eo(b),S=eo(S)}b=null}else b=null;y!==null&&ny(m,w,y,b,!1),x!==null&&_!==null&&ny(m,_,x,b,!0)}}e:{if(w=f?co(f):window,y=w.nodeName&&w.nodeName.toLowerCase(),y==="select"||y==="input"&&w.type==="file")var C=x8;else if(X1(w))if(e3)C=k8;else{C=S8;var N=w8}else(y=w.nodeName)&&y.toLowerCase()==="input"&&(w.type==="checkbox"||w.type==="radio")&&(C=_8);if(C&&(C=C(t,f))){Jv(m,C,n,p);break e}N&&N(t,w,f),t==="focusout"&&(N=w._wrapperState)&&N.controlled&&w.type==="number"&&k0(w,"number",w.value)}switch(N=f?co(f):window,t){case"focusin":(X1(N)||N.contentEditable==="true")&&(lo=N,j0=f,Ga=null);break;case"focusout":Ga=j0=lo=null;break;case"mousedown":F0=!0;break;case"contextmenu":case"mouseup":case"dragend":F0=!1,J1(m,n,p);break;case"selectionchange":if(T8)break;case"keydown":case"keyup":J1(m,n,p)}var A;if(Wp)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else ao?Zv(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(Qv&&n.locale!=="ko"&&(ao||M!=="onCompositionStart"?M==="onCompositionEnd"&&ao&&(A=Kv()):(Li=p,Up="value"in Li?Li.value:Li.textContent,ao=!0)),N=xc(f,M),0<N.length&&(M=new W1(M,t,null,n,p),m.push({event:M,listeners:N}),A?M.data=A:(A=qv(n),A!==null&&(M.data=A)))),(A=p8?g8(t,n):m8(t,n))&&(f=xc(f,"onBeforeInput"),0<f.length&&(p=new W1("onBeforeInput","beforeinput",null,n,p),m.push({event:p,listeners:f}),p.data=A))}c3(m,e)})}function ol(t,e,n){return{instance:t,listener:e,currentTarget:n}}function xc(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Ja(t,n),s!=null&&r.unshift(ol(t,s,i)),s=Ja(t,e),s!=null&&r.push(ol(t,s,i))),t=t.return}return r}function eo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ny(t,e,n,r,i){for(var s=e._reactName,l=[];n!==null&&n!==r;){var c=n,u=c.alternate,f=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&f!==null&&(c=f,i?(u=Ja(n,s),u!=null&&l.unshift(ol(n,u,c))):i||(u=Ja(n,s),u!=null&&l.push(ol(n,u,c)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var M8=/\r\n?/g,A8=/\u0000|\uFFFD/g;function ry(t){return(typeof t=="string"?t:""+t).replace(M8,`
`).replace(A8,"")}function Lu(t,e,n){if(e=ry(e),ry(t)!==e&&n)throw Error(ae(425))}function wc(){}var O0=null,D0=null;function z0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var B0=typeof setTimeout=="function"?setTimeout:void 0,I8=typeof clearTimeout=="function"?clearTimeout:void 0,iy=typeof Promise=="function"?Promise:void 0,R8=typeof queueMicrotask=="function"?queueMicrotask:typeof iy<"u"?function(t){return iy.resolve(null).then(t).catch(L8)}:B0;function L8(t){setTimeout(function(){throw t})}function Ih(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),nl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);nl(e)}function zi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function sy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var zo=Math.random().toString(36).slice(2),Rr="__reactFiber$"+zo,al="__reactProps$"+zo,si="__reactContainer$"+zo,U0="__reactEvents$"+zo,j8="__reactListeners$"+zo,F8="__reactHandles$"+zo;function xs(t){var e=t[Rr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[si]||n[Rr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=sy(t);t!==null;){if(n=t[Rr])return n;t=sy(t)}return e}t=n,n=t.parentNode}return null}function kl(t){return t=t[Rr]||t[si],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function co(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function qc(t){return t[al]||null}var G0=[],fo=-1;function Ki(t){return{current:t}}function nt(t){0>fo||(t.current=G0[fo],G0[fo]=null,fo--)}function Ze(t,e){fo++,G0[fo]=t.current,t.current=e}var Hi={},rn=Ki(Hi),bn=Ki(!1),bs=Hi;function Eo(t,e){var n=t.type.contextTypes;if(!n)return Hi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Cn(t){return t=t.childContextTypes,t!=null}function Sc(){nt(bn),nt(rn)}function oy(t,e,n){if(rn.current!==Hi)throw Error(ae(168));Ze(rn,e),Ze(bn,n)}function f3(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ae(108,w6(t)||"Unknown",i));return ht({},n,r)}function _c(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Hi,bs=rn.current,Ze(rn,t),Ze(bn,bn.current),!0}function ay(t,e,n){var r=t.stateNode;if(!r)throw Error(ae(169));n?(t=f3(t,e,bs),r.__reactInternalMemoizedMergedChildContext=t,nt(bn),nt(rn),Ze(rn,t)):nt(bn),Ze(bn,n)}var qr=null,Jc=!1,Rh=!1;function h3(t){qr===null?qr=[t]:qr.push(t)}function O8(t){Jc=!0,h3(t)}function Qi(){if(!Rh&&qr!==null){Rh=!0;var t=0,e=He;try{var n=qr;for(He=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}qr=null,Jc=!1}catch(i){throw qr!==null&&(qr=qr.slice(t+1)),Dv(Op,Qi),i}finally{He=e,Rh=!1}}return null}var ho=[],po=0,kc=null,bc=0,Xn=[],Kn=0,Cs=null,Jr=1,ei="";function ms(t,e){ho[po++]=bc,ho[po++]=kc,kc=t,bc=e}function p3(t,e,n){Xn[Kn++]=Jr,Xn[Kn++]=ei,Xn[Kn++]=Cs,Cs=t;var r=Jr;t=ei;var i=32-gr(r)-1;r&=~(1<<i),n+=1;var s=32-gr(e)+i;if(30<s){var l=i-i%5;s=(r&(1<<l)-1).toString(32),r>>=l,i-=l,Jr=1<<32-gr(e)+i|n<<i|r,ei=s+t}else Jr=1<<s|n<<i|r,ei=t}function Hp(t){t.return!==null&&(ms(t,1),p3(t,1,0))}function Yp(t){for(;t===kc;)kc=ho[--po],ho[po]=null,bc=ho[--po],ho[po]=null;for(;t===Cs;)Cs=Xn[--Kn],Xn[Kn]=null,ei=Xn[--Kn],Xn[Kn]=null,Jr=Xn[--Kn],Xn[Kn]=null}var In=null,An=null,at=!1,fr=null;function g3(t,e){var n=Zn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ly(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,In=t,An=zi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,In=t,An=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Cs!==null?{id:Jr,overflow:ei}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,In=t,An=null,!0):!1;default:return!1}}function V0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function W0(t){if(at){var e=An;if(e){var n=e;if(!ly(t,e)){if(V0(t))throw Error(ae(418));e=zi(n.nextSibling);var r=In;e&&ly(t,e)?g3(r,n):(t.flags=t.flags&-4097|2,at=!1,In=t)}}else{if(V0(t))throw Error(ae(418));t.flags=t.flags&-4097|2,at=!1,In=t}}}function uy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;In=t}function ju(t){if(t!==In)return!1;if(!at)return uy(t),at=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!z0(t.type,t.memoizedProps)),e&&(e=An)){if(V0(t))throw m3(),Error(ae(418));for(;e;)g3(t,e),e=zi(e.nextSibling)}if(uy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){An=zi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}An=null}}else An=In?zi(t.stateNode.nextSibling):null;return!0}function m3(){for(var t=An;t;)t=zi(t.nextSibling)}function No(){An=In=null,at=!1}function Xp(t){fr===null?fr=[t]:fr.push(t)}var D8=li.ReactCurrentBatchConfig;function Sa(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ae(309));var r=n.stateNode}if(!r)throw Error(ae(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(l){var c=i.refs;l===null?delete c[s]:c[s]=l},e._stringRef=s,e)}if(typeof t!="string")throw Error(ae(284));if(!n._owner)throw Error(ae(290,t))}return t}function Fu(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function cy(t){var e=t._init;return e(t._payload)}function y3(t){function e(S,T){if(t){var h=S.deletions;h===null?(S.deletions=[T],S.flags|=16):h.push(T)}}function n(S,T){if(!t)return null;for(;T!==null;)e(S,T),T=T.sibling;return null}function r(S,T){for(S=new Map;T!==null;)T.key!==null?S.set(T.key,T):S.set(T.index,T),T=T.sibling;return S}function i(S,T){return S=Vi(S,T),S.index=0,S.sibling=null,S}function s(S,T,h){return S.index=h,t?(h=S.alternate,h!==null?(h=h.index,h<T?(S.flags|=2,T):h):(S.flags|=2,T)):(S.flags|=1048576,T)}function l(S){return t&&S.alternate===null&&(S.flags|=2),S}function c(S,T,h,k){return T===null||T.tag!==6?(T=Bh(h,S.mode,k),T.return=S,T):(T=i(T,h),T.return=S,T)}function u(S,T,h,k){var C=h.type;return C===oo?p(S,T,h.props.children,k,h.key):T!==null&&(T.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Pi&&cy(C)===T.type)?(k=i(T,h.props),k.ref=Sa(S,T,h),k.return=S,k):(k=sc(h.type,h.key,h.props,null,S.mode,k),k.ref=Sa(S,T,h),k.return=S,k)}function f(S,T,h,k){return T===null||T.tag!==4||T.stateNode.containerInfo!==h.containerInfo||T.stateNode.implementation!==h.implementation?(T=Uh(h,S.mode,k),T.return=S,T):(T=i(T,h.children||[]),T.return=S,T)}function p(S,T,h,k,C){return T===null||T.tag!==7?(T=ks(h,S.mode,k,C),T.return=S,T):(T=i(T,h),T.return=S,T)}function m(S,T,h){if(typeof T=="string"&&T!==""||typeof T=="number")return T=Bh(""+T,S.mode,h),T.return=S,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Cu:return h=sc(T.type,T.key,T.props,null,S.mode,h),h.ref=Sa(S,null,T),h.return=S,h;case so:return T=Uh(T,S.mode,h),T.return=S,T;case Pi:var k=T._init;return m(S,k(T._payload),h)}if(Ra(T)||ma(T))return T=ks(T,S.mode,h,null),T.return=S,T;Fu(S,T)}return null}function w(S,T,h,k){var C=T!==null?T.key:null;if(typeof h=="string"&&h!==""||typeof h=="number")return C!==null?null:c(S,T,""+h,k);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Cu:return h.key===C?u(S,T,h,k):null;case so:return h.key===C?f(S,T,h,k):null;case Pi:return C=h._init,w(S,T,C(h._payload),k)}if(Ra(h)||ma(h))return C!==null?null:p(S,T,h,k,null);Fu(S,h)}return null}function y(S,T,h,k,C){if(typeof k=="string"&&k!==""||typeof k=="number")return S=S.get(h)||null,c(T,S,""+k,C);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Cu:return S=S.get(k.key===null?h:k.key)||null,u(T,S,k,C);case so:return S=S.get(k.key===null?h:k.key)||null,f(T,S,k,C);case Pi:var N=k._init;return y(S,T,h,N(k._payload),C)}if(Ra(k)||ma(k))return S=S.get(h)||null,p(T,S,k,C,null);Fu(T,k)}return null}function x(S,T,h,k){for(var C=null,N=null,A=T,M=T=0,R=null;A!==null&&M<h.length;M++){A.index>M?(R=A,A=null):R=A.sibling;var I=w(S,A,h[M],k);if(I===null){A===null&&(A=R);break}t&&A&&I.alternate===null&&e(S,A),T=s(I,T,M),N===null?C=I:N.sibling=I,N=I,A=R}if(M===h.length)return n(S,A),at&&ms(S,M),C;if(A===null){for(;M<h.length;M++)A=m(S,h[M],k),A!==null&&(T=s(A,T,M),N===null?C=A:N.sibling=A,N=A);return at&&ms(S,M),C}for(A=r(S,A);M<h.length;M++)R=y(A,S,M,h[M],k),R!==null&&(t&&R.alternate!==null&&A.delete(R.key===null?M:R.key),T=s(R,T,M),N===null?C=R:N.sibling=R,N=R);return t&&A.forEach(function(j){return e(S,j)}),at&&ms(S,M),C}function b(S,T,h,k){var C=ma(h);if(typeof C!="function")throw Error(ae(150));if(h=C.call(h),h==null)throw Error(ae(151));for(var N=C=null,A=T,M=T=0,R=null,I=h.next();A!==null&&!I.done;M++,I=h.next()){A.index>M?(R=A,A=null):R=A.sibling;var j=w(S,A,I.value,k);if(j===null){A===null&&(A=R);break}t&&A&&j.alternate===null&&e(S,A),T=s(j,T,M),N===null?C=j:N.sibling=j,N=j,A=R}if(I.done)return n(S,A),at&&ms(S,M),C;if(A===null){for(;!I.done;M++,I=h.next())I=m(S,I.value,k),I!==null&&(T=s(I,T,M),N===null?C=I:N.sibling=I,N=I);return at&&ms(S,M),C}for(A=r(S,A);!I.done;M++,I=h.next())I=y(A,S,M,I.value,k),I!==null&&(t&&I.alternate!==null&&A.delete(I.key===null?M:I.key),T=s(I,T,M),N===null?C=I:N.sibling=I,N=I);return t&&A.forEach(function(z){return e(S,z)}),at&&ms(S,M),C}function _(S,T,h,k){if(typeof h=="object"&&h!==null&&h.type===oo&&h.key===null&&(h=h.props.children),typeof h=="object"&&h!==null){switch(h.$$typeof){case Cu:e:{for(var C=h.key,N=T;N!==null;){if(N.key===C){if(C=h.type,C===oo){if(N.tag===7){n(S,N.sibling),T=i(N,h.props.children),T.return=S,S=T;break e}}else if(N.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Pi&&cy(C)===N.type){n(S,N.sibling),T=i(N,h.props),T.ref=Sa(S,N,h),T.return=S,S=T;break e}n(S,N);break}else e(S,N);N=N.sibling}h.type===oo?(T=ks(h.props.children,S.mode,k,h.key),T.return=S,S=T):(k=sc(h.type,h.key,h.props,null,S.mode,k),k.ref=Sa(S,T,h),k.return=S,S=k)}return l(S);case so:e:{for(N=h.key;T!==null;){if(T.key===N)if(T.tag===4&&T.stateNode.containerInfo===h.containerInfo&&T.stateNode.implementation===h.implementation){n(S,T.sibling),T=i(T,h.children||[]),T.return=S,S=T;break e}else{n(S,T);break}else e(S,T);T=T.sibling}T=Uh(h,S.mode,k),T.return=S,S=T}return l(S);case Pi:return N=h._init,_(S,T,N(h._payload),k)}if(Ra(h))return x(S,T,h,k);if(ma(h))return b(S,T,h,k);Fu(S,h)}return typeof h=="string"&&h!==""||typeof h=="number"?(h=""+h,T!==null&&T.tag===6?(n(S,T.sibling),T=i(T,h),T.return=S,S=T):(n(S,T),T=Bh(h,S.mode,k),T.return=S,S=T),l(S)):n(S,T)}return _}var Po=y3(!0),v3=y3(!1),Cc=Ki(null),Tc=null,go=null,Kp=null;function Qp(){Kp=go=Tc=null}function Zp(t){var e=Cc.current;nt(Cc),t._currentValue=e}function $0(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ko(t,e){Tc=t,Kp=go=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(_n=!0),t.firstContext=null)}function Jn(t){var e=t._currentValue;if(Kp!==t)if(t={context:t,memoizedValue:e,next:null},go===null){if(Tc===null)throw Error(ae(308));go=t,Tc.dependencies={lanes:0,firstContext:t}}else go=go.next=t;return e}var ws=null;function qp(t){ws===null?ws=[t]:ws.push(t)}function x3(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,qp(e)):(n.next=i.next,i.next=n),e.interleaved=n,oi(t,r)}function oi(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Mi=!1;function Jp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function w3(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ti(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Bi(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ze&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,oi(t,n)}return i=r.interleaved,i===null?(e.next=e,qp(r)):(e.next=i.next,i.next=e),r.interleaved=e,oi(t,n)}function Ju(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Dp(t,n)}}function dy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=l:s=s.next=l,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ec(t,e,n,r){var i=t.updateQueue;Mi=!1;var s=i.firstBaseUpdate,l=i.lastBaseUpdate,c=i.shared.pending;if(c!==null){i.shared.pending=null;var u=c,f=u.next;u.next=null,l===null?s=f:l.next=f,l=u;var p=t.alternate;p!==null&&(p=p.updateQueue,c=p.lastBaseUpdate,c!==l&&(c===null?p.firstBaseUpdate=f:c.next=f,p.lastBaseUpdate=u))}if(s!==null){var m=i.baseState;l=0,p=f=u=null,c=s;do{var w=c.lane,y=c.eventTime;if((r&w)===w){p!==null&&(p=p.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var x=t,b=c;switch(w=e,y=n,b.tag){case 1:if(x=b.payload,typeof x=="function"){m=x.call(y,m,w);break e}m=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=b.payload,w=typeof x=="function"?x.call(y,m,w):x,w==null)break e;m=ht({},m,w);break e;case 2:Mi=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,w=i.effects,w===null?i.effects=[c]:w.push(c))}else y={eventTime:y,lane:w,tag:c.tag,payload:c.payload,callback:c.callback,next:null},p===null?(f=p=y,u=m):p=p.next=y,l|=w;if(c=c.next,c===null){if(c=i.shared.pending,c===null)break;w=c,c=w.next,w.next=null,i.lastBaseUpdate=w,i.shared.pending=null}}while(1);if(p===null&&(u=m),i.baseState=u,i.firstBaseUpdate=f,i.lastBaseUpdate=p,e=i.shared.interleaved,e!==null){i=e;do l|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Es|=l,t.lanes=l,t.memoizedState=m}}function fy(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(ae(191,i));i.call(r)}}}var bl={},Or=Ki(bl),ll=Ki(bl),ul=Ki(bl);function Ss(t){if(t===bl)throw Error(ae(174));return t}function eg(t,e){switch(Ze(ul,e),Ze(ll,t),Ze(Or,bl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:C0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=C0(e,t)}nt(Or),Ze(Or,e)}function Mo(){nt(Or),nt(ll),nt(ul)}function S3(t){Ss(ul.current);var e=Ss(Or.current),n=C0(e,t.type);e!==n&&(Ze(ll,t),Ze(Or,n))}function tg(t){ll.current===t&&(nt(Or),nt(ll))}var dt=Ki(0);function Nc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Lh=[];function ng(){for(var t=0;t<Lh.length;t++)Lh[t]._workInProgressVersionPrimary=null;Lh.length=0}var ec=li.ReactCurrentDispatcher,jh=li.ReactCurrentBatchConfig,Ts=0,ft=null,Nt=null,Ft=null,Pc=!1,Va=!1,cl=0,z8=0;function Jt(){throw Error(ae(321))}function rg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!vr(t[n],e[n]))return!1;return!0}function ig(t,e,n,r,i,s){if(Ts=s,ft=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ec.current=t===null||t.memoizedState===null?V8:W8,t=n(r,i),Va){s=0;do{if(Va=!1,cl=0,25<=s)throw Error(ae(301));s+=1,Ft=Nt=null,e.updateQueue=null,ec.current=$8,t=n(r,i)}while(Va)}if(ec.current=Mc,e=Nt!==null&&Nt.next!==null,Ts=0,Ft=Nt=ft=null,Pc=!1,e)throw Error(ae(300));return t}function sg(){var t=cl!==0;return cl=0,t}function Ar(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?ft.memoizedState=Ft=t:Ft=Ft.next=t,Ft}function er(){if(Nt===null){var t=ft.alternate;t=t!==null?t.memoizedState:null}else t=Nt.next;var e=Ft===null?ft.memoizedState:Ft.next;if(e!==null)Ft=e,Nt=t;else{if(t===null)throw Error(ae(310));Nt=t,t={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Ft===null?ft.memoizedState=Ft=t:Ft=Ft.next=t}return Ft}function dl(t,e){return typeof e=="function"?e(t):e}function Fh(t){var e=er(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var r=Nt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var l=i.next;i.next=s.next,s.next=l}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var c=l=null,u=null,f=s;do{var p=f.lane;if((Ts&p)===p)u!==null&&(u=u.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),r=f.hasEagerState?f.eagerState:t(r,f.action);else{var m={lane:p,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};u===null?(c=u=m,l=r):u=u.next=m,ft.lanes|=p,Es|=p}f=f.next}while(f!==null&&f!==s);u===null?l=r:u.next=c,vr(r,e.memoizedState)||(_n=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,ft.lanes|=s,Es|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Oh(t){var e=er(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var l=i=i.next;do s=t(s,l.action),l=l.next;while(l!==i);vr(s,e.memoizedState)||(_n=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function _3(){}function k3(t,e){var n=ft,r=er(),i=e(),s=!vr(r.memoizedState,i);if(s&&(r.memoizedState=i,_n=!0),r=r.queue,og(T3.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ft!==null&&Ft.memoizedState.tag&1){if(n.flags|=2048,fl(9,C3.bind(null,n,r,i,e),void 0,null),Ot===null)throw Error(ae(349));Ts&30||b3(n,e,i)}return i}function b3(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function C3(t,e,n,r){e.value=n,e.getSnapshot=r,E3(e)&&N3(t)}function T3(t,e,n){return n(function(){E3(e)&&N3(t)})}function E3(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!vr(t,n)}catch{return!0}}function N3(t){var e=oi(t,1);e!==null&&mr(e,t,1,-1)}function hy(t){var e=Ar();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dl,lastRenderedState:t},e.queue=t,t=t.dispatch=G8.bind(null,ft,t),[e.memoizedState,t]}function fl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function P3(){return er().memoizedState}function tc(t,e,n,r){var i=Ar();ft.flags|=t,i.memoizedState=fl(1|e,n,void 0,r===void 0?null:r)}function ed(t,e,n,r){var i=er();r=r===void 0?null:r;var s=void 0;if(Nt!==null){var l=Nt.memoizedState;if(s=l.destroy,r!==null&&rg(r,l.deps)){i.memoizedState=fl(e,n,s,r);return}}ft.flags|=t,i.memoizedState=fl(1|e,n,s,r)}function py(t,e){return tc(8390656,8,t,e)}function og(t,e){return ed(2048,8,t,e)}function M3(t,e){return ed(4,2,t,e)}function A3(t,e){return ed(4,4,t,e)}function I3(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function R3(t,e,n){return n=n!=null?n.concat([t]):null,ed(4,4,I3.bind(null,e,t),n)}function ag(){}function L3(t,e){var n=er();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&rg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function j3(t,e){var n=er();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&rg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function F3(t,e,n){return Ts&21?(vr(n,e)||(n=Uv(),ft.lanes|=n,Es|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,_n=!0),t.memoizedState=n)}function B8(t,e){var n=He;He=n!==0&&4>n?n:4,t(!0);var r=jh.transition;jh.transition={};try{t(!1),e()}finally{He=n,jh.transition=r}}function O3(){return er().memoizedState}function U8(t,e,n){var r=Gi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},D3(t))z3(e,n);else if(n=x3(t,e,n,r),n!==null){var i=ln();mr(n,t,r,i),B3(n,e,r)}}function G8(t,e,n){var r=Gi(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(D3(t))z3(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var l=e.lastRenderedState,c=s(l,n);if(i.hasEagerState=!0,i.eagerState=c,vr(c,l)){var u=e.interleaved;u===null?(i.next=i,qp(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=x3(t,e,i,r),n!==null&&(i=ln(),mr(n,t,r,i),B3(n,e,r))}}function D3(t){var e=t.alternate;return t===ft||e!==null&&e===ft}function z3(t,e){Va=Pc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function B3(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Dp(t,n)}}var Mc={readContext:Jn,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},V8={readContext:Jn,useCallback:function(t,e){return Ar().memoizedState=[t,e===void 0?null:e],t},useContext:Jn,useEffect:py,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,tc(4194308,4,I3.bind(null,e,t),n)},useLayoutEffect:function(t,e){return tc(4194308,4,t,e)},useInsertionEffect:function(t,e){return tc(4,2,t,e)},useMemo:function(t,e){var n=Ar();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ar();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=U8.bind(null,ft,t),[r.memoizedState,t]},useRef:function(t){var e=Ar();return t={current:t},e.memoizedState=t},useState:hy,useDebugValue:ag,useDeferredValue:function(t){return Ar().memoizedState=t},useTransition:function(){var t=hy(!1),e=t[0];return t=B8.bind(null,t[1]),Ar().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ft,i=Ar();if(at){if(n===void 0)throw Error(ae(407));n=n()}else{if(n=e(),Ot===null)throw Error(ae(349));Ts&30||b3(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,py(T3.bind(null,r,s,t),[t]),r.flags|=2048,fl(9,C3.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Ar(),e=Ot.identifierPrefix;if(at){var n=ei,r=Jr;n=(r&~(1<<32-gr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=cl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=z8++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},W8={readContext:Jn,useCallback:L3,useContext:Jn,useEffect:og,useImperativeHandle:R3,useInsertionEffect:M3,useLayoutEffect:A3,useMemo:j3,useReducer:Fh,useRef:P3,useState:function(){return Fh(dl)},useDebugValue:ag,useDeferredValue:function(t){var e=er();return F3(e,Nt.memoizedState,t)},useTransition:function(){var t=Fh(dl)[0],e=er().memoizedState;return[t,e]},useMutableSource:_3,useSyncExternalStore:k3,useId:O3,unstable_isNewReconciler:!1},$8={readContext:Jn,useCallback:L3,useContext:Jn,useEffect:og,useImperativeHandle:R3,useInsertionEffect:M3,useLayoutEffect:A3,useMemo:j3,useReducer:Oh,useRef:P3,useState:function(){return Oh(dl)},useDebugValue:ag,useDeferredValue:function(t){var e=er();return Nt===null?e.memoizedState=t:F3(e,Nt.memoizedState,t)},useTransition:function(){var t=Oh(dl)[0],e=er().memoizedState;return[t,e]},useMutableSource:_3,useSyncExternalStore:k3,useId:O3,unstable_isNewReconciler:!1};function cr(t,e){if(t&&t.defaultProps){e=ht({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function H0(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ht({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var td={isMounted:function(t){return(t=t._reactInternals)?Ms(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=ln(),i=Gi(t),s=ti(r,i);s.payload=e,n!=null&&(s.callback=n),e=Bi(t,s,i),e!==null&&(mr(e,t,i,r),Ju(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=ln(),i=Gi(t),s=ti(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Bi(t,s,i),e!==null&&(mr(e,t,i,r),Ju(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ln(),r=Gi(t),i=ti(n,r);i.tag=2,e!=null&&(i.callback=e),e=Bi(t,i,r),e!==null&&(mr(e,t,r,n),Ju(e,t,r))}};function gy(t,e,n,r,i,s,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,l):e.prototype&&e.prototype.isPureReactComponent?!il(n,r)||!il(i,s):!0}function U3(t,e,n){var r=!1,i=Hi,s=e.contextType;return typeof s=="object"&&s!==null?s=Jn(s):(i=Cn(e)?bs:rn.current,r=e.contextTypes,s=(r=r!=null)?Eo(t,i):Hi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=td,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function my(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&td.enqueueReplaceState(e,e.state,null)}function Y0(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Jp(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Jn(s):(s=Cn(e)?bs:rn.current,i.context=Eo(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(H0(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&td.enqueueReplaceState(i,i.state,null),Ec(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ao(t,e){try{var n="",r=e;do n+=x6(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Dh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function X0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var H8=typeof WeakMap=="function"?WeakMap:Map;function G3(t,e,n){n=ti(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ic||(Ic=!0,ip=r),X0(t,e)},n}function V3(t,e,n){n=ti(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){X0(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){X0(t,e),typeof r!="function"&&(Ui===null?Ui=new Set([this]):Ui.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function yy(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new H8;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=ow.bind(null,t,e,n),e.then(t,t))}function vy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function xy(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ti(-1,1),e.tag=2,Bi(n,e,1))),n.lanes|=1),t)}var Y8=li.ReactCurrentOwner,_n=!1;function an(t,e,n,r){e.child=t===null?v3(e,null,n,r):Po(e,t.child,n,r)}function wy(t,e,n,r,i){n=n.render;var s=e.ref;return ko(e,i),r=ig(t,e,n,r,s,i),n=sg(),t!==null&&!_n?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,ai(t,e,i)):(at&&n&&Hp(e),e.flags|=1,an(t,e,r,i),e.child)}function Sy(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!gg(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,W3(t,e,s,r,i)):(t=sc(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var l=s.memoizedProps;if(n=n.compare,n=n!==null?n:il,n(l,r)&&t.ref===e.ref)return ai(t,e,i)}return e.flags|=1,t=Vi(s,r),t.ref=e.ref,t.return=e,e.child=t}function W3(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(il(s,r)&&t.ref===e.ref)if(_n=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(_n=!0);else return e.lanes=t.lanes,ai(t,e,i)}return K0(t,e,n,r,i)}function $3(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(yo,Mn),Mn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ze(yo,Mn),Mn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Ze(yo,Mn),Mn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,Ze(yo,Mn),Mn|=r;return an(t,e,i,n),e.child}function H3(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function K0(t,e,n,r,i){var s=Cn(n)?bs:rn.current;return s=Eo(e,s),ko(e,i),n=ig(t,e,n,r,s,i),r=sg(),t!==null&&!_n?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,ai(t,e,i)):(at&&r&&Hp(e),e.flags|=1,an(t,e,n,i),e.child)}function _y(t,e,n,r,i){if(Cn(n)){var s=!0;_c(e)}else s=!1;if(ko(e,i),e.stateNode===null)nc(t,e),U3(e,n,r),Y0(e,n,r,i),r=!0;else if(t===null){var l=e.stateNode,c=e.memoizedProps;l.props=c;var u=l.context,f=n.contextType;typeof f=="object"&&f!==null?f=Jn(f):(f=Cn(n)?bs:rn.current,f=Eo(e,f));var p=n.getDerivedStateFromProps,m=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";m||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||u!==f)&&my(e,l,r,f),Mi=!1;var w=e.memoizedState;l.state=w,Ec(e,r,l,i),u=e.memoizedState,c!==r||w!==u||bn.current||Mi?(typeof p=="function"&&(H0(e,n,p,r),u=e.memoizedState),(c=Mi||gy(e,n,c,r,w,u,f))?(m||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),l.props=r,l.state=u,l.context=f,r=c):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{l=e.stateNode,w3(t,e),c=e.memoizedProps,f=e.type===e.elementType?c:cr(e.type,c),l.props=f,m=e.pendingProps,w=l.context,u=n.contextType,typeof u=="object"&&u!==null?u=Jn(u):(u=Cn(n)?bs:rn.current,u=Eo(e,u));var y=n.getDerivedStateFromProps;(p=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==m||w!==u)&&my(e,l,r,u),Mi=!1,w=e.memoizedState,l.state=w,Ec(e,r,l,i);var x=e.memoizedState;c!==m||w!==x||bn.current||Mi?(typeof y=="function"&&(H0(e,n,y,r),x=e.memoizedState),(f=Mi||gy(e,n,f,r,w,x,u)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,x,u),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,x,u)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&w===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&w===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=x),l.props=r,l.state=x,l.context=u,r=f):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&w===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&w===t.memoizedState||(e.flags|=1024),r=!1)}return Q0(t,e,n,r,s,i)}function Q0(t,e,n,r,i,s){H3(t,e);var l=(e.flags&128)!==0;if(!r&&!l)return i&&ay(e,n,!1),ai(t,e,s);r=e.stateNode,Y8.current=e;var c=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&l?(e.child=Po(e,t.child,null,s),e.child=Po(e,null,c,s)):an(t,e,c,s),e.memoizedState=r.state,i&&ay(e,n,!0),e.child}function Y3(t){var e=t.stateNode;e.pendingContext?oy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&oy(t,e.context,!1),eg(t,e.containerInfo)}function ky(t,e,n,r,i){return No(),Xp(i),e.flags|=256,an(t,e,n,r),e.child}var Z0={dehydrated:null,treeContext:null,retryLane:0};function q0(t){return{baseLanes:t,cachePool:null,transitions:null}}function X3(t,e,n){var r=e.pendingProps,i=dt.current,s=!1,l=(e.flags&128)!==0,c;if((c=l)||(c=t!==null&&t.memoizedState===null?!1:(i&2)!==0),c?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ze(dt,i&1),t===null)return W0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,t=r.fallback,s?(r=e.mode,s=e.child,l={mode:"hidden",children:l},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=l):s=id(l,r,0,null),t=ks(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=q0(n),e.memoizedState=Z0,t):lg(e,l));if(i=t.memoizedState,i!==null&&(c=i.dehydrated,c!==null))return X8(t,e,l,r,c,i,n);if(s){s=r.fallback,l=e.mode,i=t.child,c=i.sibling;var u={mode:"hidden",children:r.children};return!(l&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Vi(i,u),r.subtreeFlags=i.subtreeFlags&14680064),c!==null?s=Vi(c,s):(s=ks(s,l,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,l=t.child.memoizedState,l=l===null?q0(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=t.childLanes&~n,e.memoizedState=Z0,r}return s=t.child,t=s.sibling,r=Vi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function lg(t,e){return e=id({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ou(t,e,n,r){return r!==null&&Xp(r),Po(e,t.child,null,n),t=lg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function X8(t,e,n,r,i,s,l){if(n)return e.flags&256?(e.flags&=-257,r=Dh(Error(ae(422))),Ou(t,e,l,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=id({mode:"visible",children:r.children},i,0,null),s=ks(s,i,l,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Po(e,t.child,null,l),e.child.memoizedState=q0(l),e.memoizedState=Z0,s);if(!(e.mode&1))return Ou(t,e,l,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var c=r.dgst;return r=c,s=Error(ae(419)),r=Dh(s,r,void 0),Ou(t,e,l,r)}if(c=(l&t.childLanes)!==0,_n||c){if(r=Ot,r!==null){switch(l&-l){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|l)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,oi(t,i),mr(r,t,i,-1))}return pg(),r=Dh(Error(ae(421))),Ou(t,e,l,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=aw.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,An=zi(i.nextSibling),In=e,at=!0,fr=null,t!==null&&(Xn[Kn++]=Jr,Xn[Kn++]=ei,Xn[Kn++]=Cs,Jr=t.id,ei=t.overflow,Cs=e),e=lg(e,r.children),e.flags|=4096,e)}function by(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),$0(t.return,e,n)}function zh(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function K3(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(an(t,e,r.children,n),r=dt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&by(t,n,e);else if(t.tag===19)by(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ze(dt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Nc(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),zh(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Nc(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}zh(e,!0,n,null,s);break;case"together":zh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function nc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ai(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Es|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,n=Vi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Vi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function K8(t,e,n){switch(e.tag){case 3:Y3(e),No();break;case 5:S3(e);break;case 1:Cn(e.type)&&_c(e);break;case 4:eg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Ze(Cc,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ze(dt,dt.current&1),e.flags|=128,null):n&e.child.childLanes?X3(t,e,n):(Ze(dt,dt.current&1),t=ai(t,e,n),t!==null?t.sibling:null);Ze(dt,dt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return K3(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ze(dt,dt.current),r)break;return null;case 22:case 23:return e.lanes=0,$3(t,e,n)}return ai(t,e,n)}var Q3,J0,Z3,q3;Q3=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};J0=function(){};Z3=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Ss(Or.current);var s=null;switch(n){case"input":i=S0(t,i),r=S0(t,r),s=[];break;case"select":i=ht({},i,{value:void 0}),r=ht({},r,{value:void 0}),s=[];break;case"textarea":i=b0(t,i),r=b0(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=wc)}T0(n,r);var l;n=null;for(f in i)if(!r.hasOwnProperty(f)&&i.hasOwnProperty(f)&&i[f]!=null)if(f==="style"){var c=i[f];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Za.hasOwnProperty(f)?s||(s=[]):(s=s||[]).push(f,null));for(f in r){var u=r[f];if(c=i!=null?i[f]:void 0,r.hasOwnProperty(f)&&u!==c&&(u!=null||c!=null))if(f==="style")if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(n||(n={}),n[l]=u[l])}else n||(s||(s=[]),s.push(f,n)),n=u;else f==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(s=s||[]).push(f,u)):f==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(f,""+u):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(Za.hasOwnProperty(f)?(u!=null&&f==="onScroll"&&tt("scroll",t),s||c===u||(s=[])):(s=s||[]).push(f,u))}n&&(s=s||[]).push("style",n);var f=s;(e.updateQueue=f)&&(e.flags|=4)}};q3=function(t,e,n,r){n!==r&&(e.flags|=4)};function _a(t,e){if(!at)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function en(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Q8(t,e,n){var r=e.pendingProps;switch(Yp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(e),null;case 1:return Cn(e.type)&&Sc(),en(e),null;case 3:return r=e.stateNode,Mo(),nt(bn),nt(rn),ng(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ju(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,fr!==null&&(ap(fr),fr=null))),J0(t,e),en(e),null;case 5:tg(e);var i=Ss(ul.current);if(n=e.type,t!==null&&e.stateNode!=null)Z3(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ae(166));return en(e),null}if(t=Ss(Or.current),ju(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Rr]=e,r[al]=s,t=(e.mode&1)!==0,n){case"dialog":tt("cancel",r),tt("close",r);break;case"iframe":case"object":case"embed":tt("load",r);break;case"video":case"audio":for(i=0;i<ja.length;i++)tt(ja[i],r);break;case"source":tt("error",r);break;case"img":case"image":case"link":tt("error",r),tt("load",r);break;case"details":tt("toggle",r);break;case"input":R1(r,s),tt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},tt("invalid",r);break;case"textarea":j1(r,s),tt("invalid",r)}T0(n,s),i=null;for(var l in s)if(s.hasOwnProperty(l)){var c=s[l];l==="children"?typeof c=="string"?r.textContent!==c&&(s.suppressHydrationWarning!==!0&&Lu(r.textContent,c,t),i=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(s.suppressHydrationWarning!==!0&&Lu(r.textContent,c,t),i=["children",""+c]):Za.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&tt("scroll",r)}switch(n){case"input":Tu(r),L1(r,s,!0);break;case"textarea":Tu(r),F1(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=wc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{l=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Tv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),n==="select"&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[Rr]=e,t[al]=r,Q3(t,e,!1,!1),e.stateNode=t;e:{switch(l=E0(n,r),n){case"dialog":tt("cancel",t),tt("close",t),i=r;break;case"iframe":case"object":case"embed":tt("load",t),i=r;break;case"video":case"audio":for(i=0;i<ja.length;i++)tt(ja[i],t);i=r;break;case"source":tt("error",t),i=r;break;case"img":case"image":case"link":tt("error",t),tt("load",t),i=r;break;case"details":tt("toggle",t),i=r;break;case"input":R1(t,r),i=S0(t,r),tt("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ht({},r,{value:void 0}),tt("invalid",t);break;case"textarea":j1(t,r),i=b0(t,r),tt("invalid",t);break;default:i=r}T0(n,i),c=i;for(s in c)if(c.hasOwnProperty(s)){var u=c[s];s==="style"?Pv(t,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Ev(t,u)):s==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&qa(t,u):typeof u=="number"&&qa(t,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Za.hasOwnProperty(s)?u!=null&&s==="onScroll"&&tt("scroll",t):u!=null&&Ip(t,s,u,l))}switch(n){case"input":Tu(t),L1(t,r,!1);break;case"textarea":Tu(t),F1(t);break;case"option":r.value!=null&&t.setAttribute("value",""+$i(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?xo(t,!!r.multiple,s,!1):r.defaultValue!=null&&xo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=wc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return en(e),null;case 6:if(t&&e.stateNode!=null)q3(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ae(166));if(n=Ss(ul.current),Ss(Or.current),ju(e)){if(r=e.stateNode,n=e.memoizedProps,r[Rr]=e,(s=r.nodeValue!==n)&&(t=In,t!==null))switch(t.tag){case 3:Lu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Lu(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Rr]=e,e.stateNode=r}return en(e),null;case 13:if(nt(dt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(at&&An!==null&&e.mode&1&&!(e.flags&128))m3(),No(),e.flags|=98560,s=!1;else if(s=ju(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(ae(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ae(317));s[Rr]=e}else No(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;en(e),s=!1}else fr!==null&&(ap(fr),fr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||dt.current&1?Pt===0&&(Pt=3):pg())),e.updateQueue!==null&&(e.flags|=4),en(e),null);case 4:return Mo(),J0(t,e),t===null&&sl(e.stateNode.containerInfo),en(e),null;case 10:return Zp(e.type._context),en(e),null;case 17:return Cn(e.type)&&Sc(),en(e),null;case 19:if(nt(dt),s=e.memoizedState,s===null)return en(e),null;if(r=(e.flags&128)!==0,l=s.rendering,l===null)if(r)_a(s,!1);else{if(Pt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=Nc(t),l!==null){for(e.flags|=128,_a(s,!1),r=l.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,l=s.alternate,l===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,t=l.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ze(dt,dt.current&1|2),e.child}t=t.sibling}s.tail!==null&&St()>Io&&(e.flags|=128,r=!0,_a(s,!1),e.lanes=4194304)}else{if(!r)if(t=Nc(l),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),_a(s,!0),s.tail===null&&s.tailMode==="hidden"&&!l.alternate&&!at)return en(e),null}else 2*St()-s.renderingStartTime>Io&&n!==1073741824&&(e.flags|=128,r=!0,_a(s,!1),e.lanes=4194304);s.isBackwards?(l.sibling=e.child,e.child=l):(n=s.last,n!==null?n.sibling=l:e.child=l,s.last=l)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=St(),e.sibling=null,n=dt.current,Ze(dt,r?n&1|2:n&1),e):(en(e),null);case 22:case 23:return hg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Mn&1073741824&&(en(e),e.subtreeFlags&6&&(e.flags|=8192)):en(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function Z8(t,e){switch(Yp(e),e.tag){case 1:return Cn(e.type)&&Sc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Mo(),nt(bn),nt(rn),ng(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return tg(e),null;case 13:if(nt(dt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));No()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return nt(dt),null;case 4:return Mo(),null;case 10:return Zp(e.type._context),null;case 22:case 23:return hg(),null;case 24:return null;default:return null}}var Du=!1,nn=!1,q8=typeof WeakSet=="function"?WeakSet:Set,xe=null;function mo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){mt(t,e,r)}else n.current=null}function ep(t,e,n){try{n()}catch(r){mt(t,e,r)}}var Cy=!1;function J8(t,e){if(O0=yc,t=r3(),$p(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var l=0,c=-1,u=-1,f=0,p=0,m=t,w=null;t:for(;;){for(var y;m!==n||i!==0&&m.nodeType!==3||(c=l+i),m!==s||r!==0&&m.nodeType!==3||(u=l+r),m.nodeType===3&&(l+=m.nodeValue.length),(y=m.firstChild)!==null;)w=m,m=y;for(;;){if(m===t)break t;if(w===n&&++f===i&&(c=l),w===s&&++p===r&&(u=l),(y=m.nextSibling)!==null)break;m=w,w=m.parentNode}m=y}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(D0={focusedElem:t,selectionRange:n},yc=!1,xe=e;xe!==null;)if(e=xe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,xe=t;else for(;xe!==null;){e=xe;try{var x=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var b=x.memoizedProps,_=x.memoizedState,S=e.stateNode,T=S.getSnapshotBeforeUpdate(e.elementType===e.type?b:cr(e.type,b),_);S.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var h=e.stateNode.containerInfo;h.nodeType===1?h.textContent="":h.nodeType===9&&h.documentElement&&h.removeChild(h.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch(k){mt(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,xe=t;break}xe=e.return}return x=Cy,Cy=!1,x}function Wa(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&ep(e,n,s)}i=i.next}while(i!==r)}}function nd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function tp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function J3(t){var e=t.alternate;e!==null&&(t.alternate=null,J3(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Rr],delete e[al],delete e[U0],delete e[j8],delete e[F8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function e5(t){return t.tag===5||t.tag===3||t.tag===4}function Ty(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||e5(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function np(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=wc));else if(r!==4&&(t=t.child,t!==null))for(np(t,e,n),t=t.sibling;t!==null;)np(t,e,n),t=t.sibling}function rp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(rp(t,e,n),t=t.sibling;t!==null;)rp(t,e,n),t=t.sibling}var Gt=null,dr=!1;function Ti(t,e,n){for(n=n.child;n!==null;)t5(t,e,n),n=n.sibling}function t5(t,e,n){if(Fr&&typeof Fr.onCommitFiberUnmount=="function")try{Fr.onCommitFiberUnmount(Xc,n)}catch{}switch(n.tag){case 5:nn||mo(n,e);case 6:var r=Gt,i=dr;Gt=null,Ti(t,e,n),Gt=r,dr=i,Gt!==null&&(dr?(t=Gt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Gt.removeChild(n.stateNode));break;case 18:Gt!==null&&(dr?(t=Gt,n=n.stateNode,t.nodeType===8?Ih(t.parentNode,n):t.nodeType===1&&Ih(t,n),nl(t)):Ih(Gt,n.stateNode));break;case 4:r=Gt,i=dr,Gt=n.stateNode.containerInfo,dr=!0,Ti(t,e,n),Gt=r,dr=i;break;case 0:case 11:case 14:case 15:if(!nn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,l=s.destroy;s=s.tag,l!==void 0&&(s&2||s&4)&&ep(n,e,l),i=i.next}while(i!==r)}Ti(t,e,n);break;case 1:if(!nn&&(mo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){mt(n,e,c)}Ti(t,e,n);break;case 21:Ti(t,e,n);break;case 22:n.mode&1?(nn=(r=nn)||n.memoizedState!==null,Ti(t,e,n),nn=r):Ti(t,e,n);break;default:Ti(t,e,n)}}function Ey(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new q8),e.forEach(function(r){var i=lw.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function lr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,l=e,c=l;e:for(;c!==null;){switch(c.tag){case 5:Gt=c.stateNode,dr=!1;break e;case 3:Gt=c.stateNode.containerInfo,dr=!0;break e;case 4:Gt=c.stateNode.containerInfo,dr=!0;break e}c=c.return}if(Gt===null)throw Error(ae(160));t5(s,l,i),Gt=null,dr=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(f){mt(i,e,f)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)n5(e,t),e=e.sibling}function n5(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(lr(e,t),Mr(t),r&4){try{Wa(3,t,t.return),nd(3,t)}catch(b){mt(t,t.return,b)}try{Wa(5,t,t.return)}catch(b){mt(t,t.return,b)}}break;case 1:lr(e,t),Mr(t),r&512&&n!==null&&mo(n,n.return);break;case 5:if(lr(e,t),Mr(t),r&512&&n!==null&&mo(n,n.return),t.flags&32){var i=t.stateNode;try{qa(i,"")}catch(b){mt(t,t.return,b)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,l=n!==null?n.memoizedProps:s,c=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{c==="input"&&s.type==="radio"&&s.name!=null&&bv(i,s),E0(c,l);var f=E0(c,s);for(l=0;l<u.length;l+=2){var p=u[l],m=u[l+1];p==="style"?Pv(i,m):p==="dangerouslySetInnerHTML"?Ev(i,m):p==="children"?qa(i,m):Ip(i,p,m,f)}switch(c){case"input":_0(i,s);break;case"textarea":Cv(i,s);break;case"select":var w=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var y=s.value;y!=null?xo(i,!!s.multiple,y,!1):w!==!!s.multiple&&(s.defaultValue!=null?xo(i,!!s.multiple,s.defaultValue,!0):xo(i,!!s.multiple,s.multiple?[]:"",!1))}i[al]=s}catch(b){mt(t,t.return,b)}}break;case 6:if(lr(e,t),Mr(t),r&4){if(t.stateNode===null)throw Error(ae(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(b){mt(t,t.return,b)}}break;case 3:if(lr(e,t),Mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{nl(e.containerInfo)}catch(b){mt(t,t.return,b)}break;case 4:lr(e,t),Mr(t);break;case 13:lr(e,t),Mr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(dg=St())),r&4&&Ey(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(nn=(f=nn)||p,lr(e,t),nn=f):lr(e,t),Mr(t),r&8192){if(f=t.memoizedState!==null,(t.stateNode.isHidden=f)&&!p&&t.mode&1)for(xe=t,p=t.child;p!==null;){for(m=xe=p;xe!==null;){switch(w=xe,y=w.child,w.tag){case 0:case 11:case 14:case 15:Wa(4,w,w.return);break;case 1:mo(w,w.return);var x=w.stateNode;if(typeof x.componentWillUnmount=="function"){r=w,n=w.return;try{e=r,x.props=e.memoizedProps,x.state=e.memoizedState,x.componentWillUnmount()}catch(b){mt(r,n,b)}}break;case 5:mo(w,w.return);break;case 22:if(w.memoizedState!==null){Py(m);continue}}y!==null?(y.return=w,xe=y):Py(m)}p=p.sibling}e:for(p=null,m=t;;){if(m.tag===5){if(p===null){p=m;try{i=m.stateNode,f?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(c=m.stateNode,u=m.memoizedProps.style,l=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=Nv("display",l))}catch(b){mt(t,t.return,b)}}}else if(m.tag===6){if(p===null)try{m.stateNode.nodeValue=f?"":m.memoizedProps}catch(b){mt(t,t.return,b)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;p===m&&(p=null),m=m.return}p===m&&(p=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:lr(e,t),Mr(t),r&4&&Ey(t);break;case 21:break;default:lr(e,t),Mr(t)}}function Mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(e5(n)){var r=n;break e}n=n.return}throw Error(ae(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(qa(i,""),r.flags&=-33);var s=Ty(t);rp(t,s,i);break;case 3:case 4:var l=r.stateNode.containerInfo,c=Ty(t);np(t,c,l);break;default:throw Error(ae(161))}}catch(u){mt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function ew(t,e,n){xe=t,r5(t)}function r5(t,e,n){for(var r=(t.mode&1)!==0;xe!==null;){var i=xe,s=i.child;if(i.tag===22&&r){var l=i.memoizedState!==null||Du;if(!l){var c=i.alternate,u=c!==null&&c.memoizedState!==null||nn;c=Du;var f=nn;if(Du=l,(nn=u)&&!f)for(xe=i;xe!==null;)l=xe,u=l.child,l.tag===22&&l.memoizedState!==null?My(i):u!==null?(u.return=l,xe=u):My(i);for(;s!==null;)xe=s,r5(s),s=s.sibling;xe=i,Du=c,nn=f}Ny(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,xe=s):Ny(t)}}function Ny(t){for(;xe!==null;){var e=xe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:nn||nd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!nn)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:cr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&fy(e,s,r);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}fy(e,l,n)}break;case 5:var c=e.stateNode;if(n===null&&e.flags&4){n=c;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var f=e.alternate;if(f!==null){var p=f.memoizedState;if(p!==null){var m=p.dehydrated;m!==null&&nl(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}nn||e.flags&512&&tp(e)}catch(w){mt(e,e.return,w)}}if(e===t){xe=null;break}if(n=e.sibling,n!==null){n.return=e.return,xe=n;break}xe=e.return}}function Py(t){for(;xe!==null;){var e=xe;if(e===t){xe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,xe=n;break}xe=e.return}}function My(t){for(;xe!==null;){var e=xe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{nd(4,e)}catch(u){mt(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){mt(e,i,u)}}var s=e.return;try{tp(e)}catch(u){mt(e,s,u)}break;case 5:var l=e.return;try{tp(e)}catch(u){mt(e,l,u)}}}catch(u){mt(e,e.return,u)}if(e===t){xe=null;break}var c=e.sibling;if(c!==null){c.return=e.return,xe=c;break}xe=e.return}}var tw=Math.ceil,Ac=li.ReactCurrentDispatcher,ug=li.ReactCurrentOwner,qn=li.ReactCurrentBatchConfig,ze=0,Ot=null,bt=null,Wt=0,Mn=0,yo=Ki(0),Pt=0,hl=null,Es=0,rd=0,cg=0,$a=null,Sn=null,dg=0,Io=1/0,Zr=null,Ic=!1,ip=null,Ui=null,zu=!1,ji=null,Rc=0,Ha=0,sp=null,rc=-1,ic=0;function ln(){return ze&6?St():rc!==-1?rc:rc=St()}function Gi(t){return t.mode&1?ze&2&&Wt!==0?Wt&-Wt:D8.transition!==null?(ic===0&&(ic=Uv()),ic):(t=He,t!==0||(t=window.event,t=t===void 0?16:Xv(t.type)),t):1}function mr(t,e,n,r){if(50<Ha)throw Ha=0,sp=null,Error(ae(185));Sl(t,n,r),(!(ze&2)||t!==Ot)&&(t===Ot&&(!(ze&2)&&(rd|=n),Pt===4&&Ri(t,Wt)),Tn(t,r),n===1&&ze===0&&!(e.mode&1)&&(Io=St()+500,Jc&&Qi()))}function Tn(t,e){var n=t.callbackNode;D6(t,e);var r=mc(t,t===Ot?Wt:0);if(r===0)n!==null&&z1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&z1(n),e===1)t.tag===0?O8(Ay.bind(null,t)):h3(Ay.bind(null,t)),R8(function(){!(ze&6)&&Qi()}),n=null;else{switch(Gv(r)){case 1:n=Op;break;case 4:n=zv;break;case 16:n=gc;break;case 536870912:n=Bv;break;default:n=gc}n=d5(n,i5.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function i5(t,e){if(rc=-1,ic=0,ze&6)throw Error(ae(327));var n=t.callbackNode;if(bo()&&t.callbackNode!==n)return null;var r=mc(t,t===Ot?Wt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Lc(t,r);else{e=r;var i=ze;ze|=2;var s=o5();(Ot!==t||Wt!==e)&&(Zr=null,Io=St()+500,_s(t,e));do try{iw();break}catch(c){s5(t,c)}while(1);Qp(),Ac.current=s,ze=i,bt!==null?e=0:(Ot=null,Wt=0,e=Pt)}if(e!==0){if(e===2&&(i=I0(t),i!==0&&(r=i,e=op(t,i))),e===1)throw n=hl,_s(t,0),Ri(t,r),Tn(t,St()),n;if(e===6)Ri(t,r);else{if(i=t.current.alternate,!(r&30)&&!nw(i)&&(e=Lc(t,r),e===2&&(s=I0(t),s!==0&&(r=s,e=op(t,s))),e===1))throw n=hl,_s(t,0),Ri(t,r),Tn(t,St()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(ae(345));case 2:ys(t,Sn,Zr);break;case 3:if(Ri(t,r),(r&130023424)===r&&(e=dg+500-St(),10<e)){if(mc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){ln(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=B0(ys.bind(null,t,Sn,Zr),e);break}ys(t,Sn,Zr);break;case 4:if(Ri(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var l=31-gr(r);s=1<<l,l=e[l],l>i&&(i=l),r&=~s}if(r=i,r=St()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*tw(r/1960))-r,10<r){t.timeoutHandle=B0(ys.bind(null,t,Sn,Zr),r);break}ys(t,Sn,Zr);break;case 5:ys(t,Sn,Zr);break;default:throw Error(ae(329))}}}return Tn(t,St()),t.callbackNode===n?i5.bind(null,t):null}function op(t,e){var n=$a;return t.current.memoizedState.isDehydrated&&(_s(t,e).flags|=256),t=Lc(t,e),t!==2&&(e=Sn,Sn=n,e!==null&&ap(e)),t}function ap(t){Sn===null?Sn=t:Sn.push.apply(Sn,t)}function nw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!vr(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ri(t,e){for(e&=~cg,e&=~rd,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-gr(e),r=1<<n;t[n]=-1,e&=~r}}function Ay(t){if(ze&6)throw Error(ae(327));bo();var e=mc(t,0);if(!(e&1))return Tn(t,St()),null;var n=Lc(t,e);if(t.tag!==0&&n===2){var r=I0(t);r!==0&&(e=r,n=op(t,r))}if(n===1)throw n=hl,_s(t,0),Ri(t,e),Tn(t,St()),n;if(n===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ys(t,Sn,Zr),Tn(t,St()),null}function fg(t,e){var n=ze;ze|=1;try{return t(e)}finally{ze=n,ze===0&&(Io=St()+500,Jc&&Qi())}}function Ns(t){ji!==null&&ji.tag===0&&!(ze&6)&&bo();var e=ze;ze|=1;var n=qn.transition,r=He;try{if(qn.transition=null,He=1,t)return t()}finally{He=r,qn.transition=n,ze=e,!(ze&6)&&Qi()}}function hg(){Mn=yo.current,nt(yo)}function _s(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,I8(n)),bt!==null)for(n=bt.return;n!==null;){var r=n;switch(Yp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Sc();break;case 3:Mo(),nt(bn),nt(rn),ng();break;case 5:tg(r);break;case 4:Mo();break;case 13:nt(dt);break;case 19:nt(dt);break;case 10:Zp(r.type._context);break;case 22:case 23:hg()}n=n.return}if(Ot=t,bt=t=Vi(t.current,null),Wt=Mn=e,Pt=0,hl=null,cg=rd=Es=0,Sn=$a=null,ws!==null){for(e=0;e<ws.length;e++)if(n=ws[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var l=s.next;s.next=i,r.next=l}n.pending=r}ws=null}return t}function s5(t,e){do{var n=bt;try{if(Qp(),ec.current=Mc,Pc){for(var r=ft.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Pc=!1}if(Ts=0,Ft=Nt=ft=null,Va=!1,cl=0,ug.current=null,n===null||n.return===null){Pt=1,hl=e,bt=null;break}e:{var s=t,l=n.return,c=n,u=e;if(e=Wt,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var f=u,p=c,m=p.tag;if(!(p.mode&1)&&(m===0||m===11||m===15)){var w=p.alternate;w?(p.updateQueue=w.updateQueue,p.memoizedState=w.memoizedState,p.lanes=w.lanes):(p.updateQueue=null,p.memoizedState=null)}var y=vy(l);if(y!==null){y.flags&=-257,xy(y,l,c,s,e),y.mode&1&&yy(s,f,e),e=y,u=f;var x=e.updateQueue;if(x===null){var b=new Set;b.add(u),e.updateQueue=b}else x.add(u);break e}else{if(!(e&1)){yy(s,f,e),pg();break e}u=Error(ae(426))}}else if(at&&c.mode&1){var _=vy(l);if(_!==null){!(_.flags&65536)&&(_.flags|=256),xy(_,l,c,s,e),Xp(Ao(u,c));break e}}s=u=Ao(u,c),Pt!==4&&(Pt=2),$a===null?$a=[s]:$a.push(s),s=l;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var S=G3(s,u,e);dy(s,S);break e;case 1:c=u;var T=s.type,h=s.stateNode;if(!(s.flags&128)&&(typeof T.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(Ui===null||!Ui.has(h)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=V3(s,c,e);dy(s,k);break e}}s=s.return}while(s!==null)}l5(n)}catch(C){e=C,bt===n&&n!==null&&(bt=n=n.return);continue}break}while(1)}function o5(){var t=Ac.current;return Ac.current=Mc,t===null?Mc:t}function pg(){(Pt===0||Pt===3||Pt===2)&&(Pt=4),Ot===null||!(Es&268435455)&&!(rd&268435455)||Ri(Ot,Wt)}function Lc(t,e){var n=ze;ze|=2;var r=o5();(Ot!==t||Wt!==e)&&(Zr=null,_s(t,e));do try{rw();break}catch(i){s5(t,i)}while(1);if(Qp(),ze=n,Ac.current=r,bt!==null)throw Error(ae(261));return Ot=null,Wt=0,Pt}function rw(){for(;bt!==null;)a5(bt)}function iw(){for(;bt!==null&&!P6();)a5(bt)}function a5(t){var e=c5(t.alternate,t,Mn);t.memoizedProps=t.pendingProps,e===null?l5(t):bt=e,ug.current=null}function l5(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Z8(n,e),n!==null){n.flags&=32767,bt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pt=6,bt=null;return}}else if(n=Q8(n,e,Mn),n!==null){bt=n;return}if(e=e.sibling,e!==null){bt=e;return}bt=e=t}while(e!==null);Pt===0&&(Pt=5)}function ys(t,e,n){var r=He,i=qn.transition;try{qn.transition=null,He=1,sw(t,e,n,r)}finally{qn.transition=i,He=r}return null}function sw(t,e,n,r){do bo();while(ji!==null);if(ze&6)throw Error(ae(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(z6(t,s),t===Ot&&(bt=Ot=null,Wt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||zu||(zu=!0,d5(gc,function(){return bo(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=qn.transition,qn.transition=null;var l=He;He=1;var c=ze;ze|=4,ug.current=null,J8(t,n),n5(n,t),C8(D0),yc=!!O0,D0=O0=null,t.current=n,ew(n),M6(),ze=c,He=l,qn.transition=s}else t.current=n;if(zu&&(zu=!1,ji=t,Rc=i),s=t.pendingLanes,s===0&&(Ui=null),R6(n.stateNode),Tn(t,St()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ic)throw Ic=!1,t=ip,ip=null,t;return Rc&1&&t.tag!==0&&bo(),s=t.pendingLanes,s&1?t===sp?Ha++:(Ha=0,sp=t):Ha=0,Qi(),null}function bo(){if(ji!==null){var t=Gv(Rc),e=qn.transition,n=He;try{if(qn.transition=null,He=16>t?16:t,ji===null)var r=!1;else{if(t=ji,ji=null,Rc=0,ze&6)throw Error(ae(331));var i=ze;for(ze|=4,xe=t.current;xe!==null;){var s=xe,l=s.child;if(xe.flags&16){var c=s.deletions;if(c!==null){for(var u=0;u<c.length;u++){var f=c[u];for(xe=f;xe!==null;){var p=xe;switch(p.tag){case 0:case 11:case 15:Wa(8,p,s)}var m=p.child;if(m!==null)m.return=p,xe=m;else for(;xe!==null;){p=xe;var w=p.sibling,y=p.return;if(J3(p),p===f){xe=null;break}if(w!==null){w.return=y,xe=w;break}xe=y}}}var x=s.alternate;if(x!==null){var b=x.child;if(b!==null){x.child=null;do{var _=b.sibling;b.sibling=null,b=_}while(b!==null)}}xe=s}}if(s.subtreeFlags&2064&&l!==null)l.return=s,xe=l;else e:for(;xe!==null;){if(s=xe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Wa(9,s,s.return)}var S=s.sibling;if(S!==null){S.return=s.return,xe=S;break e}xe=s.return}}var T=t.current;for(xe=T;xe!==null;){l=xe;var h=l.child;if(l.subtreeFlags&2064&&h!==null)h.return=l,xe=h;else e:for(l=T;xe!==null;){if(c=xe,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:nd(9,c)}}catch(C){mt(c,c.return,C)}if(c===l){xe=null;break e}var k=c.sibling;if(k!==null){k.return=c.return,xe=k;break e}xe=c.return}}if(ze=i,Qi(),Fr&&typeof Fr.onPostCommitFiberRoot=="function")try{Fr.onPostCommitFiberRoot(Xc,t)}catch{}r=!0}return r}finally{He=n,qn.transition=e}}return!1}function Iy(t,e,n){e=Ao(n,e),e=G3(t,e,1),t=Bi(t,e,1),e=ln(),t!==null&&(Sl(t,1,e),Tn(t,e))}function mt(t,e,n){if(t.tag===3)Iy(t,t,n);else for(;e!==null;){if(e.tag===3){Iy(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ui===null||!Ui.has(r))){t=Ao(n,t),t=V3(e,t,1),e=Bi(e,t,1),t=ln(),e!==null&&(Sl(e,1,t),Tn(e,t));break}}e=e.return}}function ow(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=ln(),t.pingedLanes|=t.suspendedLanes&n,Ot===t&&(Wt&n)===n&&(Pt===4||Pt===3&&(Wt&130023424)===Wt&&500>St()-dg?_s(t,0):cg|=n),Tn(t,e)}function u5(t,e){e===0&&(t.mode&1?(e=Pu,Pu<<=1,!(Pu&130023424)&&(Pu=4194304)):e=1);var n=ln();t=oi(t,e),t!==null&&(Sl(t,e,n),Tn(t,n))}function aw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),u5(t,n)}function lw(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ae(314))}r!==null&&r.delete(e),u5(t,n)}var c5;c5=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||bn.current)_n=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return _n=!1,K8(t,e,n);_n=!!(t.flags&131072)}else _n=!1,at&&e.flags&1048576&&p3(e,bc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;nc(t,e),t=e.pendingProps;var i=Eo(e,rn.current);ko(e,n),i=ig(null,e,r,t,i,n);var s=sg();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Cn(r)?(s=!0,_c(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Jp(e),i.updater=td,e.stateNode=i,i._reactInternals=e,Y0(e,r,t,n),e=Q0(null,e,r,!0,s,n)):(e.tag=0,at&&s&&Hp(e),an(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(nc(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=cw(r),t=cr(r,t),i){case 0:e=K0(null,e,r,t,n);break e;case 1:e=_y(null,e,r,t,n);break e;case 11:e=wy(null,e,r,t,n);break e;case 14:e=Sy(null,e,r,cr(r.type,t),n);break e}throw Error(ae(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:cr(r,i),K0(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:cr(r,i),_y(t,e,r,i,n);case 3:e:{if(Y3(e),t===null)throw Error(ae(387));r=e.pendingProps,s=e.memoizedState,i=s.element,w3(t,e),Ec(e,r,null,n);var l=e.memoizedState;if(r=l.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ao(Error(ae(423)),e),e=ky(t,e,r,n,i);break e}else if(r!==i){i=Ao(Error(ae(424)),e),e=ky(t,e,r,n,i);break e}else for(An=zi(e.stateNode.containerInfo.firstChild),In=e,at=!0,fr=null,n=v3(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(No(),r===i){e=ai(t,e,n);break e}an(t,e,r,n)}e=e.child}return e;case 5:return S3(e),t===null&&W0(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,l=i.children,z0(r,i)?l=null:s!==null&&z0(r,s)&&(e.flags|=32),H3(t,e),an(t,e,l,n),e.child;case 6:return t===null&&W0(e),null;case 13:return X3(t,e,n);case 4:return eg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Po(e,null,r,n):an(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:cr(r,i),wy(t,e,r,i,n);case 7:return an(t,e,e.pendingProps,n),e.child;case 8:return an(t,e,e.pendingProps.children,n),e.child;case 12:return an(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,l=i.value,Ze(Cc,r._currentValue),r._currentValue=l,s!==null)if(vr(s.value,l)){if(s.children===i.children&&!bn.current){e=ai(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var c=s.dependencies;if(c!==null){l=s.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(s.tag===1){u=ti(-1,n&-n),u.tag=2;var f=s.updateQueue;if(f!==null){f=f.shared;var p=f.pending;p===null?u.next=u:(u.next=p.next,p.next=u),f.pending=u}}s.lanes|=n,u=s.alternate,u!==null&&(u.lanes|=n),$0(s.return,n,e),c.lanes|=n;break}u=u.next}}else if(s.tag===10)l=s.type===e.type?null:s.child;else if(s.tag===18){if(l=s.return,l===null)throw Error(ae(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),$0(l,n,e),l=s.sibling}else l=s.child;if(l!==null)l.return=s;else for(l=s;l!==null;){if(l===e){l=null;break}if(s=l.sibling,s!==null){s.return=l.return,l=s;break}l=l.return}s=l}an(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ko(e,n),i=Jn(i),r=r(i),e.flags|=1,an(t,e,r,n),e.child;case 14:return r=e.type,i=cr(r,e.pendingProps),i=cr(r.type,i),Sy(t,e,r,i,n);case 15:return W3(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:cr(r,i),nc(t,e),e.tag=1,Cn(r)?(t=!0,_c(e)):t=!1,ko(e,n),U3(e,r,i),Y0(e,r,i,n),Q0(null,e,r,!0,t,n);case 19:return K3(t,e,n);case 22:return $3(t,e,n)}throw Error(ae(156,e.tag))};function d5(t,e){return Dv(t,e)}function uw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zn(t,e,n,r){return new uw(t,e,n,r)}function gg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function cw(t){if(typeof t=="function")return gg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Lp)return 11;if(t===jp)return 14}return 2}function Vi(t,e){var n=t.alternate;return n===null?(n=Zn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function sc(t,e,n,r,i,s){var l=2;if(r=t,typeof t=="function")gg(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case oo:return ks(n.children,i,s,e);case Rp:l=8,i|=8;break;case y0:return t=Zn(12,n,e,i|2),t.elementType=y0,t.lanes=s,t;case v0:return t=Zn(13,n,e,i),t.elementType=v0,t.lanes=s,t;case x0:return t=Zn(19,n,e,i),t.elementType=x0,t.lanes=s,t;case Sv:return id(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case xv:l=10;break e;case wv:l=9;break e;case Lp:l=11;break e;case jp:l=14;break e;case Pi:l=16,r=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=Zn(l,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function ks(t,e,n,r){return t=Zn(7,t,r,e),t.lanes=n,t}function id(t,e,n,r){return t=Zn(22,t,r,e),t.elementType=Sv,t.lanes=n,t.stateNode={isHidden:!1},t}function Bh(t,e,n){return t=Zn(6,t,null,e),t.lanes=n,t}function Uh(t,e,n){return e=Zn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function dw(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Sh(0),this.expirationTimes=Sh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Sh(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function mg(t,e,n,r,i,s,l,c,u){return t=new dw(t,e,n,c,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Zn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jp(s),t}function fw(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:so,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function f5(t){if(!t)return Hi;t=t._reactInternals;e:{if(Ms(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Cn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var n=t.type;if(Cn(n))return f3(t,n,e)}return e}function h5(t,e,n,r,i,s,l,c,u){return t=mg(n,r,!0,t,i,s,l,c,u),t.context=f5(null),n=t.current,r=ln(),i=Gi(n),s=ti(r,i),s.callback=e??null,Bi(n,s,i),t.current.lanes=i,Sl(t,i,r),Tn(t,r),t}function sd(t,e,n,r){var i=e.current,s=ln(),l=Gi(i);return n=f5(n),e.context===null?e.context=n:e.pendingContext=n,e=ti(s,l),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Bi(i,e,l),t!==null&&(mr(t,i,l,s),Ju(t,i,l)),l}function jc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ry(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function yg(t,e){Ry(t,e),(t=t.alternate)&&Ry(t,e)}function hw(){return null}var p5=typeof reportError=="function"?reportError:function(t){console.error(t)};function vg(t){this._internalRoot=t}od.prototype.render=vg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));sd(t,e,null,null)};od.prototype.unmount=vg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ns(function(){sd(null,t,null,null)}),e[si]=null}};function od(t){this._internalRoot=t}od.prototype.unstable_scheduleHydration=function(t){if(t){var e=$v();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ii.length&&e!==0&&e<Ii[n].priority;n++);Ii.splice(n,0,t),n===0&&Yv(t)}};function xg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ad(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ly(){}function pw(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var f=jc(l);s.call(f)}}var l=h5(e,r,t,0,null,!1,!1,"",Ly);return t._reactRootContainer=l,t[si]=l.current,sl(t.nodeType===8?t.parentNode:t),Ns(),l}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var c=r;r=function(){var f=jc(u);c.call(f)}}var u=mg(t,0,!1,null,null,!1,!1,"",Ly);return t._reactRootContainer=u,t[si]=u.current,sl(t.nodeType===8?t.parentNode:t),Ns(function(){sd(e,u,n,r)}),u}function ld(t,e,n,r,i){var s=n._reactRootContainer;if(s){var l=s;if(typeof i=="function"){var c=i;i=function(){var u=jc(l);c.call(u)}}sd(e,l,t,i)}else l=pw(n,e,t,i,r);return jc(l)}Vv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=La(e.pendingLanes);n!==0&&(Dp(e,n|1),Tn(e,St()),!(ze&6)&&(Io=St()+500,Qi()))}break;case 13:Ns(function(){var r=oi(t,1);if(r!==null){var i=ln();mr(r,t,1,i)}}),yg(t,1)}};zp=function(t){if(t.tag===13){var e=oi(t,134217728);if(e!==null){var n=ln();mr(e,t,134217728,n)}yg(t,134217728)}};Wv=function(t){if(t.tag===13){var e=Gi(t),n=oi(t,e);if(n!==null){var r=ln();mr(n,t,e,r)}yg(t,e)}};$v=function(){return He};Hv=function(t,e){var n=He;try{return He=t,e()}finally{He=n}};P0=function(t,e,n){switch(e){case"input":if(_0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=qc(r);if(!i)throw Error(ae(90));kv(r),_0(r,i)}}}break;case"textarea":Cv(t,n);break;case"select":e=n.value,e!=null&&xo(t,!!n.multiple,e,!1)}};Iv=fg;Rv=Ns;var gw={usingClientEntryPoint:!1,Events:[kl,co,qc,Mv,Av,fg]},ka={findFiberByHostInstance:xs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mw={bundleType:ka.bundleType,version:ka.version,rendererPackageName:ka.rendererPackageName,rendererConfig:ka.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:li.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Fv(t),t===null?null:t.stateNode},findFiberByHostInstance:ka.findFiberByHostInstance||hw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bu.isDisabled&&Bu.supportsFiber)try{Xc=Bu.inject(mw),Fr=Bu}catch{}}Ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gw;Ln.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xg(e))throw Error(ae(200));return fw(t,e,null,n)};Ln.createRoot=function(t,e){if(!xg(t))throw Error(ae(299));var n=!1,r="",i=p5;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=mg(t,1,!1,null,null,n,!1,r,i),t[si]=e.current,sl(t.nodeType===8?t.parentNode:t),new vg(e)};Ln.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=Fv(e),t=t===null?null:t.stateNode,t};Ln.flushSync=function(t){return Ns(t)};Ln.hydrate=function(t,e,n){if(!ad(e))throw Error(ae(200));return ld(null,t,e,!0,n)};Ln.hydrateRoot=function(t,e,n){if(!xg(t))throw Error(ae(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",l=p5;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=h5(e,null,t,1,n??null,i,!1,s,l),t[si]=e.current,sl(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new od(e)};Ln.render=function(t,e,n){if(!ad(e))throw Error(ae(200));return ld(null,t,e,!1,n)};Ln.unmountComponentAtNode=function(t){if(!ad(t))throw Error(ae(40));return t._reactRootContainer?(Ns(function(){ld(null,null,t,!1,function(){t._reactRootContainer=null,t[si]=null})}),!0):!1};Ln.unstable_batchedUpdates=fg;Ln.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ad(n))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return ld(t,e,n,!1,r)};Ln.version="18.3.1-next-f1338f8080-20240426";function g5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(g5)}catch(t){console.error(t)}}g5(),gv.exports=Ln;var yw=gv.exports,jy=yw;g0.createRoot=jy.createRoot,g0.hydrateRoot=jy.hydrateRoot;const Fy=({isLoading:t,onSave:e,onSaveAs:n,canSaveAs:r,onLoad:i,onClear:s,buttonStyle:l})=>E.jsxs("div",{className:"flex flex-wrap gap-2",children:[E.jsx("button",{style:{...l(!1),opacity:t?.5:1},onClick:e,disabled:t,title:"Save as PNML",children:"Save"}),E.jsx("button",{style:{...l(!1),opacity:t||!r?.5:1},onClick:n,disabled:t||!r,title:"Save As (choose location and filename)",children:"Save as"}),E.jsx("button",{style:{...l(!1),opacity:t?.5:1},onClick:i,disabled:t,title:"Load PNML file",children:"Load"}),E.jsx("button",{style:{...l(!1)},onClick:s,title:"Clear canvas",children:"Clear"})]}),vw=({mode:t,setMode:e,buttonStyle:n})=>E.jsxs("div",{className:"flex flex-wrap gap-2",children:[E.jsx("button",{style:{...n(t==="select")},"data-testid":"toolbar-select",onClick:()=>{t!=="select"&&e("select")},children:"Select"}),E.jsx("button",{style:n(t==="place"),"data-testid":"toolbar-place",onClick:()=>{t!=="place"&&e("place")},children:"Place"}),E.jsx("button",{style:n(t==="transition"),"data-testid":"toolbar-transition",onClick:()=>{t!=="transition"&&e("transition")},children:"Transition"}),E.jsx("button",{style:n(t==="arc"),"data-testid":"toolbar-arc",onClick:()=>{t!=="arc"&&e("arc")},children:"Arc"})]}),xw=({canUndo:t,canRedo:e,onUndo:n,onRedo:r,buttonStyle:i})=>E.jsxs("div",{className:"flex flex-wrap gap-2",children:[E.jsx("button",{style:{...i(!1),opacity:t?1:.5},onClick:n,disabled:!t,title:"Undo (Ctrl+Z)",children:"Undo"}),E.jsx("button",{style:{...i(!1),opacity:e?1:.5},onClick:r,disabled:!e,title:"Redo (Ctrl+Y)",children:"Redo"})]}),Oy=({onOpenSettings:t,buttonStyle:e})=>E.jsx("div",{className:"flex flex-wrap gap-2",children:E.jsx("button",{style:e(!1),onClick:t,title:"Simulation Settings","data-testid":"toolbar-settings",children:"Settings"})});function Gh(t){const e={types:[]};try{const r=new DOMParser().parseFromString(t,"application/xml"),i=r.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Invalid XML");const l=Array.from(r.getElementsByTagName("*")).filter(f=>f.localName==="algebraicDataTypes")[0];if(!l)return e;const u=Array.from(l.childNodes).filter(f=>f.nodeType===1).filter(f=>f.localName==="type");for(const f of u){const p=f.getAttribute("name")||"",w=Array.from(f.childNodes).filter(_=>_.nodeType===1&&_.localName==="operation").map(_=>{const T=Array.from(_.childNodes).filter(h=>h.nodeType===1&&h.localName==="param").map(h=>({index:Number(h.getAttribute("index")||"0"),type:h.getAttribute("type")||""}));return{name:_.getAttribute("name")||"",arity:Number(_.getAttribute("arity")||"0"),result:_.getAttribute("result")||"",params:T}}),y=Array.from(f.childNodes).find(_=>_.nodeType===1&&_.localName==="axioms"),b=(y?Array.from(y.childNodes).filter(_=>_.nodeType===1&&_.localName==="axiom"):[]).map(_=>({name:_.getAttribute("name")||"",equation:(_.textContent||"").trim()}));e.types.push({name:p,operations:w,axioms:b})}return e}catch(n){return console.error("Error parsing ADT XML:",n),e}}function ww(t){const e=[],n=new Set;for(const r of t.types||[]){r.name||e.push("Type missing name"),n.has(r.name)&&e.push(`Duplicate type: ${r.name}`),n.add(r.name);for(const i of r.operations||[])i.name||e.push(`Operation missing name in type ${r.name}`),(!Number.isInteger(i.arity)||i.arity<0)&&e.push(`Invalid arity for ${r.name}.${i.name}`),i.result||e.push(`Operation ${r.name}.${i.name} missing result type`);for(const i of r.axioms||[])(!i.equation||!i.equation.includes("="))&&e.push(`Axiom in ${r.name} must be an equation with '='`)}return{valid:e.length===0,errors:e}}const Sw=`<?xml version="1.0"?>
<algebraicDataTypes xmlns="http://example.org/apn-adt">
  <type name="Int">
    <operation name="+" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="-" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="*" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&lt;" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&lt;=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&gt;" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&gt;=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <axioms>
      <axiom name="commutativity">x + y = y + x</axiom>
      <axiom name="associativity">(x + y) + z = x + (y + z)</axiom>
      <axiom name="multiplication_commutativity">x * y = y * x</axiom>
      <axiom name="multiplication_associativity">(x * y) * z = x * (y * z)</axiom>
      <axiom name="distributivity">x * (y + z) = (x * y) + (x * z)</axiom>
    </axioms>
  </type>
  <type name="Bool">
    <operation name="and" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="or" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="not" arity="1" result="Bool">
      <param index="0" type="Bool"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <axioms>
      <axiom name="and_commutativity">x and y = y and x</axiom>
      <axiom name="and_associativity">(x and y) and z = x and (y and z)</axiom>
      <axiom name="or_commutativity">x or y = y or x</axiom>
      <axiom name="or_associativity">(x or y) or z = x or (y or z)</axiom>
      <axiom name="de_morgan_and">not (x and y) = (not x) or (not y)</axiom>
      <axiom name="de_morgan_or">not (x or y) = (not x) and (not y)</axiom>
      <axiom name="double_negation">not (not x) = x</axiom>
    </axioms>
  </type>
  <type name="Pair">
    <operation name="fst" arity="1" result="Any">
      <param index="0" type="Pair"/>
    </operation>
    <operation name="snd" arity="1" result="Any">
      <param index="0" type="Pair"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Pair"/>
      <param index="1" type="Pair"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Pair"/>
      <param index="1" type="Pair"/>
    </operation>
    <axioms>
      <axiom name="pair_equality">(x, y) == (a, b) = (x == a) and (y == b)</axiom>
      <axiom name="fst_projection">fst((x, y)) = x</axiom>
      <axiom name="snd_projection">snd((x, y)) = y</axiom>
    </axioms>
  </type>
  <type name="String">
    <operation name="concat" arity="2" result="String">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="substring" arity="3" result="String">
      <param index="0" type="String"/>
      <param index="1" type="Int"/>
      <param index="2" type="Int"/>
    </operation>
    <operation name="isSubstringOf" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="length" arity="1" result="Int">
      <param index="0" type="String"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <axioms>
      <axiom name="concat_associativity">concat(concat(x, y), z) = concat(x, concat(y, z))</axiom>
      <axiom name="concat_empty_left">concat('', x) = x</axiom>
      <axiom name="concat_empty_right">concat(x, '') = x</axiom>
      <axiom name="substring_bounds">substring(x, 0, length(x)) = x</axiom>
      <axiom name="length_concat">length(concat(x, y)) = length(x) + length(y)</axiom>
    </axioms>
  </type>
  <type name="List">
    <operation name="length" arity="1" result="Int">
      <param index="0" type="List"/>
    </operation>
    <operation name="concat" arity="2" result="List">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="head" arity="1" result="Any">
      <param index="0" type="List"/>
    </operation>
    <operation name="tail" arity="1" result="List">
      <param index="0" type="List"/>
    </operation>
    <operation name="append" arity="2" result="List">
      <param index="0" type="List"/>
      <param index="1" type="Any"/>
    </operation>
    <operation name="sublist" arity="3" result="List">
      <param index="0" type="List"/>
      <param index="1" type="Int"/>
      <param index="2" type="Int"/>
    </operation>
    <operation name="isSublistOf" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <axioms>
      <axiom name="length_empty">length([]) = 0</axiom>
      <axiom name="concat_empty_left">concat([], x) = x</axiom>
      <axiom name="concat_empty_right">concat(x, []) = x</axiom>
      <axiom name="head_cons">head([h | t]) = h</axiom>
      <axiom name="tail_cons">tail([h | t]) = t</axiom>
      <axiom name="length_concat">length(concat(x, y)) = length(x) + length(y)</axiom>
    </axioms>
  </type>
</algebraicDataTypes>`,m5=O.createContext(null);function _w({children:t}){const e=O.useMemo(()=>Gh(Sw),[]),[n,r]=O.useState([]),i=O.useMemo(()=>{const p=new Map;for(const m of e.types||[])p.set(m.name,{...m,__readonly:!0});for(const m of n){const w=Gh(m);for(const y of w.types||[])p.has(y.name)||p.set(y.name,{...y,__readonly:!1})}return p},[e,n]),s=O.useCallback(()=>Array.from(i.keys()),[i]),l=O.useCallback(p=>i.get(p)||null,[i]),c=O.useCallback(p=>{const m=Gh(p),w=ww(m);if(!w.valid)return{ok:!1,errors:w.errors};for(const y of m.types||[])if(i.has(y.name))return{ok:!1,errors:[`Duplicate type: ${y.name}`]};return r(y=>[...y,p]),{ok:!0}},[i]),u=O.useCallback(()=>n.join(`
`),[n]),f=O.useMemo(()=>({listTypes:s,getType:l,registerCustomADTXml:c,exportCustomADTXml:u,baseReadOnly:!0,addOrReplaceCustomADT:p=>c(p),clearCustomADTs:()=>r([])}),[s,l,c,u]);return E.jsx(m5.Provider,{value:f,children:t})}function kw(){const t=O.useContext(m5);if(!t)throw new Error("useAdtRegistry must be used within AdtProvider");return t}function Vt(t){if(typeof t!="string")throw new Error("Expression must be a string");const e=t.trim();let n=0;function r(_){return _>="0"&&_<="9"}function i(){for(;n<e.length&&/\s/.test(e[n]);)n++}function s(){i();let _=n;for(;n<e.length&&r(e[n]);)n++;if(_===n)throw new Error(`Expected int at position ${n}`);const S=e.slice(_,n);return{type:"int",value:parseInt(S,10)}}function l(_){return/[A-Za-z_]/.test(_)}function c(_){return/[A-Za-z0-9_]/.test(_)}function u(){if(i(),e[n]!=="'")throw new Error(`Expected string literal at position ${n}`);n++;let _="";for(;n<e.length&&e[n]!=="'";){if(e[n]==="\\"&&n+1<e.length){n++;const S=e[n];S==="n"?_+=`
`:S==="t"?_+="	":S==="r"?_+="\r":S==="\\"?_+="\\":S==="'"?_+="'":_+=S}else _+=e[n];n++}if(n>=e.length)throw new Error("Unterminated string literal");return n++,{type:"string",value:_}}function f(){i();let _=n;if(!l(e[n]))throw new Error(`Expected identifier at position ${n}`);for(n++;n<e.length&&c(e[n]);)n++;const S=e.slice(_,n);if(S&&/^[A-Z]/.test(S))throw new Error(`Variable names must start with lowercase letter, got '${S}' (use 't' instead of 'T', 'f' instead of 'F')`);if(i(),e[n]==="("){n++;const h=[];if(i(),e[n]!==")")do if(i(),h.push(y()),i(),e[n]===",")n++;else break;while(n<e.length);if(i(),e[n]!==")")throw new Error(`Expected ')' after function arguments at position ${n}`);return n++,{type:"funcall",name:S,args:h}}const T=n;if(i(),e[n]===":"){n++,i();const h=n;for(;n<e.length&&/[A-Za-z]/.test(e[n]);)n++;const k=e.slice(h,n).toLowerCase();return k==="int"||k==="bool"||k==="pair"||k==="string"||k==="list"?{type:"var",name:S,varType:k}:(n=T,{type:"var",name:S})}return{type:"var",name:S}}function p(){if(i(),e[n]!=="[")throw new Error(`Expected '[' at position ${n}`);n++;const _=[];if(i(),e[n]==="]")return n++,{type:"list",elements:[]};for(;n<e.length;){if(i(),_.push(y()),i(),e[n]==="]")return n++,{type:"list",elements:_};if(e[n]===","){n++;continue}throw new Error(`Expected ',' or ']' at position ${n}`)}throw new Error("Unterminated list literal")}function m(){if(i(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);if(e[n]==="("){n++,i();const _=y();if(i(),e[n]===","){n++;const S=y();if(i(),n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,{type:"pair",fst:_,snd:S}}if(n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,_}if(e[n]==="[")return p();if(e[n]==="'")return u();if(r(e[n]))return s();if(/[A-Za-z_]/.test(e[n]))return f();throw new Error(`Unexpected character '${e[n]}' at position ${n}`)}function w(){let _=m();for(i();n<e.length&&(e[n]==="*"||e[n]==="/");){const S=e[n++],T=m();_={type:"binop",op:S,left:_,right:T},i()}return _}function y(){let _=w();for(i();n<e.length&&(e[n]==="+"||e[n]==="-");){const S=e[n++],T=w();_={type:"binop",op:S,left:_,right:T},i()}return _}let x=y();if(i(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);function b(_){return!_||typeof _!="object"||(_.type==="bin"&&(_.type="binop"),_.left&&(_.left=b(_.left)),_.right&&(_.right=b(_.right)),Array.isArray(_.args)&&(_.args=_.args.map(b)),Array.isArray(_.elements)&&(_.elements=_.elements.map(b))),_}return x=b(x),x}function y5(t){if(typeof t!="string")throw new Error("Pattern must be a string");const e=t.trim();let n=0;function r(){for(;n<e.length&&/\s/.test(e[n]);)n++}function i(){if(r(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);if(e.slice(n,n+1)==="T")return n++,{type:"boolLit",value:!0};if(e.slice(n,n+1)==="F")return n++,{type:"boolLit",value:!1};if(e.slice(n,n+4)==="true")return n+=4,{type:"boolLit",value:!0};if(e.slice(n,n+5)==="false")return n+=5,{type:"boolLit",value:!1};if(/[0-9]/.test(e[n])){let l=n;for(;n<e.length&&/[0-9]/.test(e[n]);)n++;return{type:"int",value:parseInt(e.slice(l,n),10)}}if(e[n]==="["){n++,r();const l=[];for(;n<e.length&&e[n]!=="]";)l.push(i()),r(),e[n]===","&&(n++,r());if(n>=e.length||e[n]!=="]")throw new Error(`Expected ']' at position ${n}`);return n++,{type:"listPattern",elements:l}}if(/[a-zA-Z_]/.test(e[n])){let l=n;for(;n<e.length&&/[a-zA-Z0-9_]/.test(e[n]);)n++;const c=e.slice(l,n);if(r(),e[n]===":"){n++,r();let u=n;for(;n<e.length&&/[a-zA-Z]/.test(e[n]);)n++;const f=e.slice(u,n).toLowerCase();if(f==="int"||f==="bool"||f==="pair"||f==="string"||f==="list")return{type:"var",name:c,varType:f};throw new Error(`Unknown type '${f}' at position ${u}`)}return{type:"var",name:c}}if(e[n]==="("){n++,r();const l=[];for(;n<e.length&&e[n]!==")";)l.push(i()),r(),n<e.length&&e[n]===","&&(n++,r());if(n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,l.length===2?{type:"pairPattern",fst:l[0],snd:l[1]}:{type:"tuplePattern",elements:l}}throw new Error(`Unexpected character '${e[n]}' at position ${n}`)}const s=i();if(r(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);return s}function Dy(t,e){const n=new Map;function r(s,l){switch(s.type){case"int":return!(typeof l!="number"||l!==s.value);case"boolLit":return!(typeof l!="boolean"||l!==s.value);case"var":if(s.varType){const c=s.varType;if(c==="int"&&typeof l!="number"||c==="bool"&&typeof l!="boolean"||c==="string"&&typeof l!="string"||c==="list"&&!Array.isArray(l)||c==="pair"&&(!l||typeof l!="object"||!l.__pair__))return!1}if(n.has(s.name)){if(n.get(s.name)!==l)return!1}else n.set(s.name,l);return!0;case"pairPattern":return!(!l||typeof l!="object"||!l.__pair__||!r(s.fst,l.fst)||!r(s.snd,l.snd));case"tuplePattern":if(!Array.isArray(l)||l.length!==s.elements.length)return!1;for(let c=0;c<s.elements.length;c++)if(!r(s.elements[c],l[c]))return!1;return!0;case"listPattern":if(!Array.isArray(l)||l.length!==s.elements.length)return!1;for(let c=0;c<s.elements.length;c++)if(!r(s.elements[c],l[c]))return!1;return!0;default:return!1}}return r(t,e)?Object.fromEntries(n):null}function zy(t,e=20){if(!t)return[];if(Array.isArray(t.valueTokens))return t.valueTokens.slice(0,e);const n=Number(t.tokens||0);return Number.isFinite(n)&&n>0?Array.from({length:Math.min(n,e)},()=>1):[]}function v5(t){return t.replace(/:int\b/g,":Int").replace(/:bool\b/g,":Bool").replace(/:pair\b/g,":Pair").replace(/:string\b/g,":String").replace(/:list\b/g,":List")}function pl(t){return typeof t=="number"?"Int":typeof t=="boolean"?"Bool":typeof t=="string"?"String":Array.isArray(t)?"List":t&&typeof t=="object"&&t.__pair__?"Pair":"Int"}function oc(t,e,n=null,r={}){if(!t||(!e||e.size===0)&&!n)return t;let i=t;const{overwrite:s=!1}=r||{},l=t.match(/\b[a-z][a-zA-Z0-9_]*\b/g);return l&&l.forEach(c=>{if(c!=="true"&&c!=="false"&&c!=="and"&&c!=="or"&&c!=="not"){const u=e.get(c)||n;if(!u)return;if(s){const f=new RegExp(`\\b${c}(?::[A-Za-z]+)?\\b`,"g");i=i.replace(f,`${c}:${u}`)}else if(!t.includes(`${c}:`)){const f=new RegExp(`\\b${c}(?!:)\\b`,"g");i=i.replace(f,`${c}:${u}`)}}}),i}const bw="modulepreload",Cw=function(t,e){return new URL(t,e).href},By={},ni=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=Cw(s,r),s in By)return;By[s]=!0;const l=s.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!r)for(let p=i.length-1;p>=0;p--){const m=i[p];if(m.href===s&&(!l||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${c}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":bw,l||(f.as="script",f.crossOrigin=""),f.href=s,document.head.appendChild(f),l)return new Promise((p,m)=>{f.addEventListener("load",p),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s})},lp={silent:0,error:1,warn:2,info:3,debug:4},Tw=(()=>{var r,i,s;const t=typeof globalThis<"u"?globalThis.__PETRI_NET_LOG_LEVEL__:void 0,e=typeof process<"u"?((r=process.env)==null?void 0:r.VITE_LOG_LEVEL)||((i=process.env)==null?void 0:i.LOG_LEVEL):void 0,n=typeof process<"u"&&((s=process.env)==null?void 0:s.NODE_ENV)==="production"?"warn":"debug";return(t||e||n||"warn").toLowerCase()})();function x5(t){if(!t)return"warn";const e=String(t).toLowerCase();return lp[e]!==void 0?e:"warn"}let Ew=x5(Tw);function Uu(t){const e=x5(t);return lp[e]<=lp[Ew]}const we={debug:(...t)=>{Uu("debug")&&console.debug(...t)},info:(...t)=>{Uu("info")&&console.info(...t)},warn:(...t)=>{Uu("warn")&&console.warn(...t)},error:(...t)=>{Uu("error")&&console.error(...t)}};let Vh=null;async function Nw(){if(typeof process<"u"&&process.env&&{}.JEST_WORKER_ID){we.debug("Jest worker detected, skipping Z3 asset fetch");return}if(typeof document>"u"){if(typeof globalThis.initZ3=="function")return;const e=globalThis.Module;try{const r=(()=>{try{const{origin:y,pathname:x}=self.location||{};if(!y)return"";if(typeof x=="string"){const b=x.indexOf("/assets/");if(b!==-1)return`${y}${x.slice(0,b+1)}`;const _=x.lastIndexOf("/"),S=_>=0?x.slice(0,_+1):"/";return`${y}${S}`}return`${y}/`}catch{return""}})(),i=y=>{const x=y.startsWith("/")?y.slice(1):y;return r?`${r}${x}`:`/${x}`},s=i("z3-built.wasm.base64");we.debug("[Z3 worker] fetching WASM base64 from",s);const l=await fetch(s);if(!l.ok)throw new Error(`Failed to fetch WASM base64 from ${s}: ${l.status}`);const u=`data:application/wasm;base64,${await l.text()}`,f={...typeof e=="object"?e:{},locateFile:y=>{if(y.endsWith(".wasm"))return we.debug("[Z3 worker] locateFile",y,"->",`${u.substring(0,50)}...`),u;const x=i(y);return we.debug("[Z3 worker] locateFile",y,"->",x),x}};globalThis.Module=f;const p=i("z3-built.js"),m=await fetch(p);if(!m.ok)throw new Error(`Failed to fetch z3-built.js from ${p}: ${m.status}`);const w=await m.text();if((0,eval)(w),await new Promise(y=>setTimeout(y,20)),typeof globalThis.initZ3!="function")throw new Error("initZ3 not defined after eval");return}catch(n){throw new Error(`Failed to load Z3 in worker: ${n.message}`)}finally{typeof e=="object"?globalThis.Module=e:delete globalThis.Module}}typeof globalThis.initZ3!="function"&&(we.debug("initZ3 not found, loading Z3 built assets..."),await new Promise((e,n)=>{const r=document.createElement("script");r.src="/z3-built.js",r.async=!0,r.addEventListener("load",()=>{typeof globalThis.initZ3=="function"?(we.debug("Z3 built assets loaded successfully"),e()):n(new Error("initZ3 function not found after loading z3-built.js"))}),r.addEventListener("error",i=>{n(new Error(`Failed to load z3-built.js: ${(i==null?void 0:i.message)||i}`))}),document.head.appendChild(r)}))}async function Pw(){return Vh||(Vh=(async()=>{try{we.debug("Initializing Z3 context..."),await Nw();const{init:t}=await ni(()=>import("./browser-9e592af9.js").then(r=>r.b),[],import.meta.url);if(!t)throw new Error("Z3 init function not found. Z3-solver package may not be properly installed.");we.debug("Calling Z3 init...");const e=await t();if(!e)throw new Error("Z3 initialization failed. Check browser console for WASM loading errors.");we.debug("Creating Z3 context...");const n=new e.Context("main");if(!n)throw new Error("Failed to create Z3 context.");return we.debug("Z3 context initialized successfully"),{z3:e,ctx:n}}catch(t){we.error("Z3 initialization error:",t);const e=typeof process<"u"&&process.env&&{}.JEST_WORKER_ID;if(typeof document<"u"&&!e){we.debug("Retrying Z3 initialization with asset loading...");try{typeof globalThis.initZ3!="function"&&(we.debug("initZ3 not found, loading Z3 built assets..."),await new Promise((s,l)=>{const c=document.createElement("script");c.src="/z3-built.js",c.async=!0,c.addEventListener("load",()=>{typeof globalThis.initZ3=="function"?(we.debug("Z3 built assets loaded successfully"),s()):l(new Error("initZ3 function not found after loading z3-built.js"))}),c.addEventListener("error",u=>{l(new Error(`Failed to load z3-built.js: ${(u==null?void 0:u.message)||u}`))}),document.head.appendChild(c)}));const{init:n}=await ni(()=>import("./browser-9e592af9.js").then(s=>s.b),[],import.meta.url),r=await n(),i=new r.Context("main");return we.debug("Z3 context initialized successfully (fallback)"),{z3:r,ctx:i}}catch(n){we.error("Fallback Z3 initialization also failed:",n)}}if(e||typeof document>"u"){we.debug("Retrying Z3 initialization for Node.js...");try{const{init:n}=await ni(()=>import("./browser-9e592af9.js").then(s=>s.b),[],import.meta.url),r=await n(),i=new r.Context("main");return we.debug("Z3 context initialized successfully (Node.js)"),{z3:r,ctx:i}}catch(n){we.error("Node.js Z3 initialization also failed:",n)}}throw new Error(`initZ3 was not imported correctly. Please consult documentation on how to load Z3 in browser. Details: ${t.message}`)}})()),Vh}function ba(t,e=new Set){return t&&(t.type==="var"&&e.add(t.name),t.type==="pair"&&(ba(t.fst,e),ba(t.snd,e)),t.type==="binop"&&(ba(t.left,e),ba(t.right,e)),t.type==="funcall"&&t.args&&t.args.forEach(n=>ba(n,e))),e}function Yn(t,e,n){var s;const{Int:r,String:i}=t;switch(e.type){case"int":return r.val(e.value);case"string":return i.val(e.value);case"pair":const l=Yn(t,e.fst,n),c=Yn(t,e.snd,n);return l.concat(i.val(",")).concat(c);case"var":return n(e.name);case"funcall":{if(e.name==="length"&&e.args&&e.args.length===1&&((s=e.args[0])==null?void 0:s.type)==="string")return r.val((e.args[0].value||"").length);if(e.name==="concat"&&e.args&&e.args.length===2){const u=Yn(t,e.args[0],n),f=Yn(t,e.args[1],n);return u.concat(f)}if(e.name==="substring"&&e.args&&e.args.length===3){const u=Yn(t,e.args[0],n),f=Yn(t,e.args[1],n),p=Yn(t,e.args[2],n);return u.substr(f,p)}if(e.name==="length"&&e.args&&e.args.length===1)return Yn(t,e.args[0],n).length();throw new Error(`Unknown function '${e.name}'`)}case"binop":{const u=Yn(t,e.left,n),f=Yn(t,e.right,n);switch(e.op){case"+":return u.add(f);case"-":return u.sub(f);case"*":return u.mul(f);case"/":return u.div(f);default:throw new Error(`Unknown operator '${e.op}'`)}}default:throw new Error(`Unknown AST node '${e.type}'`)}}function pr(t,e){function n(r){if(r.type==="int")return r.value|0;if(r.type==="string")return r.value;if(r.type==="list")return(r.elements||[]).map(n);if(r.type==="pair")return{__pair__:!0,fst:n(r.fst),snd:n(r.snd)};if(r.type==="var"){const i=e==null?void 0:e[r.name];if(i===void 0)throw new Error(`Unbound variable '${r.name}'`);return i}if(r.type==="funcall"){if(r.name==="concat"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(typeof i=="string"&&typeof s=="string")return i+s;if(Array.isArray(i)&&Array.isArray(s))return[...i,...s];throw new Error("concat requires two strings or two lists")}if(r.name==="substring"&&r.args&&r.args.length===3){const i=n(r.args[0]),s=n(r.args[1]),l=n(r.args[2]);if(typeof i!="string"||typeof s!="number"||typeof l!="number")throw new Error("substring requires string, int, int");return i.substr(s,l)}if(r.name==="length"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Error("length requires string or list")}if(r.name==="isSubstringOf"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(typeof i!="string"||typeof s!="string")throw new Error("isSubstringOf requires two strings");return s.includes(i)}if(r.name==="head"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!Array.isArray(i)||i.length===0)throw new Error("head requires non-empty list");return i[0]}if(r.name==="tail"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!Array.isArray(i))throw new Error("tail requires list");return i.length===0?[]:i.slice(1)}if(r.name==="append"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(!Array.isArray(i))throw new Error("append requires list");return[...i,s]}if(r.name==="sublist"&&r.args&&r.args.length===3){const i=n(r.args[0]),s=n(r.args[1]),l=n(r.args[2]);if(!Array.isArray(i)||typeof s!="number"||typeof l!="number")throw new Error("sublist requires list, int, int");return i.slice(s,s+l)}if(r.name==="isSublistOf"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(!Array.isArray(i)||!Array.isArray(s))throw new Error("isSublistOf requires two lists");const l=i.length;if(l===0)return!0;for(let c=0;c<=s.length-l;c++){let u=!0;for(let f=0;f<l;f++)if(s[c+f]!==i[f]){u=!1;break}if(u)return!0}return!1}if(r.name==="fst"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!i||typeof i!="object"||i.__pair__!==!0)throw new Error("fst requires pair");return i.fst}if(r.name==="snd"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!i||typeof i!="object"||i.__pair__!==!0)throw new Error("snd requires pair");return i.snd}throw new Error(`Unknown function '${r.name}'`)}if(r.type==="binop"){const i=n(r.left),s=n(r.right);if(typeof i!="number"||typeof s!="number")throw new Error("Arithmetic operands must be numbers");switch(r.op){case"+":return i+s|0;case"-":return i-s|0;case"*":return i*s|0;case"/":if(s===0)throw new Error("Division by zero");return Math.trunc(i/s)|0;default:throw new Error(`Unknown operator '${r.op}'`)}}throw new Error(`Unknown node type '${r.type}'`)}return n(t)}function Mw(t,e){if(typeof t!="string")throw new Error("Predicate must be a string");const n=t.trim(),r=[">=","<=","==","!=",">","<"];let i=0,s=-1,l=null;for(let m=0;m<n.length;m++){const w=n[m];if(w==="("?i++:w===")"&&(i=Math.max(0,i-1)),i!==0)continue;const y=n.slice(m,m+2);if(r.includes(y)){l=y,s=m;break}if(r.includes(w)){l=w,s=m;break}}if(!l||s<0)throw new Error("Predicate must contain a comparison operator");const c=n.slice(0,s).trim(),u=n.slice(s+l.length).trim(),f=e(c),p=e(u);return{type:"cmp",op:l,left:f,right:p}}function Ro(t,e){if(typeof t!="string")throw new Error("Boolean expression must be a string");const n=t.trim();let r=0;const i=()=>{for(;r<n.length&&/\s/.test(n[r]);)r++},s=(k,C)=>(k===0||/[^A-Za-z0-9_]/.test(n[k-1]||""))&&(k+C===n.length||/[^A-Za-z0-9_]/.test(n[k+C]||"")),l=k=>(i(),n.slice(r,r+k.length).toLowerCase()===k&&s(r,k.length)),c=()=>{i();const k=r;if(!/[A-Za-z_]/.test(n[r]||""))throw new Error(`Expected identifier at position ${r}`);for(r++;r<n.length&&/[A-Za-z0-9_]/.test(n[r]);)r++;const C=n.slice(k,r);if(C&&/^[A-Z]/.test(C))throw new Error(`Variable names must start with lowercase letter, got '${C}'`);const N=r;if(i(),n[r]===":"){r++,i();const A=r;for(;r<n.length&&/[A-Za-z]/.test(n[r]);)r++;const M=n.slice(A,r).toLowerCase();return M==="int"||M==="bool"||M==="pair"?{name:C,varType:M}:(r=N,{name:C})}return{name:C}},u=k=>{const C=String(k||"").trim();if(/^true$/i.test(C)||C==="T")return{type:"boolLit",value:!0};if(/^false$/i.test(C)||C==="F")return{type:"boolLit",value:!1};if(/^-?\d+$/.test(C))return{type:"int",value:parseInt(C,10)};if(C.startsWith("(")&&C.endsWith(")")){const R=C.slice(1,-1).trim();let I=0,j=-1;for(let z=0;z<R.length;z++){const W=R[z];if(W==="(")I++;else if(W===")")I=Math.max(0,I-1);else if(W===","&&I===0){j=z;break}}if(j>=0){const z=R.slice(0,j).trim(),W=R.slice(j+1).trim();if(z.length&&W.length)return{type:"pairLit",fst:u(z),snd:u(W)}}}try{if(typeof e=="function")return e(C)}catch{}const N=C.match(/^([A-Za-z_][A-Za-z0-9_]*)(?::([A-Za-z]+))?$/);if(!N)throw new Error(`Unrecognized term '${C}'`);const A=N[1];if(A&&/^[A-Z]/.test(A))throw new Error(`Variable names must start with lowercase letter, got '${A}'`);const M=(N[2]||"").toLowerCase();return M==="bool"?{type:"boolVar",name:A,varType:"bool"}:M==="pair"?{type:"pairVar",name:A,varType:"pair"}:{type:"var",name:A}},f=()=>{if(i(),r>=n.length)throw new Error("Unexpected end");if(n[r]==="T"&&s(r,1))return r+=1,{type:"boolLit",value:!0};if(n[r]==="F"&&s(r,1))return r+=1,{type:"boolLit",value:!1};if(l("true"))return r+=4,{type:"boolLit",value:!0};if(l("false"))return r+=5,{type:"boolLit",value:!1};if(n.slice(r).startsWith("isSubstringOf")){if(r+=13,i(),n[r]!=="(")throw new Error("Expected '('");let I=r+1,j=1;for(r++;r<n.length&&j>0;r++){const F=n[r];F==="("?j++:F===")"&&j--}if(j!==0)throw new Error("Unterminated isSubstringOf arguments");const z=n.slice(I,r-1).trim();let W=0,V="";const D=[];for(let F=0;F<z.length;F++){const Y=z[F];if(Y==="("){W++,V+=Y;continue}if(Y===")"){W=Math.max(0,W-1),V+=Y;continue}if(Y===","&&W===0){D.push(V.trim()),V="";continue}V+=Y}if(V.trim().length&&D.push(V.trim()),D.length!==2)throw new Error("isSubstringOf expects two arguments");const U=e(D[0]),G=e(D[1]);return{type:"boolFuncall",name:"isSubstringOf",args:[U,G]}}const k=[">=","<=","==","!=",">","<"];let C=0,N=-1,A=null;for(let I=r;I<n.length;I++){const j=n[I];if(j==="("?C++:j===")"&&(C=Math.max(0,C-1)),C!==0)continue;if(n.slice(I,I+3)==="<->"){I+=2;continue}if(n.slice(I,I+2)==="->"){I+=1;continue}const z=n.slice(I,I+2);if(k.includes(z)){A=z,N=I;break}if(k.includes(j)){A=j,N=I;break}}if(A&&N>=0){const I=n.slice(r,N).trim(),j=N+A.length;let z=n.length;C=0;const W=(F,Y)=>(F===0||/[^A-Za-z0-9_]/.test(n[F-1]||""))&&(F+Y===n.length||/[^A-Za-z0-9_]/.test(n[F+Y]||"")),V=F=>{const Y=n.slice(F),X=["&&","||","^","->","<->"],te=["and","or","xor","implies","iff"];for(const K of X)if(Y.startsWith(K))return!0;for(const K of te)if(Y.toLowerCase().startsWith(K)&&W(F,K.length))return!0;return!1};for(let F=j;F<n.length;F++){const Y=n[F];if(Y==="("){C++;continue}if(Y===")"){if(C===0){z=F;break}C=Math.max(0,C-1);continue}if(C===0&&V(F)){z=F;break}}const D=n.slice(j,z).trim(),U=u(I),G=u(D);return r=z,{type:"cmp",op:A,left:U,right:G}}if(n[r]==="("){r++;const I=T();if(i(),n[r]!==")")throw new Error(`Expected ')' at ${r}`);return r++,I}const{name:M,varType:R}=c();return R?{type:"boolVar",name:M,varType:R}:{type:"boolVar",name:M}},p={not:["not"],and:["and"],xor:["xor"],or:["or"],implies:["implies"],iff:["iff"]},m={not:["!"],and:["&&"],xor:["^"],or:["||"],implies:["->"],iff:["<->"]},w=(k,C)=>{i();for(const N of k)if(n.slice(r,r+N.length)===N)return r+=N.length,!0;for(const N of C)if(n.slice(r,r+N.length).toLowerCase()===N&&s(r,N.length))return r+=N.length,!0;return!1},y=()=>(i(),w(m.not,p.not)?{type:"not",expr:y()}:f()),x=()=>{let k=y();for(;i(),w(m.and,p.and);){const C=y();k={type:"and",left:k,right:C}}return k},b=()=>{let k=x();for(;i(),w(m.xor,p.xor);){const C=x();k={type:"xor",left:k,right:C}}return k},_=()=>{let k=b();for(;i(),w(m.or,p.or);){const C=b();k={type:"or",left:k,right:C}}return k},S=()=>{let k=_();for(;i(),w(m.implies,p.implies);){const C=_();k={type:"implies",left:k,right:C}}return k},T=()=>{let k=S();for(;i(),w(m.iff,p.iff);){const C=S();k={type:"iff",left:k,right:C}}return k},h=T();if(i(),r!==n.length)throw new Error(`Unexpected token '${n[r]}' at position ${r}`);return h}function Co(t,e,n){const r=l=>{if(typeof l=="boolean")return l;if(typeof l=="number")return l!==0;if(l&&typeof l=="object"&&l.__pair__)return!0;throw new Error("Non-bool binding in bool expression")},i=l=>{if(!l)throw new Error("Invalid term");if(l.type==="int"||l.type==="bin"||l.type==="var"){try{return pr(l,e)}catch{}if(l.type==="var"&&typeof(e==null?void 0:e[l.name])<"u")return e[l.name]}return l.type==="boolLit"?!!l.value:l.type==="boolVar"?!!(e!=null&&e[l.name]):l.type==="pairVar"?e==null?void 0:e[l.name]:l.type==="pairLit"?{__pair__:!0,fst:i(l.fst),snd:i(l.snd)}:pr(l,e)},s=l=>{switch(l.type){case"boolLit":return!!l.value;case"boolVar":return r(e==null?void 0:e[l.name]);case"boolFuncall":{if(l.name==="isSubstringOf"&&l.args&&l.args.length===2){const c=pr(l.args[0],e||{}),u=pr(l.args[1],e||{});if(typeof c!="string"||typeof u!="string")throw new Error("isSubstringOf requires two string arguments");return u.includes(c)}throw new Error(`Unknown boolean function '${l.name}'`)}case"not":return!s(l.expr);case"and":return s(l.left)&&s(l.right);case"or":return s(l.left)||s(l.right);case"xor":{const c=s(l.left),u=s(l.right);return c&&!u||!c&&u}case"implies":{const c=s(l.left),u=s(l.right);return!c||u}case"iff":{const c=s(l.left),u=s(l.right);return c===u}case"cmp":{const c=i(l.left),u=i(l.right),f=(p,m)=>p&&typeof p=="object"&&p.__pair__&&m&&typeof m=="object"&&m.__pair__?f(p.fst,m.fst)&&f(p.snd,m.snd):p===m;switch(l.op){case"==":return f(c,u);case"!=":return!f(c,u);case"<":return c<u;case"<=":return c<=u;case">":return c>u;case">=":return c>=u;default:return!1}}default:throw new Error(`Unknown bool AST node '${l.type}'`)}};return s(t)}async function Aw(t,e,n){const{ctx:r}=await Pw(),{Int:i,Bool:s,Solver:l,And:c,Not:u,Or:f}=r,p=typeof t=="string"?Ro(t,n):t,m=new Set,w=new Set,y=h=>{if(h)switch(h.type){case"boolVar":w.add(h.name);break;case"and":case"or":y(h.left),y(h.right);break;case"not":y(h.expr);break;case"cmp":{const k=C=>{C&&(C.type==="var"&&m.add(C.name),C.type==="bin"&&(k(C.left),k(C.right)))};k(h.left),k(h.right);break}}};y(p);const x=new Map(Array.from(m).map(h=>[h,i.const(h)])),b=new Map(Array.from(w).map(h=>[h,s.const(h)])),_=h=>{switch(h.type){case"boolLit":return h.value?s.val(!0):s.val(!1);case"boolVar":return b.get(h.name);case"boolFuncall":{if(h.name==="isSubstringOf"&&h.args&&h.args.length===2)try{const k=pr(h.args[0],e||{}),C=pr(h.args[1],e||{});if(typeof k!="string"||typeof C!="string")throw new Error("isSubstringOf requires two string arguments");return C.includes(k)?s.val(!0):s.val(!1)}catch{try{const C=Yn(r,h.args[1],A=>x.get(A)),N=Yn(r,h.args[0],A=>x.get(A));return C.contains(N)}catch{return s.val(!1)}}throw new Error(`Unknown boolean function '${h.name}'`)}case"not":return u(_(h.expr));case"and":return c(_(h.left),_(h.right));case"or":return f(_(h.left),_(h.right));case"cmp":{const k=N=>N&&(N.type==="int"||N.type==="var"||N.type==="bin"||N.type==="binop");if(k(h.left)&&k(h.right)){const N=R=>{if(R.type==="int")return i.val(R.value);if(R.type==="var")return x.get(R.name);if(R.type==="bin"||R.type==="binop"){const I=N(R.left),j=N(R.right);switch(R.op){case"+":return I.add(j);case"-":return I.sub(j);case"*":return I.mul(j);case"/":return I.div(j);default:throw new Error("Unknown arithmetic operator")}}throw new Error("Unknown arithmetic AST in bool comparison")},A=N(h.left),M=N(h.right);switch(h.op){case"==":return A.eq(M);case"!=":return u(A.eq(M));case"<":return A.lt(M);case"<=":return A.le(M);case">":return A.gt(M);case">=":return A.ge(M);default:throw new Error(`Unsupported predicate operator '${h.op}'`)}}return Co({type:"cmp",op:h.op,left:h.left,right:h.right},e||{})?s.val(!0):s.val(!1)}default:throw new Error(`Unknown bool AST node '${h.type}'`)}},S=new l;try{let h=1e4;try{typeof window<"u"&&window.__Z3_SETTINGS__&&typeof window.__Z3_SETTINGS__.solverTimeoutMs=="number"&&(h=window.__Z3_SETTINGS__.solverTimeoutMs|0)}catch{}S.set("timeout",h)}catch{}if(e&&typeof e=="object"){const h=[];for(const[k,C]of Object.entries(e))x.has(k)&&typeof C=="number"?h.push(x.get(k).eq(i.val(C|0))):b.has(k)&&typeof C=="boolean"&&h.push(b.get(k).eq(C?s.val(!0):s.val(!1)));h.length&&S.add(c(...h))}S.add(_(p));const T=await S.check();return String(T)==="sat"}async function Iw(t,e,n=5){const{solveEquation:r}=await ni(()=>import("./eval-bool-1825199d.js"),[],import.meta.url);return await r(t,e,n)}function Rw(t,e,n=Vt){if(!t||typeof t!="string")return{};const r={},i=t.split(",");for(const s of i){const l=s.indexOf("=");if(l===-1)continue;const c=s.slice(0,l).trim(),u=s.slice(l+1).trim();if(!c)continue;const f=n(u);r[c]=pr(f,e)}return r}function Lw(t){return t&&typeof t=="object"&&(t.__pair__||Object.prototype.hasOwnProperty.call(t,"fst")&&Object.prototype.hasOwnProperty.call(t,"snd"))}function Ya(t){return typeof t=="boolean"?t?"T":"F":typeof t=="string"?`'${t}'`:Array.isArray(t)?`[${t.map(Ya).join(", ")}]`:Lw(t)?`(${Ya(t.fst)}, ${Ya(t.snd)})`:String(t)}function w5(t){return!Array.isArray(t)||t.length===0?"":t.map(Ya).join(", ")}const Uy="text-sm sm:text-xs font-semibold text-gray-600 uppercase tracking-wider mb-2";function jw({isOpen:t,onClose:e}){const n=kw(),r=n.listTypes(),[i,s]=O.useState("x + 2 * y"),[l,c]=O.useState("x=3, y=4"),[u,f]=O.useState(null),[p,m]=O.useState([]),[w,y]=O.useState(null),x=O.useMemo(()=>r.map(h=>n.getType(h)),[r,n]);if(!t)return null;function b(T){const h=String(T||"").trim();if(!h)return{};try{const C=JSON.parse(h);if(C&&typeof C=="object"&&!Array.isArray(C))return C}catch{}const k={};for(const C of h.split(",")){const N=C.trim();if(!N)continue;const A=N.indexOf("=");if(A===-1)continue;const M=N.slice(0,A).trim(),R=N.slice(A+1).trim(),I=Number.parseInt(R,10);M&&(k[M]=Number.isFinite(I)?I:0)}return k}function _(T){let h=0;for(let k=0;k<T.length;k++){const C=T[k];if(C==="("?h++:C===")"&&(h=Math.max(0,h-1)),h===0&&C==="="){const N=T[k-1]||"",A=T[k+1]||"";if(N!=="="&&A!=="="&&N!=="<"&&N!==">")return k}}return-1}const S=async()=>{y(null),f(null),m([]);try{const T=String(i||"").trim();if(!T)throw new Error("Please enter an expression or an equation.");const h=_(T),k=b(l);if(h>=0){const C=Vt(T.slice(0,h)),N=Vt(T.slice(h+1));if(Object.keys(k).length>0){const M=await Co({type:"cmp",op:"==",left:C,right:N},k,Vt);f(!!M)}else{const{solutions:A}=await Iw(C,N,5);m(A||[])}}else try{const C=Vt(T),N=await pr(C,k);f(N)}catch{const N=Ro(T,Vt),A=Co(N,k,Vt);f(!!A)}}catch(T){y(String(T.message||T))}};return E.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30 p-2 sm:p-4",children:E.jsxs("div",{className:"bg-white rounded-lg sm:rounded shadow-lg w-full h-full sm:h-auto sm:max-h-[90vh] sm:max-w-[1000px] overflow-y-auto p-3 sm:p-4",children:[E.jsxs("div",{className:"flex items-center justify-between mb-3 sticky top-0 bg-white pb-2 border-b -mx-3 sm:-mx-4 px-3 sm:px-4 z-10",children:[E.jsx("h3",{className:"text-base sm:text-lg font-semibold pr-2",children:"ADT Manager"}),E.jsx("button",{className:"px-3 py-2 bg-gray-200 hover:bg-gray-300 active:bg-gray-400 rounded text-sm font-medium flex-shrink-0 transition-colors",onClick:e,children:"Close"})]}),E.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[E.jsxs("div",{children:[E.jsx("div",{className:Uy,children:"Available Data Types"}),x.map(T=>E.jsxs("div",{className:"mt-3 p-3 sm:p-4 border rounded bg-gray-50 space-y-3",children:[E.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[E.jsx("div",{className:"font-semibold text-base sm:text-lg",children:T.name}),T.__readonly&&E.jsx("span",{className:"text-xs sm:text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded flex-shrink-0",children:"Built-in"})]}),E.jsxs("div",{children:[E.jsx("div",{className:"text-sm sm:text-sm font-semibold mb-2 text-gray-700",children:"Operations"}),E.jsxs("div",{className:"space-y-2",children:[(T.operations||[]).map((h,k)=>E.jsx("div",{className:"text-xs sm:text-sm font-mono bg-white p-2 sm:p-3 rounded border",children:E.jsxs("div",{className:"flex flex-wrap items-baseline gap-1 break-words",children:[E.jsx("span",{className:"text-blue-600 font-semibold",children:h.name}),E.jsxs("span",{className:"text-gray-600",children:["(",h.params?h.params.map((C,N)=>`${C.type} ${String.fromCharCode(97+N)}`).join(", "):"no params",")"]}),E.jsx("span",{className:"text-gray-500",children:"  "}),E.jsx("span",{className:"text-green-600 font-semibold",children:h.result})]})},k)),(!T.operations||T.operations.length===0)&&E.jsx("div",{className:"text-sm text-gray-500 italic",children:"(no operations)"})]})]}),E.jsxs("div",{children:[E.jsx("div",{className:"text-sm sm:text-sm font-semibold mb-2 text-gray-700",children:"Axioms"}),E.jsxs("div",{className:"space-y-2",children:[(T.axioms||[]).map((h,k)=>E.jsxs("div",{className:"text-xs sm:text-sm font-mono bg-white p-2 sm:p-3 rounded border break-all",children:[E.jsx("span",{className:"text-purple-600 font-semibold",children:h.name?h.name+": ":""}),E.jsx("span",{className:"text-gray-800 break-words",children:h.equation})]},k)),(!T.axioms||T.axioms.length===0)&&E.jsx("div",{className:"text-sm text-gray-500 italic",children:"(no axioms)"})]})]})]},T.name))]}),E.jsxs("div",{children:[E.jsx("div",{className:Uy,children:"Interactive Tools"}),E.jsxs("div",{className:"mt-3 p-3 sm:p-4 border rounded bg-gray-50",children:[E.jsx("div",{className:"text-sm sm:text-sm font-semibold mb-3 text-gray-700",children:"Sandbox"}),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-xs sm:text-xs text-gray-700 mb-1",children:"Expression or Equation"}),E.jsx("input",{className:"w-full border rounded p-2 sm:p-2 text-sm font-mono",placeholder:"Enter an expression (e.g., x + 2*y) or equation with '=' (e.g., x + y = 7)",value:i,onChange:T=>s(T.target.value),"data-testid":"sandbox-expr"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-xs sm:text-xs text-gray-700 mb-1",children:"Variable Bindings"}),E.jsx("input",{className:"w-full border rounded p-2 sm:p-2 text-sm font-mono",placeholder:'{"x":3, "y":4} or x=3, y=4',value:l,onChange:T=>c(T.target.value),"data-testid":"sandbox-bindings"})]}),E.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[E.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded text-sm font-medium active:bg-blue-700 transition-colors",onClick:S,"data-testid":"sandbox-run",children:"Run"}),u!==null&&E.jsxs("span",{className:"text-sm","data-testid":"sandbox-result",children:["Result: ",E.jsx("span",{className:"font-mono bg-green-100 px-2 py-1 rounded",children:Ya(u)})]})]}),w&&E.jsx("div",{className:"p-2 sm:p-3 text-red-700 bg-red-100 border border-red-200 rounded text-xs sm:text-sm whitespace-pre-wrap break-words",children:w}),p&&p.length>0&&E.jsxs("div",{className:"text-sm","data-testid":"sandbox-solutions",children:[E.jsx("div",{className:"font-semibold mb-2 text-gray-700",children:"Solutions (up to 5):"}),E.jsx("div",{className:"space-y-2",children:p.map((T,h)=>E.jsx("div",{className:"font-mono bg-white p-2 sm:p-3 rounded border break-all text-xs sm:text-sm","data-testid":"sandbox-sol-entry",children:JSON.stringify(T)},h))})]})]})]})]})]})]})})}const Fc="http://example.org/apn",Fw="http://www.pnml.org/version-2009/grammar/pnml",Ow=500,S5={startX:40,startY:40,spacing:80,columns:25,transitionOffsetX:220};function Wh(t){return t?Array.from(t):[]}function Dw(t){const n=new DOMParser().parseFromString(t,"application/xml"),r=n.querySelector("parsererror");if(r)throw console.error("XML parsing error:",r.textContent),new Error("Invalid XML: "+r.textContent);const i=n.documentElement,s=i.namespaceURI||Fw;return{xmlDoc:n,pnmlElement:i,PNML_NS:s}}function zw(t,e){const n=t.getElementsByTagNameNS(e,"net");if(n&&n.length>0)return n[0];const r=t.getElementsByTagName("net");return r&&r.length>0?r[0]:null}function Bw(t,e){const n=t.getElementsByTagNameNS(e,"page");if(n&&n.length>0)return n[0];const r=t.getElementsByTagName("page");return r&&r.length>0?r[0]:null}function _5(t){const e=(i,s)=>{if(!i)return[];const l=typeof i.getElementsByTagNameNS=="function"?i.getElementsByTagNameNS(t,s):[];if(l&&l.length>0)return Wh(l);const c=typeof i.getElementsByTagNameNS=="function"?i.getElementsByTagNameNS(Fc,s):[];if(c&&c.length>0)return Wh(c);const u=typeof i.getElementsByTagName=="function"?i.getElementsByTagName(s):[];return u&&u.length>0?Wh(u):[]},n=(i,s)=>e(i,s);return{getElements:e,findChildElements:n,getTextContent:(i,s)=>{const l=n(i,s);if(l.length===0)return"";const c=l[0],u=c.getElementsByTagName("text").length?c.getElementsByTagName("text"):c.getElementsByTagNameNS(Fc,"text");if(u&&u.length>0){const f=u[0];if(f&&typeof f.textContent=="string")return f.textContent}return typeof c.textContent=="string"?c.textContent:""}}}function $h(t,e,n){return t?_5(e).getElements(t,n):[]}function Uw(t){return t>=Ow}function k5(t,e,n,r,i){const{findChildElements:s}=e,{applyAutoLayout:l,layout:c=S5}=n,{startX:u,startY:f,spacing:p,columns:m,transitionOffsetX:w}=c,y=Gw(t,s);if(y.found||!l)return{x:y.x,y:y.y};const x=r%m,b=Math.floor(r/m),_=u+x*p,S=f+b*p;return i==="transition"?{x:_+w,y:S}:{x:_,y:S}}function Gw(t,e){const n=e(t,"graphics");if(n.length>0){const r=e(n[0],"position");if(r.length>0){const i=parseInt(r[0].getAttribute("x")||"0",10),s=parseInt(r[0].getAttribute("y")||"0",10);return{x:i,y:s,found:!0}}}return{x:0,y:0,found:!1}}function Vw(t,e={}){return{applyAutoLayout:t,layout:{...S5,...e}}}function wg(t){const e=[];let n="",r=0,i=0,s=!1;for(let c=0;c<t.length;c++){const u=t[c];if(s){n+=u,u==="'"&&t[c-1]!=="\\"&&(s=!1);continue}if(u==="'"){s=!0,n+=u;continue}if(u==="("){r++,n+=u;continue}if(u===")"){r=Math.max(0,r-1),n+=u;continue}if(u==="["){i++,n+=u;continue}if(u==="]"){i=Math.max(0,i-1),n+=u;continue}if(u===","&&r===0&&i===0){e.push(n.trim()),n="";continue}n+=u}const l=n.trim();return l.length>0&&e.push(l),e.filter(Boolean)}function Xa(t){const e=String(t||"").trim(),n=e.toLowerCase();if(e==="T"||n==="true")return!0;if(e==="F"||n==="false")return!1;if(/^[+-]?\d+$/.test(e))return parseInt(e,10);if(e.startsWith("'")&&e.endsWith("'")&&e.length>=2)return e.slice(1,-1).replace(/\\(.)/g,(i,s)=>s==="n"?`
`:s==="t"?"	":s==="r"?"\r":s==="\\"?"\\":s==="'"?"'":s);if(e.startsWith("[")&&e.endsWith("]")){const r=e.slice(1,-1).trim();return r.length===0?[]:wg(r).map(s=>Xa(s))}if(e.startsWith("(")&&e.endsWith(")")){const r=e.slice(1,-1).trim();let i=0,s=-1;for(let l=0;l<r.length;l++){const c=r[l];if(c==="(")i++;else if(c===")")i=Math.max(0,i-1);else if(c===","&&i===0){s=l;break}}if(s>=0){const l=r.slice(0,s).trim(),c=r.slice(s+1).trim();return{__pair__:!0,fst:Xa(l),snd:Xa(c)}}}return null}const Ww=t=>`P${t+1}`;function $w(t,e,n){const{getTextContent:r,getElements:i}=e,s=[];return t.forEach((l,c)=>{try{const u=l.getAttribute("id"),f=r(l,"name")||Ww(c),p=k5(l,e,n,c,"place");let m=0,w;const y=i(l,"valueTokens").filter(b=>b.namespaceURI===Fc&&b.parentElement===l);if(y.length>0){const b=y[0],_=b.getElementsByTagNameNS?b.getElementsByTagNameNS(Fc,"token"):b.getElementsByTagName("token"),S=Array.from(_||[]).map(T=>{let h=r(T,"text");!h&&typeof T.textContent=="string"&&(h=T.textContent);const k=typeof h=="string"?h.trim():"";return k?Xa(k):null}).filter(T=>T!==null);w=S,m=S.length}else{const b=r(l,"initialMarking");if(b){const _=b.trim();if(_.startsWith("[")&&_.endsWith("]"))try{const S=_.slice(1,-1).trim();w=(S.length?wg(S):[]).map(Xa).filter(h=>h!==null),m=Array.isArray(w)?w.length:0}catch(S){console.warn(`Could not parse token list for ${u}:`,S)}else{const S=parseInt(_,10);Number.isFinite(S)&&(m=S)}}}const x=r(l,"type");s.push({id:u,name:f,label:f,x:p.x,y:p.y,tokens:m,valueTokens:w,type:x||void 0})}catch(u){console.error("Error processing place:",u)}}),s}const Hw=t=>`T${t+1}`;function Yw(t,e,n){const{getTextContent:r}=e,i=[];return t.forEach((s,l)=>{try{const c=s.getAttribute("id"),u=r(s,"name")||Hw(l),f=k5(s,e,n,l,"transition"),p=r(s,"guard"),m=r(s,"action");i.push({id:c,name:u,label:u,x:f.x,y:f.y,guard:p||void 0,action:m||void 0})}catch(c){console.error("Error processing transition:",c)}}),i}const Xw="north",Kw="south";function Qw(t,e,n){const{getTextContent:r,findChildElements:i}=e,s=[],{placeIds:l,transitionIds:c}=n;return t.forEach(u=>{try{const f=u.getAttribute("id"),p=u.getAttribute("source"),m=u.getAttribute("target");if(!p||!m){console.warn(`Skipping arc ${f} due to missing source or target`);return}let w=Xw,y=Kw;const x=i(u,"graphics");if(x.length>0){const k=i(x[0],"metadata");if(k.length>0){const C=i(k[0],"sourceDirection");C.length>0&&C[0].textContent&&(w=C[0].textContent);const N=i(k[0],"targetDirection");N.length>0&&N[0].textContent&&(y=N[0].textContent)}}const b=Zw(f,p,m,l,c);let _=1;const S=r(u,"inscription");if(S){const k=parseInt(S,10);Number.isFinite(k)?_=k:console.warn(`Could not parse weight for ${f}: '${S}', defaulting to 1`)}const T=r(u,"binding");let h;if(T&&T.includes(","))try{h=wg(T)}catch{h=T.split(",").map(C=>C.trim()).filter(Boolean)}else T&&(h=[T.trim()]);s.push({id:f,source:p,target:m,type:b,weight:_,binding:h?void 0:T||void 0,bindings:h||void 0,sourceDirection:w,targetDirection:y})}catch(f){console.error("Error processing arc:",f)}}),s}function Zw(t,e,n,r,i){const s=r.includes(e),l=i.includes(e),c=r.includes(n),u=i.includes(n);return s&&u?"place-to-transition":l&&c?"transition-to-place":e.toLowerCase().includes("place")&&n.toLowerCase().includes("transition")?"place-to-transition":e.toLowerCase().includes("transition")&&n.toLowerCase().includes("place")?"transition-to-place":(console.warn(`Could not determine arc type for ${t}, defaulting to place-to-transition`),"place-to-transition")}function qw(t){const e={places:[],transitions:[],arcs:[]};try{const{xmlDoc:n,PNML_NS:r}=Dw(t),i=zw(n,r);if(!i)return console.error("No net element found in the PNML file"),e;const s=i.getAttribute("netMode");s&&(e.netMode=s);const l=Bw(i,r);if(!l)return console.error("No page element found in the PNML file"),e;const c=_5(r),u=$h(l,r,"place"),f=$h(l,r,"transition"),p=$h(l,r,"arc"),m=u.length+f.length,w=Vw(Uw(m));return e.places=$w(u,c,w),e.transitions=Yw(f,c,w),e.arcs=Qw(p,c,{placeIds:e.places.map(y=>y.id),transitionIds:e.transitions.map(y=>y.id)}),e}catch(n){return console.error("Error parsing PNML:",n),e}}const wn="http://example.org/apn";function Jw(t){try{const e=document.implementation.createDocument("http://www.pnml.org/version-2009/grammar/pnml","pnml",null),n=e.documentElement;let r=!1;const i=e.createElement("net");i.setAttribute("id","net1"),i.setAttribute("type","http://www.pnml.org/version-2009/grammar/ptnet"),n.appendChild(i),t.netMode&&i.setAttribute("netMode",t.netMode);const s=e.createElement("name"),l=e.createElement("text");l.textContent="Petri Net",s.appendChild(l),i.appendChild(s);const c=e.createElement("page");c.setAttribute("id","page1"),i.appendChild(c);const u=t.places||[];u.forEach(b=>{const _=e.createElement("place");_.setAttribute("id",b.id);const S=e.createElement("name"),T=e.createElement("text");T.textContent=b.label||b.name||`P${b.id}`,S.appendChild(T),_.appendChild(S);const h=e.createElement("graphics"),k=e.createElement("position");if(k.setAttribute("x",b.x||0),k.setAttribute("y",b.y||0),h.appendChild(k),_.appendChild(h),b.type){const N=e.createElementNS(wn,"apn:type"),A=e.createElementNS(wn,"apn:text");A.textContent=String(b.type),N.appendChild(A),_.appendChild(N),r=!0}const C=N=>typeof N=="boolean"?N?"T":"F":typeof N=="string"?`'${N.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")}'`:Array.isArray(N)?`[${N.map(C).join(", ")}]`:N&&typeof N=="object"&&N.__pair__?`(${C(N.fst)}, ${C(N.snd)})`:String(N);if(Array.isArray(b.valueTokens)){const N=e.createElementNS(wn,"apn:valueTokens");b.valueTokens.forEach(A=>{const M=e.createElementNS(wn,"apn:token"),R=e.createElementNS(wn,"apn:text");R.textContent=C(A),M.appendChild(R),N.appendChild(M)}),_.appendChild(N),r=!0}else if(b.tokens>0){const N=e.createElement("initialMarking"),A=e.createElement("text");A.textContent=b.tokens,N.appendChild(A),_.appendChild(N)}c.appendChild(_)});const f=t.transitions||[];f.forEach(b=>{const _=e.createElement("transition");_.setAttribute("id",b.id);const S=e.createElement("name"),T=e.createElement("text");T.textContent=b.label||b.name||`T${b.id}`,S.appendChild(T),_.appendChild(S);const h=e.createElement("graphics"),k=e.createElement("position");if(k.setAttribute("x",b.x||0),k.setAttribute("y",b.y||0),h.appendChild(k),_.appendChild(h),b.guard){const C=e.createElementNS(wn,"apn:guard"),N=e.createElementNS(wn,"apn:text");N.textContent=String(b.guard),C.appendChild(N),_.appendChild(C),r=!0}if(b.action){const C=e.createElementNS(wn,"apn:action"),N=e.createElementNS(wn,"apn:text");N.textContent=String(b.action),C.appendChild(N),_.appendChild(C),r=!0}c.appendChild(_)});const p=t.arcs||[],m=new Set(u.map(b=>b.id)),w=new Set(f.map(b=>b.id));return p.filter(b=>{const _=b.source||b.sourceId,S=b.target||b.targetId;if(!_||!S||_==="undefined"||S==="undefined")return console.warn(`Skipping invalid arc ${b.id} during save - missing or undefined source/target`),!1;const T=m.has(_)||w.has(_),h=m.has(S)||w.has(S);return!T||!h?(console.warn(`Skipping invalid arc ${b.id} during save - references non-existent elements`),!1):!0}).forEach(b=>{const _=e.createElement("arc");_.setAttribute("id",b.id);const S=b.source||b.sourceId,T=b.target||b.targetId;_.setAttribute("source",S),_.setAttribute("target",T);const h=e.createElement("graphics"),k=e.createElement("metadata"),C=e.createElement("sourceDirection");C.textContent=b.sourceDirection||"north",k.appendChild(C);const N=e.createElement("targetDirection");if(N.textContent=b.targetDirection||"south",k.appendChild(N),h.appendChild(k),_.appendChild(h),b.weight>1&&!(b.binding||Array.isArray(b.bindings)&&b.bindings.length)){const A=e.createElement("inscription"),M=e.createElement("text");M.textContent=b.weight,A.appendChild(M),_.appendChild(A)}if(Array.isArray(b.bindings)&&b.bindings.length>0){const A=e.createElementNS(wn,"apn:binding"),M=e.createElementNS(wn,"apn:text");M.textContent=b.bindings.join(", "),A.appendChild(M),_.appendChild(A),r=!0}else if(b.binding){const A=e.createElementNS(wn,"apn:binding"),M=e.createElementNS(wn,"apn:text");M.textContent=String(b.binding),A.appendChild(M),_.appendChild(A),r=!0}c.appendChild(_)}),r&&n.setAttribute("xmlns:apn",wn),new XMLSerializer().serializeToString(e)}catch(e){throw console.error("Error generating PNML:",e),e}}async function Gy(t){try{return Jw(t)}catch(e){throw console.error("Error exporting to PNML:",e),e}}async function e9(t){try{return qw(t)}catch(e){throw console.error("Error importing from PNML:",e),e}}class t9{constructor(){this.listeners=new Map}on(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)}off(e,n){if(!this.listeners.has(e))return;const r=this.listeners.get(e),i=r.indexOf(n);i>-1&&r.splice(i,1)}emit(e,n){if(!this.listeners.has(e))return;const r=this.listeners.get(e);for(const i of r)try{i(n)}catch(s){console.error(`Error in event listener for ${e}:`,s)}}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){return this.listeners.has(e)?this.listeners.get(e).length:0}}const vo={transitionsChanged:"transitionsChanged",transitionFired:"transitionFired"},Ca=new t9;class b5{constructor(){this.isInitialized=!1,this.petriNet=null,this.eventBus=null,this.simulationMode="single"}async initialize(e,n={}){if(!this.validatePetriNet(e))throw new Error("Invalid Petri net structure");this.petriNet=this.normalizeNet(e),this.isInitialized=!0,this.simulationMode=n.simulationMode||"single",await this.initializeSpecific(this.petriNet,n)}async initializeSpecific(e,n){}async update(e){if(!this.isInitialized)throw new Error("Simulator not initialized");if(!this.validatePetriNet(e))throw new Error("Invalid Petri net structure");this.petriNet=this.normalizeNet(e),await this.updateSpecific(this.petriNet)}async updateSpecific(e){}async getEnabledTransitions(){return this.isInitialized?await this.getEnabledTransitionsSpecific():[]}async getEnabledTransitionsSpecific(){return[]}async fireTransition(e,n={}){if(!this.isInitialized)throw new Error("Simulator not initialized");if(!(n.skipEnabledCheck||!1)&&!(await this.getEnabledTransitions()).includes(e))throw new Error(`Transition ${e} is not enabled`);return await this.fireTransitionSpecific(e,n)}async fireTransitionSpecific(e){return this.petriNet}async stepSimulation(){if(!this.isInitialized)throw new Error("Simulator not initialized");return await this.stepSimulationSpecific()}async stepSimulationSpecific(){return this.petriNet}reset(){this.isInitialized=!1,this.petriNet=null,this.simulationMode="single",this.resetSpecific()}resetSpecific(){}setEventBus(e){this.eventBus=e}emitTransitionsChanged(e={}){if(!this.eventBus)return;const n=Array.isArray(e.enabled)?e.enabled:[],r=Array.isArray(e.previouslyEnabled)?e.previouslyEnabled:[],i=typeof e.hasEnabled=="boolean"?e.hasEnabled:n.length>0;this.eventBus.emit(vo.transitionsChanged,{enabled:n,previouslyEnabled:r,hasEnabled:i})}emitTransitionFired(e={}){if(!this.eventBus)return;const{transitionId:n,newPetriNet:r}=e||{};n&&this.eventBus.emit(vo.transitionFired,{transitionId:n,newPetriNet:r})}getType(){throw new Error("getType() must be implemented by subclasses")}validatePetriNet(e){if(!e||typeof e!="object")return!1;const{places:n,transitions:r,arcs:i}=e;return!(!Array.isArray(n)||!Array.isArray(r)||!Array.isArray(i))}normalizeNet(e){const n=JSON.parse(JSON.stringify(e||{places:[],transitions:[],arcs:[]})),r=Array.isArray(n.places)?n.places:[],i=Array.isArray(n.transitions)?n.transitions:[],s=Array.isArray(n.arcs)?n.arcs:[],l=new Set(r.map(u=>String(u.id))),c=new Set(i.map(u=>String(u.id)));for(const u of r){if(u.id=String(u.id),Array.isArray(u.valueTokens)){const f=u.valueTokens.length;(!Number.isFinite(u.tokens)||u.tokens!==f)&&(u.tokens=f)}else Number.isFinite(u.tokens)||(u.tokens=0);!u.label&&u.name&&(u.label=u.name),!u.name&&u.label&&(u.name=u.label)}for(const u of s){u.id!==void 0&&(u.id=String(u.id));const f=u.sourceId||u.source,p=u.targetId||u.target;u.sourceId=String(f),u.targetId=String(p),u.source===void 0&&(u.source=u.sourceId),u.target===void 0&&(u.target=u.targetId);const m=Number(u.weight);u.weight=Number.isFinite(m)&&m>0?m:1,Array.isArray(u.bindings)||(u.binding?u.bindings=[String(u.binding)]:u.bindings=[]),u.sourceType||(u.sourceType=l.has(u.sourceId)?"place":c.has(u.sourceId)?"transition":u.sourceType),u.targetType||(u.targetType=l.has(u.targetId)?"place":c.has(u.targetId)?"transition":u.targetType)}return n.places=r,n.transitions=i,n.arcs=s,n}isReady(){return this.isInitialized&&this.petriNet!==null}getSimulationStats(){if(!this.isInitialized)return{enabledTransitions:[],totalTokens:0,totalPlaces:0,totalTransitions:0};const{places:e,transitions:n}=this.petriNet,r=e.reduce((i,s)=>i+(s.tokens||0),0);return{enabledTransitions:[],totalTokens:r,totalPlaces:e.length,totalTransitions:n.length}}}function n9(t){if(!(t!=null&&t.transitions)||!(t!=null&&t.places)||!(t!=null&&t.arcs))return!1;for(const e of t.transitions)if(C5(e.id,t))return!1;return!0}function C5(t,e){const n=r9(t,e.places,e.arcs);for(const r of n){const i=e.arcs.find(l=>(l.sourceId===r.id||l.source===r.id)&&(l.targetId===t||l.target===t));if(!i)continue;const s=i.weight||1;if((r.tokens||0)<s)return!1}return!0}function r9(t,e,n){const r=[];for(const i of n){const s=i.sourceId||i.source;if((i.targetId||i.target)===t){const c=e.find(u=>u.id===s);c&&r.push(c)}}return r}function i9(t){var l,c,u,f,p;if(!t)return null;const e=((l=t.places)==null?void 0:l.length)||0,n=((c=t.transitions)==null?void 0:c.length)||0,r=((u=t.arcs)==null?void 0:u.length)||0,i=((f=t.places)==null?void 0:f.reduce((m,w)=>m+(w.tokens||0),0))||0,s=((p=t.transitions)==null?void 0:p.filter(m=>C5(m.id,t)))||[];return{placeCount:e,transitionCount:n,arcCount:r,totalTokens:i,enabledTransitionCount:s.length,enabledTransitions:s.map(m=>m.id),isDeadlock:n9(t)}}function T5(t,e){const n=new Map;for(const r of t)r.srcId&&(n.has(r.srcId)||n.set(r.srcId,[]),n.get(r.srcId).push(r));for(const[r,i]of n.entries()){const s=e[r];if(!s)continue;const l=i.filter(u=>u.countFallback).length;if(l>0){const u=Number(s.tokens||0);s.tokens=Math.max(0,u-l)}const c=i.filter(u=>!u.countFallback);if(Array.isArray(s.valueTokens)&&c.length>0){c.sort((u,f)=>f.tokenIndex-u.tokenIndex);for(const u of c)u.tokenIndex>=0&&u.tokenIndex<s.valueTokens.length&&s.valueTokens.splice(u.tokenIndex,1);s.tokens=s.valueTokens.length}}}function s9(t,e,n,r,i){const{evaluateArithmeticWithBindings:s,evaluateBooleanWithBindings:l,evaluatePatternLiteral:c,parseArithmetic:u}=i;for(const f of t){const p=f.targetId,m=r[p];if(!m)continue;const w=e.get(f.id)||[];if(w.length>0){Array.isArray(m.valueTokens)||(m.valueTokens=[]);for(const y of w)try{let x;const{kind:b,ast:_}=y;_&&(_.type==="var"||_.type==="boolVar"||_.type==="pairVar")?x=(n||{})[_.name]:b==="arith"?x=s(_,n):b==="bool"?x=l(_,n,u):b==="pattern"?x=c(_,n||{}):b==="pair"&&_.type==="pairLit"&&(x=c(_,n||{})),Array.isArray(m.valueTokens)||(m.valueTokens=[]),typeof x=="number"?m.valueTokens.push(x|0):typeof x=="boolean"||typeof x=="string"||o9(x)?m.valueTokens.push(x):Array.isArray(x)&&(b==="arith"||b==="pair"||_&&(_.type==="list"||_.type==="listPattern"||_.type==="tuplePattern")?m.valueTokens.push(x):m.valueTokens.push(...x))}catch{}}else if(f.weight&&(f.weight|0)>0){const y=f.weight|0;for(let x=0;x<y;x++){const b=Object.values(n||{});if(Array.isArray(m.valueTokens)){const _=b[0];m.valueTokens.push(typeof _=="boolean"?!!_:Number.isFinite(_)?_|0:1)}else m.tokens=Number(m.tokens||0)+1|0}}else Array.isArray(m.valueTokens)?m.valueTokens.push(1):m.tokens=Number(m.tokens||0)+1|0;Array.isArray(m.valueTokens)&&(m.tokens=m.valueTokens.length)}}function o9(t){return!!(t&&typeof t=="object"&&t.__pair__===!0&&"fst"in t&&"snd"in t)}class a9 extends b5{constructor(){super(),this.maxTokens=1/0}getType(){return"pt"}async initializeSpecific(e,n={}){const r=Number(n.maxTokens);this.maxTokens=Number.isFinite(r)&&r>=0?r:1/0,this.validatePTNet(e),this.initializeTokens(e),we.debug("P/T Simulator initialized with",e.places.length,"places and",e.transitions.length,"transitions")}async updateSpecific(e){this.initializeTokens(e);const n=await this.getEnabledTransitionsSpecific();this.emitTransitionsChanged({enabled:n})}async getEnabledTransitionsSpecific(){if(!this.petriNet)return[];const{places:e,transitions:n,arcs:r}=this.petriNet,i=[];for(const s of n)this.isTransitionEnabled(s,e,r)&&i.push(s.id);return i}isTransitionEnabled(e,n,r){const i=r.filter(s=>s.target===e.id&&s.source!==e.id);for(const s of i){const l=n.find(f=>f.id===s.source);if(!l)continue;const c=s.weight||1;if((l.tokens||0)<c)return!1}return!0}async fireTransitionSpecific(e,n={}){const{places:r,transitions:i,arcs:s}=this.petriNet,l=n.skipEnabledCheck||!1,c=l?[]:await this.getEnabledTransitionsSpecific();if(!i.find(_=>_.id===e))throw new Error(`Transition ${e} not found`);const f=JSON.parse(JSON.stringify(this.petriNet)),p=f.places,m=s.filter(_=>_.target===e&&_.source!==e),w=s.filter(_=>_.source===e&&_.target!==e),y=[];for(const _ of m){const S=(_.weight||1)|0;for(let T=0;T<S;T++)y.push({srcId:_.source,countFallback:!0})}const x=Object.fromEntries(p.map(_=>[_.id,_]));T5(y,x);const b=w.map(_=>({id:_.id,sourceId:_.source,targetId:_.target,weight:_.weight||1}));for(const _ of b){const S=x[_.targetId];if(!S)continue;Array.isArray(S.valueTokens)&&delete S.valueTokens;const T=(_.weight||1)|0;S.tokens=Number(S.tokens||0)+T|0}for(const _ of p)Array.isArray(_.valueTokens)?(_.tokens=Math.min(this.maxTokens,Array.isArray(_.valueTokens)?_.valueTokens.length:_.tokens||0),delete _.valueTokens):_.tokens=Math.min(this.maxTokens,_.tokens||0);if(this.petriNet=f,!l){this.emitTransitionFired({transitionId:e,newPetriNet:f});const _=await this.getEnabledTransitionsSpecific();this.emitTransitionsChanged({enabled:_,previouslyEnabled:c})}return f}async stepSimulationSpecific(){return this.petriNet}resetSpecific(){this.maxTokens=1/0}validatePTNet(e){const{transitions:n}=e;for(const r of n){if(r.guard&&typeof r.guard=="string"&&(r.guard.includes("+")||r.guard.includes("-")||r.guard.includes("*")||r.guard.includes("/")||r.guard.includes("=")||r.guard.includes("<")||r.guard.includes(">")||r.guard.includes("!=")))throw new Error("P/T simulator cannot handle algebraic expressions. Use algebraic simulator instead.");if(r.action&&typeof r.action=="string"&&(r.action.includes("+")||r.action.includes("-")||r.action.includes("*")||r.action.includes("/")||r.action.includes("=")))throw new Error("P/T simulator cannot handle algebraic expressions. Use algebraic simulator instead.")}}initializeTokens(e){const{places:n}=e;for(const r of n)(r.tokens===void 0||r.tokens===null)&&(r.tokens=0),r.tokens=Math.min(this.maxTokens,Math.max(0,r.tokens))}getSimulationStats(){if(!this.isInitialized)return{enabledTransitions:[],totalTokens:0,totalPlaces:0,totalTransitions:0};const{places:e,transitions:n}=this.petriNet,r=e.reduce((s,l)=>s+(l.tokens||0),0);return{enabledTransitions:this.getEnabledTransitionsSync(),totalTokens:r,totalPlaces:e.length,totalTransitions:n.length}}getEnabledTransitionsSync(){if(!this.petriNet)return[];const{places:e,transitions:n,arcs:r}=this.petriNet,i=[];for(const s of n)this.isTransitionEnabled(s,e,r)&&i.push(s.id);return i}}function Ir(t,e){if(!t)return null;switch(t.type){case"pairLit":return{__pair__:!0,fst:Ir(t.fst,e),snd:Ir(t.snd,e)};case"list":return(t.elements||[]).map(n=>Ir(n,e));case"pairPattern":return{__pair__:!0,fst:Ir(t.fst,e),snd:Ir(t.snd,e)};case"tuplePattern":return(t.elements||t.components||[]).map(n=>Ir(n,e));case"listPattern":return(t.elements||[]).map(n=>Ir(n,e));case"boolLit":return!!t.value;case"int":return t.value|0;case"var":case"boolVar":case"pairVar":return(e||{})[t.name];default:return null}}function l9(t,e,n,r){var i;try{const s=(t.arcs||[]).filter(l=>l.sourceId===n&&(l.targetType==="place"||!l.targetType));for(const l of s){const c=((i=e==null?void 0:e.bindingAstsByArc)==null?void 0:i.get(l.id))||[];for(const u of c){const{ast:f}=u||{};if(f&&(f.type==="var"||f.type==="boolVar"||f.type==="pairVar")){const p=r?r[f.name]:void 0;if(p===void 0)continue;const m=f.varType;if(m==="int"&&typeof p!="number"||m==="bool"&&typeof p!="boolean"||m==="string"&&typeof p!="string"||m==="pair"&&!(p&&typeof p=="object"&&p.__pair__===!0)||m==="list"&&!Array.isArray(p))return!1}}}return!0}catch{return!1}}const u9=["concat","substring","length","head","tail","append","sublist","isSublistOf","isSubstringOf","fst","snd"],c9=new Set(u9);function d9(t,e,n,r){const i=new Map;for(const s of t.transitions||[])if(s.guard&&typeof s.guard=="string")try{const l=n(String(s.guard),e);i.set(s.id,l)}catch{try{const c=r(String(s.guard),e);i.set(s.id,c)}catch{}}return i}function f9(t,e){if(!t)return!1;const n=t.length;for(let r=0;r<n;r+=1){const i=t[r];if(!/[A-Za-z_]/.test(i))continue;let s=r+1;for(;s<n&&/[A-Za-z0-9_]/.test(t[s]);)s+=1;const l=t.slice(r,s);if(e.has(l)){let c=s;for(;c<n&&/\s/.test(t[c]);)c+=1;if(c<n&&t[c]==="(")return!0}r=s-1}return!1}function h9(t,e,n,r,i){const s=new Map;for(const l of t.arcs||[]){const c=l.id,u=Array.isArray(l.bindings)?l.bindings:l.binding?[l.binding]:[],f=[];for(const p of u){const m=String(p),w=m.trim(),y=f9(w,i),x=h=>{if(!h||typeof h!="object")return!0;switch(h.type){case"funcall":return i.has(h.name)?(h.args||[]).every(x):!1;case"pair":return x(h.fst)&&x(h.snd);case"list":return(h.elements||[]).every(x);case"binop":return x(h.left)&&x(h.right);default:return!0}},b=()=>{let h=null;try{h=n(m)}catch{h=null}return!h||!x(h)?!1:(h.type==="var"&&h.varType==="bool"?f.push({kind:"bool",ast:{type:"boolVar",name:h.name,varType:"bool"}}):h.type==="var"&&h.varType==="pair"?f.push({kind:"pair",ast:{type:"pairVar",name:h.name,varType:"pair"}}):f.push({kind:"arith",ast:h}),!0)},_=()=>{try{const h=e(m);return f.push({kind:"pattern",ast:h}),!0}catch{return!1}};let S=!1;if(y?(S=b(),S||(S=_())):(S=_(),S||(S=b())),S)continue;const T=m==="T"?!0:m==="F"?!1:null;if(T!==null){f.push({kind:"bool",ast:{type:"boolLit",value:T}});continue}try{f.push({kind:"bool",ast:r(m,n)});continue}catch{}}f.length&&s.set(c,f)}return s}function Vy(t){return!!(t&&typeof t=="object"&&t.__pair__===!0&&"fst"in t&&"snd"in t)}async function Wy({transition:t,inputArcs:e,placesById:n,bindingAstsByArc:r,guardAst:i,parseArithmetic:s,evaluateBooleanPredicate:l,matchPattern:c,getTokensForPlace:u,evaluateArithmeticWithBindings:f,evaluateBooleanWithBindings:p,evaluatePatternLiteral:m,maxTokensPerPlace:w=20}){const y=[],x=async(b,_)=>{if(b>=e.length){if(!i)return{env:_,picks:y};try{return p(i,_||{},s)?{env:_,picks:y}:null}catch{try{return await l(i,_||{},s)?{env:_,picks:y}:null}catch{return null}}}const S=e[b],T=S.id,h=S.sourceId||S.source,k=n[h],C=u(k,w),N=r.get(T)||[],A=N.length||(S.weight?Math.max(1,S.weight|0):0);if(A===0)return x(b+1,_);if(C.length<A)return null;const M=new Array(C.length).fill(!1),R=async(I,j)=>{if(I>=A)return x(b+1,j);for(let z=0;z<C.length;z++){if(M[z])continue;M[z]=!0;const W=C[z];let V=!0,D=j;const U=N[I];if(U){const{kind:G,ast:F}=U;if(G==="pattern"){const Y=c(F,W);if(Y===null)V=!1;else{for(const[X,te]of Object.entries(Y))if(D&&Object.prototype.hasOwnProperty.call(D,X)&&D[X]!==te){V=!1;break}V&&(D={...D||{},...Y})}}else if(F&&(F.type==="var"||F.type==="boolVar"||F.type==="pairVar"))D&&Object.prototype.hasOwnProperty.call(D,F.name)&&D[F.name]!==W?V=!1:(typeof W=="boolean"&&F.varType&&F.varType!=="bool"&&(V=!1),typeof W=="number"&&F.varType&&F.varType!=="int"&&(V=!1),typeof W=="string"&&F.varType&&F.varType!=="string"&&(V=!1),Array.isArray(W)&&F.varType&&F.varType!=="list"&&(V=!1),Vy(W)&&F.varType&&F.varType!=="pair"&&(V=!1),V&&(D={...D||{},[F.name]:W}));else if(G==="arith")try{const Y=f(F,j||{});(typeof W!="number"||Y!==(W|0))&&(V=!1)}catch{V=!1}else if(G==="bool")try{const Y=p(F,j||{},s);(typeof W!="bool"||Y!==W)&&(V=!1)}catch{V=!1}else if(G==="pair")try{if(F.type==="pairLit"){const Y=m(F,j||{});(!Vy(W)||JSON.stringify(Y)!==JSON.stringify(W))&&(V=!1)}}catch{V=!1}}if(V){y.push({arcId:S.id,srcId:h,tokenIndex:z,value:W,countFallback:!Array.isArray(k==null?void 0:k.valueTokens)});const G=await R(I+1,D);if(G)return G;y.pop()}M[z]=!1}return null};return R(0,_||{})};return x(0,{})}function E5(t){const e=new Set;function n(r){if(r)switch(r.type){case"var":e.add(r.name);break;case"pairPattern":n(r.fst),n(r.snd);break;case"listPattern":Array.isArray(r.elements)&&r.elements.forEach(n);break;case"tuplePattern":r.elements&&r.elements.forEach(n);break}}return n(t),Array.from(e)}function N5(t){const e=new Set;function n(r){if(r)switch(r.type){case"var":case"boolVar":case"pairVar":e.add(r.name);break;case"binop":case"cmp":n(r.left),n(r.right);break;case"unop":n(r.operand);break;case"call":r.args&&r.args.forEach(n);break;case"pairPattern":n(r.fst),n(r.snd);break;case"tuplePattern":r.elements&&r.elements.forEach(n);break;case"pairLit":n(r.fst),n(r.snd);break}}return n(t),Array.from(e)}function p9(t,e,n,r,i){const s=new Set;for(const u of i){const f=e.get(u.id)||[];for(const p of f){const{kind:m,ast:w}=p||{};m==="pattern"&&E5(w).forEach(x=>s.add(x))}}const l=n.get(r);if(l){const u=N5(l);for(const f of u)if(!s.has(f))return!0}const c=(t.arcs||[]).filter(u=>u.sourceId===r&&(u.targetType==="place"||!u.targetType));for(const u of c){const f=e.get(u.id)||[];if(f.length===0)return!0;for(const p of f){const{kind:m,ast:w}=p||{};if(m==="pattern"&&w.type==="var"&&!s.has(w.name))return!0}}return!1}function g9(t){const e=(t.places||[]).map(l=>({id:l.id,label:l.label||"",tokens:Number(Array.isArray(l.valueTokens)?l.valueTokens.length:l.tokens||0),x:Number(l.x||0),y:Number(l.y||0),name:l.name||"",type:"place",valueTokens:Array.isArray(l.valueTokens)?[...l.valueTokens]:void 0})),n=(t.transitions||[]).map(l=>({id:l.id,label:l.label||"",x:Number(l.x||0),y:Number(l.y||0),name:l.name||"",type:"transition",guard:l.guard,action:l.action})),r=new Set(e.map(l=>l.id)),i=new Set(n.map(l=>l.id)),s=(t.arcs||[]).map(l=>{const c=l.sourceId||l.source,u=l.targetId||l.target,f=r.has(c)?"place":i.has(c)?"transition":l.sourceType||"place",p=r.has(u)?"place":i.has(u)?"transition":l.targetType||"transition",m=l.type||`${f}-to-${p}`;return{id:l.id,sourceId:c,targetId:u,source:c,target:u,weight:Number(l.weight||1),sourceType:f,targetType:p,type:m,bindings:Array.isArray(l.bindings)?[...l.bindings]:l.binding?[l.binding]:[]}});return{places:e,transitions:n,arcs:s}}let jr=[],m9=1;const Ka=new Map;let $y=0,Hh=null;const Cl=typeof Worker<"u",Sg=typeof SharedArrayBuffer<"u",kn={poolSize:0,idleTimeoutMs:3e5,prewarmOnAlgebraicMode:!0,solverTimeoutMs:1e4};function y9(){try{if(typeof globalThis<"u"){const t=globalThis;t.__Z3_SETTINGS__={...t.__Z3_SETTINGS__||{},...kn}}}catch{}}function Bo(t){return Math.max(0,(Number.isFinite(t)?t:0)|0)}function v9(t={}){typeof t.poolSize=="number"&&(kn.poolSize=Bo(t.poolSize)),typeof t.idleTimeoutMs=="number"&&(kn.idleTimeoutMs=Math.max(1e3,t.idleTimeoutMs|0)),typeof t.prewarmOnAlgebraicMode=="boolean"&&(kn.prewarmOnAlgebraicMode=t.prewarmOnAlgebraicMode),typeof t.solverTimeoutMs=="number"&&(kn.solverTimeoutMs=Math.max(0,t.solverTimeoutMs|0)),x9()}function P5(){if(!Cl)throw new Error("Z3 worker pool unavailable in this environment");if(!Sg)throw new Error("SharedArrayBuffer not available. COOP/COEP headers may not be set correctly.");const t=new Worker(new URL(""+new URL("z3.worker-1562d2b4.js",import.meta.url).href,self.location),{type:"module"});return t.onerror=e=>{console.error("Z3 worker error:",e)},t.onmessage=({data:e})=>{const{id:n,ok:r,result:i,error:s}=e||{},l=Ka.get(n);l&&(Ka.delete(n),r?l.resolve(i):l.reject(new Error(s)),M5())},t}function x9(){if(y9(),!Cl)return;const t=Bo(kn.poolSize);for(;jr.length<t;)jr.push(P5());for(;jr.length>t;){const e=jr.pop();try{e.terminate()}catch{}}}function w9(){if(!Cl)throw new Error("Z3 worker pool unavailable in this environment");if(Bo(kn.poolSize)<=0)throw new Error("Z3 worker pool disabled");jr.length===0&&jr.push(P5());const e=jr[$y%jr.length];return $y++,e}function M5(){Cl&&(kn.idleTimeoutMs<=0||(Hh&&clearTimeout(Hh),Hh=setTimeout(()=>{const t=Bo(kn.poolSize);for(;jr.length>t;){const e=jr.pop();try{e.terminate()}catch{}}},kn.idleTimeoutMs)))}function Uo(t,...e){const n=w9(),r=m9++;return new Promise((i,s)=>{const l=setTimeout(()=>{Ka.delete(r),s(new Error(`Z3 worker operation "${t}" timed out after ${kn.solverTimeoutMs}ms`))},kn.solverTimeoutMs||1e4);Ka.set(r,{resolve:c=>{clearTimeout(l),i(c)},reject:c=>{clearTimeout(l),s(c)}});try{n.postMessage({id:r,op:t,args:e})}catch(c){clearTimeout(l),Ka.delete(r),s(c);return}M5()})}function up(){return Bo(kn.poolSize)}function cp(){return Cl&&Sg&&Bo(kn.poolSize)>0}function S9(){return Sg}const _9=t=>Uo("parseBooleanExpr",t),dp=(t,e,n)=>Uo("evaluateBooleanPredicate",t,e),k9=(t,e,n)=>Uo("evaluateArithmeticWithBindings",t,e),b9=(t,e)=>Uo("evaluateAction",t,e),C9=(t,e)=>Uo("solveEquation",t,e),T9=(t,e,n)=>Uo("solveInequality",t,e,n),Qa=Object.freeze(Object.defineProperty({__proto__:null,evaluateAction:b9,evaluateArithmeticWithBindings:k9,evaluateBooleanPredicate:dp,getConfiguredPoolSize:up,isSharedArrayBufferAvailable:S9,isWorkerPoolEnabled:cp,parseBooleanExpr:_9,setZ3WorkerConfig:v9,solveEquation:C9,solveInequality:T9},Symbol.toStringTag,{value:"Module"})),Yh=async(t,e,n)=>{try{if((typeof cp=="function"?cp():!1)&&typeof dp=="function")try{return await dp(t,e,n)}catch{}}catch{}return Aw(t,e,n)},Hy=t=>JSON.parse(JSON.stringify(t||{places:[],transitions:[],arcs:[]})),E9=(t,e)=>{const n=new Set,r=l=>{if(l)switch(l.type){case"boolVar":case"pairVar":n.add(l.name);break;case"and":case"or":r(l.left),r(l.right);break;case"not":r(l.expr);break;case"cmp":i(l.left),i(l.right);break}},i=l=>{l&&(l.type==="var"||l.type==="boolVar"||l.type==="pairVar"?n.add(l.name):l.type==="bin"?(i(l.left),i(l.right)):l.type==="pairLit"&&(i(l.fst),i(l.snd)))};r(t);const s=new Set(Object.keys(e||{}));return Array.from(n).filter(l=>!s.has(l))},Yy=t=>{try{const e=Array.isArray(t==null?void 0:t.transitions)?t.transitions.slice():[],n=Array.isArray(t==null?void 0:t.arcs)?t.arcs.slice():[];e.sort((s,l)=>String(s.id).localeCompare(String(l.id))),n.sort((s,l)=>String(s.id).localeCompare(String(l.id)));const r=e.map(s=>`${s.id}|g:${String(s.guard||"")}|a:${String(s.action||"")}`).join(";"),i=n.map(s=>`${s.id}|b:${Array.isArray(s.bindings)?s.bindings.join(","):s.binding?String(s.binding):""}`).join(";");return`${r}||${i}`}catch{return String(Math.random())}};class N9 extends b5{constructor(){super(),this.lastEnabledTransitions=[],this.cache={guardAstByTransition:new Map,bindingAstsByArc:new Map},this._cacheSignature=null,this._config={maxTokensPerPlace:1/0},this._enabledCache=new Map}getType(){return"algebraic"}async initializeSpecific(e,n={}){this.lastEnabledTransitions=[],this._enabledCache.clear(),this._cacheSignature=null,this.petriNet=Hy(e),n&&typeof n.maxTokensPerPlace=="number"&&n.maxTokensPerPlace>=0?this._config.maxTokensPerPlace=n.maxTokensPerPlace|0:this._config.maxTokensPerPlace=1/0,await this.buildCaches(),await this.checkTransitionStateChanges()}async buildCaches(){this.cache.guardAstByTransition.clear(),this.cache.bindingAstsByArc.clear(),this.cache.guardAstByTransition=d9(this.petriNet,Vt,Ro,Mw),this.cache.bindingAstsByArc=h9(this.petriNet,y5,Vt,Ro,c9),this._cacheSignature=Yy(this.petriNet)}getStatus(){var e,n,r;return{isInitialized:this.isInitialized,hasPyodide:!1,hasSimulator:!0,hasPetriNet:!!this.petriNet,simulationMode:this.simulationMode,petriNetSize:this.petriNet?{places:((e=this.petriNet.places)==null?void 0:e.length)||0,transitions:((n=this.petriNet.transitions)==null?void 0:n.length)||0,arcs:((r=this.petriNet.arcs)==null?void 0:r.length)||0}:null}}async setSimulationMode(e){if(e==="single"||e==="maximal")this.simulationMode=e;else throw new Error("Mode must be 'single' or 'maximal'")}_outputBindingsTypeCompatible(e,n){return l9(this.petriNet,this.cache,e,n)}_invalidateEnabledCache(e){if(!e||e.size===0)return;const n=this.petriNet.arcs||[];for(const r of n){const i=r.sourceId||r.source;if((r.type==="place-to-transition"||r.sourceType==="place")&&e.has(i)){const l=String(r.targetId||r.target);this._enabledCache.delete(l)}}}_clearEnabledCache(){this._enabledCache.clear()}async updateSpecific(e){const r=Yy(e)!==this._cacheSignature;this.petriNet=Hy(e),r&&await this.buildCaches(),this._clearEnabledCache(),await this.checkTransitionStateChanges()}async getEnabledTransitionsSpecific(){const e=Array.isArray(this.petriNet.transitions)?this.petriNet.transitions:[];if(e.length===0)return[];const n=[];for(let i=0;i<e.length;i++){const s=String(e[i].id);this._enabledCache.has(s)||n.push(e[i])}if(n.length>0){const i=typeof up=="function"?Number(up()||0):0,s=Math.max(1,Math.min(n.length,i>0?i:1));if(s<=1)for(const l of n)try{const c=await this.isTransitionEnabled(l.id);this._enabledCache.set(String(l.id),c)}catch{this._enabledCache.set(String(l.id),!1)}else{const l=new Array(n.length).fill(!1);let c=0;const u=async()=>{for(;;){const p=c++;if(p>=n.length)break;const m=n[p];try{const w=await this.isTransitionEnabled(m.id);l[p]=w}catch{}}},f=Array.from({length:s},()=>u());await Promise.all(f);for(let p=0;p<n.length;p++)this._enabledCache.set(String(n[p].id),l[p])}}const r=[];for(const i of e){const s=String(i.id);this._enabledCache.get(s)===!0&&r.push(s)}return r}async checkForUnboundVariables(e,n){return p9(this.petriNet,this.cache.bindingAstsByArc,this.cache.guardAstByTransition,e,n)}extractVariablesFromPattern(e){return E5(e)}extractVariablesFromExpression(e){return N5(e)}async isTransitionEnabled(e){if(!this.isInitialized)return!1;const n=(this.petriNet.transitions||[]).find(u=>u.id===e);if(!n)return!1;const r=(this.petriNet.arcs||[]).filter(u=>(u.targetId===e||u.target===e)&&(u.sourceType==="place"||!u.sourceType));if(r.length===0)return!0;if(await this.checkForUnboundVariables(e,r))return we.debug("Transition disabled due to unbound variables:",e),!1;const s=this.cache.guardAstByTransition.get(e),l=Object.fromEntries((this.petriNet.places||[]).map(u=>[u.id,u])),c=await Wy({transition:n,inputArcs:r,placesById:l,bindingAstsByArc:this.cache.bindingAstsByArc,guardAst:s,parseArithmetic:Vt,evaluateBooleanPredicate:Yh,matchPattern:Dy,getTokensForPlace:zy,evaluateArithmeticWithBindings:pr,evaluateBooleanWithBindings:Co,evaluatePatternLiteral:Ir,maxTokensPerPlace:this._config.maxTokensPerPlace});return c?this._outputBindingsTypeCompatible(e,c.env||{}):!1}async stepSimulationSpecific(){return this.getCurrentState()}async fireTransitionSpecific(e,n={}){const r=n.skipEnabledCheck||!1,i=r?[]:await this.getEnabledTransitionsSpecific(),s=(this.petriNet.transitions||[]).find(x=>x.id===e);if(!s)return this.getCurrentState();const l=(this.petriNet.arcs||[]).filter(x=>(x.targetId===e||x.target===e)&&(x.sourceType==="place"||!x.sourceType)),c=(this.petriNet.arcs||[]).filter(x=>(x.sourceId===e||x.source===e)&&(x.targetType==="place"||!x.targetType)),u=Object.fromEntries((this.petriNet.places||[]).map(x=>[x.id,x])),f=this.cache.guardAstByTransition.get(e),p=await Wy({transition:s,inputArcs:l,placesById:u,bindingAstsByArc:this.cache.bindingAstsByArc,guardAst:f,parseArithmetic:Vt,evaluateBooleanPredicate:Yh,matchPattern:Dy,getTokensForPlace:zy,evaluateArithmeticWithBindings:pr,evaluateBooleanWithBindings:Co,evaluatePatternLiteral:Ir,maxTokensPerPlace:this._config.maxTokensPerPlace});if(!p)throw new Error(`Transition ${e} is not enabled`);let m=p.env||{};const w=p.picks||[];if(f&&E9(f,m).length>0)try{if(!await Yh(f,m,Vt))throw new Error("Guard unsatisfied under any extension")}catch{}const y=new Set;for(const x of w)y.add(x.srcId);for(const x of c)y.add(x.targetId||x.target);if(T5(w,u),s9(c,this.cache.bindingAstsByArc,m,u,{evaluateArithmeticWithBindings:pr,evaluateBooleanWithBindings:Co,evaluatePatternLiteral:Ir,parseArithmetic:Vt}),s.action&&typeof s.action=="string")try{const x=Rw(s.action,m,Vt)}catch{}if(this._invalidateEnabledCache(y),!r){await this.checkTransitionStateChanges();const x=this.getCurrentState();this.emitTransitionFired({transitionId:e,newPetriNet:x});const b=await this.getEnabledTransitionsSpecific();return this.emitTransitionsChanged({enabled:b,previouslyEnabled:i}),x}return this.getCurrentState()}getCurrentState(){return g9(this.petriNet)}async checkTransitionStateChanges(){if(this.isInitialized)try{const e=await this.getEnabledTransitionsSpecific();if(JSON.stringify([...e].sort())!==JSON.stringify([...this.lastEnabledTransitions].sort())){const r=[...this.lastEnabledTransitions];this.lastEnabledTransitions=[...e],this.emitTransitionsChanged({enabled:e,previouslyEnabled:r})}}catch{}}resetSpecific(){this.lastEnabledTransitions=[],this.cache.guardAstByTransition.clear(),this.cache.bindingAstsByArc.clear(),this._cacheSignature=null,this._config.maxTokensPerPlace=1/0,this._clearEnabledCache()}}class P9{static createSimulator(e){switch(e){case"pt":return new a9;case"algebraic":return new N9;default:throw new Error(`Unknown net mode: ${e}`)}}static getAvailableTypes(){return["pt","algebraic"]}static isSupported(e){return this.getAvailableTypes().includes(e)}}const Xy=async()=>{try{await new Promise(t=>setTimeout(t,0))}catch{}try{typeof requestAnimationFrame<"u"&&await new Promise(t=>requestAnimationFrame(()=>t()))}catch{}},M9=t=>{const e=new Set;if(!t||!Array.isArray(t.transitions))return e;const n=Array.isArray(t.arcs)?t.arcs:[],r=Array.isArray(t.places)?t.places:[],i=new Set(r.map(s=>String(s.id)));for(const s of t.transitions){const l=String(s.id);let c=!1,u=!1;for(const f of n){const p=String(f.sourceId||f.source),m=String(f.targetId||f.target);if(m===l&&p!==l&&i.has(p)&&(c=!0),p===l&&m!==l&&i.has(m)&&(u=!0),c&&u)break}!c&&!u&&e.add(l)}return e},A9=(t,e,n)=>{const r=new Map;for(const c of t)r.set(c,new Set);for(const c of e||[]){const u=c.targetId||c.target,f=c.sourceId||c.source;(c.type==="place-to-transition"||c.sourceType==="place")&&r.has(u)&&r.get(u).add(f)}const i=t.slice();for(let c=i.length-1;c>0;c--){const u=Math.random()*(c+1)|0,f=i[c];i[c]=i[u],i[u]=f}const s=new Set,l=[];for(const c of i){const u=r.get(c)||new Set;let f=!0;for(const p of u)if(s.has(p)){f=!1;break}if(f){l.push(c);for(const p of u)s.add(p);if(n>0&&l.length>=n)break}}return l},I9=(t=[])=>t.map(e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){if(e.id)return e.id;if(e.get)return e.get("id")}return String(e)}).filter(Boolean),R9=async({simulator:t,mode:e="single",maxSteps:n=1e5,timeBudgetMs:r=3e4,yieldEvery:i=100,onProgress:s,shouldCancel:l,batchMax:c=0,progressEveryMs:u=0,yieldEveryMs:f=0})=>{const p=typeof performance<"u"&&performance.now?()=>performance.now():()=>Date.now(),m=p();let w=0,y=m,x=m,b=-1;const _=C=>{if(!s)return;const N=C-m,A=u>0?Math.floor(N/u):0;if(A!==b){b=A;try{s({steps:w,elapsedMs:N})}catch{}}},S=M9(t.petriNet||{}),T=async()=>{const C=await t.getEnabledTransitions();return I9(C).filter(A=>!S.has(String(A)))},h=async()=>{if(l&&l())return!1;const C=p(),N=C-m;if(i>0&&w%i===0){const A=p();_(A),await Xy();const M=p();return x=M,y=M,u>0&&_(M),!(r>0&&M-m>r||l&&l())}if(u>0&&C-y>=u&&(_(C),y=C),f>0&&C-x>=f){await Xy();const A=p();if(x=A,u>0&&A-y>=u&&(_(A),y=A),r>0&&A-m>r||l&&l())return!1}return!(r>0&&N>r||l&&l())};let k=!0;for(;k&&w<n&&!(l&&l());){const C=await T();if(!C||C.length===0)break;if(e==="maximal"){const N=t.petriNet||{},A=c>0?c:Number.POSITIVE_INFINITY;let M=A9(C,N.arcs||[],A);if(!M||M.length===0){const R=C[Math.floor(Math.random()*C.length)];M=R?[R]:[]}if(l&&l()){k=!1;break}await Promise.all(M.map(R=>t.fireTransition(R,{skipEnabledCheck:!0}))),w+=M.length,k=await h()}else{const N=C[Math.floor(Math.random()*C.length)];await t.fireTransition(N),w+=1,k=await h()}}if(s)try{s({steps:w,elapsedMs:p()-m})}catch{}return{petriNet:t.petriNet||null,steps:w}},Ky=(t,e={})=>{we.debug("determineNetMode called with:",{petriNet:t,options:e});const n=(e==null?void 0:e.netMode)||(t==null?void 0:t.netMode);if(we.debug("Found netMode from options/petriNet:",n),n){const r=n==="algebraic-int"?"algebraic":n;return we.debug("Using configured netMode:",r),r}return we.debug("No configured netMode, detecting from content"),A5(t)},A5=t=>{const e=t||{},n=Array.isArray(e.transitions)?e.transitions:[],r=Array.isArray(e.arcs)?e.arcs:[],i=Array.isArray(e.places)?e.places:[];we.debug("Net mode detection:",{places:i,transitions:n,arcs:r});for(const s of n){if(typeof s.guard=="string"&&s.guard.trim().length>0)return we.debug("Found guard, using algebraic mode"),"algebraic";if(typeof s.action=="string"&&s.action.trim().length>0)return we.debug("Found action, using algebraic mode"),"algebraic"}for(const s of r){const l=Array.isArray(s.bindings)?s.bindings:s.binding?[s.binding]:[];if(we.debug("Checking arc bindings:",l),l.some(u=>typeof u=="string"&&(/:[ ]*(integer|boolean)/i.test(u)||u==="T"||u==="F"||/[+\-*/()]/.test(u))))return we.debug("Found algebraic binding, using algebraic mode"),"algebraic"}return i.some(s=>Array.isArray(s.valueTokens)&&s.valueTokens.length>0)?(we.debug("Found valueTokens, using algebraic mode"),"algebraic"):(we.debug("Using P/T mode"),"pt")};class L9{constructor(){this.currentSimulator=null,this._ready=!1,this.netMode=null,this.eventBus=null,this.pendingListeners=new Map}async initialize(e,n={}){try{we.debug("SimulatorCore.initialize called with:",{petriNet:e,options:n});const r=Ky(e,n);return this.currentSimulator=P9.createSimulator(r),this.netMode=r,this.eventBus&&this.currentSimulator.setEventBus(this.eventBus),await this.currentSimulator.initialize(e,n),this._ready=!0,this.setupPendingListeners(),we.debug(`Simulator initialized with ${r} simulator`),{success:!0,netMode:r,simulatorType:this.currentSimulator.getType()}}catch(r){throw console.error("Failed to initialize simulator:",r),this._ready=!1,this.currentSimulator=null,r}}async update(e){if(!this.currentSimulator)return{success:!0};try{return await this.currentSimulator.update(e),{success:!0}}catch(n){throw console.error("Failed to update simulator:",n),n}}async getEnabledTransitions(){if(!this.currentSimulator)return[];try{return await this.currentSimulator.getEnabledTransitions()}catch(e){return console.error("Failed to get enabled transitions:",e),[]}}async fireTransition(e){if(!this.currentSimulator)throw new Error("Simulator not initialized");try{return await this.currentSimulator.fireTransition(e)}catch(n){throw console.error(`Failed to fire transition ${e}:`,n),n}}async stepSimulation(){if(!this.currentSimulator)throw new Error("Simulator not initialized");try{const e=await this.currentSimulator.getEnabledTransitions();if(!e||e.length===0)return this.currentSimulator.petriNet||null;const n=e[Math.floor(Math.random()*e.length)],r=typeof n=="string"?n:n&&n.id?n.id:String(n);return await this.currentSimulator.fireTransition(r)}catch(e){throw console.error("Failed to step simulation:",e),e}}async runToCompletion({mode:e="single",maxSteps:n=1e5,timeBudgetMs:r=3e4,yieldEvery:i=100,onProgress:s,shouldCancel:l,batchMax:c=0,progressEveryMs:u=0,yieldEveryMs:f=0}={}){if(!this.currentSimulator)throw new Error("Simulator not initialized");const p=this.currentSimulator.eventBus||null;try{this.currentSimulator.setEventBus&&this.currentSimulator.setEventBus(null)}catch{}try{return this.currentSimulator.setSimulationMode&&(this.currentSimulator.simulationMode=e),await R9({simulator:this.currentSimulator,mode:e,maxSteps:n,timeBudgetMs:r,yieldEvery:i,onProgress:s,shouldCancel:l,batchMax:c,progressEveryMs:u,yieldEveryMs:f})}finally{try{this.currentSimulator.setEventBus&&this.currentSimulator.setEventBus(p)}catch{}}}reset(){this.currentSimulator&&this.currentSimulator.reset(),this.currentSimulator=null,this._ready=!1,this.netMode=null,this.pendingListeners.clear()}deactivateSimulation(){this._active=!1}activateSimulation(e=!1){if(!this.currentSimulator)throw new Error("Simulator not initialized");we.debug(`Simulation activated (continuous: ${e})`)}async isReady(){return this._ready&&this.currentSimulator&&this.currentSimulator.isReady()}getSimulatorStatus(){var e;return{isReady:this._ready,netMode:this.netMode,simulatorType:((e=this.currentSimulator)==null?void 0:e.getType())||"none",simulatorStatus:{simulator:this.currentSimulator}}}getSimulatorType(){var e;return((e=this.currentSimulator)==null?void 0:e.getType())||"none"}getSimulationMode(){var e;return((e=this.currentSimulator)==null?void 0:e.simulationMode)||"single"}setSimulationMode(e){this.currentSimulator&&(this.currentSimulator.simulationMode=e)}setEventBus(e){this.eventBus=e,this.currentSimulator&&this.currentSimulator.setEventBus(e)}__queueListener(e,n){this.pendingListeners.has(e)||this.pendingListeners.set(e,[]),this.pendingListeners.get(e).push(n)}setupPendingListeners(){if(!(!this.currentSimulator||!this.eventBus)){for(const[e,n]of this.pendingListeners)for(const r of n)this.eventBus.on(e,r);this.pendingListeners.clear()}}determineNetMode(e,n){return Ky(e,n)}detectNetModeFromContent(e){return A5(e)}}const Ai=new L9;function j9(){try{return typeof window>"u"||typeof Worker>"u"||typeof process<"u"&&process.env&&{}.JEST_WORKER_ID?null:new Worker(new URL(""+new URL("simulation.worker-04867299.js",import.meta.url).href,self.location),{type:"module"})}catch(t){return console.error("Failed to create simulation worker:",t),null}}var F9="Expected a function",Qy=0/0,O9="[object Symbol]",D9=/^\s+|\s+$/g,z9=/^[-+]0x[0-9a-f]+$/i,B9=/^0b[01]+$/i,U9=/^0o[0-7]+$/i,G9=parseInt,V9=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,W9=typeof self=="object"&&self&&self.Object===Object&&self,$9=V9||W9||Function("return this")(),H9=Object.prototype,Y9=H9.toString,X9=Math.max,K9=Math.min,Xh=function(){return $9.Date.now()};function Q9(t,e,n){var r,i,s,l,c,u,f=0,p=!1,m=!1,w=!0;if(typeof t!="function")throw new TypeError(F9);e=Zy(e)||0,fp(n)&&(p=!!n.leading,m="maxWait"in n,s=m?X9(Zy(n.maxWait)||0,e):s,w="trailing"in n?!!n.trailing:w);function y(N){var A=r,M=i;return r=i=void 0,f=N,l=t.apply(M,A),l}function x(N){return f=N,c=setTimeout(S,e),p?y(N):l}function b(N){var A=N-u,M=N-f,R=e-A;return m?K9(R,s-M):R}function _(N){var A=N-u,M=N-f;return u===void 0||A>=e||A<0||m&&M>=s}function S(){var N=Xh();if(_(N))return T(N);c=setTimeout(S,b(N))}function T(N){return c=void 0,w&&r?y(N):(r=i=void 0,l)}function h(){c!==void 0&&clearTimeout(c),f=0,r=u=i=c=void 0}function k(){return c===void 0?l:T(Xh())}function C(){var N=Xh(),A=_(N);if(r=arguments,i=this,u=N,A){if(c===void 0)return x(u);if(m)return c=setTimeout(S,e),y(u)}return c===void 0&&(c=setTimeout(S,e)),l}return C.cancel=h,C.flush=k,C}function fp(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function Z9(t){return!!t&&typeof t=="object"}function q9(t){return typeof t=="symbol"||Z9(t)&&Y9.call(t)==O9}function Zy(t){if(typeof t=="number")return t;if(q9(t))return Qy;if(fp(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=fp(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(D9,"");var n=B9.test(t);return n||U9.test(t)?G9(t.slice(2),n?2:8):z9.test(t)?Qy:+t}var J9=Q9;const eS=xl(J9),tS=({elements:t,netMode:e,simulatorCore:n,setElements:r,updateHistory:i,setEnabledTransitionIds:s,setIsSimulatorReady:l,setSimulationError:c,latestElementsRef:u,forceResetCounter:f})=>{O.useEffect(()=>{u.current=t},[t,u]),O.useEffect(()=>{try{n.setEventBus(Ca)}catch{}},[n]),O.useEffect(()=>{(async()=>{var x,b;if(!(t&&t.places&&t.transitions&&t.arcs&&t.places.length>0&&t.transitions.length>0&&t.arcs.length>0)){try{await((x=n.deactivateSimulation)==null?void 0:x.call(n)),await((b=n.reset)==null?void 0:b.call(n)),s([]),l(!1),c(null)}catch(_){we.error("Failed to reset simulator:",_)}return}try{we.debug("Simulator force reset counter:",f),we.debug("Initializing/updating simulator",{elements:t,netMode:e}),await n.initialize(t,{netMode:e})}catch(_){we.error("Failed to initialize simulator:",_),s([]),l(!1);return}try{await n.update(u.current)}catch(_){we.error("Failed to update simulator:",_),s([]),l(!1),c("Failed to update simulator");return}try{if(n.isReady&&await n.isReady()){const _=await n.getEnabledTransitions();s(_||[]),l(_&&_.length>0)}else{const _=i9(u.current),S=(_==null?void 0:_.enabledTransitions)||[];s(S),l(S.length>0)}c(_=>_==="Failed to update simulator"?null:_)}catch(_){we.error("Failed to compute enabled transitions:",_),s([]),l(!1),c("Failed to update simulator")}})()},[t,e,n,f,s,l,c,u]),O.useEffect(()=>{const w=x=>{s(x.enabled||[]),l(x.hasEnabled);try{typeof window<"u"&&(window.__ENABLED_TRANSITIONS__=Array.isArray(x.enabled)?x.enabled:[])}catch{}},y=x=>{try{typeof window<"u"&&(window.__LAST_FIRED_TRANSITION_ID__=x.transitionId||null)}catch{}x.newPetriNet&&(r(x.newPetriNet),u.current=x.newPetriNet,i&&i(x.newPetriNet,!0))};return Ca.on(vo.transitionsChanged,w),Ca.on(vo.transitionFired,y),()=>{Ca.off(vo.transitionsChanged,w),Ca.off(vo.transitionFired,y)}},[r,i,s,l,u]),O.useEffect(()=>()=>{try{n.deactivateSimulation()}catch{}},[n]);const p=O.useCallback(async()=>{try{if(n.isReady&&await n.isReady()){const w=await n.getEnabledTransitions();s(w||[]);const y=Array.isArray(w)&&w.length>0;return l(y),w||[]}return s([]),l(!1),[]}catch(w){return console.error("Error refreshing enabled transitions:",w),c("Failed to refresh enabled transitions"),[]}},[n,s,l,c]),m=O.useMemo(()=>eS(p,100),[p]);return O.useEffect(()=>()=>{m.cancel()},[m]),{refreshEnabledTransitions:p,debouncedRefresh:m}};class nS{constructor(){this.conflictCache=new Map}areTransitionsInConflict(e,n,r,i){const s=`${e}-${n}`,l=`${n}-${e}`;if(this.conflictCache.has(s))return this.conflictCache.get(s);if(this.conflictCache.has(l))return this.conflictCache.get(l);const c=this._requiredCategories(e,i),u=this._requiredCategories(n,i);let f=!1;for(const[p,m]of c.entries()){const w=u.get(p);if(w&&(m.has("int")&&w.has("int")||m.has("bool")&&w.has("bool"))){f=!0;break}}return this.conflictCache.set(s,f),f}_requiredCategories(e,n){const r=new Map;for(const i of n){const s=i.sourceId||i.source;if(!((i.targetId||i.target)===e&&(i.sourceType==="place"||i.type==="place-to-transition")))continue;const c=Array.isArray(i.bindings)?i.bindings:i.binding?[i.binding]:[];r.has(s)||r.set(s,new Set);const u=r.get(s);for(const f of c){const p=String(f||"");/:[ ]*boolean/i.test(p)||p==="T"||p==="F"?u.add("bool"):u.add("int")}c.length===0&&u.add("int")}return r}findNonConflictingTransitions(e,n,r){if(e.length<=1)return e;this.conflictCache.clear();const i=[];for(let s=e.length;s>=1;s--){const l=this.getCombinations(e,s);for(const c of l)this.isNonConflictingSet(c,n,r)&&i.push(c);if(i.length>0)return i}return e.map(s=>[s])}isNonConflictingSet(e,n,r){for(let i=0;i<e.length;i++)for(let s=i+1;s<e.length;s++)if(this.areTransitionsInConflict(e[i].id,e[s].id,n,r))return!1;return!0}getCombinations(e,n){if(n===0)return[[]];if(n>e.length)return[];const r=[],i=(s,l)=>{if(l.length===n){r.push([...l]);return}for(let c=s;c<e.length;c++)l.push(e[c]),i(c+1,l),l.pop()};return i(0,[]),r}getInputPlaces(e,n,r){const i=[];for(const s of r){const l=s.sourceId||s.source,c=s.targetId||s.target;if(s.sourceType==="place"&&c===e||s.type==="place-to-transition"&&c===e){const f=n.find(p=>p.id===l);f&&i.push(f)}}return i}getOutputPlaces(e,n,r){const i=[];for(const s of r){const l=s.sourceId||s.source,c=s.targetId||s.target;if(s.targetType==="place"&&l===e||s.type==="transition-to-place"&&l===e){const f=n.find(p=>p.id===c);f&&i.push(f)}}return i}clearCache(){this.conflictCache.clear()}getCacheStats(){return{size:this.conflictCache.size,keys:Array.from(this.conflictCache.keys())}}}const rS=1e3,Oc=t=>(t||[]).map(e=>typeof e=="string"?e:e&&typeof e=="object"?e.id??(e.get?e.get("id"):void 0):String(e)).filter(Boolean),I5=t=>(t.current||(t.current=new nS),t.current),iS=({simulatorCore:t,setElements:e,updateHistory:n,clearError:r,refreshEnabledTransitions:i,setSimulationError:s,latestElementsRef:l})=>async c=>{try{if(t.getSimulatorType&&t.getSimulatorType()==="none")throw new Error("Simulator not initialized. Please wait for initialization to complete.");await t.activateSimulation(!1);const u=await t.fireTransition(c);if(!u||typeof u!="object")throw new Error("Invalid Petri net returned from simulator");if(!u.places||!Array.isArray(u.places)||!u.transitions||!Array.isArray(u.transitions)||!u.arcs||!Array.isArray(u.arcs))throw new Error("Incomplete Petri net structure returned from simulator");const f=JSON.parse(JSON.stringify(u));e(f),l.current=f,n&&n(f,!0),r(),await i(),setTimeout(()=>{try{t.activateSimulation()}catch{}},50)}catch(u){console.error(`Error firing transition ${c}:`,u),s(u.message||`Failed to fire transition ${c}.`)}},sS=({simulatorCore:t,handleFireTransition:e,conflictResolverRef:n,latestElementsRef:r,refreshEnabledTransitions:i,setSimulationError:s,stopAllSimulations:l})=>async()=>{var c,u;try{if(t.getSimulatorType&&t.getSimulatorType()==="none")throw new Error("Simulator not initialized. Please wait for initialization to complete.");let f="single";try{f=t.getSimulationMode?t.getSimulationMode():"single"}catch{}if(f==="maximal"){const y=await t.getEnabledTransitions();if(!y||y.length===0)return;const x=I5(n),b=Oc(y).map(k=>({id:k})),_=x.findNonConflictingTransitions(b,((c=r.current)==null?void 0:c.places)||[],((u=r.current)==null?void 0:u.arcs)||[]),S=Array.isArray(_)?_:Array.from(_||[]),T=S.length?S[Math.floor(Math.random()*S.length)]:[],h=Array.isArray(T)?T:T?[T]:[];for(const k of h)await e(k.id);await i();return}const p=await t.getEnabledTransitions();if(!p||p.length===0)return;const m=Oc(p),w=m[Math.floor(Math.random()*m.length)];await e(w)}catch(f){console.error("Error in step simulation:",f),s("Error during simulation step: "+(f.message||"Unknown error")),l()}},oS=t=>new Promise(e=>setTimeout(e,t)),aS=({simulatorCore:t,isContinuousSimulatingRef:e,isRunningRef:n,setIsContinuousSimulating:r,setEnabledTransitionIds:i,stepSimulation:s,refreshEnabledTransitions:l,setSimulationError:c,simulationSettings:u={}})=>async()=>{if(!(e.current||n.current))try{await t.activateSimulation();const f=await t.getEnabledTransitions();if(!f||f.length===0)return;r(!0),e.current=!0;const p=Oc(f);i(p);const m=u.animationDelayMs??rS;for(;e.current;){await s();const w=await l();if(!w||w.length===0)break;await oS(m)}}catch(f){console.error("Error starting continuous simulation:",f),c("Failed to start continuous simulation")}finally{e.current=!1,r(!1);try{t.deactivateSimulation()}catch{}}},lS=(t,e)=>{const n=Number(t);return!Number.isFinite(n)||n<=0?null:Math.max(1,Math.min(e,Math.floor(n)))},uS=()=>{try{const t=window.__Z3_SETTINGS__||{};return{poolSize:Number.isFinite(Number(t.poolSize))?Number(t.poolSize):0,idleTimeoutMs:t.idleTimeoutMs,prewarmOnAlgebraicMode:t.prewarmOnAlgebraicMode,solverTimeoutMs:t.solverTimeoutMs}}catch{return{poolSize:0}}},cS=({simulationSettings:t})=>{let e=!1;try{e=!!window.__PETRI_NET_NON_VISUAL_RUN__}catch{}const n=typeof window<"u"&&window.__PETRI_NET_SETTINGS__?window.__PETRI_NET_SETTINGS__:{};!e&&(t!=null&&t.useNonVisualRun)&&(e=!0);const r=t==null?void 0:t.batchMode,i=r!==void 0?!!r:!!(n!=null&&n.batchMode);i&&(e=!0);const s=!!((t==null?void 0:t.limitIterations)??(n==null?void 0:n.limitIterations)),l=lS((t==null?void 0:t.maxIterations)??(n==null?void 0:n.maxIterations),1e6);return{useNonVisual:e,batchMode:i,limitIterationsFlag:s,maxIterations:l}},dS=({simulatorCore:t,isContinuousSimulatingRef:e,isRunningRef:n,setIsRunning:r,setIsContinuousSimulating:i,refreshEnabledTransitions:s,simulationSettings:l,ensureWorker:c,setElements:u,latestElementsRef:f,updateHistory:p,setSimulationError:m,conflictResolverRef:w,elements:y,handleFireTransition:x,setCompletionStats:b,netMode:_})=>async()=>{if(!(e.current||n.current))try{await t.activateSimulation(!1),r(!0),i(!1),n.current=!0,await s();const{useNonVisual:S,batchMode:T,limitIterationsFlag:h,maxIterations:k}=cS({simulationSettings:l}),C=2e5,N=h?k??C:C;let A=null,M=!1;const R=async D=>{try{if(A||(A=uS()),Number(A.poolSize||0)>=D)return;(await ni(()=>Promise.resolve().then(()=>Qa),void 0,import.meta.url)).setZ3WorkerConfig({...A,poolSize:D}),M=!0}catch{}},I=async()=>{if(M){try{(await ni(()=>Promise.resolve().then(()=>Qa),void 0,import.meta.url)).setZ3WorkerConfig(A||{})}catch{}M=!1}};let j=!1;if(T){if(!(await ni(()=>Promise.resolve().then(()=>Qa),void 0,import.meta.url)).isSharedArrayBufferAvailable()){const G="SharedArrayBuffer not available. This is required for batch mode. Please ensure COOP/COEP headers are set correctly (service worker should handle this). Try refreshing the page.";console.error(G),m(G),n.current=!1,r(!1);return}await R(8);const U=await c();if(U)try{let G="single";try{G=t.getSimulationMode?t.getSimulationMode():"single"}catch{}const F=setTimeout(()=>{U.removeEventListener("message",Y),U.removeEventListener("error",X);const te="Simulation worker timed out after 5 minutes. This may indicate that Z3 workers are not responding. Check browser console for errors.";console.error(te),m(te),I(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}},5*60*1e3),Y=async te=>{const{op:K,payload:ee}=te.data||{};if(K==="done"){clearTimeout(F),U.removeEventListener("message",Y),U.removeEventListener("error",X),ee&&ee.elements&&typeof ee.elements=="object"&&(u(ee.elements),f.current=ee.elements,p&&p(ee.elements,!0)),await I(),await s(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}ee!=null&&ee.stats&&b({elapsedMs:ee.stats.elapsedMs,transitionsFired:ee.stats.steps?ee.stats.steps.toLocaleString():"0"})}else K==="error"&&(clearTimeout(F),U.removeEventListener("message",Y),U.removeEventListener("error",X),m((ee==null?void 0:ee.message)||"Worker error"),await I(),n.current=!1,r(!1))},X=te=>{clearTimeout(F),U.removeEventListener("message",Y),U.removeEventListener("error",X);const K=`Worker error: ${te.message||"Unknown error"}. This may indicate that Z3 workers failed to initialize.`;console.error(K,te),m(K),I(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}};U.addEventListener("message",Y),U.addEventListener("error",X),U.postMessage({op:"start",payload:{elements:f.current,simOptions:{netMode:_},run:{mode:G,batchMax:0,maxSteps:N,timeBudgetMs:0,yieldEvery:5e3,progressEveryMs:0,yieldEveryMs:0},z3:typeof window<"u"?window.__Z3_SETTINGS__||{}:{}}}),j=!0}catch(G){console.error("Worker run failed, falling back to in-thread run:",G),m(`Worker initialization failed: ${G.message}. Falling back to in-thread execution.`),await I()}else{const G="Failed to create simulation worker. SharedArrayBuffer may not be available.";console.error(G),m(G),n.current=!1,r(!1);return}}if(j)return;if(S&&typeof t.runToCompletion=="function"){let D="single";try{D=t.getSimulationMode?t.getSimulationMode():"single"}catch{}const U=()=>{try{return!!window.__PETRI_NET_CANCEL_RUN__}catch{return!1}},G=performance.now?performance.now():Date.now();try{const F=await t.runToCompletion({mode:D,maxSteps:N,timeBudgetMs:0,yieldEvery:5e3,progressEveryMs:0,yieldEveryMs:0,onProgress:()=>{},shouldCancel:U,batchMax:0}),Y=performance.now?performance.now():Date.now(),X=Math.round(Y-G);F&&F.petriNet&&typeof F.petriNet=="object"&&(u(F.petriNet),f.current=F.petriNet,p&&p(F.petriNet,!0)),b({elapsedMs:X,transitionsFired:F!=null&&F.steps?F.steps.toLocaleString():"0"})}finally{await I(),await s(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}}return}let z=N;const W=I5(w),V=async()=>{if(!n.current){r(!1);return}if(z<=0){n.current=!1,r(!1);return}try{const D=await t.getEnabledTransitions();if(!D||D.length===0){n.current=!1,r(!1);return}const U=Oc(D).map(te=>({id:te})),G=W.findNonConflictingTransitions(U,y.places||[],y.arcs||[]),F=Array.isArray(G)?G:Array.from(G||[]),Y=F.length?F[Math.floor(Math.random()*F.length)]:[],X=Array.isArray(Y)?Y:Y?[Y]:[];for(const te of X){if(z<=0)break;await x(te.id),z-=1}if(z<=0){n.current=!1,r(!1);return}setTimeout(V,50)}catch(D){console.error("Error in run simulation:",D),m(D.message||"Error during simulation run"),n.current=!1,r(!1)}};V()}catch(S){console.error("Error starting run simulation:",S),m("Failed to start run simulation")}},fS=(t,e,n,r,i={},s)=>{const[l,c]=O.useState(!1),[u,f]=O.useState(!1),[p,m]=O.useState([]),[w,y]=O.useState(null),[x,b]=O.useState(!1),[_,S]=O.useState(0),[T,h]=O.useState(null),k=O.useRef(!1),C=O.useRef(!1),N=O.useRef(t),A=O.useRef(null),M=O.useRef(null),R=s||Ai,I=O.useCallback(async()=>{if(M.current)return M.current;try{const te=j9();return M.current=te,te}catch(te){return console.error("Failed to create simulation worker:",te),null}},[]),{refreshEnabledTransitions:j,debouncedRefresh:z}=tS({elements:t,netMode:r,simulatorCore:R,setElements:e,updateHistory:n,setEnabledTransitionIds:m,setIsSimulatorReady:b,setSimulationError:y,latestElementsRef:N,forceResetCounter:_});O.useEffect(()=>{N.current=t},[t]);const W=O.useCallback(()=>{y(null)},[]),V=O.useCallback(()=>{we.debug("Forcing simulator reset"),S(te=>te+1)},[]),D=O.useCallback(()=>{var te,K;c(!1),f(!1),k.current=!1,C.current=!1;try{R.deactivateSimulation()}catch{}W(),m([]);try{(K=(te=M.current)==null?void 0:te.postMessage)==null||K.call(te,{op:"cancel"})}catch{}},[W,R]);O.useEffect(()=>{l||u?(R.activateSimulation(),j()):(R.deactivateSimulation(),j())},[l,u,j]),O.useEffect(()=>((u||l)&&z(),()=>z.cancel()),[u,l,z]);const U=O.useMemo(()=>iS({simulatorCore:R,setElements:e,updateHistory:n,clearError:W,refreshEnabledTransitions:j,setSimulationError:y,latestElementsRef:N}),[R,e,n,W,j,y]),G=O.useMemo(()=>sS({simulatorCore:R,handleFireTransition:U,conflictResolverRef:A,latestElementsRef:N,refreshEnabledTransitions:j,setSimulationError:y,stopAllSimulations:D}),[R,U,A,j,y,D]),F=O.useMemo(()=>aS({simulatorCore:R,isContinuousSimulatingRef:k,isRunningRef:C,setIsContinuousSimulating:c,setEnabledTransitionIds:m,stepSimulation:G,refreshEnabledTransitions:j,setSimulationError:y,simulationSettings:i}),[R,k,C,c,m,G,j,y,i]),Y=O.useMemo(()=>dS({simulatorCore:R,isContinuousSimulatingRef:k,isRunningRef:C,setIsRunning:f,setIsContinuousSimulating:c,refreshEnabledTransitions:j,simulationSettings:i,ensureWorker:I,setElements:e,latestElementsRef:N,updateHistory:n,setSimulationError:y,conflictResolverRef:A,elements:t,handleFireTransition:U,setCompletionStats:h,netMode:r}),[R,k,C,f,c,j,i==null?void 0:i.limitIterations,i==null?void 0:i.maxIterations,i==null?void 0:i.batchMode,i==null?void 0:i.useNonVisualRun,I,e,N,n,y,A,t,U,h,r]),X=O.useCallback(()=>{h(null)},[]);return{isContinuousSimulating:l,isRunning:u,enabledTransitionIds:p,simulationError:w,isSimulatorReady:x,handleFireTransition:U,stepSimulation:G,startContinuousSimulation:F,startRunSimulation:Y,stopAllSimulations:D,clearError:W,forceSimulatorReset:V,completionStats:T,dismissCompletionDialog:X}};function hS(t){if(!t||typeof t!="object")return"pt";const e=Array.isArray(t.places)?t.places:[],n=Array.isArray(t.transitions)?t.transitions:[],r=Array.isArray(t.arcs)?t.arcs:[];return e.some(s=>Array.isArray(s.valueTokens)&&s.valueTokens.length>0||!!s.type)||n.some(s=>!!s.guard||!!s.action)||r.some(s=>Array.isArray(s.bindings)&&s.bindings.length>0||!!s.binding)?"algebraic-int":"pt"}function pS(t){const{elements:e,setElements:n,updateHistory:r,simulationSettings:i,setSimulationSettings:s,resetEditor:l,forceSimulatorReset:c,setIsLoading:u,setError:f,setSuccess:p,setIsAdtOpen:m,saveFileHandle:w,setSaveFileHandle:y,setIsMobileMenuOpen:x}=t||{},b=()=>{m&&m(!0)},_=async(C,N)=>{const A=await C.createWritable();await A.write(new Blob([N],{type:"application/xml"})),await A.close()};return{handleSave:async()=>{try{u==null||u(!0),f==null||f(null),p==null||p(null);const C={...e||{},netMode:(i==null?void 0:i.netMode)||"pt"},N=await Gy(C),A="petri-net.pnml";if(typeof window<"u"&&typeof window.showSaveFilePicker=="function")try{if(w)await _(w,N);else{const R=await window.showSaveFilePicker({suggestedName:A,types:[{description:"PNML Files",accept:{"application/xml":[".pnml",".xml"],"text/xml":[".pnml",".xml"]}}],excludeAcceptAllOption:!1});await _(R,N),y==null||y(R)}}catch(R){if(R&&(R.name==="AbortError"||R.name==="SecurityError"))p==null||p("Save cancelled.");else{const I=new Blob([N],{type:"application/xml"}),j=URL.createObjectURL(I),z=document.createElement("a");z.href=j,z.download=A,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(j)}}else{const R=new Blob([N],{type:"application/xml"}),I=URL.createObjectURL(R),j=document.createElement("a");j.href=I,j.download=A,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(I)}p==null||p("Petri net saved."),x==null||x(!1)}catch(C){console.error("Error saving Petri net:",C),f==null||f(`Error saving Petri net: ${C.message}`)}finally{u==null||u(!1)}},handleSaveAs:async()=>{try{u==null||u(!0),f==null||f(null),p==null||p(null);const C={...e||{},netMode:(i==null?void 0:i.netMode)||"pt"},N=await Gy(C),A="petri-net.pnml";if(typeof window<"u"&&typeof window.showSaveFilePicker=="function")try{const R=await window.showSaveFilePicker({suggestedName:A,types:[{description:"PNML Files",accept:{"application/xml":[".pnml",".xml"],"text/xml":[".pnml",".xml"]}}],excludeAcceptAllOption:!1});await _(R,N),y==null||y(R)}catch(R){if(R&&(R.name==="AbortError"||R.name==="SecurityError"))p==null||p("Save cancelled.");else{const I=new Blob([N],{type:"application/xml"}),j=URL.createObjectURL(I),z=document.createElement("a");z.href=j,z.download=A,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(j)}}else{const R=new Blob([N],{type:"application/xml"}),I=URL.createObjectURL(R),j=document.createElement("a");j.href=I,j.download=A,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(I)}p==null||p("Petri net saved."),x==null||x(!1)}catch(C){console.error("Error saving Petri net:",C),f==null||f(`Error saving Petri net: ${C.message}`)}finally{u==null||u(!1)}},handleLoad:()=>{const C=document.createElement("input");C.type="file",C.accept=".pnml,.xml";try{C.style.display="none",document.body.appendChild(C)}catch{}C.onchange=async N=>{const A=N.target.files[0];if(A)try{u==null||u(!0),f==null||f(null),p==null||p(null);const M=await new Promise((D,U)=>{const G=new FileReader;G.onload=F=>D(F.target.result),G.onerror=U,G.readAsText(A)});if(!M||String(M).trim()==="")throw new Error("The selected file is empty");if(!String(M).includes("<pnml")&&!String(M).includes("<PNML"))throw new Error("The file does not appear to be a valid PNML file");const R=e9(M),I=new Promise((D,U)=>{setTimeout(()=>U(new Error("Operation timed out. The file may be too large or invalid.")),1e4)}),j=await Promise.race([R,I]);if(!j||typeof j!="object")throw new Error("Invalid data structure in the imported file");const z={places:Array.isArray(j.places)?j.places:[],transitions:Array.isArray(j.transitions)?j.transitions:[],arcs:Array.isArray(j.arcs)?j.arcs:[]},W=(z.arcs||[]).filter(D=>{if(D.source==="undefined"||D.target==="undefined"||!D.source||!D.target)return!1;const U=z.places.some(F=>F.id===D.source)||z.transitions.some(F=>F.id===D.source),G=z.places.some(F=>F.id===D.target)||z.transitions.some(F=>F.id===D.target);return U&&G});z.arcs=W.map(D=>{if(!D.type||D.type!=="place-to-transition"&&D.type!=="transition-to-place"){const U=z.places.some(F=>F.id===D.source),G=z.places.some(F=>F.id===D.target);return U&&!G?{...D,type:"place-to-transition"}:!U&&G?{...D,type:"transition-to-place"}:{...D,type:"place-to-transition"}}return D}),c&&c(),n==null||n(z);const V=z.netMode;if(V)s==null||s(D=>({...D||{},netMode:V}));else try{const D=hS(z);s==null||s(U=>({...U||{},netMode:D}))}catch{}r&&r(z),p==null||p(`Petri net loaded successfully with ${z.places.length} places, ${z.transitions.length} transitions, and ${z.arcs.length} arcs.`),x==null||x(!1)}catch(M){console.error("Error loading Petri net:",M),f==null||f(`Error loading Petri net: ${M.message}`)}finally{u==null||u(!1);try{C&&C.parentNode&&C.parentNode.removeChild(C)}catch{}}},C.click()},handleClear:()=>{var C,N;try{(C=Ai.deactivateSimulation)==null||C.call(Ai),(N=Ai.reset)==null||N.call(Ai)}catch{}if(l)l();else{const A={places:[],transitions:[],arcs:[]};n==null||n(A),s==null||s(M=>({...M||{},netMode:"pt"})),r&&r(A)}p==null||p("Canvas cleared successfully."),x==null||x(!1)},handleOpenAdtManager:b}}const Ut=[];for(let t=0;t<256;++t)Ut.push((t+256).toString(16).slice(1));function gS(t,e=0){return(Ut[t[e+0]]+Ut[t[e+1]]+Ut[t[e+2]]+Ut[t[e+3]]+"-"+Ut[t[e+4]]+Ut[t[e+5]]+"-"+Ut[t[e+6]]+Ut[t[e+7]]+"-"+Ut[t[e+8]]+Ut[t[e+9]]+"-"+Ut[t[e+10]]+Ut[t[e+11]]+Ut[t[e+12]]+Ut[t[e+13]]+Ut[t[e+14]]+Ut[t[e+15]]).toLowerCase()}let Kh;const mS=new Uint8Array(16);function yS(){if(!Kh){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Kh=crypto.getRandomValues.bind(crypto)}return Kh(mS)}const vS=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qy={randomUUID:vS};function Wi(t,e,n){var i;if(qy.randomUUID&&!e&&!t)return qy.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??yS();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[n+s]=r[s];return e}return gS(r)}function Dc(t,e){const n=new Set((e||[]).filter(l=>l.type==="place"||l.type==="transition").map(l=>l.id)),r=(t.places||[]).filter(l=>n.has(l.id)),i=(t.transitions||[]).filter(l=>n.has(l.id)),s=(t.arcs||[]).filter(l=>n.has(l.source)&&n.has(l.target));return{places:r,transitions:i,arcs:s}}function zc(t,e,n){if(!t)return null;const r=new Map,i=n&&typeof n.x=="number"?n.x:(n==null?void 0:n.dx)||0,s=n&&typeof n.y=="number"?n.y:(n==null?void 0:n.dy)||0,l=[],c=(t.places||[]).map(p=>{const m=e();r.set(p.id,m);const w=typeof p.x=="number"&&isFinite(p.x)?p.x:0,y=typeof p.y=="number"&&isFinite(p.y)?p.y:0,x={...p,id:m,x:w+i,y:y+s};return l.push({id:m,type:"place"}),x}),u=(t.transitions||[]).map(p=>{const m=e();r.set(p.id,m);const w=typeof p.x=="number"&&isFinite(p.x)?p.x:0,y=typeof p.y=="number"&&isFinite(p.y)?p.y:0,x={...p,id:m,x:w+i,y:y+s};return l.push({id:m,type:"transition"}),x}),f=(t.arcs||[]).map(p=>({...p,id:e(),source:r.get(p.source),target:r.get(p.target)}));return{newPlaces:c,newTransitions:u,newArcs:f,newSelection:l}}function R5(t,e){const n=new Set(Array.isArray(e)?e.map(i=>typeof i=="string"?i:i.id):[]),r={...t};return r.places=(t.places||[]).filter(i=>!n.has(i.id)),r.transitions=(t.transitions||[]).filter(i=>!n.has(i.id)),r.arcs=(t.arcs||[]).filter(i=>!n.has(i.source)&&!n.has(i.target)),r}function L5(t){const{elements:e,setElements:n,selectedElement:r,selectedElements:i,clearSelection:s,setSelection:l,clipboardRef:c,netMode:u,setClipboard:f,getClipboard:p,onClipboardMismatch:m,handleUndo:w,handleRedo:y,setMode:x,arcStart:b,setArcStart:_,setTempArcEnd:S,setSelectedElement:T,pasteMode:h,setPasteMode:k}=t;O.useEffect(()=>{const C=A=>{const R=navigator.platform.toUpperCase().includes("MAC")?A.metaKey:A.ctrlKey;A.key==="Shift"&&t.isShiftPressedRef&&(t.isShiftPressedRef.current=!0);const I=A.target,j=I==null?void 0:I.tagName,z=j==="INPUT"||j==="TEXTAREA"||(I==null?void 0:I.isContentEditable);if(!z&&(A.key==="Delete"||A.key==="Backspace")){if(i.length===0&&!r)return;A.preventDefault(),n(W=>{const V=[],D=new Set;i.length>0?i.forEach(G=>{(G.type==="place"||G.type==="transition")&&V.push(G.id),G.type==="arc"&&D.add(G.id)}):r&&((r.type==="place"||r.type==="transition")&&V.push(r.id),r.type==="arc"&&D.add(r.id));let U=W;return V.length>0&&(U=R5(U,V)),D.size>0&&(U={...U,arcs:U.arcs.filter(G=>!D.has(G.id))}),U}),s();return}if(!z&&R&&(A.key==="a"||A.key==="A")){A.preventDefault();const W=[...e.places.map(V=>({id:V.id,type:"place"})),...e.transitions.map(V=>({id:V.id,type:"transition"})),...e.arcs.map(V=>({id:V.id,type:"arc"}))];l(W);return}if(!z&&R&&(A.key==="z"||A.key==="Z")&&typeof w=="function"){A.preventDefault(),w();return}if(!z&&R&&(A.key==="y"||A.key==="Y")&&typeof y=="function"){A.preventDefault(),y();return}if(!z&&!R){if((A.key==="p"||A.key==="P")&&typeof x=="function"){A.preventDefault(),x("place");return}if((A.key==="t"||A.key==="T")&&typeof x=="function"){A.preventDefault(),x("transition");return}if((A.key==="a"||A.key==="A")&&typeof x=="function"){A.preventDefault(),x("arc");return}if((A.key==="s"||A.key==="S")&&typeof x=="function"){A.preventDefault(),x("select");return}if(A.key==="Escape"){if(A.preventDefault(),h&&typeof k=="function"){k(!1);return}typeof x=="function"&&x("select"),typeof _=="function"&&b&&_(null),typeof S=="function"&&S(null),typeof T=="function"&&T(null);return}}if(!z&&R&&(A.key==="c"||A.key==="C")){if(i.length===0)return;A.preventDefault();const W=Dc(e,i),V=u||"pt";typeof f=="function"?f(W):c&&(c.current={payload:W,netMode:V,source:"local",timestamp:Date.now()});return}if(!z&&R&&(A.key==="v"||A.key==="V")){const W=u||"pt",V=typeof p=="function"?p():c==null?void 0:c.current;if(!V)return;const D=V.payload||V;if(!D)return;const U=V.netMode||W;if(U&&W&&U!==W){typeof m=="function"?m(U,W,V):console.warn(`Blocked paste: shared clipboard contains ${U} net, editor mode is ${W}.`);return}A.preventDefault();const{newPlaces:G,newTransitions:F,newArcs:Y,newSelection:X}=zc(D,Wi,{x:40,y:40});n(te=>({...te,places:[...te.places,...G],transitions:[...te.transitions,...F],arcs:[...te.arcs,...Y]})),l(X);return}},N=A=>{A.key==="Shift"&&t.isShiftPressedRef&&(t.isShiftPressedRef.current=!1)};return document.addEventListener("keydown",C),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",N)}},[e,i,r,n,s,l,c,t,w,y,x,b,_,S,T])}function xS(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var j5=xS,wS=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,SS=wS,_S=SS,kS=typeof self=="object"&&self&&self.Object===Object&&self,bS=_S||kS||Function("return this")(),F5=bS,CS=F5,TS=function(){return CS.Date.now()},ES=TS,NS=/\s/;function PS(t){for(var e=t.length;e--&&NS.test(t.charAt(e)););return e}var MS=PS,AS=MS,IS=/^\s+/;function RS(t){return t&&t.slice(0,AS(t)+1).replace(IS,"")}var LS=RS,jS=F5,FS=jS.Symbol,O5=FS,Jy=O5,D5=Object.prototype,OS=D5.hasOwnProperty,DS=D5.toString,Ta=Jy?Jy.toStringTag:void 0;function zS(t){var e=OS.call(t,Ta),n=t[Ta];try{t[Ta]=void 0;var r=!0}catch{}var i=DS.call(t);return r&&(e?t[Ta]=n:delete t[Ta]),i}var BS=zS,US=Object.prototype,GS=US.toString;function VS(t){return GS.call(t)}var WS=VS,e2=O5,$S=BS,HS=WS,YS="[object Null]",XS="[object Undefined]",t2=e2?e2.toStringTag:void 0;function KS(t){return t==null?t===void 0?XS:YS:t2&&t2 in Object(t)?$S(t):HS(t)}var QS=KS;function ZS(t){return t!=null&&typeof t=="object"}var qS=ZS,JS=QS,e_=qS,t_="[object Symbol]";function n_(t){return typeof t=="symbol"||e_(t)&&JS(t)==t_}var r_=n_,i_=LS,n2=j5,s_=r_,r2=0/0,o_=/^[-+]0x[0-9a-f]+$/i,a_=/^0b[01]+$/i,l_=/^0o[0-7]+$/i,u_=parseInt;function c_(t){if(typeof t=="number")return t;if(s_(t))return r2;if(n2(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=n2(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=i_(t);var n=a_.test(t);return n||l_.test(t)?u_(t.slice(2),n?2:8):o_.test(t)?r2:+t}var d_=c_,f_=j5,Qh=ES,i2=d_,h_="Expected a function",p_=Math.max,g_=Math.min;function m_(t,e,n){var r,i,s,l,c,u,f=0,p=!1,m=!1,w=!0;if(typeof t!="function")throw new TypeError(h_);e=i2(e)||0,f_(n)&&(p=!!n.leading,m="maxWait"in n,s=m?p_(i2(n.maxWait)||0,e):s,w="trailing"in n?!!n.trailing:w);function y(N){var A=r,M=i;return r=i=void 0,f=N,l=t.apply(M,A),l}function x(N){return f=N,c=setTimeout(S,e),p?y(N):l}function b(N){var A=N-u,M=N-f,R=e-A;return m?g_(R,s-M):R}function _(N){var A=N-u,M=N-f;return u===void 0||A>=e||A<0||m&&M>=s}function S(){var N=Qh();if(_(N))return T(N);c=setTimeout(S,b(N))}function T(N){return c=void 0,w&&r?y(N):(r=i=void 0,l)}function h(){c!==void 0&&clearTimeout(c),f=0,r=u=i=c=void 0}function k(){return c===void 0?l:T(Qh())}function C(){var N=Qh(),A=_(N);if(r=arguments,i=this,u=N,A){if(c===void 0)return x(u);if(m)return clearTimeout(c),c=setTimeout(S,e),y(u)}return c===void 0&&(c=setTimeout(S,e)),l}return C.cancel=h,C.flush=k,C}var y_=m_;const v_=xl(y_);function x_(t,e){return!t||!e||!Zh(t.places,e.places,z5)||!Zh(t.transitions,e.transitions,hp)||!Zh(t.arcs,e.arcs,B5)?!1:(we.debug("HistoryManager: States are identical"),!0)}function Zh(t=[],e=[],n){if(t.length!==e.length){const i=n===z5?"places":n===hp?"transitions":"arcs";return we.debug(`HistoryManager: States differ in number of ${i}`),!1}const r=new Map;e.forEach(i=>r.set(i.id,i));for(const i of t){const s=r.get(i.id);if(!s)return we.debug(`HistoryManager: ${n===B5?"Arc":n===hp?"Transition":"Place"} ${i.id} not found in second state`),!1;if(!n(i,s))return!1}return!0}function z5(t,e){const n=JSON.stringify(t.valueTokens||[])===JSON.stringify(e.valueTokens||[]),r=t.x===e.x&&t.y===e.y&&t.tokens===e.tokens&&t.label===e.label&&t.name===e.name&&n;return r||we.debug(`HistoryManager: Place ${t.id} differs - x: ${t.x} vs ${e.x}, y: ${t.y} vs ${e.y}, tokens: ${t.tokens} vs ${e.tokens}, label: ${t.label} vs ${e.label}, name: ${t.name} vs ${e.name}`),r}function hp(t,e){const n=t.x===e.x&&t.y===e.y&&t.label===e.label&&t.name===e.name&&(t.guard||"")===(e.guard||"");return n||we.debug(`HistoryManager: Transition ${t.id} differs - x: ${t.x} vs ${e.x}, y: ${t.y} vs ${e.y}, label: ${t.label} vs ${e.label}, name: ${t.name} vs ${e.name}`),n}function B5(t,e){if(!(t.source===e.source&&t.target===e.target&&t.weight===e.weight))return we.debug(`HistoryManager: Arc ${t.id} differs - source: ${t.source} vs ${e.source}, target: ${t.target} vs ${e.target}, weight: ${t.weight} vs ${e.weight}`),!1;const r=(t.label||"")===(e.label||"")&&(t.sourceType||"")===(e.sourceType||"")&&(t.targetType||"")===(e.targetType||"")&&JSON.stringify(t.bindings||[])===JSON.stringify(e.bindings||[])&&JSON.stringify(t.anglePoints||[])===JSON.stringify(e.anglePoints||[]);return r||we.debug(`HistoryManager: Arc ${t.id} differs in secondary properties`),r}function ac(t){if(!t||!t.places||!t.transitions||!t.arcs)return{places:[],transitions:[],arcs:[]};const e=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(i=>e(i));const r={};for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const s=n[i];s===null||typeof s!="object"?r[i]=s:Array.isArray(s)?r[i]=[...s]:r[i]={...s}}return r};return{places:t.places.map(e),transitions:t.transitions.map(e),arcs:t.arcs.map(e)}}function qh(t){return!t||!t.places||!t.transitions||!t.arcs?{places:[],transitions:[],arcs:[]}:ac(t)}class s2{constructor(e){this.states=[ac(e)],this.currentIndex=0,this.maxStates=50}addState(e){const n=ac(e),r=this.states[this.currentIndex];return this.currentIndex>=0&&x_(r,n)?(we.debug("HistoryManager: State unchanged, not adding to history"),{canUndo:this.canUndo(),canRedo:this.canRedo()}):(we.debug(`HistoryManager: Adding new state to history. Current index: ${this.currentIndex}, States count: ${this.states.length}`),this.currentIndex<this.states.length-1&&(we.debug(`HistoryManager: Removing ${this.states.length-this.currentIndex-1} future states`),this.states=this.states.slice(0,this.currentIndex+1)),this.states.push(n),this.currentIndex++,this.states.length>this.maxStates&&(this.states.shift(),this.currentIndex--),we.debug(`HistoryManager: New state added. Current index: ${this.currentIndex}, States count: ${this.states.length}`),{canUndo:this.canUndo(),canRedo:this.canRedo()})}undo(){if(!this.canUndo())return we.debug("HistoryManager: Cannot undo - no previous states"),null;this.currentIndex--;const e=this.states[this.currentIndex];return we.debug(`HistoryManager: Undoing to index ${this.currentIndex}, states count: ${this.states.length}`),{state:qh(e),canUndo:this.canUndo(),canRedo:this.canRedo()}}redo(){if(!this.canRedo())return we.debug("HistoryManager: Cannot redo - no future states"),null;this.currentIndex++;const e=this.states[this.currentIndex];return we.debug(`HistoryManager: Redoing to index ${this.currentIndex}, states count: ${this.states.length}`),{state:qh(e),canUndo:this.canUndo(),canRedo:this.canRedo()}}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.states.length-1}getCurrentState(){return this.states[this.currentIndex]}deepCopyState(e){return ac(e)}validateState(e){return qh(e)}}const w_="petri-net-shared-clipboard";function S_({clipboardRef:t,netMode:e,instanceId:n,onIncompatibleClipboard:r}){const i=O.useRef(null),s=O.useRef(e||"pt"),l=O.useRef(r||null);O.useEffect(()=>{s.current=e||"pt"},[e]),O.useEffect(()=>{l.current=r||null},[r]),O.useEffect(()=>{if(typeof window>"u"||typeof window.BroadcastChannel!="function")return;const f=new window.BroadcastChannel(w_);i.current=f;const p=m=>{var b;const w=m==null?void 0:m.data;if(!w||w.type!=="PETRI_NET_CLIPBOARD_UPDATE"||w.instanceId===n)return;const y={payload:w.payload,netMode:w.netMode,source:"remote",instanceId:w.instanceId,timestamp:w.timestamp||Date.now()};t&&(t.current=y);const x=s.current;y.netMode&&x&&y.netMode!==x&&((b=l.current)==null||b.call(l,y.netMode,x,y))};return f.addEventListener("message",p),()=>{f.removeEventListener("message",p),i.current=null,f.close()}},[t,n]);const c=O.useCallback(f=>{if(!f)return;const p={payload:f,netMode:s.current,source:"local",instanceId:n,timestamp:Date.now()};t&&(t.current=p);const m=i.current;if(m&&typeof m.postMessage=="function")try{m.postMessage({type:"PETRI_NET_CLIPBOARD_UPDATE",payload:f,netMode:p.netMode,instanceId:n,timestamp:p.timestamp})}catch(w){console.warn("Failed to broadcast clipboard payload:",w)}},[t,n]),u=O.useCallback(()=>t==null?void 0:t.current,[t]);return{setClipboard:c,getClipboard:u}}const U5=O.createContext(),__=({children:t})=>{const[r,i]=O.useState({width:800,height:600}),[s,l]=O.useState({width:1e4,height:7500}),[c,u]=O.useState({x:0,y:0}),[f,p]=O.useState(1),[m,w]=O.useState(!0),y=20,x=O.useRef(null),[b,_]=O.useState(null),S=O.useRef(null),[T,h]=O.useState(!1),[k,C]=O.useState({visible:!1,position:null,elementType:null}),N=O.useRef("select"),M={stageDimensions:r,setStageDimensions:i,virtualCanvasDimensions:s,setVirtualCanvasDimensions:l,canvasScroll:c,setCanvasScroll:u,zoomLevel:f,setZoomLevel:p,gridSnappingEnabled:m,toggleGridSnapping:()=>{w(R=>!R)},gridSize:y,MIN_ZOOM:.1,MAX_ZOOM:3,appRef:x,containerRef:b,setContainerRef:_,stageRef:S,isDragging:T,setIsDragging:h,snapIndicator:k,setSnapIndicator:C,prevModeRef:N};return E.jsx(U5.Provider,{value:M,children:t})},Go=()=>{const t=O.useContext(U5);if(t===void 0)throw new Error("useEditorUI must be used within an EditorUIProvider");return t};function o2(t){if(!(t!=null&&t.valueTokens)||t.valueTokens.length===0)return null;const e=pl(t.valueTokens[0]);return t.valueTokens.every(r=>pl(r)===e)?e:null}function Tl(t,e,n=!0){if(!n)return console.log("[TypeInference] Disabled, returning original state"),t;if(e!=="algebraic-int"||!(t!=null&&t.places)||!(t!=null&&t.arcs)||!(t!=null&&t.transitions))return console.log("[TypeInference] Skipping - netMode:",e,"hasPlaces:",!!(t!=null&&t.places)),t;console.log("[TypeInference] Starting with overwrite=",n);const r={arcs:[],transitions:[]},i=!!n;t.places.forEach(c=>{const u=o2(c);u&&t.arcs.filter(p=>p.source===c.id).forEach(p=>{if(p.bindings&&p.bindings.length>0){const m=[];let w=!1;for(const y of p.bindings){if(!y){m.push(y);continue}const x=new Map,b=y.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(b&&b.forEach(S=>{if(S!=="true"&&S!=="false"&&S!=="and"&&S!=="or"&&S!=="not")if(!y.includes(`${S}:`))x.set(S,u);else{const T=y.match(new RegExp(`${S}:(Int|Bool|Pair|String|List)`,"i"));T&&T[1]&&x.set(S,T[1])}}),u==="List"){const S=Array.isArray(c.valueTokens)?c.valueTokens:[];let T=null;if(S.length>0&&Array.isArray(S[0])&&S[0].length>0){const h=pl(S[0][0]);S.every(C=>Array.isArray(C)&&C.every(N=>pl(N)===h))&&(T=h)}if(T)for(const[h,k]of Array.from(x.entries()))k==="List"&&x.set(h,T);else x.clear()}const _=x.size>0?oc(y,x,null,{overwrite:i}):y;_!==y&&(w=!0),m.push(_)}w&&r.arcs.push({arcId:p.id,newBindings:m})}})});const s=t.arcs.map(c=>{const u=r.arcs.find(f=>f.arcId===c.id);return u?u.newBindings?{...c,bindings:[...u.newBindings]}:{...c,bindings:[u.newBinding]}:c});return t.transitions.forEach(c=>{const u=s.filter(m=>m.target===c.id),f=new Map;if(console.log("[TypeInference] Processing transition:",c.id,"inputArcs:",u.length),u.forEach(m=>{m.bindings&&m.bindings.length>0&&m.bindings.forEach(w=>{if(!w)return;console.log("[TypeInference] Input arc binding:",w);const y=w.match(/\b([a-z][a-zA-Z0-9_]*)\:(Int|Bool|Pair|String|List)\b/gi);y&&y.forEach(b=>{const _=b.match(/\b([a-z][a-zA-Z0-9_]*)\:(Int|Bool|Pair|String|List)\b/i);_&&_[1]&&_[2]&&f.set(_[1],_[2])});const x=w.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(console.log("[TypeInference] All variable matches in binding:",x),x){const b=t.places.find(_=>_.id===m.source);if(b){const _=o2(b);_&&x.forEach(S=>{S!=="true"&&S!=="false"&&S!=="and"&&S!=="or"&&S!=="not"&&(f.has(S)||f.set(S,_))})}}})}),console.log("[TypeInference] Extracted variable types for",c.id,":",JSON.stringify(Array.from(f.entries()))),c.guard&&f.size>0){const m=c.guard.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(m){const w=new Map;if(m.forEach(y=>{if(y!=="true"&&y!=="false"&&y!=="and"&&y!=="or"&&y!=="not"){const x=f.get(y);if(!x)return;i?w.set(y,x):new RegExp(`\\b${y}\\s*:(Int|Bool|Pair|String|List)\\b`,"i").test(c.guard)||w.set(y,x)}}),console.log("[TypeInference] Guard type map for",c.id,":",Array.from(w.entries())),w.size>0){const y=oc(c.guard,w,null,{overwrite:i});console.log("[TypeInference] Guard before:",c.guard),console.log("[TypeInference] Guard after:",y),y!==c.guard&&r.transitions.push({transitionId:c.id,newGuard:y})}}}s.filter(m=>m.source===c.id).forEach(m=>{if(m.bindings&&m.bindings.length>0){const w=[];let y=!1;for(const x of m.bindings){if(!x){w.push(x);continue}const b=new Map,_=x.match(/\b[a-z][a-zA-Z0-9_]*\b/g);_&&_.forEach(T=>{if(T!=="true"&&T!=="false"&&T!=="and"&&T!=="or"&&T!=="not"){const h=f.get(T);if(!h)return;i?b.set(T,h):new RegExp(`\\b${T}\\s*:(Int|Bool|Pair|String|List)\\b`,"i").test(x)||b.set(T,h)}});const S=b.size>0?oc(x,b,null,{overwrite:i}):x;S!==x&&(y=!0),w.push(S)}y&&r.arcs.push({arcId:m.id,newBindings:w})}})}),r.arcs.length===0&&r.transitions.length===0?t:{...t,arcs:t.arcs.map(c=>{const u=r.arcs.find(f=>f.arcId===c.id);return u?u.newBindings?{...c,bindings:[...u.newBindings]}:{...c,bindings:[u.newBinding]}:c}),transitions:t.transitions.map(c=>{const u=r.transitions.find(f=>f.transitionId===c.id);return u?{...c,guard:u.newGuard}:c})}}const _g=O.createContext(),k_=({children:t})=>{const{gridSnappingEnabled:e,gridSize:n,setCanvasScroll:r,setZoomLevel:i}=Go(),[s,l]=O.useState({places:[],transitions:[],arcs:[]}),[c,u]=O.useState(null),[f,p]=O.useState([]),[m,w]=O.useState("select"),[y,x]=O.useState(null),[b,_]=O.useState(null),[S,T]=O.useState(!1),[h,k]=O.useState(!1),[C,N]=O.useState({maxIterations:2e5,limitIterations:!1,netMode:"pt",useNonVisualRun:!1,batchMode:!1,showInferredTypes:!1,animationDelayMs:1e3}),[A,M]=O.useState({poolSize:1,idleTimeoutMs:3e5,prewarmOnAlgebraicMode:!0,solverTimeoutMs:1e4}),[R,I]=O.useState(null),j=O.useRef(new s2({places:[],transitions:[],arcs:[]})),[z,W]=O.useState(!1),[V,D]=O.useState(!1),U=O.useRef(v_(Ee=>{const se=j.current.addState(Ee);W(se.canUndo),D(se.canRedo)},500)),[G,F]=O.useState(!1),Y=O.useRef(m),X=O.useRef(null),te=O.useRef(null),K=O.useRef(Wi()),ee=O.useRef(!1),ne=(C==null?void 0:C.netMode)||"pt",ce=O.useRef(!!(C!=null&&C.showInferredTypes)),de=O.useRef(null),B=O.useCallback((Ee,se)=>{console.warn(`Shared clipboard net mode mismatch: received ${Ee||"unknown"} while editor is ${se||ne}. Copy/paste is disabled until both editors use the same mode.`)},[ne]),{setClipboard:Q,getClipboard:re}=S_({clipboardRef:te,netMode:ne,instanceId:K.current,onIncompatibleClipboard:B}),ie=(Ee,se=!1)=>{if(se){const le=j.current.addState(Ee);W(le.canUndo),D(le.canRedo)}else U.current(Ee)},{isContinuousSimulating:oe,isRunning:fe,enabledTransitionIds:pe,simulationError:Pe,isSimulatorReady:Ce,handleFireTransition:$e,stepSimulation:We,startContinuousSimulation:xt,startRunSimulation:Dt,stopAllSimulations:Yt,forceSimulatorReset:rt,completionStats:Fn,dismissCompletionDialog:On}=fS(s,l,ie,(C==null?void 0:C.netMode)||"pt",C);O.useEffect(()=>(!G&&Y.current===m&&ie(s),Y.current!==m&&S&&T(!1),Y.current=m,()=>U.current.cancel()),[s,G,m,S,T]),O.useEffect(()=>{const Ee=!!(C!=null&&C.showInferredTypes),se=ce.current;if(Ee!==se){if(ce.current=Ee,Ee&&ne==="algebraic-int"){l(le=>(de.current=le,Tl(le,ne,!0)));return}!Ee&&de.current&&(l(de.current),de.current=null)}},[C==null?void 0:C.showInferredTypes,ne,l]);const it=()=>{if(!z)return;we.debug("Undoing to previous state...");const Ee=j.current.undo();Ee&&(we.debug("Undo result:",Ee.state),l(Ee.state),W(Ee.canUndo),D(Ee.canRedo),rt())},hi=()=>{if(!V)return;we.debug("Redoing to next state...");const Ee=j.current.redo();Ee&&(we.debug("Redo result:",Ee.state),l(Ee.state),W(Ee.canUndo),D(Ee.canRedo),rt())},pi=(Ee,se)=>e?{x:Math.round(Ee/n)*n,y:Math.round(se/n)*n}:{x:Ee,y:se},zr=Ee=>{N(Ee),k(!1)};O.useEffect(()=>{(async()=>{if(!(typeof window>"u"))try{const{setZ3WorkerConfig:se}=await ni(()=>Promise.resolve().then(()=>Qa),void 0,import.meta.url);se(A)}catch{}})()},[A]);const Br=()=>{const Ee={places:[],transitions:[],arcs:[]};l(Ee),u(null),p([]),w("select"),x(null),_(null),N({maxIterations:2e5,limitIterations:!1,netMode:"pt",useNonVisualRun:!1,batchMode:!1,showInferredTypes:!1}),r({x:0,y:0}),i(1),j.current=new s2(Ee),W(!1),D(!1),we.debug("Editor completely reset")},gt=(Ee,se)=>Ee?f.some(le=>le.id===Ee&&le.type===se):!1,dn=()=>{u(null),p([])},Ur=Ee=>{if(p(Array.isArray(Ee)?Ee:[]),Array.isArray(Ee)&&Ee.length>0){const se=Ee[Ee.length-1],le=se.type==="place"?s.places.find(he=>he.id===se.id):se.type==="transition"?s.transitions.find(he=>he.id===se.id):s.arcs.find(he=>he.id===se.id);le&&u({...le,type:se.type})}else u(null)};return L5({elements:s,setElements:l,selectedElement:c,selectedElements:f,clearSelection:dn,setSelection:Ur,clipboardRef:te,isShiftPressedRef:ee,netMode:ne,setClipboard:Q,getClipboard:re,onClipboardMismatch:B}),E.jsx(_g.Provider,{value:{elements:s,setElements:l,selectedElement:c,setSelectedElement:u,mode:m,setMode:w,arcStart:y,setArcStart:x,tempArcEnd:b,setTempArcEnd:_,pasteMode:S,setPasteMode:T,isDragging:G,setIsDragging:F,isContinuousSimulating:oe,isRunning:fe,isSimulatorReady:Ce,enabledTransitionIds:pe,simulationError:Pe,stepSimulation:We,handleFireTransition:$e,startContinuousSimulation:xt,startRunSimulation:Dt,stopAllSimulations:Yt,completionStats:Fn,dismissCompletionDialog:On,isSettingsDialogOpen:h,setIsSettingsDialogOpen:k,simulationSettings:C,setSimulationSettings:N,netMode:ne,historyManagerRef:j,canUndo:z,setCanUndo:W,canRedo:V,setCanRedo:D,handleUndo:it,handleRedo:hi,updateHistory:ie,snapToGrid:pi,handleSaveSettings:zr,z3Settings:A,setZ3Settings:M,resetEditor:Br,simulatorCore:Ai,forceSimulatorReset:rt,selectedElements:f,setSelectedElements:p,isIdSelected:gt,clearSelection:dn,setSelection:Ur,multiDragRef:X,clipboardRef:te,setClipboard:Q,getClipboard:re,onClipboardMismatch:B,instanceId:K.current,isShiftPressedRef:ee,saveFileHandle:R,setSaveFileHandle:I},children:t})},$t=()=>{const t=O.useContext(_g);if(t===void 0)throw new Error("usePetriNet must be used within a PetriNetProvider");return t},b_=({mode:t,setMode:e,gridSnappingEnabled:n,onToggleGridSnapping:r,canUndo:i,canRedo:s,onUndo:l,onRedo:c,elements:u,setElements:f,updateHistory:p,simulationSettings:m,setSimulationSettings:w,simulationMode:y,setSimulationMode:x,isSimulating:b,startSimulation:_,stopSimulation:S,clearCanvas:T,onOpenSettings:h,resetEditor:k,debugConsoleRef:C})=>{const[N,A]=O.useState(!1),[M,R]=O.useState(null),[I,j]=O.useState(null),[z,W]=O.useState(!1),[V,D]=O.useState(!1),{saveFileHandle:U,setSaveFileHandle:G}=(()=>{try{return $t()}catch{return{saveFileHandle:null,setSaveFileHandle:()=>{}}}})(),{handleSave:F,handleSaveAs:Y,handleLoad:X,handleClear:te,handleOpenAdtManager:K}=pS({elements:u,setElements:f,updateHistory:p,simulationSettings:m,setSimulationSettings:w,resetEditor:k,setIsLoading:A,setError:R,setSuccess:j,setIsAdtOpen:W,saveFileHandle:U,setSaveFileHandle:G,setIsMobileMenuOpen:D});O.useEffect(()=>{if(!I)return;const ie=setTimeout(()=>j(null),2e3);return()=>clearTimeout(ie)},[I]);const ee=O.useMemo(()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(min-width: 1024px)"):null,[]);O.useEffect(()=>{if(!ee)return;const ie=oe=>{oe.matches&&D(!1)};return ee.addEventListener?ee.addEventListener("change",ie):ee.addListener(ie),()=>{ee.removeEventListener?ee.removeEventListener("change",ie):ee.removeListener(ie)}},[ee]);const ne=(ie="desktop")=>oe=>({padding:"0.375rem 0.5rem",borderRadius:"0.25rem",backgroundColor:oe?"#4338ca":"white",color:oe?"rgba(255, 255, 255, 0.85)":"rgba(31, 41, 55, 0.7)",border:oe?"1px solid #3730a3":"1px solid #d1d5db",borderBottom:oe?"2px solid #312e81":"2px solid #9ca3af",margin:ie==="mobile"?"0 0 0.5rem 0":"0 0.125rem",minWidth:ie==="mobile"?"100%":"80px",width:ie==="mobile"?"100%":"80px",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease-in-out",textAlign:"center",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",boxShadow:oe?"inset 0 1px 0 rgba(255, 255, 255, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1)":"inset 0 1px 0 rgba(255, 255, 255, 0.7), 0 2px 4px rgba(0, 0, 0, 0.1)",position:"relative",top:"0",transform:oe?"translateY(1px)":"translateY(0)",textShadow:oe?"0 -1px 1px rgba(0, 0, 0, 0.5), 0 1px 0 rgba(255, 255, 255, 0.15)":"0 1px 0 rgba(255, 255, 255, 0.5), 0 -1px 0 rgba(0, 0, 0, 0.2)"}),ce=O.useMemo(()=>ne("desktop"),[]),de=O.useMemo(()=>ne("mobile"),[]),B=ie=>({padding:"0.5rem",marginTop:"0.5rem",borderRadius:"0.25rem",backgroundColor:ie?"#fee2e2":"#d1fae5",color:ie?"#b91c1c":"#047857",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem"}),Q=()=>E.jsxs("div",{className:"hidden lg:flex items-start",children:[E.jsxs("div",{className:"file-operations p-2",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"File"}),E.jsx(Fy,{isLoading:N,onSave:F,onSaveAs:Y,canSaveAs:!!U,onLoad:X,onClear:te,buttonStyle:ce})]}),E.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),E.jsxs("div",{className:"editing-tools p-2",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"Editing"}),E.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[E.jsxs("div",{className:"flex items-center mr-4",children:[E.jsx("input",{type:"checkbox",id:"grid-snap-toggle","data-testid":"grid-snap-toggle",checked:n,onChange:r,className:"mr-1"}),E.jsx("label",{htmlFor:"grid-snap-toggle",className:"text-xs text-gray-700",children:"Snap to Grid"})]}),E.jsx(vw,{mode:t,setMode:e,buttonStyle:ce})]})]}),E.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),E.jsxs("div",{className:"adt-tools p-2",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"ADT Manager"}),E.jsx("div",{className:"flex justify-between",children:E.jsx("button",{style:ce(!1),onClick:K,title:"Open ADT Manager","data-testid":"toolbar-adt-manager",children:"ADT"})})]}),E.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),E.jsxs("div",{className:"history-tools p-2",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"History"}),E.jsx(xw,{canUndo:i,canRedo:s,onUndo:l,onRedo:c,buttonStyle:ce})]}),E.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),E.jsxs("div",{className:"settings-tools p-2 ml-auto",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"Settings"}),E.jsx(Oy,{onOpenSettings:h,buttonStyle:ce})]})]}),re=()=>E.jsxs("div",{className:"flex flex-col space-y-5",children:[E.jsxs("div",{className:"file-operations",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-3 uppercase tracking-wider",children:"File"}),E.jsx(Fy,{isLoading:N,onSave:F,onSaveAs:Y,canSaveAs:!!U,onLoad:X,onClear:te,buttonStyle:de})]}),E.jsxs("div",{className:"editing-tools",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-3 uppercase tracking-wider",children:"Editing"}),E.jsxs("div",{className:"flex items-center",children:[E.jsx("input",{type:"checkbox",id:"grid-snap-toggle-mobile","data-testid":"grid-snap-toggle-mobile",checked:n,onChange:r,className:"mr-2"}),E.jsx("label",{htmlFor:"grid-snap-toggle-mobile",className:"text-sm text-gray-700",children:"Snap to Grid"})]})]}),E.jsxs("div",{className:"adt-tools",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-3 uppercase tracking-wider",children:"ADT Manager"}),E.jsx("button",{style:de(!1),onClick:()=>{D(!1),K()},title:"Open ADT Manager","data-testid":"toolbar-adt-manager-mobile",children:"ADT"})]}),E.jsxs("div",{className:"settings-tools",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-3 uppercase tracking-wider",children:"Settings"}),E.jsx(Oy,{onOpenSettings:()=>{D(!1),h()},buttonStyle:de})]}),E.jsxs("div",{className:"debug-tools",children:[E.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-3 uppercase tracking-wider",children:"Developer"}),E.jsx("button",{style:de(!1),onClick:()=>{D(!1),C!=null&&C.current&&C.current.open()},title:"Open Debug Console","data-testid":"debug-console-mobile",children:" Debug Console"})]})]});return E.jsxs("div",{className:"toolbar-container flex flex-col p-2 bg-gray-50 border-b border-gray-200 shadow-sm",style:{minHeight:"70px"},children:[E.jsx("div",{className:"hidden lg:block",children:Q()}),E.jsxs("div",{className:"lg:hidden flex items-center gap-3 px-2 py-1",children:[E.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 rounded-md border border-gray-200 shadow-sm bg-white font-semibold text-gray-700",onClick:()=>D(!0),"aria-label":"Open toolbar menu",children:[E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),E.jsx("span",{children:"Menu"})]}),E.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[E.jsx("button",{type:"button",className:`p-2 rounded-md border border-gray-200 shadow-sm bg-white text-gray-700 transition-all ${i?"hover:bg-gray-50 active:scale-95":"opacity-50 cursor-not-allowed"}`,onClick:l,disabled:!i,title:"Undo","aria-label":"Undo",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})})}),E.jsx("button",{type:"button",className:`p-2 rounded-md border border-gray-200 shadow-sm bg-white text-gray-700 transition-all ${s?"hover:bg-gray-50 active:scale-95":"opacity-50 cursor-not-allowed"}`,onClick:c,disabled:!s,title:"Redo","aria-label":"Redo",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3"})})})]})]}),z&&E.jsx(jw,{isOpen:z,onClose:()=>W(!1)}),M&&E.jsxs("div",{style:B(!0),children:[M,E.jsx("button",{onClick:()=>R(null),style:{marginLeft:"0.5rem"},children:""})]}),I&&E.jsxs("div",{style:B(!1),children:[I,E.jsx("button",{onClick:()=>j(null),style:{marginLeft:"0.5rem"},children:""})]}),E.jsxs("div",{className:"lg:hidden fixed inset-0 z-50 pointer-events-none",children:[E.jsx("div",{className:`absolute inset-0 bg-black transition-opacity duration-300 ease-in-out ${V?"opacity-40 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>D(!1)}),E.jsx("div",{className:`fixed w-72 left-0 top-16 bottom-0 z-50 bg-gradient-to-b from-gray-50 to-white backdrop-blur-sm shadow-2xl overflow-y-auto transform transition-transform duration-300 ease-in-out ${V?"translate-x-0":"-translate-x-full"} pointer-events-auto border-r border-gray-200`,onWheel:ie=>ie.stopPropagation(),children:E.jsxs("div",{className:"p-4",children:[E.jsx("div",{className:"mb-6 border-b border-gray-200 pb-3",children:E.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Menu"})}),re()]})})]})]})},C_=({mode:t,tokens:e,valueTokensInput:n,onTokensChange:r,onValueTokensChange:i,onValueTokensBlur:s})=>t==="pt"?E.jsxs("div",{className:"mb-4",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tokens (PT mode)"}),E.jsx("input",{type:"number",min:"0",value:e,onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}):t==="algebraic-int"?E.jsxs("div",{className:"mb-4",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Algebraic Tokens"}),E.jsx("input",{type:"text",value:n,onChange:i,onBlur:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm",placeholder:"e.g., 2, 3, 'hello', T, F, (1, 2), [1, 2, 3]"})]}):null,T_=({mode:t,weight:e,bindingsInput:n,bindingError:r,onWeightChange:i,onBindingsChange:s,onBindingsBlur:l})=>t==="pt"?E.jsxs("div",{className:"mb-4",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Weight"}),E.jsx("input",{type:"number",min:"1",value:e,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}):t==="algebraic-int"?E.jsxs("div",{className:"mb-4",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bindings"}),E.jsx("input",{type:"text",value:n,onChange:s,onBlur:l,className:`w-full px-3 py-2 border rounded-md font-mono text-sm ${r?"border-red-500":"border-gray-300"}`,placeholder:"e.g., x, y, (a, b)"}),r&&E.jsx("p",{className:"text-red-600 text-xs mt-1",children:r})]}):null,E_=({guardText:t,guardError:e,onGuardChange:n,onGuardBlur:r})=>E.jsxs("div",{className:"mb-4",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Guard"}),E.jsx("input",{type:"text",value:t,onChange:n,onBlur:r,className:`w-full px-3 py-2 border rounded-md font-mono text-sm ${e?"border-red-500":"border-gray-300"}`,placeholder:"e.g., x > 0 and y < 10"}),e&&E.jsx("p",{className:"text-red-600 text-xs mt-1",children:e})]});function N_(){const t=O.useCallback(r=>{const i=[];let s="",l=0,c=0,u=!1;for(let p=0;p<r.length;p++){const m=r[p];if(u){s+=m,m==="'"&&r[p-1]!=="\\"&&(u=!1);continue}if(m==="'"){u=!0,s+=m;continue}if(m==="("){l++,s+=m;continue}if(m===")"){l=Math.max(0,l-1),s+=m;continue}if(m==="["){c++,s+=m;continue}if(m==="]"){c=Math.max(0,c-1),s+=m;continue}if(m===","&&l===0&&c===0){i.push(s.trim()),s="";continue}s+=m}const f=s.trim();return f.length>0&&i.push(f),i},[]),e=O.useCallback(r=>{const i=String(r||"").trim(),s=i.toLowerCase();if(i==="T"||s==="true")return!0;if(i==="F"||s==="false")return!1;if(/^[+-]?\d+$/.test(i))return parseInt(i,10);if(i.startsWith("'")&&i.endsWith("'"))return i.slice(1,-1);if(i.startsWith("[")&&i.endsWith("]")){const l=i.slice(1,-1).trim();return l?t(l).map(e):[]}if(i.startsWith("(")&&i.endsWith(")")){const l=i.slice(1,-1).trim();let c=0,u=-1;for(let f=0;f<l.length;f++){const p=l[f];if(p==="(")c++;else if(p===")")c=Math.max(0,c-1);else if(p===","&&c===0){u=f;break}}if(u>=0)return{__pair__:!0,fst:e(l.slice(0,u)),snd:e(l.slice(u+1))}}return null},[t]);return{parseValueTokensInput:O.useCallback(r=>{const i=String(r||"").trim();return i?t(i).map(e).filter(s=>s!==null):[]},[t,e]),splitTopLevelCommas:t}}function P_(){const t=O.useCallback(n=>{const r=[];let i="",s=0,l=0;for(let c=0;c<n.length;c++){const u=n[c];if(u==="(")s++;else if(u===")")s=Math.max(0,s-1);else if(u==="[")l++;else if(u==="]")l=Math.max(0,l-1);else if(u===","&&s===0&&l===0){r.push(i.trim()),i="";continue}i+=u}return i.trim()&&r.push(i.trim()),r.filter(Boolean)},[]),e=O.useCallback(n=>{const r=t(String(n||""));for(const i of r){try{y5(i);continue}catch{}try{Vt(i);continue}catch{}try{Ro(i,Vt);continue}catch{}return{ok:!1,error:`Invalid binding: ${i}`}}return{ok:!0,bindings:r}},[t]);return{splitTopLevel:t,validateBindings:e}}const M_=({getElementInfo:t,setElements:e,updateHistory:n,setFormValues:r})=>O.useCallback(i=>{const s=i.target.value;r(u=>({...u,label:s}));const{elementId:l,elementType:c}=t();c==="place"?e(u=>({...u,places:u.places.map(f=>f.id===l?{...f,label:s}:f)})):c==="transition"?e(u=>({...u,transitions:u.transitions.map(f=>f.id===l?{...f,label:s}:f)})):c==="arc"&&e(u=>({...u,arcs:u.arcs.map(f=>f.id===l?{...f,label:s}:f)})),n()},[t,e,n,r]),A_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,parseValueTokensInput:l,showInferredTypes:c})=>{const u=O.useCallback(m=>{let w=parseInt(m.target.value,10);Number.isFinite(w)||(w=0),w<0&&(w=0),e(x=>({...x,tokens:w}));const{elementId:y}=n();r(x=>({...x,places:x.places.map(b=>b.id===y?{...b,tokens:w}:b)})),i()},[n,r,i,e]),f=O.useCallback(()=>{const m=t.valueTokensInput.trim(),{elementId:w}=n();if(!m){r(x=>({...x,places:x.places.map(b=>b.id===w?{...b,valueTokens:[],tokens:0}:b)})),i();return}const y=l(m);r(x=>{const b={...x,places:x.places.map(_=>_.id===w?{..._,valueTokens:y,tokens:y.length}:_)};return Tl(b,s,c)}),i()},[t.valueTokensInput,n,s,l,r,i,c]),p=O.useCallback(m=>Array.isArray(m.valueTokens)?w5(m.valueTokens):"",[]);return{handleTokensChange:u,handleValueTokensBlur:f,serializeTokensFromElement:p}},I_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,validateBindings:l,showInferredTypes:c})=>{const u=O.useCallback(m=>{const w=parseInt(m.target.value,10)||1;e(x=>({...x,weight:w}));const{elementId:y}=n();r(x=>({...x,arcs:x.arcs.map(b=>b.id===y?{...b,weight:w}:b)})),i()},[n,r,i,e]),f=O.useCallback(()=>{const m=t.bindingsInput.trim();e(_=>({..._,bindingError:null}));const{elementId:w}=n();if(!m){r(_=>({..._,arcs:_.arcs.map(S=>S.id===w?{...S,bindings:[]}:S)})),i();return}const{ok:y,bindings:x,error:b}=l(m);if(!y){e(_=>({..._,bindingError:b}));return}r(_=>({..._,arcs:_.arcs.map(S=>S.id===w?{...S,bindings:x}:S)})),i(),r(_=>{const S={..._,arcs:_.arcs.map(T=>T.id===w?{...T,bindings:x}:T)};return Tl(S,s,c)}),i()},[t.bindingsInput,n,s,r,e,i,l,c]),p=O.useCallback((m,w)=>m!=="arc"||!Array.isArray(w.bindings)?"":w.bindings.map(y=>{const x=String(y||"");return/^true$/i.test(x)?"T":/^false$/i.test(x)?"F":v5(x)}).join(", "),[]);return{handleWeightChange:u,handleBindingsBlur:f,serializeBindingsFromElement:p}},R_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,showInferredTypes:l})=>({handleGuardBlur:O.useCallback(()=>{const u=t.guardText.trim();e(p=>({...p,guardError:null}));const{elementId:f}=n();if(!u){r(p=>({...p,transitions:p.transitions.map(m=>m.id===f?{...m,guard:""}:m)})),i();return}try{Ro(u,Vt),r(p=>({...p,transitions:p.transitions.map(m=>m.id===f?{...m,guard:u}:m)})),i(),r(p=>{const m={...p,transitions:p.transitions.map(w=>w.id===f?{...w,guard:u}:w)};return Tl(m,s,l)}),i()}catch(p){e(m=>({...m,guardError:`Invalid guard: ${p.message}`}))}},[t.guardText,n,s,r,e,i,l])}),L_=({elements:t,netMode:e,setElements:n,updateHistory:r,showInferredTypes:i})=>{const s=i??!0,l=O.useCallback(u=>{if(!s||!(t!=null&&t.places)||!(t!=null&&t.arcs)||e!=="algebraic-int")return;const f=t.places.find(y=>y.id===u);if(!f||!f.valueTokens||f.valueTokens.length===0)return;const p=pl(f.valueTokens[f.valueTokens.length-1]),w=t.arcs.filter(y=>y.source===u).reduce((y,x)=>{if(!Array.isArray(x.bindings)||x.bindings.length===0)return y;const b=x.bindings[0];if(!b||!s&&b.includes(":"))return y;const _=b.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(!_)return y;const S=new Map;if(_.forEach(h=>{["true","false","and","or","not"].includes(h)||S.set(h,p)}),S.size===0)return y;const T=oc(b,S,null,{overwrite:s});return T!==b&&y.push({arcId:x.id,newBinding:T}),y},[]);w.length!==0&&(n(y=>({...y,arcs:y.arcs.map(x=>{const b=w.find(_=>_.arcId===x.id);return b?{...x,bindings:[b.newBinding]}:x})})),r())},[t,e,n,r,s]),c=O.useCallback(()=>{if(!s)return;const u=Tl(t,e,s);u!==t&&(n(u),r())},[t,e,n,r,s]);return{inferTypesForPlace:l,performGlobalTypeInference:c}};function j_({selectedElement:t,elements:e,setElements:n,updateHistory:r,netMode:i,showInferredTypes:s=!0}){const[l,c]=O.useState({label:"",tokens:0,weight:1,valueTokensInput:"",bindingsInput:"",bindingError:null,guardText:"",guardError:null}),{parseValueTokensInput:u}=N_(),{validateBindings:f}=P_(),p=O.useCallback(()=>{if(!t)return{elementId:"",elementType:""};const C=t.id||t.element&&t.element.id||"",N=t.type||C.split("-")[0];return{elementId:C,elementType:N}},[t]),{handleTokensChange:m,handleValueTokensBlur:w,serializeTokensFromElement:y}=A_({formValues:l,setFormValues:c,getElementInfo:p,setElements:n,updateHistory:r,netMode:i,parseValueTokensInput:u,showInferredTypes:s}),{handleWeightChange:x,handleBindingsBlur:b,serializeBindingsFromElement:_}=I_({formValues:l,setFormValues:c,getElementInfo:p,setElements:n,updateHistory:r,netMode:i,validateBindings:f,showInferredTypes:s}),{handleGuardBlur:S}=R_({formValues:l,setFormValues:c,getElementInfo:p,setElements:n,updateHistory:r,netMode:i,showInferredTypes:s}),T=M_({getElementInfo:p,setElements:n,updateHistory:r,setFormValues:c}),{inferTypesForPlace:h,performGlobalTypeInference:k}=L_({elements:e,netMode:i,setElements:n,updateHistory:r,showInferredTypes:s});return O.useEffect(()=>{if(!t)return;const{elementType:C}=p(),N=C==="transition"?String(t.guard||"").replace(/\btrue\b/gi,"T").replace(/\bfalse\b/gi,"F"):"";c(A=>({...A,label:t.label||"",tokens:t.tokens||0,weight:t.weight!==void 0?t.weight:1,valueTokensInput:y(t),bindingsInput:_(C,t),guardText:N}))},[t,p,y,_,c]),{formValues:l,setFormValues:c,handleLabelChange:T,handleTokensChange:m,handleWeightChange:x,handleValueTokensBlur:w,handleBindingsBlur:b,handleGuardBlur:S,inferTypesForPlace:h,performGlobalTypeInference:k,getElementInfo:p}}const F_=({selectedElement:t,elements:e,setElements:n,updateHistory:r,simulationSettings:i})=>{const s=O.useContext(_g)||{};s.enabledTransitionIds,s.isSimulatorReady;const l=(i==null?void 0:i.netMode)||"pt",c=!!(i!=null&&i.showInferredTypes),{formValues:u,setFormValues:f,handleLabelChange:p,handleTokensChange:m,handleWeightChange:w,handleValueTokensBlur:y,handleBindingsBlur:x,handleGuardBlur:b,getElementInfo:_}=j_({selectedElement:t,elements:e,setElements:n,updateHistory:r,netMode:l,showInferredTypes:c});if(!t)return null;const{elementType:S}=_();return E.jsxs("div",{className:"properties-panel w-full px-4 py-2 overflow-y-auto mx-0",children:[E.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Properties"}),E.jsxs("div",{className:"mb-4",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Label"}),E.jsx("input",{type:"text",value:u.label,onChange:p,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"P1, P2, etc."})]}),t&&S==="place"&&E.jsx(C_,{mode:l,tokens:u.tokens,valueTokensInput:u.valueTokensInput,onTokensChange:m,onValueTokensChange:T=>f(h=>({...h,valueTokensInput:T.target.value})),onValueTokensBlur:y}),t&&S==="arc"&&E.jsx(T_,{mode:l,weight:u.weight,bindingsInput:u.bindingsInput,bindingError:u.bindingError,onWeightChange:w,onBindingsChange:T=>f(h=>({...h,bindingsInput:T.target.value})),onBindingsBlur:x}),t&&S==="transition"&&l==="algebraic-int"&&E.jsx(E_,{guardText:u.guardText,guardError:u.guardError,onGuardChange:T=>f(h=>({...h,guardText:T.target.value})),onGuardBlur:b})]})},O_=({enabledTransitions:t,isLoading:e,isOpen:n,onClose:r,onFire:i})=>n?E.jsxs("div",{"data-testid":"enabled-transitions",className:"enabled-transitions-panel mt-4 p-4 bg-gray-50 border border-gray-200 rounded-md",children:[E.jsxs("div",{className:"flex justify-between items-center mb-3",children:[E.jsx("h3",{className:"text-md font-semibold",children:"Enabled Transitions"}),E.jsx("span",{onClick:r,role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r&&r())},className:"text-gray-500 hover:text-gray-800 cursor-pointer select-none","aria-label":"Close enabled transitions panel",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e?E.jsx("p",{className:"text-gray-500",children:"Loading..."}):t.length===0?E.jsx("p",{className:"text-gray-500",children:"No enabled transitions"}):E.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-64 overflow-y-auto pr-1",children:t.map(s=>E.jsx("button",{type:"button",className:"flex items-center text-left hover:bg-gray-100 rounded px-1 py-0.5",onClick:()=>i&&i(s.id),"data-testid":`enabled-${s.label||s.id}`,title:s.label||s.id,children:E.jsx("span",{className:"font-medium",children:s.label||s.id.substring(11,17)})},s.id))})]}):null,D_=({elements:t,enabledTransitionIds:e})=>{const{handleFireTransition:n,netMode:r}=$t(),[i,s]=O.useState(!1),[l,c]=O.useState(!1);return E.jsxs("div",{className:"pt-4 mt-4 px-4",children:[E.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Petri Net"}),E.jsxs("div",{className:"mb-4 pl-1",children:[E.jsxs("div",{className:"flex justify-between items-center mb-2",children:[E.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Current Markings"}),E.jsxs("button",{"data-testid":"toggle-markings",className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm flex items-center space-x-1 transition-colors",onClick:()=>s(!i),children:[E.jsx("span",{children:i?"Hide":"Show"}),E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})]}),i&&E.jsx("div",{"data-testid":"current-marking",className:"markings-panel p-3 bg-gray-50 border border-gray-200 rounded-md",children:(t.places||[]).length===0?E.jsx("p",{className:"text-gray-500 text-sm",children:"No places defined"}):E.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto pr-1",children:(t.places||[]).filter(u=>r==="algebraic-int"?(Array.isArray(u.valueTokens)?u.valueTokens:[]).length>0:!0).map(u=>{const f=u.label||u.name||u.id.substring(6,12),p=u.tokens||0,m=Array.isArray(u.valueTokens)?u.valueTokens:[],w=r==="algebraic-int"&&Array.isArray(u.valueTokens),y=w?w5(m):"";return E.jsxs("div",{className:"flex items-start text-sm",children:[E.jsx("span",{className:"font-medium text-gray-800 mr-2 truncate",title:f,children:f}),w?E.jsx("div",{className:"flex-1 text-gray-800 bg-purple-50 border border-purple-200 rounded px-2 py-1 whitespace-pre-wrap break-words overflow-visible",title:y,children:y||"[]"}):E.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-purple-100 text-purple-800 border border-purple-200 font-semibold min-w-[2rem] justify-center",children:p})]},u.id)})})})]}),E.jsxs("div",{className:"mb-2 pl-1",children:[E.jsxs("div",{className:"flex justify-between items-center mb-2",children:[E.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Enabled Transitions"}),E.jsxs("button",{"data-testid":"show-enabled-transitions",className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm flex items-center space-x-1 transition-colors",onClick:()=>c(!l),children:[E.jsx("span",{children:l?"Hide":"Show"}),E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})]}),l&&E.jsx(O_,{isOpen:!0,enabledTransitions:(e||[]).map(u=>{const f=(t.transitions||[]).find(p=>p.id===u);return{id:u,label:f&&(f.label||f.name)||u}}),isLoading:!1,onClose:()=>c(!1),onFire:u=>n&&n(u)})]})]})};const a2=({stats:t,onDismiss:e})=>{if(!t)return null;const n=r=>{if(r<1e3)return`${r}ms`;const i=Math.floor(r/1e3),s=Math.floor(i/60),l=i%60;return s>0?`${s}m ${l}s`:`${i}s`};return E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:E.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md mx-4",children:[E.jsxs("div",{className:"flex items-center mb-4",children:[E.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3",children:E.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),E.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Simulation Complete"})]}),E.jsxs("div",{className:"space-y-3 mb-6",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:"text-gray-600",children:"Duration:"}),E.jsx("span",{className:"font-medium text-gray-900",children:n(t.elapsedMs)})]}),E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:"text-gray-600",children:"Transitions Fired:"}),E.jsx("span",{className:"font-medium text-gray-900",children:t.transitionsFired})]})]}),E.jsx("div",{className:"flex justify-end",children:E.jsx("button",{onClick:e,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"OK"})})]})})},l2=({isMobile:t=!1})=>{const{isContinuousSimulating:e,isRunning:n,enabledTransitionIds:r,simulationError:i,isSimulatorReady:s,stepSimulation:l,startContinuousSimulation:c,startRunSimulation:u,stopAllSimulations:f,completionStats:p,dismissCompletionDialog:m}=$t(),[w,y]=O.useState(!1),[x,b]=O.useState(!1),_=e||n,S=s&&r.length>0,T=S?"opacity-100":"opacity-50";O.useEffect(()=>{_&&y(!0)},[_]);const h=()=>{b(!0),setTimeout(()=>{y(!1),b(!1)},200)},k=()=>{b(!1),y(!0)};if(t){const C=i&&E.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-full mb-2 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg text-xs whitespace-nowrap z-50",children:i}),N=({onClick:A,className:M=""})=>E.jsx("button",{onClick:A,className:`flex flex-col items-center justify-center cursor-pointer transition-all hover:opacity-70 py-1 ${M}`,title:"Tap to expand/collapse",children:E.jsxs("div",{className:"flex flex-col gap-0.5",children:[E.jsx("div",{className:"w-6 h-0.5 bg-gray-400 rounded-full"}),E.jsx("div",{className:"w-6 h-0.5 bg-gray-400 rounded-full"}),E.jsx("div",{className:"w-6 h-0.5 bg-gray-400 rounded-full"})]})});return E.jsxs(E.Fragment,{children:[E.jsxs("div",{"data-testid":"simulation-manager-mobile",className:`fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40 transition-all duration-200 ease-out ${T}`,children:[C,!w&&!x&&E.jsx("div",{className:`bg-white/95 backdrop-blur-md rounded-full px-3 py-1.5 shadow-2xl border border-gray-200/50 flex items-center justify-center transition-all duration-200 ease-out ${S?"":"opacity-60"}`,children:E.jsx(N,{onClick:k})}),(w||x)&&_&&E.jsxs("div",{className:`bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-200/50 flex flex-col items-center ${w&&!x?"animate-slide-up":x?"animate-slide-down":""}`,children:[E.jsx("div",{className:"w-full flex justify-center pt-1.5 pb-0.5",children:E.jsx(N,{onClick:h})}),E.jsxs("div",{className:"flex items-center gap-3 px-4 pb-2",children:[n&&E.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[E.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full sim-pulse-strong"}),E.jsx("span",{className:"text-xs font-medium",children:"Running"})]}),E.jsx("button",{"data-testid":"sim-stop-mobile",className:"bg-red-600 text-white rounded-full p-3 hover:bg-red-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!0}catch{}f()},disabled:!_,title:"Stop simulation",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:E.jsx("rect",{x:"7",y:"7",width:"10",height:"10"})})})]})]}),(w||x)&&!_&&E.jsxs("div",{className:`bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-200/50 flex flex-col items-center ${w&&!x?"animate-slide-up":x?"animate-slide-down":""} ${S?"":"opacity-60"}`,children:[E.jsx("div",{className:"w-full flex justify-center pt-1.5 pb-0.5",children:E.jsx(N,{onClick:h})}),E.jsxs("div",{className:"flex items-center gap-2 px-3 pb-2",children:[E.jsx("button",{"data-testid":"sim-step-mobile",className:"bg-blue-600 text-white rounded-full p-3 hover:bg-blue-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:l,disabled:!s||r.length===0,title:"Step forward",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),E.jsx("button",{"data-testid":"sim-simulate-mobile",className:"bg-green-600 text-white rounded-full p-3 hover:bg-green-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:c,disabled:!s||r.length===0,title:"Simulate with animation",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:E.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})}),E.jsx("button",{"data-testid":"sim-run-mobile",className:"bg-yellow-600 text-white rounded-full p-3 hover:bg-yellow-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!1}catch{}u()},disabled:!s||r.length===0,title:"Run to completion",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7"})})})]})]})]}),E.jsx(a2,{stats:p,onDismiss:m})]})}return E.jsxs("div",{"data-testid":"simulation-manager",className:"simulation-manager w-full px-4 py-2 mx-0",children:[E.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Simulation"}),i&&E.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4",children:i}),E.jsxs("div",{className:"bg-gray-200 p-3 rounded-lg shadow-lg border border-gray-300",children:[E.jsxs("div",{className:"flex items-center justify-between space-x-3 mb-3",children:[E.jsxs("button",{"data-testid":"sim-step",className:"flex-1 h-12 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:l,disabled:!s||_||r.length===0,title:"Execute one step forward",children:[E.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),E.jsx("span",{className:"text-xs font-bold",children:"Step"})]}),E.jsxs("button",{"data-testid":"sim-simulate",className:"flex-1 h-12 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:c,disabled:!s||_||r.length===0,title:"Simulate with animation",children:[E.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:E.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})}),E.jsx("span",{className:"text-xs font-bold",children:"Simulate"})]}),E.jsxs("button",{"data-testid":"sim-run",className:"flex-1 h-12 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!1}catch{}u()},disabled:!s||_||r.length===0,title:"Run to completion",children:[E.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7"})})}),E.jsx("span",{className:"text-xs font-bold",children:"Run"})]})]}),E.jsx("div",{children:E.jsxs("button",{"data-testid":"sim-stop",className:"w-full h-10 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 flex items-center justify-center space-x-2 transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!0}catch{}f()},disabled:!_,title:"Stop simulation or run",children:[E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:E.jsx("rect",{x:"7",y:"7",width:"10",height:"10"})}),E.jsx("span",{className:"text-sm font-bold",children:"STOP"})]})}),n&&E.jsx("div",{className:"mt-2 flex items-center justify-center",children:E.jsxs("span",{className:"inline-flex items-center space-x-1 text-green-600",children:[E.jsx("span",{className:"w-4 h-4 bg-green-500 rounded-full sim-pulse-strong"}),E.jsx("span",{className:"font-medium text-sm",children:"Simulation running..."})]})})]}),E.jsx(a2,{stats:p,onDismiss:m})]})},z_=({isOpen:t,onClose:e})=>{const{z3Settings:n,setZ3Settings:r}=$t(),[i,s]=O.useState(0),[l,c]=O.useState(3e5),[u,f]=O.useState(!0),[p,m]=O.useState(1e4);O.useEffect(()=>{t&&(s(Number((n==null?void 0:n.poolSize)??0)),c(Number((n==null?void 0:n.idleTimeoutMs)??3e5)),f(!!((n==null?void 0:n.prewarmOnAlgebraicMode)??!0)),m(Number((n==null?void 0:n.solverTimeoutMs)??1e4)))},[t,n]);const w=()=>{const y={poolSize:Math.max(0,Number(i)||0),idleTimeoutMs:Math.max(1e3,Number(l)||3e5),prewarmOnAlgebraicMode:!!u,solverTimeoutMs:Math.max(100,Number(p)||1e4)};try{typeof window<"u"&&ni(()=>Promise.resolve().then(()=>Qa),void 0,import.meta.url).then(x=>x.setZ3WorkerConfig(y)).catch(()=>{})}catch{}try{r(y)}catch{}e==null||e()};return t?E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:E.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4",children:[E.jsxs("div",{className:"flex justify-between items-center mb-4",children:[E.jsx("h2",{className:"text-xl font-semibold",children:"Z3 Settings"}),E.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:""})]}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Worker Pool"}),E.jsx("div",{className:"space-y-3",children:E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsx("div",{className:"text-sm",children:"Pool size (0 = on-demand)"}),E.jsx("input",{type:"number",min:0,max:8,value:i,onChange:y=>s(y.target.value),className:"w-24 border rounded px-2 py-1 text-sm"})]})})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lifecycle"}),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsx("div",{className:"text-sm",children:"idleTimeoutMs"}),E.jsx("input",{type:"number",min:1e3,max:36e5,step:1e3,value:l,onChange:y=>c(y.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]}),E.jsxs("label",{className:"flex items-center text-sm",children:[E.jsx("input",{type:"checkbox",checked:u,onChange:y=>f(y.target.checked),className:"mr-2"}),"Pre-warm when switching to Algebraic mode"]}),E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsx("div",{className:"text-sm",children:"Solver timeout (ms)"}),E.jsx("input",{type:"number",min:100,max:6e4,step:100,value:p,onChange:y=>m(y.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]})]})]}),E.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-3",children:[E.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-1",children:"Notes"}),E.jsxs("ul",{className:"text-xs text-purple-700 space-y-1",children:[E.jsx("li",{children:" Pool size 0 keeps workers off until a batch run forces 8 workers"}),E.jsx("li",{children:" Idle timeout trims the pool back to the configured size after bursts"}),E.jsx("li",{children:" Pre-warm hides first-use latency when switching to algebraic-int"}),E.jsx("li",{children:" Solver timeout applies to boolean predicate checks (headless runs benefit from a shorter timeout)"})]})]})]}),E.jsxs("div",{className:"mt-6 flex justify-end",children:[E.jsx("button",{onClick:e,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors mr-2",children:"Cancel"}),E.jsx("button",{onClick:w,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:"Save"})]})]})}):null},Ea=2e5,u2=1e3,B_=({isOpen:t,onClose:e})=>{const{simulatorCore:n,simulationSettings:r,handleSaveSettings:i,elements:s,z3Settings:l,setZ3Settings:c}=$t(),[u,f]=O.useState("single"),[p,m]=O.useState(!1),[w,y]=O.useState(Ea),[x,b]=O.useState(!1),[_,S]=O.useState("pt"),[T,h]=O.useState(!1),[k,C]=O.useState(!1),[N,A]=O.useState(!1),[M,R]=O.useState(!1),[I,j]=O.useState(!1),[z,W]=O.useState(u2);O.useEffect(()=>{var U,G,F;if(t){try{if(n){const ce=n.getSimulationMode?n.getSimulationMode():"single";f(ce)}}catch(ce){we.warn("Could not get current simulation mode:",ce)}const Y=Number((r==null?void 0:r.maxIterations)??Ea),X=!!(r!=null&&r.limitIterations);b(X);const te=Number.isFinite(Y)&&Y>0?Math.max(1,Math.min(1e6,Math.floor(Y))):Ea;y(te);const K=(r==null?void 0:r.netMode)||"pt";S(K);const ee=!!(r!=null&&r.batchMode);R(ee);const ne=!!(ee||r!=null&&r.useNonVisualRun);A(ne),j(!!(r!=null&&r.showInferredTypes)),W((r==null?void 0:r.animationDelayMs)??u2),ee&&u!=="maximal"&&V("maximal");try{const ce=(((U=s==null?void 0:s.places)==null?void 0:U.length)||0)>0||(((G=s==null?void 0:s.transitions)==null?void 0:G.length)||0)>0||(((F=s==null?void 0:s.arcs)==null?void 0:F.length)||0)>0;h(!!ce)}catch{h(!1)}}},[t,n,r]);const V=async U=>{if(!n||!n.setSimulationMode){f(U);return}m(!0);try{await n.setSimulationMode(U),f(U),we.info("Simulation mode changed to:",U)}catch(G){we.error("Failed to change simulation mode:",G),f(u)}finally{m(!1)}},D=()=>{const U=!!x,G=Math.max(1,Math.min(1e6,Math.floor(Number(w)||Ea)));i({...r,maxIterations:U?G:Ea,limitIterations:U,netMode:_,useNonVisualRun:M?!0:N,batchMode:M,showInferredTypes:I,animationDelayMs:z}),e==null||e()};return t?E.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:[E.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4 max-h-[90vh] flex flex-col",children:[E.jsxs("div",{className:"flex justify-between items-center mb-4",children:[E.jsx("h2",{className:"text-xl font-semibold",children:"Simulation Settings"}),E.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold","data-testid":"settings-close",children:""})]}),E.jsxs("div",{className:"space-y-4 overflow-y-auto flex-1 pr-2",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Limits"}),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsx("div",{className:"text-sm",children:"Max iterations"}),E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx("input",{type:"number",min:1,max:1e6,value:w,onChange:U=>y(U.target.value),disabled:!x,className:"w-24 border rounded px-2 py-1 text-sm disabled:bg-gray-100"}),E.jsxs("label",{className:"flex items-center text-sm",children:[E.jsx("input",{type:"checkbox",checked:x,onChange:U=>{const G=U.target.checked;b(G),G&&(!Number.isFinite(Number(w))||Number(w)<=0)&&y(100)},className:"mr-1"}),"Limit iterations"]})]})]}),!x&&E.jsx("div",{className:"text-xs text-gray-600",children:"Default runs allow up to 200,000 steps when this option is unchecked."})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Run Options"}),E.jsxs("label",{className:"flex items-center text-sm",children:[E.jsx("input",{type:"checkbox",checked:M?!0:N,onChange:U=>{const G=U.target.checked;A(G)},disabled:M,className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"Use non-visual execution for Run"})," - No per-step animations"]})]}),E.jsxs("label",{className:"flex items-center text-sm mt-2",children:[E.jsx("input",{type:"checkbox",checked:M,onChange:U=>{const G=U.target.checked;if(R(G),G){A(!0),V("maximal");try{c(F=>{const Y=F?{...F}:l?{...l}:{};return Number(Y.poolSize||0)>=8?Y:{...Y,poolSize:8}})}catch{}}},className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"Batch mode"})," - Always headless, keeps background worker active"]})]}),M&&E.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Batch mode forces non-visual execution and reuses the simulation worker after the first run."})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Animation Speed (Simulation Mode)"}),E.jsxs("div",{className:"space-y-2",children:[E.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[E.jsx("span",{children:"Fast (200ms)"}),E.jsxs("span",{className:"font-medium text-gray-700",children:[z,"ms"]}),E.jsx("span",{children:"Slow (2s)"})]}),E.jsx("input",{type:"range",min:200,max:2e3,step:100,value:z,onChange:U=>W(Number(U.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),E.jsx("p",{className:"text-xs text-gray-600",children:"Time between transition firings during visual simulation (Play button)."})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type Annotations"}),E.jsxs("label",{className:"flex items-center text-sm",children:[E.jsx("input",{type:"checkbox",checked:I,onChange:U=>j(U.target.checked),className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"Show inferred variable types"}),"  Display automatically inferred types in guards and bindings"]})]}),E.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"When off, only manually annotated types remain visible so expressions stay concise."})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulation Mode"}),E.jsxs("div",{className:"space-y-2",children:[E.jsxs("label",{className:"flex items-center",children:[E.jsx("input",{type:"radio",name:"simulationMode",value:"single",checked:u==="single",onChange:U=>V(U.target.value),disabled:p,className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"Single Transition"})," - Fire one enabled transition at random"]})]}),E.jsxs("label",{className:"flex items-center",children:[E.jsx("input",{type:"radio",name:"simulationMode",value:"maximal",checked:u==="maximal",onChange:U=>V(U.target.value),disabled:p,className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"Maximal Concurrent"})," - Fire all non-conflicting enabled transitions simultaneously"]})]})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Net Type"}),E.jsxs("div",{className:"space-y-2",children:[E.jsxs("label",{className:"flex items-center",children:[E.jsx("input",{type:"radio",name:"netMode",value:"pt",checked:_==="pt",onChange:U=>S(U.target.value),disabled:T,className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"P/T Net"})," - Classic place/transition nets with counts"]})]}),E.jsxs("label",{className:"flex items-center",children:[E.jsx("input",{type:"radio",name:"netMode",value:"algebraic-int",checked:_==="algebraic-int",onChange:U=>S(U.target.value),disabled:T,className:"mr-2"}),E.jsxs("span",{className:"text-sm",children:[E.jsx("strong",{children:"Algebraic (Integer)"})," - Integer tokens with guard and term labels"]})]}),T&&E.jsx("div",{className:"text-xs text-gray-600",children:"Net type is locked while the canvas has elements. Clear the canvas to switch."})]})]}),p&&E.jsx("div",{className:"text-center text-sm text-gray-600",children:"Updating simulation mode..."})]}),E.jsxs("div",{className:"mt-6 pt-4 flex justify-end border-t border-gray-200",children:[E.jsx("button",{onClick:()=>C(!0),className:"px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition-colors mr-auto",children:"Z3 Settings"}),E.jsx("button",{onClick:e,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors mr-2","data-testid":"settings-cancel",children:"Cancel"}),E.jsx("button",{onClick:D,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors","data-testid":"settings-save",children:"Save"})]})]}),k&&E.jsx(z_,{isOpen:k,onClose:()=>C(!1)})]}):null};var G5={exports:{}},ud={},Bc={},Re={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object globalThis]")}t.glob=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.20",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const r=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=r,t.Konva._injectGlobal(t.Konva)})(Re);var pt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Re;class n{constructor(k=[1,0,0,1,0,0]){this.dirty=!1,this.m=k&&k.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(k){k.m[0]=this.m[0],k.m[1]=this.m[1],k.m[2]=this.m[2],k.m[3]=this.m[3],k.m[4]=this.m[4],k.m[5]=this.m[5]}point(k){const C=this.m;return{x:C[0]*k.x+C[2]*k.y+C[4],y:C[1]*k.x+C[3]*k.y+C[5]}}translate(k,C){return this.m[4]+=this.m[0]*k+this.m[2]*C,this.m[5]+=this.m[1]*k+this.m[3]*C,this}scale(k,C){return this.m[0]*=k,this.m[1]*=k,this.m[2]*=C,this.m[3]*=C,this}rotate(k){const C=Math.cos(k),N=Math.sin(k),A=this.m[0]*C+this.m[2]*N,M=this.m[1]*C+this.m[3]*N,R=this.m[0]*-N+this.m[2]*C,I=this.m[1]*-N+this.m[3]*C;return this.m[0]=A,this.m[1]=M,this.m[2]=R,this.m[3]=I,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(k,C){const N=this.m[0]+this.m[2]*C,A=this.m[1]+this.m[3]*C,M=this.m[2]+this.m[0]*k,R=this.m[3]+this.m[1]*k;return this.m[0]=N,this.m[1]=A,this.m[2]=M,this.m[3]=R,this}multiply(k){const C=this.m[0]*k.m[0]+this.m[2]*k.m[1],N=this.m[1]*k.m[0]+this.m[3]*k.m[1],A=this.m[0]*k.m[2]+this.m[2]*k.m[3],M=this.m[1]*k.m[2]+this.m[3]*k.m[3],R=this.m[0]*k.m[4]+this.m[2]*k.m[5]+this.m[4],I=this.m[1]*k.m[4]+this.m[3]*k.m[5]+this.m[5];return this.m[0]=C,this.m[1]=N,this.m[2]=A,this.m[3]=M,this.m[4]=R,this.m[5]=I,this}invert(){const k=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),C=this.m[3]*k,N=-this.m[1]*k,A=-this.m[2]*k,M=this.m[0]*k,R=k*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),I=k*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=C,this.m[1]=N,this.m[2]=A,this.m[3]=M,this.m[4]=R,this.m[5]=I,this}getMatrix(){return this.m}decompose(){const k=this.m[0],C=this.m[1],N=this.m[2],A=this.m[3],M=this.m[4],R=this.m[5],I=k*A-C*N,j={x:M,y:R,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(k!=0||C!=0){const z=Math.sqrt(k*k+C*C);j.rotation=C>0?Math.acos(k/z):-Math.acos(k/z),j.scaleX=z,j.scaleY=I/z,j.skewX=(k*N+C*A)/I,j.skewY=0}else if(N!=0||A!=0){const z=Math.sqrt(N*N+A*A);j.rotation=Math.PI/2-(A>0?Math.acos(-N/z):-Math.acos(N/z)),j.scaleX=I/z,j.scaleY=z,j.skewX=0,j.skewY=(k*N+C*A)/I}return j.rotation=t.Util._getRotation(j.rotation),j}}t.Transform=n;const r="[object Array]",i="[object Number]",s="[object String]",l="[object Boolean]",c=Math.PI/180,u=180/Math.PI,f="#",p="",m="0",w="Konva warning: ",y="Konva error: ",x="rgb(",b={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},_=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let S=[];const T=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(h){setTimeout(h,60)};t.Util={_isElement(h){return!!(h&&h.nodeType==1)},_isFunction(h){return!!(h&&h.constructor&&h.call&&h.apply)},_isPlainObject(h){return!!h&&h.constructor===Object},_isArray(h){return Object.prototype.toString.call(h)===r},_isNumber(h){return Object.prototype.toString.call(h)===i&&!isNaN(h)&&isFinite(h)},_isString(h){return Object.prototype.toString.call(h)===s},_isBoolean(h){return Object.prototype.toString.call(h)===l},isObject(h){return h instanceof Object},isValidSelector(h){if(typeof h!="string")return!1;const k=h[0];return k==="#"||k==="."||k===k.toUpperCase()},_sign(h){return h===0||h>0?1:-1},requestAnimFrame(h){S.push(h),S.length===1&&T(function(){const k=S;S=[],k.forEach(function(C){C()})})},createCanvasElement(){const h=document.createElement("canvas");try{h.style=h.style||{}}catch{}return h},createImageElement(){return document.createElement("img")},_isInDocument(h){for(;h=h.parentNode;)if(h==document)return!0;return!1},_urlToImage(h,k){const C=t.Util.createImageElement();C.onload=function(){k(C)},C.src=h},_rgbToHex(h,k,C){return((1<<24)+(h<<16)+(k<<8)+C).toString(16).slice(1)},_hexToRgb(h){h=h.replace(f,p);const k=parseInt(h,16);return{r:k>>16&255,g:k>>8&255,b:k&255}},getRandomColor(){let h=(Math.random()*16777215<<0).toString(16);for(;h.length<6;)h=m+h;return f+h},getRGB(h){let k;return h in b?(k=b[h],{r:k[0],g:k[1],b:k[2]}):h[0]===f?this._hexToRgb(h.substring(1)):h.substr(0,4)===x?(k=_.exec(h.replace(/ /g,"")),{r:parseInt(k[1],10),g:parseInt(k[2],10),b:parseInt(k[3],10)}):{r:0,g:0,b:0}},colorToRGBA(h){return h=h||"black",t.Util._namedColorToRBA(h)||t.Util._hex3ColorToRGBA(h)||t.Util._hex4ColorToRGBA(h)||t.Util._hex6ColorToRGBA(h)||t.Util._hex8ColorToRGBA(h)||t.Util._rgbColorToRGBA(h)||t.Util._rgbaColorToRGBA(h)||t.Util._hslColorToRGBA(h)},_namedColorToRBA(h){const k=b[h.toLowerCase()];return k?{r:k[0],g:k[1],b:k[2],a:1}:null},_rgbColorToRGBA(h){if(h.indexOf("rgb(")===0){h=h.match(/rgb\(([^)]+)\)/)[1];const k=h.split(/ *, */).map(Number);return{r:k[0],g:k[1],b:k[2],a:1}}},_rgbaColorToRGBA(h){if(h.indexOf("rgba(")===0){h=h.match(/rgba\(([^)]+)\)/)[1];const k=h.split(/ *, */).map((C,N)=>C.slice(-1)==="%"?N===3?parseInt(C)/100:parseInt(C)/100*255:Number(C));return{r:k[0],g:k[1],b:k[2],a:k[3]}}},_hex8ColorToRGBA(h){if(h[0]==="#"&&h.length===9)return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16),a:parseInt(h.slice(7,9),16)/255}},_hex6ColorToRGBA(h){if(h[0]==="#"&&h.length===7)return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16),a:1}},_hex4ColorToRGBA(h){if(h[0]==="#"&&h.length===5)return{r:parseInt(h[1]+h[1],16),g:parseInt(h[2]+h[2],16),b:parseInt(h[3]+h[3],16),a:parseInt(h[4]+h[4],16)/255}},_hex3ColorToRGBA(h){if(h[0]==="#"&&h.length===4)return{r:parseInt(h[1]+h[1],16),g:parseInt(h[2]+h[2],16),b:parseInt(h[3]+h[3],16),a:1}},_hslColorToRGBA(h){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(h)){const[k,...C]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(h),N=Number(C[0])/360,A=Number(C[1])/100,M=Number(C[2])/100;let R,I,j;if(A===0)return j=M*255,{r:Math.round(j),g:Math.round(j),b:Math.round(j),a:1};M<.5?R=M*(1+A):R=M+A-M*A;const z=2*M-R,W=[0,0,0];for(let V=0;V<3;V++)I=N+1/3*-(V-1),I<0&&I++,I>1&&I--,6*I<1?j=z+(R-z)*6*I:2*I<1?j=R:3*I<2?j=z+(R-z)*(2/3-I)*6:j=z,W[V]=j*255;return{r:Math.round(W[0]),g:Math.round(W[1]),b:Math.round(W[2]),a:1}}},haveIntersection(h,k){return!(k.x>h.x+h.width||k.x+k.width<h.x||k.y>h.y+h.height||k.y+k.height<h.y)},cloneObject(h){const k={};for(const C in h)this._isPlainObject(h[C])?k[C]=this.cloneObject(h[C]):this._isArray(h[C])?k[C]=this.cloneArray(h[C]):k[C]=h[C];return k},cloneArray(h){return h.slice(0)},degToRad(h){return h*c},radToDeg(h){return h*u},_degToRad(h){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(h)},_radToDeg(h){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(h)},_getRotation(h){return e.Konva.angleDeg?t.Util.radToDeg(h):h},_capitalize(h){return h.charAt(0).toUpperCase()+h.slice(1)},throw(h){throw new Error(y+h)},error(h){console.error(y+h)},warn(h){e.Konva.showWarnings&&console.warn(w+h)},each(h,k){for(const C in h)k(C,h[C])},_inRange(h,k,C){return k<=h&&h<C},_getProjectionToSegment(h,k,C,N,A,M){let R,I,j;const z=(h-C)*(h-C)+(k-N)*(k-N);if(z==0)R=h,I=k,j=(A-C)*(A-C)+(M-N)*(M-N);else{const W=((A-h)*(C-h)+(M-k)*(N-k))/z;W<0?(R=h,I=k,j=(h-A)*(h-A)+(k-M)*(k-M)):W>1?(R=C,I=N,j=(C-A)*(C-A)+(N-M)*(N-M)):(R=h+W*(C-h),I=k+W*(N-k),j=(R-A)*(R-A)+(I-M)*(I-M))}return[R,I,j]},_getProjectionToLine(h,k,C){const N=t.Util.cloneObject(h);let A=Number.MAX_VALUE;return k.forEach(function(M,R){if(!C&&R===k.length-1)return;const I=k[(R+1)%k.length],j=t.Util._getProjectionToSegment(M.x,M.y,I.x,I.y,h.x,h.y),z=j[0],W=j[1],V=j[2];V<A&&(N.x=z,N.y=W,A=V)}),N},_prepareArrayForTween(h,k,C){const N=[],A=[];if(h.length>k.length){const R=k;k=h,h=R}for(let R=0;R<h.length;R+=2)N.push({x:h[R],y:h[R+1]});for(let R=0;R<k.length;R+=2)A.push({x:k[R],y:k[R+1]});const M=[];return A.forEach(function(R){const I=t.Util._getProjectionToLine(R,N,C);M.push(I.x),M.push(I.y)}),M},_prepareToStringify(h){let k;h.visitedByCircularReferenceRemoval=!0;for(const C in h)if(h.hasOwnProperty(C)&&h[C]&&typeof h[C]=="object"){if(k=Object.getOwnPropertyDescriptor(h,C),h[C].visitedByCircularReferenceRemoval||t.Util._isElement(h[C]))if(k.configurable)delete h[C];else return null;else if(t.Util._prepareToStringify(h[C])===null)if(k.configurable)delete h[C];else return null}return delete h.visitedByCircularReferenceRemoval,h},_assign(h,k){for(const C in k)h[C]=k[C];return h},_getFirstPointerId(h){return h.touches?h.changedTouches[0].identifier:h.pointerId||999},releaseCanvas(...h){e.Konva.releaseCanvasOnDestroy&&h.forEach(k=>{k.width=0,k.height=0})},drawRoundedRectPath(h,k,C,N){let A=0,M=0,R=0,I=0;typeof N=="number"?A=M=R=I=Math.min(N,k/2,C/2):(A=Math.min(N[0]||0,k/2,C/2),M=Math.min(N[1]||0,k/2,C/2),I=Math.min(N[2]||0,k/2,C/2),R=Math.min(N[3]||0,k/2,C/2)),h.moveTo(A,0),h.lineTo(k-M,0),h.arc(k-M,M,M,Math.PI*3/2,0,!1),h.lineTo(k,C-I),h.arc(k-I,C-I,I,0,Math.PI/2,!1),h.lineTo(R,C),h.arc(R,C-R,R,Math.PI/2,Math.PI,!1),h.lineTo(0,A),h.arc(A,A,A,Math.PI,Math.PI*3/2,!1)}}})(pt);var lt={},je={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.RGBComponent=U_;Te.alphaComponent=G_;Te.getNumberValidator=V_;Te.getNumberOrArrayOfNumbersValidator=W_;Te.getNumberOrAutoValidator=$_;Te.getStringValidator=H_;Te.getStringOrGradientValidator=Y_;Te.getFunctionValidator=X_;Te.getNumberArrayValidator=K_;Te.getBooleanValidator=Q_;Te.getComponentValidator=Z_;const ui=Re,yt=pt;function ci(t){return yt.Util._isString(t)?'"'+t+'"':Object.prototype.toString.call(t)==="[object Number]"||yt.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}function U_(t){return t>255?255:t<0?0:Math.round(t)}function G_(t){return t>1?1:t<1e-4?1e-4:t}function V_(){if(ui.Konva.isUnminified)return function(t,e){return yt.Util._isNumber(t)||yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function W_(t){if(ui.Konva.isUnminified)return function(e,n){let r=yt.Util._isNumber(e),i=yt.Util._isArray(e)&&e.length==t;return!r&&!i&&yt.Util.warn(ci(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function $_(){if(ui.Konva.isUnminified)return function(t,e){var n=yt.Util._isNumber(t),r=t==="auto";return n||r||yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function H_(){if(ui.Konva.isUnminified)return function(t,e){return yt.Util._isString(t)||yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function Y_(){if(ui.Konva.isUnminified)return function(t,e){const n=yt.Util._isString(t),r=Object.prototype.toString.call(t)==="[object CanvasGradient]"||t&&t.addColorStop;return n||r||yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function X_(){if(ui.Konva.isUnminified)return function(t,e){return yt.Util._isFunction(t)||yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),t}}function K_(){if(ui.Konva.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(yt.Util._isArray(t)?t.forEach(function(r){yt.Util._isNumber(r)||yt.Util.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}function Q_(){if(ui.Konva.isUnminified)return function(t,e){var n=t===!0||t===!1;return n||yt.Util.warn(ci(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}function Z_(t){if(ui.Konva.isUnminified)return function(e,n){return e==null||yt.Util.isObject(e)||yt.Util.warn(ci(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=pt,n=Te,r="get",i="set";t.Factory={addGetterSetter(s,l,c,u,f){t.Factory.addGetter(s,l,c),t.Factory.addSetter(s,l,u,f),t.Factory.addOverloadedGetterSetter(s,l)},addGetter(s,l,c){var u=r+e.Util._capitalize(l);s.prototype[u]=s.prototype[u]||function(){const f=this.attrs[l];return f===void 0?c:f}},addSetter(s,l,c,u){var f=i+e.Util._capitalize(l);s.prototype[f]||t.Factory.overWriteSetter(s,l,c,u)},overWriteSetter(s,l,c,u){var f=i+e.Util._capitalize(l);s.prototype[f]=function(p){return c&&p!==void 0&&p!==null&&(p=c.call(this,p,l)),this._setAttr(l,p),u&&u.call(this),this}},addComponentsGetterSetter(s,l,c,u,f){const p=c.length,m=e.Util._capitalize,w=r+m(l),y=i+m(l);s.prototype[w]=function(){const b={};for(let _=0;_<p;_++){const S=c[_];b[S]=this.getAttr(l+m(S))}return b};const x=(0,n.getComponentValidator)(c);s.prototype[y]=function(b){const _=this.attrs[l];u&&(b=u.call(this,b,l)),x&&x.call(this,b,l);for(const S in b)b.hasOwnProperty(S)&&this._setAttr(l+m(S),b[S]);return b||c.forEach(S=>{this._setAttr(l+m(S),void 0)}),this._fireChangeEvent(l,_,b),f&&f.call(this),this},t.Factory.addOverloadedGetterSetter(s,l)},addOverloadedGetterSetter(s,l){var c=e.Util._capitalize(l),u=i+c,f=r+c;s.prototype[l]=function(){return arguments.length?(this[u](arguments[0]),this):this[f]()}},addDeprecatedGetterSetter(s,l,c,u){e.Util.error("Adding deprecated "+l);const f=r+e.Util._capitalize(l),p=l+" property is deprecated and will be removed soon. Look at Konva change log for more information.";s.prototype[f]=function(){e.Util.error(p);const m=this.attrs[l];return m===void 0?c:m},t.Factory.addSetter(s,l,u,function(){e.Util.error(p)}),t.Factory.addOverloadedGetterSetter(s,l)},backCompat(s,l){e.Util.each(l,function(c,u){const f=s.prototype[u],p=r+e.Util._capitalize(c),m=i+e.Util._capitalize(c);function w(){f.apply(this,arguments),e.Util.error('"'+c+'" method is deprecated and will be removed soon. Use ""'+u+'" instead.')}s.prototype[c]=w,s.prototype[p]=w,s.prototype[m]=w})},afterSetFilter(){this._filterUpToDate=!1}}})(je);var yr={},ri={};Object.defineProperty(ri,"__esModule",{value:!0});ri.HitContext=ri.SceneContext=ri.Context=void 0;const V5=pt,q_=Re;function J_(t){const e=[],n=t.length,r=V5.Util;for(let i=0;i<n;i++){let s=t[i];r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s+""),e.push(s)}return e}const c2=",",e7="(",t7=")",n7="([",r7="])",i7=";",s7="()",o7="=",d2=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],a7=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],l7=100;class cd{constructor(e){this.canvas=e,q_.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,n){let r=this.traceArr,i=r.length,s="",l,c,u,f;for(l=0;l<i;l++)c=r[l],u=c.method,u?(f=c.args,s+=u,e?s+=s7:V5.Util._isArray(f[0])?s+=n7+f.join(c2)+r7:(n&&(f=f.map(p=>typeof p=="number"?Math.floor(p):p)),s+=e7+f.join(c2)+t7)):(s+=c.property,e||(s+=o7+c.val)),s+=i7;return s}clearTrace(){this.traceArr=[]}_trace(e){let n=this.traceArr,r;n.push(e),r=n.length,r>=l7&&n.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const n=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,n.getWidth()/n.pixelRatio,n.getHeight()/n.pixelRatio)}_applyLineCap(e){const n=e.attrs.lineCap;n&&this.setAttr("lineCap",n)}_applyOpacity(e){const n=e.getAbsoluteOpacity();n!==1&&this.setAttr("globalAlpha",n)}_applyLineJoin(e){const n=e.attrs.lineJoin;n&&this.setAttr("lineJoin",n)}setAttr(e,n){this._context[e]=n}arc(e,n,r,i,s,l){this._context.arc(e,n,r,i,s,l)}arcTo(e,n,r,i,s){this._context.arcTo(e,n,r,i,s)}beginPath(){this._context.beginPath()}bezierCurveTo(e,n,r,i,s,l){this._context.bezierCurveTo(e,n,r,i,s,l)}clearRect(e,n,r,i){this._context.clearRect(e,n,r,i)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,n){const r=arguments;if(r.length===2)return this._context.createImageData(e,n);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,n,r,i){return this._context.createLinearGradient(e,n,r,i)}createPattern(e,n){return this._context.createPattern(e,n)}createRadialGradient(e,n,r,i,s,l){return this._context.createRadialGradient(e,n,r,i,s,l)}drawImage(e,n,r,i,s,l,c,u,f){const p=arguments,m=this._context;p.length===3?m.drawImage(e,n,r):p.length===5?m.drawImage(e,n,r,i,s):p.length===9&&m.drawImage(e,n,r,i,s,l,c,u,f)}ellipse(e,n,r,i,s,l,c,u){this._context.ellipse(e,n,r,i,s,l,c,u)}isPointInPath(e,n,r,i){return r?this._context.isPointInPath(r,e,n,i):this._context.isPointInPath(e,n,i)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,n,r,i){this._context.fillRect(e,n,r,i)}strokeRect(e,n,r,i){this._context.strokeRect(e,n,r,i)}fillText(e,n,r,i){i?this._context.fillText(e,n,r,i):this._context.fillText(e,n,r)}measureText(e){return this._context.measureText(e)}getImageData(e,n,r,i){return this._context.getImageData(e,n,r,i)}lineTo(e,n){this._context.lineTo(e,n)}moveTo(e,n){this._context.moveTo(e,n)}rect(e,n,r,i){this._context.rect(e,n,r,i)}roundRect(e,n,r,i,s){this._context.roundRect(e,n,r,i,s)}putImageData(e,n,r){this._context.putImageData(e,n,r)}quadraticCurveTo(e,n,r,i){this._context.quadraticCurveTo(e,n,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,n){this._context.scale(e,n)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,n,r,i,s,l){this._context.setTransform(e,n,r,i,s,l)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,n,r,i){this._context.strokeText(e,n,r,i)}transform(e,n,r,i,s,l){this._context.transform(e,n,r,i,s,l)}translate(e,n){this._context.translate(e,n)}_enableTrace(){let e=this,n=d2.length,r=this.setAttr,i,s;const l=function(c){let u=e[c],f;e[c]=function(){return s=J_(Array.prototype.slice.call(arguments,0)),f=u.apply(e,arguments),e._trace({method:c,args:s}),f}};for(i=0;i<n;i++)l(d2[i]);e.setAttr=function(){r.apply(e,arguments);const c=arguments[0];let u=arguments[1];(c==="shadowOffsetX"||c==="shadowOffsetY"||c==="shadowBlur")&&(u=u/this.canvas.getPixelRatio()),e._trace({property:c,val:u})}}_applyGlobalCompositeOperation(e){const n=e.attrs.globalCompositeOperation;!n||n==="source-over"||this.setAttr("globalCompositeOperation",n)}}ri.Context=cd;a7.forEach(function(t){Object.defineProperty(cd.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class u7 extends cd{constructor(e,{willReadFrequently:n=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:n})}_fillColor(e){const n=e.fill();this.setAttr("fillStyle",n),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const n=e._getLinearGradient();n&&(this.setAttr("fillStyle",n),e._fillFunc(this))}_fillRadialGradient(e){const n=e._getRadialGradient();n&&(this.setAttr("fillStyle",n),e._fillFunc(this))}_fill(e){const n=e.fill(),r=e.getFillPriority();if(n&&r==="color"){this._fillColor(e);return}const i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}const s=e.getFillLinearGradientColorStops();if(s&&r==="linear-gradient"){this._fillLinearGradient(e);return}const l=e.getFillRadialGradientColorStops();if(l&&r==="radial-gradient"){this._fillRadialGradient(e);return}n?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):l&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const n=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(n.x,n.y,r.x,r.y);if(i){for(let l=0;l<i.length;l+=2)s.addColorStop(i[l],i[l+1]);this.setAttr("strokeStyle",s)}}_stroke(e){const n=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e),n&&e.dashEnabled()&&(this.setLineDash(n),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var n,r,i;const s=(n=e.getShadowRGBA())!==null&&n!==void 0?n:"black",l=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,c=(i=e.getShadowOffset())!==null&&i!==void 0?i:{x:0,y:0},u=e.getAbsoluteScale(),f=this.canvas.getPixelRatio(),p=u.x*f,m=u.y*f;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",l*Math.min(Math.abs(p),Math.abs(m))),this.setAttr("shadowOffsetX",c.x*p),this.setAttr("shadowOffsetY",c.y*m)}}ri.SceneContext=u7;class c7 extends cd{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const n=e.getStrokeScaleEnabled();if(!n){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e);const r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),n||this.restore()}}}ri.HitContext=c7;Object.defineProperty(yr,"__esModule",{value:!0});yr.HitCanvas=yr.SceneCanvas=yr.Canvas=void 0;const Uc=pt,W5=ri,$5=Re;let Gu;function d7(){if(Gu)return Gu;const t=Uc.Util.createCanvasElement(),e=t.getContext("2d");return Gu=function(){const n=$5.Konva._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return n/r}(),Uc.Util.releaseCanvas(t),Gu}class kg{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||$5.Konva.pixelRatio||d7();this.pixelRatio=r,this._canvas=Uc.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const n=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/n,this.getHeight()/n)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const n=this.pixelRatio;this.getContext()._context.scale(n,n)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const n=this.pixelRatio;this.getContext()._context.scale(n,n)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,n){this.setWidth(e||0),this.setHeight(n||0)}toDataURL(e,n){try{return this._canvas.toDataURL(e,n)}catch{try{return this._canvas.toDataURL()}catch(i){return Uc.Util.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}yr.Canvas=kg;class f7 extends kg{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new W5.SceneContext(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}yr.SceneCanvas=f7;class h7 extends kg{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new W5.HitContext(this),this.setSize(e.width,e.height)}}yr.HitCanvas=h7;var dd={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Re,n=pt;t.DD={get isDragging(){let r=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(r=!0)}),r},justDragged:!1,get node(){let r;return t.DD._dragElements.forEach(i=>{r=i.node}),r},_dragElements:new Map,_drag(r){const i=[];t.DD._dragElements.forEach((s,l)=>{const{node:c}=s,u=c.getStage();u.setPointersPositions(r),s.pointerId===void 0&&(s.pointerId=n.Util._getFirstPointerId(r));const f=u._changedPointerPositions.find(p=>p.id===s.pointerId);if(f){if(s.dragStatus!=="dragging"){const p=c.dragDistance();if(Math.max(Math.abs(f.x-s.startPointerPos.x),Math.abs(f.y-s.startPointerPos.y))<p||(c.startDrag({evt:r}),!c.isDragging()))return}c._setDragPosition(r,s),i.push(c)}}),i.forEach(s=>{s.fire("dragmove",{type:"dragmove",target:s,evt:r},!0)})},_endDragBefore(r){const i=[];t.DD._dragElements.forEach(s=>{const{node:l}=s,c=l.getStage();if(r&&c.setPointersPositions(r),!c._changedPointerPositions.find(p=>p.id===s.pointerId))return;(s.dragStatus==="dragging"||s.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,s.dragStatus="stopped");const f=s.node.getLayer()||s.node instanceof e.Konva.Stage&&s.node;f&&i.indexOf(f)===-1&&i.push(f)}),i.forEach(s=>{s.draw()})},_endDragAfter(r){t.DD._dragElements.forEach((i,s)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:r},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(s)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(dd);Object.defineProperty(lt,"__esModule",{value:!0});lt.Node=void 0;const Oe=pt,El=je,Na=yr,Ei=Re,Hn=dd,_t=Te,lc="absoluteOpacity",Vu="allEventListeners",Qr="absoluteTransform",f2="absoluteScale",gs="canvas",p7="Change",g7="children",m7="konva",pp="listening",h2="mouseenter",p2="mouseleave",g2="set",m2="Shape",uc=" ",y2="stage",Ni="transform",y7="Stage",gp="visible",v7=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(uc);let x7=1;class Ne{constructor(e){this._id=x7++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===Ni||e===Qr)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,n){let r=this._cache.get(e);return(r===void 0||(e===Ni||e===Qr)&&r.dirty===!0)&&(r=n.call(this),this._cache.set(e,r)),r}_calculate(e,n,r){if(!this._attachedDepsListeners.get(e)){const i=n.map(s=>s+"Change.konva").join(uc);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(gs)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Qr&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(gs)){const{scene:e,filter:n,hit:r}=this._cache.get(gs);Oe.Util.releaseCanvas(e,n,r),this._cache.delete(gs)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const n=e||{};let r={};(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let i=Math.ceil(n.width||r.width),s=Math.ceil(n.height||r.height),l=n.pixelRatio,c=n.x===void 0?Math.floor(r.x):n.x,u=n.y===void 0?Math.floor(r.y):n.y,f=n.offset||0,p=n.drawBorder||!1,m=n.hitCanvasPixelRatio||1;if(!i||!s){Oe.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const w=Math.abs(Math.round(r.x)-c)>.5?1:0,y=Math.abs(Math.round(r.y)-u)>.5?1:0;i+=f*2+w,s+=f*2+y,c-=f,u-=f;const x=new Na.SceneCanvas({pixelRatio:l,width:i,height:s}),b=new Na.SceneCanvas({pixelRatio:l,width:0,height:0,willReadFrequently:!0}),_=new Na.HitCanvas({pixelRatio:m,width:i,height:s}),S=x.getContext(),T=_.getContext();return _.isCache=!0,x.isCache=!0,this._cache.delete(gs),this._filterUpToDate=!1,n.imageSmoothingEnabled===!1&&(x.getContext()._context.imageSmoothingEnabled=!1,b.getContext()._context.imageSmoothingEnabled=!1),S.save(),T.save(),S.translate(-c,-u),T.translate(-c,-u),this._isUnderCache=!0,this._clearSelfAndDescendantCache(lc),this._clearSelfAndDescendantCache(f2),this.drawScene(x,this),this.drawHit(_,this),this._isUnderCache=!1,S.restore(),T.restore(),p&&(S.save(),S.beginPath(),S.rect(0,0,i,s),S.closePath(),S.setAttr("strokeStyle","red"),S.setAttr("lineWidth",5),S.stroke(),S.restore()),this._cache.set(gs,{scene:x,filter:b,hit:_,x:c,y:u}),this._requestDraw(),this}isCached(){return this._cache.has(gs)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,n){const r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let i=1/0,s=1/0,l=-1/0,c=-1/0;const u=this.getAbsoluteTransform(n);return r.forEach(function(f){const p=u.point(f);i===void 0&&(i=l=p.x,s=c=p.y),i=Math.min(i,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),c=Math.max(c,p.y)}),{x:i,y:s,width:l-i,height:c-s}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const n=this._getCanvasCache();e.translate(n.x,n.y);const r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){const n=this._getCanvasCache(),r=n.hit;e.save(),e.translate(n.x,n.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),n=this._getCanvasCache(),r=n.scene,i=n.filter,s=i.getContext(),l,c,u,f;if(e){if(!this._filterUpToDate){const p=r.pixelRatio;i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(l=e.length,s.clear(),s.drawImage(r._canvas,0,0,r.getWidth()/p,r.getHeight()/p),c=s.getImageData(0,0,i.getWidth(),i.getHeight()),u=0;u<l;u++){if(f=e[u],typeof f!="function"){Oe.Util.error("Filter should be type of function, but got "+typeof f+" instead. Please check correct filters");continue}f.call(this,c),s.putImageData(c,0,0)}}catch(m){Oe.Util.error("Unable to apply filter. "+m.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return i}return r}on(e,n){if(this._cache&&this._cache.delete(Vu),arguments.length===3)return this._delegate.apply(this,arguments);let r=e.split(uc),i=r.length,s,l,c,u,f;for(s=0;s<i;s++)l=r[s],c=l.split("."),u=c[0],f=c[1]||"",this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:f,handler:n});return this}off(e,n){let r=(e||"").split(uc),i=r.length,s,l,c,u,f,p;if(this._cache&&this._cache.delete(Vu),!e)for(l in this.eventListeners)this._off(l);for(s=0;s<i;s++)if(c=r[s],u=c.split("."),f=u[0],p=u[1],f)this.eventListeners[f]&&this._off(f,p,n);else for(l in this.eventListeners)this._off(l,p,n);return this}dispatchEvent(e){const n={target:this,type:e.type,evt:e};return this.fire(e.type,n),this}addEventListener(e,n){return this.on(e,function(r){n.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,n,r){const i=this;this.on(e,function(s){const l=s.target.findAncestors(n,!0,i);for(let c=0;c<l.length;c++)s=Oe.Util.cloneObject(s),s.currentTarget=l[c],r.call(l[c],s)})}remove(){return this.isDragging()&&this.stopDrag(),Hn.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Qr),this._clearSelfAndDescendantCache(lc),this._clearSelfAndDescendantCache(f2),this._clearSelfAndDescendantCache(y2),this._clearSelfAndDescendantCache(gp),this._clearSelfAndDescendantCache(pp)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const n="get"+Oe.Util._capitalize(e);return Oe.Util._isFunction(this[n])?this[n]():this.attrs[e]}getAncestors(){let e=this.getParent(),n=[];for(;e;)n.push(e),e=e.getParent();return n}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let n,r;if(!e)return this;for(n in e)n!==g7&&(r=g2+Oe.Util._capitalize(n),Oe.Util._isFunction(this[r])?this[r](e[n]):this._setAttr(n,e[n]))}),this}isListening(){return this._getCache(pp,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(gp,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,n=!1){if(e)return this._isVisible(e)&&this._isListening(e);const r=this.getLayer();let i=!1;Hn.DD._dragElements.forEach(l=>{l.dragStatus==="dragging"&&(l.node.nodeType==="Stage"||l.node.getLayer()===r)&&(i=!0)});const s=!n&&!Ei.Konva.hitOnDragEnabled&&(i||Ei.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),n=this,r=0,i,s,l,c;function u(p){for(i=[],s=p.length,l=0;l<s;l++)c=p[l],r++,c.nodeType!==m2&&(i=i.concat(c.getChildren().slice())),c._id===n._id&&(l=s);i.length>0&&i[0].getDepth()<=e&&u(i)}const f=this.getStage();return n.nodeType!==y7&&f&&u(f.getChildren()),r}getDepth(){let e=0,n=this.parent;for(;n;)e++,n=n.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Ni),this._clearSelfAndDescendantCache(Qr)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const n=e.getPointerPosition();if(!n)return null;const r=this.getAbsoluteTransform().copy();return r.invert(),r.point(n)}getAbsolutePosition(e){let n=!1,r=this.parent;for(;r;){if(r.isCached()){n=!0;break}r=r.parent}n&&!e&&(e=!0);const i=this.getAbsoluteTransform(e).getMatrix(),s=new Oe.Transform,l=this.offset();return s.m=i.slice(),s.translate(l.x,l.y),s.getTranslation()}setAbsolutePosition(e){const{x:n,y:r,...i}=this._clearTransform();this.attrs.x=n,this.attrs.y=r,this._clearCache(Ni);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(e.x,e.y),e={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(i),this.setPosition({x:e.x,y:e.y}),this._clearCache(Ni),this._clearSelfAndDescendantCache(Qr),this}_setTransform(e){let n;for(n in e)this.attrs[n]=e[n]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let n=e.x,r=e.y,i=this.x(),s=this.y();return n!==void 0&&(i+=n),r!==void 0&&(s+=r),this.setPosition({x:i,y:s}),this}_eachAncestorReverse(e,n){let r=[],i=this.getParent(),s,l;if(!(n&&n._id===this._id)){for(r.unshift(this);i&&(!n||i._id!==n._id);)r.unshift(i),i=i.parent;for(s=r.length,l=0;l<s;l++)e(r[l])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return Oe.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index,n=this.parent.getChildren().length;return e<n-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return Oe.Util.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index,n=this.parent.getChildren().length;return e<n-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return Oe.Util.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return Oe.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return Oe.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&Oe.Util.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const n=this.index;return this.parent.children.splice(n,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(lc,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const n=this.getParent();return n&&!n._isUnderCache&&(e*=n.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),n,r,i,s,l;const c={attrs:{},className:this.getClassName()};for(n in e)r=e[n],l=Oe.Util.isObject(r)&&!Oe.Util._isPlainObject(r)&&!Oe.Util._isArray(r),!l&&(i=typeof this[n]=="function"&&this[n],delete e[n],s=i?i.call(this):null,e[n]=r,s!==r&&(c.attrs[n]=r));return Oe.Util._prepareToStringify(c)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,n,r){const i=[];n&&this._isMatch(e)&&i.push(this);let s=this.parent;for(;s;){if(s===r)return i;s._isMatch(e)&&i.push(s),s=s.parent}return i}isAncestorOf(e){return!1}findAncestor(e,n,r){return this.findAncestors(e,n,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let n=e.replace(/ /g,"").split(","),r=n.length,i,s;for(i=0;i<r;i++)if(s=n[i],Oe.Util.isValidSelector(s)||(Oe.Util.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Oe.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Oe.Util.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(y2,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,n={},r){return n.target=n.target||this,r?this._fireAndBubble(e,n):this._fire(e,n),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Qr,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let n;if(e)return n=new Oe.Transform,this._eachAncestorReverse(function(r){const i=r.transformsEnabled();i==="all"?n.multiply(r.getTransform()):i==="position"&&n.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),n;{n=this._cache.get(Qr)||new Oe.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(n):n.reset();const r=this.transformsEnabled();if(r==="all")n.multiply(this.getTransform());else if(r==="position"){const i=this.attrs.x||0,s=this.attrs.y||0,l=this.attrs.offsetX||0,c=this.attrs.offsetY||0;n.translate(i-l,s-c)}return n.dirty=!1,n}}getAbsoluteScale(e){let n=this;for(;n;)n._isUnderCache&&(e=n),n=n.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Ni,this._getTransform)}_getTransform(){var e,n;const r=this._cache.get(Ni)||new Oe.Transform;r.reset();const i=this.x(),s=this.y(),l=Ei.Konva.getAngle(this.rotation()),c=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,u=(n=this.attrs.scaleY)!==null&&n!==void 0?n:1,f=this.attrs.skewX||0,p=this.attrs.skewY||0,m=this.attrs.offsetX||0,w=this.attrs.offsetY||0;return(i!==0||s!==0)&&r.translate(i,s),l!==0&&r.rotate(l),(f!==0||p!==0)&&r.skew(f,p),(c!==1||u!==1)&&r.scale(c,u),(m!==0||w!==0)&&r.translate(-1*m,-1*w),r.dirty=!1,r}clone(e){let n=Oe.Util.cloneObject(this.attrs),r,i,s,l,c;for(r in e)n[r]=e[r];const u=new this.constructor(n);for(r in this.eventListeners)for(i=this.eventListeners[r],s=i.length,l=0;l<s;l++)c=i[l],c.name.indexOf(m7)<0&&(u.eventListeners[r]||(u.eventListeners[r]=[]),u.eventListeners[r].push(c));return u}_toKonvaCanvas(e){e=e||{};const n=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(n.x),s=e.y!==void 0?e.y:Math.floor(n.y),l=e.pixelRatio||1,c=new Na.SceneCanvas({width:e.width||Math.ceil(n.width)||(r?r.width():0),height:e.height||Math.ceil(n.height)||(r?r.height():0),pixelRatio:l}),u=c.getContext(),f=new Na.SceneCanvas({width:c.width/c.pixelRatio+Math.abs(i),height:c.height/c.pixelRatio+Math.abs(s),pixelRatio:c.pixelRatio});return e.imageSmoothingEnabled===!1&&(u._context.imageSmoothingEnabled=!1),u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(c,void 0,f),u.restore(),c}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};const n=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(n,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((n,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,Oe.Util._urlToImage(this.toDataURL(e),function(s){n(s),i==null||i(s)})}catch(i){r(i)}})}toBlob(e){return new Promise((n,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,this.toCanvas(e).toBlob(s=>{n(s),i==null||i(s)},e==null?void 0:e.mimeType,e==null?void 0:e.quality)}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Ei.Konva.dragDistance}_off(e,n,r){let i=this.eventListeners[e],s,l,c;for(s=0;s<i.length;s++)if(l=i[s].name,c=i[s].handler,(l!=="konva"||n==="konva")&&(!n||l===n)&&(!r||r===c)){if(i.splice(s,1),i.length===0){delete this.eventListeners[e];break}s--}}_fireChangeEvent(e,n,r){this._fire(e+p7,{oldVal:n,newVal:r})}addName(e){if(!this.hasName(e)){const n=this.name(),r=n?n+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const n=this.name();return n?(n||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){const n=(this.name()||"").split(/\s/g),r=n.indexOf(e);return r!==-1&&(n.splice(r,1),this.name(n.join(" "))),this}setAttr(e,n){const r=this[g2+Oe.Util._capitalize(e)];return Oe.Util._isFunction(r)?r.call(this,n):this._setAttr(e,n),this}_requestDraw(){if(Ei.Konva.autoDrawEnabled){const e=this.getLayer()||this.getStage();e==null||e.batchDraw()}}_setAttr(e,n){const r=this.attrs[e];r===n&&!Oe.Util.isObject(n)||(n==null?delete this.attrs[e]:this.attrs[e]=n,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,n),this._requestDraw())}_setComponentAttr(e,n,r){let i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][n]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,n,r){if(n&&this.nodeType===m2&&(n.target=this),!((e===h2||e===p2)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r))){this._fire(e,n);const s=(e===h2||e===p2)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(n&&!n.cancelBubble||!n)&&this.parent&&this.parent.isListening()&&!s&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,n,r):this._fireAndBubble.call(this.parent,e,n))}}_getProtoListeners(e){var n,r,i;const s=(n=this._cache.get(Vu))!==null&&n!==void 0?n:{};let l=s==null?void 0:s[e];if(l===void 0){l=[];let c=Object.getPrototypeOf(this);for(;c;){const u=(i=(r=c.eventListeners)===null||r===void 0?void 0:r[e])!==null&&i!==void 0?i:[];l.push(...u),c=Object.getPrototypeOf(c)}s[e]=l,this._cache.set(Vu,s)}return l}_fire(e,n){n=n||{},n.currentTarget=this,n.type=e;const r=this._getProtoListeners(e);if(r)for(var i=0;i<r.length;i++)r[i].handler.call(this,n);const s=this.eventListeners[e];if(s)for(var i=0;i<s.length;i++)s[i].handler.call(this,n)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const n=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition();if(!r)return;const s=r._getPointerById(n)||r._changedPointerPositions[0]||i;Hn.DD._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-i.x,y:s.y-i.y},dragStatus:"ready",pointerId:n})}startDrag(e,n=!0){Hn.DD._dragElements.has(this._id)||this._createDragElement(e);const r=Hn.DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},n)}_setDragPosition(e,n){const r=this.getStage()._getPointerById(n.pointerId);if(!r)return;let i={x:r.x-n.offset.x,y:r.y-n.offset.y};const s=this.dragBoundFunc();if(s!==void 0){const l=s.call(this,i,e);l?i=l:Oe.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(e){const n=Hn.DD._dragElements.get(this._id);n&&(n.dragStatus="stopped"),Hn.DD._endDragBefore(e),Hn.DD._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=Hn.DD._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||Ei.Konva.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let i=!1;Hn.DD._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(i=!0)}),i||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const n=Hn.DD._dragElements.get(this._id),r=n&&n.dragStatus==="dragging",i=n&&n.dragStatus==="ready";r?this.stopDrag():i&&Hn.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const n=this.getStage();if(!n)return!1;const r={x:-e.x,y:-e.y,width:n.width()+2*e.x,height:n.height()+2*e.y};return Oe.Util.haveIntersection(r,this.getClientRect())}static create(e,n){return Oe.Util._isString(e)&&(e=JSON.parse(e)),this._createNode(e,n)}static _createNode(e,n){let r=Ne.prototype.getClassName.call(e),i=e.children,s,l,c;n&&(e.attrs.container=n),Ei.Konva[r]||(Oe.Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const u=Ei.Konva[r];if(s=new u(e.attrs),i)for(l=i.length,c=0;c<l;c++)s.add(Ne._createNode(i[c]));return s}}lt.Node=Ne;Ne.prototype.nodeType="Node";Ne.prototype._attrsAffectingSize=[];Ne.prototype.eventListeners={};Ne.prototype.on.call(Ne.prototype,v7,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Ni),this._clearSelfAndDescendantCache(Qr)});Ne.prototype.on.call(Ne.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(gp)});Ne.prototype.on.call(Ne.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(pp)});Ne.prototype.on.call(Ne.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(lc)});const Ke=El.Factory.addGetterSetter;Ke(Ne,"zIndex");Ke(Ne,"absolutePosition");Ke(Ne,"position");Ke(Ne,"x",0,(0,_t.getNumberValidator)());Ke(Ne,"y",0,(0,_t.getNumberValidator)());Ke(Ne,"globalCompositeOperation","source-over",(0,_t.getStringValidator)());Ke(Ne,"opacity",1,(0,_t.getNumberValidator)());Ke(Ne,"name","",(0,_t.getStringValidator)());Ke(Ne,"id","",(0,_t.getStringValidator)());Ke(Ne,"rotation",0,(0,_t.getNumberValidator)());El.Factory.addComponentsGetterSetter(Ne,"scale",["x","y"]);Ke(Ne,"scaleX",1,(0,_t.getNumberValidator)());Ke(Ne,"scaleY",1,(0,_t.getNumberValidator)());El.Factory.addComponentsGetterSetter(Ne,"skew",["x","y"]);Ke(Ne,"skewX",0,(0,_t.getNumberValidator)());Ke(Ne,"skewY",0,(0,_t.getNumberValidator)());El.Factory.addComponentsGetterSetter(Ne,"offset",["x","y"]);Ke(Ne,"offsetX",0,(0,_t.getNumberValidator)());Ke(Ne,"offsetY",0,(0,_t.getNumberValidator)());Ke(Ne,"dragDistance",void 0,(0,_t.getNumberValidator)());Ke(Ne,"width",0,(0,_t.getNumberValidator)());Ke(Ne,"height",0,(0,_t.getNumberValidator)());Ke(Ne,"listening",!0,(0,_t.getBooleanValidator)());Ke(Ne,"preventDefault",!0,(0,_t.getBooleanValidator)());Ke(Ne,"filters",void 0,function(t){return this._filterUpToDate=!1,t});Ke(Ne,"visible",!0,(0,_t.getBooleanValidator)());Ke(Ne,"transformsEnabled","all",(0,_t.getStringValidator)());Ke(Ne,"size");Ke(Ne,"dragBoundFunc");Ke(Ne,"draggable",!1,(0,_t.getBooleanValidator)());El.Factory.backCompat(Ne,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var As={};Object.defineProperty(As,"__esModule",{value:!0});As.Container=void 0;const Vo=je,Jh=lt,fd=Te;class Is extends Jh.Node{constructor(){super(...arguments),this.children=[]}getChildren(e){if(!e)return this.children||[];const n=this.children||[],r=[];return n.forEach(function(i){e(i)&&r.push(i)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let r=0;r<e.length;r++)this.add(e[r]);return this}const n=e[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const n=this._generalFind(e,!0);return n.length>0?n[0]:void 0}_generalFind(e,n){const r=[];return this._descendants(i=>{const s=i._isMatch(e);return s&&r.push(i),!!(s&&n)}),r}_descendants(e){let n=!1;const r=this.getChildren();for(const i of r){if(n=e(i),n)return!0;if(i.hasChildren()&&(n=i._descendants(e),n))return!0}return!1}toObject(){const e=Jh.Node.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(n=>{e.children.push(n.toObject())}),e}isAncestorOf(e){let n=e.getParent();for(;n;){if(n._id===this._id)return!0;n=n.getParent()}return!1}clone(e){const n=Jh.Node.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){n.add(r.clone())}),n}getAllIntersections(e){const n=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&n.push(r)}),n}_clearSelfAndDescendantCache(e){var n;super._clearSelfAndDescendantCache(e),!this.isCached()&&((n=this.children)===null||n===void 0||n.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(n,r){n.index=r}),this._requestDraw()}drawScene(e,n,r){const i=this.getLayer(),s=e||i&&i.getCanvas(),l=s&&s.getContext(),c=this._getCanvasCache(),u=c&&c.scene,f=s&&s.isCache;if(!this.isVisible()&&!f)return this;if(u){l.save();const p=this.getAbsoluteTransform(n).getMatrix();l.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedSceneCanvas(l),l.restore()}else this._drawChildren("drawScene",s,n,r);return this}drawHit(e,n){if(!this.shouldDrawHit(n))return this;const r=this.getLayer(),i=e||r&&r.hitCanvas,s=i&&i.getContext(),l=this._getCanvasCache();if(l&&l.hit){s.save();const u=this.getAbsoluteTransform(n).getMatrix();s.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",i,n);return this}_drawChildren(e,n,r,i){var s;const l=n&&n.getContext(),c=this.clipWidth(),u=this.clipHeight(),f=this.clipFunc(),p=typeof c=="number"&&typeof u=="number"||f,m=r===this;if(p){l.save();const y=this.getAbsoluteTransform(r);let x=y.getMatrix();l.transform(x[0],x[1],x[2],x[3],x[4],x[5]),l.beginPath();let b;if(f)b=f.call(this,l,this);else{const _=this.clipX(),S=this.clipY();l.rect(_||0,S||0,c,u)}l.clip.apply(l,b),x=y.copy().invert().getMatrix(),l.transform(x[0],x[1],x[2],x[3],x[4],x[5])}const w=!m&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";w&&(l.save(),l._applyGlobalCompositeOperation(this)),(s=this.children)===null||s===void 0||s.forEach(function(y){y[e](n,r,i)}),w&&l.restore(),p&&l.restore()}getClientRect(e={}){var n;const r=e.skipTransform,i=e.relativeTo;let s,l,c,u,f={x:1/0,y:1/0,width:0,height:0};const p=this;(n=this.children)===null||n===void 0||n.forEach(function(y){if(!y.visible())return;const x=y.getClientRect({relativeTo:p,skipShadow:e.skipShadow,skipStroke:e.skipStroke});x.width===0&&x.height===0||(s===void 0?(s=x.x,l=x.y,c=x.x+x.width,u=x.y+x.height):(s=Math.min(s,x.x),l=Math.min(l,x.y),c=Math.max(c,x.x+x.width),u=Math.max(u,x.y+x.height)))});const m=this.find("Shape");let w=!1;for(let y=0;y<m.length;y++)if(m[y]._isVisible(this)){w=!0;break}return w&&s!==void 0?f={x:s,y:l,width:c-s,height:u-l}:f={x:0,y:0,width:0,height:0},r?f:this._transformedRect(f,i)}}As.Container=Is;Vo.Factory.addComponentsGetterSetter(Is,"clip",["x","y","width","height"]);Vo.Factory.addGetterSetter(Is,"clipX",void 0,(0,fd.getNumberValidator)());Vo.Factory.addGetterSetter(Is,"clipY",void 0,(0,fd.getNumberValidator)());Vo.Factory.addGetterSetter(Is,"clipWidth",void 0,(0,fd.getNumberValidator)());Vo.Factory.addGetterSetter(Is,"clipHeight",void 0,(0,fd.getNumberValidator)());Vo.Factory.addGetterSetter(Is,"clipFunc");var H5={},Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.getCapturedShape=S7;Zi.createEvent=bg;Zi.hasPointerCapture=_7;Zi.setPointerCapture=k7;Zi.releaseCapture=X5;const w7=Re,gl=new Map,Y5=w7.Konva._global.PointerEvent!==void 0;function S7(t){return gl.get(t)}function bg(t){return{evt:t,pointerId:t.pointerId}}function _7(t,e){return gl.get(t)===e}function k7(t,e){X5(t),e.getStage()&&(gl.set(t,e),Y5&&e._fire("gotpointercapture",bg(new PointerEvent("gotpointercapture"))))}function X5(t,e){const n=gl.get(t);if(!n)return;const r=n.getStage();r&&r.content,gl.delete(t),Y5&&n._fire("lostpointercapture",bg(new PointerEvent("lostpointercapture")))}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=pt,n=je,r=As,i=Re,s=yr,l=dd,c=Re,u=Zi,f="Stage",p="string",m="px",w="mouseout",y="mouseleave",x="mouseover",b="mouseenter",_="mousemove",S="mousedown",T="mouseup",h="pointermove",k="pointerdown",C="pointerup",N="pointercancel",A="lostpointercapture",M="pointerout",R="pointerleave",I="pointerover",j="pointerenter",z="contextmenu",W="touchstart",V="touchend",D="touchmove",U="touchcancel",G="wheel",F=5,Y=[[b,"_pointerenter"],[S,"_pointerdown"],[_,"_pointermove"],[T,"_pointerup"],[y,"_pointerleave"],[W,"_pointerdown"],[D,"_pointermove"],[V,"_pointerup"],[U,"_pointercancel"],[x,"_pointerover"],[G,"_wheel"],[z,"_contextmenu"],[k,"_pointerdown"],[h,"_pointermove"],[C,"_pointerup"],[N,"_pointercancel"],[A,"_lostpointercapture"]],X={mouse:{[M]:w,[R]:y,[I]:x,[j]:b,[h]:_,[k]:S,[C]:T,[N]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[M]:"touchout",[R]:"touchleave",[I]:"touchover",[j]:"touchenter",[h]:D,[k]:W,[C]:V,[N]:U,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[M]:M,[R]:R,[I]:I,[j]:j,[h]:h,[k]:k,[C]:C,[N]:N,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},te=de=>de.indexOf("pointer")>=0?"pointer":de.indexOf("touch")>=0?"touch":"mouse",K=de=>{const B=te(de);if(B==="pointer")return i.Konva.pointerEventsEnabled&&X.pointer;if(B==="touch")return X.touch;if(B==="mouse")return X.mouse};function ee(de={}){return(de.clipFunc||de.clipWidth||de.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),de}const ne="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class ce extends r.Container{constructor(B){super(ee(B)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ee(this.attrs)}),this._checkVisibility()}_validateAdd(B){const Q=B.getType()==="Layer",re=B.getType()==="FastLayer";Q||re||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const B=this.visible()?"":"none";this.content.style.display=B}setContainer(B){if(typeof B===p){if(B.charAt(0)==="."){const re=B.slice(1);B=document.getElementsByClassName(re)[0]}else{var Q;B.charAt(0)!=="#"?Q=B:Q=B.slice(1),B=document.getElementById(Q)}if(!B)throw"Can not find container in document with id "+Q}return this._setAttr("container",B),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),B.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const B=this.children,Q=B.length;for(let re=0;re<Q;re++)B[re].clear();return this}clone(B){return B||(B={}),B.container=typeof document<"u"&&document.createElement("div"),r.Container.prototype.clone.call(this,B)}destroy(){super.destroy();const B=this.content;B&&e.Util._isInDocument(B)&&this.container().removeChild(B);const Q=t.stages.indexOf(this);return Q>-1&&t.stages.splice(Q,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const B=this._pointerPositions[0]||this._changedPointerPositions[0];return B?{x:B.x,y:B.y}:(e.Util.warn(ne),null)}_getPointerById(B){return this._pointerPositions.find(Q=>Q.id===B)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(B){B=B||{},B.x=B.x||0,B.y=B.y||0,B.width=B.width||this.width(),B.height=B.height||this.height();const Q=new s.SceneCanvas({width:B.width,height:B.height,pixelRatio:B.pixelRatio||1}),re=Q.getContext()._context,ie=this.children;return(B.x||B.y)&&re.translate(-1*B.x,-1*B.y),ie.forEach(function(oe){if(!oe.isVisible())return;const fe=oe._toKonvaCanvas(B);re.drawImage(fe._canvas,B.x,B.y,fe.getWidth()/fe.getPixelRatio(),fe.getHeight()/fe.getPixelRatio())}),Q}getIntersection(B){if(!B)return null;const Q=this.children,re=Q.length,ie=re-1;for(let oe=ie;oe>=0;oe--){const fe=Q[oe].getIntersection(B);if(fe)return fe}return null}_resizeDOM(){const B=this.width(),Q=this.height();this.content&&(this.content.style.width=B+m,this.content.style.height=Q+m),this.bufferCanvas.setSize(B,Q),this.bufferHitCanvas.setSize(B,Q),this.children.forEach(re=>{re.setSize({width:B,height:Q}),re.draw()})}add(B,...Q){if(arguments.length>1){for(let ie=0;ie<arguments.length;ie++)this.add(arguments[ie]);return this}super.add(B);const re=this.children.length;return re>F&&e.Util.warn("The stage has "+re+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),B.setSize({width:this.width(),height:this.height()}),B.draw(),i.Konva.isBrowser&&this.content.appendChild(B.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(B){return u.hasPointerCapture(B,this)}setPointerCapture(B){u.setPointerCapture(B,this)}releaseCapture(B){u.releaseCapture(B,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&Y.forEach(([B,Q])=>{this.content.addEventListener(B,re=>{this[Q](re)},{passive:!1})})}_pointerenter(B){this.setPointersPositions(B);const Q=K(B.type);Q&&this._fire(Q.pointerenter,{evt:B,target:this,currentTarget:this})}_pointerover(B){this.setPointersPositions(B);const Q=K(B.type);Q&&this._fire(Q.pointerover,{evt:B,target:this,currentTarget:this})}_getTargetShape(B){let Q=this[B+"targetShape"];return Q&&!Q.getStage()&&(Q=null),Q}_pointerleave(B){const Q=K(B.type),re=te(B.type);if(!Q)return;this.setPointersPositions(B);const ie=this._getTargetShape(re),oe=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ie&&oe?(ie._fireAndBubble(Q.pointerout,{evt:B}),ie._fireAndBubble(Q.pointerleave,{evt:B}),this._fire(Q.pointerleave,{evt:B,target:this,currentTarget:this}),this[re+"targetShape"]=null):oe&&(this._fire(Q.pointerleave,{evt:B,target:this,currentTarget:this}),this._fire(Q.pointerout,{evt:B,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(B){const Q=K(B.type),re=te(B.type);if(!Q)return;this.setPointersPositions(B);let ie=!1;this._changedPointerPositions.forEach(oe=>{const fe=this.getIntersection(oe);if(l.DD.justDragged=!1,i.Konva["_"+re+"ListenClick"]=!0,!fe||!fe.isListening()){this[re+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&fe.setPointerCapture(oe.id),this[re+"ClickStartShape"]=fe,fe._fireAndBubble(Q.pointerdown,{evt:B,pointerId:oe.id}),ie=!0;const pe=B.type.indexOf("touch")>=0;fe.preventDefault()&&B.cancelable&&pe&&B.preventDefault()}),ie||this._fire(Q.pointerdown,{evt:B,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(B){const Q=K(B.type),re=te(B.type);if(!Q||(i.Konva.isDragging()&&l.DD.node.preventDefault()&&B.cancelable&&B.preventDefault(),this.setPointersPositions(B),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const oe={};let fe=!1;const pe=this._getTargetShape(re);this._changedPointerPositions.forEach(Pe=>{const Ce=u.getCapturedShape(Pe.id)||this.getIntersection(Pe),$e=Pe.id,We={evt:B,pointerId:$e},xt=pe!==Ce;if(xt&&pe&&(pe._fireAndBubble(Q.pointerout,{...We},Ce),pe._fireAndBubble(Q.pointerleave,{...We},Ce)),Ce){if(oe[Ce._id])return;oe[Ce._id]=!0}Ce&&Ce.isListening()?(fe=!0,xt&&(Ce._fireAndBubble(Q.pointerover,{...We},pe),Ce._fireAndBubble(Q.pointerenter,{...We},pe),this[re+"targetShape"]=Ce),Ce._fireAndBubble(Q.pointermove,{...We})):pe&&(this._fire(Q.pointerover,{evt:B,target:this,currentTarget:this,pointerId:$e}),this[re+"targetShape"]=null)}),fe||this._fire(Q.pointermove,{evt:B,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(B){const Q=K(B.type),re=te(B.type);if(!Q)return;this.setPointersPositions(B);const ie=this[re+"ClickStartShape"],oe=this[re+"ClickEndShape"],fe={};let pe=!1;this._changedPointerPositions.forEach(Pe=>{const Ce=u.getCapturedShape(Pe.id)||this.getIntersection(Pe);if(Ce){if(Ce.releaseCapture(Pe.id),fe[Ce._id])return;fe[Ce._id]=!0}const $e=Pe.id,We={evt:B,pointerId:$e};let xt=!1;i.Konva["_"+re+"InDblClickWindow"]?(xt=!0,clearTimeout(this[re+"DblTimeout"])):l.DD.justDragged||(i.Konva["_"+re+"InDblClickWindow"]=!0,clearTimeout(this[re+"DblTimeout"])),this[re+"DblTimeout"]=setTimeout(function(){i.Konva["_"+re+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Ce&&Ce.isListening()?(pe=!0,this[re+"ClickEndShape"]=Ce,Ce._fireAndBubble(Q.pointerup,{...We}),i.Konva["_"+re+"ListenClick"]&&ie&&ie===Ce&&(Ce._fireAndBubble(Q.pointerclick,{...We}),xt&&oe&&oe===Ce&&Ce._fireAndBubble(Q.pointerdblclick,{...We}))):(this[re+"ClickEndShape"]=null,i.Konva["_"+re+"ListenClick"]&&this._fire(Q.pointerclick,{evt:B,target:this,currentTarget:this,pointerId:$e}),xt&&this._fire(Q.pointerdblclick,{evt:B,target:this,currentTarget:this,pointerId:$e}))}),pe||this._fire(Q.pointerup,{evt:B,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+re+"ListenClick"]=!1,B.cancelable&&re!=="touch"&&re!=="pointer"&&B.preventDefault()}_contextmenu(B){this.setPointersPositions(B);const Q=this.getIntersection(this.getPointerPosition());Q&&Q.isListening()?Q._fireAndBubble(z,{evt:B}):this._fire(z,{evt:B,target:this,currentTarget:this})}_wheel(B){this.setPointersPositions(B);const Q=this.getIntersection(this.getPointerPosition());Q&&Q.isListening()?Q._fireAndBubble(G,{evt:B}):this._fire(G,{evt:B,target:this,currentTarget:this})}_pointercancel(B){this.setPointersPositions(B);const Q=u.getCapturedShape(B.pointerId)||this.getIntersection(this.getPointerPosition());Q&&Q._fireAndBubble(C,u.createEvent(B)),u.releaseCapture(B.pointerId)}_lostpointercapture(B){u.releaseCapture(B.pointerId)}setPointersPositions(B){const Q=this._getContentPosition();let re=null,ie=null;B=B||window.event,B.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(B.touches,oe=>{this._pointerPositions.push({id:oe.identifier,x:(oe.clientX-Q.left)/Q.scaleX,y:(oe.clientY-Q.top)/Q.scaleY})}),Array.prototype.forEach.call(B.changedTouches||B.touches,oe=>{this._changedPointerPositions.push({id:oe.identifier,x:(oe.clientX-Q.left)/Q.scaleX,y:(oe.clientY-Q.top)/Q.scaleY})})):(re=(B.clientX-Q.left)/Q.scaleX,ie=(B.clientY-Q.top)/Q.scaleY,this.pointerPos={x:re,y:ie},this._pointerPositions=[{x:re,y:ie,id:e.Util._getFirstPointerId(B)}],this._changedPointerPositions=[{x:re,y:ie,id:e.Util._getFirstPointerId(B)}])}_setPointerPosition(B){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(B)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const B=this.content.getBoundingClientRect();return{top:B.top,left:B.left,scaleX:B.width/this.content.clientWidth||1,scaleY:B.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new s.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new s.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const B=this.container();if(!B)throw"Stage has no container. A container is required.";B.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),B.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(B){B.batchDraw()}),this}}t.Stage=ce,ce.prototype.nodeType=f,(0,c._registerNode)(ce),n.Factory.addGetterSetter(ce,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(de=>{de.batchDraw()})})})(H5);var Nl={},Mt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Re,n=pt,r=je,i=lt,s=Te,l=Re,c=Zi,u="hasShadow",f="shadowRGBA",p="patternImage",m="linearGradient",w="radialGradient";let y;function x(){return y||(y=n.Util.createCanvasElement().getContext("2d"),y)}t.shapes={};function b(R){const I=this.attrs.fillRule;I?R.fill(I):R.fill()}function _(R){R.stroke()}function S(R){const I=this.attrs.fillRule;I?R.fill(I):R.fill()}function T(R){R.stroke()}function h(){this._clearCache(u)}function k(){this._clearCache(f)}function C(){this._clearCache(p)}function N(){this._clearCache(m)}function A(){this._clearCache(w)}class M extends i.Node{constructor(I){super(I);let j;for(;j=n.Util.getRandomColor(),!(j&&!(j in t.shapes)););this.colorKey=j,t.shapes[j]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(u,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(p,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const j=x().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(j&&j.setTransform){const z=new n.Transform;z.translate(this.fillPatternX(),this.fillPatternY()),z.rotate(e.Konva.getAngle(this.fillPatternRotation())),z.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),z.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const W=z.getMatrix(),V=typeof DOMMatrix>"u"?{a:W[0],b:W[1],c:W[2],d:W[3],e:W[4],f:W[5]}:new DOMMatrix(W);j.setTransform(V)}return j}}_getLinearGradient(){return this._getCache(m,this.__getLinearGradient)}__getLinearGradient(){const I=this.fillLinearGradientColorStops();if(I){const j=x(),z=this.fillLinearGradientStartPoint(),W=this.fillLinearGradientEndPoint(),V=j.createLinearGradient(z.x,z.y,W.x,W.y);for(let D=0;D<I.length;D+=2)V.addColorStop(I[D],I[D+1]);return V}}_getRadialGradient(){return this._getCache(w,this.__getRadialGradient)}__getRadialGradient(){const I=this.fillRadialGradientColorStops();if(I){const j=x(),z=this.fillRadialGradientStartPoint(),W=this.fillRadialGradientEndPoint(),V=j.createRadialGradient(z.x,z.y,this.fillRadialGradientStartRadius(),W.x,W.y,this.fillRadialGradientEndRadius());for(let D=0;D<I.length;D+=2)V.addColorStop(I[D],I[D+1]);return V}}getShadowRGBA(){return this._getCache(f,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const I=n.Util.colorToRGBA(this.shadowColor());if(I)return"rgba("+I.r+","+I.g+","+I.b+","+I.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const I=this.hitStrokeWidth();return I==="auto"?this.hasStroke():this.strokeEnabled()&&!!I}intersects(I){const j=this.getStage();if(!j)return!1;const z=j.bufferHitCanvas;return z.getContext().clear(),this.drawHit(z,void 0,!0),z.context.getImageData(Math.round(I.x),Math.round(I.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(I){var j;if(!((j=this.attrs.perfectDrawEnabled)!==null&&j!==void 0?j:!0))return!1;const W=I||this.hasFill(),V=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(W&&V&&D)return!0;const U=this.hasShadow(),G=this.shadowForStrokeEnabled();return!!(W&&V&&U&&G)}setStrokeHitEnabled(I){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),I?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const I=this.size();return{x:this._centroid?-I.width/2:0,y:this._centroid?-I.height/2:0,width:I.width,height:I.height}}getClientRect(I={}){let j=!1,z=this.getParent();for(;z;){if(z.isCached()){j=!0;break}z=z.getParent()}const W=I.skipTransform,V=I.relativeTo||j&&this.getStage()||void 0,D=this.getSelfRect(),G=!I.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,F=D.width+G,Y=D.height+G,X=!I.skipShadow&&this.hasShadow(),te=X?this.shadowOffsetX():0,K=X?this.shadowOffsetY():0,ee=F+Math.abs(te),ne=Y+Math.abs(K),ce=X&&this.shadowBlur()||0,de=ee+ce*2,B=ne+ce*2,Q={width:de,height:B,x:-(G/2+ce)+Math.min(te,0)+D.x,y:-(G/2+ce)+Math.min(K,0)+D.y};return W?Q:this._transformedRect(Q,V)}drawScene(I,j,z){const W=this.getLayer();let V=I||W.getCanvas(),D=V.getContext(),U=this._getCanvasCache(),G=this.getSceneFunc(),F=this.hasShadow(),Y,X;const te=V.isCache,K=j===this;if(!this.isVisible()&&!K)return this;if(U){D.save();const ne=this.getAbsoluteTransform(j).getMatrix();return D.transform(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!G)return this;if(D.save(),this._useBufferCanvas()&&!te){Y=this.getStage();const ne=z||Y.bufferCanvas;X=ne.getContext(),X.clear(),X.save(),X._applyLineJoin(this);var ee=this.getAbsoluteTransform(j).getMatrix();X.transform(ee[0],ee[1],ee[2],ee[3],ee[4],ee[5]),G.call(this,X,this),X.restore();const ce=ne.pixelRatio;F&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(ne._canvas,0,0,ne.width/ce,ne.height/ce)}else{if(D._applyLineJoin(this),!K){var ee=this.getAbsoluteTransform(j).getMatrix();D.transform(ee[0],ee[1],ee[2],ee[3],ee[4],ee[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}F&&D._applyShadow(this),G.call(this,D,this)}return D.restore(),this}drawHit(I,j,z=!1){if(!this.shouldDrawHit(j,z))return this;const W=this.getLayer(),V=I||W.hitCanvas,D=V&&V.getContext(),U=this.hitFunc()||this.sceneFunc(),G=this._getCanvasCache(),F=G&&G.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),F){D.save();const X=this.getAbsoluteTransform(j).getMatrix();return D.transform(X[0],X[1],X[2],X[3],X[4],X[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!U)return this;if(D.save(),D._applyLineJoin(this),!(this===j)){const X=this.getAbsoluteTransform(j).getMatrix();D.transform(X[0],X[1],X[2],X[3],X[4],X[5])}return U.call(this,D,this),D.restore(),this}drawHitFromCache(I=0){const j=this._getCanvasCache(),z=this._getCachedSceneCanvas(),W=j.hit,V=W.getContext(),D=W.getWidth(),U=W.getHeight();V.clear(),V.drawImage(z._canvas,0,0,D,U);try{const G=V.getImageData(0,0,D,U),F=G.data,Y=F.length,X=n.Util._hexToRgb(this.colorKey);for(let te=0;te<Y;te+=4)F[te+3]>I?(F[te]=X.r,F[te+1]=X.g,F[te+2]=X.b,F[te+3]=255):F[te+3]=0;V.putImageData(G,0,0)}catch(G){n.Util.error("Unable to draw hit graph from cached scene canvas. "+G.message)}return this}hasPointerCapture(I){return c.hasPointerCapture(I,this)}setPointerCapture(I){c.setPointerCapture(I,this)}releaseCapture(I){c.releaseCapture(I,this)}}t.Shape=M,M.prototype._fillFunc=b,M.prototype._strokeFunc=_,M.prototype._fillFuncHit=S,M.prototype._strokeFuncHit=T,M.prototype._centroid=!1,M.prototype.nodeType="Shape",(0,l._registerNode)(M),M.prototype.eventListeners={},M.prototype.on.call(M.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",h),M.prototype.on.call(M.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",k),M.prototype.on.call(M.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",C),M.prototype.on.call(M.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",N),M.prototype.on.call(M.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",A),r.Factory.addGetterSetter(M,"stroke",void 0,(0,s.getStringOrGradientValidator)()),r.Factory.addGetterSetter(M,"strokeWidth",2,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"fillAfterStrokeEnabled",!1),r.Factory.addGetterSetter(M,"hitStrokeWidth","auto",(0,s.getNumberOrAutoValidator)()),r.Factory.addGetterSetter(M,"strokeHitEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(M,"perfectDrawEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(M,"shadowForStrokeEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(M,"lineJoin"),r.Factory.addGetterSetter(M,"lineCap"),r.Factory.addGetterSetter(M,"sceneFunc"),r.Factory.addGetterSetter(M,"hitFunc"),r.Factory.addGetterSetter(M,"dash"),r.Factory.addGetterSetter(M,"dashOffset",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"shadowColor",void 0,(0,s.getStringValidator)()),r.Factory.addGetterSetter(M,"shadowBlur",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"shadowOpacity",1,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(M,"shadowOffset",["x","y"]),r.Factory.addGetterSetter(M,"shadowOffsetX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"shadowOffsetY",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"fillPatternImage"),r.Factory.addGetterSetter(M,"fill",void 0,(0,s.getStringOrGradientValidator)()),r.Factory.addGetterSetter(M,"fillPatternX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"fillPatternY",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"fillLinearGradientColorStops"),r.Factory.addGetterSetter(M,"strokeLinearGradientColorStops"),r.Factory.addGetterSetter(M,"fillRadialGradientStartRadius",0),r.Factory.addGetterSetter(M,"fillRadialGradientEndRadius",0),r.Factory.addGetterSetter(M,"fillRadialGradientColorStops"),r.Factory.addGetterSetter(M,"fillPatternRepeat","repeat"),r.Factory.addGetterSetter(M,"fillEnabled",!0),r.Factory.addGetterSetter(M,"strokeEnabled",!0),r.Factory.addGetterSetter(M,"shadowEnabled",!0),r.Factory.addGetterSetter(M,"dashEnabled",!0),r.Factory.addGetterSetter(M,"strokeScaleEnabled",!0),r.Factory.addGetterSetter(M,"fillPriority","color"),r.Factory.addComponentsGetterSetter(M,"fillPatternOffset",["x","y"]),r.Factory.addGetterSetter(M,"fillPatternOffsetX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"fillPatternOffsetY",0,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(M,"fillPatternScale",["x","y"]),r.Factory.addGetterSetter(M,"fillPatternScaleX",1,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(M,"fillPatternScaleY",1,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(M,"fillLinearGradientStartPoint",["x","y"]),r.Factory.addComponentsGetterSetter(M,"strokeLinearGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(M,"fillLinearGradientStartPointX",0),r.Factory.addGetterSetter(M,"strokeLinearGradientStartPointX",0),r.Factory.addGetterSetter(M,"fillLinearGradientStartPointY",0),r.Factory.addGetterSetter(M,"strokeLinearGradientStartPointY",0),r.Factory.addComponentsGetterSetter(M,"fillLinearGradientEndPoint",["x","y"]),r.Factory.addComponentsGetterSetter(M,"strokeLinearGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(M,"fillLinearGradientEndPointX",0),r.Factory.addGetterSetter(M,"strokeLinearGradientEndPointX",0),r.Factory.addGetterSetter(M,"fillLinearGradientEndPointY",0),r.Factory.addGetterSetter(M,"strokeLinearGradientEndPointY",0),r.Factory.addComponentsGetterSetter(M,"fillRadialGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(M,"fillRadialGradientStartPointX",0),r.Factory.addGetterSetter(M,"fillRadialGradientStartPointY",0),r.Factory.addComponentsGetterSetter(M,"fillRadialGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(M,"fillRadialGradientEndPointX",0),r.Factory.addGetterSetter(M,"fillRadialGradientEndPointY",0),r.Factory.addGetterSetter(M,"fillPatternRotation",0),r.Factory.addGetterSetter(M,"fillRule",void 0,(0,s.getStringValidator)()),r.Factory.backCompat(M,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(Mt);Object.defineProperty(Nl,"__esModule",{value:!0});Nl.Layer=void 0;const Kr=pt,e0=As,to=lt,Cg=je,v2=yr,b7=Te,C7=Mt,T7=Re,E7="#",N7="beforeDraw",P7="draw",K5=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],M7=K5.length;let Wo=class extends e0.Container{constructor(e){super(e),this.canvas=new v2.SceneCanvas,this.hitCanvas=new v2.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const n=this.getStage();return n&&n.content&&(n.content.removeChild(this.getNativeCanvasElement()),e<n.children.length-1?n.content.insertBefore(this.getNativeCanvasElement(),n.children[e+1].getCanvas()._canvas):n.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){to.Node.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!to.Node.prototype.moveUp.call(this))return!1;const n=this.getStage();return!n||!n.content?!1:(n.content.removeChild(this.getNativeCanvasElement()),this.index<n.children.length-1?n.content.insertBefore(this.getNativeCanvasElement(),n.children[this.index+1].getCanvas()._canvas):n.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(to.Node.prototype.moveDown.call(this)){const e=this.getStage();if(e){const n=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),n[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(to.Node.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const n=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),n[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return to.Node.prototype.remove.call(this),e&&e.parentNode&&Kr.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:n}){return this.canvas.setSize(e,n),this.hitCanvas.setSize(e,n),this._setSmoothEnabled(),this}_validateAdd(e){const n=e.getType();n!=="Group"&&n!=="Shape"&&Kr.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e=e||{},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),to.Node.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Kr.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Kr.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Kr.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let n=1,r=!1;for(;;){for(let i=0;i<M7;i++){const s=K5[i],l=this._getIntersection({x:e.x+s.x*n,y:e.y+s.y*n}),c=l.shape;if(c)return c;if(r=!!l.antialiased,!l.antialiased)break}if(r)n+=1;else return null}}_getIntersection(e){const n=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*n),Math.round(e.y*n),1,1).data,i=r[3];if(i===255){const s=Kr.Util._rgbToHex(r[0],r[1],r[2]),l=C7.shapes[E7+s];return l?{shape:l}:{antialiased:!0}}else if(i>0)return{antialiased:!0};return{}}drawScene(e,n){const r=this.getLayer(),i=e||r&&r.getCanvas();return this._fire(N7,{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),e0.Container.prototype.drawScene.call(this,i,n),this._fire(P7,{node:this}),this}drawHit(e,n){const r=this.getLayer(),i=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),e0.Container.prototype.drawHit.call(this,i,n),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){Kr.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return Kr.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return Kr.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};Nl.Layer=Wo;Wo.prototype.nodeType="Layer";(0,T7._registerNode)(Wo);Cg.Factory.addGetterSetter(Wo,"imageSmoothingEnabled",!0);Cg.Factory.addGetterSetter(Wo,"clearBeforeDraw",!0);Cg.Factory.addGetterSetter(Wo,"hitGraphEnabled",!0,(0,b7.getBooleanValidator)());var hd={};Object.defineProperty(hd,"__esModule",{value:!0});hd.FastLayer=void 0;const A7=pt,I7=Nl,R7=Re;class Tg extends I7.Layer{constructor(e){super(e),this.listening(!1),A7.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}hd.FastLayer=Tg;Tg.prototype.nodeType="FastLayer";(0,R7._registerNode)(Tg);var $o={};Object.defineProperty($o,"__esModule",{value:!0});$o.Group=void 0;const L7=pt,j7=As,F7=Re;let Eg=class extends j7.Container{_validateAdd(e){const n=e.getType();n!=="Group"&&n!=="Shape"&&L7.Util.throw("You may only add groups and shapes to groups.")}};$o.Group=Eg;Eg.prototype.nodeType="Group";(0,F7._registerNode)(Eg);var Ho={};Object.defineProperty(Ho,"__esModule",{value:!0});Ho.Animation=void 0;const t0=Re,x2=pt,n0=function(){return t0.glob.performance&&t0.glob.performance.now?function(){return t0.glob.performance.now()}:function(){return new Date().getTime()}}();class Lr{constructor(e,n){this.id=Lr.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n0(),frameRate:0},this.func=e,this.setLayers(n)}setLayers(e){let n=[];return e&&(n=Array.isArray(e)?e:[e]),this.layers=n,this}getLayers(){return this.layers}addLayer(e){const n=this.layers,r=n.length;for(let i=0;i<r;i++)if(n[i]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const n=Lr.animations,r=n.length;for(let i=0;i<r;i++)if(n[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n0(),Lr._addAnimation(this),this}stop(){return Lr._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const n=e.id,r=this.animations,i=r.length;for(let s=0;s<i;s++)if(r[s].id===n){this.animations.splice(s,1);break}}static _runFrames(){const e={},n=this.animations;for(let r=0;r<n.length;r++){const i=n[r],s=i.layers,l=i.func;i._updateFrameObject(n0());const c=s.length;let u;if(l?u=l.call(i,i.frame)!==!1:u=!0,!!u)for(let f=0;f<c;f++){const p=s[f];p._id!==void 0&&(e[p._id]=p)}}for(const r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=Lr;e.animations.length?(e._runFrames(),x2.Util.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,x2.Util.requestAnimFrame(this._animationLoop))}}Ho.Animation=Lr;Lr.animations=[];Lr.animIdCounter=0;Lr.animRunning=!1;var Q5={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=pt,n=Ho,r=lt,i=Re,s={node:1,duration:1,easing:1,onFinish:1,yoyo:1},l=1,c=2,u=3,f=["fill","stroke","shadowColor"];let p=0;class m{constructor(x,b,_,S,T,h,k){this.prop=x,this.propFunc=b,this.begin=S,this._pos=S,this.duration=h,this._change=0,this.prevPos=0,this.yoyo=k,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=_,this._change=T-this.begin,this.pause()}fire(x){const b=this[x];b&&b()}setTime(x){x>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():x<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=x,this.update())}getTime(){return this._time}setPosition(x){this.prevPos=this._pos,this.propFunc(x),this._pos=x}getPosition(x){return x===void 0&&(x=this._time),this.func(x,this.begin,this._change,this.duration)}play(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=u,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(x){this.pause(),this._time=x,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const x=this.getTimer()-this._startTime;this.state===c?this.setTime(x):this.state===u&&this.setTime(this.duration-x)}pause(){this.state=l,this.fire("onPause")}getTimer(){return new Date().getTime()}}class w{constructor(x){const b=this,_=x.node,S=_._id,T=x.easing||t.Easings.Linear,h=!!x.yoyo;let k,C;typeof x.duration>"u"?k=.3:x.duration===0?k=.001:k=x.duration,this.node=_,this._id=p++;const N=_.getLayer()||(_ instanceof i.Konva.Stage?_.getLayers():null);N||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){b.tween.onEnterFrame()},N),this.tween=new m(C,function(A){b._tweenFunc(A)},T,0,1,k*1e3,h),this._addListeners(),w.attrs[S]||(w.attrs[S]={}),w.attrs[S][this._id]||(w.attrs[S][this._id]={}),w.tweens[S]||(w.tweens[S]={});for(C in x)s[C]===void 0&&this._addAttr(C,x[C]);this.reset(),this.onFinish=x.onFinish,this.onReset=x.onReset,this.onUpdate=x.onUpdate}_addAttr(x,b){const _=this.node,S=_._id;let T,h,k,C,N;const A=w.tweens[S][x];A&&delete w.attrs[S][A][x];let M=_.getAttr(x);if(e.Util._isArray(b))if(T=[],h=Math.max(b.length,M.length),x==="points"&&b.length!==M.length&&(b.length>M.length?(C=M,M=e.Util._prepareArrayForTween(M,b,_.closed())):(k=b,b=e.Util._prepareArrayForTween(b,M,_.closed()))),x.indexOf("fill")===0)for(let R=0;R<h;R++)if(R%2===0)T.push(b[R]-M[R]);else{const I=e.Util.colorToRGBA(M[R]);N=e.Util.colorToRGBA(b[R]),M[R]=I,T.push({r:N.r-I.r,g:N.g-I.g,b:N.b-I.b,a:N.a-I.a})}else for(let R=0;R<h;R++)T.push(b[R]-M[R]);else f.indexOf(x)!==-1?(M=e.Util.colorToRGBA(M),N=e.Util.colorToRGBA(b),T={r:N.r-M.r,g:N.g-M.g,b:N.b-M.b,a:N.a-M.a}):T=b-M;w.attrs[S][this._id][x]={start:M,diff:T,end:b,trueEnd:k,trueStart:C},w.tweens[S][x]=this._id}_tweenFunc(x){const b=this.node,_=w.attrs[b._id][this._id];let S,T,h,k,C,N,A,M;for(S in _){if(T=_[S],h=T.start,k=T.diff,M=T.end,e.Util._isArray(h))if(C=[],A=Math.max(h.length,M.length),S.indexOf("fill")===0)for(N=0;N<A;N++)N%2===0?C.push((h[N]||0)+k[N]*x):C.push("rgba("+Math.round(h[N].r+k[N].r*x)+","+Math.round(h[N].g+k[N].g*x)+","+Math.round(h[N].b+k[N].b*x)+","+(h[N].a+k[N].a*x)+")");else for(N=0;N<A;N++)C.push((h[N]||0)+k[N]*x);else f.indexOf(S)!==-1?C="rgba("+Math.round(h.r+k.r*x)+","+Math.round(h.g+k.g*x)+","+Math.round(h.b+k.b*x)+","+(h.a+k.a*x)+")":C=h+k*x;b.setAttr(S,C)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const x=this.node,b=w.attrs[x._id][this._id];b.points&&b.points.trueEnd&&x.setAttr("points",b.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const x=this.node,b=w.attrs[x._id][this._id];b.points&&b.points.trueStart&&x.points(b.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(x){return this.tween.seek(x*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const x=this.node._id,b=this._id,_=w.tweens[x];this.pause();for(const S in _)delete w.tweens[x][S];delete w.attrs[x][b]}}t.Tween=w,w.attrs={},w.tweens={},r.Node.prototype.to=function(y){const x=y.onFinish;y.node=this,y.onFinish=function(){this.destroy(),x&&x()},new w(y).play()},t.Easings={BackEaseIn(y,x,b,_){return b*(y/=_)*y*((1.70158+1)*y-1.70158)+x},BackEaseOut(y,x,b,_){return b*((y=y/_-1)*y*((1.70158+1)*y+1.70158)+1)+x},BackEaseInOut(y,x,b,_){let S=1.70158;return(y/=_/2)<1?b/2*(y*y*(((S*=1.525)+1)*y-S))+x:b/2*((y-=2)*y*(((S*=1.525)+1)*y+S)+2)+x},ElasticEaseIn(y,x,b,_,S,T){let h=0;return y===0?x:(y/=_)===1?x+b:(T||(T=_*.3),!S||S<Math.abs(b)?(S=b,h=T/4):h=T/(2*Math.PI)*Math.asin(b/S),-(S*Math.pow(2,10*(y-=1))*Math.sin((y*_-h)*(2*Math.PI)/T))+x)},ElasticEaseOut(y,x,b,_,S,T){let h=0;return y===0?x:(y/=_)===1?x+b:(T||(T=_*.3),!S||S<Math.abs(b)?(S=b,h=T/4):h=T/(2*Math.PI)*Math.asin(b/S),S*Math.pow(2,-10*y)*Math.sin((y*_-h)*(2*Math.PI)/T)+b+x)},ElasticEaseInOut(y,x,b,_,S,T){let h=0;return y===0?x:(y/=_/2)===2?x+b:(T||(T=_*(.3*1.5)),!S||S<Math.abs(b)?(S=b,h=T/4):h=T/(2*Math.PI)*Math.asin(b/S),y<1?-.5*(S*Math.pow(2,10*(y-=1))*Math.sin((y*_-h)*(2*Math.PI)/T))+x:S*Math.pow(2,-10*(y-=1))*Math.sin((y*_-h)*(2*Math.PI)/T)*.5+b+x)},BounceEaseOut(y,x,b,_){return(y/=_)<1/2.75?b*(7.5625*y*y)+x:y<2/2.75?b*(7.5625*(y-=1.5/2.75)*y+.75)+x:y<2.5/2.75?b*(7.5625*(y-=2.25/2.75)*y+.9375)+x:b*(7.5625*(y-=2.625/2.75)*y+.984375)+x},BounceEaseIn(y,x,b,_){return b-t.Easings.BounceEaseOut(_-y,0,b,_)+x},BounceEaseInOut(y,x,b,_){return y<_/2?t.Easings.BounceEaseIn(y*2,0,b,_)*.5+x:t.Easings.BounceEaseOut(y*2-_,0,b,_)*.5+b*.5+x},EaseIn(y,x,b,_){return b*(y/=_)*y+x},EaseOut(y,x,b,_){return-b*(y/=_)*(y-2)+x},EaseInOut(y,x,b,_){return(y/=_/2)<1?b/2*y*y+x:-b/2*(--y*(y-2)-1)+x},StrongEaseIn(y,x,b,_){return b*(y/=_)*y*y*y*y+x},StrongEaseOut(y,x,b,_){return b*((y=y/_-1)*y*y*y*y+1)+x},StrongEaseInOut(y,x,b,_){return(y/=_/2)<1?b/2*y*y*y*y*y+x:b/2*((y-=2)*y*y*y*y+2)+x},Linear(y,x,b,_){return b*y/_+x}}})(Q5);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Re,n=pt,r=lt,i=As,s=H5,l=Nl,c=hd,u=$o,f=dd,p=Mt,m=Ho,w=Q5,y=ri,x=yr;t.Konva=n.Util._assign(e.Konva,{Util:n.Util,Transform:n.Transform,Node:r.Node,Container:i.Container,Stage:s.Stage,stages:s.stages,Layer:l.Layer,FastLayer:c.FastLayer,Group:u.Group,DD:f.DD,Shape:p.Shape,shapes:p.shapes,Animation:m.Animation,Tween:w.Tween,Easings:w.Easings,Context:y.Context,Canvas:x.Canvas}),t.default=t.Konva})(Bc);var pd={};Object.defineProperty(pd,"__esModule",{value:!0});pd.Arc=void 0;const gd=je,O7=Mt,w2=Re,md=Te,D7=Re;class di extends O7.Shape{_sceneFunc(e){const n=w2.Konva.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,n,r),e.arc(0,0,this.innerRadius(),n,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),n=this.outerRadius(),r=this.clockwise(),i=w2.Konva.getAngle(r?360-this.angle():this.angle()),s=Math.cos(Math.min(i,Math.PI)),l=1,c=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),u=Math.sin(Math.min(i,Math.PI/2)),f=s*(s>0?e:n),p=l*n,m=c*(c>0?e:n),w=u*(u>0?n:e);return{x:f,y:r?-1*w:m,width:p-f,height:w-m}}}pd.Arc=di;di.prototype._centroid=!0;di.prototype.className="Arc";di.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];(0,D7._registerNode)(di);gd.Factory.addGetterSetter(di,"innerRadius",0,(0,md.getNumberValidator)());gd.Factory.addGetterSetter(di,"outerRadius",0,(0,md.getNumberValidator)());gd.Factory.addGetterSetter(di,"angle",0,(0,md.getNumberValidator)());gd.Factory.addGetterSetter(di,"clockwise",!1,(0,md.getBooleanValidator)());var yd={},Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.Line=void 0;const vd=je,z7=Re,B7=Mt,Z5=Te;function mp(t,e,n,r,i,s,l){const c=Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2)),u=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=l*c/(c+u),p=l*u/(c+u),m=n-f*(i-t),w=r-f*(s-e),y=n+p*(i-t),x=r+p*(s-e);return[m,w,y,x]}function S2(t,e){const n=t.length,r=[];for(let i=2;i<n-2;i+=2){const s=mp(t[i-2],t[i-1],t[i],t[i+1],t[i+2],t[i+3],e);isNaN(s[0])||(r.push(s[0]),r.push(s[1]),r.push(t[i]),r.push(t[i+1]),r.push(s[2]),r.push(s[3]))}return r}let qi=class extends B7.Shape{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){let n=this.points(),r=n.length,i=this.tension(),s=this.closed(),l=this.bezier(),c,u,f;if(r){if(e.beginPath(),e.moveTo(n[0],n[1]),i!==0&&r>4){for(c=this.getTensionPoints(),u=c.length,f=s?0:4,s||e.quadraticCurveTo(c[0],c[1],c[2],c[3]);f<u-2;)e.bezierCurveTo(c[f++],c[f++],c[f++],c[f++],c[f++],c[f++]);s||e.quadraticCurveTo(c[u-2],c[u-1],n[r-2],n[r-1])}else if(l)for(f=2;f<r;)e.bezierCurveTo(n[f++],n[f++],n[f++],n[f++],n[f++],n[f++]);else for(f=2;f<r;f+=2)e.lineTo(n[f],n[f+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():S2(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),n=e.length,r=this.tension(),i=mp(e[n-2],e[n-1],e[0],e[1],e[2],e[3],r),s=mp(e[n-4],e[n-3],e[n-2],e[n-1],e[0],e[1],r),l=S2(e,r);return[i[2],i[3]].concat(l).concat([s[0],s[1],e[n-2],e[n-1],s[2],s[3],i[0],i[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let n=e[0],r=e[0],i=e[1],s=e[1],l,c;for(let u=0;u<e.length/2;u++)l=e[u*2],c=e[u*2+1],n=Math.min(n,l),r=Math.max(r,l),i=Math.min(i,c),s=Math.max(s,c);return{x:n,y:i,width:r-n,height:s-i}}};Pl.Line=qi;qi.prototype.className="Line";qi.prototype._attrsAffectingSize=["points","bezier","tension"];(0,z7._registerNode)(qi);vd.Factory.addGetterSetter(qi,"closed",!1);vd.Factory.addGetterSetter(qi,"bezier",!1);vd.Factory.addGetterSetter(qi,"tension",0,(0,Z5.getNumberValidator)());vd.Factory.addGetterSetter(qi,"points",[],(0,Z5.getNumberArrayValidator)());var Yo={},q5={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(l,c,u)=>{let f,p;const w=u/2;f=0;for(let y=0;y<20;y++)p=w*t.tValues[20][y]+w,f+=t.cValues[20][y]*r(l,c,p);return w*f};t.getCubicArcLength=e;const n=(l,c,u)=>{u===void 0&&(u=1);const f=l[0]-2*l[1]+l[2],p=c[0]-2*c[1]+c[2],m=2*l[1]-2*l[0],w=2*c[1]-2*c[0],y=4*(f*f+p*p),x=4*(f*m+p*w),b=m*m+w*w;if(y===0)return u*Math.sqrt(Math.pow(l[2]-l[0],2)+Math.pow(c[2]-c[0],2));const _=x/(2*y),S=b/y,T=u+_,h=S-_*_,k=T*T+h>0?Math.sqrt(T*T+h):0,C=_*_+h>0?Math.sqrt(_*_+h):0,N=_+Math.sqrt(_*_+h)!==0?h*Math.log(Math.abs((T+k)/(_+C))):0;return Math.sqrt(y)/2*(T*k-_*C+N)};t.getQuadraticArcLength=n;function r(l,c,u){const f=i(1,u,l),p=i(1,u,c),m=f*f+p*p;return Math.sqrt(m)}const i=(l,c,u)=>{const f=u.length-1;let p,m;if(f===0)return 0;if(l===0){m=0;for(let w=0;w<=f;w++)m+=t.binomialCoefficients[f][w]*Math.pow(1-c,f-w)*Math.pow(c,w)*u[w];return m}else{p=new Array(f);for(let w=0;w<f;w++)p[w]=f*(u[w+1]-u[w]);return i(l-1,c,p)}},s=(l,c,u)=>{let f=1,p=l/c,m=(l-u(p))/c,w=0;for(;f>.001;){const y=u(p+m),x=Math.abs(l-y)/c;if(x<f)f=x,p+=m;else{const b=u(p-m),_=Math.abs(l-b)/c;_<f?(f=_,p-=m):m/=2}if(w++,w>500)break}return p};t.t2length=s})(q5);Object.defineProperty(Yo,"__esModule",{value:!0});Yo.Path=void 0;const U7=je,G7=Mt,V7=Re,no=q5;class Et extends G7.Shape{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Et.parsePathData(this.data()),this.pathLength=Et.getPathLength(this.dataArray)}_sceneFunc(e){const n=this.dataArray;e.beginPath();let r=!1;for(let b=0;b<n.length;b++){const _=n[b].command,S=n[b].points;switch(_){case"L":e.lineTo(S[0],S[1]);break;case"M":e.moveTo(S[0],S[1]);break;case"C":e.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5]);break;case"Q":e.quadraticCurveTo(S[0],S[1],S[2],S[3]);break;case"A":var i=S[0],s=S[1],l=S[2],c=S[3],u=S[4],f=S[5],p=S[6],m=S[7],w=l>c?l:c,y=l>c?1:l/c,x=l>c?c/l:1;e.translate(i,s),e.rotate(p),e.scale(y,x),e.arc(0,0,w,u,u+f,1-m),e.scale(1/y,1/x),e.rotate(-p),e.translate(-i,-s);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(u){if(u.command==="A"){const f=u.points[4],p=u.points[5],m=u.points[4]+p;let w=Math.PI/180;if(Math.abs(f-m)<w&&(w=Math.abs(f-m)),p<0)for(let y=f-w;y>m;y-=w){const x=Et.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],y,0);e.push(x.x,x.y)}else for(let y=f+w;y<m;y+=w){const x=Et.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],y,0);e.push(x.x,x.y)}}else if(u.command==="C")for(let f=0;f<=1;f+=.01){const p=Et.getPointOnCubicBezier(f,u.start.x,u.start.y,u.points[0],u.points[1],u.points[2],u.points[3],u.points[4],u.points[5]);e.push(p.x,p.y)}else e=e.concat(u.points)});let n=e[0],r=e[0],i=e[1],s=e[1],l,c;for(let u=0;u<e.length/2;u++)l=e[u*2],c=e[u*2+1],isNaN(l)||(n=Math.min(n,l),r=Math.max(r,l)),isNaN(c)||(i=Math.min(i,c),s=Math.max(s,c));return{x:n,y:i,width:r-n,height:s-i}}getLength(){return this.pathLength}getPointAtLength(e){return Et.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,n,r,i){return Math.sqrt((r-e)*(r-e)+(i-n)*(i-n))}static getPathLength(e){let n=0;for(let r=0;r<e.length;++r)n+=e[r].pathLength;return n}static getPointAtLengthOfDataArray(e,n){let r,i=0,s=n.length;if(!s)return null;for(;i<s&&e>n[i].pathLength;)e-=n[i].pathLength,++i;if(i===s)return r=n[i-1].points.slice(-2),{x:r[0],y:r[1]};if(e<.01)return r=n[i].points.slice(0,2),{x:r[0],y:r[1]};const l=n[i],c=l.points;switch(l.command){case"L":return Et.getPointOnLine(e,l.start.x,l.start.y,c[0],c[1]);case"C":return Et.getPointOnCubicBezier((0,no.t2length)(e,Et.getPathLength(n),b=>(0,no.getCubicArcLength)([l.start.x,c[0],c[2],c[4]],[l.start.y,c[1],c[3],c[5]],b)),l.start.x,l.start.y,c[0],c[1],c[2],c[3],c[4],c[5]);case"Q":return Et.getPointOnQuadraticBezier((0,no.t2length)(e,Et.getPathLength(n),b=>(0,no.getQuadraticArcLength)([l.start.x,c[0],c[2]],[l.start.y,c[1],c[3]],b)),l.start.x,l.start.y,c[0],c[1],c[2],c[3]);case"A":var u=c[0],f=c[1],p=c[2],m=c[3],w=c[4],y=c[5],x=c[6];return w+=y*e/l.pathLength,Et.getPointOnEllipticalArc(u,f,p,m,w,x)}return null}static getPointOnLine(e,n,r,i,s,l,c){l=l??n,c=c??r;const u=this.getLineLength(n,r,i,s);if(u<1e-10)return{x:n,y:r};if(i===n)return{x:l,y:c+(s>r?e:-e)};const f=(s-r)/(i-n),p=Math.sqrt(e*e/(1+f*f))*(i<n?-1:1),m=f*p;if(Math.abs(c-r-f*(l-n))<1e-10)return{x:l+p,y:c+m};const w=((l-n)*(i-n)+(c-r)*(s-r))/(u*u),y=n+w*(i-n),x=r+w*(s-r),b=this.getLineLength(l,c,y,x),_=Math.sqrt(e*e-b*b),S=Math.sqrt(_*_/(1+f*f))*(i<n?-1:1),T=f*S;return{x:y+S,y:x+T}}static getPointOnCubicBezier(e,n,r,i,s,l,c,u,f){function p(_){return _*_*_}function m(_){return 3*_*_*(1-_)}function w(_){return 3*_*(1-_)*(1-_)}function y(_){return(1-_)*(1-_)*(1-_)}const x=u*p(e)+l*m(e)+i*w(e)+n*y(e),b=f*p(e)+c*m(e)+s*w(e)+r*y(e);return{x,y:b}}static getPointOnQuadraticBezier(e,n,r,i,s,l,c){function u(y){return y*y}function f(y){return 2*y*(1-y)}function p(y){return(1-y)*(1-y)}const m=l*u(e)+i*f(e)+n*p(e),w=c*u(e)+s*f(e)+r*p(e);return{x:m,y:w}}static getPointOnEllipticalArc(e,n,r,i,s,l){const c=Math.cos(l),u=Math.sin(l),f={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:e+(f.x*c-f.y*u),y:n+(f.x*u+f.y*c)}}static parsePathData(e){if(!e)return[];let n=e;const r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];n=n.replace(new RegExp(" ","g"),",");for(var i=0;i<r.length;i++)n=n.replace(new RegExp(r[i],"g"),"|"+r[i]);const s=n.split("|"),l=[],c=[];let u=0,f=0;const p=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let m;for(i=1;i<s.length;i++){let M=s[i],R=M.charAt(0);for(M=M.slice(1),c.length=0;m=p.exec(M);)c.push(m[0]);const I=[];for(let j=0,z=c.length;j<z;j++){if(c[j]==="00"){I.push(0,0);continue}const W=parseFloat(c[j]);isNaN(W)?I.push(0):I.push(W)}for(;I.length>0&&!isNaN(I[0]);){let j="",z=[];const W=u,V=f;var w,y,x,b,_,S,T,h,k,C;switch(R){case"l":u+=I.shift(),f+=I.shift(),j="L",z.push(u,f);break;case"L":u=I.shift(),f=I.shift(),z.push(u,f);break;case"m":var N=I.shift(),A=I.shift();if(u+=N,f+=A,j="M",l.length>2&&l[l.length-1].command==="z"){for(let D=l.length-2;D>=0;D--)if(l[D].command==="M"){u=l[D].points[0]+N,f=l[D].points[1]+A;break}}z.push(u,f),R="l";break;case"M":u=I.shift(),f=I.shift(),j="M",z.push(u,f),R="L";break;case"h":u+=I.shift(),j="L",z.push(u,f);break;case"H":u=I.shift(),j="L",z.push(u,f);break;case"v":f+=I.shift(),j="L",z.push(u,f);break;case"V":f=I.shift(),j="L",z.push(u,f);break;case"C":z.push(I.shift(),I.shift(),I.shift(),I.shift()),u=I.shift(),f=I.shift(),z.push(u,f);break;case"c":z.push(u+I.shift(),f+I.shift(),u+I.shift(),f+I.shift()),u+=I.shift(),f+=I.shift(),j="C",z.push(u,f);break;case"S":y=u,x=f,w=l[l.length-1],w.command==="C"&&(y=u+(u-w.points[2]),x=f+(f-w.points[3])),z.push(y,x,I.shift(),I.shift()),u=I.shift(),f=I.shift(),j="C",z.push(u,f);break;case"s":y=u,x=f,w=l[l.length-1],w.command==="C"&&(y=u+(u-w.points[2]),x=f+(f-w.points[3])),z.push(y,x,u+I.shift(),f+I.shift()),u+=I.shift(),f+=I.shift(),j="C",z.push(u,f);break;case"Q":z.push(I.shift(),I.shift()),u=I.shift(),f=I.shift(),z.push(u,f);break;case"q":z.push(u+I.shift(),f+I.shift()),u+=I.shift(),f+=I.shift(),j="Q",z.push(u,f);break;case"T":y=u,x=f,w=l[l.length-1],w.command==="Q"&&(y=u+(u-w.points[0]),x=f+(f-w.points[1])),u=I.shift(),f=I.shift(),j="Q",z.push(y,x,u,f);break;case"t":y=u,x=f,w=l[l.length-1],w.command==="Q"&&(y=u+(u-w.points[0]),x=f+(f-w.points[1])),u+=I.shift(),f+=I.shift(),j="Q",z.push(y,x,u,f);break;case"A":b=I.shift(),_=I.shift(),S=I.shift(),T=I.shift(),h=I.shift(),k=u,C=f,u=I.shift(),f=I.shift(),j="A",z=this.convertEndpointToCenterParameterization(k,C,u,f,T,h,b,_,S);break;case"a":b=I.shift(),_=I.shift(),S=I.shift(),T=I.shift(),h=I.shift(),k=u,C=f,u+=I.shift(),f+=I.shift(),j="A",z=this.convertEndpointToCenterParameterization(k,C,u,f,T,h,b,_,S);break}l.push({command:j||R,points:z,start:{x:W,y:V},pathLength:this.calcLength(W,V,j||R,z)})}(R==="z"||R==="Z")&&l.push({command:"z",points:[],start:void 0,pathLength:0})}return l}static calcLength(e,n,r,i){let s,l,c,u;const f=Et;switch(r){case"L":return f.getLineLength(e,n,i[0],i[1]);case"C":return(0,no.getCubicArcLength)([e,i[0],i[2],i[4]],[n,i[1],i[3],i[5]],1);case"Q":return(0,no.getQuadraticArcLength)([e,i[0],i[2]],[n,i[1],i[3]],1);case"A":s=0;var p=i[4],m=i[5],w=i[4]+m,y=Math.PI/180;if(Math.abs(p-w)<y&&(y=Math.abs(p-w)),l=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],p,0),m<0)for(u=p-y;u>w;u-=y)c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),l=c;else for(u=p+y;u<w;u+=y)c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),l=c;return c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],w,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),s}return 0}static convertEndpointToCenterParameterization(e,n,r,i,s,l,c,u,f){const p=f*(Math.PI/180),m=Math.cos(p)*(e-r)/2+Math.sin(p)*(n-i)/2,w=-1*Math.sin(p)*(e-r)/2+Math.cos(p)*(n-i)/2,y=m*m/(c*c)+w*w/(u*u);y>1&&(c*=Math.sqrt(y),u*=Math.sqrt(y));let x=Math.sqrt((c*c*(u*u)-c*c*(w*w)-u*u*(m*m))/(c*c*(w*w)+u*u*(m*m)));s===l&&(x*=-1),isNaN(x)&&(x=0);const b=x*c*w/u,_=x*-u*m/c,S=(e+r)/2+Math.cos(p)*b-Math.sin(p)*_,T=(n+i)/2+Math.sin(p)*b+Math.cos(p)*_,h=function(I){return Math.sqrt(I[0]*I[0]+I[1]*I[1])},k=function(I,j){return(I[0]*j[0]+I[1]*j[1])/(h(I)*h(j))},C=function(I,j){return(I[0]*j[1]<I[1]*j[0]?-1:1)*Math.acos(k(I,j))},N=C([1,0],[(m-b)/c,(w-_)/u]),A=[(m-b)/c,(w-_)/u],M=[(-1*m-b)/c,(-1*w-_)/u];let R=C(A,M);return k(A,M)<=-1&&(R=Math.PI),k(A,M)>=1&&(R=0),l===0&&R>0&&(R=R-2*Math.PI),l===1&&R<0&&(R=R+2*Math.PI),[S,T,c,u,N,R,p,l]}}Yo.Path=Et;Et.prototype.className="Path";Et.prototype._attrsAffectingSize=["data"];(0,V7._registerNode)(Et);U7.Factory.addGetterSetter(Et,"data");Object.defineProperty(yd,"__esModule",{value:!0});yd.Arrow=void 0;const xd=je,W7=Pl,J5=Te,$7=Re,_2=Yo;let Rs=class extends W7.Line{_sceneFunc(e){super._sceneFunc(e);const n=Math.PI*2,r=this.points();let i=r;const s=this.tension()!==0&&r.length>4;s&&(i=this.getTensionPoints());const l=this.pointerLength(),c=r.length;let u,f;if(s){const w=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[c-2],r[c-1]],y=_2.Path.calcLength(i[i.length-4],i[i.length-3],"C",w),x=_2.Path.getPointOnQuadraticBezier(Math.min(1,1-l/y),w[0],w[1],w[2],w[3],w[4],w[5]);u=r[c-2]-x.x,f=r[c-1]-x.y}else u=r[c-2]-r[c-4],f=r[c-1]-r[c-3];const p=(Math.atan2(f,u)+n)%n,m=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[c-2],r[c-1]),e.rotate(p),e.moveTo(0,0),e.lineTo(-l,m/2),e.lineTo(-l,-m/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),s?(u=(i[0]+i[2])/2-r[0],f=(i[1]+i[3])/2-r[1]):(u=r[2]-r[0],f=r[3]-r[1]),e.rotate((Math.atan2(-f,-u)+n)%n),e.moveTo(0,0),e.lineTo(-l,m/2),e.lineTo(-l,-m/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const n=this.dashEnabled();n&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),n&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),n=this.pointerWidth()/2;return{x:e.x,y:e.y-n,width:e.width,height:e.height+n*2}}};yd.Arrow=Rs;Rs.prototype.className="Arrow";(0,$7._registerNode)(Rs);xd.Factory.addGetterSetter(Rs,"pointerLength",10,(0,J5.getNumberValidator)());xd.Factory.addGetterSetter(Rs,"pointerWidth",10,(0,J5.getNumberValidator)());xd.Factory.addGetterSetter(Rs,"pointerAtBeginning",!1);xd.Factory.addGetterSetter(Rs,"pointerAtEnding",!0);var wd={};Object.defineProperty(wd,"__esModule",{value:!0});wd.Circle=void 0;const H7=je,Y7=Mt,X7=Te,K7=Re;let Xo=class extends Y7.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};wd.Circle=Xo;Xo.prototype._centroid=!0;Xo.prototype.className="Circle";Xo.prototype._attrsAffectingSize=["radius"];(0,K7._registerNode)(Xo);H7.Factory.addGetterSetter(Xo,"radius",0,(0,X7.getNumberValidator)());var Sd={};Object.defineProperty(Sd,"__esModule",{value:!0});Sd.Ellipse=void 0;const Ng=je,Q7=Mt,e4=Te,Z7=Re;class Ji extends Q7.Shape{_sceneFunc(e){const n=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),n!==r&&e.scale(1,r/n),e.arc(0,0,n,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}Sd.Ellipse=Ji;Ji.prototype.className="Ellipse";Ji.prototype._centroid=!0;Ji.prototype._attrsAffectingSize=["radiusX","radiusY"];(0,Z7._registerNode)(Ji);Ng.Factory.addComponentsGetterSetter(Ji,"radius",["x","y"]);Ng.Factory.addGetterSetter(Ji,"radiusX",0,(0,e4.getNumberValidator)());Ng.Factory.addGetterSetter(Ji,"radiusY",0,(0,e4.getNumberValidator)());var _d={};Object.defineProperty(_d,"__esModule",{value:!0});_d.Image=void 0;const r0=pt,Ls=je,q7=Mt,J7=Re,Ml=Te;class tr extends q7.Shape{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",n=>{this._removeImageLoad(n.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),n=this.hasShadow();return e&&n?!0:super._useBufferCanvas(!0)}_sceneFunc(e){const n=this.getWidth(),r=this.getHeight(),i=this.cornerRadius(),s=this.attrs.image;let l;if(s){const c=this.attrs.cropWidth,u=this.attrs.cropHeight;c&&u?l=[s,this.cropX(),this.cropY(),c,u,0,0,n,r]:l=[s,0,0,n,r]}(this.hasFill()||this.hasStroke()||i)&&(e.beginPath(),i?r0.Util.drawRoundedRectPath(e,n,r,i):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)),s&&(i&&e.clip(),e.drawImage.apply(e,l))}_hitFunc(e){const n=this.width(),r=this.height(),i=this.cornerRadius();e.beginPath(),i?r0.Util.drawRoundedRectPath(e,n,r,i):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,n;return(e=this.attrs.width)!==null&&e!==void 0?e:(n=this.image())===null||n===void 0?void 0:n.width}getHeight(){var e,n;return(e=this.attrs.height)!==null&&e!==void 0?e:(n=this.image())===null||n===void 0?void 0:n.height}static fromURL(e,n,r=null){const i=r0.Util.createImageElement();i.onload=function(){const s=new tr({image:i});n(s)},i.onerror=r,i.crossOrigin="Anonymous",i.src=e}}_d.Image=tr;tr.prototype.className="Image";(0,J7._registerNode)(tr);Ls.Factory.addGetterSetter(tr,"cornerRadius",0,(0,Ml.getNumberOrArrayOfNumbersValidator)(4));Ls.Factory.addGetterSetter(tr,"image");Ls.Factory.addComponentsGetterSetter(tr,"crop",["x","y","width","height"]);Ls.Factory.addGetterSetter(tr,"cropX",0,(0,Ml.getNumberValidator)());Ls.Factory.addGetterSetter(tr,"cropY",0,(0,Ml.getNumberValidator)());Ls.Factory.addGetterSetter(tr,"cropWidth",0,(0,Ml.getNumberValidator)());Ls.Factory.addGetterSetter(tr,"cropHeight",0,(0,Ml.getNumberValidator)());var Lo={};Object.defineProperty(Lo,"__esModule",{value:!0});Lo.Tag=Lo.Label=void 0;const kd=je,ek=Mt,tk=$o,Pg=Te,t4=Re,n4=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],nk="Change.konva",rk="none",yp="up",vp="right",xp="down",wp="left",ik=n4.length;class Mg extends tk.Group{constructor(e){super(e),this.on("add.konva",function(n){this._addListeners(n.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let n=this,r;const i=function(){n._sync()};for(r=0;r<ik;r++)e.on(n4[r]+nk,i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),n=this.getTag(),r,i,s,l,c,u,f;if(e&&n){switch(r=e.width(),i=e.height(),s=n.pointerDirection(),l=n.pointerWidth(),f=n.pointerHeight(),c=0,u=0,s){case yp:c=r/2,u=-1*f;break;case vp:c=r+l,u=i/2;break;case xp:c=r/2,u=i+f;break;case wp:c=-1*l,u=i/2;break}n.setAttrs({x:-1*c,y:-1*u,width:r,height:i}),e.setAttrs({x:-1*c,y:-1*u})}}}Lo.Label=Mg;Mg.prototype.className="Label";(0,t4._registerNode)(Mg);class js extends ek.Shape{_sceneFunc(e){const n=this.width(),r=this.height(),i=this.pointerDirection(),s=this.pointerWidth(),l=this.pointerHeight(),c=this.cornerRadius();let u=0,f=0,p=0,m=0;typeof c=="number"?u=f=p=m=Math.min(c,n/2,r/2):(u=Math.min(c[0]||0,n/2,r/2),f=Math.min(c[1]||0,n/2,r/2),m=Math.min(c[2]||0,n/2,r/2),p=Math.min(c[3]||0,n/2,r/2)),e.beginPath(),e.moveTo(u,0),i===yp&&(e.lineTo((n-s)/2,0),e.lineTo(n/2,-1*l),e.lineTo((n+s)/2,0)),e.lineTo(n-f,0),e.arc(n-f,f,f,Math.PI*3/2,0,!1),i===vp&&(e.lineTo(n,(r-l)/2),e.lineTo(n+s,r/2),e.lineTo(n,(r+l)/2)),e.lineTo(n,r-m),e.arc(n-m,r-m,m,0,Math.PI/2,!1),i===xp&&(e.lineTo((n+s)/2,r),e.lineTo(n/2,r+l),e.lineTo((n-s)/2,r)),e.lineTo(p,r),e.arc(p,r-p,p,Math.PI/2,Math.PI,!1),i===wp&&(e.lineTo(0,(r+l)/2),e.lineTo(-1*s,r/2),e.lineTo(0,(r-l)/2)),e.lineTo(0,u),e.arc(u,u,u,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,n=0,r=this.pointerWidth(),i=this.pointerHeight(),s=this.pointerDirection(),l=this.width(),c=this.height();return s===yp?(n-=i,c+=i):s===xp?c+=i:s===wp?(e-=r*1.5,l+=r):s===vp&&(l+=r*1.5),{x:e,y:n,width:l,height:c}}}Lo.Tag=js;js.prototype.className="Tag";(0,t4._registerNode)(js);kd.Factory.addGetterSetter(js,"pointerDirection",rk);kd.Factory.addGetterSetter(js,"pointerWidth",0,(0,Pg.getNumberValidator)());kd.Factory.addGetterSetter(js,"pointerHeight",0,(0,Pg.getNumberValidator)());kd.Factory.addGetterSetter(js,"cornerRadius",0,(0,Pg.getNumberOrArrayOfNumbersValidator)(4));var Al={};Object.defineProperty(Al,"__esModule",{value:!0});Al.Rect=void 0;const sk=je,ok=Mt,ak=Re,lk=pt,uk=Te;let bd=class extends ok.Shape{_sceneFunc(e){const n=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),n?lk.Util.drawRoundedRectPath(e,r,i,n):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}};Al.Rect=bd;bd.prototype.className="Rect";(0,ak._registerNode)(bd);sk.Factory.addGetterSetter(bd,"cornerRadius",0,(0,uk.getNumberOrArrayOfNumbersValidator)(4));var Cd={};Object.defineProperty(Cd,"__esModule",{value:!0});Cd.RegularPolygon=void 0;const r4=je,ck=Mt,i4=Te,dk=Re;class Fs extends ck.Shape{_sceneFunc(e){const n=this._getPoints();e.beginPath(),e.moveTo(n[0].x,n[0].y);for(let r=1;r<n.length;r++)e.lineTo(n[r].x,n[r].y);e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,n=this.attrs.radius||0,r=[];for(let i=0;i<e;i++)r.push({x:n*Math.sin(i*2*Math.PI/e),y:-1*n*Math.cos(i*2*Math.PI/e)});return r}getSelfRect(){const e=this._getPoints();let n=e[0].x,r=e[0].y,i=e[0].x,s=e[0].y;return e.forEach(l=>{n=Math.min(n,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),s=Math.max(s,l.y)}),{x:n,y:i,width:r-n,height:s-i}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}Cd.RegularPolygon=Fs;Fs.prototype.className="RegularPolygon";Fs.prototype._centroid=!0;Fs.prototype._attrsAffectingSize=["radius"];(0,dk._registerNode)(Fs);r4.Factory.addGetterSetter(Fs,"radius",0,(0,i4.getNumberValidator)());r4.Factory.addGetterSetter(Fs,"sides",0,(0,i4.getNumberValidator)());var Td={};Object.defineProperty(Td,"__esModule",{value:!0});Td.Ring=void 0;const s4=je,fk=Mt,o4=Te,hk=Re,k2=Math.PI*2;class Os extends fk.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,k2,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),k2,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}Td.Ring=Os;Os.prototype.className="Ring";Os.prototype._centroid=!0;Os.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,hk._registerNode)(Os);s4.Factory.addGetterSetter(Os,"innerRadius",0,(0,o4.getNumberValidator)());s4.Factory.addGetterSetter(Os,"outerRadius",0,(0,o4.getNumberValidator)());var Ed={};Object.defineProperty(Ed,"__esModule",{value:!0});Ed.Sprite=void 0;const Ds=je,pk=Mt,gk=Ho,a4=Te,mk=Re;class Dr extends pk.Shape{constructor(e){super(e),this._updated=!0,this.anim=new gk.Animation(()=>{const n=this._updated;return this._updated=!1,n}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const n=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[n],l=this.frameOffsets(),c=s[i+0],u=s[i+1],f=s[i+2],p=s[i+3],m=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,f,p),e.closePath(),e.fillStrokeShape(this)),m)if(l){const w=l[n],y=r*2;e.drawImage(m,c,u,f,p,w[y+0],w[y+1],f,p)}else e.drawImage(m,c,u,f,p,0,0,f,p)}_hitFunc(e){const n=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[n],l=this.frameOffsets(),c=s[i+2],u=s[i+3];if(e.beginPath(),l){const f=l[n],p=r*2;e.rect(f[p+0],f[p+1],c,u)}else e.rect(0,0,c,u);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),n=this.animation(),r=this.animations(),i=r[n],s=i.length/4;e<s-1?this.frameIndex(e+1):this.frameIndex(0)}}Ed.Sprite=Dr;Dr.prototype.className="Sprite";(0,mk._registerNode)(Dr);Ds.Factory.addGetterSetter(Dr,"animation");Ds.Factory.addGetterSetter(Dr,"animations");Ds.Factory.addGetterSetter(Dr,"frameOffsets");Ds.Factory.addGetterSetter(Dr,"image");Ds.Factory.addGetterSetter(Dr,"frameIndex",0,(0,a4.getNumberValidator)());Ds.Factory.addGetterSetter(Dr,"frameRate",17,(0,a4.getNumberValidator)());Ds.Factory.backCompat(Dr,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});var Nd={};Object.defineProperty(Nd,"__esModule",{value:!0});Nd.Star=void 0;const Ag=je,yk=Mt,Ig=Te,vk=Re;class es extends yk.Shape{_sceneFunc(e){const n=this.innerRadius(),r=this.outerRadius(),i=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(let s=1;s<i*2;s++){const l=s%2===0?r:n,c=l*Math.sin(s*Math.PI/i),u=-1*l*Math.cos(s*Math.PI/i);e.lineTo(c,u)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}Nd.Star=es;es.prototype.className="Star";es.prototype._centroid=!0;es.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,vk._registerNode)(es);Ag.Factory.addGetterSetter(es,"numPoints",5,(0,Ig.getNumberValidator)());Ag.Factory.addGetterSetter(es,"innerRadius",0,(0,Ig.getNumberValidator)());Ag.Factory.addGetterSetter(es,"outerRadius",0,(0,Ig.getNumberValidator)());var Ko={};Object.defineProperty(Ko,"__esModule",{value:!0});Ko.Text=void 0;Ko.stringToArray=vs;const Sp=pt,sn=je,xk=Mt,i0=Re,ts=Te,wk=Re;function vs(t){return[...t].reduce((e,n,r,i)=>{if(/\p{Emoji}/u.test(n)){const s=i[r+1];s&&/\p{Emoji_Modifier}|\u200D/u.test(s)?(e.push(n+s),i[r+1]=""):e.push(n)}else/\p{Regional_Indicator}{2}/u.test(n+(i[r+1]||""))?e.push(n+i[r+1]):r>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(n)?e[e.length-1]+=n:n&&e.push(n);return e},[])}const ro="auto",Sk="center",l4="inherit",Pa="justify",_k="Change.konva",kk="2d",b2="-",u4="left",bk="text",Ck="Text",Tk="top",Ek="bottom",C2="middle",c4="normal",Nk="px ",Wu=" ",Pk="right",T2="rtl",Mk="word",Ak="char",E2="none",s0="",d4=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Ik=d4.length;function Rk(t){return t.split(",").map(e=>{e=e.trim();const n=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return n&&!r&&(e=`"${e}"`),e}).join(", ")}let $u;function o0(){return $u||($u=Sp.Util.createCanvasElement().getContext(kk),$u)}function Lk(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)}function jk(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Fk(t){return t=t||{},!t.fillLinearGradientColorStops&&!t.fillRadialGradientColorStops&&!t.fillPatternImage&&(t.fill=t.fill||"black"),t}let vt=class extends xk.Shape{constructor(e){super(Fk(e)),this._partialTextX=0,this._partialTextY=0;for(let n=0;n<Ik;n++)this.on(d4[n]+_k,this._setTextData);this._setTextData()}_sceneFunc(e){const n=this.textArr,r=n.length;if(!this.text())return;let i=this.padding(),s=this.fontSize(),l=this.lineHeight()*s,c=this.verticalAlign(),u=this.direction(),f=0,p=this.align(),m=this.getWidth(),w=this.letterSpacing(),y=this.fill(),x=this.textDecoration(),b=x.indexOf("underline")!==-1,_=x.indexOf("line-through")!==-1,S;u=u===l4?e.direction:u;let T=l/2,h=C2;if(i0.Konva._fixTextRendering){const z=this.measureSize("M");h="alphabetic",T=(z.fontBoundingBoxAscent-z.fontBoundingBoxDescent)/2+l/2}var k=0,C=0;for(u===T2&&e.setAttr("direction",u),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",h),e.setAttr("textAlign",u4),c===C2?f=(this.getHeight()-r*l-i*2)/2:c===Ek&&(f=this.getHeight()-r*l-i*2),e.translate(i,f+i),S=0;S<r;S++){var k=0,C=0,N=n[S],A=N.text,M=N.width,R=N.lastInParagraph,I,j;if(e.save(),p===Pk?k+=m-M-i*2:p===Sk&&(k+=(m-M-i*2)/2),b){e.save(),e.beginPath();const V=i0.Konva._fixTextRendering?Math.round(s/4):Math.round(s/2),D=k,U=T+C+V;e.moveTo(D,U),I=A.split(" ").length-1,j=p===Pa&&!R?m-i*2:M,e.lineTo(D+Math.round(j),U),e.lineWidth=s/15;const G=this._getLinearGradient();e.strokeStyle=G||y,e.stroke(),e.restore()}if(_){e.save(),e.beginPath();const V=i0.Konva._fixTextRendering?-Math.round(s/4):0;e.moveTo(k,T+C+V),I=A.split(" ").length-1,j=p===Pa&&!R?m-i*2:M,e.lineTo(k+Math.round(j),T+C+V),e.lineWidth=s/15;const D=this._getLinearGradient();e.strokeStyle=D||y,e.stroke(),e.restore()}if(u!==T2&&(w!==0||p===Pa)){I=A.split(" ").length-1;const V=vs(A);for(let D=0;D<V.length;D++){const U=V[D];U===" "&&!R&&p===Pa&&(k+=(m-i*2-M)/I),this._partialTextX=k,this._partialTextY=T+C,this._partialText=U,e.fillStrokeShape(this),k+=this.measureSize(U).width+w}}else w!==0&&e.setAttr("letterSpacing",`${w}px`),this._partialTextX=k,this._partialTextY=T+C,this._partialText=A,e.fillStrokeShape(this);e.restore(),r>1&&(T+=l)}}_hitFunc(e){const n=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}setText(e){const n=Sp.Util._isString(e)?e:e==null?"":e+"";return this._setAttr(bk,n),this}getWidth(){return this.attrs.width===ro||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===ro||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return Sp.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var n,r,i,s,l,c,u,f,p,m,w;let y=o0(),x=this.fontSize(),b;y.save(),y.font=this._getContextFont(),b=y.measureText(e),y.restore();const _=x/100;return{actualBoundingBoxAscent:(n=b.actualBoundingBoxAscent)!==null&&n!==void 0?n:71.58203125*_,actualBoundingBoxDescent:(r=b.actualBoundingBoxDescent)!==null&&r!==void 0?r:0,actualBoundingBoxLeft:(i=b.actualBoundingBoxLeft)!==null&&i!==void 0?i:-7.421875*_,actualBoundingBoxRight:(s=b.actualBoundingBoxRight)!==null&&s!==void 0?s:75.732421875*_,alphabeticBaseline:(l=b.alphabeticBaseline)!==null&&l!==void 0?l:0,emHeightAscent:(c=b.emHeightAscent)!==null&&c!==void 0?c:100*_,emHeightDescent:(u=b.emHeightDescent)!==null&&u!==void 0?u:-20*_,fontBoundingBoxAscent:(f=b.fontBoundingBoxAscent)!==null&&f!==void 0?f:91*_,fontBoundingBoxDescent:(p=b.fontBoundingBoxDescent)!==null&&p!==void 0?p:21*_,hangingBaseline:(m=b.hangingBaseline)!==null&&m!==void 0?m:72.80000305175781*_,ideographicBaseline:(w=b.ideographicBaseline)!==null&&w!==void 0?w:-21*_,width:b.width,height:x}}_getContextFont(){return this.fontStyle()+Wu+this.fontVariant()+Wu+(this.fontSize()+Nk)+Rk(this.fontFamily())}_addTextLine(e){this.align()===Pa&&(e=e.trim());const r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){const n=this.letterSpacing(),r=e.length;return o0().measureText(e).width+n*r}_setTextData(){let e=this.text().split(`
`),n=+this.fontSize(),r=0,i=this.lineHeight()*n,s=this.attrs.width,l=this.attrs.height,c=s!==ro&&s!==void 0,u=l!==ro&&l!==void 0,f=this.padding(),p=s-f*2,m=l-f*2,w=0,y=this.wrap(),x=y!==E2,b=y!==Ak&&x,_=this.ellipsis();this.textArr=[],o0().font=this._getContextFont();const S=_?this._getTextWidth(s0):0;for(let T=0,h=e.length;T<h;++T){let k=e[T],C=this._getTextWidth(k);if(c&&C>p)for(;k.length>0;){let N=0,A=vs(k).length,M="",R=0;for(;N<A;){const I=N+A>>>1,j=vs(k),z=j.slice(0,I+1).join(""),W=this._getTextWidth(z);(_&&u&&w+i>m?W+S:W)<=p?(N=I+1,M=z,R=W):A=I}if(M){if(b){const z=vs(k),W=vs(M),V=z[W.length],D=V===Wu||V===b2;let U;if(D&&R<=p)U=W.length;else{const G=W.lastIndexOf(Wu),F=W.lastIndexOf(b2);U=Math.max(G,F)+1}U>0&&(N=U,M=z.slice(0,N).join(""),R=this._getTextWidth(M))}if(M=M.trimRight(),this._addTextLine(M),r=Math.max(r,R),w+=i,this._shouldHandleEllipsis(w)){this._tryToAddEllipsisToLastLine();break}if(k=vs(k).slice(N).join("").trimLeft(),k.length>0&&(C=this._getTextWidth(k),C<=p)){this._addTextLine(k),w+=i,r=Math.max(r,C);break}}else break}else this._addTextLine(k),w+=i,r=Math.max(r,C),this._shouldHandleEllipsis(w)&&T<h-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),u&&w+i>m)break}this.textHeight=n,this.textWidth=r}_shouldHandleEllipsis(e){const n=+this.fontSize(),r=this.lineHeight()*n,i=this.attrs.height,s=i!==ro&&i!==void 0,l=this.padding(),c=i-l*2;return!(this.wrap()!==E2)||s&&e+r>c}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,n=e!==ro&&e!==void 0,r=this.padding(),i=e-r*2,s=this.ellipsis(),l=this.textArr[this.textArr.length-1];!l||!s||(n&&(this._getTextWidth(l.text+s0)<i||(l.text=l.text.slice(0,l.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(l.text+s0))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,n=this.hasShadow();return e&&n?!0:super._useBufferCanvas()}};Ko.Text=vt;vt.prototype._fillFunc=Lk;vt.prototype._strokeFunc=jk;vt.prototype.className=Ck;vt.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,wk._registerNode)(vt);sn.Factory.overWriteSetter(vt,"width",(0,ts.getNumberOrAutoValidator)());sn.Factory.overWriteSetter(vt,"height",(0,ts.getNumberOrAutoValidator)());sn.Factory.addGetterSetter(vt,"direction",l4);sn.Factory.addGetterSetter(vt,"fontFamily","Arial");sn.Factory.addGetterSetter(vt,"fontSize",12,(0,ts.getNumberValidator)());sn.Factory.addGetterSetter(vt,"fontStyle",c4);sn.Factory.addGetterSetter(vt,"fontVariant",c4);sn.Factory.addGetterSetter(vt,"padding",0,(0,ts.getNumberValidator)());sn.Factory.addGetterSetter(vt,"align",u4);sn.Factory.addGetterSetter(vt,"verticalAlign",Tk);sn.Factory.addGetterSetter(vt,"lineHeight",1,(0,ts.getNumberValidator)());sn.Factory.addGetterSetter(vt,"wrap",Mk);sn.Factory.addGetterSetter(vt,"ellipsis",!1,(0,ts.getBooleanValidator)());sn.Factory.addGetterSetter(vt,"letterSpacing",0,(0,ts.getNumberValidator)());sn.Factory.addGetterSetter(vt,"text","",(0,ts.getStringValidator)());sn.Factory.addGetterSetter(vt,"textDecoration","");var Pd={};Object.defineProperty(Pd,"__esModule",{value:!0});Pd.TextPath=void 0;const a0=pt,xr=je,Ok=Mt,Ma=Yo,l0=Ko,f4=Te,Dk=Re,zk="",h4="normal";function p4(t){t.fillText(this.partialText,0,0)}function g4(t){t.strokeText(this.partialText,0,0)}class At extends Ok.Shape{constructor(e){super(e),this.dummyCanvas=a0.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Ma.Path.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;const n=this.pathLength;return e-1>n?null:Ma.Path.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=Ma.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const n=this.textDecoration(),r=this.fill(),i=this.fontSize(),s=this.glyphInfo;n==="underline"&&e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),this.partialText=s[l].text,e.fillStrokeShape(this),n==="underline"&&(l===0&&e.moveTo(0,i/2+1),e.lineTo(i,i/2+1)),e.restore()}n==="underline"&&(e.strokeStyle=r,e.lineWidth=i/20,e.stroke()),e.restore()}_hitFunc(e){e.beginPath();const n=this.glyphInfo;if(n.length>=1){const r=n[0].p0;e.moveTo(r.x,r.y)}for(let r=0;r<n.length;r++){const i=n[r].p1;e.lineTo(i.x,i.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return a0.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return l0.Text.prototype.setText.call(this,e)}_getContextFont(){return l0.Text.prototype._getContextFont.call(this)}_getTextSize(e){const r=this.dummyCanvas.getContext("2d");r.save(),r.font=this._getContextFont();const i=r.measureText(e);return r.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:e,height:n}=this._getTextSize(this.attrs.text);if(this.textWidth=e,this.textHeight=n,this.glyphInfo=[],!this.attrs.data)return null;const r=this.letterSpacing(),i=this.align(),s=this.kerningFunc(),l=Math.max(this.textWidth+((this.attrs.text||"").length-1)*r,0);let c=0;i==="center"&&(c=Math.max(0,this.pathLength/2-l/2)),i==="right"&&(c=Math.max(0,this.pathLength-l));const u=(0,l0.stringToArray)(this.text());let f=c;for(let p=0;p<u.length;p++){const m=this._getPointAtLength(f);if(!m)return;let w=this._getTextSize(u[p]).width+r;if(u[p]===" "&&i==="justify"){const T=this.text().split(" ").length-1;w+=(this.pathLength-l)/T}const y=this._getPointAtLength(f+w);if(!y)return;const x=Ma.Path.getLineLength(m.x,m.y,y.x,y.y);let b=0;if(s)try{b=s(u[p-1],u[p])*this.fontSize()}catch{b=0}m.x+=b,y.x+=b,this.textWidth+=b;const _=Ma.Path.getPointOnLine(b+x/2,m.x,m.y,y.x,y.y),S=Math.atan2(y.y-m.y,y.x-m.x);this.glyphInfo.push({transposeX:_.x,transposeY:_.y,text:u[p],rotation:S,p0:m,p1:y}),f+=w}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(f){e.push(f.p0.x),e.push(f.p0.y),e.push(f.p1.x),e.push(f.p1.y)});let n=e[0]||0,r=e[0]||0,i=e[1]||0,s=e[1]||0,l,c;for(let f=0;f<e.length/2;f++)l=e[f*2],c=e[f*2+1],n=Math.min(n,l),r=Math.max(r,l),i=Math.min(i,c),s=Math.max(s,c);const u=this.fontSize();return{x:n-u/2,y:i-u/2,width:r-n+u,height:s-i+u}}destroy(){return a0.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}Pd.TextPath=At;At.prototype._fillFunc=p4;At.prototype._strokeFunc=g4;At.prototype._fillFuncHit=p4;At.prototype._strokeFuncHit=g4;At.prototype.className="TextPath";At.prototype._attrsAffectingSize=["text","fontSize","data"];(0,Dk._registerNode)(At);xr.Factory.addGetterSetter(At,"data");xr.Factory.addGetterSetter(At,"fontFamily","Arial");xr.Factory.addGetterSetter(At,"fontSize",12,(0,f4.getNumberValidator)());xr.Factory.addGetterSetter(At,"fontStyle",h4);xr.Factory.addGetterSetter(At,"align","left");xr.Factory.addGetterSetter(At,"letterSpacing",0,(0,f4.getNumberValidator)());xr.Factory.addGetterSetter(At,"textBaseline","middle");xr.Factory.addGetterSetter(At,"fontVariant",h4);xr.Factory.addGetterSetter(At,"text",zk);xr.Factory.addGetterSetter(At,"textDecoration","");xr.Factory.addGetterSetter(At,"kerningFunc",void 0);var Md={};Object.defineProperty(Md,"__esModule",{value:!0});Md.Transformer=void 0;const Ye=pt,Ve=je,N2=lt,Bk=Mt,Uk=Al,P2=$o,ur=Re,ns=Te,Gk=Re,m4="tr-konva",Vk=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(t=>t+`.${m4}`).join(" "),M2="nodesRect",Wk=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],$k={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Hk="ontouchstart"in ur.Konva._global;function Yk(t,e,n){if(t==="rotater")return n;e+=Ye.Util.degToRad($k[t]||0);const r=(Ye.Util.radToDeg(e)%360+360)%360;return Ye.Util._inRange(r,315+22.5,360)||Ye.Util._inRange(r,0,22.5)?"ns-resize":Ye.Util._inRange(r,45-22.5,45+22.5)?"nesw-resize":Ye.Util._inRange(r,90-22.5,90+22.5)?"ew-resize":Ye.Util._inRange(r,135-22.5,135+22.5)?"nwse-resize":Ye.Util._inRange(r,180-22.5,180+22.5)?"ns-resize":Ye.Util._inRange(r,225-22.5,225+22.5)?"nesw-resize":Ye.Util._inRange(r,270-22.5,270+22.5)?"ew-resize":Ye.Util._inRange(r,315-22.5,315+22.5)?"nwse-resize":(Ye.Util.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}const Gc=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],A2=1e8;function Xk(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}function y4(t,e,n){const r=n.x+(t.x-n.x)*Math.cos(e)-(t.y-n.y)*Math.sin(e),i=n.y+(t.x-n.x)*Math.sin(e)+(t.y-n.y)*Math.cos(e);return{...t,rotation:t.rotation+e,x:r,y:i}}function Kk(t,e){const n=Xk(t);return y4(t,e,n)}function Qk(t,e,n){let r=e;for(let i=0;i<t.length;i++){const s=ur.Konva.getAngle(t[i]),l=Math.abs(s-e)%(Math.PI*2);Math.min(l,Math.PI*2-l)<n&&(r=s)}return r}let _p=0;class De extends P2.Group{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Vk,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return Ye.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return m4+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const n=e.filter(i=>i.isAncestorOf(this)?(Ye.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=n,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(i=>{const s=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(i._attrsAffectingSize.length){const l=i._attrsAffectingSize.map(c=>c+"Change."+this._getEventNamespace()).join(" ");i.on(l,s)}i.on(Wk.map(l=>l+`.${this._getEventNamespace()}`).join(" "),s),i.on(`absoluteTransformChange.${this._getEventNamespace()}`,s),this._proxyDrag(i)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let n;e.on(`dragstart.${this._getEventNamespace()}`,r=>{n=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(r,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!n)return;const i=e.getAbsolutePosition(),s=i.x-n.x,l=i.y-n.y;this.nodes().forEach(c=>{if(c===e||c.isDragging())return;const u=c.getAbsolutePosition();c.setAbsolutePosition({x:u.x+s,y:u.y+l}),c.startDrag(r)}),n=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(M2),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(M2,this.__getNodeRect)}__getNodeShape(e,n=this.rotation(),r){const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=e.getAbsoluteScale(r),l=e.getAbsolutePosition(r),c=i.x*s.x-e.offsetX()*s.x,u=i.y*s.y-e.offsetY()*s.y,f=(ur.Konva.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),p={x:l.x+c*Math.cos(f)+u*Math.sin(-f),y:l.y+u*Math.cos(f)+c*Math.sin(f),width:i.width*s.x,height:i.height*s.y,rotation:f};return y4(p,-ur.Konva.getAngle(n),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-A2,y:-A2,width:0,height:0,rotation:0};const n=[];this.nodes().map(f=>{const p=f.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),m=[{x:p.x,y:p.y},{x:p.x+p.width,y:p.y},{x:p.x+p.width,y:p.y+p.height},{x:p.x,y:p.y+p.height}],w=f.getAbsoluteTransform();m.forEach(function(y){const x=w.point(y);n.push(x)})});const r=new Ye.Transform;r.rotate(-ur.Konva.getAngle(this.rotation()));let i=1/0,s=1/0,l=-1/0,c=-1/0;n.forEach(function(f){const p=r.point(f);i===void 0&&(i=l=p.x,s=c=p.y),i=Math.min(i,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),c=Math.max(c,p.y)}),r.invert();const u=r.point({x:i,y:s});return{x:u.x,y:u.y,width:l-i,height:c-s,rotation:ur.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Gc.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const n=new Uk.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Hk?10:"auto"}),r=this;n.on("mousedown touchstart",function(i){r._handleMouseDown(i)}),n.on("dragstart",i=>{n.stopDrag(),i.cancelBubble=!0}),n.on("dragend",i=>{i.cancelBubble=!0}),n.on("mouseenter",()=>{const i=ur.Konva.getAngle(this.rotation()),s=this.rotateAnchorCursor(),l=Yk(e,i,s);n.getStage().content&&(n.getStage().content.style.cursor=l),this._cursorChange=!0}),n.on("mouseout",()=>{n.getStage().content&&(n.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(n)}_createBack(){const e=new Bk.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(n,r){const i=r.getParent(),s=i.padding();n.beginPath(),n.rect(-s,-s,r.width()+s*2,r.height()+s*2),n.moveTo(r.width()/2,-s),i.rotateEnabled()&&i.rotateLineVisible()&&n.lineTo(r.width()/2,-i.rotateAnchorOffset()*Ye.Util._sign(r.height())-s),n.fillStrokeShape(r)},hitFunc:(n,r)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();n.beginPath(),n.rect(-i,-i,r.width()+i*2,r.height()+i*2),n.fillStrokeShape(r)}});this.add(e),this._proxyDrag(e),e.on("dragstart",n=>{n.cancelBubble=!0}),e.on("dragmove",n=>{n.cancelBubble=!0}),e.on("dragend",n=>{n.cancelBubble=!0}),this.on("dragmove",n=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const n=this._getNodeRect(),r=n.width,i=n.height,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));this.sin=Math.abs(i/s),this.cos=Math.abs(r/s),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const l=e.target.getAbsolutePosition(),c=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:c.x-l.x,y:c.y-l.y},_p++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(u=>{u._fire("transformstart",{evt:e.evt,target:u})})}_handleMouseMove(e){let n,r,i;const s=this.findOne("."+this._movingAnchorName),l=s.getStage();l.setPointersPositions(e);const c=l.getPointerPosition();let u={x:c.x-this._anchorDragOffset.x,y:c.y-this._anchorDragOffset.y};const f=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(u=this.anchorDragBoundFunc()(f,u,e)),s.setAbsolutePosition(u);const p=s.getAbsolutePosition();if(f.x===p.x&&f.y===p.y)return;if(this._movingAnchorName==="rotater"){const C=this._getNodeRect();n=s.x()-C.width/2,r=-s.y()+C.height/2;let N=Math.atan2(-r,n)+Math.PI/2;C.height<0&&(N-=Math.PI);const M=ur.Konva.getAngle(this.rotation())+N,R=ur.Konva.getAngle(this.rotationSnapTolerance()),j=Qk(this.rotationSnaps(),M,R)-C.rotation,z=Kk(C,j);this._fitNodesInto(z,e);return}const m=this.shiftBehavior();let w;m==="inverted"?w=this.keepRatio()&&!e.shiftKey:m==="none"?w=this.keepRatio():w=this.keepRatio()||e.shiftKey;var S=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(w){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(y.x-s.x(),2)+Math.pow(y.y-s.y(),2));var x=this.findOne(".top-left").x()>y.x?-1:1,b=this.findOne(".top-left").y()>y.y?-1:1;n=i*this.cos*x,r=i*this.sin*b,this.findOne(".top-left").x(y.x-n),this.findOne(".top-left").y(y.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(s.y());else if(this._movingAnchorName==="top-right"){if(w){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(s.x()-y.x,2)+Math.pow(y.y-s.y(),2));var x=this.findOne(".top-right").x()<y.x?-1:1,b=this.findOne(".top-right").y()>y.y?-1:1;n=i*this.cos*x,r=i*this.sin*b,this.findOne(".top-right").x(y.x+n),this.findOne(".top-right").y(y.y-r)}var _=s.position();this.findOne(".top-left").y(_.y),this.findOne(".bottom-right").x(_.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(s.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(s.x());else if(this._movingAnchorName==="bottom-left"){if(w){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(y.x-s.x(),2)+Math.pow(s.y()-y.y,2));var x=y.x<s.x()?-1:1,b=s.y()<y.y?-1:1;n=i*this.cos*x,r=i*this.sin*b,s.x(y.x-n),s.y(y.y+r)}_=s.position(),this.findOne(".top-left").x(_.x),this.findOne(".bottom-right").y(_.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(s.y());else if(this._movingAnchorName==="bottom-right"){if(w){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(s.x()-y.x,2)+Math.pow(s.y()-y.y,2));var x=this.findOne(".bottom-right").x()<y.x?-1:1,b=this.findOne(".bottom-right").y()<y.y?-1:1;n=i*this.cos*x,r=i*this.sin*b,this.findOne(".bottom-right").x(y.x+n),this.findOne(".bottom-right").y(y.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var S=this.centeredScaling()||e.altKey;if(S){const C=this.findOne(".top-left"),N=this.findOne(".bottom-right"),A=C.x(),M=C.y(),R=this.getWidth()-N.x(),I=this.getHeight()-N.y();N.move({x:-A,y:-M}),C.move({x:R,y:I})}const T=this.findOne(".top-left").getAbsolutePosition();n=T.x,r=T.y;const h=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),k=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:n,y:r,width:h,height:k,rotation:ur.Konva.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var n;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const r=this.getNode();_p--,this._fire("transformend",{evt:e,target:r}),(n=this.getLayer())===null||n===void 0||n.batchDraw(),r&&this._nodes.forEach(i=>{var s;i._fire("transformend",{evt:e,target:i}),(s=i.getLayer())===null||s===void 0||s.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,n){const r=this._getNodeRect(),i=1;if(Ye.Util._inRange(e.width,-this.padding()*2-i,i)){this.update();return}if(Ye.Util._inRange(e.height,-this.padding()*2-i,i)){this.update();return}const s=new Ye.Transform;if(s.rotate(ur.Konva.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const w=s.point({x:-this.padding()*2,y:0});e.x+=w.x,e.y+=w.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=w.x,this._anchorDragOffset.y-=w.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const w=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=w.x,this._anchorDragOffset.y-=w.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const w=s.point({x:0,y:-this.padding()*2});e.x+=w.x,e.y+=w.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=w.x,this._anchorDragOffset.y-=w.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const w=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=w.x,this._anchorDragOffset.y-=w.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){const w=this.boundBoxFunc()(r,e);w?e=w:Ye.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const l=1e7,c=new Ye.Transform;c.translate(r.x,r.y),c.rotate(r.rotation),c.scale(r.width/l,r.height/l);const u=new Ye.Transform,f=e.width/l,p=e.height/l;this.flipEnabled()===!1?(u.translate(e.x,e.y),u.rotate(e.rotation),u.translate(e.width<0?e.width:0,e.height<0?e.height:0),u.scale(Math.abs(f),Math.abs(p))):(u.translate(e.x,e.y),u.rotate(e.rotation),u.scale(f,p));const m=u.multiply(c.invert());this._nodes.forEach(w=>{var y;const x=w.getParent().getAbsoluteTransform(),b=w.getTransform().copy();b.translate(w.offsetX(),w.offsetY());const _=new Ye.Transform;_.multiply(x.copy().invert()).multiply(m).multiply(x).multiply(b);const S=_.decompose();w.setAttrs(S),(y=w.getLayer())===null||y===void 0||y.batchDraw()}),this.rotation(Ye.Util._getRotation(e.rotation)),this._nodes.forEach(w=>{this._fire("transform",{evt:n,target:w}),w._fire("transform",{evt:n,target:w})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,n){this.findOne(e).setAttrs(n)}update(){var e;const n=this._getNodeRect();this.rotation(Ye.Util._getRotation(n.rotation));const r=n.width,i=n.height,s=this.enabledAnchors(),l=this.resizeEnabled(),c=this.padding(),u=this.anchorSize(),f=this.find("._anchor");f.forEach(m=>{m.setAttrs({width:u,height:u,offsetX:u/2,offsetY:u/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:u/2+c,offsetY:u/2+c,visible:l&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:u/2+c,visible:l&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:u/2-c,offsetY:u/2+c,visible:l&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:u/2+c,visible:l&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:i/2,offsetX:u/2-c,visible:l&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:u/2+c,offsetY:u/2-c,visible:l&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:i,offsetY:u/2-c,visible:l&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:i,offsetX:u/2-c,offsetY:u/2-c,visible:l&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*Ye.Util._sign(i)-c,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const p=this.anchorStyleFunc();p&&f.forEach(m=>{p(m)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),P2.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return N2.Node.prototype.toObject.call(this)}clone(e){return N2.Node.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Md.Transformer=De;De.isTransforming=()=>_p>0;function Zk(t){return t instanceof Array||Ye.Util.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach(function(e){Gc.indexOf(e)===-1&&Ye.Util.warn("Unknown anchor name: "+e+". Available names are: "+Gc.join(", "))}),t||[]}De.prototype.className="Transformer";(0,Gk._registerNode)(De);Ve.Factory.addGetterSetter(De,"enabledAnchors",Gc,Zk);Ve.Factory.addGetterSetter(De,"flipEnabled",!0,(0,ns.getBooleanValidator)());Ve.Factory.addGetterSetter(De,"resizeEnabled",!0);Ve.Factory.addGetterSetter(De,"anchorSize",10,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"rotateEnabled",!0);Ve.Factory.addGetterSetter(De,"rotateLineVisible",!0);Ve.Factory.addGetterSetter(De,"rotationSnaps",[]);Ve.Factory.addGetterSetter(De,"rotateAnchorOffset",50,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"rotateAnchorCursor","crosshair");Ve.Factory.addGetterSetter(De,"rotationSnapTolerance",5,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"borderEnabled",!0);Ve.Factory.addGetterSetter(De,"anchorStroke","rgb(0, 161, 255)");Ve.Factory.addGetterSetter(De,"anchorStrokeWidth",1,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"anchorFill","white");Ve.Factory.addGetterSetter(De,"anchorCornerRadius",0,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"borderStroke","rgb(0, 161, 255)");Ve.Factory.addGetterSetter(De,"borderStrokeWidth",1,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"borderDash");Ve.Factory.addGetterSetter(De,"keepRatio",!0);Ve.Factory.addGetterSetter(De,"shiftBehavior","default");Ve.Factory.addGetterSetter(De,"centeredScaling",!1);Ve.Factory.addGetterSetter(De,"ignoreStroke",!1);Ve.Factory.addGetterSetter(De,"padding",0,(0,ns.getNumberValidator)());Ve.Factory.addGetterSetter(De,"nodes");Ve.Factory.addGetterSetter(De,"node");Ve.Factory.addGetterSetter(De,"boundBoxFunc");Ve.Factory.addGetterSetter(De,"anchorDragBoundFunc");Ve.Factory.addGetterSetter(De,"anchorStyleFunc");Ve.Factory.addGetterSetter(De,"shouldOverdrawWholeArea",!1);Ve.Factory.addGetterSetter(De,"useSingleNodeRotation",!0);Ve.Factory.backCompat(De,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});var Ad={};Object.defineProperty(Ad,"__esModule",{value:!0});Ad.Wedge=void 0;const Id=je,qk=Mt,Jk=Re,v4=Te,eb=Re;class fi extends qk.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,Jk.Konva.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}Ad.Wedge=fi;fi.prototype.className="Wedge";fi.prototype._centroid=!0;fi.prototype._attrsAffectingSize=["radius"];(0,eb._registerNode)(fi);Id.Factory.addGetterSetter(fi,"radius",0,(0,v4.getNumberValidator)());Id.Factory.addGetterSetter(fi,"angle",0,(0,v4.getNumberValidator)());Id.Factory.addGetterSetter(fi,"clockwise",!1);Id.Factory.backCompat(fi,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var Rd={};Object.defineProperty(Rd,"__esModule",{value:!0});Rd.Blur=void 0;const I2=je,tb=lt,nb=Te;function R2(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const rb=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],ib=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function sb(t,e){const n=t.data,r=t.width,i=t.height;let s,l,c,u,f,p,m,w,y,x,b,_,S,T,h,k,C,N,A,M,R,I,j,z;const W=e+e+1,V=r-1,D=i-1,U=e+1,G=U*(U+1)/2,F=new R2,Y=rb[e],X=ib[e];let te=null,K=F,ee=null,ne=null;for(c=1;c<W;c++)K=K.next=new R2,c===U&&(te=K);for(K.next=F,m=p=0,l=0;l<i;l++){for(k=C=N=A=w=y=x=b=0,_=U*(M=n[p]),S=U*(R=n[p+1]),T=U*(I=n[p+2]),h=U*(j=n[p+3]),w+=G*M,y+=G*R,x+=G*I,b+=G*j,K=F,c=0;c<U;c++)K.r=M,K.g=R,K.b=I,K.a=j,K=K.next;for(c=1;c<U;c++)u=p+((V<c?V:c)<<2),w+=(K.r=M=n[u])*(z=U-c),y+=(K.g=R=n[u+1])*z,x+=(K.b=I=n[u+2])*z,b+=(K.a=j=n[u+3])*z,k+=M,C+=R,N+=I,A+=j,K=K.next;for(ee=F,ne=te,s=0;s<r;s++)n[p+3]=j=b*Y>>X,j!==0?(j=255/j,n[p]=(w*Y>>X)*j,n[p+1]=(y*Y>>X)*j,n[p+2]=(x*Y>>X)*j):n[p]=n[p+1]=n[p+2]=0,w-=_,y-=S,x-=T,b-=h,_-=ee.r,S-=ee.g,T-=ee.b,h-=ee.a,u=m+((u=s+e+1)<V?u:V)<<2,k+=ee.r=n[u],C+=ee.g=n[u+1],N+=ee.b=n[u+2],A+=ee.a=n[u+3],w+=k,y+=C,x+=N,b+=A,ee=ee.next,_+=M=ne.r,S+=R=ne.g,T+=I=ne.b,h+=j=ne.a,k-=M,C-=R,N-=I,A-=j,ne=ne.next,p+=4;m+=r}for(s=0;s<r;s++){for(C=N=A=k=y=x=b=w=0,p=s<<2,_=U*(M=n[p]),S=U*(R=n[p+1]),T=U*(I=n[p+2]),h=U*(j=n[p+3]),w+=G*M,y+=G*R,x+=G*I,b+=G*j,K=F,c=0;c<U;c++)K.r=M,K.g=R,K.b=I,K.a=j,K=K.next;for(f=r,c=1;c<=e;c++)p=f+s<<2,w+=(K.r=M=n[p])*(z=U-c),y+=(K.g=R=n[p+1])*z,x+=(K.b=I=n[p+2])*z,b+=(K.a=j=n[p+3])*z,k+=M,C+=R,N+=I,A+=j,K=K.next,c<D&&(f+=r);for(p=s,ee=F,ne=te,l=0;l<i;l++)u=p<<2,n[u+3]=j=b*Y>>X,j>0?(j=255/j,n[u]=(w*Y>>X)*j,n[u+1]=(y*Y>>X)*j,n[u+2]=(x*Y>>X)*j):n[u]=n[u+1]=n[u+2]=0,w-=_,y-=S,x-=T,b-=h,_-=ee.r,S-=ee.g,T-=ee.b,h-=ee.a,u=s+((u=l+U)<D?u:D)*r<<2,w+=k+=ee.r=n[u],y+=C+=ee.g=n[u+1],x+=N+=ee.b=n[u+2],b+=A+=ee.a=n[u+3],ee=ee.next,_+=M=ne.r,S+=R=ne.g,T+=I=ne.b,h+=j=ne.a,k-=M,C-=R,N-=I,A-=j,ne=ne.next,p+=r}}const ob=function(e){const n=Math.round(this.blurRadius());n>0&&sb(e,n)};Rd.Blur=ob;I2.Factory.addGetterSetter(tb.Node,"blurRadius",0,(0,nb.getNumberValidator)(),I2.Factory.afterSetFilter);var Ld={};Object.defineProperty(Ld,"__esModule",{value:!0});Ld.Brighten=void 0;const L2=je,ab=lt,lb=Te,ub=function(t){const e=this.brightness()*255,n=t.data,r=n.length;for(let i=0;i<r;i+=4)n[i]+=e,n[i+1]+=e,n[i+2]+=e};Ld.Brighten=ub;L2.Factory.addGetterSetter(ab.Node,"brightness",0,(0,lb.getNumberValidator)(),L2.Factory.afterSetFilter);var jd={};Object.defineProperty(jd,"__esModule",{value:!0});jd.Contrast=void 0;const j2=je,cb=lt,db=Te,fb=function(t){const e=Math.pow((this.contrast()+100)/100,2),n=t.data,r=n.length;let i=150,s=150,l=150;for(let c=0;c<r;c+=4)i=n[c],s=n[c+1],l=n[c+2],i/=255,i-=.5,i*=e,i+=.5,i*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,l/=255,l-=.5,l*=e,l+=.5,l*=255,i=i<0?0:i>255?255:i,s=s<0?0:s>255?255:s,l=l<0?0:l>255?255:l,n[c]=i,n[c+1]=s,n[c+2]=l};jd.Contrast=fb;j2.Factory.addGetterSetter(cb.Node,"contrast",0,(0,db.getNumberValidator)(),j2.Factory.afterSetFilter);var Fd={};Object.defineProperty(Fd,"__esModule",{value:!0});Fd.Emboss=void 0;const Yi=je,Od=lt,hb=pt,x4=Te,pb=function(t){const e=this.embossStrength()*10,n=this.embossWhiteLevel()*255,r=this.embossDirection(),i=this.embossBlend(),s=t.data,l=t.width,c=t.height,u=l*4;let f=0,p=0,m=c;switch(r){case"top-left":f=-1,p=-1;break;case"top":f=-1,p=0;break;case"top-right":f=-1,p=1;break;case"right":f=0,p=1;break;case"bottom-right":f=1,p=1;break;case"bottom":f=1,p=0;break;case"bottom-left":f=1,p=-1;break;case"left":f=0,p=-1;break;default:hb.Util.error("Unknown emboss direction: "+r)}do{const w=(m-1)*u;let y=f;m+y<1&&(y=0),m+y>c&&(y=0);const x=(m-1+y)*l*4;let b=l;do{const _=w+(b-1)*4;let S=p;b+S<1&&(S=0),b+S>l&&(S=0);const T=x+(b-1+S)*4,h=s[_]-s[T],k=s[_+1]-s[T+1],C=s[_+2]-s[T+2];let N=h;const A=N>0?N:-N,M=k>0?k:-k,R=C>0?C:-C;if(M>A&&(N=k),R>A&&(N=C),N*=e,i){const I=s[_]+N,j=s[_+1]+N,z=s[_+2]+N;s[_]=I>255?255:I<0?0:I,s[_+1]=j>255?255:j<0?0:j,s[_+2]=z>255?255:z<0?0:z}else{let I=n-N;I<0?I=0:I>255&&(I=255),s[_]=s[_+1]=s[_+2]=I}}while(--b)}while(--m)};Fd.Emboss=pb;Yi.Factory.addGetterSetter(Od.Node,"embossStrength",.5,(0,x4.getNumberValidator)(),Yi.Factory.afterSetFilter);Yi.Factory.addGetterSetter(Od.Node,"embossWhiteLevel",.5,(0,x4.getNumberValidator)(),Yi.Factory.afterSetFilter);Yi.Factory.addGetterSetter(Od.Node,"embossDirection","top-left",void 0,Yi.Factory.afterSetFilter);Yi.Factory.addGetterSetter(Od.Node,"embossBlend",!1,void 0,Yi.Factory.afterSetFilter);var Dd={};Object.defineProperty(Dd,"__esModule",{value:!0});Dd.Enhance=void 0;const F2=je,gb=lt,mb=Te;function u0(t,e,n,r,i){const s=n-e,l=i-r;if(s===0)return r+l/2;if(l===0)return r;let c=(t-e)/s;return c=l*c+r,c}const yb=function(t){const e=t.data,n=e.length;let r=e[0],i=r,s,l=e[1],c=l,u,f=e[2],p=f,m;const w=this.enhance();if(w===0)return;for(let N=0;N<n;N+=4)s=e[N+0],s<r?r=s:s>i&&(i=s),u=e[N+1],u<l?l=u:u>c&&(c=u),m=e[N+2],m<f?f=m:m>p&&(p=m);i===r&&(i=255,r=0),c===l&&(c=255,l=0),p===f&&(p=255,f=0);let y,x,b,_,S,T,h,k,C;w>0?(x=i+w*(255-i),b=r-w*(r-0),S=c+w*(255-c),T=l-w*(l-0),k=p+w*(255-p),C=f-w*(f-0)):(y=(i+r)*.5,x=i+w*(i-y),b=r+w*(r-y),_=(c+l)*.5,S=c+w*(c-_),T=l+w*(l-_),h=(p+f)*.5,k=p+w*(p-h),C=f+w*(f-h));for(let N=0;N<n;N+=4)e[N+0]=u0(e[N+0],r,i,b,x),e[N+1]=u0(e[N+1],l,c,T,S),e[N+2]=u0(e[N+2],f,p,C,k)};Dd.Enhance=yb;F2.Factory.addGetterSetter(gb.Node,"enhance",0,(0,mb.getNumberValidator)(),F2.Factory.afterSetFilter);var zd={};Object.defineProperty(zd,"__esModule",{value:!0});zd.Grayscale=void 0;const vb=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4){const i=.34*e[r]+.5*e[r+1]+.16*e[r+2];e[r]=i,e[r+1]=i,e[r+2]=i}};zd.Grayscale=vb;var Bd={};Object.defineProperty(Bd,"__esModule",{value:!0});Bd.HSL=void 0;const jo=je,Rg=lt,Lg=Te;jo.Factory.addGetterSetter(Rg.Node,"hue",0,(0,Lg.getNumberValidator)(),jo.Factory.afterSetFilter);jo.Factory.addGetterSetter(Rg.Node,"saturation",0,(0,Lg.getNumberValidator)(),jo.Factory.afterSetFilter);jo.Factory.addGetterSetter(Rg.Node,"luminance",0,(0,Lg.getNumberValidator)(),jo.Factory.afterSetFilter);const xb=function(t){const e=t.data,n=e.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,l=this.luminance()*127,c=r*i*Math.cos(s*Math.PI/180),u=r*i*Math.sin(s*Math.PI/180),f=.299*r+.701*c+.167*u,p=.587*r-.587*c+.33*u,m=.114*r-.114*c-.497*u,w=.299*r-.299*c-.328*u,y=.587*r+.413*c+.035*u,x=.114*r-.114*c+.293*u,b=.299*r-.3*c+1.25*u,_=.587*r-.586*c-1.05*u,S=.114*r+.886*c-.2*u;let T,h,k,C;for(let N=0;N<n;N+=4)T=e[N+0],h=e[N+1],k=e[N+2],C=e[N+3],e[N+0]=f*T+p*h+m*k+l,e[N+1]=w*T+y*h+x*k+l,e[N+2]=b*T+_*h+S*k+l,e[N+3]=C};Bd.HSL=xb;var Ud={};Object.defineProperty(Ud,"__esModule",{value:!0});Ud.HSV=void 0;const Fo=je,jg=lt,Fg=Te,wb=function(t){const e=t.data,n=e.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,l=r*i*Math.cos(s*Math.PI/180),c=r*i*Math.sin(s*Math.PI/180),u=.299*r+.701*l+.167*c,f=.587*r-.587*l+.33*c,p=.114*r-.114*l-.497*c,m=.299*r-.299*l-.328*c,w=.587*r+.413*l+.035*c,y=.114*r-.114*l+.293*c,x=.299*r-.3*l+1.25*c,b=.587*r-.586*l-1.05*c,_=.114*r+.886*l-.2*c;let S,T,h,k;for(let C=0;C<n;C+=4)S=e[C+0],T=e[C+1],h=e[C+2],k=e[C+3],e[C+0]=u*S+f*T+p*h,e[C+1]=m*S+w*T+y*h,e[C+2]=x*S+b*T+_*h,e[C+3]=k};Ud.HSV=wb;Fo.Factory.addGetterSetter(jg.Node,"hue",0,(0,Fg.getNumberValidator)(),Fo.Factory.afterSetFilter);Fo.Factory.addGetterSetter(jg.Node,"saturation",0,(0,Fg.getNumberValidator)(),Fo.Factory.afterSetFilter);Fo.Factory.addGetterSetter(jg.Node,"value",0,(0,Fg.getNumberValidator)(),Fo.Factory.afterSetFilter);var Gd={};Object.defineProperty(Gd,"__esModule",{value:!0});Gd.Invert=void 0;const Sb=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]};Gd.Invert=Sb;var Vd={};Object.defineProperty(Vd,"__esModule",{value:!0});Vd.Kaleidoscope=void 0;const Vc=je,w4=lt,O2=pt,S4=Te,_b=function(t,e,n){const r=t.data,i=e.data,s=t.width,l=t.height,c=n.polarCenterX||s/2,u=n.polarCenterY||l/2;let f=Math.sqrt(c*c+u*u),p=s-c,m=l-u;const w=Math.sqrt(p*p+m*m);f=w>f?w:f;const y=l,x=s,b=360/x*Math.PI/180;for(let _=0;_<x;_+=1){const S=Math.sin(_*b),T=Math.cos(_*b);for(let h=0;h<y;h+=1){p=Math.floor(c+f*h/y*T),m=Math.floor(u+f*h/y*S);let k=(m*s+p)*4;const C=r[k+0],N=r[k+1],A=r[k+2],M=r[k+3];k=(_+h*s)*4,i[k+0]=C,i[k+1]=N,i[k+2]=A,i[k+3]=M}}},kb=function(t,e,n){const r=t.data,i=e.data,s=t.width,l=t.height,c=n.polarCenterX||s/2,u=n.polarCenterY||l/2;let f=Math.sqrt(c*c+u*u),p=s-c,m=l-u;const w=Math.sqrt(p*p+m*m);f=w>f?w:f;const y=l,x=s,b=n.polarRotation||0;let _,S;for(p=0;p<s;p+=1)for(m=0;m<l;m+=1){const T=p-c,h=m-u,k=Math.sqrt(T*T+h*h)*y/f;let C=(Math.atan2(h,T)*180/Math.PI+360+b)%360;C=C*x/360,_=Math.floor(C),S=Math.floor(k);let N=(S*s+_)*4;const A=r[N+0],M=r[N+1],R=r[N+2],I=r[N+3];N=(m*s+p)*4,i[N+0]=A,i[N+1]=M,i[N+2]=R,i[N+3]=I}},bb=function(t){const e=t.width,n=t.height;let r,i,s,l,c,u,f,p,m,w,y=Math.round(this.kaleidoscopePower());const x=Math.round(this.kaleidoscopeAngle()),b=Math.floor(e*(x%360)/360);if(y<1)return;const _=O2.Util.createCanvasElement();_.width=e,_.height=n;const S=_.getContext("2d").getImageData(0,0,e,n);O2.Util.releaseCanvas(_),_b(t,S,{polarCenterX:e/2,polarCenterY:n/2});let T=e/Math.pow(2,y);for(;T<=8;)T=T*2,y-=1;T=Math.ceil(T);let h=T,k=0,C=h,N=1;for(b+T>e&&(k=h,C=0,N=-1),i=0;i<n;i+=1)for(r=k;r!==C;r+=N)s=Math.round(r+b)%e,m=(e*i+s)*4,c=S.data[m+0],u=S.data[m+1],f=S.data[m+2],p=S.data[m+3],w=(e*i+r)*4,S.data[w+0]=c,S.data[w+1]=u,S.data[w+2]=f,S.data[w+3]=p;for(i=0;i<n;i+=1)for(h=Math.floor(T),l=0;l<y;l+=1){for(r=0;r<h+1;r+=1)m=(e*i+r)*4,c=S.data[m+0],u=S.data[m+1],f=S.data[m+2],p=S.data[m+3],w=(e*i+h*2-r-1)*4,S.data[w+0]=c,S.data[w+1]=u,S.data[w+2]=f,S.data[w+3]=p;h*=2}kb(S,t,{polarRotation:0})};Vd.Kaleidoscope=bb;Vc.Factory.addGetterSetter(w4.Node,"kaleidoscopePower",2,(0,S4.getNumberValidator)(),Vc.Factory.afterSetFilter);Vc.Factory.addGetterSetter(w4.Node,"kaleidoscopeAngle",0,(0,S4.getNumberValidator)(),Vc.Factory.afterSetFilter);var Wd={};Object.defineProperty(Wd,"__esModule",{value:!0});Wd.Mask=void 0;const D2=je,Cb=lt,Tb=Te;function Hu(t,e,n){let r=(n*t.width+e)*4;const i=[];return i.push(t.data[r++],t.data[r++],t.data[r++],t.data[r++]),i}function Aa(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function Eb(t){const e=[0,0,0];for(let n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function Nb(t,e){const n=Hu(t,0,0),r=Hu(t,t.width-1,0),i=Hu(t,0,t.height-1),s=Hu(t,t.width-1,t.height-1),l=e||10;if(Aa(n,r)<l&&Aa(r,s)<l&&Aa(s,i)<l&&Aa(i,n)<l){const c=Eb([r,n,s,i]),u=[];for(let f=0;f<t.width*t.height;f++){const p=Aa(c,[t.data[f*4],t.data[f*4+1],t.data[f*4+2]]);u[f]=p<l?0:255}return u}}function Pb(t,e){for(let n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}function Mb(t,e,n){const r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let p=0;for(let m=0;m<i;m++)for(let w=0;w<i;w++){const y=c+m-s,x=u+w-s;if(y>=0&&y<n&&x>=0&&x<e){const b=y*e+x,_=r[m*i+w];p+=t[b]*_}}l[f]=p===255*8?255:0}return l}function Ab(t,e,n){const r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let p=0;for(let m=0;m<i;m++)for(let w=0;w<i;w++){const y=c+m-s,x=u+w-s;if(y>=0&&y<n&&x>=0&&x<e){const b=y*e+x,_=r[m*i+w];p+=t[b]*_}}l[f]=p>=255*4?255:0}return l}function Ib(t,e,n){const r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let p=0;for(let m=0;m<i;m++)for(let w=0;w<i;w++){const y=c+m-s,x=u+w-s;if(y>=0&&y<n&&x>=0&&x<e){const b=y*e+x,_=r[m*i+w];p+=t[b]*_}}l[f]=p}return l}const Rb=function(t){const e=this.threshold();let n=Nb(t,e);return n&&(n=Mb(n,t.width,t.height),n=Ab(n,t.width,t.height),n=Ib(n,t.width,t.height),Pb(t,n)),t};Wd.Mask=Rb;D2.Factory.addGetterSetter(Cb.Node,"threshold",0,(0,Tb.getNumberValidator)(),D2.Factory.afterSetFilter);var $d={};Object.defineProperty($d,"__esModule",{value:!0});$d.Noise=void 0;const z2=je,Lb=lt,jb=Te,Fb=function(t){const e=this.noise()*255,n=t.data,r=n.length,i=e/2;for(let s=0;s<r;s+=4)n[s+0]+=i-2*i*Math.random(),n[s+1]+=i-2*i*Math.random(),n[s+2]+=i-2*i*Math.random()};$d.Noise=Fb;z2.Factory.addGetterSetter(Lb.Node,"noise",.2,(0,jb.getNumberValidator)(),z2.Factory.afterSetFilter);var Hd={};Object.defineProperty(Hd,"__esModule",{value:!0});Hd.Pixelate=void 0;const B2=je,Ob=pt,Db=lt,zb=Te,Bb=function(t){let e=Math.ceil(this.pixelSize()),n=t.width,r=t.height,i,s,l,c,u,f,p,m=Math.ceil(n/e),w=Math.ceil(r/e),y,x,b,_,S,T,h,k=t.data;if(e<=0){Ob.Util.error("pixelSize value can not be <= 0");return}for(S=0;S<m;S+=1)for(T=0;T<w;T+=1){for(c=0,u=0,f=0,p=0,y=S*e,x=y+e,b=T*e,_=b+e,h=0,i=y;i<x;i+=1)if(!(i>=n))for(s=b;s<_;s+=1)s>=r||(l=(n*s+i)*4,c+=k[l+0],u+=k[l+1],f+=k[l+2],p+=k[l+3],h+=1);for(c=c/h,u=u/h,f=f/h,p=p/h,i=y;i<x;i+=1)if(!(i>=n))for(s=b;s<_;s+=1)s>=r||(l=(n*s+i)*4,k[l+0]=c,k[l+1]=u,k[l+2]=f,k[l+3]=p)}};Hd.Pixelate=Bb;B2.Factory.addGetterSetter(Db.Node,"pixelSize",8,(0,zb.getNumberValidator)(),B2.Factory.afterSetFilter);var Yd={};Object.defineProperty(Yd,"__esModule",{value:!0});Yd.Posterize=void 0;const U2=je,Ub=lt,Gb=Te,Vb=function(t){const e=Math.round(this.levels()*254)+1,n=t.data,r=n.length,i=255/e;for(let s=0;s<r;s+=1)n[s]=Math.floor(n[s]/i)*i};Yd.Posterize=Vb;U2.Factory.addGetterSetter(Ub.Node,"levels",.5,(0,Gb.getNumberValidator)(),U2.Factory.afterSetFilter);var Xd={};Object.defineProperty(Xd,"__esModule",{value:!0});Xd.RGB=void 0;const Wc=je,Og=lt,Wb=Te,$b=function(t){const e=t.data,n=e.length,r=this.red(),i=this.green(),s=this.blue();for(let l=0;l<n;l+=4){const c=(.34*e[l]+.5*e[l+1]+.16*e[l+2])/255;e[l]=c*r,e[l+1]=c*i,e[l+2]=c*s,e[l+3]=e[l+3]}};Xd.RGB=$b;Wc.Factory.addGetterSetter(Og.Node,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});Wc.Factory.addGetterSetter(Og.Node,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});Wc.Factory.addGetterSetter(Og.Node,"blue",0,Wb.RGBComponent,Wc.Factory.afterSetFilter);var Kd={};Object.defineProperty(Kd,"__esModule",{value:!0});Kd.RGBA=void 0;const ml=je,Qd=lt,Hb=Te,Yb=function(t){const e=t.data,n=e.length,r=this.red(),i=this.green(),s=this.blue(),l=this.alpha();for(let c=0;c<n;c+=4){const u=1-l;e[c]=r*l+e[c]*u,e[c+1]=i*l+e[c+1]*u,e[c+2]=s*l+e[c+2]*u}};Kd.RGBA=Yb;ml.Factory.addGetterSetter(Qd.Node,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});ml.Factory.addGetterSetter(Qd.Node,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});ml.Factory.addGetterSetter(Qd.Node,"blue",0,Hb.RGBComponent,ml.Factory.afterSetFilter);ml.Factory.addGetterSetter(Qd.Node,"alpha",1,function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t});var Zd={};Object.defineProperty(Zd,"__esModule",{value:!0});Zd.Sepia=void 0;const Xb=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4){const i=e[r+0],s=e[r+1],l=e[r+2];e[r+0]=Math.min(255,i*.393+s*.769+l*.189),e[r+1]=Math.min(255,i*.349+s*.686+l*.168),e[r+2]=Math.min(255,i*.272+s*.534+l*.131)}};Zd.Sepia=Xb;var qd={};Object.defineProperty(qd,"__esModule",{value:!0});qd.Solarize=void 0;const Kb=function(t){const e=t.data,n=t.width,r=t.height,i=n*4;let s=r;do{const l=(s-1)*i;let c=n;do{const u=l+(c-1)*4;let f=e[u],p=e[u+1],m=e[u+2];f>127&&(f=255-f),p>127&&(p=255-p),m>127&&(m=255-m),e[u]=f,e[u+1]=p,e[u+2]=m}while(--c)}while(--s)};qd.Solarize=Kb;var Jd={};Object.defineProperty(Jd,"__esModule",{value:!0});Jd.Threshold=void 0;const G2=je,Qb=lt,Zb=Te,qb=function(t){const e=this.threshold()*255,n=t.data,r=n.length;for(let i=0;i<r;i+=1)n[i]=n[i]<e?0:255};Jd.Threshold=qb;G2.Factory.addGetterSetter(Qb.Node,"threshold",.5,(0,Zb.getNumberValidator)(),G2.Factory.afterSetFilter);Object.defineProperty(ud,"__esModule",{value:!0});ud.Konva=void 0;const V2=Bc,Jb=pd,eC=yd,tC=wd,nC=Sd,rC=_d,W2=Lo,iC=Pl,sC=Yo,oC=Al,aC=Cd,lC=Td,uC=Ed,cC=Nd,dC=Ko,fC=Pd,hC=Md,pC=Ad,gC=Rd,mC=Ld,yC=jd,vC=Fd,xC=Dd,wC=zd,SC=Bd,_C=Ud,kC=Gd,bC=Vd,CC=Wd,TC=$d,EC=Hd,NC=Yd,PC=Xd,MC=Kd,AC=Zd,IC=qd,RC=Jd;ud.Konva=V2.Konva.Util._assign(V2.Konva,{Arc:Jb.Arc,Arrow:eC.Arrow,Circle:tC.Circle,Ellipse:nC.Ellipse,Image:rC.Image,Label:W2.Label,Tag:W2.Tag,Line:iC.Line,Path:sC.Path,Rect:oC.Rect,RegularPolygon:aC.RegularPolygon,Ring:lC.Ring,Sprite:uC.Sprite,Star:cC.Star,Text:dC.Text,TextPath:fC.TextPath,Transformer:hC.Transformer,Wedge:pC.Wedge,Filters:{Blur:gC.Blur,Brighten:mC.Brighten,Contrast:yC.Contrast,Emboss:vC.Emboss,Enhance:xC.Enhance,Grayscale:wC.Grayscale,HSL:SC.HSL,HSV:_C.HSV,Invert:kC.Invert,Kaleidoscope:bC.Kaleidoscope,Mask:CC.Mask,Noise:TC.Noise,Pixelate:EC.Pixelate,Posterize:NC.Posterize,RGB:PC.RGB,RGBA:MC.RGBA,Sepia:AC.Sepia,Solarize:IC.Solarize,Threshold:RC.Threshold}});var LC=G5.exports;Object.defineProperty(LC,"__esModule",{value:!0});const jC=ud;G5.exports=jC.Konva;var kp={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var n=Bc;Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return n.Konva}});const r=Bc;t.exports=r.Konva})(kp,kp.exports);var FC=kp.exports;const yl=xl(FC);var _4={exports:{}};/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OC=function(e){var n={},r=O,i=Oa,s=Object.assign;function l(o){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),f=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),x=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),k=Symbol.for("react.offscreen"),C=Symbol.iterator;function N(o){return o===null||typeof o!="object"?null:(o=C&&o[C]||o["@@iterator"],typeof o=="function"?o:null)}function A(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case p:return"Fragment";case f:return"Portal";case w:return"Profiler";case m:return"StrictMode";case _:return"Suspense";case S:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case x:return(o.displayName||"Context")+".Consumer";case y:return(o._context.displayName||"Context")+".Provider";case b:var a=o.render;return o=o.displayName,o||(o=a.displayName||a.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case T:return a=o.displayName||null,a!==null?a:A(o.type)||"Memo";case h:a=o._payload,o=o._init;try{return A(o(a))}catch{}}return null}function M(o){var a=o.type;switch(o.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=a.render,o=o.displayName||o.name||"",a.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return A(a);case 8:return a===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function R(o){var a=o,d=o;if(o.alternate)for(;a.return;)a=a.return;else{o=a;do a=o,a.flags&4098&&(d=a.return),o=a.return;while(o)}return a.tag===3?d:null}function I(o){if(R(o)!==o)throw Error(l(188))}function j(o){var a=o.alternate;if(!a){if(a=R(o),a===null)throw Error(l(188));return a!==o?null:o}for(var d=o,g=a;;){var v=d.return;if(v===null)break;var P=v.alternate;if(P===null){if(g=v.return,g!==null){d=g;continue}break}if(v.child===P.child){for(P=v.child;P;){if(P===d)return I(v),o;if(P===g)return I(v),a;P=P.sibling}throw Error(l(188))}if(d.return!==g.return)d=v,g=P;else{for(var L=!1,$=v.child;$;){if($===d){L=!0,d=v,g=P;break}if($===g){L=!0,g=v,d=P;break}$=$.sibling}if(!L){for($=P.child;$;){if($===d){L=!0,d=P,g=v;break}if($===g){L=!0,g=P,d=v;break}$=$.sibling}if(!L)throw Error(l(189))}}if(d.alternate!==g)throw Error(l(190))}if(d.tag!==3)throw Error(l(188));return d.stateNode.current===d?o:a}function z(o){return o=j(o),o!==null?W(o):null}function W(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var a=W(o);if(a!==null)return a;o=o.sibling}return null}function V(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){if(o.tag!==4){var a=V(o);if(a!==null)return a}o=o.sibling}return null}var D=Array.isArray,U=e.getPublicInstance,G=e.getRootHostContext,F=e.getChildHostContext,Y=e.prepareForCommit,X=e.resetAfterCommit,te=e.createInstance,K=e.appendInitialChild,ee=e.finalizeInitialChildren,ne=e.prepareUpdate,ce=e.shouldSetTextContent,de=e.createTextInstance,B=e.scheduleTimeout,Q=e.cancelTimeout,re=e.noTimeout,ie=e.isPrimaryRenderer,oe=e.supportsMutation,fe=e.supportsPersistence,pe=e.supportsHydration,Pe=e.getInstanceFromNode,Ce=e.preparePortalMount,$e=e.getCurrentEventPriority,We=e.detachDeletedInstance,xt=e.supportsMicrotasks,Dt=e.scheduleMicrotask,Yt=e.supportsTestSelectors,rt=e.findFiberRoot,Fn=e.getBoundingRect,On=e.getTextContent,it=e.isHiddenSubtree,hi=e.matchAccessibilityRole,pi=e.setFocusIfFocusable,zr=e.setupIntersectionObserver,Br=e.appendChild,gt=e.appendChildToContainer,dn=e.commitTextUpdate,Ur=e.commitMount,Ee=e.commitUpdate,se=e.insertBefore,le=e.insertInContainerBefore,he=e.removeChild,_e=e.removeChildFromContainer,ke=e.resetTextContent,ye=e.hideInstance,qe=e.hideTextInstance,fn=e.unhideInstance,hn=e.unhideTextInstance,gi=e.clearContainer,wr=e.cloneInstance,is=e.createContainerChildSet,Sr=e.appendChildToContainerChildSet,En=e.finalizeContainerChildren,Qo=e.replaceContainerChildren,Vg=e.cloneHiddenInstance,Wg=e.cloneHiddenTextInstance,F4=e.canHydrateInstance,O4=e.canHydrateTextInstance,D4=e.canHydrateSuspenseInstance,$g=e.isSuspenseInstancePending,nf=e.isSuspenseInstanceFallback,z4=e.getSuspenseInstanceFallbackErrorDetails,B4=e.registerSuspenseInstanceRetry,Il=e.getNextHydratableSibling,U4=e.getFirstHydratableChild,G4=e.getFirstHydratableChildWithinContainer,V4=e.getFirstHydratableChildWithinSuspenseInstance,W4=e.hydrateInstance,$4=e.hydrateTextInstance,H4=e.hydrateSuspenseInstance,Y4=e.getNextHydratableInstanceAfterSuspenseInstance,X4=e.commitHydratedContainer,K4=e.commitHydratedSuspenseInstance,Q4=e.clearSuspenseBoundary,Z4=e.clearSuspenseBoundaryFromContainer,q4=e.shouldDeleteUnhydratedTailInstances,J4=e.didNotMatchHydratedContainerTextInstance,ex=e.didNotMatchHydratedTextInstance,rf;function Zo(o){if(rf===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);rf=a&&a[1]||""}return`
`+rf+o}var sf=!1;function of(o,a){if(!o||sf)return"";sf=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(ue){var g=ue}Reflect.construct(o,[],a)}else{try{a.call()}catch(ue){g=ue}o.call(a.prototype)}else{try{throw Error()}catch(ue){g=ue}o()}}catch(ue){if(ue&&g&&typeof ue.stack=="string"){for(var v=ue.stack.split(`
`),P=g.stack.split(`
`),L=v.length-1,$=P.length-1;1<=L&&0<=$&&v[L]!==P[$];)$--;for(;1<=L&&0<=$;L--,$--)if(v[L]!==P[$]){if(L!==1||$!==1)do if(L--,$--,0>$||v[L]!==P[$]){var q=`
`+v[L].replace(" at new "," at ");return o.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",o.displayName)),q}while(1<=L&&0<=$);break}}}finally{sf=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?Zo(o):""}var tx=Object.prototype.hasOwnProperty,af=[],Bs=-1;function mi(o){return{current:o}}function Je(o){0>Bs||(o.current=af[Bs],af[Bs]=null,Bs--)}function Qe(o,a){Bs++,af[Bs]=o.current,o.current=a}var yi={},Xt=mi(yi),pn=mi(!1),ss=yi;function Us(o,a){var d=o.type.contextTypes;if(!d)return yi;var g=o.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===a)return g.__reactInternalMemoizedMaskedChildContext;var v={},P;for(P in d)v[P]=a[P];return g&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=a,o.__reactInternalMemoizedMaskedChildContext=v),v}function gn(o){return o=o.childContextTypes,o!=null}function Rl(){Je(pn),Je(Xt)}function Hg(o,a,d){if(Xt.current!==yi)throw Error(l(168));Qe(Xt,a),Qe(pn,d)}function Yg(o,a,d){var g=o.stateNode;if(a=a.childContextTypes,typeof g.getChildContext!="function")return d;g=g.getChildContext();for(var v in g)if(!(v in a))throw Error(l(108,M(o)||"Unknown",v));return s({},d,g)}function Ll(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||yi,ss=Xt.current,Qe(Xt,o),Qe(pn,pn.current),!0}function Xg(o,a,d){var g=o.stateNode;if(!g)throw Error(l(169));d?(o=Yg(o,a,ss),g.__reactInternalMemoizedMergedChildContext=o,Je(pn),Je(Xt),Qe(Xt,o)):Je(pn),Qe(pn,d)}var nr=Math.clz32?Math.clz32:ix,nx=Math.log,rx=Math.LN2;function ix(o){return o>>>=0,o===0?32:31-(nx(o)/rx|0)|0}var jl=64,Fl=4194304;function qo(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function Ol(o,a){var d=o.pendingLanes;if(d===0)return 0;var g=0,v=o.suspendedLanes,P=o.pingedLanes,L=d&268435455;if(L!==0){var $=L&~v;$!==0?g=qo($):(P&=L,P!==0&&(g=qo(P)))}else L=d&~v,L!==0?g=qo(L):P!==0&&(g=qo(P));if(g===0)return 0;if(a!==0&&a!==g&&!(a&v)&&(v=g&-g,P=a&-a,v>=P||v===16&&(P&4194240)!==0))return a;if(g&4&&(g|=d&16),a=o.entangledLanes,a!==0)for(o=o.entanglements,a&=g;0<a;)d=31-nr(a),v=1<<d,g|=o[d],a&=~v;return g}function sx(o,a){switch(o){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ox(o,a){for(var d=o.suspendedLanes,g=o.pingedLanes,v=o.expirationTimes,P=o.pendingLanes;0<P;){var L=31-nr(P),$=1<<L,q=v[L];q===-1?(!($&d)||$&g)&&(v[L]=sx($,a)):q<=a&&(o.expiredLanes|=$),P&=~$}}function lf(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Kg(){var o=jl;return jl<<=1,!(jl&4194240)&&(jl=64),o}function uf(o){for(var a=[],d=0;31>d;d++)a.push(o);return a}function Jo(o,a,d){o.pendingLanes|=a,a!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,a=31-nr(a),o[a]=d}function ax(o,a){var d=o.pendingLanes&~a;o.pendingLanes=a,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=a,o.mutableReadLanes&=a,o.entangledLanes&=a,a=o.entanglements;var g=o.eventTimes;for(o=o.expirationTimes;0<d;){var v=31-nr(d),P=1<<v;a[v]=0,g[v]=-1,o[v]=-1,d&=~P}}function cf(o,a){var d=o.entangledLanes|=a;for(o=o.entanglements;d;){var g=31-nr(d),v=1<<g;v&a|o[g]&a&&(o[g]|=a),d&=~v}}var Be=0;function Qg(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var df=i.unstable_scheduleCallback,Zg=i.unstable_cancelCallback,lx=i.unstable_shouldYield,ux=i.unstable_requestPaint,It=i.unstable_now,ff=i.unstable_ImmediatePriority,cx=i.unstable_UserBlockingPriority,hf=i.unstable_NormalPriority,dx=i.unstable_IdlePriority,Dl=null,_r=null;function fx(o){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(Dl,o,void 0,(o.current.flags&128)===128)}catch{}}function hx(o,a){return o===a&&(o!==0||1/o===1/a)||o!==o&&a!==a}var rr=typeof Object.is=="function"?Object.is:hx,Gr=null,zl=!1,pf=!1;function qg(o){Gr===null?Gr=[o]:Gr.push(o)}function px(o){zl=!0,qg(o)}function kr(){if(!pf&&Gr!==null){pf=!0;var o=0,a=Be;try{var d=Gr;for(Be=1;o<d.length;o++){var g=d[o];do g=g(!0);while(g!==null)}Gr=null,zl=!1}catch(v){throw Gr!==null&&(Gr=Gr.slice(o+1)),df(ff,kr),v}finally{Be=a,pf=!1}}return null}var Gs=[],Vs=0,Bl=null,Ul=0,Dn=[],zn=0,os=null,Vr=1,Wr="";function as(o,a){Gs[Vs++]=Ul,Gs[Vs++]=Bl,Bl=o,Ul=a}function Jg(o,a,d){Dn[zn++]=Vr,Dn[zn++]=Wr,Dn[zn++]=os,os=o;var g=Vr;o=Wr;var v=32-nr(g)-1;g&=~(1<<v),d+=1;var P=32-nr(a)+v;if(30<P){var L=v-v%5;P=(g&(1<<L)-1).toString(32),g>>=L,v-=L,Vr=1<<32-nr(a)+v|d<<v|g,Wr=P+o}else Vr=1<<P|d<<v|g,Wr=o}function gf(o){o.return!==null&&(as(o,1),Jg(o,1,0))}function mf(o){for(;o===Bl;)Bl=Gs[--Vs],Gs[Vs]=null,Ul=Gs[--Vs],Gs[Vs]=null;for(;o===os;)os=Dn[--zn],Dn[zn]=null,Wr=Dn[--zn],Dn[zn]=null,Vr=Dn[--zn],Dn[zn]=null}var Nn=null,Bn=null,st=!1,ea=!1,ir=null;function em(o,a){var d=$n(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=o,a=o.deletions,a===null?(o.deletions=[d],o.flags|=16):a.push(d)}function tm(o,a){switch(o.tag){case 5:return a=F4(a,o.type,o.pendingProps),a!==null?(o.stateNode=a,Nn=o,Bn=U4(a),!0):!1;case 6:return a=O4(a,o.pendingProps),a!==null?(o.stateNode=a,Nn=o,Bn=null,!0):!1;case 13:if(a=D4(a),a!==null){var d=os!==null?{id:Vr,overflow:Wr}:null;return o.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=$n(18,null,null,0),d.stateNode=a,d.return=o,o.child=d,Nn=o,Bn=null,!0}return!1;default:return!1}}function yf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function vf(o){if(st){var a=Bn;if(a){var d=a;if(!tm(o,a)){if(yf(o))throw Error(l(418));a=Il(d);var g=Nn;a&&tm(o,a)?em(g,d):(o.flags=o.flags&-4097|2,st=!1,Nn=o)}}else{if(yf(o))throw Error(l(418));o.flags=o.flags&-4097|2,st=!1,Nn=o}}}function nm(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Nn=o}function Gl(o){if(!pe||o!==Nn)return!1;if(!st)return nm(o),st=!0,!1;if(o.tag!==3&&(o.tag!==5||q4(o.type)&&!ce(o.type,o.memoizedProps))){var a=Bn;if(a){if(yf(o))throw rm(),Error(l(418));for(;a;)em(o,a),a=Il(a)}}if(nm(o),o.tag===13){if(!pe)throw Error(l(316));if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(l(317));Bn=Y4(o)}else Bn=Nn?Il(o.stateNode):null;return!0}function rm(){for(var o=Bn;o;)o=Il(o)}function Ws(){pe&&(Bn=Nn=null,ea=st=!1)}function xf(o){ir===null?ir=[o]:ir.push(o)}var gx=c.ReactCurrentBatchConfig;function Vl(o,a){if(rr(o,a))return!0;if(typeof o!="object"||o===null||typeof a!="object"||a===null)return!1;var d=Object.keys(o),g=Object.keys(a);if(d.length!==g.length)return!1;for(g=0;g<d.length;g++){var v=d[g];if(!tx.call(a,v)||!rr(o[v],a[v]))return!1}return!0}function mx(o){switch(o.tag){case 5:return Zo(o.type);case 16:return Zo("Lazy");case 13:return Zo("Suspense");case 19:return Zo("SuspenseList");case 0:case 2:case 15:return o=of(o.type,!1),o;case 11:return o=of(o.type.render,!1),o;case 1:return o=of(o.type,!0),o;default:return""}}function ta(o,a,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(l(309));var g=d.stateNode}if(!g)throw Error(l(147,o));var v=g,P=""+o;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===P?a.ref:(a=function(L){var $=v.refs;L===null?delete $[P]:$[P]=L},a._stringRef=P,a)}if(typeof o!="string")throw Error(l(284));if(!d._owner)throw Error(l(290,o))}return o}function Wl(o,a){throw o=Object.prototype.toString.call(a),Error(l(31,o==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":o))}function im(o){var a=o._init;return a(o._payload)}function sm(o){function a(Z,H){if(o){var J=Z.deletions;J===null?(Z.deletions=[H],Z.flags|=16):J.push(H)}}function d(Z,H){if(!o)return null;for(;H!==null;)a(Z,H),H=H.sibling;return null}function g(Z,H){for(Z=new Map;H!==null;)H.key!==null?Z.set(H.key,H):Z.set(H.index,H),H=H.sibling;return Z}function v(Z,H){return Z=bi(Z,H),Z.index=0,Z.sibling=null,Z}function P(Z,H,J){return Z.index=J,o?(J=Z.alternate,J!==null?(J=J.index,J<H?(Z.flags|=2,H):J):(Z.flags|=2,H)):(Z.flags|=1048576,H)}function L(Z){return o&&Z.alternate===null&&(Z.flags|=2),Z}function $(Z,H,J,me){return H===null||H.tag!==6?(H=ph(J,Z.mode,me),H.return=Z,H):(H=v(H,J),H.return=Z,H)}function q(Z,H,J,me){var be=J.type;return be===p?Se(Z,H,J.props.children,me,J.key):H!==null&&(H.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===h&&im(be)===H.type)?(me=v(H,J.props),me.ref=ta(Z,H,J),me.return=Z,me):(me=Su(J.type,J.key,J.props,null,Z.mode,me),me.ref=ta(Z,H,J),me.return=Z,me)}function ue(Z,H,J,me){return H===null||H.tag!==4||H.stateNode.containerInfo!==J.containerInfo||H.stateNode.implementation!==J.implementation?(H=gh(J,Z.mode,me),H.return=Z,H):(H=v(H,J.children||[]),H.return=Z,H)}function Se(Z,H,J,me,be){return H===null||H.tag!==7?(H=ps(J,Z.mode,me,be),H.return=Z,H):(H=v(H,J),H.return=Z,H)}function Me(Z,H,J){if(typeof H=="string"&&H!==""||typeof H=="number")return H=ph(""+H,Z.mode,J),H.return=Z,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case u:return J=Su(H.type,H.key,H.props,null,Z.mode,J),J.ref=ta(Z,null,H),J.return=Z,J;case f:return H=gh(H,Z.mode,J),H.return=Z,H;case h:var me=H._init;return Me(Z,me(H._payload),J)}if(D(H)||N(H))return H=ps(H,Z.mode,J,null),H.return=Z,H;Wl(Z,H)}return null}function ge(Z,H,J,me){var be=H!==null?H.key:null;if(typeof J=="string"&&J!==""||typeof J=="number")return be!==null?null:$(Z,H,""+J,me);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case u:return J.key===be?q(Z,H,J,me):null;case f:return J.key===be?ue(Z,H,J,me):null;case h:return be=J._init,ge(Z,H,be(J._payload),me)}if(D(J)||N(J))return be!==null?null:Se(Z,H,J,me,null);Wl(Z,J)}return null}function et(Z,H,J,me,be){if(typeof me=="string"&&me!==""||typeof me=="number")return Z=Z.get(J)||null,$(H,Z,""+me,be);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case u:return Z=Z.get(me.key===null?J:me.key)||null,q(H,Z,me,be);case f:return Z=Z.get(me.key===null?J:me.key)||null,ue(H,Z,me,be);case h:var Ie=me._init;return et(Z,H,J,Ie(me._payload),be)}if(D(me)||N(me))return Z=Z.get(J)||null,Se(H,Z,me,be,null);Wl(H,me)}return null}function Xe(Z,H,J,me){for(var be=null,Ie=null,Ae=H,Ue=H=0,jt=null;Ae!==null&&Ue<J.length;Ue++){Ae.index>Ue?(jt=Ae,Ae=null):jt=Ae.sibling;var Ge=ge(Z,Ae,J[Ue],me);if(Ge===null){Ae===null&&(Ae=jt);break}o&&Ae&&Ge.alternate===null&&a(Z,Ae),H=P(Ge,H,Ue),Ie===null?be=Ge:Ie.sibling=Ge,Ie=Ge,Ae=jt}if(Ue===J.length)return d(Z,Ae),st&&as(Z,Ue),be;if(Ae===null){for(;Ue<J.length;Ue++)Ae=Me(Z,J[Ue],me),Ae!==null&&(H=P(Ae,H,Ue),Ie===null?be=Ae:Ie.sibling=Ae,Ie=Ae);return st&&as(Z,Ue),be}for(Ae=g(Z,Ae);Ue<J.length;Ue++)jt=et(Ae,Z,Ue,J[Ue],me),jt!==null&&(o&&jt.alternate!==null&&Ae.delete(jt.key===null?Ue:jt.key),H=P(jt,H,Ue),Ie===null?be=jt:Ie.sibling=jt,Ie=jt);return o&&Ae.forEach(function(Ci){return a(Z,Ci)}),st&&as(Z,Ue),be}function xn(Z,H,J,me){var be=N(J);if(typeof be!="function")throw Error(l(150));if(J=be.call(J),J==null)throw Error(l(151));for(var Ie=be=null,Ae=H,Ue=H=0,jt=null,Ge=J.next();Ae!==null&&!Ge.done;Ue++,Ge=J.next()){Ae.index>Ue?(jt=Ae,Ae=null):jt=Ae.sibling;var Ci=ge(Z,Ae,Ge.value,me);if(Ci===null){Ae===null&&(Ae=jt);break}o&&Ae&&Ci.alternate===null&&a(Z,Ae),H=P(Ci,H,Ue),Ie===null?be=Ci:Ie.sibling=Ci,Ie=Ci,Ae=jt}if(Ge.done)return d(Z,Ae),st&&as(Z,Ue),be;if(Ae===null){for(;!Ge.done;Ue++,Ge=J.next())Ge=Me(Z,Ge.value,me),Ge!==null&&(H=P(Ge,H,Ue),Ie===null?be=Ge:Ie.sibling=Ge,Ie=Ge);return st&&as(Z,Ue),be}for(Ae=g(Z,Ae);!Ge.done;Ue++,Ge=J.next())Ge=et(Ae,Z,Ue,Ge.value,me),Ge!==null&&(o&&Ge.alternate!==null&&Ae.delete(Ge.key===null?Ue:Ge.key),H=P(Ge,H,Ue),Ie===null?be=Ge:Ie.sibling=Ge,Ie=Ge);return o&&Ae.forEach(function(Hx){return a(Z,Hx)}),st&&as(Z,Ue),be}function Xr(Z,H,J,me){if(typeof J=="object"&&J!==null&&J.type===p&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case u:e:{for(var be=J.key,Ie=H;Ie!==null;){if(Ie.key===be){if(be=J.type,be===p){if(Ie.tag===7){d(Z,Ie.sibling),H=v(Ie,J.props.children),H.return=Z,Z=H;break e}}else if(Ie.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===h&&im(be)===Ie.type){d(Z,Ie.sibling),H=v(Ie,J.props),H.ref=ta(Z,Ie,J),H.return=Z,Z=H;break e}d(Z,Ie);break}else a(Z,Ie);Ie=Ie.sibling}J.type===p?(H=ps(J.props.children,Z.mode,me,J.key),H.return=Z,Z=H):(me=Su(J.type,J.key,J.props,null,Z.mode,me),me.ref=ta(Z,H,J),me.return=Z,Z=me)}return L(Z);case f:e:{for(Ie=J.key;H!==null;){if(H.key===Ie)if(H.tag===4&&H.stateNode.containerInfo===J.containerInfo&&H.stateNode.implementation===J.implementation){d(Z,H.sibling),H=v(H,J.children||[]),H.return=Z,Z=H;break e}else{d(Z,H);break}else a(Z,H);H=H.sibling}H=gh(J,Z.mode,me),H.return=Z,Z=H}return L(Z);case h:return Ie=J._init,Xr(Z,H,Ie(J._payload),me)}if(D(J))return Xe(Z,H,J,me);if(N(J))return xn(Z,H,J,me);Wl(Z,J)}return typeof J=="string"&&J!==""||typeof J=="number"?(J=""+J,H!==null&&H.tag===6?(d(Z,H.sibling),H=v(H,J),H.return=Z,Z=H):(d(Z,H),H=ph(J,Z.mode,me),H.return=Z,Z=H),L(Z)):d(Z,H)}return Xr}var $s=sm(!0),om=sm(!1),$l=mi(null),Hl=null,Hs=null,wf=null;function Sf(){wf=Hs=Hl=null}function am(o,a,d){ie?(Qe($l,a._currentValue),a._currentValue=d):(Qe($l,a._currentValue2),a._currentValue2=d)}function _f(o){var a=$l.current;Je($l),ie?o._currentValue=a:o._currentValue2=a}function kf(o,a,d){for(;o!==null;){var g=o.alternate;if((o.childLanes&a)!==a?(o.childLanes|=a,g!==null&&(g.childLanes|=a)):g!==null&&(g.childLanes&a)!==a&&(g.childLanes|=a),o===d)break;o=o.return}}function Ys(o,a){Hl=o,wf=Hs=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&a&&(mn=!0),o.firstContext=null)}function Un(o){var a=ie?o._currentValue:o._currentValue2;if(wf!==o)if(o={context:o,memoizedValue:a,next:null},Hs===null){if(Hl===null)throw Error(l(308));Hs=o,Hl.dependencies={lanes:0,firstContext:o}}else Hs=Hs.next=o;return a}var ls=null;function bf(o){ls===null?ls=[o]:ls.push(o)}function lm(o,a,d,g){var v=a.interleaved;return v===null?(d.next=d,bf(a)):(d.next=v.next,v.next=d),a.interleaved=d,br(o,g)}function br(o,a){o.lanes|=a;var d=o.alternate;for(d!==null&&(d.lanes|=a),d=o,o=o.return;o!==null;)o.childLanes|=a,d=o.alternate,d!==null&&(d.childLanes|=a),d=o,o=o.return;return d.tag===3?d.stateNode:null}var vi=!1;function Cf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function um(o,a){o=o.updateQueue,a.updateQueue===o&&(a.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function $r(o,a){return{eventTime:o,lane:a,tag:0,payload:null,callback:null,next:null}}function xi(o,a,d){var g=o.updateQueue;if(g===null)return null;if(g=g.shared,Le&2){var v=g.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),g.pending=a,br(o,d)}return v=g.interleaved,v===null?(a.next=a,bf(g)):(a.next=v.next,v.next=a),g.interleaved=a,br(o,d)}function Yl(o,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var g=a.lanes;g&=o.pendingLanes,d|=g,a.lanes=d,cf(o,d)}}function cm(o,a){var d=o.updateQueue,g=o.alternate;if(g!==null&&(g=g.updateQueue,d===g)){var v=null,P=null;if(d=d.firstBaseUpdate,d!==null){do{var L={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};P===null?v=P=L:P=P.next=L,d=d.next}while(d!==null);P===null?v=P=a:P=P.next=a}else v=P=a;d={baseState:g.baseState,firstBaseUpdate:v,lastBaseUpdate:P,shared:g.shared,effects:g.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=a:o.next=a,d.lastBaseUpdate=a}function Xl(o,a,d,g){var v=o.updateQueue;vi=!1;var P=v.firstBaseUpdate,L=v.lastBaseUpdate,$=v.shared.pending;if($!==null){v.shared.pending=null;var q=$,ue=q.next;q.next=null,L===null?P=ue:L.next=ue,L=q;var Se=o.alternate;Se!==null&&(Se=Se.updateQueue,$=Se.lastBaseUpdate,$!==L&&($===null?Se.firstBaseUpdate=ue:$.next=ue,Se.lastBaseUpdate=q))}if(P!==null){var Me=v.baseState;L=0,Se=ue=q=null,$=P;do{var ge=$.lane,et=$.eventTime;if((g&ge)===ge){Se!==null&&(Se=Se.next={eventTime:et,lane:0,tag:$.tag,payload:$.payload,callback:$.callback,next:null});e:{var Xe=o,xn=$;switch(ge=a,et=d,xn.tag){case 1:if(Xe=xn.payload,typeof Xe=="function"){Me=Xe.call(et,Me,ge);break e}Me=Xe;break e;case 3:Xe.flags=Xe.flags&-65537|128;case 0:if(Xe=xn.payload,ge=typeof Xe=="function"?Xe.call(et,Me,ge):Xe,ge==null)break e;Me=s({},Me,ge);break e;case 2:vi=!0}}$.callback!==null&&$.lane!==0&&(o.flags|=64,ge=v.effects,ge===null?v.effects=[$]:ge.push($))}else et={eventTime:et,lane:ge,tag:$.tag,payload:$.payload,callback:$.callback,next:null},Se===null?(ue=Se=et,q=Me):Se=Se.next=et,L|=ge;if($=$.next,$===null){if($=v.shared.pending,$===null)break;ge=$,$=ge.next,ge.next=null,v.lastBaseUpdate=ge,v.shared.pending=null}}while(1);if(Se===null&&(q=Me),v.baseState=q,v.firstBaseUpdate=ue,v.lastBaseUpdate=Se,a=v.shared.interleaved,a!==null){v=a;do L|=v.lane,v=v.next;while(v!==a)}else P===null&&(v.shared.lanes=0);cs|=L,o.lanes=L,o.memoizedState=Me}}function dm(o,a,d){if(o=a.effects,a.effects=null,o!==null)for(a=0;a<o.length;a++){var g=o[a],v=g.callback;if(v!==null){if(g.callback=null,g=d,typeof v!="function")throw Error(l(191,v));v.call(g)}}}var na={},Gn=mi(na),ra=mi(na),Xs=mi(na);function Cr(o){if(o===na)throw Error(l(174));return o}function Tf(o,a){Qe(Xs,a),Qe(ra,o),Qe(Gn,na),o=G(a),Je(Gn),Qe(Gn,o)}function Ks(){Je(Gn),Je(ra),Je(Xs)}function fm(o){var a=Cr(Xs.current),d=Cr(Gn.current);a=F(d,o.type,a),d!==a&&(Qe(ra,o),Qe(Gn,a))}function Ef(o){ra.current===o&&(Je(Gn),Je(ra))}var ut=mi(0);function Kl(o){for(var a=o;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||$g(d)||nf(d)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Nf=[];function Pf(){for(var o=0;o<Nf.length;o++){var a=Nf[o];ie?a._workInProgressVersionPrimary=null:a._workInProgressVersionSecondary=null}Nf.length=0}var Ql=c.ReactCurrentDispatcher,Mf=c.ReactCurrentBatchConfig,us=0,ct=null,Ct=null,Rt=null,Zl=!1,ia=!1,sa=0,yx=0;function Kt(){throw Error(l(321))}function Af(o,a){if(a===null)return!1;for(var d=0;d<a.length&&d<o.length;d++)if(!rr(o[d],a[d]))return!1;return!0}function If(o,a,d,g,v,P){if(us=P,ct=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Ql.current=o===null||o.memoizedState===null?Sx:_x,o=d(g,v),ia){P=0;do{if(ia=!1,sa=0,25<=P)throw Error(l(301));P+=1,Rt=Ct=null,a.updateQueue=null,Ql.current=kx,o=d(g,v)}while(ia)}if(Ql.current=eu,a=Ct!==null&&Ct.next!==null,us=0,Rt=Ct=ct=null,Zl=!1,a)throw Error(l(300));return o}function Rf(){var o=sa!==0;return sa=0,o}function Tr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?ct.memoizedState=Rt=o:Rt=Rt.next=o,Rt}function Vn(){if(Ct===null){var o=ct.alternate;o=o!==null?o.memoizedState:null}else o=Ct.next;var a=Rt===null?ct.memoizedState:Rt.next;if(a!==null)Rt=a,Ct=o;else{if(o===null)throw Error(l(310));Ct=o,o={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},Rt===null?ct.memoizedState=Rt=o:Rt=Rt.next=o}return Rt}function oa(o,a){return typeof a=="function"?a(o):a}function Lf(o){var a=Vn(),d=a.queue;if(d===null)throw Error(l(311));d.lastRenderedReducer=o;var g=Ct,v=g.baseQueue,P=d.pending;if(P!==null){if(v!==null){var L=v.next;v.next=P.next,P.next=L}g.baseQueue=v=P,d.pending=null}if(v!==null){P=v.next,g=g.baseState;var $=L=null,q=null,ue=P;do{var Se=ue.lane;if((us&Se)===Se)q!==null&&(q=q.next={lane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),g=ue.hasEagerState?ue.eagerState:o(g,ue.action);else{var Me={lane:Se,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null};q===null?($=q=Me,L=g):q=q.next=Me,ct.lanes|=Se,cs|=Se}ue=ue.next}while(ue!==null&&ue!==P);q===null?L=g:q.next=$,rr(g,a.memoizedState)||(mn=!0),a.memoizedState=g,a.baseState=L,a.baseQueue=q,d.lastRenderedState=g}if(o=d.interleaved,o!==null){v=o;do P=v.lane,ct.lanes|=P,cs|=P,v=v.next;while(v!==o)}else v===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function jf(o){var a=Vn(),d=a.queue;if(d===null)throw Error(l(311));d.lastRenderedReducer=o;var g=d.dispatch,v=d.pending,P=a.memoizedState;if(v!==null){d.pending=null;var L=v=v.next;do P=o(P,L.action),L=L.next;while(L!==v);rr(P,a.memoizedState)||(mn=!0),a.memoizedState=P,a.baseQueue===null&&(a.baseState=P),d.lastRenderedState=P}return[P,g]}function hm(){}function pm(o,a){var d=ct,g=Vn(),v=a(),P=!rr(g.memoizedState,v);if(P&&(g.memoizedState=v,mn=!0),g=g.queue,Ff(ym.bind(null,d,g,o),[o]),g.getSnapshot!==a||P||Rt!==null&&Rt.memoizedState.tag&1){if(d.flags|=2048,aa(9,mm.bind(null,d,g,v,a),void 0,null),Lt===null)throw Error(l(349));us&30||gm(d,a,v)}return v}function gm(o,a,d){o.flags|=16384,o={getSnapshot:a,value:d},a=ct.updateQueue,a===null?(a={lastEffect:null,stores:null},ct.updateQueue=a,a.stores=[o]):(d=a.stores,d===null?a.stores=[o]:d.push(o))}function mm(o,a,d,g){a.value=d,a.getSnapshot=g,vm(a)&&xm(o)}function ym(o,a,d){return d(function(){vm(a)&&xm(o)})}function vm(o){var a=o.getSnapshot;o=o.value;try{var d=a();return!rr(o,d)}catch{return!0}}function xm(o){var a=br(o,1);a!==null&&Wn(a,o,1,-1)}function wm(o){var a=Tr();return typeof o=="function"&&(o=o()),a.memoizedState=a.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:oa,lastRenderedState:o},a.queue=o,o=o.dispatch=wx.bind(null,ct,o),[a.memoizedState,o]}function aa(o,a,d,g){return o={tag:o,create:a,destroy:d,deps:g,next:null},a=ct.updateQueue,a===null?(a={lastEffect:null,stores:null},ct.updateQueue=a,a.lastEffect=o.next=o):(d=a.lastEffect,d===null?a.lastEffect=o.next=o:(g=d.next,d.next=o,o.next=g,a.lastEffect=o)),o}function Sm(){return Vn().memoizedState}function ql(o,a,d,g){var v=Tr();ct.flags|=o,v.memoizedState=aa(1|a,d,void 0,g===void 0?null:g)}function Jl(o,a,d,g){var v=Vn();g=g===void 0?null:g;var P=void 0;if(Ct!==null){var L=Ct.memoizedState;if(P=L.destroy,g!==null&&Af(g,L.deps)){v.memoizedState=aa(a,d,P,g);return}}ct.flags|=o,v.memoizedState=aa(1|a,d,P,g)}function _m(o,a){return ql(8390656,8,o,a)}function Ff(o,a){return Jl(2048,8,o,a)}function km(o,a){return Jl(4,2,o,a)}function bm(o,a){return Jl(4,4,o,a)}function Cm(o,a){if(typeof a=="function")return o=o(),a(o),function(){a(null)};if(a!=null)return o=o(),a.current=o,function(){a.current=null}}function Tm(o,a,d){return d=d!=null?d.concat([o]):null,Jl(4,4,Cm.bind(null,a,o),d)}function Of(){}function Em(o,a){var d=Vn();a=a===void 0?null:a;var g=d.memoizedState;return g!==null&&a!==null&&Af(a,g[1])?g[0]:(d.memoizedState=[o,a],o)}function Nm(o,a){var d=Vn();a=a===void 0?null:a;var g=d.memoizedState;return g!==null&&a!==null&&Af(a,g[1])?g[0]:(o=o(),d.memoizedState=[o,a],o)}function Pm(o,a,d){return us&21?(rr(d,a)||(d=Kg(),ct.lanes|=d,cs|=d,o.baseState=!0),a):(o.baseState&&(o.baseState=!1,mn=!0),o.memoizedState=d)}function vx(o,a){var d=Be;Be=d!==0&&4>d?d:4,o(!0);var g=Mf.transition;Mf.transition={};try{o(!1),a()}finally{Be=d,Mf.transition=g}}function Mm(){return Vn().memoizedState}function xx(o,a,d){var g=_i(o);if(d={lane:g,action:d,hasEagerState:!1,eagerState:null,next:null},Am(o))Im(a,d);else if(d=lm(o,a,d,g),d!==null){var v=qt();Wn(d,o,g,v),Rm(d,a,g)}}function wx(o,a,d){var g=_i(o),v={lane:g,action:d,hasEagerState:!1,eagerState:null,next:null};if(Am(o))Im(a,v);else{var P=o.alternate;if(o.lanes===0&&(P===null||P.lanes===0)&&(P=a.lastRenderedReducer,P!==null))try{var L=a.lastRenderedState,$=P(L,d);if(v.hasEagerState=!0,v.eagerState=$,rr($,L)){var q=a.interleaved;q===null?(v.next=v,bf(a)):(v.next=q.next,q.next=v),a.interleaved=v;return}}catch{}finally{}d=lm(o,a,v,g),d!==null&&(v=qt(),Wn(d,o,g,v),Rm(d,a,g))}}function Am(o){var a=o.alternate;return o===ct||a!==null&&a===ct}function Im(o,a){ia=Zl=!0;var d=o.pending;d===null?a.next=a:(a.next=d.next,d.next=a),o.pending=a}function Rm(o,a,d){if(d&4194240){var g=a.lanes;g&=o.pendingLanes,d|=g,a.lanes=d,cf(o,d)}}var eu={readContext:Un,useCallback:Kt,useContext:Kt,useEffect:Kt,useImperativeHandle:Kt,useInsertionEffect:Kt,useLayoutEffect:Kt,useMemo:Kt,useReducer:Kt,useRef:Kt,useState:Kt,useDebugValue:Kt,useDeferredValue:Kt,useTransition:Kt,useMutableSource:Kt,useSyncExternalStore:Kt,useId:Kt,unstable_isNewReconciler:!1},Sx={readContext:Un,useCallback:function(o,a){return Tr().memoizedState=[o,a===void 0?null:a],o},useContext:Un,useEffect:_m,useImperativeHandle:function(o,a,d){return d=d!=null?d.concat([o]):null,ql(4194308,4,Cm.bind(null,a,o),d)},useLayoutEffect:function(o,a){return ql(4194308,4,o,a)},useInsertionEffect:function(o,a){return ql(4,2,o,a)},useMemo:function(o,a){var d=Tr();return a=a===void 0?null:a,o=o(),d.memoizedState=[o,a],o},useReducer:function(o,a,d){var g=Tr();return a=d!==void 0?d(a):a,g.memoizedState=g.baseState=a,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:a},g.queue=o,o=o.dispatch=xx.bind(null,ct,o),[g.memoizedState,o]},useRef:function(o){var a=Tr();return o={current:o},a.memoizedState=o},useState:wm,useDebugValue:Of,useDeferredValue:function(o){return Tr().memoizedState=o},useTransition:function(){var o=wm(!1),a=o[0];return o=vx.bind(null,o[1]),Tr().memoizedState=o,[a,o]},useMutableSource:function(){},useSyncExternalStore:function(o,a,d){var g=ct,v=Tr();if(st){if(d===void 0)throw Error(l(407));d=d()}else{if(d=a(),Lt===null)throw Error(l(349));us&30||gm(g,a,d)}v.memoizedState=d;var P={value:d,getSnapshot:a};return v.queue=P,_m(ym.bind(null,g,P,o),[o]),g.flags|=2048,aa(9,mm.bind(null,g,P,d,a),void 0,null),d},useId:function(){var o=Tr(),a=Lt.identifierPrefix;if(st){var d=Wr,g=Vr;d=(g&~(1<<32-nr(g)-1)).toString(32)+d,a=":"+a+"R"+d,d=sa++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=yx++,a=":"+a+"r"+d.toString(32)+":";return o.memoizedState=a},unstable_isNewReconciler:!1},_x={readContext:Un,useCallback:Em,useContext:Un,useEffect:Ff,useImperativeHandle:Tm,useInsertionEffect:km,useLayoutEffect:bm,useMemo:Nm,useReducer:Lf,useRef:Sm,useState:function(){return Lf(oa)},useDebugValue:Of,useDeferredValue:function(o){var a=Vn();return Pm(a,Ct.memoizedState,o)},useTransition:function(){var o=Lf(oa)[0],a=Vn().memoizedState;return[o,a]},useMutableSource:hm,useSyncExternalStore:pm,useId:Mm,unstable_isNewReconciler:!1},kx={readContext:Un,useCallback:Em,useContext:Un,useEffect:Ff,useImperativeHandle:Tm,useInsertionEffect:km,useLayoutEffect:bm,useMemo:Nm,useReducer:jf,useRef:Sm,useState:function(){return jf(oa)},useDebugValue:Of,useDeferredValue:function(o){var a=Vn();return Ct===null?a.memoizedState=o:Pm(a,Ct.memoizedState,o)},useTransition:function(){var o=jf(oa)[0],a=Vn().memoizedState;return[o,a]},useMutableSource:hm,useSyncExternalStore:pm,useId:Mm,unstable_isNewReconciler:!1};function sr(o,a){if(o&&o.defaultProps){a=s({},a),o=o.defaultProps;for(var d in o)a[d]===void 0&&(a[d]=o[d]);return a}return a}function Df(o,a,d,g){a=o.memoizedState,d=d(g,a),d=d==null?a:s({},a,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var tu={isMounted:function(o){return(o=o._reactInternals)?R(o)===o:!1},enqueueSetState:function(o,a,d){o=o._reactInternals;var g=qt(),v=_i(o),P=$r(g,v);P.payload=a,d!=null&&(P.callback=d),a=xi(o,P,v),a!==null&&(Wn(a,o,v,g),Yl(a,o,v))},enqueueReplaceState:function(o,a,d){o=o._reactInternals;var g=qt(),v=_i(o),P=$r(g,v);P.tag=1,P.payload=a,d!=null&&(P.callback=d),a=xi(o,P,v),a!==null&&(Wn(a,o,v,g),Yl(a,o,v))},enqueueForceUpdate:function(o,a){o=o._reactInternals;var d=qt(),g=_i(o),v=$r(d,g);v.tag=2,a!=null&&(v.callback=a),a=xi(o,v,g),a!==null&&(Wn(a,o,g,d),Yl(a,o,g))}};function Lm(o,a,d,g,v,P,L){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(g,P,L):a.prototype&&a.prototype.isPureReactComponent?!Vl(d,g)||!Vl(v,P):!0}function jm(o,a,d){var g=!1,v=yi,P=a.contextType;return typeof P=="object"&&P!==null?P=Un(P):(v=gn(a)?ss:Xt.current,g=a.contextTypes,P=(g=g!=null)?Us(o,v):yi),a=new a(d,P),o.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=tu,o.stateNode=a,a._reactInternals=o,g&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=v,o.__reactInternalMemoizedMaskedChildContext=P),a}function Fm(o,a,d,g){o=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,g),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,g),a.state!==o&&tu.enqueueReplaceState(a,a.state,null)}function zf(o,a,d,g){var v=o.stateNode;v.props=d,v.state=o.memoizedState,v.refs={},Cf(o);var P=a.contextType;typeof P=="object"&&P!==null?v.context=Un(P):(P=gn(a)?ss:Xt.current,v.context=Us(o,P)),v.state=o.memoizedState,P=a.getDerivedStateFromProps,typeof P=="function"&&(Df(o,a,P,d),v.state=o.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(a=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),a!==v.state&&tu.enqueueReplaceState(v,v.state,null),Xl(o,d,v,g),v.state=o.memoizedState),typeof v.componentDidMount=="function"&&(o.flags|=4194308)}function Qs(o,a){try{var d="",g=a;do d+=mx(g),g=g.return;while(g);var v=d}catch(P){v=`
Error generating stack: `+P.message+`
`+P.stack}return{value:o,source:a,stack:v,digest:null}}function Bf(o,a,d){return{value:o,source:null,stack:d??null,digest:a??null}}function Uf(o,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var bx=typeof WeakMap=="function"?WeakMap:Map;function Om(o,a,d){d=$r(-1,d),d.tag=3,d.payload={element:null};var g=a.value;return d.callback=function(){gu||(gu=!0,ah=g),Uf(o,a)},d}function Dm(o,a,d){d=$r(-1,d),d.tag=3;var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var v=a.value;d.payload=function(){return g(v)},d.callback=function(){Uf(o,a)}}var P=o.stateNode;return P!==null&&typeof P.componentDidCatch=="function"&&(d.callback=function(){Uf(o,a),typeof g!="function"&&(wi===null?wi=new Set([this]):wi.add(this));var L=a.stack;this.componentDidCatch(a.value,{componentStack:L!==null?L:""})}),d}function zm(o,a,d){var g=o.pingCache;if(g===null){g=o.pingCache=new bx;var v=new Set;g.set(a,v)}else v=g.get(a),v===void 0&&(v=new Set,g.set(a,v));v.has(d)||(v.add(d),o=Dx.bind(null,o,a,d),a.then(o,o))}function Bm(o){do{var a;if((a=o.tag===13)&&(a=o.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return o;o=o.return}while(o!==null);return null}function Um(o,a,d,g,v){return o.mode&1?(o.flags|=65536,o.lanes=v,o):(o===a?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=$r(-1,1),a.tag=2,xi(d,a,1))),d.lanes|=1),o)}var Cx=c.ReactCurrentOwner,mn=!1;function on(o,a,d,g){a.child=o===null?om(a,null,d,g):$s(a,o.child,d,g)}function Gm(o,a,d,g,v){d=d.render;var P=a.ref;return Ys(a,v),g=If(o,a,d,g,P,v),d=Rf(),o!==null&&!mn?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~v,Hr(o,a,v)):(st&&d&&gf(a),a.flags|=1,on(o,a,g,v),a.child)}function Vm(o,a,d,g,v){if(o===null){var P=d.type;return typeof P=="function"&&!hh(P)&&P.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=P,Wm(o,a,P,g,v)):(o=Su(d.type,null,g,a,a.mode,v),o.ref=a.ref,o.return=a,a.child=o)}if(P=o.child,!(o.lanes&v)){var L=P.memoizedProps;if(d=d.compare,d=d!==null?d:Vl,d(L,g)&&o.ref===a.ref)return Hr(o,a,v)}return a.flags|=1,o=bi(P,g),o.ref=a.ref,o.return=a,a.child=o}function Wm(o,a,d,g,v){if(o!==null){var P=o.memoizedProps;if(Vl(P,g)&&o.ref===a.ref)if(mn=!1,a.pendingProps=g=P,(o.lanes&v)!==0)o.flags&131072&&(mn=!0);else return a.lanes=o.lanes,Hr(o,a,v)}return Gf(o,a,d,g,v)}function $m(o,a,d){var g=a.pendingProps,v=g.children,P=o!==null?o.memoizedState:null;if(g.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qe(qs,Pn),Pn|=d;else{if(!(d&1073741824))return o=P!==null?P.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:o,cachePool:null,transitions:null},a.updateQueue=null,Qe(qs,Pn),Pn|=o,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=P!==null?P.baseLanes:d,Qe(qs,Pn),Pn|=g}else P!==null?(g=P.baseLanes|d,a.memoizedState=null):g=d,Qe(qs,Pn),Pn|=g;return on(o,a,v,d),a.child}function Hm(o,a){var d=a.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function Gf(o,a,d,g,v){var P=gn(d)?ss:Xt.current;return P=Us(a,P),Ys(a,v),d=If(o,a,d,g,P,v),g=Rf(),o!==null&&!mn?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~v,Hr(o,a,v)):(st&&g&&gf(a),a.flags|=1,on(o,a,d,v),a.child)}function Ym(o,a,d,g,v){if(gn(d)){var P=!0;Ll(a)}else P=!1;if(Ys(a,v),a.stateNode===null)ru(o,a),jm(a,d,g),zf(a,d,g,v),g=!0;else if(o===null){var L=a.stateNode,$=a.memoizedProps;L.props=$;var q=L.context,ue=d.contextType;typeof ue=="object"&&ue!==null?ue=Un(ue):(ue=gn(d)?ss:Xt.current,ue=Us(a,ue));var Se=d.getDerivedStateFromProps,Me=typeof Se=="function"||typeof L.getSnapshotBeforeUpdate=="function";Me||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||($!==g||q!==ue)&&Fm(a,L,g,ue),vi=!1;var ge=a.memoizedState;L.state=ge,Xl(a,g,L,v),q=a.memoizedState,$!==g||ge!==q||pn.current||vi?(typeof Se=="function"&&(Df(a,d,Se,g),q=a.memoizedState),($=vi||Lm(a,d,$,g,ge,q,ue))?(Me||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(a.flags|=4194308)):(typeof L.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=g,a.memoizedState=q),L.props=g,L.state=q,L.context=ue,g=$):(typeof L.componentDidMount=="function"&&(a.flags|=4194308),g=!1)}else{L=a.stateNode,um(o,a),$=a.memoizedProps,ue=a.type===a.elementType?$:sr(a.type,$),L.props=ue,Me=a.pendingProps,ge=L.context,q=d.contextType,typeof q=="object"&&q!==null?q=Un(q):(q=gn(d)?ss:Xt.current,q=Us(a,q));var et=d.getDerivedStateFromProps;(Se=typeof et=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||($!==Me||ge!==q)&&Fm(a,L,g,q),vi=!1,ge=a.memoizedState,L.state=ge,Xl(a,g,L,v);var Xe=a.memoizedState;$!==Me||ge!==Xe||pn.current||vi?(typeof et=="function"&&(Df(a,d,et,g),Xe=a.memoizedState),(ue=vi||Lm(a,d,ue,g,ge,Xe,q)||!1)?(Se||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(g,Xe,q),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(g,Xe,q)),typeof L.componentDidUpdate=="function"&&(a.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof L.componentDidUpdate!="function"||$===o.memoizedProps&&ge===o.memoizedState||(a.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||$===o.memoizedProps&&ge===o.memoizedState||(a.flags|=1024),a.memoizedProps=g,a.memoizedState=Xe),L.props=g,L.state=Xe,L.context=q,g=ue):(typeof L.componentDidUpdate!="function"||$===o.memoizedProps&&ge===o.memoizedState||(a.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||$===o.memoizedProps&&ge===o.memoizedState||(a.flags|=1024),g=!1)}return Vf(o,a,d,g,P,v)}function Vf(o,a,d,g,v,P){Hm(o,a);var L=(a.flags&128)!==0;if(!g&&!L)return v&&Xg(a,d,!1),Hr(o,a,P);g=a.stateNode,Cx.current=a;var $=L&&typeof d.getDerivedStateFromError!="function"?null:g.render();return a.flags|=1,o!==null&&L?(a.child=$s(a,o.child,null,P),a.child=$s(a,null,$,P)):on(o,a,$,P),a.memoizedState=g.state,v&&Xg(a,d,!0),a.child}function Xm(o){var a=o.stateNode;a.pendingContext?Hg(o,a.pendingContext,a.pendingContext!==a.context):a.context&&Hg(o,a.context,!1),Tf(o,a.containerInfo)}function Km(o,a,d,g,v){return Ws(),xf(v),a.flags|=256,on(o,a,d,g),a.child}var Wf={dehydrated:null,treeContext:null,retryLane:0};function $f(o){return{baseLanes:o,cachePool:null,transitions:null}}function Qm(o,a,d){var g=a.pendingProps,v=ut.current,P=!1,L=(a.flags&128)!==0,$;if(($=L)||($=o!==null&&o.memoizedState===null?!1:(v&2)!==0),$?(P=!0,a.flags&=-129):(o===null||o.memoizedState!==null)&&(v|=1),Qe(ut,v&1),o===null)return vf(a),o=a.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(a.mode&1?nf(o)?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(L=g.children,o=g.fallback,P?(g=a.mode,P=a.child,L={mode:"hidden",children:L},!(g&1)&&P!==null?(P.childLanes=0,P.pendingProps=L):P=_u(L,g,0,null),o=ps(o,g,d,null),P.return=a,o.return=a,P.sibling=o,a.child=P,a.child.memoizedState=$f(d),a.memoizedState=Wf,o):Hf(a,L));if(v=o.memoizedState,v!==null&&($=v.dehydrated,$!==null))return Tx(o,a,L,g,$,v,d);if(P){P=g.fallback,L=a.mode,v=o.child,$=v.sibling;var q={mode:"hidden",children:g.children};return!(L&1)&&a.child!==v?(g=a.child,g.childLanes=0,g.pendingProps=q,a.deletions=null):(g=bi(v,q),g.subtreeFlags=v.subtreeFlags&14680064),$!==null?P=bi($,P):(P=ps(P,L,d,null),P.flags|=2),P.return=a,g.return=a,g.sibling=P,a.child=g,g=P,P=a.child,L=o.child.memoizedState,L=L===null?$f(d):{baseLanes:L.baseLanes|d,cachePool:null,transitions:L.transitions},P.memoizedState=L,P.childLanes=o.childLanes&~d,a.memoizedState=Wf,g}return P=o.child,o=P.sibling,g=bi(P,{mode:"visible",children:g.children}),!(a.mode&1)&&(g.lanes=d),g.return=a,g.sibling=null,o!==null&&(d=a.deletions,d===null?(a.deletions=[o],a.flags|=16):d.push(o)),a.child=g,a.memoizedState=null,g}function Hf(o,a){return a=_u({mode:"visible",children:a},o.mode,0,null),a.return=o,o.child=a}function nu(o,a,d,g){return g!==null&&xf(g),$s(a,o.child,null,d),o=Hf(a,a.pendingProps.children),o.flags|=2,a.memoizedState=null,o}function Tx(o,a,d,g,v,P,L){if(d)return a.flags&256?(a.flags&=-257,g=Bf(Error(l(422))),nu(o,a,L,g)):a.memoizedState!==null?(a.child=o.child,a.flags|=128,null):(P=g.fallback,v=a.mode,g=_u({mode:"visible",children:g.children},v,0,null),P=ps(P,v,L,null),P.flags|=2,g.return=a,P.return=a,g.sibling=P,a.child=g,a.mode&1&&$s(a,o.child,null,L),a.child.memoizedState=$f(L),a.memoizedState=Wf,P);if(!(a.mode&1))return nu(o,a,L,null);if(nf(v))return g=z4(v).digest,P=Error(l(419)),g=Bf(P,g,void 0),nu(o,a,L,g);if(d=(L&o.childLanes)!==0,mn||d){if(g=Lt,g!==null){switch(L&-L){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(g.suspendedLanes|L)?0:v,v!==0&&v!==P.retryLane&&(P.retryLane=v,br(o,v),Wn(g,o,v,-1))}return fh(),g=Bf(Error(l(421))),nu(o,a,L,g)}return $g(v)?(a.flags|=128,a.child=o.child,a=zx.bind(null,o),B4(v,a),null):(o=P.treeContext,pe&&(Bn=V4(v),Nn=a,st=!0,ir=null,ea=!1,o!==null&&(Dn[zn++]=Vr,Dn[zn++]=Wr,Dn[zn++]=os,Vr=o.id,Wr=o.overflow,os=a)),a=Hf(a,g.children),a.flags|=4096,a)}function Zm(o,a,d){o.lanes|=a;var g=o.alternate;g!==null&&(g.lanes|=a),kf(o.return,a,d)}function Yf(o,a,d,g,v){var P=o.memoizedState;P===null?o.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:g,tail:d,tailMode:v}:(P.isBackwards=a,P.rendering=null,P.renderingStartTime=0,P.last=g,P.tail=d,P.tailMode=v)}function qm(o,a,d){var g=a.pendingProps,v=g.revealOrder,P=g.tail;if(on(o,a,g.children,d),g=ut.current,g&2)g=g&1|2,a.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=a.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Zm(o,d,a);else if(o.tag===19)Zm(o,d,a);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}g&=1}if(Qe(ut,g),!(a.mode&1))a.memoizedState=null;else switch(v){case"forwards":for(d=a.child,v=null;d!==null;)o=d.alternate,o!==null&&Kl(o)===null&&(v=d),d=d.sibling;d=v,d===null?(v=a.child,a.child=null):(v=d.sibling,d.sibling=null),Yf(a,!1,v,d,P);break;case"backwards":for(d=null,v=a.child,a.child=null;v!==null;){if(o=v.alternate,o!==null&&Kl(o)===null){a.child=v;break}o=v.sibling,v.sibling=d,d=v,v=o}Yf(a,!0,d,null,P);break;case"together":Yf(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function ru(o,a){!(a.mode&1)&&o!==null&&(o.alternate=null,a.alternate=null,a.flags|=2)}function Hr(o,a,d){if(o!==null&&(a.dependencies=o.dependencies),cs|=a.lanes,!(d&a.childLanes))return null;if(o!==null&&a.child!==o.child)throw Error(l(153));if(a.child!==null){for(o=a.child,d=bi(o,o.pendingProps),a.child=d,d.return=a;o.sibling!==null;)o=o.sibling,d=d.sibling=bi(o,o.pendingProps),d.return=a;d.sibling=null}return a.child}function Ex(o,a,d){switch(a.tag){case 3:Xm(a),Ws();break;case 5:fm(a);break;case 1:gn(a.type)&&Ll(a);break;case 4:Tf(a,a.stateNode.containerInfo);break;case 10:am(a,a.type._context,a.memoizedProps.value);break;case 13:var g=a.memoizedState;if(g!==null)return g.dehydrated!==null?(Qe(ut,ut.current&1),a.flags|=128,null):d&a.child.childLanes?Qm(o,a,d):(Qe(ut,ut.current&1),o=Hr(o,a,d),o!==null?o.sibling:null);Qe(ut,ut.current&1);break;case 19:if(g=(d&a.childLanes)!==0,o.flags&128){if(g)return qm(o,a,d);a.flags|=128}var v=a.memoizedState;if(v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),Qe(ut,ut.current),g)break;return null;case 22:case 23:return a.lanes=0,$m(o,a,d)}return Hr(o,a,d)}function Er(o){o.flags|=4}function Jm(o,a){if(o!==null&&o.child===a.child)return!0;if(a.flags&16)return!1;for(o=a.child;o!==null;){if(o.flags&12854||o.subtreeFlags&12854)return!1;o=o.sibling}return!0}var la,ua,iu,su;if(oe)la=function(o,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)K(o,d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},ua=function(){},iu=function(o,a,d,g,v){if(o=o.memoizedProps,o!==g){var P=a.stateNode,L=Cr(Gn.current);d=ne(P,d,o,g,v,L),(a.updateQueue=d)&&Er(a)}},su=function(o,a,d,g){d!==g&&Er(a)};else if(fe){la=function(o,a,d,g){for(var v=a.child;v!==null;){if(v.tag===5){var P=v.stateNode;d&&g&&(P=Vg(P,v.type,v.memoizedProps,v)),K(o,P)}else if(v.tag===6)P=v.stateNode,d&&g&&(P=Wg(P,v.memoizedProps,v)),K(o,P);else if(v.tag!==4){if(v.tag===22&&v.memoizedState!==null)P=v.child,P!==null&&(P.return=v),la(o,v,!0,!0);else if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===a)break;for(;v.sibling===null;){if(v.return===null||v.return===a)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};var e1=function(o,a,d,g){for(var v=a.child;v!==null;){if(v.tag===5){var P=v.stateNode;d&&g&&(P=Vg(P,v.type,v.memoizedProps,v)),Sr(o,P)}else if(v.tag===6)P=v.stateNode,d&&g&&(P=Wg(P,v.memoizedProps,v)),Sr(o,P);else if(v.tag!==4){if(v.tag===22&&v.memoizedState!==null)P=v.child,P!==null&&(P.return=v),e1(o,v,!0,!0);else if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===a)break;for(;v.sibling===null;){if(v.return===null||v.return===a)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};ua=function(o,a){var d=a.stateNode;if(!Jm(o,a)){o=d.containerInfo;var g=is(o);e1(g,a,!1,!1),d.pendingChildren=g,Er(a),En(o,g)}},iu=function(o,a,d,g,v){var P=o.stateNode,L=o.memoizedProps;if((o=Jm(o,a))&&L===g)a.stateNode=P;else{var $=a.stateNode,q=Cr(Gn.current),ue=null;L!==g&&(ue=ne($,d,L,g,v,q)),o&&ue===null?a.stateNode=P:(P=wr(P,ue,d,L,g,a,o,$),ee(P,d,g,v,q)&&Er(a),a.stateNode=P,o?Er(a):la(P,a,!1,!1))}},su=function(o,a,d,g){d!==g?(o=Cr(Xs.current),d=Cr(Gn.current),a.stateNode=de(g,o,d,a),Er(a)):a.stateNode=o.stateNode}}else ua=function(){},iu=function(){},su=function(){};function ca(o,a){if(!st)switch(o.tailMode){case"hidden":a=o.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?a||o.tail===null?o.tail=null:o.tail.sibling=null:g.sibling=null}}function Qt(o){var a=o.alternate!==null&&o.alternate.child===o.child,d=0,g=0;if(a)for(var v=o.child;v!==null;)d|=v.lanes|v.childLanes,g|=v.subtreeFlags&14680064,g|=v.flags&14680064,v.return=o,v=v.sibling;else for(v=o.child;v!==null;)d|=v.lanes|v.childLanes,g|=v.subtreeFlags,g|=v.flags,v.return=o,v=v.sibling;return o.subtreeFlags|=g,o.childLanes=d,a}function Nx(o,a,d){var g=a.pendingProps;switch(mf(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(a),null;case 1:return gn(a.type)&&Rl(),Qt(a),null;case 3:return d=a.stateNode,Ks(),Je(pn),Je(Xt),Pf(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(o===null||o.child===null)&&(Gl(a)?Er(a):o===null||o.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,ir!==null&&(ch(ir),ir=null))),ua(o,a),Qt(a),null;case 5:Ef(a),d=Cr(Xs.current);var v=a.type;if(o!==null&&a.stateNode!=null)iu(o,a,v,g,d),o.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!g){if(a.stateNode===null)throw Error(l(166));return Qt(a),null}if(o=Cr(Gn.current),Gl(a)){if(!pe)throw Error(l(175));o=W4(a.stateNode,a.type,a.memoizedProps,d,o,a,!ea),a.updateQueue=o,o!==null&&Er(a)}else{var P=te(v,g,d,o,a);la(P,a,!1,!1),a.stateNode=P,ee(P,v,g,d,o)&&Er(a)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Qt(a),null;case 6:if(o&&a.stateNode!=null)su(o,a,o.memoizedProps,g);else{if(typeof g!="string"&&a.stateNode===null)throw Error(l(166));if(o=Cr(Xs.current),d=Cr(Gn.current),Gl(a)){if(!pe)throw Error(l(176));if(o=a.stateNode,d=a.memoizedProps,(g=$4(o,d,a,!ea))&&(v=Nn,v!==null))switch(v.tag){case 3:J4(v.stateNode.containerInfo,o,d,(v.mode&1)!==0);break;case 5:ex(v.type,v.memoizedProps,v.stateNode,o,d,(v.mode&1)!==0)}g&&Er(a)}else a.stateNode=de(g,o,d,a)}return Qt(a),null;case 13:if(Je(ut),g=a.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(st&&Bn!==null&&a.mode&1&&!(a.flags&128))rm(),Ws(),a.flags|=98560,v=!1;else if(v=Gl(a),g!==null&&g.dehydrated!==null){if(o===null){if(!v)throw Error(l(318));if(!pe)throw Error(l(344));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(l(317));H4(v,a)}else Ws(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Qt(a),v=!1}else ir!==null&&(ch(ir),ir=null),v=!0;if(!v)return a.flags&65536?a:null}return a.flags&128?(a.lanes=d,a):(d=g!==null,d!==(o!==null&&o.memoizedState!==null)&&d&&(a.child.flags|=8192,a.mode&1&&(o===null||ut.current&1?Tt===0&&(Tt=3):fh())),a.updateQueue!==null&&(a.flags|=4),Qt(a),null);case 4:return Ks(),ua(o,a),o===null&&Ce(a.stateNode.containerInfo),Qt(a),null;case 10:return _f(a.type._context),Qt(a),null;case 17:return gn(a.type)&&Rl(),Qt(a),null;case 19:if(Je(ut),v=a.memoizedState,v===null)return Qt(a),null;if(g=(a.flags&128)!==0,P=v.rendering,P===null)if(g)ca(v,!1);else{if(Tt!==0||o!==null&&o.flags&128)for(o=a.child;o!==null;){if(P=Kl(o),P!==null){for(a.flags|=128,ca(v,!1),o=P.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),a.subtreeFlags=0,o=d,d=a.child;d!==null;)g=d,v=o,g.flags&=14680066,P=g.alternate,P===null?(g.childLanes=0,g.lanes=v,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=P.childLanes,g.lanes=P.lanes,g.child=P.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=P.memoizedProps,g.memoizedState=P.memoizedState,g.updateQueue=P.updateQueue,g.type=P.type,v=P.dependencies,g.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),d=d.sibling;return Qe(ut,ut.current&1|2),a.child}o=o.sibling}v.tail!==null&&It()>oh&&(a.flags|=128,g=!0,ca(v,!1),a.lanes=4194304)}else{if(!g)if(o=Kl(P),o!==null){if(a.flags|=128,g=!0,o=o.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),ca(v,!0),v.tail===null&&v.tailMode==="hidden"&&!P.alternate&&!st)return Qt(a),null}else 2*It()-v.renderingStartTime>oh&&d!==1073741824&&(a.flags|=128,g=!0,ca(v,!1),a.lanes=4194304);v.isBackwards?(P.sibling=a.child,a.child=P):(o=v.last,o!==null?o.sibling=P:a.child=P,v.last=P)}return v.tail!==null?(a=v.tail,v.rendering=a,v.tail=a.sibling,v.renderingStartTime=It(),a.sibling=null,o=ut.current,Qe(ut,g?o&1|2:o&1),a):(Qt(a),null);case 22:case 23:return dh(),d=a.memoizedState!==null,o!==null&&o.memoizedState!==null!==d&&(a.flags|=8192),d&&a.mode&1?Pn&1073741824&&(Qt(a),oe&&a.subtreeFlags&6&&(a.flags|=8192)):Qt(a),null;case 24:return null;case 25:return null}throw Error(l(156,a.tag))}function Px(o,a){switch(mf(a),a.tag){case 1:return gn(a.type)&&Rl(),o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 3:return Ks(),Je(pn),Je(Xt),Pf(),o=a.flags,o&65536&&!(o&128)?(a.flags=o&-65537|128,a):null;case 5:return Ef(a),null;case 13:if(Je(ut),o=a.memoizedState,o!==null&&o.dehydrated!==null){if(a.alternate===null)throw Error(l(340));Ws()}return o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 19:return Je(ut),null;case 4:return Ks(),null;case 10:return _f(a.type._context),null;case 22:case 23:return dh(),null;case 24:return null;default:return null}}var ou=!1,Zt=!1,Mx=typeof WeakSet=="function"?WeakSet:Set,ve=null;function Zs(o,a){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(g){ot(o,a,g)}else d.current=null}function Xf(o,a,d){try{d()}catch(g){ot(o,a,g)}}var t1=!1;function Ax(o,a){for(Y(o.containerInfo),ve=a;ve!==null;)if(o=ve,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,ve=a;else for(;ve!==null;){o=ve;try{var d=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(d!==null){var g=d.memoizedProps,v=d.memoizedState,P=o.stateNode,L=P.getSnapshotBeforeUpdate(o.elementType===o.type?g:sr(o.type,g),v);P.__reactInternalSnapshotBeforeUpdate=L}break;case 3:oe&&gi(o.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch($){ot(o,o.return,$)}if(a=o.sibling,a!==null){a.return=o.return,ve=a;break}ve=o.return}return d=t1,t1=!1,d}function da(o,a,d){var g=a.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var v=g=g.next;do{if((v.tag&o)===o){var P=v.destroy;v.destroy=void 0,P!==void 0&&Xf(a,d,P)}v=v.next}while(v!==g)}}function au(o,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&o)===o){var g=d.create;d.destroy=g()}d=d.next}while(d!==a)}}function Kf(o){var a=o.ref;if(a!==null){var d=o.stateNode;switch(o.tag){case 5:o=U(d);break;default:o=d}typeof a=="function"?a(o):a.current=o}}function n1(o){var a=o.alternate;a!==null&&(o.alternate=null,n1(a)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(a=o.stateNode,a!==null&&We(a)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function r1(o){return o.tag===5||o.tag===3||o.tag===4}function i1(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||r1(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Qf(o,a,d){var g=o.tag;if(g===5||g===6)o=o.stateNode,a?le(d,o,a):gt(d,o);else if(g!==4&&(o=o.child,o!==null))for(Qf(o,a,d),o=o.sibling;o!==null;)Qf(o,a,d),o=o.sibling}function Zf(o,a,d){var g=o.tag;if(g===5||g===6)o=o.stateNode,a?se(d,o,a):Br(d,o);else if(g!==4&&(o=o.child,o!==null))for(Zf(o,a,d),o=o.sibling;o!==null;)Zf(o,a,d),o=o.sibling}var zt=null,or=!1;function Nr(o,a,d){for(d=d.child;d!==null;)qf(o,a,d),d=d.sibling}function qf(o,a,d){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(Dl,d)}catch{}switch(d.tag){case 5:Zt||Zs(d,a);case 6:if(oe){var g=zt,v=or;zt=null,Nr(o,a,d),zt=g,or=v,zt!==null&&(or?_e(zt,d.stateNode):he(zt,d.stateNode))}else Nr(o,a,d);break;case 18:oe&&zt!==null&&(or?Z4(zt,d.stateNode):Q4(zt,d.stateNode));break;case 4:oe?(g=zt,v=or,zt=d.stateNode.containerInfo,or=!0,Nr(o,a,d),zt=g,or=v):(fe&&(g=d.stateNode.containerInfo,v=is(g),Qo(g,v)),Nr(o,a,d));break;case 0:case 11:case 14:case 15:if(!Zt&&(g=d.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){v=g=g.next;do{var P=v,L=P.destroy;P=P.tag,L!==void 0&&(P&2||P&4)&&Xf(d,a,L),v=v.next}while(v!==g)}Nr(o,a,d);break;case 1:if(!Zt&&(Zs(d,a),g=d.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=d.memoizedProps,g.state=d.memoizedState,g.componentWillUnmount()}catch($){ot(d,a,$)}Nr(o,a,d);break;case 21:Nr(o,a,d);break;case 22:d.mode&1?(Zt=(g=Zt)||d.memoizedState!==null,Nr(o,a,d),Zt=g):Nr(o,a,d);break;default:Nr(o,a,d)}}function s1(o){var a=o.updateQueue;if(a!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new Mx),a.forEach(function(g){var v=Bx.bind(null,o,g);d.has(g)||(d.add(g),g.then(v,v))})}}function ar(o,a){var d=a.deletions;if(d!==null)for(var g=0;g<d.length;g++){var v=d[g];try{var P=o,L=a;if(oe){var $=L;e:for(;$!==null;){switch($.tag){case 5:zt=$.stateNode,or=!1;break e;case 3:zt=$.stateNode.containerInfo,or=!0;break e;case 4:zt=$.stateNode.containerInfo,or=!0;break e}$=$.return}if(zt===null)throw Error(l(160));qf(P,L,v),zt=null,or=!1}else qf(P,L,v);var q=v.alternate;q!==null&&(q.return=null),v.return=null}catch(ue){ot(v,a,ue)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)o1(a,o),a=a.sibling}function o1(o,a){var d=o.alternate,g=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(ar(a,o),Pr(o),g&4){try{da(3,o,o.return),au(3,o)}catch(ge){ot(o,o.return,ge)}try{da(5,o,o.return)}catch(ge){ot(o,o.return,ge)}}break;case 1:ar(a,o),Pr(o),g&512&&d!==null&&Zs(d,d.return);break;case 5:if(ar(a,o),Pr(o),g&512&&d!==null&&Zs(d,d.return),oe){if(o.flags&32){var v=o.stateNode;try{ke(v)}catch(ge){ot(o,o.return,ge)}}if(g&4&&(v=o.stateNode,v!=null)){var P=o.memoizedProps;if(d=d!==null?d.memoizedProps:P,g=o.type,a=o.updateQueue,o.updateQueue=null,a!==null)try{Ee(v,a,g,d,P,o)}catch(ge){ot(o,o.return,ge)}}}break;case 6:if(ar(a,o),Pr(o),g&4&&oe){if(o.stateNode===null)throw Error(l(162));v=o.stateNode,P=o.memoizedProps,d=d!==null?d.memoizedProps:P;try{dn(v,d,P)}catch(ge){ot(o,o.return,ge)}}break;case 3:if(ar(a,o),Pr(o),g&4){if(oe&&pe&&d!==null&&d.memoizedState.isDehydrated)try{X4(a.containerInfo)}catch(ge){ot(o,o.return,ge)}if(fe){v=a.containerInfo,P=a.pendingChildren;try{Qo(v,P)}catch(ge){ot(o,o.return,ge)}}}break;case 4:if(ar(a,o),Pr(o),g&4&&fe){P=o.stateNode,v=P.containerInfo,P=P.pendingChildren;try{Qo(v,P)}catch(ge){ot(o,o.return,ge)}}break;case 13:ar(a,o),Pr(o),v=o.child,v.flags&8192&&(P=v.memoizedState!==null,v.stateNode.isHidden=P,!P||v.alternate!==null&&v.alternate.memoizedState!==null||(sh=It())),g&4&&s1(o);break;case 22:var L=d!==null&&d.memoizedState!==null;if(o.mode&1?(Zt=(d=Zt)||L,ar(a,o),Zt=d):ar(a,o),Pr(o),g&8192){if(d=o.memoizedState!==null,(o.stateNode.isHidden=d)&&!L&&o.mode&1)for(ve=o,g=o.child;g!==null;){for(a=ve=g;ve!==null;){L=ve;var $=L.child;switch(L.tag){case 0:case 11:case 14:case 15:da(4,L,L.return);break;case 1:Zs(L,L.return);var q=L.stateNode;if(typeof q.componentWillUnmount=="function"){var ue=L,Se=L.return;try{var Me=ue;q.props=Me.memoizedProps,q.state=Me.memoizedState,q.componentWillUnmount()}catch(ge){ot(ue,Se,ge)}}break;case 5:Zs(L,L.return);break;case 22:if(L.memoizedState!==null){u1(a);continue}}$!==null?($.return=L,ve=$):u1(a)}g=g.sibling}if(oe){e:if(g=null,oe)for(a=o;;){if(a.tag===5){if(g===null){g=a;try{v=a.stateNode,d?ye(v):fn(a.stateNode,a.memoizedProps)}catch(ge){ot(o,o.return,ge)}}}else if(a.tag===6){if(g===null)try{P=a.stateNode,d?qe(P):hn(P,a.memoizedProps)}catch(ge){ot(o,o.return,ge)}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===o)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;g===a&&(g=null),a=a.return}g===a&&(g=null),a.sibling.return=a.return,a=a.sibling}}}break;case 19:ar(a,o),Pr(o),g&4&&s1(o);break;case 21:break;default:ar(a,o),Pr(o)}}function Pr(o){var a=o.flags;if(a&2){try{if(oe){e:{for(var d=o.return;d!==null;){if(r1(d)){var g=d;break e}d=d.return}throw Error(l(160))}switch(g.tag){case 5:var v=g.stateNode;g.flags&32&&(ke(v),g.flags&=-33);var P=i1(o);Zf(o,P,v);break;case 3:case 4:var L=g.stateNode.containerInfo,$=i1(o);Qf(o,$,L);break;default:throw Error(l(161))}}}catch(q){ot(o,o.return,q)}o.flags&=-3}a&4096&&(o.flags&=-4097)}function Ix(o,a,d){ve=o,a1(o)}function a1(o,a,d){for(var g=(o.mode&1)!==0;ve!==null;){var v=ve,P=v.child;if(v.tag===22&&g){var L=v.memoizedState!==null||ou;if(!L){var $=v.alternate,q=$!==null&&$.memoizedState!==null||Zt;$=ou;var ue=Zt;if(ou=L,(Zt=q)&&!ue)for(ve=v;ve!==null;)L=ve,q=L.child,L.tag===22&&L.memoizedState!==null?c1(v):q!==null?(q.return=L,ve=q):c1(v);for(;P!==null;)ve=P,a1(P),P=P.sibling;ve=v,ou=$,Zt=ue}l1(o)}else v.subtreeFlags&8772&&P!==null?(P.return=v,ve=P):l1(o)}}function l1(o){for(;ve!==null;){var a=ve;if(a.flags&8772){var d=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Zt||au(5,a);break;case 1:var g=a.stateNode;if(a.flags&4&&!Zt)if(d===null)g.componentDidMount();else{var v=a.elementType===a.type?d.memoizedProps:sr(a.type,d.memoizedProps);g.componentDidUpdate(v,d.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var P=a.updateQueue;P!==null&&dm(a,P,g);break;case 3:var L=a.updateQueue;if(L!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=U(a.child.stateNode);break;case 1:d=a.child.stateNode}dm(a,L,d)}break;case 5:var $=a.stateNode;d===null&&a.flags&4&&Ur($,a.type,a.memoizedProps,a);break;case 6:break;case 4:break;case 12:break;case 13:if(pe&&a.memoizedState===null){var q=a.alternate;if(q!==null){var ue=q.memoizedState;if(ue!==null){var Se=ue.dehydrated;Se!==null&&K4(Se)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(l(163))}Zt||a.flags&512&&Kf(a)}catch(Me){ot(a,a.return,Me)}}if(a===o){ve=null;break}if(d=a.sibling,d!==null){d.return=a.return,ve=d;break}ve=a.return}}function u1(o){for(;ve!==null;){var a=ve;if(a===o){ve=null;break}var d=a.sibling;if(d!==null){d.return=a.return,ve=d;break}ve=a.return}}function c1(o){for(;ve!==null;){var a=ve;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{au(4,a)}catch(q){ot(a,d,q)}break;case 1:var g=a.stateNode;if(typeof g.componentDidMount=="function"){var v=a.return;try{g.componentDidMount()}catch(q){ot(a,v,q)}}var P=a.return;try{Kf(a)}catch(q){ot(a,P,q)}break;case 5:var L=a.return;try{Kf(a)}catch(q){ot(a,L,q)}}}catch(q){ot(a,a.return,q)}if(a===o){ve=null;break}var $=a.sibling;if($!==null){$.return=a.return,ve=$;break}ve=a.return}}var lu=0,uu=1,cu=2,du=3,fu=4;if(typeof Symbol=="function"&&Symbol.for){var fa=Symbol.for;lu=fa("selector.component"),uu=fa("selector.has_pseudo_class"),cu=fa("selector.role"),du=fa("selector.test_id"),fu=fa("selector.text")}function Jf(o){var a=Pe(o);if(a!=null){if(typeof a.memoizedProps["data-testname"]!="string")throw Error(l(364));return a}if(o=rt(o),o===null)throw Error(l(362));return o.stateNode.current}function eh(o,a){switch(a.$$typeof){case lu:if(o.type===a.value)return!0;break;case uu:e:{a=a.value,o=[o,0];for(var d=0;d<o.length;){var g=o[d++],v=o[d++],P=a[v];if(g.tag!==5||!it(g)){for(;P!=null&&eh(g,P);)v++,P=a[v];if(v===a.length){a=!0;break e}else for(g=g.child;g!==null;)o.push(g,v),g=g.sibling}}a=!1}return a;case cu:if(o.tag===5&&hi(o.stateNode,a.value))return!0;break;case fu:if((o.tag===5||o.tag===6)&&(o=On(o),o!==null&&0<=o.indexOf(a.value)))return!0;break;case du:if(o.tag===5&&(o=o.memoizedProps["data-testname"],typeof o=="string"&&o.toLowerCase()===a.value.toLowerCase()))return!0;break;default:throw Error(l(365))}return!1}function th(o){switch(o.$$typeof){case lu:return"<"+(A(o.value)||"Unknown")+">";case uu:return":has("+(th(o)||"")+")";case cu:return'[role="'+o.value+'"]';case fu:return'"'+o.value+'"';case du:return'[data-testname="'+o.value+'"]';default:throw Error(l(365))}}function d1(o,a){var d=[];o=[o,0];for(var g=0;g<o.length;){var v=o[g++],P=o[g++],L=a[P];if(v.tag!==5||!it(v)){for(;L!=null&&eh(v,L);)P++,L=a[P];if(P===a.length)d.push(v);else for(v=v.child;v!==null;)o.push(v,P),v=v.sibling}}return d}function nh(o,a){if(!Yt)throw Error(l(363));o=Jf(o),o=d1(o,a),a=[],o=Array.from(o);for(var d=0;d<o.length;){var g=o[d++];if(g.tag===5)it(g)||a.push(g.stateNode);else for(g=g.child;g!==null;)o.push(g),g=g.sibling}return a}var Rx=Math.ceil,hu=c.ReactCurrentDispatcher,rh=c.ReactCurrentOwner,wt=c.ReactCurrentBatchConfig,Le=0,Lt=null,kt=null,Bt=0,Pn=0,qs=mi(0),Tt=0,ha=null,cs=0,pu=0,ih=0,pa=null,yn=null,sh=0,oh=1/0,Yr=null;function Js(){oh=It()+500}var gu=!1,ah=null,wi=null,mu=!1,Si=null,yu=0,ga=0,lh=null,vu=-1,xu=0;function qt(){return Le&6?It():vu!==-1?vu:vu=It()}function _i(o){return o.mode&1?Le&2&&Bt!==0?Bt&-Bt:gx.transition!==null?(xu===0&&(xu=Kg()),xu):(o=Be,o!==0?o:$e()):1}function Wn(o,a,d,g){if(50<ga)throw ga=0,lh=null,Error(l(185));Jo(o,d,g),(!(Le&2)||o!==Lt)&&(o===Lt&&(!(Le&2)&&(pu|=d),Tt===4&&ki(o,Bt)),vn(o,g),d===1&&Le===0&&!(a.mode&1)&&(Js(),zl&&kr()))}function vn(o,a){var d=o.callbackNode;ox(o,a);var g=Ol(o,o===Lt?Bt:0);if(g===0)d!==null&&Zg(d),o.callbackNode=null,o.callbackPriority=0;else if(a=g&-g,o.callbackPriority!==a){if(d!=null&&Zg(d),a===1)o.tag===0?px(h1.bind(null,o)):qg(h1.bind(null,o)),xt?Dt(function(){!(Le&6)&&kr()}):df(ff,kr),d=null;else{switch(Qg(g)){case 1:d=ff;break;case 4:d=cx;break;case 16:d=hf;break;case 536870912:d=dx;break;default:d=hf}d=_1(d,f1.bind(null,o))}o.callbackPriority=a,o.callbackNode=d}}function f1(o,a){if(vu=-1,xu=0,Le&6)throw Error(l(327));var d=o.callbackNode;if(hs()&&o.callbackNode!==d)return null;var g=Ol(o,o===Lt?Bt:0);if(g===0)return null;if(g&30||g&o.expiredLanes||a)a=wu(o,g);else{a=g;var v=Le;Le|=2;var P=m1();(Lt!==o||Bt!==a)&&(Yr=null,Js(),ds(o,a));do try{Fx();break}catch($){g1(o,$)}while(1);Sf(),hu.current=P,Le=v,kt!==null?a=0:(Lt=null,Bt=0,a=Tt)}if(a!==0){if(a===2&&(v=lf(o),v!==0&&(g=v,a=uh(o,v))),a===1)throw d=ha,ds(o,0),ki(o,g),vn(o,It()),d;if(a===6)ki(o,g);else{if(v=o.current.alternate,!(g&30)&&!Lx(v)&&(a=wu(o,g),a===2&&(P=lf(o),P!==0&&(g=P,a=uh(o,P))),a===1))throw d=ha,ds(o,0),ki(o,g),vn(o,It()),d;switch(o.finishedWork=v,o.finishedLanes=g,a){case 0:case 1:throw Error(l(345));case 2:fs(o,yn,Yr);break;case 3:if(ki(o,g),(g&130023424)===g&&(a=sh+500-It(),10<a)){if(Ol(o,0)!==0)break;if(v=o.suspendedLanes,(v&g)!==g){qt(),o.pingedLanes|=o.suspendedLanes&v;break}o.timeoutHandle=B(fs.bind(null,o,yn,Yr),a);break}fs(o,yn,Yr);break;case 4:if(ki(o,g),(g&4194240)===g)break;for(a=o.eventTimes,v=-1;0<g;){var L=31-nr(g);P=1<<L,L=a[L],L>v&&(v=L),g&=~P}if(g=v,g=It()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*Rx(g/1960))-g,10<g){o.timeoutHandle=B(fs.bind(null,o,yn,Yr),g);break}fs(o,yn,Yr);break;case 5:fs(o,yn,Yr);break;default:throw Error(l(329))}}}return vn(o,It()),o.callbackNode===d?f1.bind(null,o):null}function uh(o,a){var d=pa;return o.current.memoizedState.isDehydrated&&(ds(o,a).flags|=256),o=wu(o,a),o!==2&&(a=yn,yn=d,a!==null&&ch(a)),o}function ch(o){yn===null?yn=o:yn.push.apply(yn,o)}function Lx(o){for(var a=o;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var g=0;g<d.length;g++){var v=d[g],P=v.getSnapshot;v=v.value;try{if(!rr(P(),v))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ki(o,a){for(a&=~ih,a&=~pu,o.suspendedLanes|=a,o.pingedLanes&=~a,o=o.expirationTimes;0<a;){var d=31-nr(a),g=1<<d;o[d]=-1,a&=~g}}function h1(o){if(Le&6)throw Error(l(327));hs();var a=Ol(o,0);if(!(a&1))return vn(o,It()),null;var d=wu(o,a);if(o.tag!==0&&d===2){var g=lf(o);g!==0&&(a=g,d=uh(o,g))}if(d===1)throw d=ha,ds(o,0),ki(o,a),vn(o,It()),d;if(d===6)throw Error(l(345));return o.finishedWork=o.current.alternate,o.finishedLanes=a,fs(o,yn,Yr),vn(o,It()),null}function p1(o){Si!==null&&Si.tag===0&&!(Le&6)&&hs();var a=Le;Le|=1;var d=wt.transition,g=Be;try{if(wt.transition=null,Be=1,o)return o()}finally{Be=g,wt.transition=d,Le=a,!(Le&6)&&kr()}}function dh(){Pn=qs.current,Je(qs)}function ds(o,a){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==re&&(o.timeoutHandle=re,Q(d)),kt!==null)for(d=kt.return;d!==null;){var g=d;switch(mf(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&Rl();break;case 3:Ks(),Je(pn),Je(Xt),Pf();break;case 5:Ef(g);break;case 4:Ks();break;case 13:Je(ut);break;case 19:Je(ut);break;case 10:_f(g.type._context);break;case 22:case 23:dh()}d=d.return}if(Lt=o,kt=o=bi(o.current,null),Bt=Pn=a,Tt=0,ha=null,ih=pu=cs=0,yn=pa=null,ls!==null){for(a=0;a<ls.length;a++)if(d=ls[a],g=d.interleaved,g!==null){d.interleaved=null;var v=g.next,P=d.pending;if(P!==null){var L=P.next;P.next=v,g.next=L}d.pending=g}ls=null}return o}function g1(o,a){do{var d=kt;try{if(Sf(),Ql.current=eu,Zl){for(var g=ct.memoizedState;g!==null;){var v=g.queue;v!==null&&(v.pending=null),g=g.next}Zl=!1}if(us=0,Rt=Ct=ct=null,ia=!1,sa=0,rh.current=null,d===null||d.return===null){Tt=1,ha=a,kt=null;break}e:{var P=o,L=d.return,$=d,q=a;if(a=Bt,$.flags|=32768,q!==null&&typeof q=="object"&&typeof q.then=="function"){var ue=q,Se=$,Me=Se.tag;if(!(Se.mode&1)&&(Me===0||Me===11||Me===15)){var ge=Se.alternate;ge?(Se.updateQueue=ge.updateQueue,Se.memoizedState=ge.memoizedState,Se.lanes=ge.lanes):(Se.updateQueue=null,Se.memoizedState=null)}var et=Bm(L);if(et!==null){et.flags&=-257,Um(et,L,$,P,a),et.mode&1&&zm(P,ue,a),a=et,q=ue;var Xe=a.updateQueue;if(Xe===null){var xn=new Set;xn.add(q),a.updateQueue=xn}else Xe.add(q);break e}else{if(!(a&1)){zm(P,ue,a),fh();break e}q=Error(l(426))}}else if(st&&$.mode&1){var Xr=Bm(L);if(Xr!==null){!(Xr.flags&65536)&&(Xr.flags|=256),Um(Xr,L,$,P,a),xf(Qs(q,$));break e}}P=q=Qs(q,$),Tt!==4&&(Tt=2),pa===null?pa=[P]:pa.push(P),P=L;do{switch(P.tag){case 3:P.flags|=65536,a&=-a,P.lanes|=a;var Z=Om(P,q,a);cm(P,Z);break e;case 1:$=q;var H=P.type,J=P.stateNode;if(!(P.flags&128)&&(typeof H.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(wi===null||!wi.has(J)))){P.flags|=65536,a&=-a,P.lanes|=a;var me=Dm(P,$,a);cm(P,me);break e}}P=P.return}while(P!==null)}v1(d)}catch(be){a=be,kt===d&&d!==null&&(kt=d=d.return);continue}break}while(1)}function m1(){var o=hu.current;return hu.current=eu,o===null?eu:o}function fh(){(Tt===0||Tt===3||Tt===2)&&(Tt=4),Lt===null||!(cs&268435455)&&!(pu&268435455)||ki(Lt,Bt)}function wu(o,a){var d=Le;Le|=2;var g=m1();(Lt!==o||Bt!==a)&&(Yr=null,ds(o,a));do try{jx();break}catch(v){g1(o,v)}while(1);if(Sf(),Le=d,hu.current=g,kt!==null)throw Error(l(261));return Lt=null,Bt=0,Tt}function jx(){for(;kt!==null;)y1(kt)}function Fx(){for(;kt!==null&&!lx();)y1(kt)}function y1(o){var a=S1(o.alternate,o,Pn);o.memoizedProps=o.pendingProps,a===null?v1(o):kt=a,rh.current=null}function v1(o){var a=o;do{var d=a.alternate;if(o=a.return,a.flags&32768){if(d=Px(d,a),d!==null){d.flags&=32767,kt=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Tt=6,kt=null;return}}else if(d=Nx(d,a,Pn),d!==null){kt=d;return}if(a=a.sibling,a!==null){kt=a;return}kt=a=o}while(a!==null);Tt===0&&(Tt=5)}function fs(o,a,d){var g=Be,v=wt.transition;try{wt.transition=null,Be=1,Ox(o,a,d,g)}finally{wt.transition=v,Be=g}return null}function Ox(o,a,d,g){do hs();while(Si!==null);if(Le&6)throw Error(l(327));d=o.finishedWork;var v=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(l(177));o.callbackNode=null,o.callbackPriority=0;var P=d.lanes|d.childLanes;if(ax(o,P),o===Lt&&(kt=Lt=null,Bt=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||mu||(mu=!0,_1(hf,function(){return hs(),null})),P=(d.flags&15990)!==0,d.subtreeFlags&15990||P){P=wt.transition,wt.transition=null;var L=Be;Be=1;var $=Le;Le|=4,rh.current=null,Ax(o,d),o1(d,o),X(o.containerInfo),o.current=d,Ix(d),ux(),Le=$,Be=L,wt.transition=P}else o.current=d;if(mu&&(mu=!1,Si=o,yu=v),P=o.pendingLanes,P===0&&(wi=null),fx(d.stateNode),vn(o,It()),a!==null)for(g=o.onRecoverableError,d=0;d<a.length;d++)v=a[d],g(v.value,{componentStack:v.stack,digest:v.digest});if(gu)throw gu=!1,o=ah,ah=null,o;return yu&1&&o.tag!==0&&hs(),P=o.pendingLanes,P&1?o===lh?ga++:(ga=0,lh=o):ga=0,kr(),null}function hs(){if(Si!==null){var o=Qg(yu),a=wt.transition,d=Be;try{if(wt.transition=null,Be=16>o?16:o,Si===null)var g=!1;else{if(o=Si,Si=null,yu=0,Le&6)throw Error(l(331));var v=Le;for(Le|=4,ve=o.current;ve!==null;){var P=ve,L=P.child;if(ve.flags&16){var $=P.deletions;if($!==null){for(var q=0;q<$.length;q++){var ue=$[q];for(ve=ue;ve!==null;){var Se=ve;switch(Se.tag){case 0:case 11:case 15:da(8,Se,P)}var Me=Se.child;if(Me!==null)Me.return=Se,ve=Me;else for(;ve!==null;){Se=ve;var ge=Se.sibling,et=Se.return;if(n1(Se),Se===ue){ve=null;break}if(ge!==null){ge.return=et,ve=ge;break}ve=et}}}var Xe=P.alternate;if(Xe!==null){var xn=Xe.child;if(xn!==null){Xe.child=null;do{var Xr=xn.sibling;xn.sibling=null,xn=Xr}while(xn!==null)}}ve=P}}if(P.subtreeFlags&2064&&L!==null)L.return=P,ve=L;else e:for(;ve!==null;){if(P=ve,P.flags&2048)switch(P.tag){case 0:case 11:case 15:da(9,P,P.return)}var Z=P.sibling;if(Z!==null){Z.return=P.return,ve=Z;break e}ve=P.return}}var H=o.current;for(ve=H;ve!==null;){L=ve;var J=L.child;if(L.subtreeFlags&2064&&J!==null)J.return=L,ve=J;else e:for(L=H;ve!==null;){if($=ve,$.flags&2048)try{switch($.tag){case 0:case 11:case 15:au(9,$)}}catch(be){ot($,$.return,be)}if($===L){ve=null;break e}var me=$.sibling;if(me!==null){me.return=$.return,ve=me;break e}ve=$.return}}if(Le=v,kr(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(Dl,o)}catch{}g=!0}return g}finally{Be=d,wt.transition=a}}return!1}function x1(o,a,d){a=Qs(d,a),a=Om(o,a,1),o=xi(o,a,1),a=qt(),o!==null&&(Jo(o,1,a),vn(o,a))}function ot(o,a,d){if(o.tag===3)x1(o,o,d);else for(;a!==null;){if(a.tag===3){x1(a,o,d);break}else if(a.tag===1){var g=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(wi===null||!wi.has(g))){o=Qs(d,o),o=Dm(a,o,1),a=xi(a,o,1),o=qt(),a!==null&&(Jo(a,1,o),vn(a,o));break}}a=a.return}}function Dx(o,a,d){var g=o.pingCache;g!==null&&g.delete(a),a=qt(),o.pingedLanes|=o.suspendedLanes&d,Lt===o&&(Bt&d)===d&&(Tt===4||Tt===3&&(Bt&130023424)===Bt&&500>It()-sh?ds(o,0):ih|=d),vn(o,a)}function w1(o,a){a===0&&(o.mode&1?(a=Fl,Fl<<=1,!(Fl&130023424)&&(Fl=4194304)):a=1);var d=qt();o=br(o,a),o!==null&&(Jo(o,a,d),vn(o,d))}function zx(o){var a=o.memoizedState,d=0;a!==null&&(d=a.retryLane),w1(o,d)}function Bx(o,a){var d=0;switch(o.tag){case 13:var g=o.stateNode,v=o.memoizedState;v!==null&&(d=v.retryLane);break;case 19:g=o.stateNode;break;default:throw Error(l(314))}g!==null&&g.delete(a),w1(o,d)}var S1;S1=function(o,a,d){if(o!==null)if(o.memoizedProps!==a.pendingProps||pn.current)mn=!0;else{if(!(o.lanes&d)&&!(a.flags&128))return mn=!1,Ex(o,a,d);mn=!!(o.flags&131072)}else mn=!1,st&&a.flags&1048576&&Jg(a,Ul,a.index);switch(a.lanes=0,a.tag){case 2:var g=a.type;ru(o,a),o=a.pendingProps;var v=Us(a,Xt.current);Ys(a,d),v=If(null,a,g,o,v,d);var P=Rf();return a.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,gn(g)?(P=!0,Ll(a)):P=!1,a.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,Cf(a),v.updater=tu,a.stateNode=v,v._reactInternals=a,zf(a,g,o,d),a=Vf(null,a,g,!0,P,d)):(a.tag=0,st&&P&&gf(a),on(null,a,v,d),a=a.child),a;case 16:g=a.elementType;e:{switch(ru(o,a),o=a.pendingProps,v=g._init,g=v(g._payload),a.type=g,v=a.tag=Gx(g),o=sr(g,o),v){case 0:a=Gf(null,a,g,o,d);break e;case 1:a=Ym(null,a,g,o,d);break e;case 11:a=Gm(null,a,g,o,d);break e;case 14:a=Vm(null,a,g,sr(g.type,o),d);break e}throw Error(l(306,g,""))}return a;case 0:return g=a.type,v=a.pendingProps,v=a.elementType===g?v:sr(g,v),Gf(o,a,g,v,d);case 1:return g=a.type,v=a.pendingProps,v=a.elementType===g?v:sr(g,v),Ym(o,a,g,v,d);case 3:e:{if(Xm(a),o===null)throw Error(l(387));g=a.pendingProps,P=a.memoizedState,v=P.element,um(o,a),Xl(a,g,null,d);var L=a.memoizedState;if(g=L.element,pe&&P.isDehydrated)if(P={element:g,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},a.updateQueue.baseState=P,a.memoizedState=P,a.flags&256){v=Qs(Error(l(423)),a),a=Km(o,a,g,d,v);break e}else if(g!==v){v=Qs(Error(l(424)),a),a=Km(o,a,g,d,v);break e}else for(pe&&(Bn=G4(a.stateNode.containerInfo),Nn=a,st=!0,ir=null,ea=!1),d=om(a,null,g,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ws(),g===v){a=Hr(o,a,d);break e}on(o,a,g,d)}a=a.child}return a;case 5:return fm(a),o===null&&vf(a),g=a.type,v=a.pendingProps,P=o!==null?o.memoizedProps:null,L=v.children,ce(g,v)?L=null:P!==null&&ce(g,P)&&(a.flags|=32),Hm(o,a),on(o,a,L,d),a.child;case 6:return o===null&&vf(a),null;case 13:return Qm(o,a,d);case 4:return Tf(a,a.stateNode.containerInfo),g=a.pendingProps,o===null?a.child=$s(a,null,g,d):on(o,a,g,d),a.child;case 11:return g=a.type,v=a.pendingProps,v=a.elementType===g?v:sr(g,v),Gm(o,a,g,v,d);case 7:return on(o,a,a.pendingProps,d),a.child;case 8:return on(o,a,a.pendingProps.children,d),a.child;case 12:return on(o,a,a.pendingProps.children,d),a.child;case 10:e:{if(g=a.type._context,v=a.pendingProps,P=a.memoizedProps,L=v.value,am(a,g,L),P!==null)if(rr(P.value,L)){if(P.children===v.children&&!pn.current){a=Hr(o,a,d);break e}}else for(P=a.child,P!==null&&(P.return=a);P!==null;){var $=P.dependencies;if($!==null){L=P.child;for(var q=$.firstContext;q!==null;){if(q.context===g){if(P.tag===1){q=$r(-1,d&-d),q.tag=2;var ue=P.updateQueue;if(ue!==null){ue=ue.shared;var Se=ue.pending;Se===null?q.next=q:(q.next=Se.next,Se.next=q),ue.pending=q}}P.lanes|=d,q=P.alternate,q!==null&&(q.lanes|=d),kf(P.return,d,a),$.lanes|=d;break}q=q.next}}else if(P.tag===10)L=P.type===a.type?null:P.child;else if(P.tag===18){if(L=P.return,L===null)throw Error(l(341));L.lanes|=d,$=L.alternate,$!==null&&($.lanes|=d),kf(L,d,a),L=P.sibling}else L=P.child;if(L!==null)L.return=P;else for(L=P;L!==null;){if(L===a){L=null;break}if(P=L.sibling,P!==null){P.return=L.return,L=P;break}L=L.return}P=L}on(o,a,v.children,d),a=a.child}return a;case 9:return v=a.type,g=a.pendingProps.children,Ys(a,d),v=Un(v),g=g(v),a.flags|=1,on(o,a,g,d),a.child;case 14:return g=a.type,v=sr(g,a.pendingProps),v=sr(g.type,v),Vm(o,a,g,v,d);case 15:return Wm(o,a,a.type,a.pendingProps,d);case 17:return g=a.type,v=a.pendingProps,v=a.elementType===g?v:sr(g,v),ru(o,a),a.tag=1,gn(g)?(o=!0,Ll(a)):o=!1,Ys(a,d),jm(a,g,v),zf(a,g,v,d),Vf(null,a,g,!0,o,d);case 19:return qm(o,a,d);case 22:return $m(o,a,d)}throw Error(l(156,a.tag))};function _1(o,a){return df(o,a)}function Ux(o,a,d,g){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $n(o,a,d,g){return new Ux(o,a,d,g)}function hh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Gx(o){if(typeof o=="function")return hh(o)?1:0;if(o!=null){if(o=o.$$typeof,o===b)return 11;if(o===T)return 14}return 2}function bi(o,a){var d=o.alternate;return d===null?(d=$n(o.tag,a,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=a,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,a=o.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function Su(o,a,d,g,v,P){var L=2;if(g=o,typeof o=="function")hh(o)&&(L=1);else if(typeof o=="string")L=5;else e:switch(o){case p:return ps(d.children,v,P,a);case m:L=8,v|=8;break;case w:return o=$n(12,d,a,v|2),o.elementType=w,o.lanes=P,o;case _:return o=$n(13,d,a,v),o.elementType=_,o.lanes=P,o;case S:return o=$n(19,d,a,v),o.elementType=S,o.lanes=P,o;case k:return _u(d,v,P,a);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case y:L=10;break e;case x:L=9;break e;case b:L=11;break e;case T:L=14;break e;case h:L=16,g=null;break e}throw Error(l(130,o==null?o:typeof o,""))}return a=$n(L,d,a,v),a.elementType=o,a.type=g,a.lanes=P,a}function ps(o,a,d,g){return o=$n(7,o,g,a),o.lanes=d,o}function _u(o,a,d,g){return o=$n(22,o,g,a),o.elementType=k,o.lanes=d,o.stateNode={isHidden:!1},o}function ph(o,a,d){return o=$n(6,o,null,a),o.lanes=d,o}function gh(o,a,d){return a=$n(4,o.children!==null?o.children:[],o.key,a),a.lanes=d,a.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},a}function Vx(o,a,d,g,v){this.tag=a,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=re,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uf(0),this.expirationTimes=uf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uf(0),this.identifierPrefix=g,this.onRecoverableError=v,pe&&(this.mutableSourceEagerHydrationData=null)}function k1(o,a,d,g,v,P,L,$,q){return o=new Vx(o,a,d,$,q),a===1?(a=1,P===!0&&(a|=8)):a=0,P=$n(3,null,null,a),o.current=P,P.stateNode=o,P.memoizedState={element:g,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cf(P),o}function b1(o){if(!o)return yi;o=o._reactInternals;e:{if(R(o)!==o||o.tag!==1)throw Error(l(170));var a=o;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(gn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(l(171))}if(o.tag===1){var d=o.type;if(gn(d))return Yg(o,d,a)}return a}function C1(o){var a=o._reactInternals;if(a===void 0)throw typeof o.render=="function"?Error(l(188)):(o=Object.keys(o).join(","),Error(l(268,o)));return o=z(a),o===null?null:o.stateNode}function T1(o,a){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<a?d:a}}function ku(o,a){T1(o,a),(o=o.alternate)&&T1(o,a)}function Wx(o){return o=z(o),o===null?null:o.stateNode}function $x(){return null}return n.attemptContinuousHydration=function(o){if(o.tag===13){var a=br(o,134217728);if(a!==null){var d=qt();Wn(a,o,134217728,d)}ku(o,134217728)}},n.attemptDiscreteHydration=function(o){if(o.tag===13){var a=br(o,1);if(a!==null){var d=qt();Wn(a,o,1,d)}ku(o,1)}},n.attemptHydrationAtCurrentPriority=function(o){if(o.tag===13){var a=_i(o),d=br(o,a);if(d!==null){var g=qt();Wn(d,o,a,g)}ku(o,a)}},n.attemptSynchronousHydration=function(o){switch(o.tag){case 3:var a=o.stateNode;if(a.current.memoizedState.isDehydrated){var d=qo(a.pendingLanes);d!==0&&(cf(a,d|1),vn(a,It()),!(Le&6)&&(Js(),kr()))}break;case 13:p1(function(){var g=br(o,1);if(g!==null){var v=qt();Wn(g,o,1,v)}}),ku(o,1)}},n.batchedUpdates=function(o,a){var d=Le;Le|=1;try{return o(a)}finally{Le=d,Le===0&&(Js(),zl&&kr())}},n.createComponentSelector=function(o){return{$$typeof:lu,value:o}},n.createContainer=function(o,a,d,g,v,P,L){return k1(o,a,!1,null,d,g,v,P,L)},n.createHasPseudoClassSelector=function(o){return{$$typeof:uu,value:o}},n.createHydrationContainer=function(o,a,d,g,v,P,L,$,q){return o=k1(d,g,!0,o,v,P,L,$,q),o.context=b1(null),d=o.current,g=qt(),v=_i(d),P=$r(g,v),P.callback=a??null,xi(d,P,v),o.current.lanes=v,Jo(o,v,g),vn(o,g),o},n.createPortal=function(o,a,d){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:g==null?null:""+g,children:o,containerInfo:a,implementation:d}},n.createRoleSelector=function(o){return{$$typeof:cu,value:o}},n.createTestNameSelector=function(o){return{$$typeof:du,value:o}},n.createTextSelector=function(o){return{$$typeof:fu,value:o}},n.deferredUpdates=function(o){var a=Be,d=wt.transition;try{return wt.transition=null,Be=16,o()}finally{Be=a,wt.transition=d}},n.discreteUpdates=function(o,a,d,g,v){var P=Be,L=wt.transition;try{return wt.transition=null,Be=1,o(a,d,g,v)}finally{Be=P,wt.transition=L,Le===0&&Js()}},n.findAllNodes=nh,n.findBoundingRects=function(o,a){if(!Yt)throw Error(l(363));a=nh(o,a),o=[];for(var d=0;d<a.length;d++)o.push(Fn(a[d]));for(a=o.length-1;0<a;a--){d=o[a];for(var g=d.x,v=g+d.width,P=d.y,L=P+d.height,$=a-1;0<=$;$--)if(a!==$){var q=o[$],ue=q.x,Se=ue+q.width,Me=q.y,ge=Me+q.height;if(g>=ue&&P>=Me&&v<=Se&&L<=ge){o.splice(a,1);break}else if(g!==ue||d.width!==q.width||ge<P||Me>L){if(!(P!==Me||d.height!==q.height||Se<g||ue>v)){ue>g&&(q.width+=ue-g,q.x=g),Se<v&&(q.width=v-ue),o.splice(a,1);break}}else{Me>P&&(q.height+=Me-P,q.y=P),ge<L&&(q.height=L-Me),o.splice(a,1);break}}}return o},n.findHostInstance=C1,n.findHostInstanceWithNoPortals=function(o){return o=j(o),o=o!==null?V(o):null,o===null?null:o.stateNode},n.findHostInstanceWithWarning=function(o){return C1(o)},n.flushControlled=function(o){var a=Le;Le|=1;var d=wt.transition,g=Be;try{wt.transition=null,Be=1,o()}finally{Be=g,wt.transition=d,Le=a,Le===0&&(Js(),kr())}},n.flushPassiveEffects=hs,n.flushSync=p1,n.focusWithin=function(o,a){if(!Yt)throw Error(l(363));for(o=Jf(o),a=d1(o,a),a=Array.from(a),o=0;o<a.length;){var d=a[o++];if(!it(d)){if(d.tag===5&&pi(d.stateNode))return!0;for(d=d.child;d!==null;)a.push(d),d=d.sibling}}return!1},n.getCurrentUpdatePriority=function(){return Be},n.getFindAllNodesFailureDescription=function(o,a){if(!Yt)throw Error(l(363));var d=0,g=[];o=[Jf(o),0];for(var v=0;v<o.length;){var P=o[v++],L=o[v++],$=a[L];if((P.tag!==5||!it(P))&&(eh(P,$)&&(g.push(th($)),L++,L>d&&(d=L)),L<a.length))for(P=P.child;P!==null;)o.push(P,L),P=P.sibling}if(d<a.length){for(o=[];d<a.length;d++)o.push(th(a[d]));return`findAllNodes was able to match part of the selector:
  `+(g.join(" > ")+`

No matching component was found for:
  `)+o.join(" > ")}return null},n.getPublicRootInstance=function(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return U(o.child.stateNode);default:return o.child.stateNode}},n.injectIntoDevTools=function(o){if(o={bundleType:o.bundleType,version:o.version,rendererPackageName:o.rendererPackageName,rendererConfig:o.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:c.ReactCurrentDispatcher,findHostInstanceByFiber:Wx,findFiberByHostInstance:o.findFiberByHostInstance||$x,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")o=!1;else{var a=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(a.isDisabled||!a.supportsFiber)o=!0;else{try{Dl=a.inject(o),_r=a}catch{}o=!!a.checkDCE}}return o},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(o,a,d,g){if(!Yt)throw Error(l(363));o=nh(o,a);var v=zr(o,d,g).disconnect;return{disconnect:function(){v()}}},n.registerMutableSourceForHydration=function(o,a){var d=a._getVersion;d=d(a._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[a,d]:o.mutableSourceEagerHydrationData.push(a,d)},n.runWithPriority=function(o,a){var d=Be;try{return Be=o,a()}finally{Be=d}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(o,a,d,g){var v=a.current,P=qt(),L=_i(v);return d=b1(d),a.context===null?a.context=d:a.pendingContext=d,a=$r(P,L),a.payload={element:o},g=g===void 0?null:g,g!==null&&(a.callback=g),o=xi(v,a,L),o!==null&&(Wn(o,v,L,P),Yl(o,v,L)),L},n};_4.exports=OC;var DC=_4.exports;const zC=xl(DC);var k4={exports:{}},zs={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */zs.ConcurrentRoot=1;zs.ContinuousEventPriority=4;zs.DefaultEventPriority=16;zs.DiscreteEventPriority=1;zs.IdleEventPriority=536870912;zs.LegacyRoot=0;k4.exports=zs;var b4=k4.exports;const $2={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let H2=!1,Y2=!1;const Dg=".react-konva-event",BC=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,UC=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,GC={};function ef(t,e,n=GC){if(!H2&&"zIndex"in e&&(console.warn(UC),H2=!0),!Y2&&e.draggable){var r=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;r&&!i&&(console.warn(BC),Y2=!0)}for(var s in n)if(!$2[s]){var l=s.slice(0,2)==="on",c=n[s]!==e[s];if(l&&c){var u=s.substr(2).toLowerCase();u.substr(0,7)==="content"&&(u="content"+u.substr(7,1).toUpperCase()+u.substr(8)),t.off(u,n[s])}var f=!e.hasOwnProperty(s);f&&t.setAttr(s,void 0)}var p=e._useStrictMode,m={},w=!1;const y={};for(var s in e)if(!$2[s]){var l=s.slice(0,2)==="on",x=n[s]!==e[s];if(l&&x){var u=s.substr(2).toLowerCase();u.substr(0,7)==="content"&&(u="content"+u.substr(7,1).toUpperCase()+u.substr(8)),e[s]&&(y[u]=e[s])}!l&&(e[s]!==n[s]||p&&e[s]!==t.getAttr(s))&&(w=!0,m[s]=e[s])}w&&(t.setAttrs(m),rs(t));for(var u in y)t.on(u+Dg,y[u])}function rs(t){if(!Re.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}const C4={},VC={};yl.Node.prototype._applyProps=ef;function WC(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),rs(t)}function $C(t,e,n){let r=yl[t];r||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),r=yl.Group);const i={},s={};for(var l in e){var c=l.slice(0,2)==="on";c?s[l]=e[l]:i[l]=e[l]}const u=new r(i);return ef(u,s),u}function HC(t,e,n){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function YC(t,e,n){return!1}function XC(t){return t}function KC(){return null}function QC(){return null}function ZC(t,e,n,r){return VC}function qC(){}function JC(t){}function eT(t,e){return!1}function tT(){return C4}function nT(){return C4}const rT=setTimeout,iT=clearTimeout,sT=-1;function oT(t,e){return!1}const aT=!1,lT=!0,uT=!0;function cT(t,e){e.parent===t?e.moveToTop():t.add(e),rs(t)}function dT(t,e){e.parent===t?e.moveToTop():t.add(e),rs(t)}function T4(t,e,n){e._remove(),t.add(e),e.setZIndex(n.getZIndex()),rs(t)}function fT(t,e,n){T4(t,e,n)}function hT(t,e){e.destroy(),e.off(Dg),rs(t)}function pT(t,e){e.destroy(),e.off(Dg),rs(t)}function gT(t,e,n){console.error(`Text components are not yet supported in ReactKonva. You text is: "${n}"`)}function mT(t,e,n){}function yT(t,e,n,r,i){ef(t,i,r)}function vT(t){t.hide(),rs(t)}function xT(t){}function wT(t,e){(e.visible==null||e.visible)&&t.show()}function ST(t,e){}function _T(t){}function kT(){}const bT=()=>b4.DefaultEventPriority,CT=Object.freeze(Object.defineProperty({__proto__:null,appendChild:cT,appendChildToContainer:dT,appendInitialChild:WC,cancelTimeout:iT,clearContainer:_T,commitMount:mT,commitTextUpdate:gT,commitUpdate:yT,createInstance:$C,createTextInstance:HC,detachDeletedInstance:kT,finalizeInitialChildren:YC,getChildHostContext:nT,getCurrentEventPriority:bT,getPublicInstance:XC,getRootHostContext:tT,hideInstance:vT,hideTextInstance:xT,idlePriority:Oa.unstable_IdlePriority,insertBefore:T4,insertInContainerBefore:fT,isPrimaryRenderer:aT,noTimeout:sT,now:Oa.unstable_now,prepareForCommit:KC,preparePortalMount:QC,prepareUpdate:ZC,removeChild:hT,removeChildFromContainer:pT,resetAfterCommit:qC,resetTextContent:JC,run:Oa.unstable_runWithPriority,scheduleTimeout:rT,shouldDeprioritizeSubtree:eT,shouldSetTextContent:oT,supportsMutation:uT,unhideInstance:wT,unhideTextInstance:ST,warnsIfNotActing:lT},Symbol.toStringTag,{value:"Module"}));var TT=Object.defineProperty,ET=Object.defineProperties,NT=Object.getOwnPropertyDescriptors,X2=Object.getOwnPropertySymbols,PT=Object.prototype.hasOwnProperty,MT=Object.prototype.propertyIsEnumerable,K2=(t,e,n)=>e in t?TT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Q2=(t,e)=>{for(var n in e||(e={}))PT.call(e,n)&&K2(t,n,e[n]);if(X2)for(var n of X2(e))MT.call(e,n)&&K2(t,n,e[n]);return t},AT=(t,e)=>ET(t,NT(e)),Z2,q2;typeof window<"u"&&((Z2=window.document)!=null&&Z2.createElement||((q2=window.navigator)==null?void 0:q2.product)==="ReactNative")?O.useLayoutEffect:O.useEffect;function E4(t,e,n){if(!t)return;if(n(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const i=E4(r,e,n);if(i)return i;r=e?null:r.sibling}}function N4(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const J2=console.error;console.error=function(){const t=[...arguments].join("");if(t!=null&&t.startsWith("Warning:")&&t.includes("useContext")){console.error=J2;return}return J2.apply(this,arguments)};const zg=N4(O.createContext(null));class P4 extends O.Component{render(){return O.createElement(zg.Provider,{value:this._reactInternals},this.props.children)}}function IT(){const t=O.useContext(zg);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=O.useId();return O.useMemo(()=>{for(const r of[t,t==null?void 0:t.alternate]){if(!r)continue;const i=E4(r,!1,s=>{let l=s.memoizedState;for(;l;){if(l.memoizedState===e)return!0;l=l.next}});if(i)return i}},[t,e])}function RT(){const t=IT(),[e]=O.useState(()=>new Map);e.clear();let n=t;for(;n;){if(n.type&&typeof n.type=="object"){const i=n.type._context===void 0&&n.type.Provider===n.type?n.type:n.type._context;i&&i!==zg&&!e.has(i)&&e.set(i,O.useContext(N4(i)))}n=n.return}return e}function LT(){const t=RT();return O.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>O.createElement(e,null,O.createElement(n.Provider,AT(Q2({},r),{value:t.get(n)}))),e=>O.createElement(P4,Q2({},e))),[t])}function jT(t){const e=tn.useRef({});return tn.useLayoutEffect(()=>{e.current=t}),tn.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const FT=t=>{const e=tn.useRef(),n=tn.useRef(),r=tn.useRef(),i=jT(t),s=LT(),l=c=>{const{forwardedRef:u}=t;u&&(typeof u=="function"?u(c):u.current=c)};return tn.useLayoutEffect(()=>(n.current=new yl.Stage({width:t.width,height:t.height,container:e.current}),l(n.current),r.current=Fa.createContainer(n.current,b4.LegacyRoot,!1,null),Fa.updateContainer(tn.createElement(s,{},t.children),r.current),()=>{yl.isBrowser&&(l(null),Fa.updateContainer(null,r.current,null),n.current.destroy())}),[]),tn.useLayoutEffect(()=>{l(n.current),ef(n.current,t,i),Fa.updateContainer(tn.createElement(s,{},t.children),r.current,null)}),tn.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},$c="Layer",tf="Group",Hc="Rect",vl="Circle",bp="Line",Qn="Text",OT="Arrow",Fa=zC(CT);Fa.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:tn.version,rendererPackageName:"react-konva"});const DT=tn.forwardRef((t,e)=>tn.createElement(P4,{},tn.createElement(FT,{...t,forwardedRef:e}))),M4=()=>{const{elements:t,setElements:e,arcStart:n,setArcStart:r,setTempArcEnd:i,setSelectedElement:s,snapToGrid:l,gridSnappingEnabled:c}=$t(),u=O.useCallback((w,y)=>{if(w.id===y.id)return;if(w.type===y.type){console.warn("Invalid arc: Cannot connect elements of the same type."),r(null),i(null),s(null);return}const x={id:Wi(),source:w.id,target:y.id,weight:1,anglePoints:[],sourceType:w.type,targetType:y.type};e(b=>({...b,arcs:[...b.arcs,x]})),r(null),i(null),s(null)},[e,r,i,s]),f=O.useCallback((w,y)=>{e(x=>{const b=x.arcs.map(_=>{if(_.id===w){const S=c?l(y.x,y.y):y,T=_.anglePoints?[..._.anglePoints]:[];return T.push(S),{..._,anglePoints:T}}return _});return{...x,arcs:b}})},[e,c,l]),p=O.useCallback((w,y,x)=>{e(b=>{const _=b.arcs.map(S=>{if(S.id===w&&S.anglePoints&&S.anglePoints[y]){const T=c?l(x.x,x.y):x,h=[...S.anglePoints];return h[y]=T,{...S,anglePoints:h}}return S});return{...b,arcs:_}})},[e,c,l]),m=O.useCallback((w,y)=>{e(x=>{const b=x.arcs.map(_=>{if(_.id===w&&_.anglePoints&&_.anglePoints[y]){const S=[..._.anglePoints];return S.splice(y,1),{..._,anglePoints:S}}return _});return{...x,arcs:b}})},[e]);return{handleCompleteArc:u,handleAddAnglePoint:f,handleDragAnglePoint:p,handleDeleteAnglePoint:m}};function ev(t,e){if(!t||!e)return!1;const n=Math.min(e.x,e.x+e.w),r=Math.min(e.y,e.y+e.h),i=Math.max(e.x,e.x+e.w),s=Math.max(e.y,e.y+e.h);return t.x>=n&&t.x<=i&&t.y>=r&&t.y<=s}function tv(t,e){if(!t||!e)return[];const n=[];return(t.places||[]).forEach(r=>{ev({x:r.x,y:r.y},e)&&n.push({id:r.id,type:"place"})}),(t.transitions||[]).forEach(r=>{ev({x:r.x,y:r.y},e)&&n.push({id:r.id,type:"transition"})}),n}function zT(t,e){return t.some(r=>r.id===e.id&&r.type===e.type)?t.filter(r=>!(r.id===e.id&&r.type===e.type)):[...t,e]}function A4(t,e,n,r={}){if(!e||!e.startPositions)return t;const{dx:i,dy:s}=n||{dx:0,dy:0},{gridSnappingEnabled:l=!1,snapToGrid:c=(x,b)=>({x,y:b})}=r,u=e.startPositions;if(u.size===0)return t;const f=new Map((t.places||[]).map(x=>[x.id,x])),p=new Map((t.transitions||[]).map(x=>[x.id,x])),m=new Map,w=new Map;for(const[x,b]of u){const _=l?c(b.x+i,b.y+s):{x:b.x+i,y:b.y+s};if(b.type==="place"){const S=f.get(x);S&&m.set(x,{...S,x:_.x,y:_.y})}else if(b.type==="transition"){const S=p.get(x);S&&w.set(x,{...S,x:_.x,y:_.y})}}const y={...t};return m.size>0&&(y.places=(t.places||[]).map(x=>m.get(x.id)||x)),w.size>0&&(y.transitions=(t.transitions||[]).map(x=>w.get(x.id)||x)),e.startArcPoints&&e.startArcPoints.size>0&&(y.arcs=(t.arcs||[]).map(x=>{const b=e.startArcPoints.get(x.id);if(!b)return x;const _=b.map(S=>({x:S.x+i,y:S.y+s}));return{...x,anglePoints:_}})),y}const Bg=()=>{var I,j;const{gridSnappingEnabled:t}=Go(),{elements:e,setElements:n,selectedElement:r,setSelectedElement:i,selectedElements:s,setSelectedElements:l,isIdSelected:c,setSelection:u,mode:f,arcStart:p,setArcStart:m,tempArcEnd:w,setTempArcEnd:y,snapToGrid:x,isShiftPressedRef:b,pasteMode:_,setPasteMode:S}=$t(),{handleCompleteArc:T}=M4(),h=O.useCallback(()=>{if(!r)return;const{type:z,id:W}=r;let V=JSON.parse(JSON.stringify(e));z==="place"?(V.places=V.places.filter(D=>D.id!==W),V.arcs=V.arcs.filter(D=>D.source!==W&&D.target!==W)):z==="transition"?(V.transitions=V.transitions.filter(D=>D.id!==W),V.arcs=V.arcs.filter(D=>D.source!==W&&D.target!==W)):z==="arc"&&(V.arcs=V.arcs.filter(D=>D.id!==W)),n(V),i(null)},[r,e,n,i]),k=O.useCallback(()=>{n({places:[],transitions:[],arcs:[]}),i(null),m(null),y(null)},[n,i,m,y]),C=O.useCallback(z=>{var V,D;if(!z)return;let W=t?x(z.x,z.y):z;if(f==="place"){const U=((V=e==null?void 0:e.places)==null?void 0:V.length)||0,G={id:Wi(),x:W.x,y:W.y,label:`P${U+1}`,tokens:0};n(F=>({...F,places:[...(F==null?void 0:F.places)||[],G]}))}else if(f==="transition"){const U=((D=e==null?void 0:e.transitions)==null?void 0:D.length)||0,G={id:Wi(),x:W.x,y:W.y,label:`T${U+1}`};n(F=>({...F,transitions:[...(F==null?void 0:F.transitions)||[],G]}))}},[f,(I=e==null?void 0:e.places)==null?void 0:I.length,(j=e==null?void 0:e.transitions)==null?void 0:j.length,n,x,t]),N=O.useCallback((z,W,V)=>{var F,Y;let D=null,U=null,G=null;typeof V<"u"?(D=z,U=W,G=V):(U=z,G=W),_&&typeof S=="function"&&S(!1),f==="select"||f==="arc_angle"?(!!(D&&((F=D.evt)!=null&&F.shiftKey||(Y=D.evt)!=null&&Y.getModifierState&&D.evt.getModifierState("Shift")))||!!(b&&b.current)?(l(te=>zT(te,{id:U.id,type:G})),i({...U,type:G})):u([{id:U.id,type:G}]),m(null),y(null)):f==="arc"&&(p?T(p.element,{...U,type:G}):(i({...U,type:G}),m({element:{id:U.id,type:G},point:{x:U.x,y:U.y}}),y({sourcePoint:{x:U.x,y:U.y},x:U.x,y:U.y,potentialTarget:null})))},[f,p,i,l,c,u,m,y,T]),A=O.useCallback((z,W,V)=>{const D=t?x(V.x,V.y):V;n(U=>{const G={...U};return W==="place"?G.places=U.places.map(F=>F.id===z.id?{...F,x:D.x,y:D.y}:F):W==="transition"&&(G.transitions=U.transitions.map(F=>F.id===z.id?{...F,x:D.x,y:D.y}:F)),G})},[n,t,x]),M=O.useCallback(z=>Dc(e,z),[e]),R=O.useCallback((z,W={x:40,y:40})=>{if(!z)return null;const{newPlaces:V,newTransitions:D,newArcs:U,newSelection:G}=zc(z,Wi,W);return n(F=>({...F,places:[...F.places,...V],transitions:[...F.transitions,...D],arcs:[...F.arcs,...U]})),G},[n]);return{handleDeleteElement:h,clearAllElements:k,handleCreateElement:C,handleElementClick:N,handleElementDragEnd:A,collectClipboard:M,pasteClipboard:R}},BT=30,UT=4,GT=4,Ug=4,hr=2,VT=12,Cp=10,WT=10,Gg=.48,c0=.25,$T={},I4=new WeakMap;function Yu(t,e,n){return I4.set(t,{baseRadius:e,visuals:n}),n}function HT(t,e,n=2){const r=t.x+t.width,i=t.y+t.height,s=e.x+e.width,l=e.y+e.height;return!(r+n<=e.x||s+n<=t.x||i+n<=e.y||l+n<=t.y)}function YT(t){if(t<=0)return[];const e=[[t]];if(t>=4){const n=Math.min(6,t-1);for(let r=n;r>=Math.ceil(t/2);r-=1){const i=t-r;i>=1&&e.push([r,i])}}if(t>=7){const n=Math.min(6,t-3),r=Math.max(2,Math.ceil((t-n)/2)),i=t-n-r;i>0&&e.push([n,r,i])}return e}function XT(t,e,n){const r=[...e].sort((l,c)=>n[c].width-n[l].width),i=[];let s=0;for(let l=0;l<t.length;l+=1){const c=t[l],u=r.slice(s,s+c);if(u.length<c)return null;i.push(u),s+=c}return i}function KT(t,e,n,r,i){const s=t.length;if(s===0)return[];const l=new Array(s),c=t[0],u=Math.max(...c.map(_=>e[_].diagonal),r);let f=n-u-hr;if(f<=0)return null;const p=i?i+r+hr:r+hr;if(s===1)return l[0]=Math.max(f,p),l;const m=t[s-1],w=Math.max(...m.map(_=>e[_].diagonal),r),y=Math.max(p,w+hr),x=f-y,b=Math.max(r+hr,x/s);l[0]=f;for(let _=1;_<s;_+=1){const T=l[_-1]-b,h=t[_],k=Math.max(...h.map(N=>e[N].diagonal),r),C=Math.max(k+hr,p);if(l[_]=Math.max(T,C),l[_]<=0)return null}return l[s-1]<y&&(l[s-1]=y),l}function cc(t,e,n){if(!t||t.length===0)return e;let r=0;t.forEach(s=>{const l=s.x+s.width/2,c=s.y+s.height/2,u=Math.hypot(s.width/2,s.height/2),f=Math.hypot(l,c)+u+Ug;f>r&&(r=f)});const i=Math.ceil(r);return i>n&&n>=e?n:Math.max(e,i)}function dc(t){return typeof t=="boolean"?t?"T":"F":typeof t=="string"?`'${t}'`:Array.isArray(t)?`[${t.map(dc).join(", ")}]`:t&&typeof t=="object"&&t.__pair__?`(${dc(t.fst)}, ${dc(t.snd)})`:String(t)}function R4(t,e){return t.length?Math.max(e,t.length*e*Gg):e}function QT(t,e,n){const r=t.length;if(r===0)return null;const i=e-Ug;if(i<=0)return null;const s=i*2,l=[];for(let u=1;u<=r;u+=1){const f=Math.ceil(r/u);u===1&&r>4||f===1&&r>4||l.push({cols:u,rows:f})}l.sort((u,f)=>{const p=Math.abs(u.cols-u.rows)-Math.abs(f.cols-f.rows);return p!==0?p:u.cols-f.cols});const c=Math.max(...t.map(u=>u.length||1),1);for(const u of l){const f=u.cols,p=u.rows,m=s-hr*(f-1),w=s-hr*(p-1);if(m<=0||w<=0)continue;const y=m/f,x=w/p,b=x*.8,_=y/(c*Gg||1),S=Math.min(VT,b,_);if(S<Cp)continue;const T=[];let h=!0;const k=y+hr,C=x+hr,N=k*(f-1),A=C*(p-1),M=-N/2,R=-A/2;if(t.forEach((I,j)=>{if(!h)return;const z=Math.floor(j/f),W=j%f,V=r-z*f,D=z===p-1?Math.min(V,f):f,G=M+(f-D)*k/2+W*k,F=R+z*C,X=R4(I,S)/2,te=S/2,K=Math.hypot(X,te);if(Math.hypot(G,F)+K>i){h=!1;return}T.push({key:`token-${j}`,text:I,fontSize:S,x:G-y/2,y:F-S/2,width:y,height:S})}),h)return{radius:cc(T,n,e),layout:T}}return null}function ZT(t,e,n){const r=t.length;if(r===0)return{layout:[],radius:n};const i=e-Ug;if(i<=0)return null;const s=Math.max(...t.map(f=>f.length||1),1),l=Math.max(Cp,Math.min(12,i*2/(s*Gg))),c=t.map((f,p)=>p),u=f=>{const p=c.map(S=>{const T=R4(t[S],f);return{width:T,halfWidth:T/2,halfHeight:f/2,diagonal:Math.hypot(T/2,f/2)}});if(r===1){const S=p[0];if(S.diagonal>i)return null;const T=S.width*(1+c0),h=[{key:"token-0",text:t[0],fontSize:f,x:-T/2,y:-S.halfHeight,width:T,height:f}];return{layout:h,radius:cc(h,n,e)}}let m=null,w=0;if(r%2===1&&r>1){const T=[...c].sort((M,R)=>p[R].width-p[M].width)[0],h=p[T].diagonal,k=c.filter(M=>M!==T),C=k.length?Math.max(...k.map(M=>p[M].diagonal)):0,N=h+f*.5;i-C-2>=N&&(m=T,w=h)}const y=new Array(r);if(m!==null){const S=p[m];if(S.diagonal>i)return null;const T=S.width*(1+c0);y[m]={key:`token-${m}`,text:t[m],fontSize:f,x:-T/2,y:-S.halfHeight,width:T,height:f}}const x=c.filter(S=>S!==m);if(x.length===0){const S=y.filter(Boolean);return{layout:S,radius:cc(S,n,e)}}const b=y.slice(),_=YT(x.length);for(const S of _){const T=XT(S,x,p);if(!T)continue;const h=KT(T,p,i,f,w);if(!h)continue;const k=b.slice();let C=!0;if(T.forEach((M,R)=>{const I=h[R],j=M.length;if(!j)return;const z=R%2===1?Math.PI/j:0;M.forEach((W,V)=>{if(!C)return;const D=p[W],U=D.width*(1+c0),G=U/2,F=-Math.PI/2+2*Math.PI*V/j+z,Y=Math.cos(F)*I,X=Math.sin(F)*I;if(Math.hypot(Y,X)+D.diagonal>i+hr){C=!1;return}k[W]={key:`token-${W}`,text:t[W],fontSize:f,x:Y-G,y:X-D.halfHeight,width:U,height:f}})}),!C)continue;const N=k.filter(Boolean);if(N.length!==r)continue;let A=!1;for(let M=0;M<N.length;M+=1){for(let R=M+1;R<N.length;R+=1)if(HT(N[M],N[R])){A=!0;break}if(A)break}if(!A){const M=cc(N,n,e);return{layout:N,radius:M}}}return null};for(let f=l;f>=Cp;f-=.5){const p=u(f);if(p&&p.layout&&p.layout.length===r)return p}return null}function L4(t,e=BT){var c;const n=Array.isArray(t)?t:$T,r=I4.get(n);if(r&&r.baseRadius===e)return r.visuals;const i=Array.isArray(t)?t:[];if(i.length===0)return Yu(n,e,{radius:e,tokens:[],indicator:null});const s=i.map(dc),l=e*UT;for(let u=e;u<=l;u+=GT){if(s.length<=WT){const p=ZT(s,u,e);if(p&&((c=p.layout)==null?void 0:c.length)===s.length){const m=Math.max(e,Math.min(p.radius,u));return Yu(n,e,{radius:m,tokens:p.layout,indicator:null})}}const f=QT(s,u,e);if(f){const p=Math.max(e,Math.min(f.radius,u));return Yu(n,e,{radius:p,tokens:f.layout,indicator:null})}}return Yu(n,e,{radius:e,tokens:[],indicator:s.length})}const qT=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0),JT=t=>t>500?100:50,eE=({id:t,x:e,y:n,label:r,tokens:i,valueTokens:s,isSelected:l,onSelect:c,onChange:u})=>{const{setIsDragging:f,snapToGrid:p,netMode:m,elements:w,selectedElements:y,setElements:x,multiDragRef:b,isIdSelected:_,mode:S,arcStart:T}=$t(),{gridSnappingEnabled:h,setSnapIndicator:k}=Go(),C=30,N=O.useRef(0),A=m==="algebraic-int"||Array.isArray(s),M=O.useMemo(()=>A?L4(s||[],C):{radius:C,tokens:[],indicator:null},[A,s]),R=A?M.radius:C,I=O.useCallback(D=>{const U=new Map;w.places.forEach(F=>{D.has(F.id)&&U.set(F.id,{type:"place",x:F.x,y:F.y})}),w.transitions.forEach(F=>{D.has(F.id)&&U.set(F.id,{type:"transition",x:F.x,y:F.y})});const G=new Map;return w.arcs.forEach(F=>{if(D.has(F.source)&&D.has(F.target)){const Y=Array.isArray(F.anglePoints)?F.anglePoints.map(X=>({x:X.x,y:X.y})):[];G.set(F.id,Y)}}),{startPositions:U,startArcPoints:G}},[w]),j=()=>{b.current!==null&&(b.current=null),f(!0);const D=_(t,"place");let U;D?U=new Set(y.filter(F=>F.type==="place"||F.type==="transition").map(F=>F.id)):(U=new Set([t]),typeof c=="function"&&c(t));const G=I(U);b.current={baseId:t,lastDelta:{dx:0,dy:0},...G}},z=D=>{var de,B;let U={x:D.target.x(),y:D.target.y()};if(h){const Q=p(U.x,U.y);k({visible:!0,position:Q,elementType:"place"}),D.target.position({x:Q.x,y:Q.y}),U=Q}const G=b.current;if(!G||!G.startPositions||G.baseId!==t)return;const F=G.startPositions.get(t);if(!F)return;const Y=U.x-F.x,X=U.y-F.y,te=G.lastDelta||{dx:0,dy:0};if(te.dx===Y&&te.dy===X)return;if(qT){G.lastDelta={dx:Y,dy:X};return}const K=(((de=w.places)==null?void 0:de.length)||0)+(((B=w.transitions)==null?void 0:B.length)||0),ee=JT(K),ne=performance.now();if(ne-N.current<ee)return;N.current=ne,G.lastDelta={dx:Y,dy:X};const ce={dx:Y,dy:X};x(Q=>!G||!G.startPositions?Q:A4(Q,G,ce,{gridSnappingEnabled:h,snapToGrid:p}))},W=D=>{const U={x:D.target.x(),y:D.target.y()};b.current=null,f(!1),k({visible:!1,position:null,elementType:null}),u(U)},V=()=>A?M.tokens.length>0?E.jsx(E.Fragment,{children:M.tokens.map(D=>E.jsx(Qn,{text:D.text,fontSize:D.fontSize,fill:"black",x:D.x,y:D.y,width:D.width,align:"center",wrap:"none",listening:!1},D.key))}):M.indicator?E.jsx(Qn,{text:`(${M.indicator})`,fontSize:12,fill:"black",x:-R,y:-7,width:R*2,align:"center",wrap:"none",listening:!1}):null:i===0?m==="algebraic-int"||Array.isArray(s)?null:E.jsx(Qn,{text:"0",fontSize:14,fill:"black",x:-R,y:-7,width:R*2,align:"center",listening:!1}):i<=5?E.jsxs(E.Fragment,{children:[Array.from({length:i}).map((D,U)=>{const G=2*Math.PI*U/i,F=4,Y=R/2,X=Math.cos(G)*Y,te=Math.sin(G)*Y;return E.jsx(vl,{x:X,y:te,radius:F,fill:"black",listening:!1},U)}),E.jsx(Qn,{text:i.toString(),fontSize:14,fill:"black",x:-R,y:-7,width:R*2,align:"center",listening:!1})]}):E.jsx(Qn,{text:i.toString(),fontSize:16,fill:"black",x:-R,y:-8,width:R*2,align:"center",listening:!1});return E.jsxs(tf,{x:e,y:n,draggable:S!=="arc"||!T,onDragStart:j,onDragMove:z,onDragEnd:W,onClick:()=>c(t),onTap:D=>{D.evt&&D.evt._handledByTouchEnd||c(t)},onTouchEnd:D=>{S==="arc"&&T&&T.element.id!==t&&(c(t),D.evt&&(D.evt._handledByTouchEnd=!0))},id:t,name:"element",elementType:"place",children:[E.jsx(vl,{radius:R,fill:"white",stroke:l?"blue":"black",strokeWidth:2}),E.jsx(Qn,{text:r,fontSize:12,fill:"black",x:-R,y:R+5,width:R*2,align:"center",listening:!1}),V()]})},tE=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0),nE=t=>t>500?100:50,d0=11,rE=.48,nv=160,iE=6,sE=({id:t,x:e,y:n,label:r,guard:i,isSelected:s,isEnabled:l,onSelect:c,onChange:u})=>{const{gridSnappingEnabled:m,setSnapIndicator:w}=Go(),{setIsDragging:y,snapToGrid:x,simulationSettings:b,netMode:_,elements:S,selectedElements:T,setElements:h,multiDragRef:k,isIdSelected:C,setSelection:N,mode:A,arcStart:M}=$t(),R=O.useRef(0),I=O.useCallback(G=>{const F=new Map;S.places.forEach(X=>{G.has(X.id)&&F.set(X.id,{type:"place",x:X.x,y:X.y})}),S.transitions.forEach(X=>{G.has(X.id)&&F.set(X.id,{type:"transition",x:X.x,y:X.y})});const Y=new Map;return S.arcs.forEach(X=>{if(G.has(X.source)&&G.has(X.target)){const te=Array.isArray(X.anglePoints)?X.anglePoints.map(K=>({x:K.x,y:K.y})):[];Y.set(X.id,te)}}),{startPositions:F,startArcPoints:Y}},[S]),j=()=>{k.current!==null&&(k.current=null),y(!0);const G=C(t,"transition");let F;G?F=new Set(T.filter(X=>X.type==="place"||X.type==="transition").map(X=>X.id)):(F=new Set([t]),typeof c=="function"&&c(t));const Y=I(F);k.current={baseId:t,lastDelta:{dx:0,dy:0},...Y}},z=G=>{var Q,re;let F={x:G.target.x(),y:G.target.y()};if(m){const ie=x(F.x,F.y);w({visible:!0,position:ie,elementType:"transition"}),G.target.position({x:ie.x,y:ie.y}),F=ie}const Y=k.current;if(!Y||!Y.startPositions||Y.baseId!==t)return;const X=Y.startPositions.get(t);if(!X)return;const te=F.x-X.x,K=F.y-X.y,ee=Y.lastDelta||{dx:0,dy:0};if(ee.dx===te&&ee.dy===K)return;if(tE){Y.lastDelta={dx:te,dy:K};return}const ne=(((Q=S.places)==null?void 0:Q.length)||0)+(((re=S.transitions)==null?void 0:re.length)||0),ce=nE(ne),de=performance.now();if(de-R.current<ce)return;R.current=de,Y.lastDelta={dx:te,dy:K};const B={dx:te,dy:K};h(ie=>!Y||!Y.startPositions?ie:A4(ie,Y,B,{gridSnappingEnabled:m,snapToGrid:x}))},W=G=>{const F={x:G.target.x(),y:G.target.y()};k.current=null,y(!1),w({visible:!1,position:null,elementType:null}),u(F)},V=_==="algebraic-int"?String(i||""):"";let D=40,U="none";if(V){const G=V.length*d0*rE+iE*2;G<=nv?D=Math.max(40,G):(D=nv,U="char")}return E.jsxs(tf,{x:e,y:n,onClick:G=>c(t,G),onTap:G=>{G.evt&&G.evt._handledByTouchEnd||c(t,G)},onTouchEnd:G=>{A==="arc"&&M&&M.element.id!==t&&(c(t,G),G.evt&&(G.evt._handledByTouchEnd=!0))},draggable:A!=="arc"||!M,onDragStart:j,onDragMove:z,onDragEnd:W,id:t,name:"element",elementType:"transition",children:[E.jsx(Hc,{x:-40/2,y:-50/2,width:40,height:50,fill:l?"rgba(255, 255, 0, 0.8)":"gray",stroke:s?"blue":l?"rgba(255, 180, 0, 1)":"black",strokeWidth:s||l?3:2}),E.jsx(Qn,{text:r,fontSize:14,fill:"black",x:-40/2,y:50/2+5,width:40,align:"center",listening:!1}),_==="algebraic-int"&&V&&E.jsx(Qn,{text:V,fontSize:d0,fill:"#333",x:-D/2,y:-50/2-14,width:D,align:"center",wrap:U,listening:!1,ellipsis:U!=="none"}),_==="algebraic-int"&&!V&&E.jsx(Qn,{text:"",fontSize:d0,fill:"gray",x:-40/2,y:-50/2-14,width:40,align:"center",listening:!1})]})},oE=({elements:t,selectedElement:e,handleElementClick:n,handleElementDragEnd:r,enabledTransitionIds:i})=>{var l,c;const{isIdSelected:s}=$t();return E.jsxs($c,{children:[(l=t==null?void 0:t.places)==null?void 0:l.map(u=>E.jsx(eE,{...u,isSelected:s(u.id,"place"),onSelect:f=>n(u,"place"),onChange:f=>r(u,"place",f)},u.id)),(c=t==null?void 0:t.transitions)==null?void 0:c.map(u=>E.jsx(sE,{...u,isSelected:s(u.id,"transition"),onSelect:f=>n(u,"transition"),onChange:f=>r(u,"transition",f),isEnabled:Array.isArray(i)?i.includes(u.id):!1},u.id))]})};function aE(t){return t!=null&&t.sourceType?t.sourceType:(t==null?void 0:t.type)==="place-to-transition"?"place":(t==null?void 0:t.type)==="transition-to-place"?"transition":"place"}function lE(t){return t!=null&&t.targetType?t.targetType:(t==null?void 0:t.type)==="place-to-transition"?"transition":(t==null?void 0:t.type)==="transition-to-place"?"place":"transition"}const uE=.52,f0=(t="",e=12,{padding:n=4,maxWidth:r=1/0}={})=>{if(!t.length)return{width:0,wrap:"none"};const i=t.length*e*uE+n*2;return i<=r?{width:i,wrap:"none"}:{width:r,wrap:"char"}},h0=(t,e)=>t.width||e*2,io=t=>Number.isFinite(t),cE=()=>{var T;const{elements:t,selectedElement:e,selectedElements:n,mode:r,tempArcEnd:i,getVirtualPointerPosition:s,gridSnappingEnabled:l,snapToGrid:c,simulationSettings:u}=$t(),f=(u==null?void 0:u.netMode)||"pt",{handleElementClick:p}=Bg(),{handleAddAnglePoint:m,handleDragAnglePoint:w,handleDeleteAnglePoint:y}=M4(),x=O.useMemo(()=>{const h=new Map;return(t.places||[]).forEach(k=>h.set(k.id,k)),(t.transitions||[]).forEach(k=>h.set(k.id,k)),h},[t.places,t.transitions]),b=h=>!h||typeof h!="string"?null:x.get(h)||null,_=h=>{if(!h)return 30;if(f==="algebraic-int"||Array.isArray(h.valueTokens)){const k=L4(h.valueTokens,30);if(k&&typeof k.radius=="number"&&Number.isFinite(k.radius))return k.radius}return 30},S=(h,k,C=[])=>{if(!h||!k||typeof h.x!="number"||typeof h.y!="number"||typeof k.x!="number"||typeof k.y!="number")return[0,0,100,100];const N={x:h.x,y:h.y},A={x:k.x,y:k.y},M=[{...h},...C,{...k}],R=40,I=50,j={...M[0]},z={...M[M.length-1]},W=M[1]||z,V=M[M.length-2]||j;let D=W.x-j.x,U=W.y-j.y,G=Math.atan2(U,D);if(h.type==="place"){const ne=_(h);j.x+=ne*Math.cos(G),j.y+=ne*Math.sin(G)}else{const ne=R/2,ce=I/2,de=Math.abs(Math.cos(G)),B=Math.abs(Math.sin(G)),Q=Math.tan(G);if(ne*B<=ce*de)j.x+=Math.sign(D)*ne,j.y+=Math.sign(D)*ne*Q;else{const re=Math.abs(Q)<1e-6?1e-6*Math.sign(Q||1):Q;j.x+=Math.sign(U)*ce/re,j.y+=Math.sign(U)*ce}}let F=z.x-V.x,Y=z.y-V.y,X=Math.atan2(Y,F);if(k.type==="place"){const ne=_(k);z.x-=ne*Math.cos(X),z.y-=ne*Math.sin(X)}else{const ne=R/2,ce=I/2,de=Math.abs(Math.cos(X)),B=Math.abs(Math.sin(X)),Q=Math.tan(X);if(ne*B<=ce*de)z.x-=Math.sign(F)*ne,z.y-=Math.sign(F)*ne*Q;else{const re=Math.abs(Q)<1e-6?1e-6*Math.sign(Q||1):Q;z.x-=Math.sign(Y)*ce/re,z.y-=Math.sign(Y)*ce}}const te=[j.x,j.y];if(C.forEach(ne=>te.push(ne.x,ne.y)),te.push(z.x,z.y),te.every(ne=>Number.isFinite(ne)))return te;const ee=[N.x,N.y];return C.forEach(ne=>ee.push(ne.x,ne.y)),ee.push(A.x,A.y),ee};return[E.jsxs($c,{children:[(T=t==null?void 0:t.arcs)==null?void 0:T.map(h=>{try{if(!h||!h.source||!h.target)return null;const k=b(h.source),C=b(h.target);if(!k||!C)return null;const N=S({...k,type:aE(h)},{...C,type:lE(h)},Array.isArray(h.anglePoints)?h.anglePoints:[]);if(!N||N.length<4||!N.every(gt=>Number.isFinite(gt)))return null;const A=(N[0]+N[N.length-2])/2,M=(N[1]+N[N.length-1])/2;if(!Number.isFinite(A)||!Number.isFinite(M))return null;const R=8,I=14,j=(n==null?void 0:n.some(gt=>gt.id===h.id&&gt.type==="arc"))||(n==null?void 0:n.some(gt=>gt.id===k.id))&&(n==null?void 0:n.some(gt=>gt.id===C.id)),z=12,W=12,V=12,D=h.label?`${h.label}`:"",U=h.weight>1?`${h.weight}`:"",G=f==="algebraic-int"&&Array.isArray(h.bindings)&&h.bindings.length>0?h.bindings.map(v5).join(", "):"",F=f0(D,z,{padding:6,maxWidth:220}),Y=f0(U,W,{padding:4,maxWidth:80}),X=f0(G,V,{padding:6,maxWidth:240}),te=N[0],K=N[1],ee=N[N.length-2],ne=N[N.length-1],ce=ee-te,de=ne-K,B=Math.hypot(ce,de);let Q=0,re=-1;B>.001&&(Q=-de/B,re=ce/B);const ie=6,oe=9,fe=8,pe=.66,Pe=Math.abs(Q),Ce=Math.abs(re),$e=(gt,dn,Ur=4)=>gt/2*Pe+dn/2*Ce+Ur,We=h0(Y,W),xt=h0(F,z),Dt=h0(X,V),Yt=Math.max(ie,$e(We,W)),rt=Math.max(oe,$e(xt,z)),Fn=Math.max(rt+fe,$e(Dt,V,6)*pe),On=A-Q*Yt,it=M-re*Yt,hi=A+Q*rt,pi=M+re*rt,zr=A+Q*Fn,Br=M+re*Fn;return!io(On)||!io(it)||!io(hi)||!io(pi)||!io(zr)||!io(Br)?null:E.jsxs(tf,{children:[E.jsx(OT,{points:N,stroke:(e==null?void 0:e.id)===h.id||j?"blue":"black",strokeWidth:2,fill:"black",pointerLength:10,pointerWidth:10,hitStrokeWidth:12,onClick:gt=>p(gt,h,"arc"),onTap:gt=>p(gt,h,"arc"),onDblClick:gt=>{if(r==="arc_angle"){const dn=s();dn&&m(h.id,dn)}}}),h.weight>1&&E.jsx(Qn,{x:On,y:it,text:U,fontSize:W,width:We,offsetX:We/2,offsetY:W/2,align:"center",listening:!1}),h.label&&E.jsx(Qn,{x:hi,y:pi,text:D,fontSize:z,fill:"gray",width:xt,offsetX:xt/2,offsetY:z/2,align:"center",wrap:F.wrap,ellipsis:F.wrap!=="none",listening:!1}),G&&E.jsx(Qn,{x:zr,y:Br,text:G,fontSize:V,fill:"#333",width:Dt,offsetX:Dt/2,offsetY:V/2,align:"center",wrap:X.wrap,ellipsis:X.wrap!=="none",listening:!1})]},h.id)}catch(k){return console.warn("[ArcManager] Error rendering arc:",h==null?void 0:h.id,k),null}}),i&&i.sourcePoint&&E.jsx(bp,{points:[i.sourcePoint.x,i.sourcePoint.y,i.x,i.y],stroke:"grey",strokeWidth:2,dash:[5,5],listening:!1})]},"arcs-layer"),E.jsx($c,{children:(e==null?void 0:e.type)==="arc"&&r==="arc_angle"&&e.anglePoints.map((h,k)=>E.jsx(vl,{x:h.x,y:h.y,radius:6,fill:"red",stroke:"black",strokeWidth:1,draggable:!0,onDragEnd:C=>{const N={x:C.target.x(),y:C.target.y()},A=l?c(N.x,N.y):N;w(e.id,k,A)},onClick:C=>{C.evt.button===2&&(C.evt.preventDefault(),y(e.id,k))},onContextMenu:C=>{C.evt.preventDefault(),y(e.id,k)}},`angle-${e.id}-${k}`))},"handles-layer")]},dE=({width:t,height:e,gridSize:n})=>{const r=[],i=[],s=Math.ceil(e/n),l=Math.ceil(t/n);for(let c=0;c<=s;c++){const u=c*n;r.push(E.jsx(bp,{points:[0,u,t,u],stroke:"#ddd",strokeWidth:c%5===0?.5:.2,perfectDrawEnabled:!1,listening:!1},`h-${c}`))}for(let c=0;c<=l;c++){const u=c*n;i.push(E.jsx(bp,{points:[u,0,u,e],stroke:"#ddd",strokeWidth:c%5===0?.5:.2,perfectDrawEnabled:!1,listening:!1},`v-${c}`))}return E.jsxs(tf,{listening:!1,perfectDrawEnabled:!1,children:[r,i]})},rv=({orientation:t,contentSize:e,viewportSize:n,scrollPosition:r,onScroll:i})=>{const s=O.useRef(null),l=O.useRef(null),[c,u]=O.useState(!1),f=O.useRef(0),p=O.useRef(0),m=t==="horizontal",w=O.useCallback(M=>{M.preventDefault(),M.stopPropagation(),u(!0),f.current=r,p.current=m?M.clientX:M.clientY},[m,r]),y=O.useCallback(M=>{if(s.current&&l.current&&!l.current.contains(M.target)){const{left:R,top:I,width:j,height:z}=s.current.getBoundingClientRect(),W=m?j:z,V=Math.max(20,W*(n/e)),D=Math.max(0,e-n),U=Math.max(0,W-V);let F=((m?M.clientX-R:M.clientY-I)-V/2)/U*D;F=Math.max(0,Math.min(F,D)),i(F)}},[e,n,m,i]);if(O.useEffect(()=>{const M=I=>{if(!c||!s.current)return;const z=(m?I.clientX:I.clientY)-p.current,W=m?s.current.clientWidth:s.current.clientHeight,V=Math.max(20,W*(n/e)),D=Math.max(0,e-n),U=Math.max(0,W-V);if(U<=0)return;const G=D/U,F=f.current+z*G;i(Math.max(0,Math.min(F,D)))},R=()=>{c&&u(!1)};return c&&(document.addEventListener("mousemove",M),document.addEventListener("mouseup",R),document.body.style.cursor=m?"ew-resize":"ns-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",R),document.body.style.cursor="default",document.body.style.userSelect="auto"}},[c,m,i,e,n]),e<=n)return null;const x=s.current?m?s.current.clientWidth:s.current.clientHeight:0,b=x>0?x*(n/e):0,_=Math.max(20,Math.min(b,x)),S=Math.max(0,e-n),T=Math.max(0,x-_),h=Math.max(0,Math.min(r,S)),k=S>0?Math.min(h/S*T,T):0,C={position:"absolute",zIndex:50,padding:0,margin:0,...m?{left:"0px",right:"0px",bottom:"0px",height:"10px"}:{top:"0px",bottom:"0px",right:"0px",width:"10px"}},N={position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"6px",overflow:"hidden"},A={position:"absolute",backgroundColor:"rgba(0,0,0,0.45)",borderRadius:"6px",cursor:"pointer",willChange:"transform",...m?{left:`${Math.round(k)}px`,top:"0px",width:`${Math.round(_)}px`,height:"100%"}:{top:`${Math.round(k)}px`,left:"0px",height:`${Math.round(_)}px`,width:"100%"}};return E.jsx("div",{style:C,children:E.jsx("div",{ref:s,style:N,onMouseDown:y,children:E.jsx("div",{ref:l,style:A,onMouseDown:w})})})},fE=({position:t,visible:e,elementType:n})=>!e||!t?null:n==="place"?E.jsx(vl,{x:t.x,y:t.y,radius:5,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}):n==="transition"?E.jsx(Hc,{x:t.x-5,y:t.y-5,width:10,height:10,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}):E.jsx(vl,{x:t.x,y:t.y,radius:5,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}),hE=({handleZoom:t,ZOOM_STEP:e,isSingleFingerPanningActive:n,isSelectionActiveRef:r,activateSingleFingerPan:i})=>{const{stageDimensions:s,setStageDimensions:l,virtualCanvasDimensions:c,canvasScroll:u,setCanvasScroll:f,zoomLevel:p,setContainerRef:m,stageRef:w,gridSize:y,gridSnappingEnabled:x,snapIndicator:b,setSnapIndicator:_}=Go(),{mode:S,setMode:T,arcStart:h,setArcStart:k,tempArcEnd:C,setTempArcEnd:N,selectedElement:A,setSelectedElement:M,elements:R,setElements:I,enabledTransitionIds:j,snapToGrid:z,selectedElements:W,setSelection:V,isDragging:D,pasteMode:U,setPasteMode:G,getClipboard:F,netMode:Y,onClipboardMismatch:X}=$t(),{handleCreateElement:te,handleElementClick:K,handleElementDragEnd:ee}=Bg(),ne=O.useRef(null),ce=O.useRef({isSelecting:!1,start:null}),[de,B]=O.useState(null),[Q,re]=O.useState(!1),ie=O.useRef(!1),oe=O.useRef([]),fe=O.useRef(null),pe=O.useRef(null),Pe=3,Ce=O.useRef({active:!1,touchId:null,startX:0,startY:0,startVirtualX:0,startVirtualY:0,maxMovement:0,startTime:0,selectionTimerId:null,gestureStartTimerId:null,gestureDecided:!1,gestureType:null,isQuickTap:!1}),$e=500,We=0,xt=10,Dt=10,Yt=0,rt=O.useCallback(()=>{const se=Ce.current;se.selectionTimerId&&clearTimeout(se.selectionTimerId),se.gestureStartTimerId&&clearTimeout(se.gestureStartTimerId),Ce.current={active:!1,touchId:null,startX:0,startY:0,startVirtualX:0,startVirtualY:0,maxMovement:0,startTime:0,selectionTimerId:null,gestureStartTimerId:null,gestureDecided:!1,gestureType:null,isQuickTap:!1},r&&(r.current=!1)},[r]),Fn=O.useCallback((se,le,he)=>{rt();const _e=Ce.current;_e.active=!0,_e.touchId=se.identifier,_e.startX=se.clientX,_e.startY=se.clientY,_e.startVirtualX=le.x,_e.startVirtualY=le.y,_e.maxMovement=0,_e.startTime=Date.now(),_e.gestureDecided=!1,_e.gestureType=null,_e.isQuickTap=!0,console.log("[TouchGesture] Started:",{touchId:se.identifier,startX:se.clientX,startY:se.clientY,isSelectMode:he}),_e.gestureStartTimerId=setTimeout(()=>{const ke=Ce.current;if(!(!ke.active||ke.gestureDecided)){if(ke.maxMovement>Dt){ke.isQuickTap=!1;return}he&&(ke.isQuickTap=!1,ke.selectionTimerId=setTimeout(()=>{const ye=Ce.current;if(console.log("[TouchGesture] Timer fired:",{active:ye.active,gestureDecided:ye.gestureDecided,maxMovement:ye.maxMovement}),ye.gestureDecided||!ye.active){console.log("[TouchGesture] Selection cancelled - gesture already decided or inactive");return}if(ye.maxMovement>xt){console.log("[TouchGesture] Selection cancelled - moved too much:",ye.maxMovement);return}if(console.log("[TouchGesture] Selection ACTIVATED!"),ye.gestureDecided=!0,ye.gestureType="selection",ye.selectionTimerId=null,r&&(r.current=!0),ce.current={isSelecting:!0,start:{x:ye.startVirtualX,y:ye.startVirtualY}},B({x:ye.startVirtualX,y:ye.startVirtualY,w:0,h:0}),navigator.vibrate)try{navigator.vibrate([10,50,10])}catch{}},$e-Yt))}},Yt)},[rt,r,B]),On=O.useCallback(se=>{const le=Ce.current;if(!le.active||le.gestureDecided||le.isQuickTap&&le.maxMovement<=Dt)return;le.maxMovement>Dt&&(le.isQuickTap=!1),Date.now()-le.startTime>=We&&le.maxMovement>xt&&(le.gestureDecided=!0,le.gestureType="pan",le.selectionTimerId&&(clearTimeout(le.selectionTimerId),le.selectionTimerId=null),le.gestureStartTimerId&&(clearTimeout(le.gestureStartTimerId),le.gestureStartTimerId=null),i&&i())},[i]);O.useEffect(()=>{if(typeof window>"u")return;const se=window.matchMedia("(pointer: coarse)"),le=he=>re(he.matches);return le(se),se.addEventListener?se.addEventListener("change",le):se.addListener(le),()=>{se.removeEventListener?se.removeEventListener("change",le):se.removeListener(le)}},[]),O.useEffect(()=>()=>{rt()},[rt]),O.useEffect(()=>{D||rt()},[D,rt]),O.useEffect(()=>{const se=ne.current;if(!se)return;m(se);const le=new ResizeObserver(he=>{for(let _e of he){const{width:ke,height:ye}=_e.contentRect;ke>0&&ye>0&&l({width:ke,height:ye})}});return le.observe(se),()=>{le.disconnect()}},[l,m]);const it=()=>{const se=w.current;if(!se)return null;const le=se.getPointerPosition();if(!le)return null;const he=se.getAbsoluteTransform().copy();he.invert();const{x:_e,y:ke}=he.point(le);return{x:_e,y:ke}},hi=se=>{if(se.target.name()!=="background"||ie.current)return;if(U){const he=it();if(he){const _e=Y||"pt",ke=typeof F=="function"?F():null;if(!ke){G(!1);return}const ye=ke.payload||ke;if(!ye){G(!1);return}const qe=ke.netMode||_e;if(qe&&_e&&qe!==_e){typeof X=="function"?X(qe,_e,ke):console.warn(`Blocked paste: shared clipboard contains ${qe} net, editor mode is ${_e}.`),G(!1);return}let fn=40,hn=40;ye.places&&ye.places.length>0?(fn=he.x-ye.places[0].x,hn=he.y-ye.places[0].y):ye.transitions&&ye.transitions.length>0&&(fn=he.x-ye.transitions[0].x,hn=he.y-ye.transitions[0].y);const{newPlaces:gi,newTransitions:wr,newArcs:is,newSelection:Sr}=zc(ye,Wi,{x:fn,y:hn});I(En=>({...En,places:[...En.places,...gi],transitions:[...En.transitions,...wr],arcs:[...En.arcs,...is]})),V(Sr),G(!1)}return}if(S==="select"){V([]),M(null);return}const le=it();le&&te(le)},pi=se=>{if(se.target.name()!=="background"||ie.current)return;if(U){const he=it();if(he){const _e=Y||"pt",ke=typeof F=="function"?F():null;if(!ke){G(!1);return}const ye=ke.payload||ke;if(!ye){G(!1);return}const qe=ke.netMode||_e;if(qe&&_e&&qe!==_e){typeof X=="function"?X(qe,_e,ke):console.warn(`Blocked paste: shared clipboard contains ${qe} net, editor mode is ${_e}.`),G(!1);return}let fn=40,hn=40;ye.places&&ye.places.length>0?(fn=he.x-ye.places[0].x,hn=he.y-ye.places[0].y):ye.transitions&&ye.transitions.length>0&&(fn=he.x-ye.transitions[0].x,hn=he.y-ye.transitions[0].y);const{newPlaces:gi,newTransitions:wr,newArcs:is,newSelection:Sr}=zc(ye,Wi,{x:fn,y:hn});I(En=>({...En,places:[...En.places,...gi],transitions:[...En.transitions,...wr],arcs:[...En.arcs,...is]})),V(Sr),G(!1)}return}if(S==="select"){V([]),M(null);return}const le=it();le&&te(le)},zr=se=>{const le=it();if(le){if(S==="arc"&&h){let he=null;const _e=w.current;if(_e){const ke=_e.getPointerPosition(),ye=_e.getIntersection(ke);ye&&(ye.attrs.elementType==="place"||ye.attrs.elementType==="transition")&&ye.attrs.id!==h.element.id&&(he={id:ye.attrs.id,type:ye.attrs.elementType})}N({sourcePoint:h.point,x:le.x,y:le.y,potentialTarget:he})}if(r!=null&&r.current,S==="select"&&ce.current.isSelecting&&ce.current.start){const he=ce.current.start;B({x:he.x,y:he.y,w:le.x-he.x,h:le.y-he.y})}if(x&&(S==="place"||S==="transition")){const he=z(le.x,le.y);_({visible:!0,position:he,elementType:S})}else b.visible&&_({visible:!1,position:null,elementType:null})}},Br=O.useCallback(()=>{const se=oe.current;if(se.length<2)return{vx:0,vy:0};const[le,he]=se.slice(-2),_e=he.time-le.time;if(_e<=0)return{vx:0,vy:0};const ke=(he.deltaX-le.deltaX)/_e,ye=(he.deltaY-le.deltaY)/_e;return{vx:ke,vy:ye}},[]),gt=O.useCallback((se,le)=>{fe.current&&cancelAnimationFrame(fe.current),pe.current&&clearTimeout(pe.current);const he=.95,_e=.01,ke=16;let ye=se/p,qe=le/p,fn=performance.now();const hn=gi=>{const wr=gi-fn;if(fn=gi,ye*=Math.pow(he,wr/ke),qe*=Math.pow(he,wr/ke),Math.hypot(ye,qe)<_e){fe.current=null;return}f(Sr=>{if(!c||!s)return Sr;const En=Math.max(0,c.width-s.width/p),Qo=Math.max(0,c.height-s.height/p);return{x:Math.max(0,Math.min(En,Sr.x+ye*wr)),y:Math.max(0,Math.min(Qo,Sr.y+qe*wr))}}),fe.current=requestAnimationFrame(hn)};fe.current=requestAnimationFrame(hn)},[p,f,c,s]),dn=O.useCallback(()=>{fe.current&&(cancelAnimationFrame(fe.current),fe.current=null),pe.current&&(clearTimeout(pe.current),pe.current=null),oe.current=[]},[]),Ur=O.useCallback(se=>{if(se.preventDefault(),se.stopPropagation(),se.ctrlKey||se.metaKey){dn();const le=se.deltaY>0?-e:e;t(le,{clientX:se.clientX,clientY:se.clientY})}else{const le=se.deltaX/p,he=se.deltaY/p,_e=performance.now();oe.current.push({deltaX:se.deltaX,deltaY:se.deltaY,time:_e}),oe.current.length>Pe&&oe.current.shift(),pe.current&&clearTimeout(pe.current),fe.current&&(cancelAnimationFrame(fe.current),fe.current=null),f(ke=>{if(!c||!s)return ke;const ye=Math.max(0,c.width-s.width/p),qe=Math.max(0,c.height-s.height/p);return{x:Math.max(0,Math.min(ye,ke.x+le)),y:Math.max(0,Math.min(qe,ke.y+he))}}),pe.current=setTimeout(()=>{const ke=Br();Math.hypot(ke.vx,ke.vy)>.1&&gt(ke.vx,ke.vy),pe.current=null},150)}},[e,t,f,p,c,s,Br,gt,dn]);O.useEffect(()=>{const se=ne.current;if(!se)return;const le=he=>{se.contains(he.target)&&Ur(he)};return document.addEventListener("wheel",le,{passive:!1}),()=>{document.removeEventListener("wheel",le),dn()}},[Ur,dn]);const Ee=O.useCallback((se,le)=>{f(he=>{const _e=Math.max(0,c.width-s.width/p),ke=Math.max(0,c.height-s.height/p),ye=(fn,hn)=>Math.max(0,Math.min(fn,hn)),qe={...he};return se==="x"&&(qe.x=ye(le,_e)),se==="y"&&(qe.y=ye(le,ke)),qe})},[f,c,s,p]);return E.jsxs("div",{ref:ne,className:"canvas-container",style:{width:"100%",height:"100%",position:"relative",backgroundColor:"#f0f0f0",overflow:"hidden",touchAction:Q?"none":"auto"},children:[E.jsxs(DT,{ref:w,width:s.width,height:s.height,listening:!0,onClick:hi,onTap:pi,onMouseMove:zr,onTouchMove:se=>{const le=se.evt&&se.evt.touches||se.touches;if(Q){const he=Ce.current;if(he.active&&!he.gestureDecided&&le&&le.length===1){const _e=le[0],ke=_e.clientX-he.startX,ye=_e.clientY-he.startY,qe=Math.hypot(ke,ye);he.maxMovement=Math.max(he.maxMovement,qe),he.maxMovement>Dt&&(he.isQuickTap=!1),console.log("[TouchGesture] Move:",{distance:qe,maxMovement:he.maxMovement,gestureDecided:he.gestureDecided,isQuickTap:he.isQuickTap}),On()}}zr()},onMouseDown:se=>{if(S!=="select"||se.target&&se.target.name&&se.target.name()!=="background")return;const le=it();le&&(ce.current={isSelecting:!0,start:le},B({x:le.x,y:le.y,w:0,h:0}))},onTouchStart:se=>{const le=se.target&&se.target.name&&se.target.name()==="background",he=se.evt&&se.evt.touches||se.touches;if(he&&he.length===1){const _e=he[0],ke=it();if(!ke)return;le?Fn(_e,ke,S==="select"):rt()}else rt()},onMouseUp:()=>{if(S!=="select"||!ce.current.isSelecting||!de)return;const se=tv(R,de);V(se),ce.current={isSelecting:!1,start:null},B(null),ie.current=!0,setTimeout(()=>{ie.current=!1},100)},onTouchEnd:se=>{console.log("[TouchGesture] TouchEnd");const le=Ce.current,he=le.isQuickTap&&le.maxMovement<=Dt;if(he&&rt(),S==="select"&&!he&&ce.current.isSelecting&&de){const _e=tv(R,de);V(_e),ce.current={isSelecting:!1,start:null},B(null),ie.current=!0,setTimeout(()=>{ie.current=!1},100)}he||rt(),S==="arc"&&h&&setTimeout(()=>{if(S==="arc"&&h){const _e=w.current;if(_e){const ke=_e.getPointerPosition();if(ke){const ye=_e.getIntersection(ke);(!ye||ye.attrs.elementType!=="place"&&ye.attrs.elementType!=="transition")&&(k(null),N(null))}else k(null),N(null)}else k(null),N(null)}},20)},scaleX:p,scaleY:p,x:-u.x*p,y:-u.y*p,children:[E.jsxs($c,{children:[E.jsx(Hc,{x:0,y:0,width:c.width,height:c.height,fill:"#FFFFFF",name:"background",onClick:()=>{S==="arc"&&h&&(k(null),N(null)),M(null)},onTap:()=>{S==="arc"&&h&&(k(null),N(null)),M(null)},onTouchEnd:()=>{S==="arc"&&h&&(k(null),N(null)),M(null)}}),de&&E.jsx(Hc,{x:Math.min(de.x,de.x+de.w),y:Math.min(de.y,de.y+de.h),width:Math.abs(de.w),height:Math.abs(de.h),stroke:"#3399FF",strokeWidth:1,dash:[4,4],fill:"rgba(51,153,255,0.15)",listening:!1}),E.jsx(dE,{width:c.width,height:c.height,gridSize:y}),E.jsx(fE,{position:b.position,visible:b.visible,elementType:b.elementType})]}),E.jsx(oE,{elements:R,selectedElement:A,handleElementClick:K,handleElementDragEnd:ee,enabledTransitionIds:j}),E.jsx(cE,{})]}),!Q&&s.width>0&&c.width>s.width/p&&E.jsx(rv,{orientation:"horizontal",contentSize:c.width,viewportSize:s.width/p,scrollPosition:u.x,onScroll:se=>Ee("x",se)}),!Q&&s.height>0&&c.height>s.height/p&&E.jsx(rv,{orientation:"vertical",contentSize:c.height,viewportSize:s.height/p,scrollPosition:u.y,onScroll:se=>{we.debug("Vertical scroll callback:",{newScroll:se,currentScroll:u.y,maxScroll:Math.max(0,c.height-s.height/p)}),Ee("y",se)}})]})},pE=()=>{const{mode:t,setMode:e}=$t(),[n,r]=O.useState(!1);if(O.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia("(pointer: coarse)"),l=c=>r(c.matches);return l(s),s.addEventListener?s.addEventListener("change",l):s.addListener(l),()=>{s.removeEventListener?s.removeEventListener("change",l):s.removeListener(l)}},[]),!n)return null;const i=s=>({width:"44px",height:"44px",borderRadius:"50%",backgroundColor:s?"#4338ca":"white",color:s?"white":"#374151",border:s?"2px solid #312e81":"1px solid #d1d5db",boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",marginBottom:"8px",cursor:"pointer",position:"relative"});return E.jsxs("div",{className:"fixed bottom-32 left-6 z-50 flex flex-col items-center",children:[E.jsx("button",{style:i(t==="arc"),onClick:()=>e("arc"),title:"Arc Tool","data-testid":"toolbar-arc",className:"active:scale-95",children:E.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:E.jsx("path",{d:"M3 21l18-18M3 21l7-1M3 21l1-7"})})}),E.jsx("button",{style:i(t==="transition"),onClick:()=>e("transition"),title:"Transition Tool","data-testid":"toolbar-transition",className:"active:scale-95",children:E.jsx("div",{style:{width:"11px",height:"26px",backgroundColor:"currentColor"}})}),E.jsx("button",{style:i(t==="place"),onClick:()=>e("place"),title:"Place Tool","data-testid":"toolbar-place",className:"active:scale-95",children:E.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",border:"2px solid currentColor",backgroundColor:"transparent"}})}),E.jsx("button",{style:i(t==="select"),onClick:()=>e("select"),title:"Select Tool","data-testid":"toolbar-select",className:"active:scale-95",children:E.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:E.jsx("path",{d:"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"})})})]})},gE=()=>{const{selectedElements:t,elements:e,setElements:n,setSelection:r,clearSelection:i,netMode:s,setClipboard:l,getClipboard:c,onClipboardMismatch:u,pasteMode:f,setPasteMode:p}=$t(),[m,w]=O.useState(!1);if(O.useEffect(()=>{if(typeof window>"u")return;const k=window.matchMedia("(pointer: coarse)"),C=N=>w(N.matches);return C(k),k.addEventListener?k.addEventListener("change",C):k.addListener(C),()=>{k.removeEventListener?k.removeEventListener("change",C):k.removeListener(C)}},[]),!m)return null;const y=(k=!1,C=!1)=>({width:"44px",height:"44px",borderRadius:"50%",backgroundColor:k?"#4338ca":C?"#dc2626":"white",color:k||C?"white":"#374151",border:k?"2px solid #312e81":C?"2px solid #991b1b":"1px solid #d1d5db",boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",marginBottom:"8px",cursor:"pointer",position:"relative"}),x=t.length>0,b=c(),_=!!b&&!!b.payload,S=()=>{if(!x)return;const k=Dc(e,t);typeof l=="function"&&l(k)},T=()=>{if(!x)return;const k=Dc(e,t);typeof l=="function"&&l(k),n(C=>{const N=[],A=new Set;t.forEach(R=>{(R.type==="place"||R.type==="transition")&&N.push(R.id),R.type==="arc"&&A.add(R.id)});let M=C;return N.length>0&&(M=R5(M,N)),A.size>0&&(M={...M,arcs:M.arcs.filter(R=>!A.has(R.id))}),M}),i()},h=()=>{if(!_)return;const k=s||"pt",C=b.netMode||k;if(C&&k&&C!==k){typeof u=="function"?u(C,k,b):console.warn(`Blocked paste: shared clipboard contains ${C} net, editor mode is ${k}.`);return}p(!0)};return E.jsxs(E.Fragment,{children:[f&&E.jsx("div",{className:"fixed left-0 right-0 z-50 flex justify-center",style:{top:"72px"},children:E.jsxs("div",{style:{padding:"0.5rem 1rem",borderRadius:"0.25rem",backgroundColor:"#dbeafe",color:"#1d4ed8",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",maxWidth:"90%"},children:[E.jsx("span",{children:"Tap on canvas to paste"}),E.jsx("button",{onClick:()=>p(!1),style:{marginLeft:"1rem",fontWeight:"600"},children:""})]})}),E.jsxs("div",{className:"fixed top-24 left-4 z-50 flex flex-col items-center",children:[_&&E.jsx("button",{style:y(f),onClick:h,title:f?"Tap canvas to paste":"Paste","data-testid":"floating-action-paste",className:"active:scale-95",children:E.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[E.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),E.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})}),x&&E.jsxs(E.Fragment,{children:[E.jsx("button",{style:y(!1),onClick:S,title:"Copy","data-testid":"floating-action-copy",className:"active:scale-95",children:E.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[E.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),E.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),E.jsx("button",{style:y(!1,!0),onClick:T,title:"Cut (replaces delete)","data-testid":"floating-action-cut",className:"active:scale-95",children:E.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[E.jsx("circle",{cx:"6",cy:"6",r:"3"}),E.jsx("circle",{cx:"6",cy:"18",r:"3"}),E.jsx("line",{x1:"20",y1:"4",x2:"8.12",y2:"15.88"}),E.jsx("line",{x1:"14.47",y1:"14.48",x2:"20",y2:"20"}),E.jsx("line",{x1:"8.12",y1:"8.12",x2:"12",y2:"12"})]})})]})]})]})},j4=O.forwardRef((t,e)=>{const[n,r]=O.useState(!1),[i,s]=O.useState([]),[l,c]=O.useState(!1),[u,f]=O.useState(!1),p=O.useRef(null),m=O.useRef({});O.useImperativeHandle(e,()=>({enable:()=>c(!0),disable:()=>c(!1),toggle:()=>c(_=>!_),isEnabled:()=>l,open:()=>{c(!0),r(!0)},close:()=>r(!1)}));const w=()=>{var _;(_=p.current)==null||_.scrollIntoView({behavior:"smooth"})};O.useEffect(()=>{if(!l)return;m.current={log:console.log,error:console.error,warn:console.warn,info:console.info};const _=(S,T)=>{const h=new Date().toLocaleTimeString(),k=T.map(C=>{if(typeof C=="object")try{return JSON.stringify(C,null,2)}catch{return String(C)}return String(C)}).join(" ");s(C=>[...C,{level:S,message:k,timestamp:h,id:Date.now()+Math.random()}])};return console.log=(...S)=>{m.current.log(...S),_("log",S)},console.error=(...S)=>{m.current.error(...S),_("error",S)},console.warn=(...S)=>{m.current.warn(...S),_("warn",S)},console.info=(...S)=>{m.current.info(...S),_("info",S)},()=>{console.log=m.current.log,console.error=m.current.error,console.warn=m.current.warn,console.info=m.current.info}},[l]),O.useEffect(()=>{n&&w()},[i,n]);const y=()=>{s([])},x=async()=>{if(i.length===0)return;const _=i.map(h=>`[${h.timestamp}] ${h.level.toUpperCase()}: ${h.message}`).join(`
`),T=`Debug Console Logs
Generated: ${new Date().toLocaleString()}
Total Messages: ${i.length}

`+_;try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(T),f(!0),setTimeout(()=>f(!1),2e3);else{const h=document.createElement("textarea");h.value=T,h.style.position="fixed",h.style.opacity="0",document.body.appendChild(h),h.select(),document.execCommand("copy"),document.body.removeChild(h),f(!0),setTimeout(()=>f(!1),2e3)}}catch(h){console.error("Failed to copy to clipboard:",h),alert("Failed to copy to clipboard. Please try selecting the text manually.")}},b=_=>{switch(_){case"error":return"text-red-600 bg-red-50 border-red-200";case"warn":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"info":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-700 bg-gray-50 border-gray-200"}};return l?E.jsxs(E.Fragment,{children:[E.jsxs("button",{onClick:()=>r(!n),className:"fixed bottom-4 right-4 z-[100] bg-purple-600 text-white px-4 py-3 rounded-full shadow-lg text-sm font-medium active:bg-purple-700 flex items-center gap-2",title:n?"Hide Console":"Show Console",children:[" ",n?"Hide":"Show"]}),n&&E.jsxs("div",{className:"fixed bottom-20 right-4 z-[99] w-[calc(100vw-2rem)] sm:w-96 max-w-md h-64 sm:h-80 bg-white border-2 border-purple-300 rounded-lg shadow-2xl flex flex-col",children:[E.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-600 text-white rounded-t-lg",children:[E.jsx("h3",{className:"text-sm font-semibold",children:"Debug Console"}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx("button",{onClick:x,disabled:i.length===0,className:`px-2 py-1 rounded text-xs active:opacity-80 transition-all ${u?"bg-green-600 hover:bg-green-700":i.length===0?"bg-gray-500 opacity-50 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,title:"Copy All Logs to Clipboard",children:u?" Copied!":" Copy"}),E.jsx("button",{onClick:y,className:"px-2 py-1 bg-purple-700 hover:bg-purple-800 rounded text-xs active:bg-purple-900",title:"Clear Logs",children:"Clear"}),E.jsx("button",{onClick:()=>c(!1),className:"px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-xs active:bg-red-800",title:"Disable Console",children:""})]})]}),E.jsxs("div",{className:"flex-1 overflow-y-auto p-2 bg-gray-900 text-green-400 font-mono text-xs",children:[i.length===0?E.jsx("div",{className:"text-gray-500 italic",children:"No logs yet..."}):i.map(_=>E.jsx("div",{className:`mb-1 p-1 rounded border-l-2 ${b(_.level)}`,children:E.jsxs("div",{className:"flex items-start gap-2",children:[E.jsx("span",{className:"text-gray-500 text-[10px] flex-shrink-0",children:_.timestamp}),E.jsxs("span",{className:"text-[10px] font-semibold uppercase flex-shrink-0",children:[_.level,":"]}),E.jsx("span",{className:"flex-1 break-words whitespace-pre-wrap",children:_.message})]})},_.id)),E.jsx("div",{ref:p})]}),E.jsxs("div",{className:"p-2 bg-gray-100 border-t text-xs text-gray-600",children:[i.length," message",i.length!==1?"s":""]})]})]}):E.jsx("button",{onClick:()=>c(!0),className:"fixed bottom-4 right-4 z-[100] bg-purple-600 text-white px-4 py-3 rounded-full shadow-lg text-sm font-medium active:bg-purple-700",title:"Enable Debug Console",children:" Debug"})});j4.displayName="DebugConsole";const p0=()=>({active:!1,touchId:null,startX:0,startY:0,lastX:0,lastY:0});function mE({MIN_ZOOM:t,MAX_ZOOM:e,zoomLevel:n,setZoomLevel:r,virtualCanvasDimensions:i,canvasScroll:s,setCanvasScroll:l,setContainerRef:c,isDragging:u=!1,isSelectionActiveRef:f=null}){const[p,m]=O.useState(null),w=O.useRef(null),y=O.useCallback(K=>{w.current=K,m(K),c&&c(K)},[c]),x=O.useRef(!1),b=O.useRef({active:!1}),_=O.useRef({active:!1,startX:0,startY:0,lastX:0,lastY:0}),[S,T]=O.useState(!1),h=O.useRef(p0()),k=O.useRef(n),C=O.useRef(!1),N=O.useRef(0),A=100,M=O.useRef(null),R=O.useRef([]),I=12;O.useEffect(()=>{k.current=n},[n]),O.useEffect(()=>{C.current=u,u||(N.current=performance.now())},[u]);const j=O.useCallback(K=>Math.max(t,Math.min(e,K)),[t,e]),z=O.useCallback((K,ee,ne)=>{if(!w.current||!i)return;const ce=w.current,de=ce.clientWidth||1,B=ce.clientHeight||1,Q=ce.getBoundingClientRect(),re=ne?Math.min(Math.max(ne.clientX-Q.left,0),de):de/2,ie=ne?Math.min(Math.max(ne.clientY-Q.top,0),B):B/2,oe=(s.x+re)/K,fe=(s.y+ie)/K,pe=Math.max(0,i.width-de/ee),Pe=Math.max(0,i.height-B/ee),Ce=Math.max(0,Math.min(pe,oe*ee-re)),$e=Math.max(0,Math.min(Pe,fe*ee-ie));l({x:Ce,y:$e})},[s,l,i]),W=O.useCallback((K,ee,ne)=>{if(!w.current||!i||!Number.isFinite(ne)||ne<=0)return;const ce=w.current,de=ce.clientWidth||1,B=ce.clientHeight||1,Q=Math.max(0,i.width-de/ne),re=Math.max(0,i.height-B/ne);l(ie=>{const oe=Math.max(0,Math.min(Q,ie.x-K/ne)),fe=Math.max(0,Math.min(re,ie.y-ee/ne));return oe===ie.x&&fe===ie.y?ie:{x:oe,y:fe}})},[l,i]),V=O.useCallback(()=>{const K=R.current;if(K.length<2)return{vx:0,vy:0};const ee=K[K.length-1],ne=K[0],ce=ee.time-ne.time;if(ce<=10||ce>300){if(K.length>=2){const Q=K.slice(-2),re=Q[1].time-Q[0].time;if(re>0&&re<=100)return{vx:(Q[1].x-Q[0].x)/re,vy:(Q[1].y-Q[0].y)/re}}return{vx:0,vy:0}}const de=(ee.x-ne.x)/ce,B=(ee.y-ne.y)/ce;return{vx:de,vy:B}},[]),D=O.useCallback((K,ee)=>{M.current&&cancelAnimationFrame(M.current),console.log("[Inertia] Animation starting with velocity:",{vx:K.toFixed(4),vy:ee.toFixed(4)});const ne=.985,ce=.005,de=16;let B=K,Q=ee,re=performance.now(),ie=0;const oe=fe=>{ie++;const pe=fe-re;re=fe,B*=Math.pow(ne,pe/de),Q*=Math.pow(ne,pe/de);const Pe=Math.hypot(B,Q);if(Pe<ce){console.log("[Inertia] Animation stopped after",ie,"frames, final speed:",Pe.toFixed(4)),M.current=null;return}const Ce=B*pe,$e=Q*pe;W(Ce,$e,k.current),M.current=requestAnimationFrame(oe)};M.current=requestAnimationFrame(oe),console.log("[Inertia] Animation frame requested")},[W]),U=O.useCallback(()=>{M.current&&(cancelAnimationFrame(M.current),M.current=null),R.current=[]},[]),G=O.useCallback((K,ee)=>{r(ne=>{const ce=j(K(ne));return ce!==ne&&z(ne,ce,ee),ce})},[z,j,r]),F=O.useCallback((K,ee)=>{typeof K!="number"||Number.isNaN(K)||K===0||G(ne=>ne+K,ee)},[G]),Y=O.useCallback((K,ee)=>{typeof K!="number"||Number.isNaN(K)||G(()=>K,ee)},[G]),X=O.useCallback(K=>{if(x.current){x.current=!1;return}l&&l({x:K.target.scrollLeft,y:K.target.scrollTop})},[l]);O.useEffect(()=>{w.current&&(x.current=!0,w.current.scrollLeft!==s.x&&(w.current.scrollLeft=s.x),w.current.scrollTop!==s.y&&(w.current.scrollTop=s.y))},[s,w]),O.useEffect(()=>{const K=p;if(!K)return;const ee=re=>{const[ie,oe]=re;return Math.hypot(ie.clientX-oe.clientX,ie.clientY-oe.clientY)},ne=re=>{const[ie,oe]=re;return{clientX:(ie.clientX+oe.clientX)/2,clientY:(ie.clientY+oe.clientY)/2}},ce=()=>{h.current=p0(),T(!1)},de=re=>{if(console.log("[Inertia] handleTouchStart called:",{touchCount:re.touches.length}),U(),re.touches.length===2){ce();const ie=ne(re.touches),oe=ee(re.touches);b.current={active:!1,startDistance:oe,startZoom:k.current,lastCenter:ie},_.current={active:!1,startX:ie.clientX,startY:ie.clientY,lastX:ie.clientX,lastY:ie.clientY},R.current=[];return}if(re.touches.length===1){_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},b.current={active:!1};const oe=performance.now()-N.current<A,fe=re.touches[0];!C.current&&!oe?(h.current={active:!1,touchId:fe.identifier,startX:fe.clientX,startY:fe.clientY,lastX:fe.clientX,lastY:fe.clientY},console.log("[Inertia] TouchStart tracked:",{touchId:fe.identifier})):(h.current={active:!1,touchId:fe.identifier,startX:fe.clientX,startY:fe.clientY,lastX:fe.clientX,lastY:fe.clientY},console.log("[Inertia] TouchStart (blocked but tracking):",{touchId:fe.identifier,isDragging:C.current,isInCooldown:oe}));return}ce(),b.current={active:!1},_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},R.current=[]},B=re=>{if(console.log("[Inertia] handleTouchMove called:",{touchCount:re.touches.length}),re.touches.length===2){ce();const ie=ne(re.touches),oe=ee(re.touches),fe=b.current,pe=fe.startDistance>0?oe/fe.startDistance:1;if(Math.abs(pe-1)>.05){fe.active||(b.current={...fe,active:!0}),re.preventDefault(),re.stopPropagation();const $e=j(fe.startZoom*pe);Y($e,ie),b.current={...fe,active:!0,startDistance:fe.startDistance,startZoom:fe.startZoom,lastCenter:ie}}else{const We={..._.current},xt=ie.clientX-We.lastX,Dt=ie.clientY-We.lastY,Yt=ie.clientX-We.startX,rt=ie.clientY-We.startY,Fn=Math.hypot(Yt,rt),On=5;if(!We.active&&Fn>On&&(We.active=!0),We.active){re.preventDefault(),re.stopPropagation(),W(xt,Dt,k.current);const it=performance.now();R.current.push({x:ie.clientX,y:ie.clientY,time:it}),R.current.length>I&&R.current.shift()}_.current={...We,lastX:ie.clientX,lastY:ie.clientY}}return}if(re.touches.length===1){const ie=(f==null?void 0:f.current)||!1,fe=performance.now()-N.current<A,pe=re.touches[0],Pe=h.current;if(Pe.touchId===null&&(Pe.touchId=pe.identifier,Pe.lastX=pe.clientX,Pe.lastY=pe.clientY),pe.identifier===Pe.touchId||Pe.touchId===null){const Ce=performance.now();R.current.push({x:pe.clientX,y:pe.clientY,time:Ce}),R.current.length>I&&R.current.shift(),console.log("[Inertia] Velocity tracked:",{touchId:pe.identifier,panTouchId:Pe.touchId,historyLength:R.current.length,x:pe.clientX,y:pe.clientY})}else console.log("[Inertia] Touch ID mismatch:",{touchId:pe.identifier,panTouchId:Pe.touchId});if(C.current||fe||ie||pe.identifier!==Pe.touchId&&Pe.touchId!==null)return;if(Pe.active){const Ce=pe.clientX-Pe.lastX,$e=pe.clientY-Pe.lastY;re.preventDefault(),re.stopPropagation(),W(Ce,$e,k.current)}Pe.lastX=pe.clientX,Pe.lastY=pe.clientY;return}ce(),b.current={active:!1},_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0}},Q=re=>{const ie=_.current.active||h.current.active;let oe={vx:0,vy:0};if(R.current.length>=2){oe=V();const pe=Math.hypot(oe.vx,oe.vy),Pe=.01;console.log("[Inertia] Touch end:",{historyLength:R.current.length,velocity:{vx:oe.vx.toFixed(4),vy:oe.vy.toFixed(4)},speed:pe.toFixed(4),panWasActive:ie,willStart:pe>Pe}),pe>Pe?(console.log("[Inertia] Starting animation"),D(oe.vx,oe.vy)):console.log("[Inertia] Speed too low:",pe,"<",Pe)}else console.log("[Inertia] No velocity history:",R.current.length);ce(),b.current={active:!1},_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},setTimeout(()=>{M.current||(R.current=[])},100)};return K.addEventListener("touchstart",de,{passive:!1}),K.addEventListener("touchmove",B,{passive:!1}),K.addEventListener("touchend",Q,{passive:!1}),K.addEventListener("touchcancel",Q,{passive:!1}),()=>{K.removeEventListener("touchstart",de),K.removeEventListener("touchmove",B),K.removeEventListener("touchend",Q),K.removeEventListener("touchcancel",Q),U()}},[W,j,Y,u,f,p,V,D,U]),O.useEffect(()=>{u&&(U(),R.current=[]),h.current=p0(),T(!1),b.current={active:!1},_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},C.current=u,u||(N.current=performance.now())},[u,U]);const te=O.useCallback(()=>{const K=h.current;K.touchId!==null&&!K.active&&(K.active=!0,T(!0))},[]);return{localCanvasContainerDivRef:y,handleZoom:F,handleNativeCanvasScroll:X,isSingleFingerPanningActive:S,activateSingleFingerPan:te}}function yE({elements:t,selectedElements:e,mode:n,clipboardRef:r,simulationSettings:i,simulatorCore:s}){try{if(t&&(window.__PETRI_NET_STATE__={places:t.places,transitions:t.transitions,arcs:t.arcs,selectedElements:e||[]}),typeof n<"u"&&(window.__PETRI_NET_MODE__=n),r&&(window.__PETRI_NET_CLIPBOARD__=r),i){const c=!!(i!=null&&i.batchMode),u=!!(i!=null&&i.limitIterations),f=Number(i==null?void 0:i.maxIterations),p=Number.isFinite(f)&&f>0?Math.floor(f):2e5,m=!!(i!=null&&i.useNonVisualRun||c);window.__PETRI_NET_NON_VISUAL_RUN__=m,window.__PETRI_NET_SETTINGS__={...window.__PETRI_NET_SETTINGS__||{},batchMode:c,limitIterations:u,maxIterations:p}}s&&!window.__PETRI_NET_SIM_CORE__&&(window.__PETRI_NET_SIM_CORE__=s)}catch{}}const vE=()=>{const{stageDimensions:e,virtualCanvasDimensions:n,canvasScroll:r,setCanvasScroll:i,zoomLevel:s,setZoomLevel:l,gridSnappingEnabled:c,toggleGridSnapping:u,MIN_ZOOM:f,MAX_ZOOM:p,appRef:m,containerRef:w,setContainerRef:y,stageRef:x}=Go(),{elements:b,setElements:_,selectedElement:S,setSelectedElement:T,selectedElements:h,mode:k,setMode:C,arcStart:N,setArcStart:A,tempArcEnd:M,setTempArcEnd:R,clearSelection:I,setSelection:j,isSettingsDialogOpen:z,setIsSettingsDialogOpen:W,simulationSettings:V,setSimulationSettings:D,historyManagerRef:U,canUndo:G,canRedo:F,handleUndo:Y,handleRedo:X,updateHistory:te,snapToGrid:K,resetEditor:ee,simulatorCore:ne,enabledTransitionIds:ce,clipboardRef:de,setClipboard:B,getClipboard:Q,isShiftPressedRef:re}=$t(),[ie,oe]=O.useState(!1);O.useEffect(()=>{typeof SharedArrayBuffer>"u"?console.warn(" SharedArrayBuffer is not available. This is required for Z3 workers in batch mode. The COOP/COEP service worker should enable this. If this warning persists, the service worker may not be active. Try refreshing the page or checking browser console for service worker errors."):console.log(" SharedArrayBuffer is available - Z3 workers should work correctly")},[]);const{isDragging:fe}=$t(),pe=O.useRef(!1),Pe=O.useRef(null),{localCanvasContainerDivRef:Ce,handleZoom:$e,handleNativeCanvasScroll:We,isSingleFingerPanningActive:xt,activateSingleFingerPan:Dt}=mE({MIN_ZOOM:f,MAX_ZOOM:p,zoomLevel:s,setZoomLevel:l,virtualCanvasDimensions:n,canvasScroll:r,setCanvasScroll:i,setContainerRef:y,isDragging:fe,isSelectionActiveRef:pe}),{handleDeleteElement:Yt,clearAllElements:rt}=Bg();O.useEffect(()=>{yE({elements:b,selectedElements:h,mode:k,clipboardRef:de,simulationSettings:V,simulatorCore:ne})},[b.places,b.transitions,b.arcs,h,k,V==null?void 0:V.useNonVisualRun,V==null?void 0:V.batchMode,V==null?void 0:V.limitIterations,V==null?void 0:V.maxIterations,de,ne]);const{pasteMode:Fn,setPasteMode:On}=$t();return L5({elements:b,setElements:_,selectedElement:S,selectedElements:h,clearSelection:I,setSelection:j,clipboardRef:de,netMode:(V==null?void 0:V.netMode)||"pt",setClipboard:B,getClipboard:Q,onClipboardMismatch:void 0,handleUndo:Y,handleRedo:X,setMode:C,arcStart:N,setArcStart:A,setTempArcEnd:R,setSelectedElement:T,isShiftPressedRef:re,pasteMode:Fn,setPasteMode:On}),E.jsxs("div",{ref:m,className:"app-container h-screen max-h-screen overflow-hidden",tabIndex:-1,children:[E.jsx("button",{className:"fixed top-2.5 right-2 z-50 p-2 bg-white rounded-md shadow-md lg:hidden",onClick:()=>oe(!ie),children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})})}),E.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-white",onWheel:it=>it.stopPropagation(),children:E.jsx(b_,{mode:k,setMode:C,onNew:rt,onUndo:Y,canUndo:G,onRedo:X,canRedo:F,gridSnappingEnabled:c,onToggleGridSnapping:u,onOpenSettings:()=>W(!0),elements:b,setElements:_,updateHistory:te,simulationSettings:V,setSimulationSettings:D,resetEditor:ee})}),E.jsxs("div",{className:`fixed w-80 right-0 top-16 bottom-0 z-30 bg-gray-100/90 backdrop-blur-sm shadow-lg pt-4 flex flex-col overflow-hidden transform transition-transform duration-300 ease-in-out ${ie?"translate-x-0":"translate-x-full"} lg:translate-x-0`,onWheel:it=>it.stopPropagation(),children:[E.jsx("div",{className:"overflow-y-auto pr-2",children:E.jsx(F_,{selectedElement:S,elements:b,setElements:_,updateHistory:te,simulationSettings:V})}),E.jsx("div",{className:"flex-1 overflow-y-auto pr-2 border-t-2 border-gray-200",children:E.jsx(D_,{elements:b,enabledTransitionIds:ce})}),E.jsx("div",{className:"hidden lg:block border-t-2 border-gray-200 mt-auto sticky bottom-0 bg-gray-100",children:E.jsx(l2,{})})]}),E.jsxs("div",{className:"fixed top-20 left-0 bottom-0 right-0 lg:right-80 transition-all duration-300",children:[E.jsx("div",{className:"absolute inset-0 overflow-hidden stage-container bg-gray-200 dark:bg-gray-700","data-testid":"canvas-container",ref:Ce,onScroll:We,children:E.jsx(hE,{handleZoom:$e,ZOOM_STEP:.1,isSingleFingerPanningActive:xt,isSelectionActiveRef:pe,activateSingleFingerPan:Dt})}),E.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-40",children:E.jsx(l2,{isMobile:!0})}),E.jsxs("div",{className:"hidden lg:flex fixed top-24 right-[336px] z-10 flex-col space-y-2 pointer-events-auto",children:[E.jsx("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none",onClick:()=>$e(.1),title:"Zoom In",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),E.jsx("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none",onClick:()=>$e(-.1),title:"Zoom Out",children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})}),E.jsxs("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none text-xs font-mono",onClick:()=>{l(1),i({x:0,y:0})},title:"Reset Zoom",children:[Math.round(s*100),"%"]})]}),E.jsx(pE,{}),E.jsx(gE,{}),E.jsx(j4,{ref:Pe})]}),E.jsx(B_,{isOpen:z,onClose:()=>W(!1)})]})},xE=()=>E.jsx(_w,{children:E.jsx(__,{children:E.jsx(k_,{children:E.jsx(vE,{})})})});g0.createRoot(document.getElementById("root")).render(E.jsx(tn.StrictMode,{children:E.jsx(xE,{})}));export{Ro as a,Yn as b,ba as c,Co as d,pr as e,Aw as f,Pw as g,SE as h,wE as i,xl as j,Mw as p};
//# sourceMappingURL=index-272524b8.js.map
