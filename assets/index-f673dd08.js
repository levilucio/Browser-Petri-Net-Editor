(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var fE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function il(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function hE(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var $2={exports:{}},Rc={},H2={exports:{}},Re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sl=Symbol.for("react.element"),W6=Symbol.for("react.portal"),$6=Symbol.for("react.fragment"),H6=Symbol.for("react.strict_mode"),X6=Symbol.for("react.profiler"),Y6=Symbol.for("react.provider"),K6=Symbol.for("react.context"),Q6=Symbol.for("react.forward_ref"),Z6=Symbol.for("react.suspense"),q6=Symbol.for("react.memo"),J6=Symbol.for("react.lazy"),gm=Symbol.iterator;function ex(t){return t===null||typeof t!="object"?null:(t=gm&&t[gm]||t["@@iterator"],typeof t=="function"?t:null)}var X2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y2=Object.assign,K2={};function ko(t,e,n){this.props=t,this.context=e,this.refs=K2,this.updater=n||X2}ko.prototype.isReactComponent={};ko.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ko.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Q2(){}Q2.prototype=ko.prototype;function dp(t,e,n){this.props=t,this.context=e,this.refs=K2,this.updater=n||X2}var fp=dp.prototype=new Q2;fp.constructor=dp;Y2(fp,ko.prototype);fp.isPureReactComponent=!0;var mm=Array.isArray,Z2=Object.prototype.hasOwnProperty,hp={current:null},q2={key:!0,ref:!0,__self:!0,__source:!0};function J2(t,e,n){var r,i={},s=null,l=null;if(e!=null)for(r in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(s=""+e.key),e)Z2.call(e,r)&&!q2.hasOwnProperty(r)&&(i[r]=e[r]);var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){for(var u=Array(c),f=0;f<c;f++)u[f]=arguments[f+2];i.children=u}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)i[r]===void 0&&(i[r]=c[r]);return{$$typeof:sl,type:t,key:s,ref:l,props:i,_owner:hp.current}}function tx(t,e){return{$$typeof:sl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function pp(t){return typeof t=="object"&&t!==null&&t.$$typeof===sl}function nx(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var ym=/\/+/g;function nh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?nx(""+t.key):e.toString(36)}function Fu(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case sl:case W6:l=!0}}if(l)return l=t,i=i(l),t=r===""?"."+nh(l,0):r,mm(i)?(n="",t!=null&&(n=t.replace(ym,"$&/")+"/"),Fu(i,e,n,"",function(f){return f})):i!=null&&(pp(i)&&(i=tx(i,n+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(ym,"$&/")+"/")+t)),e.push(i)),1;if(l=0,r=r===""?".":r+":",mm(t))for(var c=0;c<t.length;c++){s=t[c];var u=r+nh(s,c);l+=Fu(s,e,n,u,i)}else if(u=ex(t),typeof u=="function")for(t=u.call(t),c=0;!(s=t.next()).done;)s=s.value,u=r+nh(s,c++),l+=Fu(s,e,n,u,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function cu(t,e,n){if(t==null)return t;var r=[],i=0;return Fu(t,r,"","",function(s){return e.call(n,s,i++)}),r}function rx(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var tn={current:null},ju={transition:null},ix={ReactCurrentDispatcher:tn,ReactCurrentBatchConfig:ju,ReactCurrentOwner:hp};function ev(){throw Error("act(...) is not supported in production builds of React.")}Re.Children={map:cu,forEach:function(t,e,n){cu(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cu(t,function(){e++}),e},toArray:function(t){return cu(t,function(e){return e})||[]},only:function(t){if(!pp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Re.Component=ko;Re.Fragment=$6;Re.Profiler=X6;Re.PureComponent=dp;Re.StrictMode=H6;Re.Suspense=Z6;Re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ix;Re.act=ev;Re.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Y2({},t.props),i=t.key,s=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,l=hp.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(u in e)Z2.call(e,u)&&!q2.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&c!==void 0?c[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var f=0;f<u;f++)c[f]=arguments[f+2];r.children=c}return{$$typeof:sl,type:t.type,key:i,ref:s,props:r,_owner:l}};Re.createContext=function(t){return t={$$typeof:K6,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Y6,_context:t},t.Consumer=t};Re.createElement=J2;Re.createFactory=function(t){var e=J2.bind(null,t);return e.type=t,e};Re.createRef=function(){return{current:null}};Re.forwardRef=function(t){return{$$typeof:Q6,render:t}};Re.isValidElement=pp;Re.lazy=function(t){return{$$typeof:J6,_payload:{_status:-1,_result:t},_init:rx}};Re.memo=function(t,e){return{$$typeof:q6,type:t,compare:e===void 0?null:e}};Re.startTransition=function(t){var e=ju.transition;ju.transition={};try{t()}finally{ju.transition=e}};Re.unstable_act=ev;Re.useCallback=function(t,e){return tn.current.useCallback(t,e)};Re.useContext=function(t){return tn.current.useContext(t)};Re.useDebugValue=function(){};Re.useDeferredValue=function(t){return tn.current.useDeferredValue(t)};Re.useEffect=function(t,e){return tn.current.useEffect(t,e)};Re.useId=function(){return tn.current.useId()};Re.useImperativeHandle=function(t,e,n){return tn.current.useImperativeHandle(t,e,n)};Re.useInsertionEffect=function(t,e){return tn.current.useInsertionEffect(t,e)};Re.useLayoutEffect=function(t,e){return tn.current.useLayoutEffect(t,e)};Re.useMemo=function(t,e){return tn.current.useMemo(t,e)};Re.useReducer=function(t,e,n){return tn.current.useReducer(t,e,n)};Re.useRef=function(t){return tn.current.useRef(t)};Re.useState=function(t){return tn.current.useState(t)};Re.useSyncExternalStore=function(t,e,n){return tn.current.useSyncExternalStore(t,e,n)};Re.useTransition=function(){return tn.current.useTransition()};Re.version="18.3.1";H2.exports=Re;var B=H2.exports;const Ht=il(B);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sx=B,ox=Symbol.for("react.element"),ax=Symbol.for("react.fragment"),lx=Object.prototype.hasOwnProperty,ux=sx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,cx={key:!0,ref:!0,__self:!0,__source:!0};function tv(t,e,n){var r,i={},s=null,l=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)lx.call(e,r)&&!cx.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ox,type:t,key:s,ref:l,props:i,_owner:ux.current}}Rc.Fragment=ax;Rc.jsx=tv;Rc.jsxs=tv;$2.exports=Rc;var P=$2.exports,e0={},nv={exports:{}},Tn={},rv={exports:{}},iv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(O,$){var W=O.length;O.push($);e:for(;0<W;){var K=W-1>>>1,Q=O[K];if(0<i(Q,$))O[K]=$,O[W]=Q,W=K;else break e}}function n(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var $=O[0],W=O.pop();if(W!==$){O[0]=W;e:for(var K=0,Q=O.length,q=Q>>>1;K<q;){var oe=2*(K+1)-1,we=O[oe],ye=oe+1,U=O[ye];if(0>i(we,W))ye<Q&&0>i(U,we)?(O[K]=U,O[ye]=W,K=ye):(O[K]=we,O[oe]=W,K=oe);else if(ye<Q&&0>i(U,W))O[K]=U,O[ye]=W,K=ye;else break e}}return $}function i(O,$){var W=O.sortIndex-$.sortIndex;return W!==0?W:O.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var u=[],f=[],h=1,m=null,x=3,y=!1,w=!1,T=!1,k=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(O){for(var $=n(f);$!==null;){if($.callback===null)r(f);else if($.startTime<=O)r(f),$.sortIndex=$.expirationTime,e(u,$);else break;$=n(f)}}function S(O){if(T=!1,g(O),!w)if(n(u)!==null)w=!0,G(b);else{var $=n(f);$!==null&&H(S,$.startTime-O)}}function b(O,$){w=!1,T&&(T=!1,_(A),A=-1),y=!0;var W=x;try{for(g($),m=n(u);m!==null&&(!(m.expirationTime>$)||O&&!R());){var K=m.callback;if(typeof K=="function"){m.callback=null,x=m.priorityLevel;var Q=K(m.expirationTime<=$);$=t.unstable_now(),typeof Q=="function"?m.callback=Q:m===n(u)&&r(u),g($)}else r(u);m=n(u)}if(m!==null)var q=!0;else{var oe=n(f);oe!==null&&H(S,oe.startTime-$),q=!1}return q}finally{m=null,x=W,y=!1}}var N=!1,I=null,A=-1,F=5,M=-1;function R(){return!(t.unstable_now()-M<F)}function z(){if(I!==null){var O=t.unstable_now();M=O;var $=!0;try{$=I(!0,O)}finally{$?V():(N=!1,I=null)}}else N=!1}var V;if(typeof C=="function")V=function(){C(z)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,D=j.port2;j.port1.onmessage=z,V=function(){D.postMessage(null)}}else V=function(){k(z,0)};function G(O){I=O,N||(N=!0,V())}function H(O,$){A=k(function(){O(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_continueExecution=function(){w||y||(w=!0,G(b))},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<O?Math.floor(1e3/O):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(O){switch(x){case 1:case 2:case 3:var $=3;break;default:$=x}var W=x;x=$;try{return O()}finally{x=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(O,$){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=x;x=O;try{return $()}finally{x=W}},t.unstable_scheduleCallback=function(O,$,W){var K=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?K+W:K):W=K,O){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=W+Q,O={id:h++,callback:$,priorityLevel:O,startTime:W,expirationTime:Q,sortIndex:-1},W>K?(O.sortIndex=W,e(f,O),n(u)===null&&O===n(f)&&(T?(_(A),A=-1):T=!0,H(S,W-K))):(O.sortIndex=Q,e(u,O),w||y||(w=!0,G(b))),O},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(O){var $=x;return function(){var W=x;x=$;try{return O.apply(this,arguments)}finally{x=W}}}})(iv);rv.exports=iv;var Sa=rv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dx=B,kn=Sa;function ne(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sv=new Set,ja={};function cs(t,e){fo(t,e),fo(t+"Capture",e)}function fo(t,e){for(ja[t]=e,t=0;t<e.length;t++)sv.add(e[t])}var Gr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),t0=Object.prototype.hasOwnProperty,fx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vm={},xm={};function hx(t){return t0.call(xm,t)?!0:t0.call(vm,t)?!1:fx.test(t)?xm[t]=!0:(vm[t]=!0,!1)}function px(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function gx(t,e,n,r){if(e===null||typeof e>"u"||px(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function nn(t,e,n,r,i,s,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=l}var Dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Dt[t]=new nn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Dt[e]=new nn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Dt[t]=new nn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Dt[t]=new nn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Dt[t]=new nn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Dt[t]=new nn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Dt[t]=new nn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Dt[t]=new nn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Dt[t]=new nn(t,5,!1,t.toLowerCase(),null,!1,!1)});var gp=/[\-:]([a-z])/g;function mp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(gp,mp);Dt[e]=new nn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(gp,mp);Dt[e]=new nn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(gp,mp);Dt[e]=new nn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Dt[t]=new nn(t,1,!1,t.toLowerCase(),null,!1,!1)});Dt.xlinkHref=new nn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Dt[t]=new nn(t,1,!1,t.toLowerCase(),null,!0,!0)});function yp(t,e,n,r){var i=Dt.hasOwnProperty(e)?Dt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gx(e,n,i,r)&&(n=null),r||i===null?hx(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Hr=dx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,du=Symbol.for("react.element"),Ws=Symbol.for("react.portal"),$s=Symbol.for("react.fragment"),vp=Symbol.for("react.strict_mode"),n0=Symbol.for("react.profiler"),ov=Symbol.for("react.provider"),av=Symbol.for("react.context"),xp=Symbol.for("react.forward_ref"),r0=Symbol.for("react.suspense"),i0=Symbol.for("react.suspense_list"),wp=Symbol.for("react.memo"),fi=Symbol.for("react.lazy"),lv=Symbol.for("react.offscreen"),wm=Symbol.iterator;function ta(t){return t===null||typeof t!="object"?null:(t=wm&&t[wm]||t["@@iterator"],typeof t=="function"?t:null)}var ot=Object.assign,rh;function ya(t){if(rh===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);rh=e&&e[1]||""}return`
`+rh+t}var ih=!1;function sh(t,e){if(!t||ih)return"";ih=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(f){var r=f}Reflect.construct(t,[],e)}else{try{e.call()}catch(f){r=f}t.call(e.prototype)}else{try{throw Error()}catch(f){r=f}t()}}catch(f){if(f&&r&&typeof f.stack=="string"){for(var i=f.stack.split(`
`),s=r.stack.split(`
`),l=i.length-1,c=s.length-1;1<=l&&0<=c&&i[l]!==s[c];)c--;for(;1<=l&&0<=c;l--,c--)if(i[l]!==s[c]){if(l!==1||c!==1)do if(l--,c--,0>c||i[l]!==s[c]){var u=`
`+i[l].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=l&&0<=c);break}}}finally{ih=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ya(t):""}function mx(t){switch(t.tag){case 5:return ya(t.type);case 16:return ya("Lazy");case 13:return ya("Suspense");case 19:return ya("SuspenseList");case 0:case 2:case 15:return t=sh(t.type,!1),t;case 11:return t=sh(t.type.render,!1),t;case 1:return t=sh(t.type,!0),t;default:return""}}function s0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $s:return"Fragment";case Ws:return"Portal";case n0:return"Profiler";case vp:return"StrictMode";case r0:return"Suspense";case i0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case av:return(t.displayName||"Context")+".Consumer";case ov:return(t._context.displayName||"Context")+".Provider";case xp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case wp:return e=t.displayName||null,e!==null?e:s0(t.type)||"Memo";case fi:e=t._payload,t=t._init;try{return s0(t(e))}catch{}}return null}function yx(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return s0(e);case 8:return e===vp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ei(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function uv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function vx(t){var e=uv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(l){r=""+l,s.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fu(t){t._valueTracker||(t._valueTracker=vx(t))}function cv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=uv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ju(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function o0(t,e){var n=e.checked;return ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function _m(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ei(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function dv(t,e){e=e.checked,e!=null&&yp(t,"checked",e,!1)}function a0(t,e){dv(t,e);var n=Ei(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?l0(t,e.type,n):e.hasOwnProperty("defaultValue")&&l0(t,e.type,Ei(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Sm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function l0(t,e,n){(e!=="number"||Ju(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var va=Array.isArray;function ro(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ei(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function u0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function km(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ne(92));if(va(n)){if(1<n.length)throw Error(ne(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ei(n)}}function fv(t,e){var n=Ei(e.value),r=Ei(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Tm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function hv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function c0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hu,pv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hu=hu||document.createElement("div"),hu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Oa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ka={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xx=["Webkit","ms","Moz","O"];Object.keys(ka).forEach(function(t){xx.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ka[e]=ka[t]})});function gv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ka.hasOwnProperty(t)&&ka[t]?(""+e).trim():e+"px"}function mv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=gv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var wx=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function d0(t,e){if(e){if(wx[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function f0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var h0=null;function _p(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var p0=null,io=null,so=null;function Cm(t){if(t=ll(t)){if(typeof p0!="function")throw Error(ne(280));var e=t.stateNode;e&&(e=Oc(e),p0(t.stateNode,t.type,e))}}function yv(t){io?so?so.push(t):so=[t]:io=t}function vv(){if(io){var t=io,e=so;if(so=io=null,Cm(t),e)for(t=0;t<e.length;t++)Cm(e[t])}}function xv(t,e){return t(e)}function wv(){}var oh=!1;function _v(t,e,n){if(oh)return t(e,n);oh=!0;try{return xv(t,e,n)}finally{oh=!1,(io!==null||so!==null)&&(wv(),vv())}}function Da(t,e){var n=t.stateNode;if(n===null)return null;var r=Oc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ne(231,e,typeof n));return n}var g0=!1;if(Gr)try{var na={};Object.defineProperty(na,"passive",{get:function(){g0=!0}}),window.addEventListener("test",na,na),window.removeEventListener("test",na,na)}catch{g0=!1}function _x(t,e,n,r,i,s,l,c,u){var f=Array.prototype.slice.call(arguments,3);try{e.apply(n,f)}catch(h){this.onError(h)}}var Ta=!1,ec=null,tc=!1,m0=null,Sx={onError:function(t){Ta=!0,ec=t}};function kx(t,e,n,r,i,s,l,c,u){Ta=!1,ec=null,_x.apply(Sx,arguments)}function Tx(t,e,n,r,i,s,l,c,u){if(kx.apply(this,arguments),Ta){if(Ta){var f=ec;Ta=!1,ec=null}else throw Error(ne(198));tc||(tc=!0,m0=f)}}function ds(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Sv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function bm(t){if(ds(t)!==t)throw Error(ne(188))}function Cx(t){var e=t.alternate;if(!e){if(e=ds(t),e===null)throw Error(ne(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return bm(i),t;if(s===r)return bm(i),e;s=s.sibling}throw Error(ne(188))}if(n.return!==r.return)n=i,r=s;else{for(var l=!1,c=i.child;c;){if(c===n){l=!0,n=i,r=s;break}if(c===r){l=!0,r=i,n=s;break}c=c.sibling}if(!l){for(c=s.child;c;){if(c===n){l=!0,n=s,r=i;break}if(c===r){l=!0,r=s,n=i;break}c=c.sibling}if(!l)throw Error(ne(189))}}if(n.alternate!==r)throw Error(ne(190))}if(n.tag!==3)throw Error(ne(188));return n.stateNode.current===n?t:e}function kv(t){return t=Cx(t),t!==null?Tv(t):null}function Tv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Tv(t);if(e!==null)return e;t=t.sibling}return null}var Cv=kn.unstable_scheduleCallback,Em=kn.unstable_cancelCallback,bx=kn.unstable_shouldYield,Ex=kn.unstable_requestPaint,ht=kn.unstable_now,Px=kn.unstable_getCurrentPriorityLevel,Sp=kn.unstable_ImmediatePriority,bv=kn.unstable_UserBlockingPriority,nc=kn.unstable_NormalPriority,Nx=kn.unstable_LowPriority,Ev=kn.unstable_IdlePriority,Ic=null,kr=null;function Ax(t){if(kr&&typeof kr.onCommitFiberRoot=="function")try{kr.onCommitFiberRoot(Ic,t,void 0,(t.current.flags&128)===128)}catch{}}var rr=Math.clz32?Math.clz32:Ix,Mx=Math.log,Rx=Math.LN2;function Ix(t){return t>>>=0,t===0?32:31-(Mx(t)/Rx|0)|0}var pu=64,gu=4194304;function xa(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function rc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,l=n&268435455;if(l!==0){var c=l&~i;c!==0?r=xa(c):(s&=l,s!==0&&(r=xa(s)))}else l=n&~i,l!==0?r=xa(l):s!==0&&(r=xa(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-rr(e),i=1<<n,r|=t[n],e&=~i;return r}function Lx(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fx(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var l=31-rr(s),c=1<<l,u=i[l];u===-1?(!(c&n)||c&r)&&(i[l]=Lx(c,e)):u<=e&&(t.expiredLanes|=c),s&=~c}}function y0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Pv(){var t=pu;return pu<<=1,!(pu&4194240)&&(pu=64),t}function ah(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ol(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-rr(e),t[e]=n}function jx(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-rr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function kp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-rr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Ue=0;function Nv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Av,Tp,Mv,Rv,Iv,v0=!1,mu=[],xi=null,wi=null,_i=null,za=new Map,Ba=new Map,gi=[],Ox="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pm(t,e){switch(t){case"focusin":case"focusout":xi=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":_i=null;break;case"pointerover":case"pointerout":za.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ba.delete(e.pointerId)}}function ra(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=ll(e),e!==null&&Tp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Dx(t,e,n,r,i){switch(e){case"focusin":return xi=ra(xi,t,e,n,r,i),!0;case"dragenter":return wi=ra(wi,t,e,n,r,i),!0;case"mouseover":return _i=ra(_i,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return za.set(s,ra(za.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ba.set(s,ra(Ba.get(s)||null,t,e,n,r,i)),!0}return!1}function Lv(t){var e=es(t.target);if(e!==null){var n=ds(e);if(n!==null){if(e=n.tag,e===13){if(e=Sv(n),e!==null){t.blockedOn=e,Iv(t.priority,function(){Mv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ou(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=x0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);h0=r,n.target.dispatchEvent(r),h0=null}else return e=ll(n),e!==null&&Tp(e),t.blockedOn=n,!1;e.shift()}return!0}function Nm(t,e,n){Ou(t)&&n.delete(e)}function zx(){v0=!1,xi!==null&&Ou(xi)&&(xi=null),wi!==null&&Ou(wi)&&(wi=null),_i!==null&&Ou(_i)&&(_i=null),za.forEach(Nm),Ba.forEach(Nm)}function ia(t,e){t.blockedOn===e&&(t.blockedOn=null,v0||(v0=!0,kn.unstable_scheduleCallback(kn.unstable_NormalPriority,zx)))}function Ua(t){function e(i){return ia(i,t)}if(0<mu.length){ia(mu[0],t);for(var n=1;n<mu.length;n++){var r=mu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(xi!==null&&ia(xi,t),wi!==null&&ia(wi,t),_i!==null&&ia(_i,t),za.forEach(e),Ba.forEach(e),n=0;n<gi.length;n++)r=gi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<gi.length&&(n=gi[0],n.blockedOn===null);)Lv(n),n.blockedOn===null&&gi.shift()}var oo=Hr.ReactCurrentBatchConfig,ic=!0;function Bx(t,e,n,r){var i=Ue,s=oo.transition;oo.transition=null;try{Ue=1,Cp(t,e,n,r)}finally{Ue=i,oo.transition=s}}function Ux(t,e,n,r){var i=Ue,s=oo.transition;oo.transition=null;try{Ue=4,Cp(t,e,n,r)}finally{Ue=i,oo.transition=s}}function Cp(t,e,n,r){if(ic){var i=x0(t,e,n,r);if(i===null)yh(t,e,r,sc,n),Pm(t,r);else if(Dx(i,t,e,n,r))r.stopPropagation();else if(Pm(t,r),e&4&&-1<Ox.indexOf(t)){for(;i!==null;){var s=ll(i);if(s!==null&&Av(s),s=x0(t,e,n,r),s===null&&yh(t,e,r,sc,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else yh(t,e,r,null,n)}}var sc=null;function x0(t,e,n,r){if(sc=null,t=_p(r),t=es(t),t!==null)if(e=ds(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Sv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return sc=t,null}function Fv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Px()){case Sp:return 1;case bv:return 4;case nc:case Nx:return 16;case Ev:return 536870912;default:return 16}default:return 16}}var yi=null,bp=null,Du=null;function jv(){if(Du)return Du;var t,e=bp,n=e.length,r,i="value"in yi?yi.value:yi.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var l=n-t;for(r=1;r<=l&&e[n-r]===i[s-r];r++);return Du=i.slice(t,1<r?1-r:void 0)}function zu(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yu(){return!0}function Am(){return!1}function Cn(t){function e(n,r,i,s,l){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=l,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(s):s[c]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?yu:Am,this.isPropagationStopped=Am,this}return ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=yu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=yu)},persist:function(){},isPersistent:yu}),e}var To={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ep=Cn(To),al=ot({},To,{view:0,detail:0}),Gx=Cn(al),lh,uh,sa,Lc=ot({},al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==sa&&(sa&&t.type==="mousemove"?(lh=t.screenX-sa.screenX,uh=t.screenY-sa.screenY):uh=lh=0,sa=t),lh)},movementY:function(t){return"movementY"in t?t.movementY:uh}}),Mm=Cn(Lc),Vx=ot({},Lc,{dataTransfer:0}),Wx=Cn(Vx),$x=ot({},al,{relatedTarget:0}),ch=Cn($x),Hx=ot({},To,{animationName:0,elapsedTime:0,pseudoElement:0}),Xx=Cn(Hx),Yx=ot({},To,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Kx=Cn(Yx),Qx=ot({},To,{data:0}),Rm=Cn(Qx),Zx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function e8(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Jx[t])?!!e[t]:!1}function Pp(){return e8}var t8=ot({},al,{key:function(t){if(t.key){var e=Zx[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=zu(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?qx[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pp,charCode:function(t){return t.type==="keypress"?zu(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?zu(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),n8=Cn(t8),r8=ot({},Lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Im=Cn(r8),i8=ot({},al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pp}),s8=Cn(i8),o8=ot({},To,{propertyName:0,elapsedTime:0,pseudoElement:0}),a8=Cn(o8),l8=ot({},Lc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),u8=Cn(l8),c8=[9,13,27,32],Np=Gr&&"CompositionEvent"in window,Ca=null;Gr&&"documentMode"in document&&(Ca=document.documentMode);var d8=Gr&&"TextEvent"in window&&!Ca,Ov=Gr&&(!Np||Ca&&8<Ca&&11>=Ca),Lm=String.fromCharCode(32),Fm=!1;function Dv(t,e){switch(t){case"keyup":return c8.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Hs=!1;function f8(t,e){switch(t){case"compositionend":return zv(e);case"keypress":return e.which!==32?null:(Fm=!0,Lm);case"textInput":return t=e.data,t===Lm&&Fm?null:t;default:return null}}function h8(t,e){if(Hs)return t==="compositionend"||!Np&&Dv(t,e)?(t=jv(),Du=bp=yi=null,Hs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ov&&e.locale!=="ko"?null:e.data;default:return null}}var p8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!p8[t.type]:e==="textarea"}function Bv(t,e,n,r){yv(r),e=oc(e,"onChange"),0<e.length&&(n=new Ep("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var ba=null,Ga=null;function g8(t){Zv(t,0)}function Fc(t){var e=Ks(t);if(cv(e))return t}function m8(t,e){if(t==="change")return e}var Uv=!1;if(Gr){var dh;if(Gr){var fh="oninput"in document;if(!fh){var Om=document.createElement("div");Om.setAttribute("oninput","return;"),fh=typeof Om.oninput=="function"}dh=fh}else dh=!1;Uv=dh&&(!document.documentMode||9<document.documentMode)}function Dm(){ba&&(ba.detachEvent("onpropertychange",Gv),Ga=ba=null)}function Gv(t){if(t.propertyName==="value"&&Fc(Ga)){var e=[];Bv(e,Ga,t,_p(t)),_v(g8,e)}}function y8(t,e,n){t==="focusin"?(Dm(),ba=e,Ga=n,ba.attachEvent("onpropertychange",Gv)):t==="focusout"&&Dm()}function v8(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Fc(Ga)}function x8(t,e){if(t==="click")return Fc(e)}function w8(t,e){if(t==="input"||t==="change")return Fc(e)}function _8(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var or=typeof Object.is=="function"?Object.is:_8;function Va(t,e){if(or(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!t0.call(e,i)||!or(t[i],e[i]))return!1}return!0}function zm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Bm(t,e){var n=zm(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=zm(n)}}function Vv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Vv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Wv(){for(var t=window,e=Ju();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ju(t.document)}return e}function Ap(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function S8(t){var e=Wv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Vv(n.ownerDocument.documentElement,n)){if(r!==null&&Ap(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=Bm(n,s);var l=Bm(n,r);i&&l&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var k8=Gr&&"documentMode"in document&&11>=document.documentMode,Xs=null,w0=null,Ea=null,_0=!1;function Um(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;_0||Xs==null||Xs!==Ju(r)||(r=Xs,"selectionStart"in r&&Ap(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ea&&Va(Ea,r)||(Ea=r,r=oc(w0,"onSelect"),0<r.length&&(e=new Ep("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Xs)))}function vu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ys={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionend:vu("Transition","TransitionEnd")},hh={},$v={};Gr&&($v=document.createElement("div").style,"AnimationEvent"in window||(delete Ys.animationend.animation,delete Ys.animationiteration.animation,delete Ys.animationstart.animation),"TransitionEvent"in window||delete Ys.transitionend.transition);function jc(t){if(hh[t])return hh[t];if(!Ys[t])return t;var e=Ys[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in $v)return hh[t]=e[n];return t}var Hv=jc("animationend"),Xv=jc("animationiteration"),Yv=jc("animationstart"),Kv=jc("transitionend"),Qv=new Map,Gm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ai(t,e){Qv.set(t,e),cs(e,[t])}for(var ph=0;ph<Gm.length;ph++){var gh=Gm[ph],T8=gh.toLowerCase(),C8=gh[0].toUpperCase()+gh.slice(1);Ai(T8,"on"+C8)}Ai(Hv,"onAnimationEnd");Ai(Xv,"onAnimationIteration");Ai(Yv,"onAnimationStart");Ai("dblclick","onDoubleClick");Ai("focusin","onFocus");Ai("focusout","onBlur");Ai(Kv,"onTransitionEnd");fo("onMouseEnter",["mouseout","mouseover"]);fo("onMouseLeave",["mouseout","mouseover"]);fo("onPointerEnter",["pointerout","pointerover"]);fo("onPointerLeave",["pointerout","pointerover"]);cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cs("onBeforeInput",["compositionend","keypress","textInput","paste"]);cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),b8=new Set("cancel close invalid load scroll toggle".split(" ").concat(wa));function Vm(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Tx(r,e,void 0,t),t.currentTarget=null}function Zv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var l=r.length-1;0<=l;l--){var c=r[l],u=c.instance,f=c.currentTarget;if(c=c.listener,u!==s&&i.isPropagationStopped())break e;Vm(i,c,f),s=u}else for(l=0;l<r.length;l++){if(c=r[l],u=c.instance,f=c.currentTarget,c=c.listener,u!==s&&i.isPropagationStopped())break e;Vm(i,c,f),s=u}}}if(tc)throw t=m0,tc=!1,m0=null,t}function Qe(t,e){var n=e[b0];n===void 0&&(n=e[b0]=new Set);var r=t+"__bubble";n.has(r)||(qv(e,t,2,!1),n.add(r))}function mh(t,e,n){var r=0;e&&(r|=4),qv(n,t,r,e)}var xu="_reactListening"+Math.random().toString(36).slice(2);function Wa(t){if(!t[xu]){t[xu]=!0,sv.forEach(function(n){n!=="selectionchange"&&(b8.has(n)||mh(n,!1,t),mh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[xu]||(e[xu]=!0,mh("selectionchange",!1,e))}}function qv(t,e,n,r){switch(Fv(e)){case 1:var i=Bx;break;case 4:i=Ux;break;default:i=Cp}n=i.bind(null,e,n,t),i=void 0,!g0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function yh(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===i||c.nodeType===8&&c.parentNode===i)break;if(l===4)for(l=r.return;l!==null;){var u=l.tag;if((u===3||u===4)&&(u=l.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;l=l.return}for(;c!==null;){if(l=es(c),l===null)return;if(u=l.tag,u===5||u===6){r=s=l;continue e}c=c.parentNode}}r=r.return}_v(function(){var f=s,h=_p(n),m=[];e:{var x=Qv.get(t);if(x!==void 0){var y=Ep,w=t;switch(t){case"keypress":if(zu(n)===0)break e;case"keydown":case"keyup":y=n8;break;case"focusin":w="focus",y=ch;break;case"focusout":w="blur",y=ch;break;case"beforeblur":case"afterblur":y=ch;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=Mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=Wx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=s8;break;case Hv:case Xv:case Yv:y=Xx;break;case Kv:y=a8;break;case"scroll":y=Gx;break;case"wheel":y=u8;break;case"copy":case"cut":case"paste":y=Kx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Im}var T=(e&4)!==0,k=!T&&t==="scroll",_=T?x!==null?x+"Capture":null:x;T=[];for(var C=f,g;C!==null;){g=C;var S=g.stateNode;if(g.tag===5&&S!==null&&(g=S,_!==null&&(S=Da(C,_),S!=null&&T.push($a(C,S,g)))),k)break;C=C.return}0<T.length&&(x=new y(x,w,null,n,h),m.push({event:x,listeners:T}))}}if(!(e&7)){e:{if(x=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",x&&n!==h0&&(w=n.relatedTarget||n.fromElement)&&(es(w)||w[Vr]))break e;if((y||x)&&(x=h.window===h?h:(x=h.ownerDocument)?x.defaultView||x.parentWindow:window,y?(w=n.relatedTarget||n.toElement,y=f,w=w?es(w):null,w!==null&&(k=ds(w),w!==k||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=f),y!==w)){if(T=Mm,S="onMouseLeave",_="onMouseEnter",C="mouse",(t==="pointerout"||t==="pointerover")&&(T=Im,S="onPointerLeave",_="onPointerEnter",C="pointer"),k=y==null?x:Ks(y),g=w==null?x:Ks(w),x=new T(S,C+"leave",y,n,h),x.target=k,x.relatedTarget=g,S=null,es(h)===f&&(T=new T(_,C+"enter",w,n,h),T.target=g,T.relatedTarget=k,S=T),k=S,y&&w)t:{for(T=y,_=w,C=0,g=T;g;g=zs(g))C++;for(g=0,S=_;S;S=zs(S))g++;for(;0<C-g;)T=zs(T),C--;for(;0<g-C;)_=zs(_),g--;for(;C--;){if(T===_||_!==null&&T===_.alternate)break t;T=zs(T),_=zs(_)}T=null}else T=null;y!==null&&Wm(m,x,y,T,!1),w!==null&&k!==null&&Wm(m,k,w,T,!0)}}e:{if(x=f?Ks(f):window,y=x.nodeName&&x.nodeName.toLowerCase(),y==="select"||y==="input"&&x.type==="file")var b=m8;else if(jm(x))if(Uv)b=w8;else{b=v8;var N=y8}else(y=x.nodeName)&&y.toLowerCase()==="input"&&(x.type==="checkbox"||x.type==="radio")&&(b=x8);if(b&&(b=b(t,f))){Bv(m,b,n,h);break e}N&&N(t,x,f),t==="focusout"&&(N=x._wrapperState)&&N.controlled&&x.type==="number"&&l0(x,"number",x.value)}switch(N=f?Ks(f):window,t){case"focusin":(jm(N)||N.contentEditable==="true")&&(Xs=N,w0=f,Ea=null);break;case"focusout":Ea=w0=Xs=null;break;case"mousedown":_0=!0;break;case"contextmenu":case"mouseup":case"dragend":_0=!1,Um(m,n,h);break;case"selectionchange":if(k8)break;case"keydown":case"keyup":Um(m,n,h)}var I;if(Np)e:{switch(t){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Hs?Dv(t,n)&&(A="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(A="onCompositionStart");A&&(Ov&&n.locale!=="ko"&&(Hs||A!=="onCompositionStart"?A==="onCompositionEnd"&&Hs&&(I=jv()):(yi=h,bp="value"in yi?yi.value:yi.textContent,Hs=!0)),N=oc(f,A),0<N.length&&(A=new Rm(A,t,null,n,h),m.push({event:A,listeners:N}),I?A.data=I:(I=zv(n),I!==null&&(A.data=I)))),(I=d8?f8(t,n):h8(t,n))&&(f=oc(f,"onBeforeInput"),0<f.length&&(h=new Rm("onBeforeInput","beforeinput",null,n,h),m.push({event:h,listeners:f}),h.data=I))}Zv(m,e)})}function $a(t,e,n){return{instance:t,listener:e,currentTarget:n}}function oc(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Da(t,n),s!=null&&r.unshift($a(t,s,i)),s=Da(t,e),s!=null&&r.push($a(t,s,i))),t=t.return}return r}function zs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Wm(t,e,n,r,i){for(var s=e._reactName,l=[];n!==null&&n!==r;){var c=n,u=c.alternate,f=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&f!==null&&(c=f,i?(u=Da(n,s),u!=null&&l.unshift($a(n,u,c))):i||(u=Da(n,s),u!=null&&l.push($a(n,u,c)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var E8=/\r\n?/g,P8=/\u0000|\uFFFD/g;function $m(t){return(typeof t=="string"?t:""+t).replace(E8,`
`).replace(P8,"")}function wu(t,e,n){if(e=$m(e),$m(t)!==e&&n)throw Error(ne(425))}function ac(){}var S0=null,k0=null;function T0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var C0=typeof setTimeout=="function"?setTimeout:void 0,N8=typeof clearTimeout=="function"?clearTimeout:void 0,Hm=typeof Promise=="function"?Promise:void 0,A8=typeof queueMicrotask=="function"?queueMicrotask:typeof Hm<"u"?function(t){return Hm.resolve(null).then(t).catch(M8)}:C0;function M8(t){setTimeout(function(){throw t})}function vh(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ua(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ua(e)}function Si(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Xm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Co=Math.random().toString(36).slice(2),wr="__reactFiber$"+Co,Ha="__reactProps$"+Co,Vr="__reactContainer$"+Co,b0="__reactEvents$"+Co,R8="__reactListeners$"+Co,I8="__reactHandles$"+Co;function es(t){var e=t[wr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Vr]||n[wr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Xm(t);t!==null;){if(n=t[wr])return n;t=Xm(t)}return e}t=n,n=t.parentNode}return null}function ll(t){return t=t[wr]||t[Vr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ks(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ne(33))}function Oc(t){return t[Ha]||null}var E0=[],Qs=-1;function Mi(t){return{current:t}}function Ze(t){0>Qs||(t.current=E0[Qs],E0[Qs]=null,Qs--)}function He(t,e){Qs++,E0[Qs]=t.current,t.current=e}var Pi={},Yt=Mi(Pi),gn=Mi(!1),ss=Pi;function ho(t,e){var n=t.type.contextTypes;if(!n)return Pi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function mn(t){return t=t.childContextTypes,t!=null}function lc(){Ze(gn),Ze(Yt)}function Ym(t,e,n){if(Yt.current!==Pi)throw Error(ne(168));He(Yt,e),He(gn,n)}function Jv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ne(108,yx(t)||"Unknown",i));return ot({},n,r)}function uc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Pi,ss=Yt.current,He(Yt,t),He(gn,gn.current),!0}function Km(t,e,n){var r=t.stateNode;if(!r)throw Error(ne(169));n?(t=Jv(t,e,ss),r.__reactInternalMemoizedMergedChildContext=t,Ze(gn),Ze(Yt),He(Yt,t)):Ze(gn),He(gn,n)}var jr=null,Dc=!1,xh=!1;function e3(t){jr===null?jr=[t]:jr.push(t)}function L8(t){Dc=!0,e3(t)}function Ri(){if(!xh&&jr!==null){xh=!0;var t=0,e=Ue;try{var n=jr;for(Ue=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}jr=null,Dc=!1}catch(i){throw jr!==null&&(jr=jr.slice(t+1)),Cv(Sp,Ri),i}finally{Ue=e,xh=!1}}return null}var Zs=[],qs=0,cc=null,dc=0,jn=[],On=0,os=null,Or=1,Dr="";function Zi(t,e){Zs[qs++]=dc,Zs[qs++]=cc,cc=t,dc=e}function t3(t,e,n){jn[On++]=Or,jn[On++]=Dr,jn[On++]=os,os=t;var r=Or;t=Dr;var i=32-rr(r)-1;r&=~(1<<i),n+=1;var s=32-rr(e)+i;if(30<s){var l=i-i%5;s=(r&(1<<l)-1).toString(32),r>>=l,i-=l,Or=1<<32-rr(e)+i|n<<i|r,Dr=s+t}else Or=1<<s|n<<i|r,Dr=t}function Mp(t){t.return!==null&&(Zi(t,1),t3(t,1,0))}function Rp(t){for(;t===cc;)cc=Zs[--qs],Zs[qs]=null,dc=Zs[--qs],Zs[qs]=null;for(;t===os;)os=jn[--On],jn[On]=null,Dr=jn[--On],jn[On]=null,Or=jn[--On],jn[On]=null}var Sn=null,_n=null,et=!1,er=null;function n3(t,e){var n=zn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Qm(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Sn=t,_n=Si(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Sn=t,_n=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=os!==null?{id:Or,overflow:Dr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=zn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Sn=t,_n=null,!0):!1;default:return!1}}function P0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function N0(t){if(et){var e=_n;if(e){var n=e;if(!Qm(t,e)){if(P0(t))throw Error(ne(418));e=Si(n.nextSibling);var r=Sn;e&&Qm(t,e)?n3(r,n):(t.flags=t.flags&-4097|2,et=!1,Sn=t)}}else{if(P0(t))throw Error(ne(418));t.flags=t.flags&-4097|2,et=!1,Sn=t}}}function Zm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Sn=t}function _u(t){if(t!==Sn)return!1;if(!et)return Zm(t),et=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!T0(t.type,t.memoizedProps)),e&&(e=_n)){if(P0(t))throw r3(),Error(ne(418));for(;e;)n3(t,e),e=Si(e.nextSibling)}if(Zm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ne(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){_n=Si(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}_n=null}}else _n=Sn?Si(t.stateNode.nextSibling):null;return!0}function r3(){for(var t=_n;t;)t=Si(t.nextSibling)}function po(){_n=Sn=null,et=!1}function Ip(t){er===null?er=[t]:er.push(t)}var F8=Hr.ReactCurrentBatchConfig;function oa(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ne(309));var r=n.stateNode}if(!r)throw Error(ne(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(l){var c=i.refs;l===null?delete c[s]:c[s]=l},e._stringRef=s,e)}if(typeof t!="string")throw Error(ne(284));if(!n._owner)throw Error(ne(290,t))}return t}function Su(t,e){throw t=Object.prototype.toString.call(e),Error(ne(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function qm(t){var e=t._init;return e(t._payload)}function i3(t){function e(_,C){if(t){var g=_.deletions;g===null?(_.deletions=[C],_.flags|=16):g.push(C)}}function n(_,C){if(!t)return null;for(;C!==null;)e(_,C),C=C.sibling;return null}function r(_,C){for(_=new Map;C!==null;)C.key!==null?_.set(C.key,C):_.set(C.index,C),C=C.sibling;return _}function i(_,C){return _=bi(_,C),_.index=0,_.sibling=null,_}function s(_,C,g){return _.index=g,t?(g=_.alternate,g!==null?(g=g.index,g<C?(_.flags|=2,C):g):(_.flags|=2,C)):(_.flags|=1048576,C)}function l(_){return t&&_.alternate===null&&(_.flags|=2),_}function c(_,C,g,S){return C===null||C.tag!==6?(C=bh(g,_.mode,S),C.return=_,C):(C=i(C,g),C.return=_,C)}function u(_,C,g,S){var b=g.type;return b===$s?h(_,C,g.props.children,S,g.key):C!==null&&(C.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===fi&&qm(b)===C.type)?(S=i(C,g.props),S.ref=oa(_,C,g),S.return=_,S):(S=Hu(g.type,g.key,g.props,null,_.mode,S),S.ref=oa(_,C,g),S.return=_,S)}function f(_,C,g,S){return C===null||C.tag!==4||C.stateNode.containerInfo!==g.containerInfo||C.stateNode.implementation!==g.implementation?(C=Eh(g,_.mode,S),C.return=_,C):(C=i(C,g.children||[]),C.return=_,C)}function h(_,C,g,S,b){return C===null||C.tag!==7?(C=is(g,_.mode,S,b),C.return=_,C):(C=i(C,g),C.return=_,C)}function m(_,C,g){if(typeof C=="string"&&C!==""||typeof C=="number")return C=bh(""+C,_.mode,g),C.return=_,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case du:return g=Hu(C.type,C.key,C.props,null,_.mode,g),g.ref=oa(_,null,C),g.return=_,g;case Ws:return C=Eh(C,_.mode,g),C.return=_,C;case fi:var S=C._init;return m(_,S(C._payload),g)}if(va(C)||ta(C))return C=is(C,_.mode,g,null),C.return=_,C;Su(_,C)}return null}function x(_,C,g,S){var b=C!==null?C.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return b!==null?null:c(_,C,""+g,S);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case du:return g.key===b?u(_,C,g,S):null;case Ws:return g.key===b?f(_,C,g,S):null;case fi:return b=g._init,x(_,C,b(g._payload),S)}if(va(g)||ta(g))return b!==null?null:h(_,C,g,S,null);Su(_,g)}return null}function y(_,C,g,S,b){if(typeof S=="string"&&S!==""||typeof S=="number")return _=_.get(g)||null,c(C,_,""+S,b);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case du:return _=_.get(S.key===null?g:S.key)||null,u(C,_,S,b);case Ws:return _=_.get(S.key===null?g:S.key)||null,f(C,_,S,b);case fi:var N=S._init;return y(_,C,g,N(S._payload),b)}if(va(S)||ta(S))return _=_.get(g)||null,h(C,_,S,b,null);Su(C,S)}return null}function w(_,C,g,S){for(var b=null,N=null,I=C,A=C=0,F=null;I!==null&&A<g.length;A++){I.index>A?(F=I,I=null):F=I.sibling;var M=x(_,I,g[A],S);if(M===null){I===null&&(I=F);break}t&&I&&M.alternate===null&&e(_,I),C=s(M,C,A),N===null?b=M:N.sibling=M,N=M,I=F}if(A===g.length)return n(_,I),et&&Zi(_,A),b;if(I===null){for(;A<g.length;A++)I=m(_,g[A],S),I!==null&&(C=s(I,C,A),N===null?b=I:N.sibling=I,N=I);return et&&Zi(_,A),b}for(I=r(_,I);A<g.length;A++)F=y(I,_,A,g[A],S),F!==null&&(t&&F.alternate!==null&&I.delete(F.key===null?A:F.key),C=s(F,C,A),N===null?b=F:N.sibling=F,N=F);return t&&I.forEach(function(R){return e(_,R)}),et&&Zi(_,A),b}function T(_,C,g,S){var b=ta(g);if(typeof b!="function")throw Error(ne(150));if(g=b.call(g),g==null)throw Error(ne(151));for(var N=b=null,I=C,A=C=0,F=null,M=g.next();I!==null&&!M.done;A++,M=g.next()){I.index>A?(F=I,I=null):F=I.sibling;var R=x(_,I,M.value,S);if(R===null){I===null&&(I=F);break}t&&I&&R.alternate===null&&e(_,I),C=s(R,C,A),N===null?b=R:N.sibling=R,N=R,I=F}if(M.done)return n(_,I),et&&Zi(_,A),b;if(I===null){for(;!M.done;A++,M=g.next())M=m(_,M.value,S),M!==null&&(C=s(M,C,A),N===null?b=M:N.sibling=M,N=M);return et&&Zi(_,A),b}for(I=r(_,I);!M.done;A++,M=g.next())M=y(I,_,A,M.value,S),M!==null&&(t&&M.alternate!==null&&I.delete(M.key===null?A:M.key),C=s(M,C,A),N===null?b=M:N.sibling=M,N=M);return t&&I.forEach(function(z){return e(_,z)}),et&&Zi(_,A),b}function k(_,C,g,S){if(typeof g=="object"&&g!==null&&g.type===$s&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case du:e:{for(var b=g.key,N=C;N!==null;){if(N.key===b){if(b=g.type,b===$s){if(N.tag===7){n(_,N.sibling),C=i(N,g.props.children),C.return=_,_=C;break e}}else if(N.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===fi&&qm(b)===N.type){n(_,N.sibling),C=i(N,g.props),C.ref=oa(_,N,g),C.return=_,_=C;break e}n(_,N);break}else e(_,N);N=N.sibling}g.type===$s?(C=is(g.props.children,_.mode,S,g.key),C.return=_,_=C):(S=Hu(g.type,g.key,g.props,null,_.mode,S),S.ref=oa(_,C,g),S.return=_,_=S)}return l(_);case Ws:e:{for(N=g.key;C!==null;){if(C.key===N)if(C.tag===4&&C.stateNode.containerInfo===g.containerInfo&&C.stateNode.implementation===g.implementation){n(_,C.sibling),C=i(C,g.children||[]),C.return=_,_=C;break e}else{n(_,C);break}else e(_,C);C=C.sibling}C=Eh(g,_.mode,S),C.return=_,_=C}return l(_);case fi:return N=g._init,k(_,C,N(g._payload),S)}if(va(g))return w(_,C,g,S);if(ta(g))return T(_,C,g,S);Su(_,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,C!==null&&C.tag===6?(n(_,C.sibling),C=i(C,g),C.return=_,_=C):(n(_,C),C=bh(g,_.mode,S),C.return=_,_=C),l(_)):n(_,C)}return k}var go=i3(!0),s3=i3(!1),fc=Mi(null),hc=null,Js=null,Lp=null;function Fp(){Lp=Js=hc=null}function jp(t){var e=fc.current;Ze(fc),t._currentValue=e}function A0(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ao(t,e){hc=t,Lp=Js=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(hn=!0),t.firstContext=null)}function Un(t){var e=t._currentValue;if(Lp!==t)if(t={context:t,memoizedValue:e,next:null},Js===null){if(hc===null)throw Error(ne(308));Js=t,hc.dependencies={lanes:0,firstContext:t}}else Js=Js.next=t;return e}var ts=null;function Op(t){ts===null?ts=[t]:ts.push(t)}function o3(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Op(e)):(n.next=i.next,i.next=n),e.interleaved=n,Wr(t,r)}function Wr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var hi=!1;function Dp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function a3(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function zr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ki(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,je&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Wr(t,n)}return i=r.interleaved,i===null?(e.next=e,Op(r)):(e.next=i.next,i.next=e),r.interleaved=e,Wr(t,n)}function Bu(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,kp(t,n)}}function Jm(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=l:s=s.next=l,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function pc(t,e,n,r){var i=t.updateQueue;hi=!1;var s=i.firstBaseUpdate,l=i.lastBaseUpdate,c=i.shared.pending;if(c!==null){i.shared.pending=null;var u=c,f=u.next;u.next=null,l===null?s=f:l.next=f,l=u;var h=t.alternate;h!==null&&(h=h.updateQueue,c=h.lastBaseUpdate,c!==l&&(c===null?h.firstBaseUpdate=f:c.next=f,h.lastBaseUpdate=u))}if(s!==null){var m=i.baseState;l=0,h=f=u=null,c=s;do{var x=c.lane,y=c.eventTime;if((r&x)===x){h!==null&&(h=h.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var w=t,T=c;switch(x=e,y=n,T.tag){case 1:if(w=T.payload,typeof w=="function"){m=w.call(y,m,x);break e}m=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=T.payload,x=typeof w=="function"?w.call(y,m,x):w,x==null)break e;m=ot({},m,x);break e;case 2:hi=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,x=i.effects,x===null?i.effects=[c]:x.push(c))}else y={eventTime:y,lane:x,tag:c.tag,payload:c.payload,callback:c.callback,next:null},h===null?(f=h=y,u=m):h=h.next=y,l|=x;if(c=c.next,c===null){if(c=i.shared.pending,c===null)break;x=c,c=x.next,x.next=null,i.lastBaseUpdate=x,i.shared.pending=null}}while(1);if(h===null&&(u=m),i.baseState=u,i.firstBaseUpdate=f,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do l|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);ls|=l,t.lanes=l,t.memoizedState=m}}function ey(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(ne(191,i));i.call(r)}}}var ul={},Tr=Mi(ul),Xa=Mi(ul),Ya=Mi(ul);function ns(t){if(t===ul)throw Error(ne(174));return t}function zp(t,e){switch(He(Ya,e),He(Xa,t),He(Tr,ul),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:c0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=c0(e,t)}Ze(Tr),He(Tr,e)}function mo(){Ze(Tr),Ze(Xa),Ze(Ya)}function l3(t){ns(Ya.current);var e=ns(Tr.current),n=c0(e,t.type);e!==n&&(He(Xa,t),He(Tr,n))}function Bp(t){Xa.current===t&&(Ze(Tr),Ze(Xa))}var it=Mi(0);function gc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var wh=[];function Up(){for(var t=0;t<wh.length;t++)wh[t]._workInProgressVersionPrimary=null;wh.length=0}var Uu=Hr.ReactCurrentDispatcher,_h=Hr.ReactCurrentBatchConfig,as=0,st=null,wt=null,Nt=null,mc=!1,Pa=!1,Ka=0,j8=0;function Wt(){throw Error(ne(321))}function Gp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!or(t[n],e[n]))return!1;return!0}function Vp(t,e,n,r,i,s){if(as=s,st=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Uu.current=t===null||t.memoizedState===null?B8:U8,t=n(r,i),Pa){s=0;do{if(Pa=!1,Ka=0,25<=s)throw Error(ne(301));s+=1,Nt=wt=null,e.updateQueue=null,Uu.current=G8,t=n(r,i)}while(Pa)}if(Uu.current=yc,e=wt!==null&&wt.next!==null,as=0,Nt=wt=st=null,mc=!1,e)throw Error(ne(300));return t}function Wp(){var t=Ka!==0;return Ka=0,t}function vr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nt===null?st.memoizedState=Nt=t:Nt=Nt.next=t,Nt}function Gn(){if(wt===null){var t=st.alternate;t=t!==null?t.memoizedState:null}else t=wt.next;var e=Nt===null?st.memoizedState:Nt.next;if(e!==null)Nt=e,wt=t;else{if(t===null)throw Error(ne(310));wt=t,t={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Nt===null?st.memoizedState=Nt=t:Nt=Nt.next=t}return Nt}function Qa(t,e){return typeof e=="function"?e(t):e}function Sh(t){var e=Gn(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var r=wt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var l=i.next;i.next=s.next,s.next=l}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var c=l=null,u=null,f=s;do{var h=f.lane;if((as&h)===h)u!==null&&(u=u.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),r=f.hasEagerState?f.eagerState:t(r,f.action);else{var m={lane:h,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};u===null?(c=u=m,l=r):u=u.next=m,st.lanes|=h,ls|=h}f=f.next}while(f!==null&&f!==s);u===null?l=r:u.next=c,or(r,e.memoizedState)||(hn=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,st.lanes|=s,ls|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function kh(t){var e=Gn(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var l=i=i.next;do s=t(s,l.action),l=l.next;while(l!==i);or(s,e.memoizedState)||(hn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function u3(){}function c3(t,e){var n=st,r=Gn(),i=e(),s=!or(r.memoizedState,i);if(s&&(r.memoizedState=i,hn=!0),r=r.queue,$p(h3.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Nt!==null&&Nt.memoizedState.tag&1){if(n.flags|=2048,Za(9,f3.bind(null,n,r,i,e),void 0,null),At===null)throw Error(ne(349));as&30||d3(n,e,i)}return i}function d3(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=st.updateQueue,e===null?(e={lastEffect:null,stores:null},st.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function f3(t,e,n,r){e.value=n,e.getSnapshot=r,p3(e)&&g3(t)}function h3(t,e,n){return n(function(){p3(e)&&g3(t)})}function p3(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!or(t,n)}catch{return!0}}function g3(t){var e=Wr(t,1);e!==null&&ir(e,t,1,-1)}function ty(t){var e=vr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qa,lastRenderedState:t},e.queue=t,t=t.dispatch=z8.bind(null,st,t),[e.memoizedState,t]}function Za(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=st.updateQueue,e===null?(e={lastEffect:null,stores:null},st.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function m3(){return Gn().memoizedState}function Gu(t,e,n,r){var i=vr();st.flags|=t,i.memoizedState=Za(1|e,n,void 0,r===void 0?null:r)}function zc(t,e,n,r){var i=Gn();r=r===void 0?null:r;var s=void 0;if(wt!==null){var l=wt.memoizedState;if(s=l.destroy,r!==null&&Gp(r,l.deps)){i.memoizedState=Za(e,n,s,r);return}}st.flags|=t,i.memoizedState=Za(1|e,n,s,r)}function ny(t,e){return Gu(8390656,8,t,e)}function $p(t,e){return zc(2048,8,t,e)}function y3(t,e){return zc(4,2,t,e)}function v3(t,e){return zc(4,4,t,e)}function x3(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function w3(t,e,n){return n=n!=null?n.concat([t]):null,zc(4,4,x3.bind(null,e,t),n)}function Hp(){}function _3(t,e){var n=Gn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Gp(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function S3(t,e){var n=Gn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Gp(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function k3(t,e,n){return as&21?(or(n,e)||(n=Pv(),st.lanes|=n,ls|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,hn=!0),t.memoizedState=n)}function O8(t,e){var n=Ue;Ue=n!==0&&4>n?n:4,t(!0);var r=_h.transition;_h.transition={};try{t(!1),e()}finally{Ue=n,_h.transition=r}}function T3(){return Gn().memoizedState}function D8(t,e,n){var r=Ci(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},C3(t))b3(e,n);else if(n=o3(t,e,n,r),n!==null){var i=Jt();ir(n,t,r,i),E3(n,e,r)}}function z8(t,e,n){var r=Ci(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(C3(t))b3(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var l=e.lastRenderedState,c=s(l,n);if(i.hasEagerState=!0,i.eagerState=c,or(c,l)){var u=e.interleaved;u===null?(i.next=i,Op(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=o3(t,e,i,r),n!==null&&(i=Jt(),ir(n,t,r,i),E3(n,e,r))}}function C3(t){var e=t.alternate;return t===st||e!==null&&e===st}function b3(t,e){Pa=mc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function E3(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,kp(t,n)}}var yc={readContext:Un,useCallback:Wt,useContext:Wt,useEffect:Wt,useImperativeHandle:Wt,useInsertionEffect:Wt,useLayoutEffect:Wt,useMemo:Wt,useReducer:Wt,useRef:Wt,useState:Wt,useDebugValue:Wt,useDeferredValue:Wt,useTransition:Wt,useMutableSource:Wt,useSyncExternalStore:Wt,useId:Wt,unstable_isNewReconciler:!1},B8={readContext:Un,useCallback:function(t,e){return vr().memoizedState=[t,e===void 0?null:e],t},useContext:Un,useEffect:ny,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Gu(4194308,4,x3.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Gu(4194308,4,t,e)},useInsertionEffect:function(t,e){return Gu(4,2,t,e)},useMemo:function(t,e){var n=vr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=vr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=D8.bind(null,st,t),[r.memoizedState,t]},useRef:function(t){var e=vr();return t={current:t},e.memoizedState=t},useState:ty,useDebugValue:Hp,useDeferredValue:function(t){return vr().memoizedState=t},useTransition:function(){var t=ty(!1),e=t[0];return t=O8.bind(null,t[1]),vr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=st,i=vr();if(et){if(n===void 0)throw Error(ne(407));n=n()}else{if(n=e(),At===null)throw Error(ne(349));as&30||d3(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,ny(h3.bind(null,r,s,t),[t]),r.flags|=2048,Za(9,f3.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=vr(),e=At.identifierPrefix;if(et){var n=Dr,r=Or;n=(r&~(1<<32-rr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ka++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=j8++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},U8={readContext:Un,useCallback:_3,useContext:Un,useEffect:$p,useImperativeHandle:w3,useInsertionEffect:y3,useLayoutEffect:v3,useMemo:S3,useReducer:Sh,useRef:m3,useState:function(){return Sh(Qa)},useDebugValue:Hp,useDeferredValue:function(t){var e=Gn();return k3(e,wt.memoizedState,t)},useTransition:function(){var t=Sh(Qa)[0],e=Gn().memoizedState;return[t,e]},useMutableSource:u3,useSyncExternalStore:c3,useId:T3,unstable_isNewReconciler:!1},G8={readContext:Un,useCallback:_3,useContext:Un,useEffect:$p,useImperativeHandle:w3,useInsertionEffect:y3,useLayoutEffect:v3,useMemo:S3,useReducer:kh,useRef:m3,useState:function(){return kh(Qa)},useDebugValue:Hp,useDeferredValue:function(t){var e=Gn();return wt===null?e.memoizedState=t:k3(e,wt.memoizedState,t)},useTransition:function(){var t=kh(Qa)[0],e=Gn().memoizedState;return[t,e]},useMutableSource:u3,useSyncExternalStore:c3,useId:T3,unstable_isNewReconciler:!1};function qn(t,e){if(t&&t.defaultProps){e=ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function M0(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Bc={isMounted:function(t){return(t=t._reactInternals)?ds(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Jt(),i=Ci(t),s=zr(r,i);s.payload=e,n!=null&&(s.callback=n),e=ki(t,s,i),e!==null&&(ir(e,t,i,r),Bu(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Jt(),i=Ci(t),s=zr(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=ki(t,s,i),e!==null&&(ir(e,t,i,r),Bu(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Jt(),r=Ci(t),i=zr(n,r);i.tag=2,e!=null&&(i.callback=e),e=ki(t,i,r),e!==null&&(ir(e,t,r,n),Bu(e,t,r))}};function ry(t,e,n,r,i,s,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,l):e.prototype&&e.prototype.isPureReactComponent?!Va(n,r)||!Va(i,s):!0}function P3(t,e,n){var r=!1,i=Pi,s=e.contextType;return typeof s=="object"&&s!==null?s=Un(s):(i=mn(e)?ss:Yt.current,r=e.contextTypes,s=(r=r!=null)?ho(t,i):Pi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Bc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function iy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Bc.enqueueReplaceState(e,e.state,null)}function R0(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Dp(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Un(s):(s=mn(e)?ss:Yt.current,i.context=ho(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(M0(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Bc.enqueueReplaceState(i,i.state,null),pc(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function yo(t,e){try{var n="",r=e;do n+=mx(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Th(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function I0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var V8=typeof WeakMap=="function"?WeakMap:Map;function N3(t,e,n){n=zr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){xc||(xc=!0,V0=r),I0(t,e)},n}function A3(t,e,n){n=zr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){I0(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){I0(t,e),typeof r!="function"&&(Ti===null?Ti=new Set([this]):Ti.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function sy(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new V8;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=rw.bind(null,t,e,n),e.then(t,t))}function oy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function ay(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=zr(-1,1),e.tag=2,ki(n,e,1))),n.lanes|=1),t)}var W8=Hr.ReactCurrentOwner,hn=!1;function qt(t,e,n,r){e.child=t===null?s3(e,null,n,r):go(e,t.child,n,r)}function ly(t,e,n,r,i){n=n.render;var s=e.ref;return ao(e,i),r=Vp(t,e,n,r,s,i),n=Wp(),t!==null&&!hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,$r(t,e,i)):(et&&n&&Mp(e),e.flags|=1,qt(t,e,r,i),e.child)}function uy(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!eg(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,M3(t,e,s,r,i)):(t=Hu(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var l=s.memoizedProps;if(n=n.compare,n=n!==null?n:Va,n(l,r)&&t.ref===e.ref)return $r(t,e,i)}return e.flags|=1,t=bi(s,r),t.ref=e.ref,t.return=e,e.child=t}function M3(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Va(s,r)&&t.ref===e.ref)if(hn=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(hn=!0);else return e.lanes=t.lanes,$r(t,e,i)}return L0(t,e,n,r,i)}function R3(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},He(to,wn),wn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,He(to,wn),wn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,He(to,wn),wn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,He(to,wn),wn|=r;return qt(t,e,i,n),e.child}function I3(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function L0(t,e,n,r,i){var s=mn(n)?ss:Yt.current;return s=ho(e,s),ao(e,i),n=Vp(t,e,n,r,s,i),r=Wp(),t!==null&&!hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,$r(t,e,i)):(et&&r&&Mp(e),e.flags|=1,qt(t,e,n,i),e.child)}function cy(t,e,n,r,i){if(mn(n)){var s=!0;uc(e)}else s=!1;if(ao(e,i),e.stateNode===null)Vu(t,e),P3(e,n,r),R0(e,n,r,i),r=!0;else if(t===null){var l=e.stateNode,c=e.memoizedProps;l.props=c;var u=l.context,f=n.contextType;typeof f=="object"&&f!==null?f=Un(f):(f=mn(n)?ss:Yt.current,f=ho(e,f));var h=n.getDerivedStateFromProps,m=typeof h=="function"||typeof l.getSnapshotBeforeUpdate=="function";m||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||u!==f)&&iy(e,l,r,f),hi=!1;var x=e.memoizedState;l.state=x,pc(e,r,l,i),u=e.memoizedState,c!==r||x!==u||gn.current||hi?(typeof h=="function"&&(M0(e,n,h,r),u=e.memoizedState),(c=hi||ry(e,n,c,r,x,u,f))?(m||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),l.props=r,l.state=u,l.context=f,r=c):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{l=e.stateNode,a3(t,e),c=e.memoizedProps,f=e.type===e.elementType?c:qn(e.type,c),l.props=f,m=e.pendingProps,x=l.context,u=n.contextType,typeof u=="object"&&u!==null?u=Un(u):(u=mn(n)?ss:Yt.current,u=ho(e,u));var y=n.getDerivedStateFromProps;(h=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==m||x!==u)&&iy(e,l,r,u),hi=!1,x=e.memoizedState,l.state=x,pc(e,r,l,i);var w=e.memoizedState;c!==m||x!==w||gn.current||hi?(typeof y=="function"&&(M0(e,n,y,r),w=e.memoizedState),(f=hi||ry(e,n,f,r,x,w,u)||!1)?(h||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,w,u),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,w,u)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),l.props=r,l.state=w,l.context=u,r=f):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=1024),r=!1)}return F0(t,e,n,r,s,i)}function F0(t,e,n,r,i,s){I3(t,e);var l=(e.flags&128)!==0;if(!r&&!l)return i&&Km(e,n,!1),$r(t,e,s);r=e.stateNode,W8.current=e;var c=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&l?(e.child=go(e,t.child,null,s),e.child=go(e,null,c,s)):qt(t,e,c,s),e.memoizedState=r.state,i&&Km(e,n,!0),e.child}function L3(t){var e=t.stateNode;e.pendingContext?Ym(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ym(t,e.context,!1),zp(t,e.containerInfo)}function dy(t,e,n,r,i){return po(),Ip(i),e.flags|=256,qt(t,e,n,r),e.child}var j0={dehydrated:null,treeContext:null,retryLane:0};function O0(t){return{baseLanes:t,cachePool:null,transitions:null}}function F3(t,e,n){var r=e.pendingProps,i=it.current,s=!1,l=(e.flags&128)!==0,c;if((c=l)||(c=t!==null&&t.memoizedState===null?!1:(i&2)!==0),c?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),He(it,i&1),t===null)return N0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,t=r.fallback,s?(r=e.mode,s=e.child,l={mode:"hidden",children:l},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=l):s=Vc(l,r,0,null),t=is(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=O0(n),e.memoizedState=j0,t):Xp(e,l));if(i=t.memoizedState,i!==null&&(c=i.dehydrated,c!==null))return $8(t,e,l,r,c,i,n);if(s){s=r.fallback,l=e.mode,i=t.child,c=i.sibling;var u={mode:"hidden",children:r.children};return!(l&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=bi(i,u),r.subtreeFlags=i.subtreeFlags&14680064),c!==null?s=bi(c,s):(s=is(s,l,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,l=t.child.memoizedState,l=l===null?O0(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=t.childLanes&~n,e.memoizedState=j0,r}return s=t.child,t=s.sibling,r=bi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Xp(t,e){return e=Vc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ku(t,e,n,r){return r!==null&&Ip(r),go(e,t.child,null,n),t=Xp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function $8(t,e,n,r,i,s,l){if(n)return e.flags&256?(e.flags&=-257,r=Th(Error(ne(422))),ku(t,e,l,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Vc({mode:"visible",children:r.children},i,0,null),s=is(s,i,l,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&go(e,t.child,null,l),e.child.memoizedState=O0(l),e.memoizedState=j0,s);if(!(e.mode&1))return ku(t,e,l,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var c=r.dgst;return r=c,s=Error(ne(419)),r=Th(s,r,void 0),ku(t,e,l,r)}if(c=(l&t.childLanes)!==0,hn||c){if(r=At,r!==null){switch(l&-l){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|l)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Wr(t,i),ir(r,t,i,-1))}return Jp(),r=Th(Error(ne(421))),ku(t,e,l,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=iw.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,_n=Si(i.nextSibling),Sn=e,et=!0,er=null,t!==null&&(jn[On++]=Or,jn[On++]=Dr,jn[On++]=os,Or=t.id,Dr=t.overflow,os=e),e=Xp(e,r.children),e.flags|=4096,e)}function fy(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),A0(t.return,e,n)}function Ch(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function j3(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(qt(t,e,r.children,n),r=it.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&fy(t,n,e);else if(t.tag===19)fy(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(He(it,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&gc(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Ch(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&gc(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Ch(e,!0,n,null,s);break;case"together":Ch(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vu(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function $r(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ls|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ne(153));if(e.child!==null){for(t=e.child,n=bi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=bi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function H8(t,e,n){switch(e.tag){case 3:L3(e),po();break;case 5:l3(e);break;case 1:mn(e.type)&&uc(e);break;case 4:zp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;He(fc,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(He(it,it.current&1),e.flags|=128,null):n&e.child.childLanes?F3(t,e,n):(He(it,it.current&1),t=$r(t,e,n),t!==null?t.sibling:null);He(it,it.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return j3(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),He(it,it.current),r)break;return null;case 22:case 23:return e.lanes=0,R3(t,e,n)}return $r(t,e,n)}var O3,D0,D3,z3;O3=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};D0=function(){};D3=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ns(Tr.current);var s=null;switch(n){case"input":i=o0(t,i),r=o0(t,r),s=[];break;case"select":i=ot({},i,{value:void 0}),r=ot({},r,{value:void 0}),s=[];break;case"textarea":i=u0(t,i),r=u0(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ac)}d0(n,r);var l;n=null;for(f in i)if(!r.hasOwnProperty(f)&&i.hasOwnProperty(f)&&i[f]!=null)if(f==="style"){var c=i[f];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(ja.hasOwnProperty(f)?s||(s=[]):(s=s||[]).push(f,null));for(f in r){var u=r[f];if(c=i!=null?i[f]:void 0,r.hasOwnProperty(f)&&u!==c&&(u!=null||c!=null))if(f==="style")if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(n||(n={}),n[l]=u[l])}else n||(s||(s=[]),s.push(f,n)),n=u;else f==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(s=s||[]).push(f,u)):f==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(f,""+u):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(ja.hasOwnProperty(f)?(u!=null&&f==="onScroll"&&Qe("scroll",t),s||c===u||(s=[])):(s=s||[]).push(f,u))}n&&(s=s||[]).push("style",n);var f=s;(e.updateQueue=f)&&(e.flags|=4)}};z3=function(t,e,n,r){n!==r&&(e.flags|=4)};function aa(t,e){if(!et)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function $t(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function X8(t,e,n){var r=e.pendingProps;switch(Rp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(e),null;case 1:return mn(e.type)&&lc(),$t(e),null;case 3:return r=e.stateNode,mo(),Ze(gn),Ze(Yt),Up(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(_u(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,er!==null&&(H0(er),er=null))),D0(t,e),$t(e),null;case 5:Bp(e);var i=ns(Ya.current);if(n=e.type,t!==null&&e.stateNode!=null)D3(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ne(166));return $t(e),null}if(t=ns(Tr.current),_u(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[wr]=e,r[Ha]=s,t=(e.mode&1)!==0,n){case"dialog":Qe("cancel",r),Qe("close",r);break;case"iframe":case"object":case"embed":Qe("load",r);break;case"video":case"audio":for(i=0;i<wa.length;i++)Qe(wa[i],r);break;case"source":Qe("error",r);break;case"img":case"image":case"link":Qe("error",r),Qe("load",r);break;case"details":Qe("toggle",r);break;case"input":_m(r,s),Qe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Qe("invalid",r);break;case"textarea":km(r,s),Qe("invalid",r)}d0(n,s),i=null;for(var l in s)if(s.hasOwnProperty(l)){var c=s[l];l==="children"?typeof c=="string"?r.textContent!==c&&(s.suppressHydrationWarning!==!0&&wu(r.textContent,c,t),i=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(s.suppressHydrationWarning!==!0&&wu(r.textContent,c,t),i=["children",""+c]):ja.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&Qe("scroll",r)}switch(n){case"input":fu(r),Sm(r,s,!0);break;case"textarea":fu(r),Tm(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ac)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{l=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=hv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),n==="select"&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[wr]=e,t[Ha]=r,O3(t,e,!1,!1),e.stateNode=t;e:{switch(l=f0(n,r),n){case"dialog":Qe("cancel",t),Qe("close",t),i=r;break;case"iframe":case"object":case"embed":Qe("load",t),i=r;break;case"video":case"audio":for(i=0;i<wa.length;i++)Qe(wa[i],t);i=r;break;case"source":Qe("error",t),i=r;break;case"img":case"image":case"link":Qe("error",t),Qe("load",t),i=r;break;case"details":Qe("toggle",t),i=r;break;case"input":_m(t,r),i=o0(t,r),Qe("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ot({},r,{value:void 0}),Qe("invalid",t);break;case"textarea":km(t,r),i=u0(t,r),Qe("invalid",t);break;default:i=r}d0(n,i),c=i;for(s in c)if(c.hasOwnProperty(s)){var u=c[s];s==="style"?mv(t,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&pv(t,u)):s==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Oa(t,u):typeof u=="number"&&Oa(t,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ja.hasOwnProperty(s)?u!=null&&s==="onScroll"&&Qe("scroll",t):u!=null&&yp(t,s,u,l))}switch(n){case"input":fu(t),Sm(t,r,!1);break;case"textarea":fu(t),Tm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ei(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?ro(t,!!r.multiple,s,!1):r.defaultValue!=null&&ro(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=ac)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return $t(e),null;case 6:if(t&&e.stateNode!=null)z3(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ne(166));if(n=ns(Ya.current),ns(Tr.current),_u(e)){if(r=e.stateNode,n=e.memoizedProps,r[wr]=e,(s=r.nodeValue!==n)&&(t=Sn,t!==null))switch(t.tag){case 3:wu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&wu(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[wr]=e,e.stateNode=r}return $t(e),null;case 13:if(Ze(it),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(et&&_n!==null&&e.mode&1&&!(e.flags&128))r3(),po(),e.flags|=98560,s=!1;else if(s=_u(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(ne(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ne(317));s[wr]=e}else po(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;$t(e),s=!1}else er!==null&&(H0(er),er=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||it.current&1?_t===0&&(_t=3):Jp())),e.updateQueue!==null&&(e.flags|=4),$t(e),null);case 4:return mo(),D0(t,e),t===null&&Wa(e.stateNode.containerInfo),$t(e),null;case 10:return jp(e.type._context),$t(e),null;case 17:return mn(e.type)&&lc(),$t(e),null;case 19:if(Ze(it),s=e.memoizedState,s===null)return $t(e),null;if(r=(e.flags&128)!==0,l=s.rendering,l===null)if(r)aa(s,!1);else{if(_t!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=gc(t),l!==null){for(e.flags|=128,aa(s,!1),r=l.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,l=s.alternate,l===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,t=l.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return He(it,it.current&1|2),e.child}t=t.sibling}s.tail!==null&&ht()>vo&&(e.flags|=128,r=!0,aa(s,!1),e.lanes=4194304)}else{if(!r)if(t=gc(l),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),aa(s,!0),s.tail===null&&s.tailMode==="hidden"&&!l.alternate&&!et)return $t(e),null}else 2*ht()-s.renderingStartTime>vo&&n!==1073741824&&(e.flags|=128,r=!0,aa(s,!1),e.lanes=4194304);s.isBackwards?(l.sibling=e.child,e.child=l):(n=s.last,n!==null?n.sibling=l:e.child=l,s.last=l)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ht(),e.sibling=null,n=it.current,He(it,r?n&1|2:n&1),e):($t(e),null);case 22:case 23:return qp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?wn&1073741824&&($t(e),e.subtreeFlags&6&&(e.flags|=8192)):$t(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function Y8(t,e){switch(Rp(e),e.tag){case 1:return mn(e.type)&&lc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mo(),Ze(gn),Ze(Yt),Up(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Bp(e),null;case 13:if(Ze(it),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));po()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ze(it),null;case 4:return mo(),null;case 10:return jp(e.type._context),null;case 22:case 23:return qp(),null;case 24:return null;default:return null}}var Tu=!1,Xt=!1,K8=typeof WeakSet=="function"?WeakSet:Set,he=null;function eo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){lt(t,e,r)}else n.current=null}function z0(t,e,n){try{n()}catch(r){lt(t,e,r)}}var hy=!1;function Q8(t,e){if(S0=ic,t=Wv(),Ap(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var l=0,c=-1,u=-1,f=0,h=0,m=t,x=null;t:for(;;){for(var y;m!==n||i!==0&&m.nodeType!==3||(c=l+i),m!==s||r!==0&&m.nodeType!==3||(u=l+r),m.nodeType===3&&(l+=m.nodeValue.length),(y=m.firstChild)!==null;)x=m,m=y;for(;;){if(m===t)break t;if(x===n&&++f===i&&(c=l),x===s&&++h===r&&(u=l),(y=m.nextSibling)!==null)break;m=x,x=m.parentNode}m=y}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(k0={focusedElem:t,selectionRange:n},ic=!1,he=e;he!==null;)if(e=he,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,he=t;else for(;he!==null;){e=he;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var T=w.memoizedProps,k=w.memoizedState,_=e.stateNode,C=_.getSnapshotBeforeUpdate(e.elementType===e.type?T:qn(e.type,T),k);_.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(S){lt(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,he=t;break}he=e.return}return w=hy,hy=!1,w}function Na(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&z0(e,n,s)}i=i.next}while(i!==r)}}function Uc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function B0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function B3(t){var e=t.alternate;e!==null&&(t.alternate=null,B3(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[wr],delete e[Ha],delete e[b0],delete e[R8],delete e[I8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function U3(t){return t.tag===5||t.tag===3||t.tag===4}function py(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||U3(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function U0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ac));else if(r!==4&&(t=t.child,t!==null))for(U0(t,e,n),t=t.sibling;t!==null;)U0(t,e,n),t=t.sibling}function G0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(G0(t,e,n),t=t.sibling;t!==null;)G0(t,e,n),t=t.sibling}var Ft=null,Jn=!1;function ui(t,e,n){for(n=n.child;n!==null;)G3(t,e,n),n=n.sibling}function G3(t,e,n){if(kr&&typeof kr.onCommitFiberUnmount=="function")try{kr.onCommitFiberUnmount(Ic,n)}catch{}switch(n.tag){case 5:Xt||eo(n,e);case 6:var r=Ft,i=Jn;Ft=null,ui(t,e,n),Ft=r,Jn=i,Ft!==null&&(Jn?(t=Ft,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ft.removeChild(n.stateNode));break;case 18:Ft!==null&&(Jn?(t=Ft,n=n.stateNode,t.nodeType===8?vh(t.parentNode,n):t.nodeType===1&&vh(t,n),Ua(t)):vh(Ft,n.stateNode));break;case 4:r=Ft,i=Jn,Ft=n.stateNode.containerInfo,Jn=!0,ui(t,e,n),Ft=r,Jn=i;break;case 0:case 11:case 14:case 15:if(!Xt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,l=s.destroy;s=s.tag,l!==void 0&&(s&2||s&4)&&z0(n,e,l),i=i.next}while(i!==r)}ui(t,e,n);break;case 1:if(!Xt&&(eo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){lt(n,e,c)}ui(t,e,n);break;case 21:ui(t,e,n);break;case 22:n.mode&1?(Xt=(r=Xt)||n.memoizedState!==null,ui(t,e,n),Xt=r):ui(t,e,n);break;default:ui(t,e,n)}}function gy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new K8),e.forEach(function(r){var i=sw.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Qn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,l=e,c=l;e:for(;c!==null;){switch(c.tag){case 5:Ft=c.stateNode,Jn=!1;break e;case 3:Ft=c.stateNode.containerInfo,Jn=!0;break e;case 4:Ft=c.stateNode.containerInfo,Jn=!0;break e}c=c.return}if(Ft===null)throw Error(ne(160));G3(s,l,i),Ft=null,Jn=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(f){lt(i,e,f)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)V3(e,t),e=e.sibling}function V3(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Qn(e,t),yr(t),r&4){try{Na(3,t,t.return),Uc(3,t)}catch(T){lt(t,t.return,T)}try{Na(5,t,t.return)}catch(T){lt(t,t.return,T)}}break;case 1:Qn(e,t),yr(t),r&512&&n!==null&&eo(n,n.return);break;case 5:if(Qn(e,t),yr(t),r&512&&n!==null&&eo(n,n.return),t.flags&32){var i=t.stateNode;try{Oa(i,"")}catch(T){lt(t,t.return,T)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,l=n!==null?n.memoizedProps:s,c=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{c==="input"&&s.type==="radio"&&s.name!=null&&dv(i,s),f0(c,l);var f=f0(c,s);for(l=0;l<u.length;l+=2){var h=u[l],m=u[l+1];h==="style"?mv(i,m):h==="dangerouslySetInnerHTML"?pv(i,m):h==="children"?Oa(i,m):yp(i,h,m,f)}switch(c){case"input":a0(i,s);break;case"textarea":fv(i,s);break;case"select":var x=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var y=s.value;y!=null?ro(i,!!s.multiple,y,!1):x!==!!s.multiple&&(s.defaultValue!=null?ro(i,!!s.multiple,s.defaultValue,!0):ro(i,!!s.multiple,s.multiple?[]:"",!1))}i[Ha]=s}catch(T){lt(t,t.return,T)}}break;case 6:if(Qn(e,t),yr(t),r&4){if(t.stateNode===null)throw Error(ne(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(T){lt(t,t.return,T)}}break;case 3:if(Qn(e,t),yr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ua(e.containerInfo)}catch(T){lt(t,t.return,T)}break;case 4:Qn(e,t),yr(t);break;case 13:Qn(e,t),yr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Qp=ht())),r&4&&gy(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Xt=(f=Xt)||h,Qn(e,t),Xt=f):Qn(e,t),yr(t),r&8192){if(f=t.memoizedState!==null,(t.stateNode.isHidden=f)&&!h&&t.mode&1)for(he=t,h=t.child;h!==null;){for(m=he=h;he!==null;){switch(x=he,y=x.child,x.tag){case 0:case 11:case 14:case 15:Na(4,x,x.return);break;case 1:eo(x,x.return);var w=x.stateNode;if(typeof w.componentWillUnmount=="function"){r=x,n=x.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(T){lt(r,n,T)}}break;case 5:eo(x,x.return);break;case 22:if(x.memoizedState!==null){yy(m);continue}}y!==null?(y.return=x,he=y):yy(m)}h=h.sibling}e:for(h=null,m=t;;){if(m.tag===5){if(h===null){h=m;try{i=m.stateNode,f?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(c=m.stateNode,u=m.memoizedProps.style,l=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=gv("display",l))}catch(T){lt(t,t.return,T)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=f?"":m.memoizedProps}catch(T){lt(t,t.return,T)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Qn(e,t),yr(t),r&4&&gy(t);break;case 21:break;default:Qn(e,t),yr(t)}}function yr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(U3(n)){var r=n;break e}n=n.return}throw Error(ne(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Oa(i,""),r.flags&=-33);var s=py(t);G0(t,s,i);break;case 3:case 4:var l=r.stateNode.containerInfo,c=py(t);U0(t,c,l);break;default:throw Error(ne(161))}}catch(u){lt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Z8(t,e,n){he=t,W3(t)}function W3(t,e,n){for(var r=(t.mode&1)!==0;he!==null;){var i=he,s=i.child;if(i.tag===22&&r){var l=i.memoizedState!==null||Tu;if(!l){var c=i.alternate,u=c!==null&&c.memoizedState!==null||Xt;c=Tu;var f=Xt;if(Tu=l,(Xt=u)&&!f)for(he=i;he!==null;)l=he,u=l.child,l.tag===22&&l.memoizedState!==null?vy(i):u!==null?(u.return=l,he=u):vy(i);for(;s!==null;)he=s,W3(s),s=s.sibling;he=i,Tu=c,Xt=f}my(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,he=s):my(t)}}function my(t){for(;he!==null;){var e=he;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xt||Uc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Xt)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:qn(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&ey(e,s,r);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ey(e,l,n)}break;case 5:var c=e.stateNode;if(n===null&&e.flags&4){n=c;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var f=e.alternate;if(f!==null){var h=f.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Ua(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}Xt||e.flags&512&&B0(e)}catch(x){lt(e,e.return,x)}}if(e===t){he=null;break}if(n=e.sibling,n!==null){n.return=e.return,he=n;break}he=e.return}}function yy(t){for(;he!==null;){var e=he;if(e===t){he=null;break}var n=e.sibling;if(n!==null){n.return=e.return,he=n;break}he=e.return}}function vy(t){for(;he!==null;){var e=he;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Uc(4,e)}catch(u){lt(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){lt(e,i,u)}}var s=e.return;try{B0(e)}catch(u){lt(e,s,u)}break;case 5:var l=e.return;try{B0(e)}catch(u){lt(e,l,u)}}}catch(u){lt(e,e.return,u)}if(e===t){he=null;break}var c=e.sibling;if(c!==null){c.return=e.return,he=c;break}he=e.return}}var q8=Math.ceil,vc=Hr.ReactCurrentDispatcher,Yp=Hr.ReactCurrentOwner,Bn=Hr.ReactCurrentBatchConfig,je=0,At=null,mt=null,Ot=0,wn=0,to=Mi(0),_t=0,qa=null,ls=0,Gc=0,Kp=0,Aa=null,fn=null,Qp=0,vo=1/0,Fr=null,xc=!1,V0=null,Ti=null,Cu=!1,vi=null,wc=0,Ma=0,W0=null,Wu=-1,$u=0;function Jt(){return je&6?ht():Wu!==-1?Wu:Wu=ht()}function Ci(t){return t.mode&1?je&2&&Ot!==0?Ot&-Ot:F8.transition!==null?($u===0&&($u=Pv()),$u):(t=Ue,t!==0||(t=window.event,t=t===void 0?16:Fv(t.type)),t):1}function ir(t,e,n,r){if(50<Ma)throw Ma=0,W0=null,Error(ne(185));ol(t,n,r),(!(je&2)||t!==At)&&(t===At&&(!(je&2)&&(Gc|=n),_t===4&&mi(t,Ot)),yn(t,r),n===1&&je===0&&!(e.mode&1)&&(vo=ht()+500,Dc&&Ri()))}function yn(t,e){var n=t.callbackNode;Fx(t,e);var r=rc(t,t===At?Ot:0);if(r===0)n!==null&&Em(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Em(n),e===1)t.tag===0?L8(xy.bind(null,t)):e3(xy.bind(null,t)),A8(function(){!(je&6)&&Ri()}),n=null;else{switch(Nv(r)){case 1:n=Sp;break;case 4:n=bv;break;case 16:n=nc;break;case 536870912:n=Ev;break;default:n=nc}n=q3(n,$3.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function $3(t,e){if(Wu=-1,$u=0,je&6)throw Error(ne(327));var n=t.callbackNode;if(lo()&&t.callbackNode!==n)return null;var r=rc(t,t===At?Ot:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=_c(t,r);else{e=r;var i=je;je|=2;var s=X3();(At!==t||Ot!==e)&&(Fr=null,vo=ht()+500,rs(t,e));do try{tw();break}catch(c){H3(t,c)}while(1);Fp(),vc.current=s,je=i,mt!==null?e=0:(At=null,Ot=0,e=_t)}if(e!==0){if(e===2&&(i=y0(t),i!==0&&(r=i,e=$0(t,i))),e===1)throw n=qa,rs(t,0),mi(t,r),yn(t,ht()),n;if(e===6)mi(t,r);else{if(i=t.current.alternate,!(r&30)&&!J8(i)&&(e=_c(t,r),e===2&&(s=y0(t),s!==0&&(r=s,e=$0(t,s))),e===1))throw n=qa,rs(t,0),mi(t,r),yn(t,ht()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(ne(345));case 2:qi(t,fn,Fr);break;case 3:if(mi(t,r),(r&130023424)===r&&(e=Qp+500-ht(),10<e)){if(rc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Jt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=C0(qi.bind(null,t,fn,Fr),e);break}qi(t,fn,Fr);break;case 4:if(mi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var l=31-rr(r);s=1<<l,l=e[l],l>i&&(i=l),r&=~s}if(r=i,r=ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*q8(r/1960))-r,10<r){t.timeoutHandle=C0(qi.bind(null,t,fn,Fr),r);break}qi(t,fn,Fr);break;case 5:qi(t,fn,Fr);break;default:throw Error(ne(329))}}}return yn(t,ht()),t.callbackNode===n?$3.bind(null,t):null}function $0(t,e){var n=Aa;return t.current.memoizedState.isDehydrated&&(rs(t,e).flags|=256),t=_c(t,e),t!==2&&(e=fn,fn=n,e!==null&&H0(e)),t}function H0(t){fn===null?fn=t:fn.push.apply(fn,t)}function J8(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!or(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function mi(t,e){for(e&=~Kp,e&=~Gc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-rr(e),r=1<<n;t[n]=-1,e&=~r}}function xy(t){if(je&6)throw Error(ne(327));lo();var e=rc(t,0);if(!(e&1))return yn(t,ht()),null;var n=_c(t,e);if(t.tag!==0&&n===2){var r=y0(t);r!==0&&(e=r,n=$0(t,r))}if(n===1)throw n=qa,rs(t,0),mi(t,e),yn(t,ht()),n;if(n===6)throw Error(ne(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,qi(t,fn,Fr),yn(t,ht()),null}function Zp(t,e){var n=je;je|=1;try{return t(e)}finally{je=n,je===0&&(vo=ht()+500,Dc&&Ri())}}function us(t){vi!==null&&vi.tag===0&&!(je&6)&&lo();var e=je;je|=1;var n=Bn.transition,r=Ue;try{if(Bn.transition=null,Ue=1,t)return t()}finally{Ue=r,Bn.transition=n,je=e,!(je&6)&&Ri()}}function qp(){wn=to.current,Ze(to)}function rs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,N8(n)),mt!==null)for(n=mt.return;n!==null;){var r=n;switch(Rp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&lc();break;case 3:mo(),Ze(gn),Ze(Yt),Up();break;case 5:Bp(r);break;case 4:mo();break;case 13:Ze(it);break;case 19:Ze(it);break;case 10:jp(r.type._context);break;case 22:case 23:qp()}n=n.return}if(At=t,mt=t=bi(t.current,null),Ot=wn=e,_t=0,qa=null,Kp=Gc=ls=0,fn=Aa=null,ts!==null){for(e=0;e<ts.length;e++)if(n=ts[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var l=s.next;s.next=i,r.next=l}n.pending=r}ts=null}return t}function H3(t,e){do{var n=mt;try{if(Fp(),Uu.current=yc,mc){for(var r=st.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}mc=!1}if(as=0,Nt=wt=st=null,Pa=!1,Ka=0,Yp.current=null,n===null||n.return===null){_t=1,qa=e,mt=null;break}e:{var s=t,l=n.return,c=n,u=e;if(e=Ot,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var f=u,h=c,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var x=h.alternate;x?(h.updateQueue=x.updateQueue,h.memoizedState=x.memoizedState,h.lanes=x.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=oy(l);if(y!==null){y.flags&=-257,ay(y,l,c,s,e),y.mode&1&&sy(s,f,e),e=y,u=f;var w=e.updateQueue;if(w===null){var T=new Set;T.add(u),e.updateQueue=T}else w.add(u);break e}else{if(!(e&1)){sy(s,f,e),Jp();break e}u=Error(ne(426))}}else if(et&&c.mode&1){var k=oy(l);if(k!==null){!(k.flags&65536)&&(k.flags|=256),ay(k,l,c,s,e),Ip(yo(u,c));break e}}s=u=yo(u,c),_t!==4&&(_t=2),Aa===null?Aa=[s]:Aa.push(s),s=l;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var _=N3(s,u,e);Jm(s,_);break e;case 1:c=u;var C=s.type,g=s.stateNode;if(!(s.flags&128)&&(typeof C.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Ti===null||!Ti.has(g)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=A3(s,c,e);Jm(s,S);break e}}s=s.return}while(s!==null)}K3(n)}catch(b){e=b,mt===n&&n!==null&&(mt=n=n.return);continue}break}while(1)}function X3(){var t=vc.current;return vc.current=yc,t===null?yc:t}function Jp(){(_t===0||_t===3||_t===2)&&(_t=4),At===null||!(ls&268435455)&&!(Gc&268435455)||mi(At,Ot)}function _c(t,e){var n=je;je|=2;var r=X3();(At!==t||Ot!==e)&&(Fr=null,rs(t,e));do try{ew();break}catch(i){H3(t,i)}while(1);if(Fp(),je=n,vc.current=r,mt!==null)throw Error(ne(261));return At=null,Ot=0,_t}function ew(){for(;mt!==null;)Y3(mt)}function tw(){for(;mt!==null&&!bx();)Y3(mt)}function Y3(t){var e=Z3(t.alternate,t,wn);t.memoizedProps=t.pendingProps,e===null?K3(t):mt=e,Yp.current=null}function K3(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Y8(n,e),n!==null){n.flags&=32767,mt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_t=6,mt=null;return}}else if(n=X8(n,e,wn),n!==null){mt=n;return}if(e=e.sibling,e!==null){mt=e;return}mt=e=t}while(e!==null);_t===0&&(_t=5)}function qi(t,e,n){var r=Ue,i=Bn.transition;try{Bn.transition=null,Ue=1,nw(t,e,n,r)}finally{Bn.transition=i,Ue=r}return null}function nw(t,e,n,r){do lo();while(vi!==null);if(je&6)throw Error(ne(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ne(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(jx(t,s),t===At&&(mt=At=null,Ot=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Cu||(Cu=!0,q3(nc,function(){return lo(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Bn.transition,Bn.transition=null;var l=Ue;Ue=1;var c=je;je|=4,Yp.current=null,Q8(t,n),V3(n,t),S8(k0),ic=!!S0,k0=S0=null,t.current=n,Z8(n),Ex(),je=c,Ue=l,Bn.transition=s}else t.current=n;if(Cu&&(Cu=!1,vi=t,wc=i),s=t.pendingLanes,s===0&&(Ti=null),Ax(n.stateNode),yn(t,ht()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(xc)throw xc=!1,t=V0,V0=null,t;return wc&1&&t.tag!==0&&lo(),s=t.pendingLanes,s&1?t===W0?Ma++:(Ma=0,W0=t):Ma=0,Ri(),null}function lo(){if(vi!==null){var t=Nv(wc),e=Bn.transition,n=Ue;try{if(Bn.transition=null,Ue=16>t?16:t,vi===null)var r=!1;else{if(t=vi,vi=null,wc=0,je&6)throw Error(ne(331));var i=je;for(je|=4,he=t.current;he!==null;){var s=he,l=s.child;if(he.flags&16){var c=s.deletions;if(c!==null){for(var u=0;u<c.length;u++){var f=c[u];for(he=f;he!==null;){var h=he;switch(h.tag){case 0:case 11:case 15:Na(8,h,s)}var m=h.child;if(m!==null)m.return=h,he=m;else for(;he!==null;){h=he;var x=h.sibling,y=h.return;if(B3(h),h===f){he=null;break}if(x!==null){x.return=y,he=x;break}he=y}}}var w=s.alternate;if(w!==null){var T=w.child;if(T!==null){w.child=null;do{var k=T.sibling;T.sibling=null,T=k}while(T!==null)}}he=s}}if(s.subtreeFlags&2064&&l!==null)l.return=s,he=l;else e:for(;he!==null;){if(s=he,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Na(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,he=_;break e}he=s.return}}var C=t.current;for(he=C;he!==null;){l=he;var g=l.child;if(l.subtreeFlags&2064&&g!==null)g.return=l,he=g;else e:for(l=C;he!==null;){if(c=he,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Uc(9,c)}}catch(b){lt(c,c.return,b)}if(c===l){he=null;break e}var S=c.sibling;if(S!==null){S.return=c.return,he=S;break e}he=c.return}}if(je=i,Ri(),kr&&typeof kr.onPostCommitFiberRoot=="function")try{kr.onPostCommitFiberRoot(Ic,t)}catch{}r=!0}return r}finally{Ue=n,Bn.transition=e}}return!1}function wy(t,e,n){e=yo(n,e),e=N3(t,e,1),t=ki(t,e,1),e=Jt(),t!==null&&(ol(t,1,e),yn(t,e))}function lt(t,e,n){if(t.tag===3)wy(t,t,n);else for(;e!==null;){if(e.tag===3){wy(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ti===null||!Ti.has(r))){t=yo(n,t),t=A3(e,t,1),e=ki(e,t,1),t=Jt(),e!==null&&(ol(e,1,t),yn(e,t));break}}e=e.return}}function rw(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Jt(),t.pingedLanes|=t.suspendedLanes&n,At===t&&(Ot&n)===n&&(_t===4||_t===3&&(Ot&130023424)===Ot&&500>ht()-Qp?rs(t,0):Kp|=n),yn(t,e)}function Q3(t,e){e===0&&(t.mode&1?(e=gu,gu<<=1,!(gu&130023424)&&(gu=4194304)):e=1);var n=Jt();t=Wr(t,e),t!==null&&(ol(t,e,n),yn(t,n))}function iw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Q3(t,n)}function sw(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ne(314))}r!==null&&r.delete(e),Q3(t,n)}var Z3;Z3=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||gn.current)hn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return hn=!1,H8(t,e,n);hn=!!(t.flags&131072)}else hn=!1,et&&e.flags&1048576&&t3(e,dc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Vu(t,e),t=e.pendingProps;var i=ho(e,Yt.current);ao(e,n),i=Vp(null,e,r,t,i,n);var s=Wp();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,mn(r)?(s=!0,uc(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Dp(e),i.updater=Bc,e.stateNode=i,i._reactInternals=e,R0(e,r,t,n),e=F0(null,e,r,!0,s,n)):(e.tag=0,et&&s&&Mp(e),qt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Vu(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=aw(r),t=qn(r,t),i){case 0:e=L0(null,e,r,t,n);break e;case 1:e=cy(null,e,r,t,n);break e;case 11:e=ly(null,e,r,t,n);break e;case 14:e=uy(null,e,r,qn(r.type,t),n);break e}throw Error(ne(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),L0(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),cy(t,e,r,i,n);case 3:e:{if(L3(e),t===null)throw Error(ne(387));r=e.pendingProps,s=e.memoizedState,i=s.element,a3(t,e),pc(e,r,null,n);var l=e.memoizedState;if(r=l.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=yo(Error(ne(423)),e),e=dy(t,e,r,n,i);break e}else if(r!==i){i=yo(Error(ne(424)),e),e=dy(t,e,r,n,i);break e}else for(_n=Si(e.stateNode.containerInfo.firstChild),Sn=e,et=!0,er=null,n=s3(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(po(),r===i){e=$r(t,e,n);break e}qt(t,e,r,n)}e=e.child}return e;case 5:return l3(e),t===null&&N0(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,l=i.children,T0(r,i)?l=null:s!==null&&T0(r,s)&&(e.flags|=32),I3(t,e),qt(t,e,l,n),e.child;case 6:return t===null&&N0(e),null;case 13:return F3(t,e,n);case 4:return zp(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=go(e,null,r,n):qt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),ly(t,e,r,i,n);case 7:return qt(t,e,e.pendingProps,n),e.child;case 8:return qt(t,e,e.pendingProps.children,n),e.child;case 12:return qt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,l=i.value,He(fc,r._currentValue),r._currentValue=l,s!==null)if(or(s.value,l)){if(s.children===i.children&&!gn.current){e=$r(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var c=s.dependencies;if(c!==null){l=s.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(s.tag===1){u=zr(-1,n&-n),u.tag=2;var f=s.updateQueue;if(f!==null){f=f.shared;var h=f.pending;h===null?u.next=u:(u.next=h.next,h.next=u),f.pending=u}}s.lanes|=n,u=s.alternate,u!==null&&(u.lanes|=n),A0(s.return,n,e),c.lanes|=n;break}u=u.next}}else if(s.tag===10)l=s.type===e.type?null:s.child;else if(s.tag===18){if(l=s.return,l===null)throw Error(ne(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),A0(l,n,e),l=s.sibling}else l=s.child;if(l!==null)l.return=s;else for(l=s;l!==null;){if(l===e){l=null;break}if(s=l.sibling,s!==null){s.return=l.return,l=s;break}l=l.return}s=l}qt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ao(e,n),i=Un(i),r=r(i),e.flags|=1,qt(t,e,r,n),e.child;case 14:return r=e.type,i=qn(r,e.pendingProps),i=qn(r.type,i),uy(t,e,r,i,n);case 15:return M3(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:qn(r,i),Vu(t,e),e.tag=1,mn(r)?(t=!0,uc(e)):t=!1,ao(e,n),P3(e,r,i),R0(e,r,i,n),F0(null,e,r,!0,t,n);case 19:return j3(t,e,n);case 22:return R3(t,e,n)}throw Error(ne(156,e.tag))};function q3(t,e){return Cv(t,e)}function ow(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(t,e,n,r){return new ow(t,e,n,r)}function eg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function aw(t){if(typeof t=="function")return eg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===xp)return 11;if(t===wp)return 14}return 2}function bi(t,e){var n=t.alternate;return n===null?(n=zn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Hu(t,e,n,r,i,s){var l=2;if(r=t,typeof t=="function")eg(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case $s:return is(n.children,i,s,e);case vp:l=8,i|=8;break;case n0:return t=zn(12,n,e,i|2),t.elementType=n0,t.lanes=s,t;case r0:return t=zn(13,n,e,i),t.elementType=r0,t.lanes=s,t;case i0:return t=zn(19,n,e,i),t.elementType=i0,t.lanes=s,t;case lv:return Vc(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ov:l=10;break e;case av:l=9;break e;case xp:l=11;break e;case wp:l=14;break e;case fi:l=16,r=null;break e}throw Error(ne(130,t==null?t:typeof t,""))}return e=zn(l,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function is(t,e,n,r){return t=zn(7,t,r,e),t.lanes=n,t}function Vc(t,e,n,r){return t=zn(22,t,r,e),t.elementType=lv,t.lanes=n,t.stateNode={isHidden:!1},t}function bh(t,e,n){return t=zn(6,t,null,e),t.lanes=n,t}function Eh(t,e,n){return e=zn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function lw(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ah(0),this.expirationTimes=ah(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ah(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function tg(t,e,n,r,i,s,l,c,u){return t=new lw(t,e,n,c,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=zn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Dp(s),t}function uw(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ws,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function J3(t){if(!t)return Pi;t=t._reactInternals;e:{if(ds(t)!==t||t.tag!==1)throw Error(ne(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(mn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(t.tag===1){var n=t.type;if(mn(n))return Jv(t,n,e)}return e}function e5(t,e,n,r,i,s,l,c,u){return t=tg(n,r,!0,t,i,s,l,c,u),t.context=J3(null),n=t.current,r=Jt(),i=Ci(n),s=zr(r,i),s.callback=e??null,ki(n,s,i),t.current.lanes=i,ol(t,i,r),yn(t,r),t}function Wc(t,e,n,r){var i=e.current,s=Jt(),l=Ci(i);return n=J3(n),e.context===null?e.context=n:e.pendingContext=n,e=zr(s,l),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ki(i,e,l),t!==null&&(ir(t,i,l,s),Bu(t,i,l)),l}function Sc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function _y(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ng(t,e){_y(t,e),(t=t.alternate)&&_y(t,e)}function cw(){return null}var t5=typeof reportError=="function"?reportError:function(t){console.error(t)};function rg(t){this._internalRoot=t}$c.prototype.render=rg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ne(409));Wc(t,e,null,null)};$c.prototype.unmount=rg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;us(function(){Wc(null,t,null,null)}),e[Vr]=null}};function $c(t){this._internalRoot=t}$c.prototype.unstable_scheduleHydration=function(t){if(t){var e=Rv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<gi.length&&e!==0&&e<gi[n].priority;n++);gi.splice(n,0,t),n===0&&Lv(t)}};function ig(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Hc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Sy(){}function dw(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var f=Sc(l);s.call(f)}}var l=e5(e,r,t,0,null,!1,!1,"",Sy);return t._reactRootContainer=l,t[Vr]=l.current,Wa(t.nodeType===8?t.parentNode:t),us(),l}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var c=r;r=function(){var f=Sc(u);c.call(f)}}var u=tg(t,0,!1,null,null,!1,!1,"",Sy);return t._reactRootContainer=u,t[Vr]=u.current,Wa(t.nodeType===8?t.parentNode:t),us(function(){Wc(e,u,n,r)}),u}function Xc(t,e,n,r,i){var s=n._reactRootContainer;if(s){var l=s;if(typeof i=="function"){var c=i;i=function(){var u=Sc(l);c.call(u)}}Wc(e,l,t,i)}else l=dw(n,e,t,i,r);return Sc(l)}Av=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=xa(e.pendingLanes);n!==0&&(kp(e,n|1),yn(e,ht()),!(je&6)&&(vo=ht()+500,Ri()))}break;case 13:us(function(){var r=Wr(t,1);if(r!==null){var i=Jt();ir(r,t,1,i)}}),ng(t,1)}};Tp=function(t){if(t.tag===13){var e=Wr(t,134217728);if(e!==null){var n=Jt();ir(e,t,134217728,n)}ng(t,134217728)}};Mv=function(t){if(t.tag===13){var e=Ci(t),n=Wr(t,e);if(n!==null){var r=Jt();ir(n,t,e,r)}ng(t,e)}};Rv=function(){return Ue};Iv=function(t,e){var n=Ue;try{return Ue=t,e()}finally{Ue=n}};p0=function(t,e,n){switch(e){case"input":if(a0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Oc(r);if(!i)throw Error(ne(90));cv(r),a0(r,i)}}}break;case"textarea":fv(t,n);break;case"select":e=n.value,e!=null&&ro(t,!!n.multiple,e,!1)}};xv=Zp;wv=us;var fw={usingClientEntryPoint:!1,Events:[ll,Ks,Oc,yv,vv,Zp]},la={findFiberByHostInstance:es,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hw={bundleType:la.bundleType,version:la.version,rendererPackageName:la.rendererPackageName,rendererConfig:la.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=kv(t),t===null?null:t.stateNode},findFiberByHostInstance:la.findFiberByHostInstance||cw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bu.isDisabled&&bu.supportsFiber)try{Ic=bu.inject(hw),kr=bu}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fw;Tn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ig(e))throw Error(ne(200));return uw(t,e,null,n)};Tn.createRoot=function(t,e){if(!ig(t))throw Error(ne(299));var n=!1,r="",i=t5;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=tg(t,1,!1,null,null,n,!1,r,i),t[Vr]=e.current,Wa(t.nodeType===8?t.parentNode:t),new rg(e)};Tn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ne(188)):(t=Object.keys(t).join(","),Error(ne(268,t)));return t=kv(e),t=t===null?null:t.stateNode,t};Tn.flushSync=function(t){return us(t)};Tn.hydrate=function(t,e,n){if(!Hc(e))throw Error(ne(200));return Xc(null,t,e,!0,n)};Tn.hydrateRoot=function(t,e,n){if(!ig(t))throw Error(ne(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",l=t5;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=e5(e,null,t,1,n??null,i,!1,s,l),t[Vr]=e.current,Wa(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new $c(e)};Tn.render=function(t,e,n){if(!Hc(e))throw Error(ne(200));return Xc(null,t,e,!1,n)};Tn.unmountComponentAtNode=function(t){if(!Hc(t))throw Error(ne(40));return t._reactRootContainer?(us(function(){Xc(null,null,t,!1,function(){t._reactRootContainer=null,t[Vr]=null})}),!0):!1};Tn.unstable_batchedUpdates=Zp;Tn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Hc(n))throw Error(ne(200));if(t==null||t._reactInternals===void 0)throw Error(ne(38));return Xc(t,e,n,!1,r)};Tn.version="18.3.1-next-f1338f8080-20240426";function n5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n5)}catch(t){console.error(t)}}n5(),nv.exports=Tn;var pw=nv.exports,ky=pw;e0.createRoot=ky.createRoot,e0.hydrateRoot=ky.hydrateRoot;const Ty=({isLoading:t,onSave:e,onSaveAs:n,canSaveAs:r,onLoad:i,onClear:s,buttonStyle:l})=>P.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.jsx("button",{style:{...l(!1),opacity:t?.5:1},onClick:e,disabled:t,title:"Save as PNML",children:"Save"}),P.jsx("button",{style:{...l(!1),opacity:t||!r?.5:1},onClick:n,disabled:t||!r,title:"Save As (choose location and filename)",children:"Save as"}),P.jsx("button",{style:{...l(!1),opacity:t?.5:1},onClick:i,disabled:t,title:"Load PNML file",children:"Load"}),P.jsx("button",{style:{...l(!1)},onClick:s,title:"Clear canvas",children:"Clear"})]}),gw=({mode:t,setMode:e,buttonStyle:n})=>P.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.jsx("button",{style:{...n(t==="select")},"data-testid":"toolbar-select",onClick:()=>{t!=="select"&&e("select")},children:"Select"}),P.jsx("button",{style:n(t==="place"),"data-testid":"toolbar-place",onClick:()=>{t!=="place"&&e("place")},children:"Place"}),P.jsx("button",{style:n(t==="transition"),"data-testid":"toolbar-transition",onClick:()=>{t!=="transition"&&e("transition")},children:"Transition"}),P.jsx("button",{style:n(t==="arc"),"data-testid":"toolbar-arc",onClick:()=>{t!=="arc"&&e("arc")},children:"Arc"})]}),Cy=({canUndo:t,canRedo:e,onUndo:n,onRedo:r,buttonStyle:i})=>P.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.jsx("button",{style:{...i(!1),opacity:t?1:.5},onClick:n,disabled:!t,title:"Undo (Ctrl+Z)",children:"Undo"}),P.jsx("button",{style:{...i(!1),opacity:e?1:.5},onClick:r,disabled:!e,title:"Redo (Ctrl+Y)",children:"Redo"})]}),by=({onOpenSettings:t,buttonStyle:e})=>P.jsx("div",{className:"flex flex-wrap gap-2",children:P.jsx("button",{style:e(!1),onClick:t,title:"Simulation Settings","data-testid":"toolbar-settings",children:"Settings"})});function Ph(t){const e={types:[]};try{const r=new DOMParser().parseFromString(t,"application/xml"),i=r.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Invalid XML");const l=Array.from(r.getElementsByTagName("*")).filter(f=>f.localName==="algebraicDataTypes")[0];if(!l)return e;const u=Array.from(l.childNodes).filter(f=>f.nodeType===1).filter(f=>f.localName==="type");for(const f of u){const h=f.getAttribute("name")||"",x=Array.from(f.childNodes).filter(k=>k.nodeType===1&&k.localName==="operation").map(k=>{const C=Array.from(k.childNodes).filter(g=>g.nodeType===1&&g.localName==="param").map(g=>({index:Number(g.getAttribute("index")||"0"),type:g.getAttribute("type")||""}));return{name:k.getAttribute("name")||"",arity:Number(k.getAttribute("arity")||"0"),result:k.getAttribute("result")||"",params:C}}),y=Array.from(f.childNodes).find(k=>k.nodeType===1&&k.localName==="axioms"),T=(y?Array.from(y.childNodes).filter(k=>k.nodeType===1&&k.localName==="axiom"):[]).map(k=>({name:k.getAttribute("name")||"",equation:(k.textContent||"").trim()}));e.types.push({name:h,operations:x,axioms:T})}return e}catch(n){return console.error("Error parsing ADT XML:",n),e}}function mw(t){const e=[],n=new Set;for(const r of t.types||[]){r.name||e.push("Type missing name"),n.has(r.name)&&e.push(`Duplicate type: ${r.name}`),n.add(r.name);for(const i of r.operations||[])i.name||e.push(`Operation missing name in type ${r.name}`),(!Number.isInteger(i.arity)||i.arity<0)&&e.push(`Invalid arity for ${r.name}.${i.name}`),i.result||e.push(`Operation ${r.name}.${i.name} missing result type`);for(const i of r.axioms||[])(!i.equation||!i.equation.includes("="))&&e.push(`Axiom in ${r.name} must be an equation with '='`)}return{valid:e.length===0,errors:e}}const yw=`<?xml version="1.0"?>
<algebraicDataTypes xmlns="http://example.org/apn-adt">
  <type name="Int">
    <operation name="+" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="-" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="*" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&lt;" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&lt;=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&gt;" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&gt;=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <axioms>
      <axiom name="commutativity">x + y = y + x</axiom>
      <axiom name="associativity">(x + y) + z = x + (y + z)</axiom>
      <axiom name="multiplication_commutativity">x * y = y * x</axiom>
      <axiom name="multiplication_associativity">(x * y) * z = x * (y * z)</axiom>
      <axiom name="distributivity">x * (y + z) = (x * y) + (x * z)</axiom>
    </axioms>
  </type>
  <type name="Bool">
    <operation name="and" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="or" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="not" arity="1" result="Bool">
      <param index="0" type="Bool"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <axioms>
      <axiom name="and_commutativity">x and y = y and x</axiom>
      <axiom name="and_associativity">(x and y) and z = x and (y and z)</axiom>
      <axiom name="or_commutativity">x or y = y or x</axiom>
      <axiom name="or_associativity">(x or y) or z = x or (y or z)</axiom>
      <axiom name="de_morgan_and">not (x and y) = (not x) or (not y)</axiom>
      <axiom name="de_morgan_or">not (x or y) = (not x) and (not y)</axiom>
      <axiom name="double_negation">not (not x) = x</axiom>
    </axioms>
  </type>
  <type name="Pair">
    <operation name="fst" arity="1" result="Any">
      <param index="0" type="Pair"/>
    </operation>
    <operation name="snd" arity="1" result="Any">
      <param index="0" type="Pair"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Pair"/>
      <param index="1" type="Pair"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Pair"/>
      <param index="1" type="Pair"/>
    </operation>
    <axioms>
      <axiom name="pair_equality">(x, y) == (a, b) = (x == a) and (y == b)</axiom>
      <axiom name="fst_projection">fst((x, y)) = x</axiom>
      <axiom name="snd_projection">snd((x, y)) = y</axiom>
    </axioms>
  </type>
  <type name="String">
    <operation name="concat" arity="2" result="String">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="substring" arity="3" result="String">
      <param index="0" type="String"/>
      <param index="1" type="Int"/>
      <param index="2" type="Int"/>
    </operation>
    <operation name="isSubstringOf" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="length" arity="1" result="Int">
      <param index="0" type="String"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <axioms>
      <axiom name="concat_associativity">concat(concat(x, y), z) = concat(x, concat(y, z))</axiom>
      <axiom name="concat_empty_left">concat('', x) = x</axiom>
      <axiom name="concat_empty_right">concat(x, '') = x</axiom>
      <axiom name="substring_bounds">substring(x, 0, length(x)) = x</axiom>
      <axiom name="length_concat">length(concat(x, y)) = length(x) + length(y)</axiom>
    </axioms>
  </type>
  <type name="List">
    <operation name="length" arity="1" result="Int">
      <param index="0" type="List"/>
    </operation>
    <operation name="concat" arity="2" result="List">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="head" arity="1" result="Any">
      <param index="0" type="List"/>
    </operation>
    <operation name="tail" arity="1" result="List">
      <param index="0" type="List"/>
    </operation>
    <operation name="append" arity="2" result="List">
      <param index="0" type="List"/>
      <param index="1" type="Any"/>
    </operation>
    <operation name="sublist" arity="3" result="List">
      <param index="0" type="List"/>
      <param index="1" type="Int"/>
      <param index="2" type="Int"/>
    </operation>
    <operation name="isSublistOf" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <axioms>
      <axiom name="length_empty">length([]) = 0</axiom>
      <axiom name="concat_empty_left">concat([], x) = x</axiom>
      <axiom name="concat_empty_right">concat(x, []) = x</axiom>
      <axiom name="head_cons">head([h | t]) = h</axiom>
      <axiom name="tail_cons">tail([h | t]) = t</axiom>
      <axiom name="length_concat">length(concat(x, y)) = length(x) + length(y)</axiom>
    </axioms>
  </type>
</algebraicDataTypes>`,r5=B.createContext(null);function vw({children:t}){const e=B.useMemo(()=>Ph(yw),[]),[n,r]=B.useState([]),i=B.useMemo(()=>{const h=new Map;for(const m of e.types||[])h.set(m.name,{...m,__readonly:!0});for(const m of n){const x=Ph(m);for(const y of x.types||[])h.has(y.name)||h.set(y.name,{...y,__readonly:!1})}return h},[e,n]),s=B.useCallback(()=>Array.from(i.keys()),[i]),l=B.useCallback(h=>i.get(h)||null,[i]),c=B.useCallback(h=>{const m=Ph(h),x=mw(m);if(!x.valid)return{ok:!1,errors:x.errors};for(const y of m.types||[])if(i.has(y.name))return{ok:!1,errors:[`Duplicate type: ${y.name}`]};return r(y=>[...y,h]),{ok:!0}},[i]),u=B.useCallback(()=>n.join(`
`),[n]),f=B.useMemo(()=>({listTypes:s,getType:l,registerCustomADTXml:c,exportCustomADTXml:u,baseReadOnly:!0,addOrReplaceCustomADT:h=>c(h),clearCustomADTs:()=>r([])}),[s,l,c,u]);return P.jsx(r5.Provider,{value:f,children:t})}function xw(){const t=B.useContext(r5);if(!t)throw new Error("useAdtRegistry must be used within AdtProvider");return t}function jt(t){if(typeof t!="string")throw new Error("Expression must be a string");const e=t.trim();let n=0;function r(k){return k>="0"&&k<="9"}function i(){for(;n<e.length&&/\s/.test(e[n]);)n++}function s(){i();let k=n;for(;n<e.length&&r(e[n]);)n++;if(k===n)throw new Error(`Expected int at position ${n}`);const _=e.slice(k,n);return{type:"int",value:parseInt(_,10)}}function l(k){return/[A-Za-z_]/.test(k)}function c(k){return/[A-Za-z0-9_]/.test(k)}function u(){if(i(),e[n]!=="'")throw new Error(`Expected string literal at position ${n}`);n++;let k="";for(;n<e.length&&e[n]!=="'";){if(e[n]==="\\"&&n+1<e.length){n++;const _=e[n];_==="n"?k+=`
`:_==="t"?k+="	":_==="r"?k+="\r":_==="\\"?k+="\\":_==="'"?k+="'":k+=_}else k+=e[n];n++}if(n>=e.length)throw new Error("Unterminated string literal");return n++,{type:"string",value:k}}function f(){i();let k=n;if(!l(e[n]))throw new Error(`Expected identifier at position ${n}`);for(n++;n<e.length&&c(e[n]);)n++;const _=e.slice(k,n);if(_&&/^[A-Z]/.test(_))throw new Error(`Variable names must start with lowercase letter, got '${_}' (use 't' instead of 'T', 'f' instead of 'F')`);if(i(),e[n]==="("){n++;const g=[];if(i(),e[n]!==")")do if(i(),g.push(y()),i(),e[n]===",")n++;else break;while(n<e.length);if(i(),e[n]!==")")throw new Error(`Expected ')' after function arguments at position ${n}`);return n++,{type:"funcall",name:_,args:g}}const C=n;if(i(),e[n]===":"){n++,i();const g=n;for(;n<e.length&&/[A-Za-z]/.test(e[n]);)n++;const S=e.slice(g,n).toLowerCase();return S==="int"||S==="bool"||S==="pair"||S==="string"||S==="list"?{type:"var",name:_,varType:S}:(n=C,{type:"var",name:_})}return{type:"var",name:_}}function h(){if(i(),e[n]!=="[")throw new Error(`Expected '[' at position ${n}`);n++;const k=[];if(i(),e[n]==="]")return n++,{type:"list",elements:[]};for(;n<e.length;){if(i(),k.push(y()),i(),e[n]==="]")return n++,{type:"list",elements:k};if(e[n]===","){n++;continue}throw new Error(`Expected ',' or ']' at position ${n}`)}throw new Error("Unterminated list literal")}function m(){if(i(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);if(e[n]==="("){n++,i();const k=y();if(i(),e[n]===","){n++;const _=y();if(i(),n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,{type:"pair",fst:k,snd:_}}if(n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,k}if(e[n]==="[")return h();if(e[n]==="'")return u();if(r(e[n]))return s();if(/[A-Za-z_]/.test(e[n]))return f();throw new Error(`Unexpected character '${e[n]}' at position ${n}`)}function x(){let k=m();for(i();n<e.length&&(e[n]==="*"||e[n]==="/");){const _=e[n++],C=m();k={type:"binop",op:_,left:k,right:C},i()}return k}function y(){let k=x();for(i();n<e.length&&(e[n]==="+"||e[n]==="-");){const _=e[n++],C=x();k={type:"binop",op:_,left:k,right:C},i()}return k}let w=y();if(i(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);function T(k){return!k||typeof k!="object"||(k.type==="bin"&&(k.type="binop"),k.left&&(k.left=T(k.left)),k.right&&(k.right=T(k.right)),Array.isArray(k.args)&&(k.args=k.args.map(T)),Array.isArray(k.elements)&&(k.elements=k.elements.map(T))),k}return w=T(w),w}function i5(t){if(typeof t!="string")throw new Error("Pattern must be a string");const e=t.trim();let n=0;function r(){for(;n<e.length&&/\s/.test(e[n]);)n++}function i(){if(r(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);if(e.slice(n,n+1)==="T")return n++,{type:"boolLit",value:!0};if(e.slice(n,n+1)==="F")return n++,{type:"boolLit",value:!1};if(e.slice(n,n+4)==="true")return n+=4,{type:"boolLit",value:!0};if(e.slice(n,n+5)==="false")return n+=5,{type:"boolLit",value:!1};if(/[0-9]/.test(e[n])){let l=n;for(;n<e.length&&/[0-9]/.test(e[n]);)n++;return{type:"int",value:parseInt(e.slice(l,n),10)}}if(e[n]==="["){n++,r();const l=[];for(;n<e.length&&e[n]!=="]";)l.push(i()),r(),e[n]===","&&(n++,r());if(n>=e.length||e[n]!=="]")throw new Error(`Expected ']' at position ${n}`);return n++,{type:"listPattern",elements:l}}if(/[a-zA-Z_]/.test(e[n])){let l=n;for(;n<e.length&&/[a-zA-Z0-9_]/.test(e[n]);)n++;const c=e.slice(l,n);if(r(),e[n]===":"){n++,r();let u=n;for(;n<e.length&&/[a-zA-Z]/.test(e[n]);)n++;const f=e.slice(u,n).toLowerCase();if(f==="int"||f==="bool"||f==="pair"||f==="string"||f==="list")return{type:"var",name:c,varType:f};throw new Error(`Unknown type '${f}' at position ${u}`)}return{type:"var",name:c}}if(e[n]==="("){n++,r();const l=[];for(;n<e.length&&e[n]!==")";)l.push(i()),r(),n<e.length&&e[n]===","&&(n++,r());if(n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,l.length===2?{type:"pairPattern",fst:l[0],snd:l[1]}:{type:"tuplePattern",elements:l}}throw new Error(`Unexpected character '${e[n]}' at position ${n}`)}const s=i();if(r(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);return s}function Ey(t,e){const n=new Map;function r(s,l){switch(s.type){case"int":return!(typeof l!="number"||l!==s.value);case"boolLit":return!(typeof l!="boolean"||l!==s.value);case"var":if(s.varType){const c=s.varType;if(c==="int"&&typeof l!="number"||c==="bool"&&typeof l!="boolean"||c==="string"&&typeof l!="string"||c==="list"&&!Array.isArray(l)||c==="pair"&&(!l||typeof l!="object"||!l.__pair__))return!1}if(n.has(s.name)){if(n.get(s.name)!==l)return!1}else n.set(s.name,l);return!0;case"pairPattern":return!(!l||typeof l!="object"||!l.__pair__||!r(s.fst,l.fst)||!r(s.snd,l.snd));case"tuplePattern":if(!Array.isArray(l)||l.length!==s.elements.length)return!1;for(let c=0;c<s.elements.length;c++)if(!r(s.elements[c],l[c]))return!1;return!0;case"listPattern":if(!Array.isArray(l)||l.length!==s.elements.length)return!1;for(let c=0;c<s.elements.length;c++)if(!r(s.elements[c],l[c]))return!1;return!0;default:return!1}}return r(t,e)?Object.fromEntries(n):null}function Py(t,e=20){if(!t)return[];if(Array.isArray(t.valueTokens))return t.valueTokens.slice(0,e);const n=Number(t.tokens||0);return Number.isFinite(n)&&n>0?Array.from({length:Math.min(n,e)},()=>1):[]}function s5(t){return t.replace(/:int\b/g,":Int").replace(/:bool\b/g,":Bool").replace(/:pair\b/g,":Pair").replace(/:string\b/g,":String").replace(/:list\b/g,":List")}function Ja(t){return typeof t=="number"?"Int":typeof t=="boolean"?"Bool":typeof t=="string"?"String":Array.isArray(t)?"List":t&&typeof t=="object"&&t.__pair__?"Pair":"Int"}function Xu(t,e,n=null,r={}){if(!t||(!e||e.size===0)&&!n)return t;let i=t;const{overwrite:s=!1}=r||{},l=t.match(/\b[a-z][a-zA-Z0-9_]*\b/g);return l&&l.forEach(c=>{if(c!=="true"&&c!=="false"&&c!=="and"&&c!=="or"&&c!=="not"){const u=e.get(c)||n;if(!u)return;if(s){const f=new RegExp(`\\b${c}(?::[A-Za-z]+)?\\b`,"g");i=i.replace(f,`${c}:${u}`)}else if(!t.includes(`${c}:`)){const f=new RegExp(`\\b${c}(?!:)\\b`,"g");i=i.replace(f,`${c}:${u}`)}}}),i}const ww="modulepreload",_w=function(t,e){return new URL(t,e).href},Ny={},Br=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=_w(s,r),s in Ny)return;Ny[s]=!0;const l=s.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!r)for(let h=i.length-1;h>=0;h--){const m=i[h];if(m.href===s&&(!l||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${c}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":ww,l||(f.as="script",f.crossOrigin=""),f.href=s,document.head.appendChild(f),l)return new Promise((h,m)=>{f.addEventListener("load",h),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s})},X0={silent:0,error:1,warn:2,info:3,debug:4},Sw=(()=>{var r,i,s;const t=typeof globalThis<"u"?globalThis.__PETRI_NET_LOG_LEVEL__:void 0,e=typeof process<"u"?((r=process.env)==null?void 0:r.VITE_LOG_LEVEL)||((i=process.env)==null?void 0:i.LOG_LEVEL):void 0,n=typeof process<"u"&&((s=process.env)==null?void 0:s.NODE_ENV)==="production"?"warn":"debug";return(t||e||n||"warn").toLowerCase()})();function o5(t){if(!t)return"warn";const e=String(t).toLowerCase();return X0[e]!==void 0?e:"warn"}let kw=o5(Sw);function Eu(t){const e=o5(t);return X0[e]<=X0[kw]}const pe={debug:(...t)=>{Eu("debug")&&console.debug(...t)},info:(...t)=>{Eu("info")&&console.info(...t)},warn:(...t)=>{Eu("warn")&&console.warn(...t)},error:(...t)=>{Eu("error")&&console.error(...t)}};let Nh=null;async function Tw(){if(typeof process<"u"&&process.env&&{}.JEST_WORKER_ID){pe.debug("Jest worker detected, skipping Z3 asset fetch");return}if(typeof document>"u"){if(typeof globalThis.initZ3=="function")return;const e=globalThis.Module;try{const r=(()=>{try{const{origin:y,pathname:w}=self.location||{};if(!y)return"";if(typeof w=="string"){const T=w.indexOf("/assets/");if(T!==-1)return`${y}${w.slice(0,T+1)}`;const k=w.lastIndexOf("/"),_=k>=0?w.slice(0,k+1):"/";return`${y}${_}`}return`${y}/`}catch{return""}})(),i=y=>{const w=y.startsWith("/")?y.slice(1):y;return r?`${r}${w}`:`/${w}`},s=i("z3-built.wasm.base64");pe.debug("[Z3 worker] fetching WASM base64 from",s);const l=await fetch(s);if(!l.ok)throw new Error(`Failed to fetch WASM base64 from ${s}: ${l.status}`);const u=`data:application/wasm;base64,${await l.text()}`,f={...typeof e=="object"?e:{},locateFile:y=>{if(y.endsWith(".wasm"))return pe.debug("[Z3 worker] locateFile",y,"->",`${u.substring(0,50)}...`),u;const w=i(y);return pe.debug("[Z3 worker] locateFile",y,"->",w),w}};globalThis.Module=f;const h=i("z3-built.js"),m=await fetch(h);if(!m.ok)throw new Error(`Failed to fetch z3-built.js from ${h}: ${m.status}`);const x=await m.text();if((0,eval)(x),await new Promise(y=>setTimeout(y,20)),typeof globalThis.initZ3!="function")throw new Error("initZ3 not defined after eval");return}catch(n){throw new Error(`Failed to load Z3 in worker: ${n.message}`)}finally{typeof e=="object"?globalThis.Module=e:delete globalThis.Module}}typeof globalThis.initZ3!="function"&&(pe.debug("initZ3 not found, loading Z3 built assets..."),await new Promise((e,n)=>{const r=document.createElement("script");r.src="/z3-built.js",r.async=!0,r.addEventListener("load",()=>{typeof globalThis.initZ3=="function"?(pe.debug("Z3 built assets loaded successfully"),e()):n(new Error("initZ3 function not found after loading z3-built.js"))}),r.addEventListener("error",i=>{n(new Error(`Failed to load z3-built.js: ${(i==null?void 0:i.message)||i}`))}),document.head.appendChild(r)}))}async function Cw(){return Nh||(Nh=(async()=>{try{pe.debug("Initializing Z3 context..."),await Tw();const{init:t}=await Br(()=>import("./browser-13b7e4b1.js").then(r=>r.b),[],import.meta.url);if(!t)throw new Error("Z3 init function not found. Z3-solver package may not be properly installed.");pe.debug("Calling Z3 init...");const e=await t();if(!e)throw new Error("Z3 initialization failed. Check browser console for WASM loading errors.");pe.debug("Creating Z3 context...");const n=new e.Context("main");if(!n)throw new Error("Failed to create Z3 context.");return pe.debug("Z3 context initialized successfully"),{z3:e,ctx:n}}catch(t){pe.error("Z3 initialization error:",t);const e=typeof process<"u"&&process.env&&{}.JEST_WORKER_ID;if(typeof document<"u"&&!e){pe.debug("Retrying Z3 initialization with asset loading...");try{typeof globalThis.initZ3!="function"&&(pe.debug("initZ3 not found, loading Z3 built assets..."),await new Promise((s,l)=>{const c=document.createElement("script");c.src="/z3-built.js",c.async=!0,c.addEventListener("load",()=>{typeof globalThis.initZ3=="function"?(pe.debug("Z3 built assets loaded successfully"),s()):l(new Error("initZ3 function not found after loading z3-built.js"))}),c.addEventListener("error",u=>{l(new Error(`Failed to load z3-built.js: ${(u==null?void 0:u.message)||u}`))}),document.head.appendChild(c)}));const{init:n}=await Br(()=>import("./browser-13b7e4b1.js").then(s=>s.b),[],import.meta.url),r=await n(),i=new r.Context("main");return pe.debug("Z3 context initialized successfully (fallback)"),{z3:r,ctx:i}}catch(n){pe.error("Fallback Z3 initialization also failed:",n)}}if(e||typeof document>"u"){pe.debug("Retrying Z3 initialization for Node.js...");try{const{init:n}=await Br(()=>import("./browser-13b7e4b1.js").then(s=>s.b),[],import.meta.url),r=await n(),i=new r.Context("main");return pe.debug("Z3 context initialized successfully (Node.js)"),{z3:r,ctx:i}}catch(n){pe.error("Node.js Z3 initialization also failed:",n)}}throw new Error(`initZ3 was not imported correctly. Please consult documentation on how to load Z3 in browser. Details: ${t.message}`)}})()),Nh}function ua(t,e=new Set){return t&&(t.type==="var"&&e.add(t.name),t.type==="pair"&&(ua(t.fst,e),ua(t.snd,e)),t.type==="binop"&&(ua(t.left,e),ua(t.right,e)),t.type==="funcall"&&t.args&&t.args.forEach(n=>ua(n,e))),e}function Fn(t,e,n){var s;const{Int:r,String:i}=t;switch(e.type){case"int":return r.val(e.value);case"string":return i.val(e.value);case"pair":const l=Fn(t,e.fst,n),c=Fn(t,e.snd,n);return l.concat(i.val(",")).concat(c);case"var":return n(e.name);case"funcall":{if(e.name==="length"&&e.args&&e.args.length===1&&((s=e.args[0])==null?void 0:s.type)==="string")return r.val((e.args[0].value||"").length);if(e.name==="concat"&&e.args&&e.args.length===2){const u=Fn(t,e.args[0],n),f=Fn(t,e.args[1],n);return u.concat(f)}if(e.name==="substring"&&e.args&&e.args.length===3){const u=Fn(t,e.args[0],n),f=Fn(t,e.args[1],n),h=Fn(t,e.args[2],n);return u.substr(f,h)}if(e.name==="length"&&e.args&&e.args.length===1)return Fn(t,e.args[0],n).length();throw new Error(`Unknown function '${e.name}'`)}case"binop":{const u=Fn(t,e.left,n),f=Fn(t,e.right,n);switch(e.op){case"+":return u.add(f);case"-":return u.sub(f);case"*":return u.mul(f);case"/":return u.div(f);default:throw new Error(`Unknown operator '${e.op}'`)}}default:throw new Error(`Unknown AST node '${e.type}'`)}}function nr(t,e){function n(r){if(r.type==="int")return r.value|0;if(r.type==="string")return r.value;if(r.type==="list")return(r.elements||[]).map(n);if(r.type==="pair")return{__pair__:!0,fst:n(r.fst),snd:n(r.snd)};if(r.type==="var"){const i=e==null?void 0:e[r.name];if(i===void 0)throw new Error(`Unbound variable '${r.name}'`);return i}if(r.type==="funcall"){if(r.name==="concat"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(typeof i=="string"&&typeof s=="string")return i+s;if(Array.isArray(i)&&Array.isArray(s))return[...i,...s];throw new Error("concat requires two strings or two lists")}if(r.name==="substring"&&r.args&&r.args.length===3){const i=n(r.args[0]),s=n(r.args[1]),l=n(r.args[2]);if(typeof i!="string"||typeof s!="number"||typeof l!="number")throw new Error("substring requires string, int, int");return i.substr(s,l)}if(r.name==="length"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Error("length requires string or list")}if(r.name==="isSubstringOf"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(typeof i!="string"||typeof s!="string")throw new Error("isSubstringOf requires two strings");return s.includes(i)}if(r.name==="head"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!Array.isArray(i)||i.length===0)throw new Error("head requires non-empty list");return i[0]}if(r.name==="tail"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!Array.isArray(i))throw new Error("tail requires list");return i.length===0?[]:i.slice(1)}if(r.name==="append"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(!Array.isArray(i))throw new Error("append requires list");return[...i,s]}if(r.name==="sublist"&&r.args&&r.args.length===3){const i=n(r.args[0]),s=n(r.args[1]),l=n(r.args[2]);if(!Array.isArray(i)||typeof s!="number"||typeof l!="number")throw new Error("sublist requires list, int, int");return i.slice(s,s+l)}if(r.name==="isSublistOf"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(!Array.isArray(i)||!Array.isArray(s))throw new Error("isSublistOf requires two lists");const l=i.length;if(l===0)return!0;for(let c=0;c<=s.length-l;c++){let u=!0;for(let f=0;f<l;f++)if(s[c+f]!==i[f]){u=!1;break}if(u)return!0}return!1}if(r.name==="fst"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!i||typeof i!="object"||i.__pair__!==!0)throw new Error("fst requires pair");return i.fst}if(r.name==="snd"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!i||typeof i!="object"||i.__pair__!==!0)throw new Error("snd requires pair");return i.snd}throw new Error(`Unknown function '${r.name}'`)}if(r.type==="binop"){const i=n(r.left),s=n(r.right);if(typeof i!="number"||typeof s!="number")throw new Error("Arithmetic operands must be numbers");switch(r.op){case"+":return i+s|0;case"-":return i-s|0;case"*":return i*s|0;case"/":if(s===0)throw new Error("Division by zero");return Math.trunc(i/s)|0;default:throw new Error(`Unknown operator '${r.op}'`)}}throw new Error(`Unknown node type '${r.type}'`)}return n(t)}function bw(t,e){if(typeof t!="string")throw new Error("Predicate must be a string");const n=t.trim(),r=[">=","<=","==","!=",">","<"];let i=0,s=-1,l=null;for(let m=0;m<n.length;m++){const x=n[m];if(x==="("?i++:x===")"&&(i=Math.max(0,i-1)),i!==0)continue;const y=n.slice(m,m+2);if(r.includes(y)){l=y,s=m;break}if(r.includes(x)){l=x,s=m;break}}if(!l||s<0)throw new Error("Predicate must contain a comparison operator");const c=n.slice(0,s).trim(),u=n.slice(s+l.length).trim(),f=e(c),h=e(u);return{type:"cmp",op:l,left:f,right:h}}function xo(t,e){if(typeof t!="string")throw new Error("Boolean expression must be a string");const n=t.trim();let r=0;const i=()=>{for(;r<n.length&&/\s/.test(n[r]);)r++},s=(S,b)=>(S===0||/[^A-Za-z0-9_]/.test(n[S-1]||""))&&(S+b===n.length||/[^A-Za-z0-9_]/.test(n[S+b]||"")),l=S=>(i(),n.slice(r,r+S.length).toLowerCase()===S&&s(r,S.length)),c=()=>{i();const S=r;if(!/[A-Za-z_]/.test(n[r]||""))throw new Error(`Expected identifier at position ${r}`);for(r++;r<n.length&&/[A-Za-z0-9_]/.test(n[r]);)r++;const b=n.slice(S,r);if(b&&/^[A-Z]/.test(b))throw new Error(`Variable names must start with lowercase letter, got '${b}'`);const N=r;if(i(),n[r]===":"){r++,i();const I=r;for(;r<n.length&&/[A-Za-z]/.test(n[r]);)r++;const A=n.slice(I,r).toLowerCase();return A==="int"||A==="bool"||A==="pair"?{name:b,varType:A}:(r=N,{name:b})}return{name:b}},u=S=>{const b=String(S||"").trim();if(/^true$/i.test(b)||b==="T")return{type:"boolLit",value:!0};if(/^false$/i.test(b)||b==="F")return{type:"boolLit",value:!1};if(/^-?\d+$/.test(b))return{type:"int",value:parseInt(b,10)};if(b.startsWith("(")&&b.endsWith(")")){const F=b.slice(1,-1).trim();let M=0,R=-1;for(let z=0;z<F.length;z++){const V=F[z];if(V==="(")M++;else if(V===")")M=Math.max(0,M-1);else if(V===","&&M===0){R=z;break}}if(R>=0){const z=F.slice(0,R).trim(),V=F.slice(R+1).trim();if(z.length&&V.length)return{type:"pairLit",fst:u(z),snd:u(V)}}}try{if(typeof e=="function")return e(b)}catch{}const N=b.match(/^([A-Za-z_][A-Za-z0-9_]*)(?::([A-Za-z]+))?$/);if(!N)throw new Error(`Unrecognized term '${b}'`);const I=N[1];if(I&&/^[A-Z]/.test(I))throw new Error(`Variable names must start with lowercase letter, got '${I}'`);const A=(N[2]||"").toLowerCase();return A==="bool"?{type:"boolVar",name:I,varType:"bool"}:A==="pair"?{type:"pairVar",name:I,varType:"pair"}:{type:"var",name:I}},f=()=>{if(i(),r>=n.length)throw new Error("Unexpected end");if(n[r]==="T"&&s(r,1))return r+=1,{type:"boolLit",value:!0};if(n[r]==="F"&&s(r,1))return r+=1,{type:"boolLit",value:!1};if(l("true"))return r+=4,{type:"boolLit",value:!0};if(l("false"))return r+=5,{type:"boolLit",value:!1};if(n.slice(r).startsWith("isSubstringOf")){if(r+=13,i(),n[r]!=="(")throw new Error("Expected '('");let M=r+1,R=1;for(r++;r<n.length&&R>0;r++){const O=n[r];O==="("?R++:O===")"&&R--}if(R!==0)throw new Error("Unterminated isSubstringOf arguments");const z=n.slice(M,r-1).trim();let V=0,j="";const D=[];for(let O=0;O<z.length;O++){const $=z[O];if($==="("){V++,j+=$;continue}if($===")"){V=Math.max(0,V-1),j+=$;continue}if($===","&&V===0){D.push(j.trim()),j="";continue}j+=$}if(j.trim().length&&D.push(j.trim()),D.length!==2)throw new Error("isSubstringOf expects two arguments");const G=e(D[0]),H=e(D[1]);return{type:"boolFuncall",name:"isSubstringOf",args:[G,H]}}const S=[">=","<=","==","!=",">","<"];let b=0,N=-1,I=null;for(let M=r;M<n.length;M++){const R=n[M];if(R==="("?b++:R===")"&&(b=Math.max(0,b-1)),b!==0)continue;if(n.slice(M,M+3)==="<->"){M+=2;continue}if(n.slice(M,M+2)==="->"){M+=1;continue}const z=n.slice(M,M+2);if(S.includes(z)){I=z,N=M;break}if(S.includes(R)){I=R,N=M;break}}if(I&&N>=0){const M=n.slice(r,N).trim(),R=N+I.length;let z=n.length;b=0;const V=(O,$)=>(O===0||/[^A-Za-z0-9_]/.test(n[O-1]||""))&&(O+$===n.length||/[^A-Za-z0-9_]/.test(n[O+$]||"")),j=O=>{const $=n.slice(O),W=["&&","||","^","->","<->"],K=["and","or","xor","implies","iff"];for(const Q of W)if($.startsWith(Q))return!0;for(const Q of K)if($.toLowerCase().startsWith(Q)&&V(O,Q.length))return!0;return!1};for(let O=R;O<n.length;O++){const $=n[O];if($==="("){b++;continue}if($===")"){if(b===0){z=O;break}b=Math.max(0,b-1);continue}if(b===0&&j(O)){z=O;break}}const D=n.slice(R,z).trim(),G=u(M),H=u(D);return r=z,{type:"cmp",op:I,left:G,right:H}}if(n[r]==="("){r++;const M=C();if(i(),n[r]!==")")throw new Error(`Expected ')' at ${r}`);return r++,M}const{name:A,varType:F}=c();return F?{type:"boolVar",name:A,varType:F}:{type:"boolVar",name:A}},h={not:["not"],and:["and"],xor:["xor"],or:["or"],implies:["implies"],iff:["iff"]},m={not:["!"],and:["&&"],xor:["^"],or:["||"],implies:["->"],iff:["<->"]},x=(S,b)=>{i();for(const N of S)if(n.slice(r,r+N.length)===N)return r+=N.length,!0;for(const N of b)if(n.slice(r,r+N.length).toLowerCase()===N&&s(r,N.length))return r+=N.length,!0;return!1},y=()=>(i(),x(m.not,h.not)?{type:"not",expr:y()}:f()),w=()=>{let S=y();for(;i(),x(m.and,h.and);){const b=y();S={type:"and",left:S,right:b}}return S},T=()=>{let S=w();for(;i(),x(m.xor,h.xor);){const b=w();S={type:"xor",left:S,right:b}}return S},k=()=>{let S=T();for(;i(),x(m.or,h.or);){const b=T();S={type:"or",left:S,right:b}}return S},_=()=>{let S=k();for(;i(),x(m.implies,h.implies);){const b=k();S={type:"implies",left:S,right:b}}return S},C=()=>{let S=_();for(;i(),x(m.iff,h.iff);){const b=_();S={type:"iff",left:S,right:b}}return S},g=C();if(i(),r!==n.length)throw new Error(`Unexpected token '${n[r]}' at position ${r}`);return g}function uo(t,e,n){const r=l=>{if(typeof l=="boolean")return l;if(typeof l=="number")return l!==0;if(l&&typeof l=="object"&&l.__pair__)return!0;throw new Error("Non-bool binding in bool expression")},i=l=>{if(!l)throw new Error("Invalid term");if(l.type==="int"||l.type==="bin"||l.type==="var"){try{return nr(l,e)}catch{}if(l.type==="var"&&typeof(e==null?void 0:e[l.name])<"u")return e[l.name]}return l.type==="boolLit"?!!l.value:l.type==="boolVar"?!!(e!=null&&e[l.name]):l.type==="pairVar"?e==null?void 0:e[l.name]:l.type==="pairLit"?{__pair__:!0,fst:i(l.fst),snd:i(l.snd)}:nr(l,e)},s=l=>{switch(l.type){case"boolLit":return!!l.value;case"boolVar":return r(e==null?void 0:e[l.name]);case"boolFuncall":{if(l.name==="isSubstringOf"&&l.args&&l.args.length===2){const c=nr(l.args[0],e||{}),u=nr(l.args[1],e||{});if(typeof c!="string"||typeof u!="string")throw new Error("isSubstringOf requires two string arguments");return u.includes(c)}throw new Error(`Unknown boolean function '${l.name}'`)}case"not":return!s(l.expr);case"and":return s(l.left)&&s(l.right);case"or":return s(l.left)||s(l.right);case"xor":{const c=s(l.left),u=s(l.right);return c&&!u||!c&&u}case"implies":{const c=s(l.left),u=s(l.right);return!c||u}case"iff":{const c=s(l.left),u=s(l.right);return c===u}case"cmp":{const c=i(l.left),u=i(l.right),f=(h,m)=>h&&typeof h=="object"&&h.__pair__&&m&&typeof m=="object"&&m.__pair__?f(h.fst,m.fst)&&f(h.snd,m.snd):h===m;switch(l.op){case"==":return f(c,u);case"!=":return!f(c,u);case"<":return c<u;case"<=":return c<=u;case">":return c>u;case">=":return c>=u;default:return!1}}default:throw new Error(`Unknown bool AST node '${l.type}'`)}};return s(t)}async function Ew(t,e,n){const{ctx:r}=await Cw(),{Int:i,Bool:s,Solver:l,And:c,Not:u,Or:f}=r,h=typeof t=="string"?xo(t,n):t,m=new Set,x=new Set,y=g=>{if(g)switch(g.type){case"boolVar":x.add(g.name);break;case"and":case"or":y(g.left),y(g.right);break;case"not":y(g.expr);break;case"cmp":{const S=b=>{b&&(b.type==="var"&&m.add(b.name),b.type==="bin"&&(S(b.left),S(b.right)))};S(g.left),S(g.right);break}}};y(h);const w=new Map(Array.from(m).map(g=>[g,i.const(g)])),T=new Map(Array.from(x).map(g=>[g,s.const(g)])),k=g=>{switch(g.type){case"boolLit":return g.value?s.val(!0):s.val(!1);case"boolVar":return T.get(g.name);case"boolFuncall":{if(g.name==="isSubstringOf"&&g.args&&g.args.length===2)try{const S=nr(g.args[0],e||{}),b=nr(g.args[1],e||{});if(typeof S!="string"||typeof b!="string")throw new Error("isSubstringOf requires two string arguments");return b.includes(S)?s.val(!0):s.val(!1)}catch{try{const b=Fn(r,g.args[1],I=>w.get(I)),N=Fn(r,g.args[0],I=>w.get(I));return b.contains(N)}catch{return s.val(!1)}}throw new Error(`Unknown boolean function '${g.name}'`)}case"not":return u(k(g.expr));case"and":return c(k(g.left),k(g.right));case"or":return f(k(g.left),k(g.right));case"cmp":{const S=N=>N&&(N.type==="int"||N.type==="var"||N.type==="bin"||N.type==="binop");if(S(g.left)&&S(g.right)){const N=F=>{if(F.type==="int")return i.val(F.value);if(F.type==="var")return w.get(F.name);if(F.type==="bin"||F.type==="binop"){const M=N(F.left),R=N(F.right);switch(F.op){case"+":return M.add(R);case"-":return M.sub(R);case"*":return M.mul(R);case"/":return M.div(R);default:throw new Error("Unknown arithmetic operator")}}throw new Error("Unknown arithmetic AST in bool comparison")},I=N(g.left),A=N(g.right);switch(g.op){case"==":return I.eq(A);case"!=":return u(I.eq(A));case"<":return I.lt(A);case"<=":return I.le(A);case">":return I.gt(A);case">=":return I.ge(A);default:throw new Error(`Unsupported predicate operator '${g.op}'`)}}return uo({type:"cmp",op:g.op,left:g.left,right:g.right},e||{})?s.val(!0):s.val(!1)}default:throw new Error(`Unknown bool AST node '${g.type}'`)}},_=new l;try{let g=1e4;try{typeof window<"u"&&window.__Z3_SETTINGS__&&typeof window.__Z3_SETTINGS__.solverTimeoutMs=="number"&&(g=window.__Z3_SETTINGS__.solverTimeoutMs|0)}catch{}_.set("timeout",g)}catch{}if(e&&typeof e=="object"){const g=[];for(const[S,b]of Object.entries(e))w.has(S)&&typeof b=="number"?g.push(w.get(S).eq(i.val(b|0))):T.has(S)&&typeof b=="boolean"&&g.push(T.get(S).eq(b?s.val(!0):s.val(!1)));g.length&&_.add(c(...g))}_.add(k(h));const C=await _.check();return String(C)==="sat"}async function Pw(t,e,n=5){const{solveEquation:r}=await Br(()=>import("./eval-bool-8db7bc73.js"),[],import.meta.url);return await r(t,e,n)}function Nw(t,e,n=jt){if(!t||typeof t!="string")return{};const r={},i=t.split(",");for(const s of i){const l=s.indexOf("=");if(l===-1)continue;const c=s.slice(0,l).trim(),u=s.slice(l+1).trim();if(!c)continue;const f=n(u);r[c]=nr(f,e)}return r}function Aw(t){return t&&typeof t=="object"&&(t.__pair__||Object.prototype.hasOwnProperty.call(t,"fst")&&Object.prototype.hasOwnProperty.call(t,"snd"))}function Ra(t){return typeof t=="boolean"?t?"T":"F":typeof t=="string"?`'${t}'`:Array.isArray(t)?`[${t.map(Ra).join(", ")}]`:Aw(t)?`(${Ra(t.fst)}, ${Ra(t.snd)})`:String(t)}function a5(t){return!Array.isArray(t)||t.length===0?"":t.map(Ra).join(", ")}const Ay="text-xs font-semibold text-gray-600 uppercase tracking-wider";function Mw({isOpen:t,onClose:e}){const n=xw(),r=n.listTypes(),[i,s]=B.useState("x + 2 * y"),[l,c]=B.useState("x=3, y=4"),[u,f]=B.useState(null),[h,m]=B.useState([]),[x,y]=B.useState(null),w=B.useMemo(()=>r.map(g=>n.getType(g)),[r,n]);if(!t)return null;function T(C){const g=String(C||"").trim();if(!g)return{};try{const b=JSON.parse(g);if(b&&typeof b=="object"&&!Array.isArray(b))return b}catch{}const S={};for(const b of g.split(",")){const N=b.trim();if(!N)continue;const I=N.indexOf("=");if(I===-1)continue;const A=N.slice(0,I).trim(),F=N.slice(I+1).trim(),M=Number.parseInt(F,10);A&&(S[A]=Number.isFinite(M)?M:0)}return S}function k(C){let g=0;for(let S=0;S<C.length;S++){const b=C[S];if(b==="("?g++:b===")"&&(g=Math.max(0,g-1)),g===0&&b==="="){const N=C[S-1]||"",I=C[S+1]||"";if(N!=="="&&I!=="="&&N!=="<"&&N!==">")return S}}return-1}const _=async()=>{y(null),f(null),m([]);try{const C=String(i||"").trim();if(!C)throw new Error("Please enter an expression or an equation.");const g=k(C),S=T(l);if(g>=0){const b=jt(C.slice(0,g)),N=jt(C.slice(g+1));if(Object.keys(S).length>0){const A=await uo({type:"cmp",op:"==",left:b,right:N},S,jt);f(!!A)}else{const{solutions:I}=await Pw(b,N,5);m(I||[])}}else try{const b=jt(C),N=await nr(b,S);f(N)}catch{const N=xo(C,jt),I=uo(N,S,jt);f(!!I)}}catch(C){y(String(C.message||C))}};return P.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30",children:P.jsxs("div",{className:"bg-white rounded shadow-lg w-[1000px] max-h-[85vh] overflow-y-auto p-4",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsx("h3",{className:"text-lg font-semibold",children:"ADT Manager - Available Types and Operations"}),P.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",onClick:e,children:"Close"})]}),P.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[P.jsxs("div",{children:[P.jsx("div",{className:Ay,children:"Available Data Types"}),w.map(C=>P.jsxs("div",{className:"mt-3 p-3 border rounded bg-gray-50",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsx("div",{className:"font-semibold text-lg",children:C.name}),C.__readonly&&P.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded",children:"Built-in"})]}),P.jsxs("div",{className:"mb-3",children:[P.jsx("div",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Operations"}),P.jsxs("div",{className:"space-y-1",children:[(C.operations||[]).map((g,S)=>P.jsxs("div",{className:"text-sm font-mono bg-white p-2 rounded border",children:[P.jsx("span",{className:"text-blue-600 font-semibold",children:g.name}),P.jsxs("span",{className:"text-gray-600",children:["(",g.params?g.params.map((b,N)=>`${b.type} ${String.fromCharCode(97+N)}`).join(", "):"no params",")"]}),P.jsx("span",{className:"text-gray-500",children:"  "}),P.jsx("span",{className:"text-green-600 font-semibold",children:g.result})]},S)),(!C.operations||C.operations.length===0)&&P.jsx("div",{className:"text-sm text-gray-500 italic",children:"(no operations)"})]})]}),P.jsxs("div",{children:[P.jsx("div",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Axioms"}),P.jsxs("div",{className:"space-y-1",children:[(C.axioms||[]).map((g,S)=>P.jsxs("div",{className:"text-sm font-mono bg-white p-2 rounded border",children:[P.jsx("span",{className:"text-purple-600 font-semibold",children:g.name?g.name+": ":""}),P.jsx("span",{className:"text-gray-800",children:g.equation})]},S)),(!C.axioms||C.axioms.length===0)&&P.jsx("div",{className:"text-sm text-gray-500 italic",children:"(no axioms)"})]})]})]},C.name))]}),P.jsxs("div",{children:[P.jsx("div",{className:Ay,children:"Interactive Tools"}),P.jsxs("div",{className:"mt-3 p-3 border rounded bg-gray-50",children:[P.jsx("div",{className:"text-sm font-semibold mb-3 text-gray-700",children:"Sandbox"}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-xs text-gray-700 mb-1",children:"Expression or Equation"}),P.jsx("input",{className:"w-full border rounded p-2 text-sm font-mono",placeholder:"Enter an expression (e.g., x + 2*y) or equation with '=' (e.g., x + y = 7)",value:i,onChange:C=>s(C.target.value),"data-testid":"sandbox-expr"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-xs text-gray-700 mb-1",children:"Variable Bindings"}),P.jsx("input",{className:"w-full border rounded p-2 text-sm font-mono",placeholder:'{"x":3, "y":4} or x=3, y=4',value:l,onChange:C=>c(C.target.value),"data-testid":"sandbox-bindings"})]}),P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",onClick:_,"data-testid":"sandbox-run",children:"Run"}),u!==null&&P.jsxs("span",{className:"text-sm","data-testid":"sandbox-result",children:["Result: ",P.jsx("span",{className:"font-mono bg-green-100 px-2 py-1 rounded",children:Ra(u)})]})]}),x&&P.jsx("div",{className:"p-2 text-red-700 bg-red-100 border border-red-200 rounded text-sm whitespace-pre-wrap",children:x}),h&&h.length>0&&P.jsxs("div",{className:"text-sm","data-testid":"sandbox-solutions",children:[P.jsx("div",{className:"font-semibold mb-2 text-gray-700",children:"Solutions (up to 5):"}),P.jsx("div",{className:"space-y-1",children:h.map((C,g)=>P.jsx("div",{className:"font-mono bg-white p-2 rounded border","data-testid":"sandbox-sol-entry",children:JSON.stringify(C)},g))})]})]})]}),P.jsxs("div",{className:"mt-4 p-3 border rounded bg-blue-50",children:[P.jsx("div",{className:"text-sm font-semibold mb-2 text-blue-800",children:"Usage Notes"}),P.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[P.jsx("div",{children:" Int operations: +(Int a, Int b), *(Int a, Int b), ==(Int a, Int b), etc."}),P.jsx("div",{children:" Bool operations: and(Bool a, Bool b), or(Bool a, Bool b), not(Bool a)"}),P.jsx("div",{children:" Pair operations: fst(Pair p), snd(Pair p), ==(Pair a, Pair b)"}),P.jsx("div",{children:" Pair literals: (value1, value2)"}),P.jsx("div",{children:" All operations support pattern matching and deconstruction"}),P.jsx("div",{children:" Parameter names (a, b, c, ...) are automatically assigned for display"})]})]})]})]})]})})}const kc="http://example.org/apn",Rw="http://www.pnml.org/version-2009/grammar/pnml",Iw=500,l5={startX:40,startY:40,spacing:80,columns:25,transitionOffsetX:220};function Ah(t){return t?Array.from(t):[]}function Lw(t){const n=new DOMParser().parseFromString(t,"application/xml"),r=n.querySelector("parsererror");if(r)throw console.error("XML parsing error:",r.textContent),new Error("Invalid XML: "+r.textContent);const i=n.documentElement,s=i.namespaceURI||Rw;return{xmlDoc:n,pnmlElement:i,PNML_NS:s}}function Fw(t,e){const n=t.getElementsByTagNameNS(e,"net");if(n&&n.length>0)return n[0];const r=t.getElementsByTagName("net");return r&&r.length>0?r[0]:null}function jw(t,e){const n=t.getElementsByTagNameNS(e,"page");if(n&&n.length>0)return n[0];const r=t.getElementsByTagName("page");return r&&r.length>0?r[0]:null}function u5(t){const e=(i,s)=>{if(!i)return[];const l=typeof i.getElementsByTagNameNS=="function"?i.getElementsByTagNameNS(t,s):[];if(l&&l.length>0)return Ah(l);const c=typeof i.getElementsByTagNameNS=="function"?i.getElementsByTagNameNS(kc,s):[];if(c&&c.length>0)return Ah(c);const u=typeof i.getElementsByTagName=="function"?i.getElementsByTagName(s):[];return u&&u.length>0?Ah(u):[]},n=(i,s)=>e(i,s);return{getElements:e,findChildElements:n,getTextContent:(i,s)=>{const l=n(i,s);if(l.length===0)return"";const c=l[0],u=c.getElementsByTagName("text").length?c.getElementsByTagName("text"):c.getElementsByTagNameNS(kc,"text");if(u&&u.length>0){const f=u[0];if(f&&typeof f.textContent=="string")return f.textContent}return typeof c.textContent=="string"?c.textContent:""}}}function Mh(t,e,n){return t?u5(e).getElements(t,n):[]}function Ow(t){return t>=Iw}function c5(t,e,n,r,i){const{findChildElements:s}=e,{applyAutoLayout:l,layout:c=l5}=n,{startX:u,startY:f,spacing:h,columns:m,transitionOffsetX:x}=c,y=Dw(t,s);if(y.found||!l)return{x:y.x,y:y.y};const w=r%m,T=Math.floor(r/m),k=u+w*h,_=f+T*h;return i==="transition"?{x:k+x,y:_}:{x:k,y:_}}function Dw(t,e){const n=e(t,"graphics");if(n.length>0){const r=e(n[0],"position");if(r.length>0){const i=parseInt(r[0].getAttribute("x")||"0",10),s=parseInt(r[0].getAttribute("y")||"0",10);return{x:i,y:s,found:!0}}}return{x:0,y:0,found:!1}}function zw(t,e={}){return{applyAutoLayout:t,layout:{...l5,...e}}}function sg(t){const e=[];let n="",r=0,i=0,s=!1;for(let c=0;c<t.length;c++){const u=t[c];if(s){n+=u,u==="'"&&t[c-1]!=="\\"&&(s=!1);continue}if(u==="'"){s=!0,n+=u;continue}if(u==="("){r++,n+=u;continue}if(u===")"){r=Math.max(0,r-1),n+=u;continue}if(u==="["){i++,n+=u;continue}if(u==="]"){i=Math.max(0,i-1),n+=u;continue}if(u===","&&r===0&&i===0){e.push(n.trim()),n="";continue}n+=u}const l=n.trim();return l.length>0&&e.push(l),e.filter(Boolean)}function Ia(t){const e=String(t||"").trim(),n=e.toLowerCase();if(e==="T"||n==="true")return!0;if(e==="F"||n==="false")return!1;if(/^[+-]?\d+$/.test(e))return parseInt(e,10);if(e.startsWith("'")&&e.endsWith("'")&&e.length>=2)return e.slice(1,-1).replace(/\\(.)/g,(i,s)=>s==="n"?`
`:s==="t"?"	":s==="r"?"\r":s==="\\"?"\\":s==="'"?"'":s);if(e.startsWith("[")&&e.endsWith("]")){const r=e.slice(1,-1).trim();return r.length===0?[]:sg(r).map(s=>Ia(s))}if(e.startsWith("(")&&e.endsWith(")")){const r=e.slice(1,-1).trim();let i=0,s=-1;for(let l=0;l<r.length;l++){const c=r[l];if(c==="(")i++;else if(c===")")i=Math.max(0,i-1);else if(c===","&&i===0){s=l;break}}if(s>=0){const l=r.slice(0,s).trim(),c=r.slice(s+1).trim();return{__pair__:!0,fst:Ia(l),snd:Ia(c)}}}return null}const Bw=t=>`P${t+1}`;function Uw(t,e,n){const{getTextContent:r,getElements:i}=e,s=[];return t.forEach((l,c)=>{try{const u=l.getAttribute("id"),f=r(l,"name")||Bw(c),h=c5(l,e,n,c,"place");let m=0,x;const y=i(l,"valueTokens").filter(T=>T.namespaceURI===kc&&T.parentElement===l);if(y.length>0){const T=y[0],k=T.getElementsByTagNameNS?T.getElementsByTagNameNS(kc,"token"):T.getElementsByTagName("token"),_=Array.from(k||[]).map(C=>{let g=r(C,"text");!g&&typeof C.textContent=="string"&&(g=C.textContent);const S=typeof g=="string"?g.trim():"";return S?Ia(S):null}).filter(C=>C!==null);x=_,m=_.length}else{const T=r(l,"initialMarking");if(T){const k=T.trim();if(k.startsWith("[")&&k.endsWith("]"))try{const _=k.slice(1,-1).trim();x=(_.length?sg(_):[]).map(Ia).filter(g=>g!==null),m=Array.isArray(x)?x.length:0}catch(_){console.warn(`Could not parse token list for ${u}:`,_)}else{const _=parseInt(k,10);Number.isFinite(_)&&(m=_)}}}const w=r(l,"type");s.push({id:u,name:f,label:f,x:h.x,y:h.y,tokens:m,valueTokens:x,type:w||void 0})}catch(u){console.error("Error processing place:",u)}}),s}const Gw=t=>`T${t+1}`;function Vw(t,e,n){const{getTextContent:r}=e,i=[];return t.forEach((s,l)=>{try{const c=s.getAttribute("id"),u=r(s,"name")||Gw(l),f=c5(s,e,n,l,"transition"),h=r(s,"guard"),m=r(s,"action");i.push({id:c,name:u,label:u,x:f.x,y:f.y,guard:h||void 0,action:m||void 0})}catch(c){console.error("Error processing transition:",c)}}),i}const Ww="north",$w="south";function Hw(t,e,n){const{getTextContent:r,findChildElements:i}=e,s=[],{placeIds:l,transitionIds:c}=n;return t.forEach(u=>{try{const f=u.getAttribute("id"),h=u.getAttribute("source"),m=u.getAttribute("target");if(!h||!m){console.warn(`Skipping arc ${f} due to missing source or target`);return}let x=Ww,y=$w;const w=i(u,"graphics");if(w.length>0){const S=i(w[0],"metadata");if(S.length>0){const b=i(S[0],"sourceDirection");b.length>0&&b[0].textContent&&(x=b[0].textContent);const N=i(S[0],"targetDirection");N.length>0&&N[0].textContent&&(y=N[0].textContent)}}const T=Xw(f,h,m,l,c);let k=1;const _=r(u,"inscription");if(_){const S=parseInt(_,10);Number.isFinite(S)?k=S:console.warn(`Could not parse weight for ${f}: '${_}', defaulting to 1`)}const C=r(u,"binding");let g;if(C&&C.includes(","))try{g=sg(C)}catch{g=C.split(",").map(b=>b.trim()).filter(Boolean)}else C&&(g=[C.trim()]);s.push({id:f,source:h,target:m,type:T,weight:k,binding:g?void 0:C||void 0,bindings:g||void 0,sourceDirection:x,targetDirection:y})}catch(f){console.error("Error processing arc:",f)}}),s}function Xw(t,e,n,r,i){const s=r.includes(e),l=i.includes(e),c=r.includes(n),u=i.includes(n);return s&&u?"place-to-transition":l&&c?"transition-to-place":e.toLowerCase().includes("place")&&n.toLowerCase().includes("transition")?"place-to-transition":e.toLowerCase().includes("transition")&&n.toLowerCase().includes("place")?"transition-to-place":(console.warn(`Could not determine arc type for ${t}, defaulting to place-to-transition`),"place-to-transition")}function Yw(t){const e={places:[],transitions:[],arcs:[]};try{const{xmlDoc:n,PNML_NS:r}=Lw(t),i=Fw(n,r);if(!i)return console.error("No net element found in the PNML file"),e;const s=i.getAttribute("netMode");s&&(e.netMode=s);const l=jw(i,r);if(!l)return console.error("No page element found in the PNML file"),e;const c=u5(r),u=Mh(l,r,"place"),f=Mh(l,r,"transition"),h=Mh(l,r,"arc"),m=u.length+f.length,x=zw(Ow(m));return e.places=Uw(u,c,x),e.transitions=Vw(f,c,x),e.arcs=Hw(h,c,{placeIds:e.places.map(y=>y.id),transitionIds:e.transitions.map(y=>y.id)}),e}catch(n){return console.error("Error parsing PNML:",n),e}}const dn="http://example.org/apn";function Kw(t){try{const e=document.implementation.createDocument("http://www.pnml.org/version-2009/grammar/pnml","pnml",null),n=e.documentElement;let r=!1;const i=e.createElement("net");i.setAttribute("id","net1"),i.setAttribute("type","http://www.pnml.org/version-2009/grammar/ptnet"),n.appendChild(i),t.netMode&&i.setAttribute("netMode",t.netMode);const s=e.createElement("name"),l=e.createElement("text");l.textContent="Petri Net",s.appendChild(l),i.appendChild(s);const c=e.createElement("page");c.setAttribute("id","page1"),i.appendChild(c);const u=t.places||[];u.forEach(T=>{const k=e.createElement("place");k.setAttribute("id",T.id);const _=e.createElement("name"),C=e.createElement("text");C.textContent=T.label||T.name||`P${T.id}`,_.appendChild(C),k.appendChild(_);const g=e.createElement("graphics"),S=e.createElement("position");if(S.setAttribute("x",T.x||0),S.setAttribute("y",T.y||0),g.appendChild(S),k.appendChild(g),T.type){const N=e.createElementNS(dn,"apn:type"),I=e.createElementNS(dn,"apn:text");I.textContent=String(T.type),N.appendChild(I),k.appendChild(N),r=!0}const b=N=>typeof N=="boolean"?N?"T":"F":typeof N=="string"?`'${N.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")}'`:Array.isArray(N)?`[${N.map(b).join(", ")}]`:N&&typeof N=="object"&&N.__pair__?`(${b(N.fst)}, ${b(N.snd)})`:String(N);if(Array.isArray(T.valueTokens)){const N=e.createElementNS(dn,"apn:valueTokens");T.valueTokens.forEach(I=>{const A=e.createElementNS(dn,"apn:token"),F=e.createElementNS(dn,"apn:text");F.textContent=b(I),A.appendChild(F),N.appendChild(A)}),k.appendChild(N),r=!0}else if(T.tokens>0){const N=e.createElement("initialMarking"),I=e.createElement("text");I.textContent=T.tokens,N.appendChild(I),k.appendChild(N)}c.appendChild(k)});const f=t.transitions||[];f.forEach(T=>{const k=e.createElement("transition");k.setAttribute("id",T.id);const _=e.createElement("name"),C=e.createElement("text");C.textContent=T.label||T.name||`T${T.id}`,_.appendChild(C),k.appendChild(_);const g=e.createElement("graphics"),S=e.createElement("position");if(S.setAttribute("x",T.x||0),S.setAttribute("y",T.y||0),g.appendChild(S),k.appendChild(g),T.guard){const b=e.createElementNS(dn,"apn:guard"),N=e.createElementNS(dn,"apn:text");N.textContent=String(T.guard),b.appendChild(N),k.appendChild(b),r=!0}if(T.action){const b=e.createElementNS(dn,"apn:action"),N=e.createElementNS(dn,"apn:text");N.textContent=String(T.action),b.appendChild(N),k.appendChild(b),r=!0}c.appendChild(k)});const h=t.arcs||[],m=new Set(u.map(T=>T.id)),x=new Set(f.map(T=>T.id));return h.filter(T=>{const k=T.source||T.sourceId,_=T.target||T.targetId;if(!k||!_||k==="undefined"||_==="undefined")return console.warn(`Skipping invalid arc ${T.id} during save - missing or undefined source/target`),!1;const C=m.has(k)||x.has(k),g=m.has(_)||x.has(_);return!C||!g?(console.warn(`Skipping invalid arc ${T.id} during save - references non-existent elements`),!1):!0}).forEach(T=>{const k=e.createElement("arc");k.setAttribute("id",T.id);const _=T.source||T.sourceId,C=T.target||T.targetId;k.setAttribute("source",_),k.setAttribute("target",C);const g=e.createElement("graphics"),S=e.createElement("metadata"),b=e.createElement("sourceDirection");b.textContent=T.sourceDirection||"north",S.appendChild(b);const N=e.createElement("targetDirection");if(N.textContent=T.targetDirection||"south",S.appendChild(N),g.appendChild(S),k.appendChild(g),T.weight>1&&!(T.binding||Array.isArray(T.bindings)&&T.bindings.length)){const I=e.createElement("inscription"),A=e.createElement("text");A.textContent=T.weight,I.appendChild(A),k.appendChild(I)}if(Array.isArray(T.bindings)&&T.bindings.length>0){const I=e.createElementNS(dn,"apn:binding"),A=e.createElementNS(dn,"apn:text");A.textContent=T.bindings.join(", "),I.appendChild(A),k.appendChild(I),r=!0}else if(T.binding){const I=e.createElementNS(dn,"apn:binding"),A=e.createElementNS(dn,"apn:text");A.textContent=String(T.binding),I.appendChild(A),k.appendChild(I),r=!0}c.appendChild(k)}),r&&n.setAttribute("xmlns:apn",dn),new XMLSerializer().serializeToString(e)}catch(e){throw console.error("Error generating PNML:",e),e}}async function My(t){try{return Kw(t)}catch(e){throw console.error("Error exporting to PNML:",e),e}}async function Qw(t){try{return Yw(t)}catch(e){throw console.error("Error importing from PNML:",e),e}}class Zw{constructor(){this.listeners=new Map}on(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)}off(e,n){if(!this.listeners.has(e))return;const r=this.listeners.get(e),i=r.indexOf(n);i>-1&&r.splice(i,1)}emit(e,n){if(!this.listeners.has(e))return;const r=this.listeners.get(e);for(const i of r)try{i(n)}catch(s){console.error(`Error in event listener for ${e}:`,s)}}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){return this.listeners.has(e)?this.listeners.get(e).length:0}}const no={transitionsChanged:"transitionsChanged",transitionFired:"transitionFired"},ca=new Zw;class d5{constructor(){this.isInitialized=!1,this.petriNet=null,this.eventBus=null,this.simulationMode="single"}async initialize(e,n={}){if(!this.validatePetriNet(e))throw new Error("Invalid Petri net structure");this.petriNet=this.normalizeNet(e),this.isInitialized=!0,this.simulationMode=n.simulationMode||"single",await this.initializeSpecific(this.petriNet,n)}async initializeSpecific(e,n){}async update(e){if(!this.isInitialized)throw new Error("Simulator not initialized");if(!this.validatePetriNet(e))throw new Error("Invalid Petri net structure");this.petriNet=this.normalizeNet(e),await this.updateSpecific(this.petriNet)}async updateSpecific(e){}async getEnabledTransitions(){return this.isInitialized?await this.getEnabledTransitionsSpecific():[]}async getEnabledTransitionsSpecific(){return[]}async fireTransition(e,n={}){if(!this.isInitialized)throw new Error("Simulator not initialized");if(!(n.skipEnabledCheck||!1)&&!(await this.getEnabledTransitions()).includes(e))throw new Error(`Transition ${e} is not enabled`);return await this.fireTransitionSpecific(e,n)}async fireTransitionSpecific(e){return this.petriNet}async stepSimulation(){if(!this.isInitialized)throw new Error("Simulator not initialized");return await this.stepSimulationSpecific()}async stepSimulationSpecific(){return this.petriNet}reset(){this.isInitialized=!1,this.petriNet=null,this.simulationMode="single",this.resetSpecific()}resetSpecific(){}setEventBus(e){this.eventBus=e}emitTransitionsChanged(e={}){if(!this.eventBus)return;const n=Array.isArray(e.enabled)?e.enabled:[],r=Array.isArray(e.previouslyEnabled)?e.previouslyEnabled:[],i=typeof e.hasEnabled=="boolean"?e.hasEnabled:n.length>0;this.eventBus.emit(no.transitionsChanged,{enabled:n,previouslyEnabled:r,hasEnabled:i})}emitTransitionFired(e={}){if(!this.eventBus)return;const{transitionId:n,newPetriNet:r}=e||{};n&&this.eventBus.emit(no.transitionFired,{transitionId:n,newPetriNet:r})}getType(){throw new Error("getType() must be implemented by subclasses")}validatePetriNet(e){if(!e||typeof e!="object")return!1;const{places:n,transitions:r,arcs:i}=e;return!(!Array.isArray(n)||!Array.isArray(r)||!Array.isArray(i))}normalizeNet(e){const n=JSON.parse(JSON.stringify(e||{places:[],transitions:[],arcs:[]})),r=Array.isArray(n.places)?n.places:[],i=Array.isArray(n.transitions)?n.transitions:[],s=Array.isArray(n.arcs)?n.arcs:[],l=new Set(r.map(u=>String(u.id))),c=new Set(i.map(u=>String(u.id)));for(const u of r){if(u.id=String(u.id),Array.isArray(u.valueTokens)){const f=u.valueTokens.length;(!Number.isFinite(u.tokens)||u.tokens!==f)&&(u.tokens=f)}else Number.isFinite(u.tokens)||(u.tokens=0);!u.label&&u.name&&(u.label=u.name),!u.name&&u.label&&(u.name=u.label)}for(const u of s){u.id!==void 0&&(u.id=String(u.id));const f=u.sourceId||u.source,h=u.targetId||u.target;u.sourceId=String(f),u.targetId=String(h),u.source===void 0&&(u.source=u.sourceId),u.target===void 0&&(u.target=u.targetId);const m=Number(u.weight);u.weight=Number.isFinite(m)&&m>0?m:1,Array.isArray(u.bindings)||(u.binding?u.bindings=[String(u.binding)]:u.bindings=[]),u.sourceType||(u.sourceType=l.has(u.sourceId)?"place":c.has(u.sourceId)?"transition":u.sourceType),u.targetType||(u.targetType=l.has(u.targetId)?"place":c.has(u.targetId)?"transition":u.targetType)}return n.places=r,n.transitions=i,n.arcs=s,n}isReady(){return this.isInitialized&&this.petriNet!==null}getSimulationStats(){if(!this.isInitialized)return{enabledTransitions:[],totalTokens:0,totalPlaces:0,totalTransitions:0};const{places:e,transitions:n}=this.petriNet,r=e.reduce((i,s)=>i+(s.tokens||0),0);return{enabledTransitions:[],totalTokens:r,totalPlaces:e.length,totalTransitions:n.length}}}function qw(t){if(!(t!=null&&t.transitions)||!(t!=null&&t.places)||!(t!=null&&t.arcs))return!1;for(const e of t.transitions)if(f5(e.id,t))return!1;return!0}function f5(t,e){const n=Jw(t,e.places,e.arcs);for(const r of n){const i=e.arcs.find(l=>(l.sourceId===r.id||l.source===r.id)&&(l.targetId===t||l.target===t));if(!i)continue;const s=i.weight||1;if((r.tokens||0)<s)return!1}return!0}function Jw(t,e,n){const r=[];for(const i of n){const s=i.sourceId||i.source;if((i.targetId||i.target)===t){const c=e.find(u=>u.id===s);c&&r.push(c)}}return r}function e9(t){var l,c,u,f,h;if(!t)return null;const e=((l=t.places)==null?void 0:l.length)||0,n=((c=t.transitions)==null?void 0:c.length)||0,r=((u=t.arcs)==null?void 0:u.length)||0,i=((f=t.places)==null?void 0:f.reduce((m,x)=>m+(x.tokens||0),0))||0,s=((h=t.transitions)==null?void 0:h.filter(m=>f5(m.id,t)))||[];return{placeCount:e,transitionCount:n,arcCount:r,totalTokens:i,enabledTransitionCount:s.length,enabledTransitions:s.map(m=>m.id),isDeadlock:qw(t)}}function h5(t,e){const n=new Map;for(const r of t)r.srcId&&(n.has(r.srcId)||n.set(r.srcId,[]),n.get(r.srcId).push(r));for(const[r,i]of n.entries()){const s=e[r];if(!s)continue;const l=i.filter(u=>u.countFallback).length;if(l>0){const u=Number(s.tokens||0);s.tokens=Math.max(0,u-l)}const c=i.filter(u=>!u.countFallback);if(Array.isArray(s.valueTokens)&&c.length>0){c.sort((u,f)=>f.tokenIndex-u.tokenIndex);for(const u of c)u.tokenIndex>=0&&u.tokenIndex<s.valueTokens.length&&s.valueTokens.splice(u.tokenIndex,1);s.tokens=s.valueTokens.length}}}function t9(t,e,n,r,i){const{evaluateArithmeticWithBindings:s,evaluateBooleanWithBindings:l,evaluatePatternLiteral:c,parseArithmetic:u}=i;for(const f of t){const h=f.targetId,m=r[h];if(!m)continue;const x=e.get(f.id)||[];if(x.length>0){Array.isArray(m.valueTokens)||(m.valueTokens=[]);for(const y of x)try{let w;const{kind:T,ast:k}=y;k&&(k.type==="var"||k.type==="boolVar"||k.type==="pairVar")?w=(n||{})[k.name]:T==="arith"?w=s(k,n):T==="bool"?w=l(k,n,u):T==="pattern"?w=c(k,n||{}):T==="pair"&&k.type==="pairLit"&&(w=c(k,n||{})),Array.isArray(m.valueTokens)||(m.valueTokens=[]),typeof w=="number"?m.valueTokens.push(w|0):typeof w=="boolean"||typeof w=="string"||n9(w)?m.valueTokens.push(w):Array.isArray(w)&&(T==="arith"||T==="pair"||k&&(k.type==="list"||k.type==="listPattern"||k.type==="tuplePattern")?m.valueTokens.push(w):m.valueTokens.push(...w))}catch{}}else if(f.weight&&(f.weight|0)>0){const y=f.weight|0;for(let w=0;w<y;w++){const T=Object.values(n||{});if(Array.isArray(m.valueTokens)){const k=T[0];m.valueTokens.push(typeof k=="boolean"?!!k:Number.isFinite(k)?k|0:1)}else m.tokens=Number(m.tokens||0)+1|0}}else Array.isArray(m.valueTokens)?m.valueTokens.push(1):m.tokens=Number(m.tokens||0)+1|0;Array.isArray(m.valueTokens)&&(m.tokens=m.valueTokens.length)}}function n9(t){return!!(t&&typeof t=="object"&&t.__pair__===!0&&"fst"in t&&"snd"in t)}class r9 extends d5{constructor(){super(),this.maxTokens=1/0}getType(){return"pt"}async initializeSpecific(e,n={}){const r=Number(n.maxTokens);this.maxTokens=Number.isFinite(r)&&r>=0?r:1/0,this.validatePTNet(e),this.initializeTokens(e),pe.debug("P/T Simulator initialized with",e.places.length,"places and",e.transitions.length,"transitions")}async updateSpecific(e){this.initializeTokens(e);const n=await this.getEnabledTransitionsSpecific();this.emitTransitionsChanged({enabled:n})}async getEnabledTransitionsSpecific(){if(!this.petriNet)return[];const{places:e,transitions:n,arcs:r}=this.petriNet,i=[];for(const s of n)this.isTransitionEnabled(s,e,r)&&i.push(s.id);return i}isTransitionEnabled(e,n,r){const i=r.filter(s=>s.target===e.id&&s.source!==e.id);for(const s of i){const l=n.find(f=>f.id===s.source);if(!l)continue;const c=s.weight||1;if((l.tokens||0)<c)return!1}return!0}async fireTransitionSpecific(e,n={}){const{places:r,transitions:i,arcs:s}=this.petriNet,l=n.skipEnabledCheck||!1,c=l?[]:await this.getEnabledTransitionsSpecific();if(!i.find(k=>k.id===e))throw new Error(`Transition ${e} not found`);const f=JSON.parse(JSON.stringify(this.petriNet)),h=f.places,m=s.filter(k=>k.target===e&&k.source!==e),x=s.filter(k=>k.source===e&&k.target!==e),y=[];for(const k of m){const _=(k.weight||1)|0;for(let C=0;C<_;C++)y.push({srcId:k.source,countFallback:!0})}const w=Object.fromEntries(h.map(k=>[k.id,k]));h5(y,w);const T=x.map(k=>({id:k.id,sourceId:k.source,targetId:k.target,weight:k.weight||1}));for(const k of T){const _=w[k.targetId];if(!_)continue;Array.isArray(_.valueTokens)&&delete _.valueTokens;const C=(k.weight||1)|0;_.tokens=Number(_.tokens||0)+C|0}for(const k of h)Array.isArray(k.valueTokens)?(k.tokens=Math.min(this.maxTokens,Array.isArray(k.valueTokens)?k.valueTokens.length:k.tokens||0),delete k.valueTokens):k.tokens=Math.min(this.maxTokens,k.tokens||0);if(this.petriNet=f,!l){this.emitTransitionFired({transitionId:e,newPetriNet:f});const k=await this.getEnabledTransitionsSpecific();this.emitTransitionsChanged({enabled:k,previouslyEnabled:c})}return f}async stepSimulationSpecific(){return this.petriNet}resetSpecific(){this.maxTokens=1/0}validatePTNet(e){const{transitions:n}=e;for(const r of n){if(r.guard&&typeof r.guard=="string"&&(r.guard.includes("+")||r.guard.includes("-")||r.guard.includes("*")||r.guard.includes("/")||r.guard.includes("=")||r.guard.includes("<")||r.guard.includes(">")||r.guard.includes("!=")))throw new Error("P/T simulator cannot handle algebraic expressions. Use algebraic simulator instead.");if(r.action&&typeof r.action=="string"&&(r.action.includes("+")||r.action.includes("-")||r.action.includes("*")||r.action.includes("/")||r.action.includes("=")))throw new Error("P/T simulator cannot handle algebraic expressions. Use algebraic simulator instead.")}}initializeTokens(e){const{places:n}=e;for(const r of n)(r.tokens===void 0||r.tokens===null)&&(r.tokens=0),r.tokens=Math.min(this.maxTokens,Math.max(0,r.tokens))}getSimulationStats(){if(!this.isInitialized)return{enabledTransitions:[],totalTokens:0,totalPlaces:0,totalTransitions:0};const{places:e,transitions:n}=this.petriNet,r=e.reduce((s,l)=>s+(l.tokens||0),0);return{enabledTransitions:this.getEnabledTransitionsSync(),totalTokens:r,totalPlaces:e.length,totalTransitions:n.length}}getEnabledTransitionsSync(){if(!this.petriNet)return[];const{places:e,transitions:n,arcs:r}=this.petriNet,i=[];for(const s of n)this.isTransitionEnabled(s,e,r)&&i.push(s.id);return i}}function xr(t,e){if(!t)return null;switch(t.type){case"pairLit":return{__pair__:!0,fst:xr(t.fst,e),snd:xr(t.snd,e)};case"list":return(t.elements||[]).map(n=>xr(n,e));case"pairPattern":return{__pair__:!0,fst:xr(t.fst,e),snd:xr(t.snd,e)};case"tuplePattern":return(t.elements||t.components||[]).map(n=>xr(n,e));case"listPattern":return(t.elements||[]).map(n=>xr(n,e));case"boolLit":return!!t.value;case"int":return t.value|0;case"var":case"boolVar":case"pairVar":return(e||{})[t.name];default:return null}}function i9(t,e,n,r){var i;try{const s=(t.arcs||[]).filter(l=>l.sourceId===n&&(l.targetType==="place"||!l.targetType));for(const l of s){const c=((i=e==null?void 0:e.bindingAstsByArc)==null?void 0:i.get(l.id))||[];for(const u of c){const{ast:f}=u||{};if(f&&(f.type==="var"||f.type==="boolVar"||f.type==="pairVar")){const h=r?r[f.name]:void 0;if(h===void 0)continue;const m=f.varType;if(m==="int"&&typeof h!="number"||m==="bool"&&typeof h!="boolean"||m==="string"&&typeof h!="string"||m==="pair"&&!(h&&typeof h=="object"&&h.__pair__===!0)||m==="list"&&!Array.isArray(h))return!1}}}return!0}catch{return!1}}const s9=["concat","substring","length","head","tail","append","sublist","isSublistOf","isSubstringOf","fst","snd"],o9=new Set(s9);function a9(t,e,n,r){const i=new Map;for(const s of t.transitions||[])if(s.guard&&typeof s.guard=="string")try{const l=n(String(s.guard),e);i.set(s.id,l)}catch{try{const c=r(String(s.guard),e);i.set(s.id,c)}catch{}}return i}function l9(t,e){if(!t)return!1;const n=t.length;for(let r=0;r<n;r+=1){const i=t[r];if(!/[A-Za-z_]/.test(i))continue;let s=r+1;for(;s<n&&/[A-Za-z0-9_]/.test(t[s]);)s+=1;const l=t.slice(r,s);if(e.has(l)){let c=s;for(;c<n&&/\s/.test(t[c]);)c+=1;if(c<n&&t[c]==="(")return!0}r=s-1}return!1}function u9(t,e,n,r,i){const s=new Map;for(const l of t.arcs||[]){const c=l.id,u=Array.isArray(l.bindings)?l.bindings:l.binding?[l.binding]:[],f=[];for(const h of u){const m=String(h),x=m.trim(),y=l9(x,i),w=g=>{if(!g||typeof g!="object")return!0;switch(g.type){case"funcall":return i.has(g.name)?(g.args||[]).every(w):!1;case"pair":return w(g.fst)&&w(g.snd);case"list":return(g.elements||[]).every(w);case"binop":return w(g.left)&&w(g.right);default:return!0}},T=()=>{let g=null;try{g=n(m)}catch{g=null}return!g||!w(g)?!1:(g.type==="var"&&g.varType==="bool"?f.push({kind:"bool",ast:{type:"boolVar",name:g.name,varType:"bool"}}):g.type==="var"&&g.varType==="pair"?f.push({kind:"pair",ast:{type:"pairVar",name:g.name,varType:"pair"}}):f.push({kind:"arith",ast:g}),!0)},k=()=>{try{const g=e(m);return f.push({kind:"pattern",ast:g}),!0}catch{return!1}};let _=!1;if(y?(_=T(),_||(_=k())):(_=k(),_||(_=T())),_)continue;const C=m==="T"?!0:m==="F"?!1:null;if(C!==null){f.push({kind:"bool",ast:{type:"boolLit",value:C}});continue}try{f.push({kind:"bool",ast:r(m,n)});continue}catch{}}f.length&&s.set(c,f)}return s}function Ry(t){return!!(t&&typeof t=="object"&&t.__pair__===!0&&"fst"in t&&"snd"in t)}async function Iy({transition:t,inputArcs:e,placesById:n,bindingAstsByArc:r,guardAst:i,parseArithmetic:s,evaluateBooleanPredicate:l,matchPattern:c,getTokensForPlace:u,evaluateArithmeticWithBindings:f,evaluateBooleanWithBindings:h,evaluatePatternLiteral:m,maxTokensPerPlace:x=20}){const y=[],w=async(T,k)=>{if(T>=e.length){if(!i)return{env:k,picks:y};try{return h(i,k||{},s)?{env:k,picks:y}:null}catch{try{return await l(i,k||{},s)?{env:k,picks:y}:null}catch{return null}}}const _=e[T],C=_.id,g=_.sourceId||_.source,S=n[g],b=u(S,x),N=r.get(C)||[],I=N.length||(_.weight?Math.max(1,_.weight|0):0);if(I===0)return w(T+1,k);if(b.length<I)return null;const A=new Array(b.length).fill(!1),F=async(M,R)=>{if(M>=I)return w(T+1,R);for(let z=0;z<b.length;z++){if(A[z])continue;A[z]=!0;const V=b[z];let j=!0,D=R;const G=N[M];if(G){const{kind:H,ast:O}=G;if(H==="pattern"){const $=c(O,V);if($===null)j=!1;else{for(const[W,K]of Object.entries($))if(D&&Object.prototype.hasOwnProperty.call(D,W)&&D[W]!==K){j=!1;break}j&&(D={...D||{},...$})}}else if(O&&(O.type==="var"||O.type==="boolVar"||O.type==="pairVar"))D&&Object.prototype.hasOwnProperty.call(D,O.name)&&D[O.name]!==V?j=!1:(typeof V=="boolean"&&O.varType&&O.varType!=="bool"&&(j=!1),typeof V=="number"&&O.varType&&O.varType!=="int"&&(j=!1),typeof V=="string"&&O.varType&&O.varType!=="string"&&(j=!1),Array.isArray(V)&&O.varType&&O.varType!=="list"&&(j=!1),Ry(V)&&O.varType&&O.varType!=="pair"&&(j=!1),j&&(D={...D||{},[O.name]:V}));else if(H==="arith")try{const $=f(O,R||{});(typeof V!="number"||$!==(V|0))&&(j=!1)}catch{j=!1}else if(H==="bool")try{const $=h(O,R||{},s);(typeof V!="bool"||$!==V)&&(j=!1)}catch{j=!1}else if(H==="pair")try{if(O.type==="pairLit"){const $=m(O,R||{});(!Ry(V)||JSON.stringify($)!==JSON.stringify(V))&&(j=!1)}}catch{j=!1}}if(j){y.push({arcId:_.id,srcId:g,tokenIndex:z,value:V,countFallback:!Array.isArray(S==null?void 0:S.valueTokens)});const H=await F(M+1,D);if(H)return H;y.pop()}A[z]=!1}return null};return F(0,k||{})};return w(0,{})}function p5(t){const e=new Set;function n(r){if(r)switch(r.type){case"var":e.add(r.name);break;case"pairPattern":n(r.fst),n(r.snd);break;case"listPattern":Array.isArray(r.elements)&&r.elements.forEach(n);break;case"tuplePattern":r.elements&&r.elements.forEach(n);break}}return n(t),Array.from(e)}function g5(t){const e=new Set;function n(r){if(r)switch(r.type){case"var":case"boolVar":case"pairVar":e.add(r.name);break;case"binop":case"cmp":n(r.left),n(r.right);break;case"unop":n(r.operand);break;case"call":r.args&&r.args.forEach(n);break;case"pairPattern":n(r.fst),n(r.snd);break;case"tuplePattern":r.elements&&r.elements.forEach(n);break;case"pairLit":n(r.fst),n(r.snd);break}}return n(t),Array.from(e)}function c9(t,e,n,r,i){const s=new Set;for(const u of i){const f=e.get(u.id)||[];for(const h of f){const{kind:m,ast:x}=h||{};m==="pattern"&&p5(x).forEach(w=>s.add(w))}}const l=n.get(r);if(l){const u=g5(l);for(const f of u)if(!s.has(f))return!0}const c=(t.arcs||[]).filter(u=>u.sourceId===r&&(u.targetType==="place"||!u.targetType));for(const u of c){const f=e.get(u.id)||[];if(f.length===0)return!0;for(const h of f){const{kind:m,ast:x}=h||{};if(m==="pattern"&&x.type==="var"&&!s.has(x.name))return!0}}return!1}function d9(t){const e=(t.places||[]).map(l=>({id:l.id,label:l.label||"",tokens:Number(Array.isArray(l.valueTokens)?l.valueTokens.length:l.tokens||0),x:Number(l.x||0),y:Number(l.y||0),name:l.name||"",type:"place",valueTokens:Array.isArray(l.valueTokens)?[...l.valueTokens]:void 0})),n=(t.transitions||[]).map(l=>({id:l.id,label:l.label||"",x:Number(l.x||0),y:Number(l.y||0),name:l.name||"",type:"transition",guard:l.guard,action:l.action})),r=new Set(e.map(l=>l.id)),i=new Set(n.map(l=>l.id)),s=(t.arcs||[]).map(l=>{const c=l.sourceId||l.source,u=l.targetId||l.target,f=r.has(c)?"place":i.has(c)?"transition":l.sourceType||"place",h=r.has(u)?"place":i.has(u)?"transition":l.targetType||"transition",m=l.type||`${f}-to-${h}`;return{id:l.id,sourceId:c,targetId:u,source:c,target:u,weight:Number(l.weight||1),sourceType:f,targetType:h,type:m,bindings:Array.isArray(l.bindings)?[...l.bindings]:l.binding?[l.binding]:[]}});return{places:e,transitions:n,arcs:s}}let Sr=[],f9=1;const La=new Map;let Ly=0,Rh=null;const cl=typeof Worker<"u",og=typeof SharedArrayBuffer<"u",pn={poolSize:0,idleTimeoutMs:3e5,prewarmOnAlgebraicMode:!0,solverTimeoutMs:1e4};function h9(){try{if(typeof globalThis<"u"){const t=globalThis;t.__Z3_SETTINGS__={...t.__Z3_SETTINGS__||{},...pn}}}catch{}}function bo(t){return Math.max(0,(Number.isFinite(t)?t:0)|0)}function p9(t={}){typeof t.poolSize=="number"&&(pn.poolSize=bo(t.poolSize)),typeof t.idleTimeoutMs=="number"&&(pn.idleTimeoutMs=Math.max(1e3,t.idleTimeoutMs|0)),typeof t.prewarmOnAlgebraicMode=="boolean"&&(pn.prewarmOnAlgebraicMode=t.prewarmOnAlgebraicMode),typeof t.solverTimeoutMs=="number"&&(pn.solverTimeoutMs=Math.max(0,t.solverTimeoutMs|0)),g9()}function m5(){if(!cl)throw new Error("Z3 worker pool unavailable in this environment");if(!og)throw new Error("SharedArrayBuffer not available. COOP/COEP headers may not be set correctly.");const t=new Worker(new URL(""+new URL("z3.worker-1562d2b4.js",import.meta.url).href,self.location),{type:"module"});return t.onerror=e=>{console.error("Z3 worker error:",e)},t.onmessage=({data:e})=>{const{id:n,ok:r,result:i,error:s}=e||{},l=La.get(n);l&&(La.delete(n),r?l.resolve(i):l.reject(new Error(s)),y5())},t}function g9(){if(h9(),!cl)return;const t=bo(pn.poolSize);for(;Sr.length<t;)Sr.push(m5());for(;Sr.length>t;){const e=Sr.pop();try{e.terminate()}catch{}}}function m9(){if(!cl)throw new Error("Z3 worker pool unavailable in this environment");if(bo(pn.poolSize)<=0)throw new Error("Z3 worker pool disabled");Sr.length===0&&Sr.push(m5());const e=Sr[Ly%Sr.length];return Ly++,e}function y5(){cl&&(pn.idleTimeoutMs<=0||(Rh&&clearTimeout(Rh),Rh=setTimeout(()=>{const t=bo(pn.poolSize);for(;Sr.length>t;){const e=Sr.pop();try{e.terminate()}catch{}}},pn.idleTimeoutMs)))}function Eo(t,...e){const n=m9(),r=f9++;return new Promise((i,s)=>{const l=setTimeout(()=>{La.delete(r),s(new Error(`Z3 worker operation "${t}" timed out after ${pn.solverTimeoutMs}ms`))},pn.solverTimeoutMs||1e4);La.set(r,{resolve:c=>{clearTimeout(l),i(c)},reject:c=>{clearTimeout(l),s(c)}});try{n.postMessage({id:r,op:t,args:e})}catch(c){clearTimeout(l),La.delete(r),s(c);return}y5()})}function Y0(){return bo(pn.poolSize)}function K0(){return cl&&og&&bo(pn.poolSize)>0}function y9(){return og}const v9=t=>Eo("parseBooleanExpr",t),Q0=(t,e,n)=>Eo("evaluateBooleanPredicate",t,e),x9=(t,e,n)=>Eo("evaluateArithmeticWithBindings",t,e),w9=(t,e)=>Eo("evaluateAction",t,e),_9=(t,e)=>Eo("solveEquation",t,e),S9=(t,e,n)=>Eo("solveInequality",t,e,n),Fa=Object.freeze(Object.defineProperty({__proto__:null,evaluateAction:w9,evaluateArithmeticWithBindings:x9,evaluateBooleanPredicate:Q0,getConfiguredPoolSize:Y0,isSharedArrayBufferAvailable:y9,isWorkerPoolEnabled:K0,parseBooleanExpr:v9,setZ3WorkerConfig:p9,solveEquation:_9,solveInequality:S9},Symbol.toStringTag,{value:"Module"})),Ih=async(t,e,n)=>{try{if((typeof K0=="function"?K0():!1)&&typeof Q0=="function")try{return await Q0(t,e,n)}catch{}}catch{}return Ew(t,e,n)},Fy=t=>JSON.parse(JSON.stringify(t||{places:[],transitions:[],arcs:[]})),k9=(t,e)=>{const n=new Set,r=l=>{if(l)switch(l.type){case"boolVar":case"pairVar":n.add(l.name);break;case"and":case"or":r(l.left),r(l.right);break;case"not":r(l.expr);break;case"cmp":i(l.left),i(l.right);break}},i=l=>{l&&(l.type==="var"||l.type==="boolVar"||l.type==="pairVar"?n.add(l.name):l.type==="bin"?(i(l.left),i(l.right)):l.type==="pairLit"&&(i(l.fst),i(l.snd)))};r(t);const s=new Set(Object.keys(e||{}));return Array.from(n).filter(l=>!s.has(l))},jy=t=>{try{const e=Array.isArray(t==null?void 0:t.transitions)?t.transitions.slice():[],n=Array.isArray(t==null?void 0:t.arcs)?t.arcs.slice():[];e.sort((s,l)=>String(s.id).localeCompare(String(l.id))),n.sort((s,l)=>String(s.id).localeCompare(String(l.id)));const r=e.map(s=>`${s.id}|g:${String(s.guard||"")}|a:${String(s.action||"")}`).join(";"),i=n.map(s=>`${s.id}|b:${Array.isArray(s.bindings)?s.bindings.join(","):s.binding?String(s.binding):""}`).join(";");return`${r}||${i}`}catch{return String(Math.random())}};class T9 extends d5{constructor(){super(),this.lastEnabledTransitions=[],this.cache={guardAstByTransition:new Map,bindingAstsByArc:new Map},this._cacheSignature=null,this._config={maxTokensPerPlace:1/0},this._enabledCache=new Map}getType(){return"algebraic"}async initializeSpecific(e,n={}){this.lastEnabledTransitions=[],this._enabledCache.clear(),this._cacheSignature=null,this.petriNet=Fy(e),n&&typeof n.maxTokensPerPlace=="number"&&n.maxTokensPerPlace>=0?this._config.maxTokensPerPlace=n.maxTokensPerPlace|0:this._config.maxTokensPerPlace=1/0,await this.buildCaches(),await this.checkTransitionStateChanges()}async buildCaches(){this.cache.guardAstByTransition.clear(),this.cache.bindingAstsByArc.clear(),this.cache.guardAstByTransition=a9(this.petriNet,jt,xo,bw),this.cache.bindingAstsByArc=u9(this.petriNet,i5,jt,xo,o9),this._cacheSignature=jy(this.petriNet)}getStatus(){var e,n,r;return{isInitialized:this.isInitialized,hasPyodide:!1,hasSimulator:!0,hasPetriNet:!!this.petriNet,simulationMode:this.simulationMode,petriNetSize:this.petriNet?{places:((e=this.petriNet.places)==null?void 0:e.length)||0,transitions:((n=this.petriNet.transitions)==null?void 0:n.length)||0,arcs:((r=this.petriNet.arcs)==null?void 0:r.length)||0}:null}}async setSimulationMode(e){if(e==="single"||e==="maximal")this.simulationMode=e;else throw new Error("Mode must be 'single' or 'maximal'")}_outputBindingsTypeCompatible(e,n){return i9(this.petriNet,this.cache,e,n)}_invalidateEnabledCache(e){if(!e||e.size===0)return;const n=this.petriNet.arcs||[];for(const r of n){const i=r.sourceId||r.source;if((r.type==="place-to-transition"||r.sourceType==="place")&&e.has(i)){const l=String(r.targetId||r.target);this._enabledCache.delete(l)}}}_clearEnabledCache(){this._enabledCache.clear()}async updateSpecific(e){const r=jy(e)!==this._cacheSignature;this.petriNet=Fy(e),r&&await this.buildCaches(),this._clearEnabledCache(),await this.checkTransitionStateChanges()}async getEnabledTransitionsSpecific(){const e=Array.isArray(this.petriNet.transitions)?this.petriNet.transitions:[];if(e.length===0)return[];const n=[];for(let i=0;i<e.length;i++){const s=String(e[i].id);this._enabledCache.has(s)||n.push(e[i])}if(n.length>0){const i=typeof Y0=="function"?Number(Y0()||0):0,s=Math.max(1,Math.min(n.length,i>0?i:1));if(s<=1)for(const l of n)try{const c=await this.isTransitionEnabled(l.id);this._enabledCache.set(String(l.id),c)}catch{this._enabledCache.set(String(l.id),!1)}else{const l=new Array(n.length).fill(!1);let c=0;const u=async()=>{for(;;){const h=c++;if(h>=n.length)break;const m=n[h];try{const x=await this.isTransitionEnabled(m.id);l[h]=x}catch{}}},f=Array.from({length:s},()=>u());await Promise.all(f);for(let h=0;h<n.length;h++)this._enabledCache.set(String(n[h].id),l[h])}}const r=[];for(const i of e){const s=String(i.id);this._enabledCache.get(s)===!0&&r.push(s)}return r}async checkForUnboundVariables(e,n){return c9(this.petriNet,this.cache.bindingAstsByArc,this.cache.guardAstByTransition,e,n)}extractVariablesFromPattern(e){return p5(e)}extractVariablesFromExpression(e){return g5(e)}async isTransitionEnabled(e){if(!this.isInitialized)return!1;const n=(this.petriNet.transitions||[]).find(u=>u.id===e);if(!n)return!1;const r=(this.petriNet.arcs||[]).filter(u=>(u.targetId===e||u.target===e)&&(u.sourceType==="place"||!u.sourceType));if(r.length===0)return!0;if(await this.checkForUnboundVariables(e,r))return pe.debug("Transition disabled due to unbound variables:",e),!1;const s=this.cache.guardAstByTransition.get(e),l=Object.fromEntries((this.petriNet.places||[]).map(u=>[u.id,u])),c=await Iy({transition:n,inputArcs:r,placesById:l,bindingAstsByArc:this.cache.bindingAstsByArc,guardAst:s,parseArithmetic:jt,evaluateBooleanPredicate:Ih,matchPattern:Ey,getTokensForPlace:Py,evaluateArithmeticWithBindings:nr,evaluateBooleanWithBindings:uo,evaluatePatternLiteral:xr,maxTokensPerPlace:this._config.maxTokensPerPlace});return c?this._outputBindingsTypeCompatible(e,c.env||{}):!1}async stepSimulationSpecific(){return this.getCurrentState()}async fireTransitionSpecific(e,n={}){const r=n.skipEnabledCheck||!1,i=r?[]:await this.getEnabledTransitionsSpecific(),s=(this.petriNet.transitions||[]).find(w=>w.id===e);if(!s)return this.getCurrentState();const l=(this.petriNet.arcs||[]).filter(w=>(w.targetId===e||w.target===e)&&(w.sourceType==="place"||!w.sourceType)),c=(this.petriNet.arcs||[]).filter(w=>(w.sourceId===e||w.source===e)&&(w.targetType==="place"||!w.targetType)),u=Object.fromEntries((this.petriNet.places||[]).map(w=>[w.id,w])),f=this.cache.guardAstByTransition.get(e),h=await Iy({transition:s,inputArcs:l,placesById:u,bindingAstsByArc:this.cache.bindingAstsByArc,guardAst:f,parseArithmetic:jt,evaluateBooleanPredicate:Ih,matchPattern:Ey,getTokensForPlace:Py,evaluateArithmeticWithBindings:nr,evaluateBooleanWithBindings:uo,evaluatePatternLiteral:xr,maxTokensPerPlace:this._config.maxTokensPerPlace});if(!h)throw new Error(`Transition ${e} is not enabled`);let m=h.env||{};const x=h.picks||[];if(f&&k9(f,m).length>0)try{if(!await Ih(f,m,jt))throw new Error("Guard unsatisfied under any extension")}catch{}const y=new Set;for(const w of x)y.add(w.srcId);for(const w of c)y.add(w.targetId||w.target);if(h5(x,u),t9(c,this.cache.bindingAstsByArc,m,u,{evaluateArithmeticWithBindings:nr,evaluateBooleanWithBindings:uo,evaluatePatternLiteral:xr,parseArithmetic:jt}),s.action&&typeof s.action=="string")try{const w=Nw(s.action,m,jt)}catch{}if(this._invalidateEnabledCache(y),!r){await this.checkTransitionStateChanges();const w=this.getCurrentState();this.emitTransitionFired({transitionId:e,newPetriNet:w});const T=await this.getEnabledTransitionsSpecific();return this.emitTransitionsChanged({enabled:T,previouslyEnabled:i}),w}return this.getCurrentState()}getCurrentState(){return d9(this.petriNet)}async checkTransitionStateChanges(){if(this.isInitialized)try{const e=await this.getEnabledTransitionsSpecific();if(JSON.stringify([...e].sort())!==JSON.stringify([...this.lastEnabledTransitions].sort())){const r=[...this.lastEnabledTransitions];this.lastEnabledTransitions=[...e],this.emitTransitionsChanged({enabled:e,previouslyEnabled:r})}}catch{}}resetSpecific(){this.lastEnabledTransitions=[],this.cache.guardAstByTransition.clear(),this.cache.bindingAstsByArc.clear(),this._cacheSignature=null,this._config.maxTokensPerPlace=1/0,this._clearEnabledCache()}}class C9{static createSimulator(e){switch(e){case"pt":return new r9;case"algebraic":return new T9;default:throw new Error(`Unknown net mode: ${e}`)}}static getAvailableTypes(){return["pt","algebraic"]}static isSupported(e){return this.getAvailableTypes().includes(e)}}const Oy=async()=>{try{await new Promise(t=>setTimeout(t,0))}catch{}try{typeof requestAnimationFrame<"u"&&await new Promise(t=>requestAnimationFrame(()=>t()))}catch{}},b9=t=>{const e=new Set;if(!t||!Array.isArray(t.transitions))return e;const n=Array.isArray(t.arcs)?t.arcs:[],r=Array.isArray(t.places)?t.places:[],i=new Set(r.map(s=>String(s.id)));for(const s of t.transitions){const l=String(s.id);let c=!1,u=!1;for(const f of n){const h=String(f.sourceId||f.source),m=String(f.targetId||f.target);if(m===l&&h!==l&&i.has(h)&&(c=!0),h===l&&m!==l&&i.has(m)&&(u=!0),c&&u)break}!c&&!u&&e.add(l)}return e},E9=(t,e,n)=>{const r=new Map;for(const c of t)r.set(c,new Set);for(const c of e||[]){const u=c.targetId||c.target,f=c.sourceId||c.source;(c.type==="place-to-transition"||c.sourceType==="place")&&r.has(u)&&r.get(u).add(f)}const i=t.slice();for(let c=i.length-1;c>0;c--){const u=Math.random()*(c+1)|0,f=i[c];i[c]=i[u],i[u]=f}const s=new Set,l=[];for(const c of i){const u=r.get(c)||new Set;let f=!0;for(const h of u)if(s.has(h)){f=!1;break}if(f){l.push(c);for(const h of u)s.add(h);if(n>0&&l.length>=n)break}}return l},P9=(t=[])=>t.map(e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){if(e.id)return e.id;if(e.get)return e.get("id")}return String(e)}).filter(Boolean),N9=async({simulator:t,mode:e="single",maxSteps:n=1e5,timeBudgetMs:r=3e4,yieldEvery:i=100,onProgress:s,shouldCancel:l,batchMax:c=0,progressEveryMs:u=0,yieldEveryMs:f=0})=>{const h=typeof performance<"u"&&performance.now?()=>performance.now():()=>Date.now(),m=h();let x=0,y=m,w=m,T=-1;const k=b=>{if(!s)return;const N=b-m,I=u>0?Math.floor(N/u):0;if(I!==T){T=I;try{s({steps:x,elapsedMs:N})}catch{}}},_=b9(t.petriNet||{}),C=async()=>{const b=await t.getEnabledTransitions();return P9(b).filter(I=>!_.has(String(I)))},g=async()=>{if(l&&l())return!1;const b=h(),N=b-m;if(i>0&&x%i===0){const I=h();k(I),await Oy();const A=h();return w=A,y=A,u>0&&k(A),!(r>0&&A-m>r||l&&l())}if(u>0&&b-y>=u&&(k(b),y=b),f>0&&b-w>=f){await Oy();const I=h();if(w=I,u>0&&I-y>=u&&(k(I),y=I),r>0&&I-m>r||l&&l())return!1}return!(r>0&&N>r||l&&l())};let S=!0;for(;S&&x<n&&!(l&&l());){const b=await C();if(!b||b.length===0)break;if(e==="maximal"){const N=t.petriNet||{},I=c>0?c:Number.POSITIVE_INFINITY;let A=E9(b,N.arcs||[],I);if(!A||A.length===0){const F=b[Math.floor(Math.random()*b.length)];A=F?[F]:[]}if(l&&l()){S=!1;break}await Promise.all(A.map(F=>t.fireTransition(F,{skipEnabledCheck:!0}))),x+=A.length,S=await g()}else{const N=b[Math.floor(Math.random()*b.length)];await t.fireTransition(N),x+=1,S=await g()}}if(s)try{s({steps:x,elapsedMs:h()-m})}catch{}return{petriNet:t.petriNet||null,steps:x}},Dy=(t,e={})=>{pe.debug("determineNetMode called with:",{petriNet:t,options:e});const n=(e==null?void 0:e.netMode)||(t==null?void 0:t.netMode);if(pe.debug("Found netMode from options/petriNet:",n),n){const r=n==="algebraic-int"?"algebraic":n;return pe.debug("Using configured netMode:",r),r}return pe.debug("No configured netMode, detecting from content"),v5(t)},v5=t=>{const e=t||{},n=Array.isArray(e.transitions)?e.transitions:[],r=Array.isArray(e.arcs)?e.arcs:[],i=Array.isArray(e.places)?e.places:[];pe.debug("Net mode detection:",{places:i,transitions:n,arcs:r});for(const s of n){if(typeof s.guard=="string"&&s.guard.trim().length>0)return pe.debug("Found guard, using algebraic mode"),"algebraic";if(typeof s.action=="string"&&s.action.trim().length>0)return pe.debug("Found action, using algebraic mode"),"algebraic"}for(const s of r){const l=Array.isArray(s.bindings)?s.bindings:s.binding?[s.binding]:[];if(pe.debug("Checking arc bindings:",l),l.some(u=>typeof u=="string"&&(/:[ ]*(integer|boolean)/i.test(u)||u==="T"||u==="F"||/[+\-*/()]/.test(u))))return pe.debug("Found algebraic binding, using algebraic mode"),"algebraic"}return i.some(s=>Array.isArray(s.valueTokens)&&s.valueTokens.length>0)?(pe.debug("Found valueTokens, using algebraic mode"),"algebraic"):(pe.debug("Using P/T mode"),"pt")};class A9{constructor(){this.currentSimulator=null,this._ready=!1,this.netMode=null,this.eventBus=null,this.pendingListeners=new Map}async initialize(e,n={}){try{pe.debug("SimulatorCore.initialize called with:",{petriNet:e,options:n});const r=Dy(e,n);return this.currentSimulator=C9.createSimulator(r),this.netMode=r,this.eventBus&&this.currentSimulator.setEventBus(this.eventBus),await this.currentSimulator.initialize(e,n),this._ready=!0,this.setupPendingListeners(),pe.debug(`Simulator initialized with ${r} simulator`),{success:!0,netMode:r,simulatorType:this.currentSimulator.getType()}}catch(r){throw console.error("Failed to initialize simulator:",r),this._ready=!1,this.currentSimulator=null,r}}async update(e){if(!this.currentSimulator)return{success:!0};try{return await this.currentSimulator.update(e),{success:!0}}catch(n){throw console.error("Failed to update simulator:",n),n}}async getEnabledTransitions(){if(!this.currentSimulator)return[];try{return await this.currentSimulator.getEnabledTransitions()}catch(e){return console.error("Failed to get enabled transitions:",e),[]}}async fireTransition(e){if(!this.currentSimulator)throw new Error("Simulator not initialized");try{return await this.currentSimulator.fireTransition(e)}catch(n){throw console.error(`Failed to fire transition ${e}:`,n),n}}async stepSimulation(){if(!this.currentSimulator)throw new Error("Simulator not initialized");try{const e=await this.currentSimulator.getEnabledTransitions();if(!e||e.length===0)return this.currentSimulator.petriNet||null;const n=e[Math.floor(Math.random()*e.length)],r=typeof n=="string"?n:n&&n.id?n.id:String(n);return await this.currentSimulator.fireTransition(r)}catch(e){throw console.error("Failed to step simulation:",e),e}}async runToCompletion({mode:e="single",maxSteps:n=1e5,timeBudgetMs:r=3e4,yieldEvery:i=100,onProgress:s,shouldCancel:l,batchMax:c=0,progressEveryMs:u=0,yieldEveryMs:f=0}={}){if(!this.currentSimulator)throw new Error("Simulator not initialized");const h=this.currentSimulator.eventBus||null;try{this.currentSimulator.setEventBus&&this.currentSimulator.setEventBus(null)}catch{}try{return this.currentSimulator.setSimulationMode&&(this.currentSimulator.simulationMode=e),await N9({simulator:this.currentSimulator,mode:e,maxSteps:n,timeBudgetMs:r,yieldEvery:i,onProgress:s,shouldCancel:l,batchMax:c,progressEveryMs:u,yieldEveryMs:f})}finally{try{this.currentSimulator.setEventBus&&this.currentSimulator.setEventBus(h)}catch{}}}reset(){this.currentSimulator&&this.currentSimulator.reset(),this.currentSimulator=null,this._ready=!1,this.netMode=null,this.pendingListeners.clear()}deactivateSimulation(){this._active=!1}activateSimulation(e=!1){if(!this.currentSimulator)throw new Error("Simulator not initialized");pe.debug(`Simulation activated (continuous: ${e})`)}async isReady(){return this._ready&&this.currentSimulator&&this.currentSimulator.isReady()}getSimulatorStatus(){var e;return{isReady:this._ready,netMode:this.netMode,simulatorType:((e=this.currentSimulator)==null?void 0:e.getType())||"none",simulatorStatus:{simulator:this.currentSimulator}}}getSimulatorType(){var e;return((e=this.currentSimulator)==null?void 0:e.getType())||"none"}getSimulationMode(){var e;return((e=this.currentSimulator)==null?void 0:e.simulationMode)||"single"}setSimulationMode(e){this.currentSimulator&&(this.currentSimulator.simulationMode=e)}setEventBus(e){this.eventBus=e,this.currentSimulator&&this.currentSimulator.setEventBus(e)}__queueListener(e,n){this.pendingListeners.has(e)||this.pendingListeners.set(e,[]),this.pendingListeners.get(e).push(n)}setupPendingListeners(){if(!(!this.currentSimulator||!this.eventBus)){for(const[e,n]of this.pendingListeners)for(const r of n)this.eventBus.on(e,r);this.pendingListeners.clear()}}determineNetMode(e,n){return Dy(e,n)}detectNetModeFromContent(e){return v5(e)}}const pi=new A9;function M9(){try{return typeof window>"u"||typeof Worker>"u"||typeof process<"u"&&process.env&&{}.JEST_WORKER_ID?null:new Worker(new URL(""+new URL("simulation.worker-04867299.js",import.meta.url).href,self.location),{type:"module"})}catch(t){return console.error("Failed to create simulation worker:",t),null}}var R9="Expected a function",zy=0/0,I9="[object Symbol]",L9=/^\s+|\s+$/g,F9=/^[-+]0x[0-9a-f]+$/i,j9=/^0b[01]+$/i,O9=/^0o[0-7]+$/i,D9=parseInt,z9=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,B9=typeof self=="object"&&self&&self.Object===Object&&self,U9=z9||B9||Function("return this")(),G9=Object.prototype,V9=G9.toString,W9=Math.max,$9=Math.min,Lh=function(){return U9.Date.now()};function H9(t,e,n){var r,i,s,l,c,u,f=0,h=!1,m=!1,x=!0;if(typeof t!="function")throw new TypeError(R9);e=By(e)||0,Z0(n)&&(h=!!n.leading,m="maxWait"in n,s=m?W9(By(n.maxWait)||0,e):s,x="trailing"in n?!!n.trailing:x);function y(N){var I=r,A=i;return r=i=void 0,f=N,l=t.apply(A,I),l}function w(N){return f=N,c=setTimeout(_,e),h?y(N):l}function T(N){var I=N-u,A=N-f,F=e-I;return m?$9(F,s-A):F}function k(N){var I=N-u,A=N-f;return u===void 0||I>=e||I<0||m&&A>=s}function _(){var N=Lh();if(k(N))return C(N);c=setTimeout(_,T(N))}function C(N){return c=void 0,x&&r?y(N):(r=i=void 0,l)}function g(){c!==void 0&&clearTimeout(c),f=0,r=u=i=c=void 0}function S(){return c===void 0?l:C(Lh())}function b(){var N=Lh(),I=k(N);if(r=arguments,i=this,u=N,I){if(c===void 0)return w(u);if(m)return c=setTimeout(_,e),y(u)}return c===void 0&&(c=setTimeout(_,e)),l}return b.cancel=g,b.flush=S,b}function Z0(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function X9(t){return!!t&&typeof t=="object"}function Y9(t){return typeof t=="symbol"||X9(t)&&V9.call(t)==I9}function By(t){if(typeof t=="number")return t;if(Y9(t))return zy;if(Z0(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Z0(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(L9,"");var n=j9.test(t);return n||O9.test(t)?D9(t.slice(2),n?2:8):F9.test(t)?zy:+t}var K9=H9;const Q9=il(K9),Z9=({elements:t,netMode:e,simulatorCore:n,setElements:r,updateHistory:i,setEnabledTransitionIds:s,setIsSimulatorReady:l,setSimulationError:c,latestElementsRef:u,forceResetCounter:f})=>{B.useEffect(()=>{u.current=t},[t,u]),B.useEffect(()=>{try{n.setEventBus(ca)}catch{}},[n]),B.useEffect(()=>{(async()=>{var w,T;if(!(t&&t.places&&t.transitions&&t.arcs&&t.places.length>0&&t.transitions.length>0&&t.arcs.length>0)){try{await((w=n.deactivateSimulation)==null?void 0:w.call(n)),await((T=n.reset)==null?void 0:T.call(n)),s([]),l(!1),c(null)}catch(k){pe.error("Failed to reset simulator:",k)}return}try{pe.debug("Simulator force reset counter:",f),pe.debug("Initializing/updating simulator",{elements:t,netMode:e}),await n.initialize(t,{netMode:e})}catch(k){pe.error("Failed to initialize simulator:",k),s([]),l(!1);return}try{await n.update(u.current)}catch(k){pe.error("Failed to update simulator:",k),s([]),l(!1),c("Failed to update simulator");return}try{if(n.isReady&&await n.isReady()){const k=await n.getEnabledTransitions();s(k||[]),l(k&&k.length>0)}else{const k=e9(u.current),_=(k==null?void 0:k.enabledTransitions)||[];s(_),l(_.length>0)}c(k=>k==="Failed to update simulator"?null:k)}catch(k){pe.error("Failed to compute enabled transitions:",k),s([]),l(!1),c("Failed to update simulator")}})()},[t,e,n,f,s,l,c,u]),B.useEffect(()=>{const x=w=>{s(w.enabled||[]),l(w.hasEnabled);try{typeof window<"u"&&(window.__ENABLED_TRANSITIONS__=Array.isArray(w.enabled)?w.enabled:[])}catch{}},y=w=>{try{typeof window<"u"&&(window.__LAST_FIRED_TRANSITION_ID__=w.transitionId||null)}catch{}w.newPetriNet&&(r(w.newPetriNet),u.current=w.newPetriNet,i&&i(w.newPetriNet,!0))};return ca.on(no.transitionsChanged,x),ca.on(no.transitionFired,y),()=>{ca.off(no.transitionsChanged,x),ca.off(no.transitionFired,y)}},[r,i,s,l,u]),B.useEffect(()=>()=>{try{n.deactivateSimulation()}catch{}},[n]);const h=B.useCallback(async()=>{try{if(n.isReady&&await n.isReady()){const x=await n.getEnabledTransitions();s(x||[]);const y=Array.isArray(x)&&x.length>0;return l(y),x||[]}return s([]),l(!1),[]}catch(x){return console.error("Error refreshing enabled transitions:",x),c("Failed to refresh enabled transitions"),[]}},[n,s,l,c]),m=B.useMemo(()=>Q9(h,100),[h]);return B.useEffect(()=>()=>{m.cancel()},[m]),{refreshEnabledTransitions:h,debouncedRefresh:m}};class q9{constructor(){this.conflictCache=new Map}areTransitionsInConflict(e,n,r,i){const s=`${e}-${n}`,l=`${n}-${e}`;if(this.conflictCache.has(s))return this.conflictCache.get(s);if(this.conflictCache.has(l))return this.conflictCache.get(l);const c=this._requiredCategories(e,i),u=this._requiredCategories(n,i);let f=!1;for(const[h,m]of c.entries()){const x=u.get(h);if(x&&(m.has("int")&&x.has("int")||m.has("bool")&&x.has("bool"))){f=!0;break}}return this.conflictCache.set(s,f),f}_requiredCategories(e,n){const r=new Map;for(const i of n){const s=i.sourceId||i.source;if(!((i.targetId||i.target)===e&&(i.sourceType==="place"||i.type==="place-to-transition")))continue;const c=Array.isArray(i.bindings)?i.bindings:i.binding?[i.binding]:[];r.has(s)||r.set(s,new Set);const u=r.get(s);for(const f of c){const h=String(f||"");/:[ ]*boolean/i.test(h)||h==="T"||h==="F"?u.add("bool"):u.add("int")}c.length===0&&u.add("int")}return r}findNonConflictingTransitions(e,n,r){if(e.length<=1)return e;this.conflictCache.clear();const i=[];for(let s=e.length;s>=1;s--){const l=this.getCombinations(e,s);for(const c of l)this.isNonConflictingSet(c,n,r)&&i.push(c);if(i.length>0)return i}return e.map(s=>[s])}isNonConflictingSet(e,n,r){for(let i=0;i<e.length;i++)for(let s=i+1;s<e.length;s++)if(this.areTransitionsInConflict(e[i].id,e[s].id,n,r))return!1;return!0}getCombinations(e,n){if(n===0)return[[]];if(n>e.length)return[];const r=[],i=(s,l)=>{if(l.length===n){r.push([...l]);return}for(let c=s;c<e.length;c++)l.push(e[c]),i(c+1,l),l.pop()};return i(0,[]),r}getInputPlaces(e,n,r){const i=[];for(const s of r){const l=s.sourceId||s.source,c=s.targetId||s.target;if(s.sourceType==="place"&&c===e||s.type==="place-to-transition"&&c===e){const f=n.find(h=>h.id===l);f&&i.push(f)}}return i}getOutputPlaces(e,n,r){const i=[];for(const s of r){const l=s.sourceId||s.source,c=s.targetId||s.target;if(s.targetType==="place"&&l===e||s.type==="transition-to-place"&&l===e){const f=n.find(h=>h.id===c);f&&i.push(f)}}return i}clearCache(){this.conflictCache.clear()}getCacheStats(){return{size:this.conflictCache.size,keys:Array.from(this.conflictCache.keys())}}}const J9=1e3,Tc=t=>(t||[]).map(e=>typeof e=="string"?e:e&&typeof e=="object"?e.id??(e.get?e.get("id"):void 0):String(e)).filter(Boolean),x5=t=>(t.current||(t.current=new q9),t.current),e7=({simulatorCore:t,setElements:e,updateHistory:n,clearError:r,refreshEnabledTransitions:i,setSimulationError:s,latestElementsRef:l})=>async c=>{try{if(t.getSimulatorType&&t.getSimulatorType()==="none")throw new Error("Simulator not initialized. Please wait for initialization to complete.");await t.activateSimulation(!1);const u=await t.fireTransition(c);if(!u||typeof u!="object")throw new Error("Invalid Petri net returned from simulator");if(!u.places||!Array.isArray(u.places)||!u.transitions||!Array.isArray(u.transitions)||!u.arcs||!Array.isArray(u.arcs))throw new Error("Incomplete Petri net structure returned from simulator");const f=JSON.parse(JSON.stringify(u));e(f),l.current=f,n&&n(f,!0),r(),await i(),setTimeout(()=>{try{t.activateSimulation()}catch{}},50)}catch(u){console.error(`Error firing transition ${c}:`,u),s(u.message||`Failed to fire transition ${c}.`)}},t7=({simulatorCore:t,handleFireTransition:e,conflictResolverRef:n,latestElementsRef:r,refreshEnabledTransitions:i,setSimulationError:s,stopAllSimulations:l})=>async()=>{var c,u;try{if(t.getSimulatorType&&t.getSimulatorType()==="none")throw new Error("Simulator not initialized. Please wait for initialization to complete.");let f="single";try{f=t.getSimulationMode?t.getSimulationMode():"single"}catch{}if(f==="maximal"){const y=await t.getEnabledTransitions();if(!y||y.length===0)return;const w=x5(n),T=Tc(y).map(S=>({id:S})),k=w.findNonConflictingTransitions(T,((c=r.current)==null?void 0:c.places)||[],((u=r.current)==null?void 0:u.arcs)||[]),_=Array.isArray(k)?k:Array.from(k||[]),C=_.length?_[Math.floor(Math.random()*_.length)]:[],g=Array.isArray(C)?C:C?[C]:[];for(const S of g)await e(S.id);await i();return}const h=await t.getEnabledTransitions();if(!h||h.length===0)return;const m=Tc(h),x=m[Math.floor(Math.random()*m.length)];await e(x)}catch(f){console.error("Error in step simulation:",f),s("Error during simulation step: "+(f.message||"Unknown error")),l()}},n7=t=>new Promise(e=>setTimeout(e,t)),r7=({simulatorCore:t,isContinuousSimulatingRef:e,isRunningRef:n,setIsContinuousSimulating:r,setEnabledTransitionIds:i,stepSimulation:s,refreshEnabledTransitions:l,setSimulationError:c})=>async()=>{if(!(e.current||n.current))try{await t.activateSimulation();const u=await t.getEnabledTransitions();if(!u||u.length===0)return;r(!0),e.current=!0;const f=Tc(u);for(i(f);e.current;){await s();const h=await l();if(!h||h.length===0)break;await n7(J9)}}catch(u){console.error("Error starting continuous simulation:",u),c("Failed to start continuous simulation")}finally{e.current=!1,r(!1);try{t.deactivateSimulation()}catch{}}},i7=(t,e)=>{const n=Number(t);return!Number.isFinite(n)||n<=0?null:Math.max(1,Math.min(e,Math.floor(n)))},s7=()=>{try{const t=window.__Z3_SETTINGS__||{};return{poolSize:Number.isFinite(Number(t.poolSize))?Number(t.poolSize):0,idleTimeoutMs:t.idleTimeoutMs,prewarmOnAlgebraicMode:t.prewarmOnAlgebraicMode,solverTimeoutMs:t.solverTimeoutMs}}catch{return{poolSize:0}}},o7=({simulationSettings:t})=>{let e=!1;try{e=!!window.__PETRI_NET_NON_VISUAL_RUN__}catch{}const n=typeof window<"u"&&window.__PETRI_NET_SETTINGS__?window.__PETRI_NET_SETTINGS__:{};!e&&(t!=null&&t.useNonVisualRun)&&(e=!0);const r=t==null?void 0:t.batchMode,i=r!==void 0?!!r:!!(n!=null&&n.batchMode);i&&(e=!0);const s=!!((t==null?void 0:t.limitIterations)??(n==null?void 0:n.limitIterations)),l=i7((t==null?void 0:t.maxIterations)??(n==null?void 0:n.maxIterations),1e6);return{useNonVisual:e,batchMode:i,limitIterationsFlag:s,maxIterations:l}},a7=({simulatorCore:t,isContinuousSimulatingRef:e,isRunningRef:n,setIsRunning:r,setIsContinuousSimulating:i,refreshEnabledTransitions:s,simulationSettings:l,ensureWorker:c,setElements:u,latestElementsRef:f,updateHistory:h,setSimulationError:m,conflictResolverRef:x,elements:y,handleFireTransition:w,setCompletionStats:T,netMode:k})=>async()=>{if(!(e.current||n.current))try{await t.activateSimulation(!1),r(!0),i(!1),n.current=!0,await s();const{useNonVisual:_,batchMode:C,limitIterationsFlag:g,maxIterations:S}=o7({simulationSettings:l}),b=2e5,N=g?S??b:b;let I=null,A=!1;const F=async D=>{try{if(I||(I=s7()),Number(I.poolSize||0)>=D)return;(await Br(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url)).setZ3WorkerConfig({...I,poolSize:D}),A=!0}catch{}},M=async()=>{if(A){try{(await Br(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url)).setZ3WorkerConfig(I||{})}catch{}A=!1}};let R=!1;if(C){if(!(await Br(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url)).isSharedArrayBufferAvailable()){const H="SharedArrayBuffer not available. This is required for batch mode. Please ensure COOP/COEP headers are set correctly (service worker should handle this). Try refreshing the page.";console.error(H),m(H),n.current=!1,r(!1);return}await F(8);const G=await c();if(G)try{let H="single";try{H=t.getSimulationMode?t.getSimulationMode():"single"}catch{}const O=setTimeout(()=>{G.removeEventListener("message",$),G.removeEventListener("error",W);const K="Simulation worker timed out after 5 minutes. This may indicate that Z3 workers are not responding. Check browser console for errors.";console.error(K),m(K),M(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}},5*60*1e3),$=async K=>{const{op:Q,payload:q}=K.data||{};if(Q==="done"){clearTimeout(O),G.removeEventListener("message",$),G.removeEventListener("error",W),q&&q.elements&&typeof q.elements=="object"&&(u(q.elements),f.current=q.elements,h&&h(q.elements,!0)),await M(),await s(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}q!=null&&q.stats&&T({elapsedMs:q.stats.elapsedMs,transitionsFired:q.stats.steps?q.stats.steps.toLocaleString():"0"})}else Q==="error"&&(clearTimeout(O),G.removeEventListener("message",$),G.removeEventListener("error",W),m((q==null?void 0:q.message)||"Worker error"),await M(),n.current=!1,r(!1))},W=K=>{clearTimeout(O),G.removeEventListener("message",$),G.removeEventListener("error",W);const Q=`Worker error: ${K.message||"Unknown error"}. This may indicate that Z3 workers failed to initialize.`;console.error(Q,K),m(Q),M(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}};G.addEventListener("message",$),G.addEventListener("error",W),G.postMessage({op:"start",payload:{elements:f.current,simOptions:{netMode:k},run:{mode:H,batchMax:0,maxSteps:N,timeBudgetMs:0,yieldEvery:5e3,progressEveryMs:0,yieldEveryMs:0},z3:typeof window<"u"?window.__Z3_SETTINGS__||{}:{}}}),R=!0}catch(H){console.error("Worker run failed, falling back to in-thread run:",H),m(`Worker initialization failed: ${H.message}. Falling back to in-thread execution.`),await M()}else{const H="Failed to create simulation worker. SharedArrayBuffer may not be available.";console.error(H),m(H),n.current=!1,r(!1);return}}if(R)return;if(_&&typeof t.runToCompletion=="function"){let D="single";try{D=t.getSimulationMode?t.getSimulationMode():"single"}catch{}const G=()=>{try{return!!window.__PETRI_NET_CANCEL_RUN__}catch{return!1}},H=performance.now?performance.now():Date.now();try{const O=await t.runToCompletion({mode:D,maxSteps:N,timeBudgetMs:0,yieldEvery:5e3,progressEveryMs:0,yieldEveryMs:0,onProgress:()=>{},shouldCancel:G,batchMax:0}),$=performance.now?performance.now():Date.now(),W=Math.round($-H);O&&O.petriNet&&typeof O.petriNet=="object"&&(u(O.petriNet),f.current=O.petriNet,h&&h(O.petriNet,!0)),T({elapsedMs:W,transitionsFired:O!=null&&O.steps?O.steps.toLocaleString():"0"})}finally{await M(),await s(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}}return}let z=N;const V=x5(x),j=async()=>{if(!n.current){r(!1);return}if(z<=0){n.current=!1,r(!1);return}try{const D=await t.getEnabledTransitions();if(!D||D.length===0){n.current=!1,r(!1);return}const G=Tc(D).map(K=>({id:K})),H=V.findNonConflictingTransitions(G,y.places||[],y.arcs||[]),O=Array.isArray(H)?H:Array.from(H||[]),$=O.length?O[Math.floor(Math.random()*O.length)]:[],W=Array.isArray($)?$:$?[$]:[];for(const K of W){if(z<=0)break;await w(K.id),z-=1}if(z<=0){n.current=!1,r(!1);return}setTimeout(j,50)}catch(D){console.error("Error in run simulation:",D),m(D.message||"Error during simulation run"),n.current=!1,r(!1)}};j()}catch(_){console.error("Error starting run simulation:",_),m("Failed to start run simulation")}},l7=(t,e,n,r,i={},s)=>{const[l,c]=B.useState(!1),[u,f]=B.useState(!1),[h,m]=B.useState([]),[x,y]=B.useState(null),[w,T]=B.useState(!1),[k,_]=B.useState(0),[C,g]=B.useState(null),S=B.useRef(!1),b=B.useRef(!1),N=B.useRef(t),I=B.useRef(null),A=B.useRef(null),F=s||pi,M=B.useCallback(async()=>{if(A.current)return A.current;try{const K=M9();return A.current=K,K}catch(K){return console.error("Failed to create simulation worker:",K),null}},[]),{refreshEnabledTransitions:R,debouncedRefresh:z}=Z9({elements:t,netMode:r,simulatorCore:F,setElements:e,updateHistory:n,setEnabledTransitionIds:m,setIsSimulatorReady:T,setSimulationError:y,latestElementsRef:N,forceResetCounter:k});B.useEffect(()=>{N.current=t},[t]);const V=B.useCallback(()=>{y(null)},[]),j=B.useCallback(()=>{pe.debug("Forcing simulator reset"),_(K=>K+1)},[]),D=B.useCallback(()=>{var K,Q;c(!1),f(!1),S.current=!1,b.current=!1;try{F.deactivateSimulation()}catch{}V(),m([]);try{(Q=(K=A.current)==null?void 0:K.postMessage)==null||Q.call(K,{op:"cancel"})}catch{}},[V,F]);B.useEffect(()=>{l||u?(F.activateSimulation(),R()):(F.deactivateSimulation(),R())},[l,u,R]),B.useEffect(()=>((u||l)&&z(),()=>z.cancel()),[u,l,z]);const G=B.useMemo(()=>e7({simulatorCore:F,setElements:e,updateHistory:n,clearError:V,refreshEnabledTransitions:R,setSimulationError:y,latestElementsRef:N}),[F,e,n,V,R,y]),H=B.useMemo(()=>t7({simulatorCore:F,handleFireTransition:G,conflictResolverRef:I,latestElementsRef:N,refreshEnabledTransitions:R,setSimulationError:y,stopAllSimulations:D}),[F,G,I,R,y,D]),O=B.useMemo(()=>r7({simulatorCore:F,isContinuousSimulatingRef:S,isRunningRef:b,setIsContinuousSimulating:c,setEnabledTransitionIds:m,stepSimulation:H,refreshEnabledTransitions:R,setSimulationError:y}),[F,S,b,c,m,H,R,y]),$=B.useMemo(()=>a7({simulatorCore:F,isContinuousSimulatingRef:S,isRunningRef:b,setIsRunning:f,setIsContinuousSimulating:c,refreshEnabledTransitions:R,simulationSettings:i,ensureWorker:M,setElements:e,latestElementsRef:N,updateHistory:n,setSimulationError:y,conflictResolverRef:I,elements:t,handleFireTransition:G,setCompletionStats:g,netMode:r}),[F,S,b,f,c,R,i==null?void 0:i.limitIterations,i==null?void 0:i.maxIterations,i==null?void 0:i.batchMode,i==null?void 0:i.useNonVisualRun,M,e,N,n,y,I,t,G,g,r]),W=B.useCallback(()=>{g(null)},[]);return{isContinuousSimulating:l,isRunning:u,enabledTransitionIds:h,simulationError:x,isSimulatorReady:w,handleFireTransition:G,stepSimulation:H,startContinuousSimulation:O,startRunSimulation:$,stopAllSimulations:D,clearError:V,forceSimulatorReset:j,completionStats:C,dismissCompletionDialog:W}};function u7(t){if(!t||typeof t!="object")return"pt";const e=Array.isArray(t.places)?t.places:[],n=Array.isArray(t.transitions)?t.transitions:[],r=Array.isArray(t.arcs)?t.arcs:[];return e.some(s=>Array.isArray(s.valueTokens)&&s.valueTokens.length>0||!!s.type)||n.some(s=>!!s.guard||!!s.action)||r.some(s=>Array.isArray(s.bindings)&&s.bindings.length>0||!!s.binding)?"algebraic-int":"pt"}function c7(t){const{elements:e,setElements:n,updateHistory:r,simulationSettings:i,setSimulationSettings:s,resetEditor:l,forceSimulatorReset:c,setIsLoading:u,setError:f,setSuccess:h,setIsAdtOpen:m,saveFileHandle:x,setSaveFileHandle:y}=t||{},w=()=>{m&&m(!0)},T=async(S,b)=>{const N=await S.createWritable();await N.write(new Blob([b],{type:"application/xml"})),await N.close()};return{handleSave:async()=>{try{u==null||u(!0),f==null||f(null),h==null||h(null);const S={...e||{},netMode:(i==null?void 0:i.netMode)||"pt"},b=await My(S),N="petri-net.pnml";if(typeof window<"u"&&typeof window.showSaveFilePicker=="function")try{if(x)await T(x,b);else{const A=await window.showSaveFilePicker({suggestedName:N,types:[{description:"PNML Files",accept:{"application/xml":[".pnml",".xml"],"text/xml":[".pnml",".xml"]}}],excludeAcceptAllOption:!1});await T(A,b),y==null||y(A)}}catch(A){if(A&&(A.name==="AbortError"||A.name==="SecurityError"))h==null||h("Save cancelled.");else{const F=new Blob([b],{type:"application/xml"}),M=URL.createObjectURL(F),R=document.createElement("a");R.href=M,R.download=N,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(M)}}else{const A=new Blob([b],{type:"application/xml"}),F=URL.createObjectURL(A),M=document.createElement("a");M.href=F,M.download=N,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(F)}h==null||h("Petri net saved.")}catch(S){console.error("Error saving Petri net:",S),f==null||f(`Error saving Petri net: ${S.message}`)}finally{u==null||u(!1)}},handleSaveAs:async()=>{try{u==null||u(!0),f==null||f(null),h==null||h(null);const S={...e||{},netMode:(i==null?void 0:i.netMode)||"pt"},b=await My(S),N="petri-net.pnml";if(typeof window<"u"&&typeof window.showSaveFilePicker=="function")try{const A=await window.showSaveFilePicker({suggestedName:N,types:[{description:"PNML Files",accept:{"application/xml":[".pnml",".xml"],"text/xml":[".pnml",".xml"]}}],excludeAcceptAllOption:!1});await T(A,b),y==null||y(A)}catch(A){if(A&&(A.name==="AbortError"||A.name==="SecurityError"))h==null||h("Save cancelled.");else{const F=new Blob([b],{type:"application/xml"}),M=URL.createObjectURL(F),R=document.createElement("a");R.href=M,R.download=N,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(M)}}else{const A=new Blob([b],{type:"application/xml"}),F=URL.createObjectURL(A),M=document.createElement("a");M.href=F,M.download=N,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(F)}h==null||h("Petri net saved.")}catch(S){console.error("Error saving Petri net:",S),f==null||f(`Error saving Petri net: ${S.message}`)}finally{u==null||u(!1)}},handleLoad:()=>{const S=document.createElement("input");S.type="file",S.accept=".pnml,.xml";try{S.style.display="none",document.body.appendChild(S)}catch{}S.onchange=async b=>{const N=b.target.files[0];if(N)try{u==null||u(!0),f==null||f(null),h==null||h(null);const I=await new Promise((j,D)=>{const G=new FileReader;G.onload=H=>j(H.target.result),G.onerror=D,G.readAsText(N)});if(!I||String(I).trim()==="")throw new Error("The selected file is empty");if(!String(I).includes("<pnml")&&!String(I).includes("<PNML"))throw new Error("The file does not appear to be a valid PNML file");const A=Qw(I),F=new Promise((j,D)=>{setTimeout(()=>D(new Error("Operation timed out. The file may be too large or invalid.")),1e4)}),M=await Promise.race([A,F]);if(!M||typeof M!="object")throw new Error("Invalid data structure in the imported file");const R={places:Array.isArray(M.places)?M.places:[],transitions:Array.isArray(M.transitions)?M.transitions:[],arcs:Array.isArray(M.arcs)?M.arcs:[]},z=(R.arcs||[]).filter(j=>{if(j.source==="undefined"||j.target==="undefined"||!j.source||!j.target)return!1;const D=R.places.some(H=>H.id===j.source)||R.transitions.some(H=>H.id===j.source),G=R.places.some(H=>H.id===j.target)||R.transitions.some(H=>H.id===j.target);return D&&G});R.arcs=z.map(j=>{if(!j.type||j.type!=="place-to-transition"&&j.type!=="transition-to-place"){const D=R.places.some(H=>H.id===j.source),G=R.places.some(H=>H.id===j.target);return D&&!G?{...j,type:"place-to-transition"}:!D&&G?{...j,type:"transition-to-place"}:{...j,type:"place-to-transition"}}return j}),c&&c(),n==null||n(R);const V=R.netMode;if(V)s==null||s(j=>({...j||{},netMode:V}));else try{const j=u7(R);s==null||s(D=>({...D||{},netMode:j}))}catch{}r&&r(R),h==null||h(`Petri net loaded successfully with ${R.places.length} places, ${R.transitions.length} transitions, and ${R.arcs.length} arcs.`)}catch(I){console.error("Error loading Petri net:",I),f==null||f(`Error loading Petri net: ${I.message}`)}finally{u==null||u(!1);try{S&&S.parentNode&&S.parentNode.removeChild(S)}catch{}}},S.click()},handleClear:()=>{var S,b;try{(S=pi.deactivateSimulation)==null||S.call(pi),(b=pi.reset)==null||b.call(pi)}catch{}if(l)l();else{const N={places:[],transitions:[],arcs:[]};n==null||n(N),s==null||s(I=>({...I||{},netMode:"pt"})),r&&r(N)}h==null||h("Canvas cleared successfully.")},handleOpenAdtManager:w}}const Lt=[];for(let t=0;t<256;++t)Lt.push((t+256).toString(16).slice(1));function d7(t,e=0){return(Lt[t[e+0]]+Lt[t[e+1]]+Lt[t[e+2]]+Lt[t[e+3]]+"-"+Lt[t[e+4]]+Lt[t[e+5]]+"-"+Lt[t[e+6]]+Lt[t[e+7]]+"-"+Lt[t[e+8]]+Lt[t[e+9]]+"-"+Lt[t[e+10]]+Lt[t[e+11]]+Lt[t[e+12]]+Lt[t[e+13]]+Lt[t[e+14]]+Lt[t[e+15]]).toLowerCase()}let Fh;const f7=new Uint8Array(16);function h7(){if(!Fh){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Fh=crypto.getRandomValues.bind(crypto)}return Fh(f7)}const p7=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Uy={randomUUID:p7};function co(t,e,n){var i;if(Uy.randomUUID&&!e&&!t)return Uy.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??h7();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[n+s]=r[s];return e}return d7(r)}function w5(t,e){const n=new Set((e||[]).filter(l=>l.type==="place"||l.type==="transition").map(l=>l.id)),r=(t.places||[]).filter(l=>n.has(l.id)),i=(t.transitions||[]).filter(l=>n.has(l.id)),s=(t.arcs||[]).filter(l=>n.has(l.source)&&n.has(l.target));return{places:r,transitions:i,arcs:s}}function _5(t,e,n){if(!t)return null;const r=new Map,i=n&&typeof n.x=="number"?n.x:(n==null?void 0:n.dx)||0,s=n&&typeof n.y=="number"?n.y:(n==null?void 0:n.dy)||0,l=[],c=(t.places||[]).map(h=>{const m=e();r.set(h.id,m);const x=typeof h.x=="number"&&isFinite(h.x)?h.x:0,y=typeof h.y=="number"&&isFinite(h.y)?h.y:0,w={...h,id:m,x:x+i,y:y+s};return l.push({id:m,type:"place"}),w}),u=(t.transitions||[]).map(h=>{const m=e();r.set(h.id,m);const x=typeof h.x=="number"&&isFinite(h.x)?h.x:0,y=typeof h.y=="number"&&isFinite(h.y)?h.y:0,w={...h,id:m,x:x+i,y:y+s};return l.push({id:m,type:"transition"}),w}),f=(t.arcs||[]).map(h=>({...h,id:e(),source:r.get(h.source),target:r.get(h.target)}));return{newPlaces:c,newTransitions:u,newArcs:f,newSelection:l}}function g7(t,e){const n=new Set(Array.isArray(e)?e.map(i=>typeof i=="string"?i:i.id):[]),r={...t};return r.places=(t.places||[]).filter(i=>!n.has(i.id)),r.transitions=(t.transitions||[]).filter(i=>!n.has(i.id)),r.arcs=(t.arcs||[]).filter(i=>!n.has(i.source)&&!n.has(i.target)),r}function S5(t){const{elements:e,setElements:n,selectedElement:r,selectedElements:i,clearSelection:s,setSelection:l,clipboardRef:c,netMode:u,setClipboard:f,getClipboard:h,onClipboardMismatch:m,handleUndo:x,handleRedo:y,setMode:w,arcStart:T,setArcStart:k,setTempArcEnd:_,setSelectedElement:C}=t;B.useEffect(()=>{const g=b=>{const I=navigator.platform.toUpperCase().includes("MAC")?b.metaKey:b.ctrlKey;b.key==="Shift"&&t.isShiftPressedRef&&(t.isShiftPressedRef.current=!0);const A=b.target,F=A==null?void 0:A.tagName,M=F==="INPUT"||F==="TEXTAREA"||(A==null?void 0:A.isContentEditable);if(!M&&(b.key==="Delete"||b.key==="Backspace")){if(i.length===0&&!r)return;b.preventDefault(),n(R=>{const z=[],V=new Set;i.length>0?i.forEach(D=>{(D.type==="place"||D.type==="transition")&&z.push(D.id),D.type==="arc"&&V.add(D.id)}):r&&((r.type==="place"||r.type==="transition")&&z.push(r.id),r.type==="arc"&&V.add(r.id));let j=R;return z.length>0&&(j=g7(j,z)),V.size>0&&(j={...j,arcs:j.arcs.filter(D=>!V.has(D.id))}),j}),s();return}if(!M&&I&&(b.key==="a"||b.key==="A")){b.preventDefault();const R=[...e.places.map(z=>({id:z.id,type:"place"})),...e.transitions.map(z=>({id:z.id,type:"transition"})),...e.arcs.map(z=>({id:z.id,type:"arc"}))];l(R);return}if(!M&&I&&(b.key==="z"||b.key==="Z")&&typeof x=="function"){b.preventDefault(),x();return}if(!M&&I&&(b.key==="y"||b.key==="Y")&&typeof y=="function"){b.preventDefault(),y();return}if(!M&&!I){if((b.key==="p"||b.key==="P")&&typeof w=="function"){b.preventDefault(),w("place");return}if((b.key==="t"||b.key==="T")&&typeof w=="function"){b.preventDefault(),w("transition");return}if((b.key==="a"||b.key==="A")&&typeof w=="function"){b.preventDefault(),w("arc");return}if((b.key==="s"||b.key==="S")&&typeof w=="function"){b.preventDefault(),w("select");return}if(b.key==="Escape"){b.preventDefault(),typeof w=="function"&&w("select"),typeof k=="function"&&T&&k(null),typeof _=="function"&&_(null),typeof C=="function"&&C(null);return}}if(!M&&I&&(b.key==="c"||b.key==="C")){if(i.length===0)return;b.preventDefault();const R=w5(e,i),z=u||"pt";typeof f=="function"?f(R):c&&(c.current={payload:R,netMode:z,source:"local",timestamp:Date.now()});return}if(!M&&I&&(b.key==="v"||b.key==="V")){const R=u||"pt",z=typeof h=="function"?h():c==null?void 0:c.current;if(!z)return;const V=z.payload||z;if(!V)return;const j=z.netMode||R;if(j&&R&&j!==R){typeof m=="function"?m(j,R,z):console.warn(`Blocked paste: shared clipboard contains ${j} net, editor mode is ${R}.`);return}b.preventDefault();const{newPlaces:D,newTransitions:G,newArcs:H,newSelection:O}=_5(V,co,{x:40,y:40});n($=>({...$,places:[...$.places,...D],transitions:[...$.transitions,...G],arcs:[...$.arcs,...H]})),l(O);return}},S=b=>{b.key==="Shift"&&t.isShiftPressedRef&&(t.isShiftPressedRef.current=!1)};return document.addEventListener("keydown",g),document.addEventListener("keyup",S),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",S)}},[e,i,r,n,s,l,c,t,x,y,w,T,k,_,C])}function m7(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var k5=m7,y7=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,v7=y7,x7=v7,w7=typeof self=="object"&&self&&self.Object===Object&&self,_7=x7||w7||Function("return this")(),T5=_7,S7=T5,k7=function(){return S7.Date.now()},T7=k7,C7=/\s/;function b7(t){for(var e=t.length;e--&&C7.test(t.charAt(e)););return e}var E7=b7,P7=E7,N7=/^\s+/;function A7(t){return t&&t.slice(0,P7(t)+1).replace(N7,"")}var M7=A7,R7=T5,I7=R7.Symbol,C5=I7,Gy=C5,b5=Object.prototype,L7=b5.hasOwnProperty,F7=b5.toString,da=Gy?Gy.toStringTag:void 0;function j7(t){var e=L7.call(t,da),n=t[da];try{t[da]=void 0;var r=!0}catch{}var i=F7.call(t);return r&&(e?t[da]=n:delete t[da]),i}var O7=j7,D7=Object.prototype,z7=D7.toString;function B7(t){return z7.call(t)}var U7=B7,Vy=C5,G7=O7,V7=U7,W7="[object Null]",$7="[object Undefined]",Wy=Vy?Vy.toStringTag:void 0;function H7(t){return t==null?t===void 0?$7:W7:Wy&&Wy in Object(t)?G7(t):V7(t)}var X7=H7;function Y7(t){return t!=null&&typeof t=="object"}var K7=Y7,Q7=X7,Z7=K7,q7="[object Symbol]";function J7(t){return typeof t=="symbol"||Z7(t)&&Q7(t)==q7}var e_=J7,t_=M7,$y=k5,n_=e_,Hy=0/0,r_=/^[-+]0x[0-9a-f]+$/i,i_=/^0b[01]+$/i,s_=/^0o[0-7]+$/i,o_=parseInt;function a_(t){if(typeof t=="number")return t;if(n_(t))return Hy;if($y(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=$y(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t_(t);var n=i_.test(t);return n||s_.test(t)?o_(t.slice(2),n?2:8):r_.test(t)?Hy:+t}var l_=a_,u_=k5,jh=T7,Xy=l_,c_="Expected a function",d_=Math.max,f_=Math.min;function h_(t,e,n){var r,i,s,l,c,u,f=0,h=!1,m=!1,x=!0;if(typeof t!="function")throw new TypeError(c_);e=Xy(e)||0,u_(n)&&(h=!!n.leading,m="maxWait"in n,s=m?d_(Xy(n.maxWait)||0,e):s,x="trailing"in n?!!n.trailing:x);function y(N){var I=r,A=i;return r=i=void 0,f=N,l=t.apply(A,I),l}function w(N){return f=N,c=setTimeout(_,e),h?y(N):l}function T(N){var I=N-u,A=N-f,F=e-I;return m?f_(F,s-A):F}function k(N){var I=N-u,A=N-f;return u===void 0||I>=e||I<0||m&&A>=s}function _(){var N=jh();if(k(N))return C(N);c=setTimeout(_,T(N))}function C(N){return c=void 0,x&&r?y(N):(r=i=void 0,l)}function g(){c!==void 0&&clearTimeout(c),f=0,r=u=i=c=void 0}function S(){return c===void 0?l:C(jh())}function b(){var N=jh(),I=k(N);if(r=arguments,i=this,u=N,I){if(c===void 0)return w(u);if(m)return clearTimeout(c),c=setTimeout(_,e),y(u)}return c===void 0&&(c=setTimeout(_,e)),l}return b.cancel=g,b.flush=S,b}var p_=h_;const g_=il(p_);function m_(t,e){return!t||!e||!Oh(t.places,e.places,E5)||!Oh(t.transitions,e.transitions,q0)||!Oh(t.arcs,e.arcs,P5)?!1:(pe.debug("HistoryManager: States are identical"),!0)}function Oh(t=[],e=[],n){if(t.length!==e.length){const i=n===E5?"places":n===q0?"transitions":"arcs";return pe.debug(`HistoryManager: States differ in number of ${i}`),!1}const r=new Map;e.forEach(i=>r.set(i.id,i));for(const i of t){const s=r.get(i.id);if(!s)return pe.debug(`HistoryManager: ${n===P5?"Arc":n===q0?"Transition":"Place"} ${i.id} not found in second state`),!1;if(!n(i,s))return!1}return!0}function E5(t,e){const n=JSON.stringify(t.valueTokens||[])===JSON.stringify(e.valueTokens||[]),r=t.x===e.x&&t.y===e.y&&t.tokens===e.tokens&&t.label===e.label&&t.name===e.name&&n;return r||pe.debug(`HistoryManager: Place ${t.id} differs - x: ${t.x} vs ${e.x}, y: ${t.y} vs ${e.y}, tokens: ${t.tokens} vs ${e.tokens}, label: ${t.label} vs ${e.label}, name: ${t.name} vs ${e.name}`),r}function q0(t,e){const n=t.x===e.x&&t.y===e.y&&t.label===e.label&&t.name===e.name&&(t.guard||"")===(e.guard||"");return n||pe.debug(`HistoryManager: Transition ${t.id} differs - x: ${t.x} vs ${e.x}, y: ${t.y} vs ${e.y}, label: ${t.label} vs ${e.label}, name: ${t.name} vs ${e.name}`),n}function P5(t,e){if(!(t.source===e.source&&t.target===e.target&&t.weight===e.weight))return pe.debug(`HistoryManager: Arc ${t.id} differs - source: ${t.source} vs ${e.source}, target: ${t.target} vs ${e.target}, weight: ${t.weight} vs ${e.weight}`),!1;const r=(t.label||"")===(e.label||"")&&(t.sourceType||"")===(e.sourceType||"")&&(t.targetType||"")===(e.targetType||"")&&JSON.stringify(t.bindings||[])===JSON.stringify(e.bindings||[])&&JSON.stringify(t.anglePoints||[])===JSON.stringify(e.anglePoints||[]);return r||pe.debug(`HistoryManager: Arc ${t.id} differs in secondary properties`),r}function Yu(t){if(!t||!t.places||!t.transitions||!t.arcs)return{places:[],transitions:[],arcs:[]};const e=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(i=>e(i));const r={};for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const s=n[i];s===null||typeof s!="object"?r[i]=s:Array.isArray(s)?r[i]=[...s]:r[i]={...s}}return r};return{places:t.places.map(e),transitions:t.transitions.map(e),arcs:t.arcs.map(e)}}function Dh(t){return!t||!t.places||!t.transitions||!t.arcs?{places:[],transitions:[],arcs:[]}:Yu(t)}class Yy{constructor(e){this.states=[Yu(e)],this.currentIndex=0,this.maxStates=50}addState(e){const n=Yu(e),r=this.states[this.currentIndex];return this.currentIndex>=0&&m_(r,n)?(pe.debug("HistoryManager: State unchanged, not adding to history"),{canUndo:this.canUndo(),canRedo:this.canRedo()}):(pe.debug(`HistoryManager: Adding new state to history. Current index: ${this.currentIndex}, States count: ${this.states.length}`),this.currentIndex<this.states.length-1&&(pe.debug(`HistoryManager: Removing ${this.states.length-this.currentIndex-1} future states`),this.states=this.states.slice(0,this.currentIndex+1)),this.states.push(n),this.currentIndex++,this.states.length>this.maxStates&&(this.states.shift(),this.currentIndex--),pe.debug(`HistoryManager: New state added. Current index: ${this.currentIndex}, States count: ${this.states.length}`),{canUndo:this.canUndo(),canRedo:this.canRedo()})}undo(){if(!this.canUndo())return pe.debug("HistoryManager: Cannot undo - no previous states"),null;this.currentIndex--;const e=this.states[this.currentIndex];return pe.debug(`HistoryManager: Undoing to index ${this.currentIndex}, states count: ${this.states.length}`),{state:Dh(e),canUndo:this.canUndo(),canRedo:this.canRedo()}}redo(){if(!this.canRedo())return pe.debug("HistoryManager: Cannot redo - no future states"),null;this.currentIndex++;const e=this.states[this.currentIndex];return pe.debug(`HistoryManager: Redoing to index ${this.currentIndex}, states count: ${this.states.length}`),{state:Dh(e),canUndo:this.canUndo(),canRedo:this.canRedo()}}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.states.length-1}getCurrentState(){return this.states[this.currentIndex]}deepCopyState(e){return Yu(e)}validateState(e){return Dh(e)}}const y_="petri-net-shared-clipboard";function v_({clipboardRef:t,netMode:e,instanceId:n,onIncompatibleClipboard:r}){const i=B.useRef(null),s=B.useRef(e||"pt"),l=B.useRef(r||null);B.useEffect(()=>{s.current=e||"pt"},[e]),B.useEffect(()=>{l.current=r||null},[r]),B.useEffect(()=>{if(typeof window>"u"||typeof window.BroadcastChannel!="function")return;const f=new window.BroadcastChannel(y_);i.current=f;const h=m=>{var T;const x=m==null?void 0:m.data;if(!x||x.type!=="PETRI_NET_CLIPBOARD_UPDATE"||x.instanceId===n)return;const y={payload:x.payload,netMode:x.netMode,source:"remote",instanceId:x.instanceId,timestamp:x.timestamp||Date.now()};t&&(t.current=y);const w=s.current;y.netMode&&w&&y.netMode!==w&&((T=l.current)==null||T.call(l,y.netMode,w,y))};return f.addEventListener("message",h),()=>{f.removeEventListener("message",h),i.current=null,f.close()}},[t,n]);const c=B.useCallback(f=>{if(!f)return;const h={payload:f,netMode:s.current,source:"local",instanceId:n,timestamp:Date.now()};t&&(t.current=h);const m=i.current;if(m&&typeof m.postMessage=="function")try{m.postMessage({type:"PETRI_NET_CLIPBOARD_UPDATE",payload:f,netMode:h.netMode,instanceId:n,timestamp:h.timestamp})}catch(x){console.warn("Failed to broadcast clipboard payload:",x)}},[t,n]),u=B.useCallback(()=>t==null?void 0:t.current,[t]);return{setClipboard:c,getClipboard:u}}const N5=B.createContext(),x_=({children:t})=>{const[r,i]=B.useState({width:800,height:600}),[s,l]=B.useState({width:1e4,height:7500}),[c,u]=B.useState({x:0,y:0}),[f,h]=B.useState(1),[m,x]=B.useState(!0),y=20,w=B.useRef(null),[T,k]=B.useState(null),_=B.useRef(null),[C,g]=B.useState(!1),[S,b]=B.useState({visible:!1,position:null,elementType:null}),N=B.useRef("select"),A={stageDimensions:r,setStageDimensions:i,virtualCanvasDimensions:s,setVirtualCanvasDimensions:l,canvasScroll:c,setCanvasScroll:u,zoomLevel:f,setZoomLevel:h,gridSnappingEnabled:m,toggleGridSnapping:()=>{x(F=>!F)},gridSize:y,MIN_ZOOM:.1,MAX_ZOOM:3,appRef:w,containerRef:T,setContainerRef:k,stageRef:_,isDragging:C,setIsDragging:g,snapIndicator:S,setSnapIndicator:b,prevModeRef:N};return P.jsx(N5.Provider,{value:A,children:t})},Po=()=>{const t=B.useContext(N5);if(t===void 0)throw new Error("useEditorUI must be used within an EditorUIProvider");return t};function Ky(t){if(!(t!=null&&t.valueTokens)||t.valueTokens.length===0)return null;const e=Ja(t.valueTokens[0]);return t.valueTokens.every(r=>Ja(r)===e)?e:null}function dl(t,e,n=!0){if(!n)return console.log("[TypeInference] Disabled, returning original state"),t;if(e!=="algebraic-int"||!(t!=null&&t.places)||!(t!=null&&t.arcs)||!(t!=null&&t.transitions))return console.log("[TypeInference] Skipping - netMode:",e,"hasPlaces:",!!(t!=null&&t.places)),t;console.log("[TypeInference] Starting with overwrite=",n);const r={arcs:[],transitions:[]},i=!!n;t.places.forEach(c=>{const u=Ky(c);u&&t.arcs.filter(h=>h.source===c.id).forEach(h=>{if(h.bindings&&h.bindings.length>0){const m=[];let x=!1;for(const y of h.bindings){if(!y){m.push(y);continue}const w=new Map,T=y.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(T&&T.forEach(_=>{if(_!=="true"&&_!=="false"&&_!=="and"&&_!=="or"&&_!=="not")if(!y.includes(`${_}:`))w.set(_,u);else{const C=y.match(new RegExp(`${_}:(Int|Bool|Pair|String|List)`,"i"));C&&C[1]&&w.set(_,C[1])}}),u==="List"){const _=Array.isArray(c.valueTokens)?c.valueTokens:[];let C=null;if(_.length>0&&Array.isArray(_[0])&&_[0].length>0){const g=Ja(_[0][0]);_.every(b=>Array.isArray(b)&&b.every(N=>Ja(N)===g))&&(C=g)}if(C)for(const[g,S]of Array.from(w.entries()))S==="List"&&w.set(g,C);else w.clear()}const k=w.size>0?Xu(y,w,null,{overwrite:i}):y;k!==y&&(x=!0),m.push(k)}x&&r.arcs.push({arcId:h.id,newBindings:m})}})});const s=t.arcs.map(c=>{const u=r.arcs.find(f=>f.arcId===c.id);return u?u.newBindings?{...c,bindings:[...u.newBindings]}:{...c,bindings:[u.newBinding]}:c});return t.transitions.forEach(c=>{const u=s.filter(m=>m.target===c.id),f=new Map;if(console.log("[TypeInference] Processing transition:",c.id,"inputArcs:",u.length),u.forEach(m=>{m.bindings&&m.bindings.length>0&&m.bindings.forEach(x=>{if(!x)return;console.log("[TypeInference] Input arc binding:",x);const y=x.match(/\b([a-z][a-zA-Z0-9_]*)\:(Int|Bool|Pair|String|List)\b/gi);y&&y.forEach(T=>{const k=T.match(/\b([a-z][a-zA-Z0-9_]*)\:(Int|Bool|Pair|String|List)\b/i);k&&k[1]&&k[2]&&f.set(k[1],k[2])});const w=x.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(console.log("[TypeInference] All variable matches in binding:",w),w){const T=t.places.find(k=>k.id===m.source);if(T){const k=Ky(T);k&&w.forEach(_=>{_!=="true"&&_!=="false"&&_!=="and"&&_!=="or"&&_!=="not"&&(f.has(_)||f.set(_,k))})}}})}),console.log("[TypeInference] Extracted variable types for",c.id,":",JSON.stringify(Array.from(f.entries()))),c.guard&&f.size>0){const m=c.guard.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(m){const x=new Map;if(m.forEach(y=>{if(y!=="true"&&y!=="false"&&y!=="and"&&y!=="or"&&y!=="not"){const w=f.get(y);if(!w)return;i?x.set(y,w):new RegExp(`\\b${y}\\s*:(Int|Bool|Pair|String|List)\\b`,"i").test(c.guard)||x.set(y,w)}}),console.log("[TypeInference] Guard type map for",c.id,":",Array.from(x.entries())),x.size>0){const y=Xu(c.guard,x,null,{overwrite:i});console.log("[TypeInference] Guard before:",c.guard),console.log("[TypeInference] Guard after:",y),y!==c.guard&&r.transitions.push({transitionId:c.id,newGuard:y})}}}s.filter(m=>m.source===c.id).forEach(m=>{if(m.bindings&&m.bindings.length>0){const x=[];let y=!1;for(const w of m.bindings){if(!w){x.push(w);continue}const T=new Map,k=w.match(/\b[a-z][a-zA-Z0-9_]*\b/g);k&&k.forEach(C=>{if(C!=="true"&&C!=="false"&&C!=="and"&&C!=="or"&&C!=="not"){const g=f.get(C);if(!g)return;i?T.set(C,g):new RegExp(`\\b${C}\\s*:(Int|Bool|Pair|String|List)\\b`,"i").test(w)||T.set(C,g)}});const _=T.size>0?Xu(w,T,null,{overwrite:i}):w;_!==w&&(y=!0),x.push(_)}y&&r.arcs.push({arcId:m.id,newBindings:x})}})}),r.arcs.length===0&&r.transitions.length===0?t:{...t,arcs:t.arcs.map(c=>{const u=r.arcs.find(f=>f.arcId===c.id);return u?u.newBindings?{...c,bindings:[...u.newBindings]}:{...c,bindings:[u.newBinding]}:c}),transitions:t.transitions.map(c=>{const u=r.transitions.find(f=>f.transitionId===c.id);return u?{...c,guard:u.newGuard}:c})}}const ag=B.createContext(),w_=({children:t})=>{const{gridSnappingEnabled:e,gridSize:n,setCanvasScroll:r,setZoomLevel:i}=Po(),[s,l]=B.useState({places:[],transitions:[],arcs:[]}),[c,u]=B.useState(null),[f,h]=B.useState([]),[m,x]=B.useState("select"),[y,w]=B.useState(null),[T,k]=B.useState(null),[_,C]=B.useState(!1),[g,S]=B.useState({maxIterations:2e5,limitIterations:!1,netMode:"pt",useNonVisualRun:!1,batchMode:!1,showInferredTypes:!1}),[b,N]=B.useState({poolSize:1,idleTimeoutMs:3e5,prewarmOnAlgebraicMode:!0,solverTimeoutMs:1e4}),[I,A]=B.useState(null),F=B.useRef(new Yy({places:[],transitions:[],arcs:[]})),[M,R]=B.useState(!1),[z,V]=B.useState(!1),j=B.useRef(g_(Te=>{const Xe=F.current.addState(Te);R(Xe.canUndo),V(Xe.canRedo)},500)),[D,G]=B.useState(!1),H=B.useRef(m),O=B.useRef(null),$=B.useRef(null),W=B.useRef(co()),K=B.useRef(!1),Q=(g==null?void 0:g.netMode)||"pt",q=B.useRef(!!(g!=null&&g.showInferredTypes)),oe=B.useRef(null),we=B.useCallback((Te,Xe)=>{console.warn(`Shared clipboard net mode mismatch: received ${Te||"unknown"} while editor is ${Xe||Q}. Copy/paste is disabled until both editors use the same mode.`)},[Q]),{setClipboard:ye,getClipboard:U}=v_({clipboardRef:$,netMode:Q,instanceId:W.current,onIncompatibleClipboard:we}),te=(Te,Xe=!1)=>{if(Xe){const rn=F.current.addState(Te);R(rn.canUndo),V(rn.canRedo)}else j.current(Te)},{isContinuousSimulating:ae,isRunning:xe,enabledTransitionIds:ve,simulationError:Le,isSimulatorReady:ie,handleFireTransition:se,stepSimulation:de,startContinuousSimulation:ke,startRunSimulation:Me,stopAllSimulations:ue,forceSimulatorReset:dt,completionStats:Tt,dismissCompletionDialog:Qt}=l7(s,l,te,(g==null?void 0:g.netMode)||"pt",g);B.useEffect(()=>(!D&&H.current===m&&te(s),H.current=m,()=>j.current.cancel()),[s,D,m]),B.useEffect(()=>{const Te=!!(g!=null&&g.showInferredTypes),Xe=q.current;if(Te!==Xe){if(q.current=Te,Te&&Q==="algebraic-int"){l(rn=>(oe.current=rn,dl(rn,Q,!0)));return}!Te&&oe.current&&(l(oe.current),oe.current=null)}},[g==null?void 0:g.showInferredTypes,Q,l]);const _s=()=>{if(!M)return;pe.debug("Undoing to previous state...");const Te=F.current.undo();Te&&(pe.debug("Undo result:",Te.state),l(Te.state),R(Te.canUndo),V(Te.canRedo),dt())},Ss=()=>{if(!z)return;pe.debug("Redoing to next state...");const Te=F.current.redo();Te&&(pe.debug("Redo result:",Te.state),l(Te.state),R(Te.canUndo),V(Te.canRedo),dt())},lr=(Te,Xe)=>e?{x:Math.round(Te/n)*n,y:Math.round(Xe/n)*n}:{x:Te,y:Xe},ks=Te=>{S(Te),C(!1)};B.useEffect(()=>{(async()=>{if(!(typeof window>"u"))try{const{setZ3WorkerConfig:Xe}=await Br(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url);Xe(b)}catch{}})()},[b]);const Mt=()=>{const Te={places:[],transitions:[],arcs:[]};l(Te),u(null),h([]),x("select"),w(null),k(null),S({maxIterations:2e5,limitIterations:!1,netMode:"pt",useNonVisualRun:!1,batchMode:!1,showInferredTypes:!1}),r({x:0,y:0}),i(1),F.current=new Yy(Te),R(!1),V(!1),pe.debug("Editor completely reset")},Zr=(Te,Xe)=>Te?f.some(rn=>rn.id===Te&&rn.type===Xe):!1,Ts=()=>{u(null),h([])},yl=Te=>{if(h(Array.isArray(Te)?Te:[]),Array.isArray(Te)&&Te.length>0){const Xe=Te[Te.length-1],rn=Xe.type==="place"?s.places.find(qr=>qr.id===Xe.id):Xe.type==="transition"?s.transitions.find(qr=>qr.id===Xe.id):s.arcs.find(qr=>qr.id===Xe.id);rn&&u({...rn,type:Xe.type})}else u(null)};return S5({elements:s,setElements:l,selectedElement:c,selectedElements:f,clearSelection:Ts,setSelection:yl,clipboardRef:$,isShiftPressedRef:K,netMode:Q,setClipboard:ye,getClipboard:U,onClipboardMismatch:we}),P.jsx(ag.Provider,{value:{elements:s,setElements:l,selectedElement:c,setSelectedElement:u,mode:m,setMode:x,arcStart:y,setArcStart:w,tempArcEnd:T,setTempArcEnd:k,isDragging:D,setIsDragging:G,isContinuousSimulating:ae,isRunning:xe,isSimulatorReady:ie,enabledTransitionIds:ve,simulationError:Le,stepSimulation:de,handleFireTransition:se,startContinuousSimulation:ke,startRunSimulation:Me,stopAllSimulations:ue,completionStats:Tt,dismissCompletionDialog:Qt,isSettingsDialogOpen:_,setIsSettingsDialogOpen:C,simulationSettings:g,setSimulationSettings:S,netMode:Q,historyManagerRef:F,canUndo:M,setCanUndo:R,canRedo:z,setCanRedo:V,handleUndo:_s,handleRedo:Ss,updateHistory:te,snapToGrid:lr,handleSaveSettings:ks,z3Settings:b,setZ3Settings:N,resetEditor:Mt,simulatorCore:pi,forceSimulatorReset:dt,selectedElements:f,setSelectedElements:h,isIdSelected:Zr,clearSelection:Ts,setSelection:yl,multiDragRef:O,clipboardRef:$,setClipboard:ye,getClipboard:U,onClipboardMismatch:we,instanceId:W.current,isShiftPressedRef:K,saveFileHandle:I,setSaveFileHandle:A},children:t})},en=()=>{const t=B.useContext(ag);if(t===void 0)throw new Error("usePetriNet must be used within a PetriNetProvider");return t},__=({mode:t,setMode:e,gridSnappingEnabled:n,onToggleGridSnapping:r,canUndo:i,canRedo:s,onUndo:l,onRedo:c,elements:u,setElements:f,updateHistory:h,simulationSettings:m,setSimulationSettings:x,simulationMode:y,setSimulationMode:w,isSimulating:T,startSimulation:k,stopSimulation:_,clearCanvas:C,onOpenSettings:g,resetEditor:S})=>{const[b,N]=B.useState(!1),[I,A]=B.useState(null),[F,M]=B.useState(null),[R,z]=B.useState(!1),[V,j]=B.useState(!1),{saveFileHandle:D,setSaveFileHandle:G}=(()=>{try{return en()}catch{return{saveFileHandle:null,setSaveFileHandle:()=>{}}}})(),{handleSave:H,handleSaveAs:O,handleLoad:$,handleClear:W,handleOpenAdtManager:K}=c7({elements:u,setElements:f,updateHistory:h,simulationSettings:m,setSimulationSettings:x,resetEditor:S,setIsLoading:N,setError:A,setSuccess:M,setIsAdtOpen:z,saveFileHandle:D,setSaveFileHandle:G});B.useEffect(()=>{if(!F)return;const ae=setTimeout(()=>M(null),5e3);return()=>clearTimeout(ae)},[F]);const Q=B.useMemo(()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(min-width: 1024px)"):null,[]);B.useEffect(()=>{if(!Q)return;const ae=xe=>{xe.matches&&j(!1)};return Q.addEventListener?Q.addEventListener("change",ae):Q.addListener(ae),()=>{Q.removeEventListener?Q.removeEventListener("change",ae):Q.removeListener(ae)}},[Q]);const q=(ae="desktop")=>xe=>({padding:"0.375rem 0.5rem",borderRadius:"0.25rem",backgroundColor:xe?"#4338ca":"white",color:xe?"rgba(255, 255, 255, 0.85)":"rgba(31, 41, 55, 0.7)",border:xe?"1px solid #3730a3":"1px solid #d1d5db",borderBottom:xe?"2px solid #312e81":"2px solid #9ca3af",margin:ae==="mobile"?"0 0 0.5rem 0":"0 0.125rem",minWidth:ae==="mobile"?"100%":"80px",width:ae==="mobile"?"100%":"80px",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease-in-out",textAlign:"center",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",boxShadow:xe?"inset 0 1px 0 rgba(255, 255, 255, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1)":"inset 0 1px 0 rgba(255, 255, 255, 0.7), 0 2px 4px rgba(0, 0, 0, 0.1)",position:"relative",top:"0",transform:xe?"translateY(1px)":"translateY(0)",textShadow:xe?"0 -1px 1px rgba(0, 0, 0, 0.5), 0 1px 0 rgba(255, 255, 255, 0.15)":"0 1px 0 rgba(255, 255, 255, 0.5), 0 -1px 0 rgba(0, 0, 0, 0.2)"}),oe=B.useMemo(()=>q("desktop"),[]),we=B.useMemo(()=>q("mobile"),[]),ye=ae=>({padding:"0.5rem",marginTop:"0.5rem",borderRadius:"0.25rem",backgroundColor:ae?"#fee2e2":"#d1fae5",color:ae?"#b91c1c":"#047857",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem"}),U=()=>P.jsxs("div",{className:"hidden lg:flex items-start",children:[P.jsxs("div",{className:"file-operations p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"File"}),P.jsx(Ty,{isLoading:b,onSave:H,onSaveAs:O,canSaveAs:!!D,onLoad:$,onClear:W,buttonStyle:oe})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"editing-tools p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"Editing"}),P.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[P.jsxs("div",{className:"flex items-center mr-4",children:[P.jsx("input",{type:"checkbox",id:"grid-snap-toggle","data-testid":"grid-snap-toggle",checked:n,onChange:r,className:"mr-1"}),P.jsx("label",{htmlFor:"grid-snap-toggle",className:"text-xs text-gray-700",children:"Snap to Grid"})]}),P.jsx(gw,{mode:t,setMode:e,buttonStyle:oe})]})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"adt-tools p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"ADT Manager"}),P.jsx("div",{className:"flex justify-between",children:P.jsx("button",{style:oe(!1),onClick:K,title:"Open ADT Manager","data-testid":"toolbar-adt-manager",children:"ADT"})})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"history-tools p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"History"}),P.jsx(Cy,{canUndo:i,canRedo:s,onUndo:l,onRedo:c,buttonStyle:oe})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"settings-tools p-2 ml-auto",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"Settings"}),P.jsx(by,{onOpenSettings:g,buttonStyle:oe})]})]}),te=()=>P.jsxs("div",{className:"flex flex-col space-y-6",children:[P.jsxs("div",{className:"file-operations",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"File"}),P.jsx(Ty,{isLoading:b,onSave:H,onSaveAs:O,canSaveAs:!!D,onLoad:$,onClear:W,buttonStyle:we})]}),P.jsxs("div",{className:"editing-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"Editing"}),P.jsxs("div",{className:"flex items-center",children:[P.jsx("input",{type:"checkbox",id:"grid-snap-toggle-mobile","data-testid":"grid-snap-toggle-mobile",checked:n,onChange:r,className:"mr-2"}),P.jsx("label",{htmlFor:"grid-snap-toggle-mobile",className:"text-sm text-gray-700",children:"Snap to Grid"})]})]}),P.jsxs("div",{className:"adt-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"ADT Manager"}),P.jsx("button",{style:we(!1),onClick:()=>{j(!1),K()},title:"Open ADT Manager","data-testid":"toolbar-adt-manager-mobile",children:"ADT"})]}),P.jsxs("div",{className:"history-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"History"}),P.jsx(Cy,{canUndo:i,canRedo:s,onUndo:l,onRedo:c,buttonStyle:we})]}),P.jsxs("div",{className:"settings-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"Settings"}),P.jsx(by,{onOpenSettings:()=>{j(!1),g()},buttonStyle:we})]})]});return P.jsxs("div",{className:"toolbar-container flex flex-col p-2 bg-gray-50 border-b border-gray-200 shadow-sm",style:{minHeight:"70px"},children:[P.jsx("div",{className:"hidden lg:block",children:U()}),P.jsx("div",{className:"lg:hidden flex items-center justify-between gap-3 px-2 py-1",children:P.jsx("div",{className:"flex-1",children:P.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 rounded-md border border-gray-200 shadow-sm bg-white font-semibold text-gray-700",onClick:()=>j(!0),"aria-label":"Open toolbar menu",children:[P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),P.jsx("span",{children:"Menu"})]})})}),R&&P.jsx(Mw,{isOpen:R,onClose:()=>z(!1)}),I&&P.jsxs("div",{style:ye(!0),children:[I,P.jsx("button",{onClick:()=>A(null),style:{marginLeft:"0.5rem"},children:""})]}),F&&P.jsxs("div",{style:ye(!1),children:[F,P.jsx("button",{onClick:()=>M(null),style:{marginLeft:"0.5rem"},children:""})]}),V&&P.jsxs("div",{className:"lg:hidden fixed inset-0 z-50",children:[P.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40",onClick:()=>j(!1)}),P.jsx("div",{className:"absolute top-0 left-0 bottom-0 w-3/4 max-w-sm bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300 ease-in-out",children:P.jsxs("div",{className:"p-5",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Menu"}),P.jsx("button",{className:"p-2 rounded-full bg-gray-100 hover:bg-gray-200",onClick:()=>j(!1),"aria-label":"Close toolbar menu",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),te()]})})]})]})},S_=({mode:t,tokens:e,valueTokensInput:n,onTokensChange:r,onValueTokensChange:i,onValueTokensBlur:s})=>t==="pt"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tokens (PT mode)"}),P.jsx("input",{type:"number",min:"0",value:e,onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}):t==="algebraic-int"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Algebraic Tokens"}),P.jsx("input",{type:"text",value:n,onChange:i,onBlur:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm",placeholder:"e.g., 2, 3, 'hello', T, F, (1, 2), [1, 2, 3]"})]}):null,k_=({mode:t,weight:e,bindingsInput:n,bindingError:r,onWeightChange:i,onBindingsChange:s,onBindingsBlur:l})=>t==="pt"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Weight"}),P.jsx("input",{type:"number",min:"1",value:e,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}):t==="algebraic-int"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bindings"}),P.jsx("input",{type:"text",value:n,onChange:s,onBlur:l,className:`w-full px-3 py-2 border rounded-md font-mono text-sm ${r?"border-red-500":"border-gray-300"}`,placeholder:"e.g., x, y, (a, b)"}),r&&P.jsx("p",{className:"text-red-600 text-xs mt-1",children:r})]}):null,T_=({guardText:t,guardError:e,onGuardChange:n,onGuardBlur:r})=>P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Guard"}),P.jsx("input",{type:"text",value:t,onChange:n,onBlur:r,className:`w-full px-3 py-2 border rounded-md font-mono text-sm ${e?"border-red-500":"border-gray-300"}`,placeholder:"e.g., x > 0 and y < 10"}),e&&P.jsx("p",{className:"text-red-600 text-xs mt-1",children:e})]});function C_(){const t=B.useCallback(r=>{const i=[];let s="",l=0,c=0,u=!1;for(let h=0;h<r.length;h++){const m=r[h];if(u){s+=m,m==="'"&&r[h-1]!=="\\"&&(u=!1);continue}if(m==="'"){u=!0,s+=m;continue}if(m==="("){l++,s+=m;continue}if(m===")"){l=Math.max(0,l-1),s+=m;continue}if(m==="["){c++,s+=m;continue}if(m==="]"){c=Math.max(0,c-1),s+=m;continue}if(m===","&&l===0&&c===0){i.push(s.trim()),s="";continue}s+=m}const f=s.trim();return f.length>0&&i.push(f),i},[]),e=B.useCallback(r=>{const i=String(r||"").trim(),s=i.toLowerCase();if(i==="T"||s==="true")return!0;if(i==="F"||s==="false")return!1;if(/^[+-]?\d+$/.test(i))return parseInt(i,10);if(i.startsWith("'")&&i.endsWith("'"))return i.slice(1,-1);if(i.startsWith("[")&&i.endsWith("]")){const l=i.slice(1,-1).trim();return l?t(l).map(e):[]}if(i.startsWith("(")&&i.endsWith(")")){const l=i.slice(1,-1).trim();let c=0,u=-1;for(let f=0;f<l.length;f++){const h=l[f];if(h==="(")c++;else if(h===")")c=Math.max(0,c-1);else if(h===","&&c===0){u=f;break}}if(u>=0)return{__pair__:!0,fst:e(l.slice(0,u)),snd:e(l.slice(u+1))}}return null},[t]);return{parseValueTokensInput:B.useCallback(r=>{const i=String(r||"").trim();return i?t(i).map(e).filter(s=>s!==null):[]},[t,e]),splitTopLevelCommas:t}}function b_(){const t=B.useCallback(n=>{const r=[];let i="",s=0,l=0;for(let c=0;c<n.length;c++){const u=n[c];if(u==="(")s++;else if(u===")")s=Math.max(0,s-1);else if(u==="[")l++;else if(u==="]")l=Math.max(0,l-1);else if(u===","&&s===0&&l===0){r.push(i.trim()),i="";continue}i+=u}return i.trim()&&r.push(i.trim()),r.filter(Boolean)},[]),e=B.useCallback(n=>{const r=t(String(n||""));for(const i of r){try{i5(i);continue}catch{}try{jt(i);continue}catch{}try{xo(i,jt);continue}catch{}return{ok:!1,error:`Invalid binding: ${i}`}}return{ok:!0,bindings:r}},[t]);return{splitTopLevel:t,validateBindings:e}}const E_=({getElementInfo:t,setElements:e,updateHistory:n,setFormValues:r})=>B.useCallback(i=>{const s=i.target.value;r(u=>({...u,label:s}));const{elementId:l,elementType:c}=t();c==="place"?e(u=>({...u,places:u.places.map(f=>f.id===l?{...f,label:s}:f)})):c==="transition"?e(u=>({...u,transitions:u.transitions.map(f=>f.id===l?{...f,label:s}:f)})):c==="arc"&&e(u=>({...u,arcs:u.arcs.map(f=>f.id===l?{...f,label:s}:f)})),n()},[t,e,n,r]),P_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,parseValueTokensInput:l,showInferredTypes:c})=>{const u=B.useCallback(m=>{let x=parseInt(m.target.value,10);Number.isFinite(x)||(x=0),x<0&&(x=0),e(w=>({...w,tokens:x}));const{elementId:y}=n();r(w=>({...w,places:w.places.map(T=>T.id===y?{...T,tokens:x}:T)})),i()},[n,r,i,e]),f=B.useCallback(()=>{const m=t.valueTokensInput.trim(),{elementId:x}=n();if(!m){r(w=>({...w,places:w.places.map(T=>T.id===x?{...T,valueTokens:[],tokens:0}:T)})),i();return}const y=l(m);r(w=>{const T={...w,places:w.places.map(k=>k.id===x?{...k,valueTokens:y,tokens:y.length}:k)};return dl(T,s,c)}),i()},[t.valueTokensInput,n,s,l,r,i,c]),h=B.useCallback(m=>Array.isArray(m.valueTokens)?a5(m.valueTokens):"",[]);return{handleTokensChange:u,handleValueTokensBlur:f,serializeTokensFromElement:h}},N_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,validateBindings:l,showInferredTypes:c})=>{const u=B.useCallback(m=>{const x=parseInt(m.target.value,10)||1;e(w=>({...w,weight:x}));const{elementId:y}=n();r(w=>({...w,arcs:w.arcs.map(T=>T.id===y?{...T,weight:x}:T)})),i()},[n,r,i,e]),f=B.useCallback(()=>{const m=t.bindingsInput.trim();e(k=>({...k,bindingError:null}));const{elementId:x}=n();if(!m){r(k=>({...k,arcs:k.arcs.map(_=>_.id===x?{..._,bindings:[]}:_)})),i();return}const{ok:y,bindings:w,error:T}=l(m);if(!y){e(k=>({...k,bindingError:T}));return}r(k=>({...k,arcs:k.arcs.map(_=>_.id===x?{..._,bindings:w}:_)})),i(),r(k=>{const _={...k,arcs:k.arcs.map(C=>C.id===x?{...C,bindings:w}:C)};return dl(_,s,c)}),i()},[t.bindingsInput,n,s,r,e,i,l,c]),h=B.useCallback((m,x)=>m!=="arc"||!Array.isArray(x.bindings)?"":x.bindings.map(y=>{const w=String(y||"");return/^true$/i.test(w)?"T":/^false$/i.test(w)?"F":s5(w)}).join(", "),[]);return{handleWeightChange:u,handleBindingsBlur:f,serializeBindingsFromElement:h}},A_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,showInferredTypes:l})=>({handleGuardBlur:B.useCallback(()=>{const u=t.guardText.trim();e(h=>({...h,guardError:null}));const{elementId:f}=n();if(!u){r(h=>({...h,transitions:h.transitions.map(m=>m.id===f?{...m,guard:""}:m)})),i();return}try{xo(u,jt),r(h=>({...h,transitions:h.transitions.map(m=>m.id===f?{...m,guard:u}:m)})),i(),r(h=>{const m={...h,transitions:h.transitions.map(x=>x.id===f?{...x,guard:u}:x)};return dl(m,s,l)}),i()}catch(h){e(m=>({...m,guardError:`Invalid guard: ${h.message}`}))}},[t.guardText,n,s,r,e,i,l])}),M_=({elements:t,netMode:e,setElements:n,updateHistory:r,showInferredTypes:i})=>{const s=i??!0,l=B.useCallback(u=>{if(!s||!(t!=null&&t.places)||!(t!=null&&t.arcs)||e!=="algebraic-int")return;const f=t.places.find(y=>y.id===u);if(!f||!f.valueTokens||f.valueTokens.length===0)return;const h=Ja(f.valueTokens[f.valueTokens.length-1]),x=t.arcs.filter(y=>y.source===u).reduce((y,w)=>{if(!Array.isArray(w.bindings)||w.bindings.length===0)return y;const T=w.bindings[0];if(!T||!s&&T.includes(":"))return y;const k=T.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(!k)return y;const _=new Map;if(k.forEach(g=>{["true","false","and","or","not"].includes(g)||_.set(g,h)}),_.size===0)return y;const C=Xu(T,_,null,{overwrite:s});return C!==T&&y.push({arcId:w.id,newBinding:C}),y},[]);x.length!==0&&(n(y=>({...y,arcs:y.arcs.map(w=>{const T=x.find(k=>k.arcId===w.id);return T?{...w,bindings:[T.newBinding]}:w})})),r())},[t,e,n,r,s]),c=B.useCallback(()=>{if(!s)return;const u=dl(t,e,s);u!==t&&(n(u),r())},[t,e,n,r,s]);return{inferTypesForPlace:l,performGlobalTypeInference:c}};function R_({selectedElement:t,elements:e,setElements:n,updateHistory:r,netMode:i,showInferredTypes:s=!0}){const[l,c]=B.useState({label:"",tokens:0,weight:1,valueTokensInput:"",bindingsInput:"",bindingError:null,guardText:"",guardError:null}),{parseValueTokensInput:u}=C_(),{validateBindings:f}=b_(),h=B.useCallback(()=>{if(!t)return{elementId:"",elementType:""};const b=t.id||t.element&&t.element.id||"",N=t.type||b.split("-")[0];return{elementId:b,elementType:N}},[t]),{handleTokensChange:m,handleValueTokensBlur:x,serializeTokensFromElement:y}=P_({formValues:l,setFormValues:c,getElementInfo:h,setElements:n,updateHistory:r,netMode:i,parseValueTokensInput:u,showInferredTypes:s}),{handleWeightChange:w,handleBindingsBlur:T,serializeBindingsFromElement:k}=N_({formValues:l,setFormValues:c,getElementInfo:h,setElements:n,updateHistory:r,netMode:i,validateBindings:f,showInferredTypes:s}),{handleGuardBlur:_}=A_({formValues:l,setFormValues:c,getElementInfo:h,setElements:n,updateHistory:r,netMode:i,showInferredTypes:s}),C=E_({getElementInfo:h,setElements:n,updateHistory:r,setFormValues:c}),{inferTypesForPlace:g,performGlobalTypeInference:S}=M_({elements:e,netMode:i,setElements:n,updateHistory:r,showInferredTypes:s});return B.useEffect(()=>{if(!t)return;const{elementType:b}=h(),N=b==="transition"?String(t.guard||"").replace(/\btrue\b/gi,"T").replace(/\bfalse\b/gi,"F"):"";c(I=>({...I,label:t.label||"",tokens:t.tokens||0,weight:t.weight!==void 0?t.weight:1,valueTokensInput:y(t),bindingsInput:k(b,t),guardText:N}))},[t,h,y,k,c]),{formValues:l,setFormValues:c,handleLabelChange:C,handleTokensChange:m,handleWeightChange:w,handleValueTokensBlur:x,handleBindingsBlur:T,handleGuardBlur:_,inferTypesForPlace:g,performGlobalTypeInference:S,getElementInfo:h}}const I_=({selectedElement:t,elements:e,setElements:n,updateHistory:r,simulationSettings:i})=>{const s=B.useContext(ag)||{};s.enabledTransitionIds,s.isSimulatorReady;const l=(i==null?void 0:i.netMode)||"pt",c=!!(i!=null&&i.showInferredTypes),{formValues:u,setFormValues:f,handleLabelChange:h,handleTokensChange:m,handleWeightChange:x,handleValueTokensBlur:y,handleBindingsBlur:w,handleGuardBlur:T,getElementInfo:k}=R_({selectedElement:t,elements:e,setElements:n,updateHistory:r,netMode:l,showInferredTypes:c});if(!t)return null;const{elementType:_}=k();return P.jsxs("div",{className:"properties-panel w-full px-4 py-2 overflow-y-auto mx-0",children:[P.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Properties"}),P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Label"}),P.jsx("input",{type:"text",value:u.label,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"P1, P2, etc."})]}),t&&_==="place"&&P.jsx(S_,{mode:l,tokens:u.tokens,valueTokensInput:u.valueTokensInput,onTokensChange:m,onValueTokensChange:C=>f(g=>({...g,valueTokensInput:C.target.value})),onValueTokensBlur:y}),t&&_==="arc"&&P.jsx(k_,{mode:l,weight:u.weight,bindingsInput:u.bindingsInput,bindingError:u.bindingError,onWeightChange:x,onBindingsChange:C=>f(g=>({...g,bindingsInput:C.target.value})),onBindingsBlur:w}),t&&_==="transition"&&l==="algebraic-int"&&P.jsx(T_,{guardText:u.guardText,guardError:u.guardError,onGuardChange:C=>f(g=>({...g,guardText:C.target.value})),onGuardBlur:T})]})},L_=({enabledTransitions:t,isLoading:e,isOpen:n,onClose:r,onFire:i})=>n?P.jsxs("div",{"data-testid":"enabled-transitions",className:"enabled-transitions-panel mt-4 p-4 bg-gray-50 border border-gray-200 rounded-md",children:[P.jsxs("div",{className:"flex justify-between items-center mb-3",children:[P.jsx("h3",{className:"text-md font-semibold",children:"Enabled Transitions"}),P.jsx("span",{onClick:r,role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r&&r())},className:"text-gray-500 hover:text-gray-800 cursor-pointer select-none","aria-label":"Close enabled transitions panel",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e?P.jsx("p",{className:"text-gray-500",children:"Loading..."}):t.length===0?P.jsx("p",{className:"text-gray-500",children:"No enabled transitions"}):P.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-64 overflow-y-auto pr-1",children:t.map(s=>P.jsx("button",{type:"button",className:"flex items-center text-left hover:bg-gray-100 rounded px-1 py-0.5",onClick:()=>i&&i(s.id),"data-testid":`enabled-${s.label||s.id}`,title:s.label||s.id,children:P.jsx("span",{className:"font-medium",children:s.label||s.id.substring(11,17)})},s.id))})]}):null,F_=({elements:t,enabledTransitionIds:e})=>{const{handleFireTransition:n,netMode:r}=en(),[i,s]=B.useState(!1),[l,c]=B.useState(!1);return P.jsxs("div",{className:"pt-4 mt-4 px-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Petri Net"}),P.jsxs("div",{className:"mb-4 pl-1",children:[P.jsxs("div",{className:"flex justify-between items-center mb-2",children:[P.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Current Markings"}),P.jsxs("button",{"data-testid":"toggle-markings",className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm flex items-center space-x-1 transition-colors",onClick:()=>s(!i),children:[P.jsx("span",{children:i?"Hide":"Show"}),P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})]}),i&&P.jsx("div",{"data-testid":"current-marking",className:"markings-panel p-3 bg-gray-50 border border-gray-200 rounded-md",children:(t.places||[]).length===0?P.jsx("p",{className:"text-gray-500 text-sm",children:"No places defined"}):P.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto pr-1",children:(t.places||[]).filter(u=>r==="algebraic-int"?(Array.isArray(u.valueTokens)?u.valueTokens:[]).length>0:!0).map(u=>{const f=u.label||u.name||u.id.substring(6,12),h=u.tokens||0,m=Array.isArray(u.valueTokens)?u.valueTokens:[],x=r==="algebraic-int"&&Array.isArray(u.valueTokens),y=x?a5(m):"";return P.jsxs("div",{className:"flex items-start text-sm",children:[P.jsx("span",{className:"font-medium text-gray-800 mr-2 truncate",title:f,children:f}),x?P.jsx("div",{className:"flex-1 text-gray-800 bg-purple-50 border border-purple-200 rounded px-2 py-1 whitespace-pre-wrap break-words overflow-visible",title:y,children:y||"[]"}):P.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-purple-100 text-purple-800 border border-purple-200 font-semibold min-w-[2rem] justify-center",children:h})]},u.id)})})})]}),P.jsxs("div",{className:"mb-2 pl-1",children:[P.jsxs("div",{className:"flex justify-between items-center mb-2",children:[P.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Enabled Transitions"}),P.jsxs("button",{"data-testid":"show-enabled-transitions",className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm flex items-center space-x-1 transition-colors",onClick:()=>c(!l),children:[P.jsx("span",{children:l?"Hide":"Show"}),P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})]}),l&&P.jsx(L_,{isOpen:!0,enabledTransitions:(e||[]).map(u=>{const f=(t.transitions||[]).find(h=>h.id===u);return{id:u,label:f&&(f.label||f.name)||u}}),isLoading:!1,onClose:()=>c(!1),onFire:u=>n&&n(u)})]})]})};const Pu=({stats:t,onDismiss:e})=>{if(!t)return null;const n=r=>{if(r<1e3)return`${r}ms`;const i=Math.floor(r/1e3),s=Math.floor(i/60),l=i%60;return s>0?`${s}m ${l}s`:`${i}s`};return P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:P.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md mx-4",children:[P.jsxs("div",{className:"flex items-center mb-4",children:[P.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3",children:P.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),P.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Simulation Complete"})]}),P.jsxs("div",{className:"space-y-3 mb-6",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-gray-600",children:"Duration:"}),P.jsx("span",{className:"font-medium text-gray-900",children:n(t.elapsedMs)})]}),P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-gray-600",children:"Transitions Fired:"}),P.jsx("span",{className:"font-medium text-gray-900",children:t.transitionsFired})]})]}),P.jsx("div",{className:"flex justify-end",children:P.jsx("button",{onClick:e,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"OK"})})]})})},Qy=({isMobile:t=!1})=>{const{isContinuousSimulating:e,isRunning:n,enabledTransitionIds:r,simulationError:i,isSimulatorReady:s,stepSimulation:l,startContinuousSimulation:c,startRunSimulation:u,stopAllSimulations:f,completionStats:h,dismissCompletionDialog:m}=en(),[x,y]=B.useState(!1),w=e||n,T=s&&r.length>0,k=T?"opacity-100":"opacity-50";if(B.useEffect(()=>{w&&y(!0)},[w]),t){const _=i&&P.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-full mb-2 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg text-xs whitespace-nowrap z-50",children:i});return x?w?P.jsxs(P.Fragment,{children:[P.jsxs("div",{"data-testid":"simulation-manager-mobile",className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40",children:[_,P.jsxs("div",{className:"bg-white/95 backdrop-blur-md rounded-full px-4 py-2 shadow-2xl border border-gray-200/50 flex items-center gap-3",children:[n&&P.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[P.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full sim-pulse-strong"}),P.jsx("span",{className:"text-xs font-medium",children:"Running"})]}),P.jsx("button",{"data-testid":"sim-stop-mobile",className:"bg-red-600 text-white rounded-full p-3 hover:bg-red-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!0}catch{}f()},disabled:!w,title:"Stop simulation",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("rect",{x:"7",y:"7",width:"10",height:"10"})})}),P.jsx("button",{onClick:()=>y(!1),className:"text-gray-500 hover:text-gray-700 rounded-full p-2 hover:bg-gray-100 transition-all",title:"Minimize",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]})]}),P.jsx(Pu,{stats:h,onDismiss:m})]}):P.jsxs(P.Fragment,{children:[P.jsxs("div",{"data-testid":"simulation-manager-mobile",className:`fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40 transition-opacity duration-300 ${k}`,children:[_,P.jsxs("div",{className:`bg-white/95 backdrop-blur-md rounded-full px-3 py-2 shadow-2xl border border-gray-200/50 flex items-center gap-2 ${T?"":"opacity-60"}`,children:[P.jsx("button",{"data-testid":"sim-step-mobile",className:"bg-blue-600 text-white rounded-full p-3 hover:bg-blue-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:l,disabled:!s||r.length===0,title:"Step forward",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),P.jsx("button",{"data-testid":"sim-simulate-mobile",className:"bg-green-600 text-white rounded-full p-3 hover:bg-green-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:c,disabled:!s||r.length===0,title:"Simulate with animation",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})}),P.jsx("button",{"data-testid":"sim-run-mobile",className:"bg-yellow-600 text-white rounded-full p-3 hover:bg-yellow-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!1}catch{}u()},disabled:!s||r.length===0,title:"Run to completion",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7"})})}),P.jsx("button",{onClick:()=>y(!1),className:"text-gray-500 hover:text-gray-700 rounded-full p-2 hover:bg-gray-100 transition-all ml-1",title:"Minimize",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]})]}),P.jsx(Pu,{stats:h,onDismiss:m})]}):P.jsxs(P.Fragment,{children:[P.jsxs("div",{"data-testid":"simulation-manager-mobile",className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40",children:[_,P.jsx("button",{onClick:()=>y(!0),className:`bg-white/95 backdrop-blur-md rounded-full p-4 shadow-2xl border border-gray-200/50 transition-all hover:scale-110 ${T?"":"opacity-60"}`,title:"Open simulation controls",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})})]}),P.jsx(Pu,{stats:h,onDismiss:m})]})}return P.jsxs("div",{"data-testid":"simulation-manager",className:"simulation-manager w-full px-4 py-2 mx-0",children:[P.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Simulation"}),i&&P.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4",children:i}),P.jsxs("div",{className:"bg-gray-200 p-3 rounded-lg shadow-lg border border-gray-300",children:[P.jsxs("div",{className:"flex items-center justify-between space-x-3 mb-3",children:[P.jsxs("button",{"data-testid":"sim-step",className:"flex-1 h-12 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:l,disabled:!s||w||r.length===0,title:"Execute one step forward",children:[P.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),P.jsx("span",{className:"text-xs font-bold",children:"Step"})]}),P.jsxs("button",{"data-testid":"sim-simulate",className:"flex-1 h-12 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:c,disabled:!s||w||r.length===0,title:"Simulate with animation",children:[P.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})}),P.jsx("span",{className:"text-xs font-bold",children:"Simulate"})]}),P.jsxs("button",{"data-testid":"sim-run",className:"flex-1 h-12 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!1}catch{}u()},disabled:!s||w||r.length===0,title:"Run to completion",children:[P.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7"})})}),P.jsx("span",{className:"text-xs font-bold",children:"Run"})]})]}),P.jsx("div",{children:P.jsxs("button",{"data-testid":"sim-stop",className:"w-full h-10 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 flex items-center justify-center space-x-2 transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!0}catch{}f()},disabled:!w,title:"Stop simulation or run",children:[P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("rect",{x:"7",y:"7",width:"10",height:"10"})}),P.jsx("span",{className:"text-sm font-bold",children:"STOP"})]})}),n&&P.jsx("div",{className:"mt-2 flex items-center justify-center",children:P.jsxs("span",{className:"inline-flex items-center space-x-1 text-green-600",children:[P.jsx("span",{className:"w-4 h-4 bg-green-500 rounded-full sim-pulse-strong"}),P.jsx("span",{className:"font-medium text-sm",children:"Simulation running..."})]})})]}),P.jsx(Pu,{stats:h,onDismiss:m})]})},j_=({isOpen:t,onClose:e})=>{const{z3Settings:n,setZ3Settings:r}=en(),[i,s]=B.useState(0),[l,c]=B.useState(3e5),[u,f]=B.useState(!0),[h,m]=B.useState(1e4);B.useEffect(()=>{t&&(s(Number((n==null?void 0:n.poolSize)??0)),c(Number((n==null?void 0:n.idleTimeoutMs)??3e5)),f(!!((n==null?void 0:n.prewarmOnAlgebraicMode)??!0)),m(Number((n==null?void 0:n.solverTimeoutMs)??1e4)))},[t,n]);const x=()=>{const y={poolSize:Math.max(0,Number(i)||0),idleTimeoutMs:Math.max(1e3,Number(l)||3e5),prewarmOnAlgebraicMode:!!u,solverTimeoutMs:Math.max(100,Number(h)||1e4)};try{typeof window<"u"&&Br(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url).then(w=>w.setZ3WorkerConfig(y)).catch(()=>{})}catch{}try{r(y)}catch{}e==null||e()};return t?P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:P.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4",children:[P.jsxs("div",{className:"flex justify-between items-center mb-4",children:[P.jsx("h2",{className:"text-xl font-semibold",children:"Z3 Settings"}),P.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:""})]}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Worker Pool"}),P.jsx("div",{className:"space-y-3",children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"Pool size (0 = on-demand)"}),P.jsx("input",{type:"number",min:0,max:8,value:i,onChange:y=>s(y.target.value),className:"w-24 border rounded px-2 py-1 text-sm"})]})})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lifecycle"}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"idleTimeoutMs"}),P.jsx("input",{type:"number",min:1e3,max:36e5,step:1e3,value:l,onChange:y=>c(y.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:u,onChange:y=>f(y.target.checked),className:"mr-2"}),"Pre-warm when switching to Algebraic mode"]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"Solver timeout (ms)"}),P.jsx("input",{type:"number",min:100,max:6e4,step:100,value:h,onChange:y=>m(y.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]})]})]}),P.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-3",children:[P.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-1",children:"Notes"}),P.jsxs("ul",{className:"text-xs text-purple-700 space-y-1",children:[P.jsx("li",{children:" Pool size 0 keeps workers off until a batch run forces 8 workers"}),P.jsx("li",{children:" Idle timeout trims the pool back to the configured size after bursts"}),P.jsx("li",{children:" Pre-warm hides first-use latency when switching to algebraic-int"}),P.jsx("li",{children:" Solver timeout applies to boolean predicate checks (headless runs benefit from a shorter timeout)"})]})]})]}),P.jsxs("div",{className:"mt-6 flex justify-end",children:[P.jsx("button",{onClick:e,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors mr-2",children:"Cancel"}),P.jsx("button",{onClick:x,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:"Save"})]})]})}):null},fa=2e5,O_=({isOpen:t,onClose:e})=>{const{simulatorCore:n,simulationSettings:r,handleSaveSettings:i,elements:s,z3Settings:l,setZ3Settings:c}=en(),[u,f]=B.useState("single"),[h,m]=B.useState(!1),[x,y]=B.useState(fa),[w,T]=B.useState(!1),[k,_]=B.useState("pt"),[C,g]=B.useState(!1),[S,b]=B.useState(!1),[N,I]=B.useState(!1),[A,F]=B.useState(!1),[M,R]=B.useState(!1);B.useEffect(()=>{var j,D,G;if(t){try{if(n){const q=n.getSimulationMode?n.getSimulationMode():"single";f(q)}}catch(q){pe.warn("Could not get current simulation mode:",q)}const H=Number((r==null?void 0:r.maxIterations)??fa),O=!!(r!=null&&r.limitIterations);T(O);const $=Number.isFinite(H)&&H>0?Math.max(1,Math.min(1e6,Math.floor(H))):fa;y($);const W=(r==null?void 0:r.netMode)||"pt";_(W);const K=!!(r!=null&&r.batchMode);F(K);const Q=!!(K||r!=null&&r.useNonVisualRun);I(Q),R(!!(r!=null&&r.showInferredTypes)),K&&u!=="maximal"&&z("maximal");try{const q=(((j=s==null?void 0:s.places)==null?void 0:j.length)||0)>0||(((D=s==null?void 0:s.transitions)==null?void 0:D.length)||0)>0||(((G=s==null?void 0:s.arcs)==null?void 0:G.length)||0)>0;g(!!q)}catch{g(!1)}}},[t,n,r]);const z=async j=>{if(!n||!n.setSimulationMode){f(j);return}m(!0);try{await n.setSimulationMode(j),f(j),pe.info("Simulation mode changed to:",j)}catch(D){pe.error("Failed to change simulation mode:",D),f(u)}finally{m(!1)}},V=()=>{const j=!!w,D=Math.max(1,Math.min(1e6,Math.floor(Number(x)||fa)));i({...r,maxIterations:j?D:fa,limitIterations:j,netMode:k,useNonVisualRun:A?!0:N,batchMode:A,showInferredTypes:M}),e==null||e()};return t?P.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:[P.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4 max-h-[90vh] flex flex-col",children:[P.jsxs("div",{className:"flex justify-between items-center mb-4",children:[P.jsx("h2",{className:"text-xl font-semibold",children:"Simulation Settings"}),P.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold","data-testid":"settings-close",children:""})]}),P.jsxs("div",{className:"space-y-4 overflow-y-auto flex-1 pr-2",children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Limits"}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"Max iterations"}),P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx("input",{type:"number",min:1,max:1e6,value:x,onChange:j=>y(j.target.value),disabled:!w,className:"w-24 border rounded px-2 py-1 text-sm disabled:bg-gray-100"}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:w,onChange:j=>{const D=j.target.checked;T(D),D&&(!Number.isFinite(Number(x))||Number(x)<=0)&&y(100)},className:"mr-1"}),"Limit iterations"]})]})]}),!w&&P.jsx("div",{className:"text-xs text-gray-600",children:"Default runs allow up to 200,000 steps when this option is unchecked."})]})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Run Options"}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:A?!0:N,onChange:j=>{const D=j.target.checked;I(D)},disabled:A,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Use non-visual execution for Run"})," - No per-step animations"]})]}),P.jsxs("label",{className:"flex items-center text-sm mt-2",children:[P.jsx("input",{type:"checkbox",checked:A,onChange:j=>{const D=j.target.checked;if(F(D),D){I(!0),z("maximal");try{c(G=>{const H=G?{...G}:l?{...l}:{};return Number(H.poolSize||0)>=8?H:{...H,poolSize:8}})}catch{}}},className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Batch mode"})," - Always headless, keeps background worker active"]})]}),A&&P.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Batch mode forces non-visual execution and reuses the simulation worker after the first run."})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type Annotations"}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:M,onChange:j=>R(j.target.checked),className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Show inferred variable types"}),"  Display automatically inferred types in guards and bindings"]})]}),P.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"When off, only manually annotated types remain visible so expressions stay concise."})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulation Mode"}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"simulationMode",value:"single",checked:u==="single",onChange:j=>z(j.target.value),disabled:h,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Single Transition"})," - Fire one enabled transition at random"]})]}),P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"simulationMode",value:"maximal",checked:u==="maximal",onChange:j=>z(j.target.value),disabled:h,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Maximal Concurrent"})," - Fire all non-conflicting enabled transitions simultaneously"]})]})]})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Net Type"}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"netMode",value:"pt",checked:k==="pt",onChange:j=>_(j.target.value),disabled:C,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"P/T Net"})," - Classic place/transition nets with counts"]})]}),P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"netMode",value:"algebraic-int",checked:k==="algebraic-int",onChange:j=>_(j.target.value),disabled:C,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Algebraic (Integer)"})," - Integer tokens with guard and term labels"]})]}),C&&P.jsx("div",{className:"text-xs text-gray-600",children:"Net type is locked while the canvas has elements. Clear the canvas to switch."})]})]}),h&&P.jsx("div",{className:"text-center text-sm text-gray-600",children:"Updating simulation mode..."})]}),P.jsxs("div",{className:"mt-6 pt-4 flex justify-end border-t border-gray-200",children:[P.jsx("button",{onClick:()=>b(!0),className:"px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition-colors mr-auto",children:"Z3 Settings"}),P.jsx("button",{onClick:e,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors mr-2","data-testid":"settings-cancel",children:"Cancel"}),P.jsx("button",{onClick:V,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors","data-testid":"settings-save",children:"Save"})]})]}),S&&P.jsx(j_,{isOpen:S,onClose:()=>b(!1)})]}):null};var A5={exports:{}},Yc={},Cc={},Pe={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object globalThis]")}t.glob=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.20",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const r=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=r,t.Konva._injectGlobal(t.Konva)})(Pe);var at={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Pe;class n{constructor(S=[1,0,0,1,0,0]){this.dirty=!1,this.m=S&&S.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(S){S.m[0]=this.m[0],S.m[1]=this.m[1],S.m[2]=this.m[2],S.m[3]=this.m[3],S.m[4]=this.m[4],S.m[5]=this.m[5]}point(S){const b=this.m;return{x:b[0]*S.x+b[2]*S.y+b[4],y:b[1]*S.x+b[3]*S.y+b[5]}}translate(S,b){return this.m[4]+=this.m[0]*S+this.m[2]*b,this.m[5]+=this.m[1]*S+this.m[3]*b,this}scale(S,b){return this.m[0]*=S,this.m[1]*=S,this.m[2]*=b,this.m[3]*=b,this}rotate(S){const b=Math.cos(S),N=Math.sin(S),I=this.m[0]*b+this.m[2]*N,A=this.m[1]*b+this.m[3]*N,F=this.m[0]*-N+this.m[2]*b,M=this.m[1]*-N+this.m[3]*b;return this.m[0]=I,this.m[1]=A,this.m[2]=F,this.m[3]=M,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(S,b){const N=this.m[0]+this.m[2]*b,I=this.m[1]+this.m[3]*b,A=this.m[2]+this.m[0]*S,F=this.m[3]+this.m[1]*S;return this.m[0]=N,this.m[1]=I,this.m[2]=A,this.m[3]=F,this}multiply(S){const b=this.m[0]*S.m[0]+this.m[2]*S.m[1],N=this.m[1]*S.m[0]+this.m[3]*S.m[1],I=this.m[0]*S.m[2]+this.m[2]*S.m[3],A=this.m[1]*S.m[2]+this.m[3]*S.m[3],F=this.m[0]*S.m[4]+this.m[2]*S.m[5]+this.m[4],M=this.m[1]*S.m[4]+this.m[3]*S.m[5]+this.m[5];return this.m[0]=b,this.m[1]=N,this.m[2]=I,this.m[3]=A,this.m[4]=F,this.m[5]=M,this}invert(){const S=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*S,N=-this.m[1]*S,I=-this.m[2]*S,A=this.m[0]*S,F=S*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=S*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=b,this.m[1]=N,this.m[2]=I,this.m[3]=A,this.m[4]=F,this.m[5]=M,this}getMatrix(){return this.m}decompose(){const S=this.m[0],b=this.m[1],N=this.m[2],I=this.m[3],A=this.m[4],F=this.m[5],M=S*I-b*N,R={x:A,y:F,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(S!=0||b!=0){const z=Math.sqrt(S*S+b*b);R.rotation=b>0?Math.acos(S/z):-Math.acos(S/z),R.scaleX=z,R.scaleY=M/z,R.skewX=(S*N+b*I)/M,R.skewY=0}else if(N!=0||I!=0){const z=Math.sqrt(N*N+I*I);R.rotation=Math.PI/2-(I>0?Math.acos(-N/z):-Math.acos(N/z)),R.scaleX=M/z,R.scaleY=z,R.skewX=0,R.skewY=(S*N+b*I)/M}return R.rotation=t.Util._getRotation(R.rotation),R}}t.Transform=n;const r="[object Array]",i="[object Number]",s="[object String]",l="[object Boolean]",c=Math.PI/180,u=180/Math.PI,f="#",h="",m="0",x="Konva warning: ",y="Konva error: ",w="rgb(",T={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},k=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let _=[];const C=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(g){setTimeout(g,60)};t.Util={_isElement(g){return!!(g&&g.nodeType==1)},_isFunction(g){return!!(g&&g.constructor&&g.call&&g.apply)},_isPlainObject(g){return!!g&&g.constructor===Object},_isArray(g){return Object.prototype.toString.call(g)===r},_isNumber(g){return Object.prototype.toString.call(g)===i&&!isNaN(g)&&isFinite(g)},_isString(g){return Object.prototype.toString.call(g)===s},_isBoolean(g){return Object.prototype.toString.call(g)===l},isObject(g){return g instanceof Object},isValidSelector(g){if(typeof g!="string")return!1;const S=g[0];return S==="#"||S==="."||S===S.toUpperCase()},_sign(g){return g===0||g>0?1:-1},requestAnimFrame(g){_.push(g),_.length===1&&C(function(){const S=_;_=[],S.forEach(function(b){b()})})},createCanvasElement(){const g=document.createElement("canvas");try{g.style=g.style||{}}catch{}return g},createImageElement(){return document.createElement("img")},_isInDocument(g){for(;g=g.parentNode;)if(g==document)return!0;return!1},_urlToImage(g,S){const b=t.Util.createImageElement();b.onload=function(){S(b)},b.src=g},_rgbToHex(g,S,b){return((1<<24)+(g<<16)+(S<<8)+b).toString(16).slice(1)},_hexToRgb(g){g=g.replace(f,h);const S=parseInt(g,16);return{r:S>>16&255,g:S>>8&255,b:S&255}},getRandomColor(){let g=(Math.random()*16777215<<0).toString(16);for(;g.length<6;)g=m+g;return f+g},getRGB(g){let S;return g in T?(S=T[g],{r:S[0],g:S[1],b:S[2]}):g[0]===f?this._hexToRgb(g.substring(1)):g.substr(0,4)===w?(S=k.exec(g.replace(/ /g,"")),{r:parseInt(S[1],10),g:parseInt(S[2],10),b:parseInt(S[3],10)}):{r:0,g:0,b:0}},colorToRGBA(g){return g=g||"black",t.Util._namedColorToRBA(g)||t.Util._hex3ColorToRGBA(g)||t.Util._hex4ColorToRGBA(g)||t.Util._hex6ColorToRGBA(g)||t.Util._hex8ColorToRGBA(g)||t.Util._rgbColorToRGBA(g)||t.Util._rgbaColorToRGBA(g)||t.Util._hslColorToRGBA(g)},_namedColorToRBA(g){const S=T[g.toLowerCase()];return S?{r:S[0],g:S[1],b:S[2],a:1}:null},_rgbColorToRGBA(g){if(g.indexOf("rgb(")===0){g=g.match(/rgb\(([^)]+)\)/)[1];const S=g.split(/ *, */).map(Number);return{r:S[0],g:S[1],b:S[2],a:1}}},_rgbaColorToRGBA(g){if(g.indexOf("rgba(")===0){g=g.match(/rgba\(([^)]+)\)/)[1];const S=g.split(/ *, */).map((b,N)=>b.slice(-1)==="%"?N===3?parseInt(b)/100:parseInt(b)/100*255:Number(b));return{r:S[0],g:S[1],b:S[2],a:S[3]}}},_hex8ColorToRGBA(g){if(g[0]==="#"&&g.length===9)return{r:parseInt(g.slice(1,3),16),g:parseInt(g.slice(3,5),16),b:parseInt(g.slice(5,7),16),a:parseInt(g.slice(7,9),16)/255}},_hex6ColorToRGBA(g){if(g[0]==="#"&&g.length===7)return{r:parseInt(g.slice(1,3),16),g:parseInt(g.slice(3,5),16),b:parseInt(g.slice(5,7),16),a:1}},_hex4ColorToRGBA(g){if(g[0]==="#"&&g.length===5)return{r:parseInt(g[1]+g[1],16),g:parseInt(g[2]+g[2],16),b:parseInt(g[3]+g[3],16),a:parseInt(g[4]+g[4],16)/255}},_hex3ColorToRGBA(g){if(g[0]==="#"&&g.length===4)return{r:parseInt(g[1]+g[1],16),g:parseInt(g[2]+g[2],16),b:parseInt(g[3]+g[3],16),a:1}},_hslColorToRGBA(g){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(g)){const[S,...b]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(g),N=Number(b[0])/360,I=Number(b[1])/100,A=Number(b[2])/100;let F,M,R;if(I===0)return R=A*255,{r:Math.round(R),g:Math.round(R),b:Math.round(R),a:1};A<.5?F=A*(1+I):F=A+I-A*I;const z=2*A-F,V=[0,0,0];for(let j=0;j<3;j++)M=N+1/3*-(j-1),M<0&&M++,M>1&&M--,6*M<1?R=z+(F-z)*6*M:2*M<1?R=F:3*M<2?R=z+(F-z)*(2/3-M)*6:R=z,V[j]=R*255;return{r:Math.round(V[0]),g:Math.round(V[1]),b:Math.round(V[2]),a:1}}},haveIntersection(g,S){return!(S.x>g.x+g.width||S.x+S.width<g.x||S.y>g.y+g.height||S.y+S.height<g.y)},cloneObject(g){const S={};for(const b in g)this._isPlainObject(g[b])?S[b]=this.cloneObject(g[b]):this._isArray(g[b])?S[b]=this.cloneArray(g[b]):S[b]=g[b];return S},cloneArray(g){return g.slice(0)},degToRad(g){return g*c},radToDeg(g){return g*u},_degToRad(g){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(g)},_radToDeg(g){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(g)},_getRotation(g){return e.Konva.angleDeg?t.Util.radToDeg(g):g},_capitalize(g){return g.charAt(0).toUpperCase()+g.slice(1)},throw(g){throw new Error(y+g)},error(g){console.error(y+g)},warn(g){e.Konva.showWarnings&&console.warn(x+g)},each(g,S){for(const b in g)S(b,g[b])},_inRange(g,S,b){return S<=g&&g<b},_getProjectionToSegment(g,S,b,N,I,A){let F,M,R;const z=(g-b)*(g-b)+(S-N)*(S-N);if(z==0)F=g,M=S,R=(I-b)*(I-b)+(A-N)*(A-N);else{const V=((I-g)*(b-g)+(A-S)*(N-S))/z;V<0?(F=g,M=S,R=(g-I)*(g-I)+(S-A)*(S-A)):V>1?(F=b,M=N,R=(b-I)*(b-I)+(N-A)*(N-A)):(F=g+V*(b-g),M=S+V*(N-S),R=(F-I)*(F-I)+(M-A)*(M-A))}return[F,M,R]},_getProjectionToLine(g,S,b){const N=t.Util.cloneObject(g);let I=Number.MAX_VALUE;return S.forEach(function(A,F){if(!b&&F===S.length-1)return;const M=S[(F+1)%S.length],R=t.Util._getProjectionToSegment(A.x,A.y,M.x,M.y,g.x,g.y),z=R[0],V=R[1],j=R[2];j<I&&(N.x=z,N.y=V,I=j)}),N},_prepareArrayForTween(g,S,b){const N=[],I=[];if(g.length>S.length){const F=S;S=g,g=F}for(let F=0;F<g.length;F+=2)N.push({x:g[F],y:g[F+1]});for(let F=0;F<S.length;F+=2)I.push({x:S[F],y:S[F+1]});const A=[];return I.forEach(function(F){const M=t.Util._getProjectionToLine(F,N,b);A.push(M.x),A.push(M.y)}),A},_prepareToStringify(g){let S;g.visitedByCircularReferenceRemoval=!0;for(const b in g)if(g.hasOwnProperty(b)&&g[b]&&typeof g[b]=="object"){if(S=Object.getOwnPropertyDescriptor(g,b),g[b].visitedByCircularReferenceRemoval||t.Util._isElement(g[b]))if(S.configurable)delete g[b];else return null;else if(t.Util._prepareToStringify(g[b])===null)if(S.configurable)delete g[b];else return null}return delete g.visitedByCircularReferenceRemoval,g},_assign(g,S){for(const b in S)g[b]=S[b];return g},_getFirstPointerId(g){return g.touches?g.changedTouches[0].identifier:g.pointerId||999},releaseCanvas(...g){e.Konva.releaseCanvasOnDestroy&&g.forEach(S=>{S.width=0,S.height=0})},drawRoundedRectPath(g,S,b,N){let I=0,A=0,F=0,M=0;typeof N=="number"?I=A=F=M=Math.min(N,S/2,b/2):(I=Math.min(N[0]||0,S/2,b/2),A=Math.min(N[1]||0,S/2,b/2),M=Math.min(N[2]||0,S/2,b/2),F=Math.min(N[3]||0,S/2,b/2)),g.moveTo(I,0),g.lineTo(S-A,0),g.arc(S-A,A,A,Math.PI*3/2,0,!1),g.lineTo(S,b-M),g.arc(S-M,b-M,M,0,Math.PI/2,!1),g.lineTo(F,b),g.arc(F,b-F,F,Math.PI/2,Math.PI,!1),g.lineTo(0,I),g.arc(I,I,I,Math.PI,Math.PI*3/2,!1)}}})(at);var tt={},Ae={},_e={};Object.defineProperty(_e,"__esModule",{value:!0});_e.RGBComponent=D_;_e.alphaComponent=z_;_e.getNumberValidator=B_;_e.getNumberOrArrayOfNumbersValidator=U_;_e.getNumberOrAutoValidator=G_;_e.getStringValidator=V_;_e.getStringOrGradientValidator=W_;_e.getFunctionValidator=$_;_e.getNumberArrayValidator=H_;_e.getBooleanValidator=X_;_e.getComponentValidator=Y_;const Xr=Pe,ut=at;function Yr(t){return ut.Util._isString(t)?'"'+t+'"':Object.prototype.toString.call(t)==="[object Number]"||ut.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}function D_(t){return t>255?255:t<0?0:Math.round(t)}function z_(t){return t>1?1:t<1e-4?1e-4:t}function B_(){if(Xr.Konva.isUnminified)return function(t,e){return ut.Util._isNumber(t)||ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function U_(t){if(Xr.Konva.isUnminified)return function(e,n){let r=ut.Util._isNumber(e),i=ut.Util._isArray(e)&&e.length==t;return!r&&!i&&ut.Util.warn(Yr(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function G_(){if(Xr.Konva.isUnminified)return function(t,e){var n=ut.Util._isNumber(t),r=t==="auto";return n||r||ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function V_(){if(Xr.Konva.isUnminified)return function(t,e){return ut.Util._isString(t)||ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function W_(){if(Xr.Konva.isUnminified)return function(t,e){const n=ut.Util._isString(t),r=Object.prototype.toString.call(t)==="[object CanvasGradient]"||t&&t.addColorStop;return n||r||ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function $_(){if(Xr.Konva.isUnminified)return function(t,e){return ut.Util._isFunction(t)||ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),t}}function H_(){if(Xr.Konva.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(ut.Util._isArray(t)?t.forEach(function(r){ut.Util._isNumber(r)||ut.Util.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}function X_(){if(Xr.Konva.isUnminified)return function(t,e){var n=t===!0||t===!1;return n||ut.Util.warn(Yr(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}function Y_(t){if(Xr.Konva.isUnminified)return function(e,n){return e==null||ut.Util.isObject(e)||ut.Util.warn(Yr(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=at,n=_e,r="get",i="set";t.Factory={addGetterSetter(s,l,c,u,f){t.Factory.addGetter(s,l,c),t.Factory.addSetter(s,l,u,f),t.Factory.addOverloadedGetterSetter(s,l)},addGetter(s,l,c){var u=r+e.Util._capitalize(l);s.prototype[u]=s.prototype[u]||function(){const f=this.attrs[l];return f===void 0?c:f}},addSetter(s,l,c,u){var f=i+e.Util._capitalize(l);s.prototype[f]||t.Factory.overWriteSetter(s,l,c,u)},overWriteSetter(s,l,c,u){var f=i+e.Util._capitalize(l);s.prototype[f]=function(h){return c&&h!==void 0&&h!==null&&(h=c.call(this,h,l)),this._setAttr(l,h),u&&u.call(this),this}},addComponentsGetterSetter(s,l,c,u,f){const h=c.length,m=e.Util._capitalize,x=r+m(l),y=i+m(l);s.prototype[x]=function(){const T={};for(let k=0;k<h;k++){const _=c[k];T[_]=this.getAttr(l+m(_))}return T};const w=(0,n.getComponentValidator)(c);s.prototype[y]=function(T){const k=this.attrs[l];u&&(T=u.call(this,T,l)),w&&w.call(this,T,l);for(const _ in T)T.hasOwnProperty(_)&&this._setAttr(l+m(_),T[_]);return T||c.forEach(_=>{this._setAttr(l+m(_),void 0)}),this._fireChangeEvent(l,k,T),f&&f.call(this),this},t.Factory.addOverloadedGetterSetter(s,l)},addOverloadedGetterSetter(s,l){var c=e.Util._capitalize(l),u=i+c,f=r+c;s.prototype[l]=function(){return arguments.length?(this[u](arguments[0]),this):this[f]()}},addDeprecatedGetterSetter(s,l,c,u){e.Util.error("Adding deprecated "+l);const f=r+e.Util._capitalize(l),h=l+" property is deprecated and will be removed soon. Look at Konva change log for more information.";s.prototype[f]=function(){e.Util.error(h);const m=this.attrs[l];return m===void 0?c:m},t.Factory.addSetter(s,l,u,function(){e.Util.error(h)}),t.Factory.addOverloadedGetterSetter(s,l)},backCompat(s,l){e.Util.each(l,function(c,u){const f=s.prototype[u],h=r+e.Util._capitalize(c),m=i+e.Util._capitalize(c);function x(){f.apply(this,arguments),e.Util.error('"'+c+'" method is deprecated and will be removed soon. Use ""'+u+'" instead.')}s.prototype[c]=x,s.prototype[h]=x,s.prototype[m]=x})},afterSetFilter(){this._filterUpToDate=!1}}})(Ae);var sr={},Ur={};Object.defineProperty(Ur,"__esModule",{value:!0});Ur.HitContext=Ur.SceneContext=Ur.Context=void 0;const M5=at,K_=Pe;function Q_(t){const e=[],n=t.length,r=M5.Util;for(let i=0;i<n;i++){let s=t[i];r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s+""),e.push(s)}return e}const Zy=",",Z_="(",q_=")",J_="([",eS="])",tS=";",nS="()",rS="=",qy=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],iS=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],sS=100;class Kc{constructor(e){this.canvas=e,K_.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,n){let r=this.traceArr,i=r.length,s="",l,c,u,f;for(l=0;l<i;l++)c=r[l],u=c.method,u?(f=c.args,s+=u,e?s+=nS:M5.Util._isArray(f[0])?s+=J_+f.join(Zy)+eS:(n&&(f=f.map(h=>typeof h=="number"?Math.floor(h):h)),s+=Z_+f.join(Zy)+q_)):(s+=c.property,e||(s+=rS+c.val)),s+=tS;return s}clearTrace(){this.traceArr=[]}_trace(e){let n=this.traceArr,r;n.push(e),r=n.length,r>=sS&&n.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const n=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,n.getWidth()/n.pixelRatio,n.getHeight()/n.pixelRatio)}_applyLineCap(e){const n=e.attrs.lineCap;n&&this.setAttr("lineCap",n)}_applyOpacity(e){const n=e.getAbsoluteOpacity();n!==1&&this.setAttr("globalAlpha",n)}_applyLineJoin(e){const n=e.attrs.lineJoin;n&&this.setAttr("lineJoin",n)}setAttr(e,n){this._context[e]=n}arc(e,n,r,i,s,l){this._context.arc(e,n,r,i,s,l)}arcTo(e,n,r,i,s){this._context.arcTo(e,n,r,i,s)}beginPath(){this._context.beginPath()}bezierCurveTo(e,n,r,i,s,l){this._context.bezierCurveTo(e,n,r,i,s,l)}clearRect(e,n,r,i){this._context.clearRect(e,n,r,i)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,n){const r=arguments;if(r.length===2)return this._context.createImageData(e,n);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,n,r,i){return this._context.createLinearGradient(e,n,r,i)}createPattern(e,n){return this._context.createPattern(e,n)}createRadialGradient(e,n,r,i,s,l){return this._context.createRadialGradient(e,n,r,i,s,l)}drawImage(e,n,r,i,s,l,c,u,f){const h=arguments,m=this._context;h.length===3?m.drawImage(e,n,r):h.length===5?m.drawImage(e,n,r,i,s):h.length===9&&m.drawImage(e,n,r,i,s,l,c,u,f)}ellipse(e,n,r,i,s,l,c,u){this._context.ellipse(e,n,r,i,s,l,c,u)}isPointInPath(e,n,r,i){return r?this._context.isPointInPath(r,e,n,i):this._context.isPointInPath(e,n,i)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,n,r,i){this._context.fillRect(e,n,r,i)}strokeRect(e,n,r,i){this._context.strokeRect(e,n,r,i)}fillText(e,n,r,i){i?this._context.fillText(e,n,r,i):this._context.fillText(e,n,r)}measureText(e){return this._context.measureText(e)}getImageData(e,n,r,i){return this._context.getImageData(e,n,r,i)}lineTo(e,n){this._context.lineTo(e,n)}moveTo(e,n){this._context.moveTo(e,n)}rect(e,n,r,i){this._context.rect(e,n,r,i)}roundRect(e,n,r,i,s){this._context.roundRect(e,n,r,i,s)}putImageData(e,n,r){this._context.putImageData(e,n,r)}quadraticCurveTo(e,n,r,i){this._context.quadraticCurveTo(e,n,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,n){this._context.scale(e,n)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,n,r,i,s,l){this._context.setTransform(e,n,r,i,s,l)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,n,r,i){this._context.strokeText(e,n,r,i)}transform(e,n,r,i,s,l){this._context.transform(e,n,r,i,s,l)}translate(e,n){this._context.translate(e,n)}_enableTrace(){let e=this,n=qy.length,r=this.setAttr,i,s;const l=function(c){let u=e[c],f;e[c]=function(){return s=Q_(Array.prototype.slice.call(arguments,0)),f=u.apply(e,arguments),e._trace({method:c,args:s}),f}};for(i=0;i<n;i++)l(qy[i]);e.setAttr=function(){r.apply(e,arguments);const c=arguments[0];let u=arguments[1];(c==="shadowOffsetX"||c==="shadowOffsetY"||c==="shadowBlur")&&(u=u/this.canvas.getPixelRatio()),e._trace({property:c,val:u})}}_applyGlobalCompositeOperation(e){const n=e.attrs.globalCompositeOperation;!n||n==="source-over"||this.setAttr("globalCompositeOperation",n)}}Ur.Context=Kc;iS.forEach(function(t){Object.defineProperty(Kc.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class oS extends Kc{constructor(e,{willReadFrequently:n=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:n})}_fillColor(e){const n=e.fill();this.setAttr("fillStyle",n),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const n=e._getLinearGradient();n&&(this.setAttr("fillStyle",n),e._fillFunc(this))}_fillRadialGradient(e){const n=e._getRadialGradient();n&&(this.setAttr("fillStyle",n),e._fillFunc(this))}_fill(e){const n=e.fill(),r=e.getFillPriority();if(n&&r==="color"){this._fillColor(e);return}const i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}const s=e.getFillLinearGradientColorStops();if(s&&r==="linear-gradient"){this._fillLinearGradient(e);return}const l=e.getFillRadialGradientColorStops();if(l&&r==="radial-gradient"){this._fillRadialGradient(e);return}n?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):l&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const n=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(n.x,n.y,r.x,r.y);if(i){for(let l=0;l<i.length;l+=2)s.addColorStop(i[l],i[l+1]);this.setAttr("strokeStyle",s)}}_stroke(e){const n=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e),n&&e.dashEnabled()&&(this.setLineDash(n),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var n,r,i;const s=(n=e.getShadowRGBA())!==null&&n!==void 0?n:"black",l=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,c=(i=e.getShadowOffset())!==null&&i!==void 0?i:{x:0,y:0},u=e.getAbsoluteScale(),f=this.canvas.getPixelRatio(),h=u.x*f,m=u.y*f;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",l*Math.min(Math.abs(h),Math.abs(m))),this.setAttr("shadowOffsetX",c.x*h),this.setAttr("shadowOffsetY",c.y*m)}}Ur.SceneContext=oS;class aS extends Kc{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const n=e.getStrokeScaleEnabled();if(!n){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e);const r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),n||this.restore()}}}Ur.HitContext=aS;Object.defineProperty(sr,"__esModule",{value:!0});sr.HitCanvas=sr.SceneCanvas=sr.Canvas=void 0;const bc=at,R5=Ur,I5=Pe;let Nu;function lS(){if(Nu)return Nu;const t=bc.Util.createCanvasElement(),e=t.getContext("2d");return Nu=function(){const n=I5.Konva._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return n/r}(),bc.Util.releaseCanvas(t),Nu}class lg{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||I5.Konva.pixelRatio||lS();this.pixelRatio=r,this._canvas=bc.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const n=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/n,this.getHeight()/n)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const n=this.pixelRatio;this.getContext()._context.scale(n,n)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const n=this.pixelRatio;this.getContext()._context.scale(n,n)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,n){this.setWidth(e||0),this.setHeight(n||0)}toDataURL(e,n){try{return this._canvas.toDataURL(e,n)}catch{try{return this._canvas.toDataURL()}catch(i){return bc.Util.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}sr.Canvas=lg;class uS extends lg{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new R5.SceneContext(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}sr.SceneCanvas=uS;class cS extends lg{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new R5.HitContext(this),this.setSize(e.width,e.height)}}sr.HitCanvas=cS;var Qc={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Pe,n=at;t.DD={get isDragging(){let r=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(r=!0)}),r},justDragged:!1,get node(){let r;return t.DD._dragElements.forEach(i=>{r=i.node}),r},_dragElements:new Map,_drag(r){const i=[];t.DD._dragElements.forEach((s,l)=>{const{node:c}=s,u=c.getStage();u.setPointersPositions(r),s.pointerId===void 0&&(s.pointerId=n.Util._getFirstPointerId(r));const f=u._changedPointerPositions.find(h=>h.id===s.pointerId);if(f){if(s.dragStatus!=="dragging"){const h=c.dragDistance();if(Math.max(Math.abs(f.x-s.startPointerPos.x),Math.abs(f.y-s.startPointerPos.y))<h||(c.startDrag({evt:r}),!c.isDragging()))return}c._setDragPosition(r,s),i.push(c)}}),i.forEach(s=>{s.fire("dragmove",{type:"dragmove",target:s,evt:r},!0)})},_endDragBefore(r){const i=[];t.DD._dragElements.forEach(s=>{const{node:l}=s,c=l.getStage();if(r&&c.setPointersPositions(r),!c._changedPointerPositions.find(h=>h.id===s.pointerId))return;(s.dragStatus==="dragging"||s.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,s.dragStatus="stopped");const f=s.node.getLayer()||s.node instanceof e.Konva.Stage&&s.node;f&&i.indexOf(f)===-1&&i.push(f)}),i.forEach(s=>{s.draw()})},_endDragAfter(r){t.DD._dragElements.forEach((i,s)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:r},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(s)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(Qc);Object.defineProperty(tt,"__esModule",{value:!0});tt.Node=void 0;const Ie=at,fl=Ae,ha=sr,ci=Pe,Ln=Qc,pt=_e,Ku="absoluteOpacity",Au="allEventListeners",Lr="absoluteTransform",Jy="absoluteScale",Qi="canvas",dS="Change",fS="children",hS="konva",J0="listening",e2="mouseenter",t2="mouseleave",n2="set",r2="Shape",Qu=" ",i2="stage",di="transform",pS="Stage",ep="visible",gS=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Qu);let mS=1;class Se{constructor(e){this._id=mS++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===di||e===Lr)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,n){let r=this._cache.get(e);return(r===void 0||(e===di||e===Lr)&&r.dirty===!0)&&(r=n.call(this),this._cache.set(e,r)),r}_calculate(e,n,r){if(!this._attachedDepsListeners.get(e)){const i=n.map(s=>s+"Change.konva").join(Qu);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(Qi)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Lr&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Qi)){const{scene:e,filter:n,hit:r}=this._cache.get(Qi);Ie.Util.releaseCanvas(e,n,r),this._cache.delete(Qi)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const n=e||{};let r={};(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let i=Math.ceil(n.width||r.width),s=Math.ceil(n.height||r.height),l=n.pixelRatio,c=n.x===void 0?Math.floor(r.x):n.x,u=n.y===void 0?Math.floor(r.y):n.y,f=n.offset||0,h=n.drawBorder||!1,m=n.hitCanvasPixelRatio||1;if(!i||!s){Ie.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const x=Math.abs(Math.round(r.x)-c)>.5?1:0,y=Math.abs(Math.round(r.y)-u)>.5?1:0;i+=f*2+x,s+=f*2+y,c-=f,u-=f;const w=new ha.SceneCanvas({pixelRatio:l,width:i,height:s}),T=new ha.SceneCanvas({pixelRatio:l,width:0,height:0,willReadFrequently:!0}),k=new ha.HitCanvas({pixelRatio:m,width:i,height:s}),_=w.getContext(),C=k.getContext();return k.isCache=!0,w.isCache=!0,this._cache.delete(Qi),this._filterUpToDate=!1,n.imageSmoothingEnabled===!1&&(w.getContext()._context.imageSmoothingEnabled=!1,T.getContext()._context.imageSmoothingEnabled=!1),_.save(),C.save(),_.translate(-c,-u),C.translate(-c,-u),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Ku),this._clearSelfAndDescendantCache(Jy),this.drawScene(w,this),this.drawHit(k,this),this._isUnderCache=!1,_.restore(),C.restore(),h&&(_.save(),_.beginPath(),_.rect(0,0,i,s),_.closePath(),_.setAttr("strokeStyle","red"),_.setAttr("lineWidth",5),_.stroke(),_.restore()),this._cache.set(Qi,{scene:w,filter:T,hit:k,x:c,y:u}),this._requestDraw(),this}isCached(){return this._cache.has(Qi)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,n){const r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let i=1/0,s=1/0,l=-1/0,c=-1/0;const u=this.getAbsoluteTransform(n);return r.forEach(function(f){const h=u.point(f);i===void 0&&(i=l=h.x,s=c=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),c=Math.max(c,h.y)}),{x:i,y:s,width:l-i,height:c-s}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const n=this._getCanvasCache();e.translate(n.x,n.y);const r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){const n=this._getCanvasCache(),r=n.hit;e.save(),e.translate(n.x,n.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),n=this._getCanvasCache(),r=n.scene,i=n.filter,s=i.getContext(),l,c,u,f;if(e){if(!this._filterUpToDate){const h=r.pixelRatio;i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(l=e.length,s.clear(),s.drawImage(r._canvas,0,0,r.getWidth()/h,r.getHeight()/h),c=s.getImageData(0,0,i.getWidth(),i.getHeight()),u=0;u<l;u++){if(f=e[u],typeof f!="function"){Ie.Util.error("Filter should be type of function, but got "+typeof f+" instead. Please check correct filters");continue}f.call(this,c),s.putImageData(c,0,0)}}catch(m){Ie.Util.error("Unable to apply filter. "+m.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return i}return r}on(e,n){if(this._cache&&this._cache.delete(Au),arguments.length===3)return this._delegate.apply(this,arguments);let r=e.split(Qu),i=r.length,s,l,c,u,f;for(s=0;s<i;s++)l=r[s],c=l.split("."),u=c[0],f=c[1]||"",this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:f,handler:n});return this}off(e,n){let r=(e||"").split(Qu),i=r.length,s,l,c,u,f,h;if(this._cache&&this._cache.delete(Au),!e)for(l in this.eventListeners)this._off(l);for(s=0;s<i;s++)if(c=r[s],u=c.split("."),f=u[0],h=u[1],f)this.eventListeners[f]&&this._off(f,h,n);else for(l in this.eventListeners)this._off(l,h,n);return this}dispatchEvent(e){const n={target:this,type:e.type,evt:e};return this.fire(e.type,n),this}addEventListener(e,n){return this.on(e,function(r){n.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,n,r){const i=this;this.on(e,function(s){const l=s.target.findAncestors(n,!0,i);for(let c=0;c<l.length;c++)s=Ie.Util.cloneObject(s),s.currentTarget=l[c],r.call(l[c],s)})}remove(){return this.isDragging()&&this.stopDrag(),Ln.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Lr),this._clearSelfAndDescendantCache(Ku),this._clearSelfAndDescendantCache(Jy),this._clearSelfAndDescendantCache(i2),this._clearSelfAndDescendantCache(ep),this._clearSelfAndDescendantCache(J0)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const n="get"+Ie.Util._capitalize(e);return Ie.Util._isFunction(this[n])?this[n]():this.attrs[e]}getAncestors(){let e=this.getParent(),n=[];for(;e;)n.push(e),e=e.getParent();return n}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let n,r;if(!e)return this;for(n in e)n!==fS&&(r=n2+Ie.Util._capitalize(n),Ie.Util._isFunction(this[r])?this[r](e[n]):this._setAttr(n,e[n]))}),this}isListening(){return this._getCache(J0,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(ep,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,n=!1){if(e)return this._isVisible(e)&&this._isListening(e);const r=this.getLayer();let i=!1;Ln.DD._dragElements.forEach(l=>{l.dragStatus==="dragging"&&(l.node.nodeType==="Stage"||l.node.getLayer()===r)&&(i=!0)});const s=!n&&!ci.Konva.hitOnDragEnabled&&(i||ci.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),n=this,r=0,i,s,l,c;function u(h){for(i=[],s=h.length,l=0;l<s;l++)c=h[l],r++,c.nodeType!==r2&&(i=i.concat(c.getChildren().slice())),c._id===n._id&&(l=s);i.length>0&&i[0].getDepth()<=e&&u(i)}const f=this.getStage();return n.nodeType!==pS&&f&&u(f.getChildren()),r}getDepth(){let e=0,n=this.parent;for(;n;)e++,n=n.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(di),this._clearSelfAndDescendantCache(Lr)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const n=e.getPointerPosition();if(!n)return null;const r=this.getAbsoluteTransform().copy();return r.invert(),r.point(n)}getAbsolutePosition(e){let n=!1,r=this.parent;for(;r;){if(r.isCached()){n=!0;break}r=r.parent}n&&!e&&(e=!0);const i=this.getAbsoluteTransform(e).getMatrix(),s=new Ie.Transform,l=this.offset();return s.m=i.slice(),s.translate(l.x,l.y),s.getTranslation()}setAbsolutePosition(e){const{x:n,y:r,...i}=this._clearTransform();this.attrs.x=n,this.attrs.y=r,this._clearCache(di);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(e.x,e.y),e={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(i),this.setPosition({x:e.x,y:e.y}),this._clearCache(di),this._clearSelfAndDescendantCache(Lr),this}_setTransform(e){let n;for(n in e)this.attrs[n]=e[n]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let n=e.x,r=e.y,i=this.x(),s=this.y();return n!==void 0&&(i+=n),r!==void 0&&(s+=r),this.setPosition({x:i,y:s}),this}_eachAncestorReverse(e,n){let r=[],i=this.getParent(),s,l;if(!(n&&n._id===this._id)){for(r.unshift(this);i&&(!n||i._id!==n._id);)r.unshift(i),i=i.parent;for(s=r.length,l=0;l<s;l++)e(r[l])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return Ie.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index,n=this.parent.getChildren().length;return e<n-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return Ie.Util.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index,n=this.parent.getChildren().length;return e<n-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return Ie.Util.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return Ie.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return Ie.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&Ie.Util.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const n=this.index;return this.parent.children.splice(n,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Ku,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const n=this.getParent();return n&&!n._isUnderCache&&(e*=n.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),n,r,i,s,l;const c={attrs:{},className:this.getClassName()};for(n in e)r=e[n],l=Ie.Util.isObject(r)&&!Ie.Util._isPlainObject(r)&&!Ie.Util._isArray(r),!l&&(i=typeof this[n]=="function"&&this[n],delete e[n],s=i?i.call(this):null,e[n]=r,s!==r&&(c.attrs[n]=r));return Ie.Util._prepareToStringify(c)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,n,r){const i=[];n&&this._isMatch(e)&&i.push(this);let s=this.parent;for(;s;){if(s===r)return i;s._isMatch(e)&&i.push(s),s=s.parent}return i}isAncestorOf(e){return!1}findAncestor(e,n,r){return this.findAncestors(e,n,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let n=e.replace(/ /g,"").split(","),r=n.length,i,s;for(i=0;i<r;i++)if(s=n[i],Ie.Util.isValidSelector(s)||(Ie.Util.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Ie.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Ie.Util.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(i2,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,n={},r){return n.target=n.target||this,r?this._fireAndBubble(e,n):this._fire(e,n),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Lr,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let n;if(e)return n=new Ie.Transform,this._eachAncestorReverse(function(r){const i=r.transformsEnabled();i==="all"?n.multiply(r.getTransform()):i==="position"&&n.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),n;{n=this._cache.get(Lr)||new Ie.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(n):n.reset();const r=this.transformsEnabled();if(r==="all")n.multiply(this.getTransform());else if(r==="position"){const i=this.attrs.x||0,s=this.attrs.y||0,l=this.attrs.offsetX||0,c=this.attrs.offsetY||0;n.translate(i-l,s-c)}return n.dirty=!1,n}}getAbsoluteScale(e){let n=this;for(;n;)n._isUnderCache&&(e=n),n=n.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(di,this._getTransform)}_getTransform(){var e,n;const r=this._cache.get(di)||new Ie.Transform;r.reset();const i=this.x(),s=this.y(),l=ci.Konva.getAngle(this.rotation()),c=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,u=(n=this.attrs.scaleY)!==null&&n!==void 0?n:1,f=this.attrs.skewX||0,h=this.attrs.skewY||0,m=this.attrs.offsetX||0,x=this.attrs.offsetY||0;return(i!==0||s!==0)&&r.translate(i,s),l!==0&&r.rotate(l),(f!==0||h!==0)&&r.skew(f,h),(c!==1||u!==1)&&r.scale(c,u),(m!==0||x!==0)&&r.translate(-1*m,-1*x),r.dirty=!1,r}clone(e){let n=Ie.Util.cloneObject(this.attrs),r,i,s,l,c;for(r in e)n[r]=e[r];const u=new this.constructor(n);for(r in this.eventListeners)for(i=this.eventListeners[r],s=i.length,l=0;l<s;l++)c=i[l],c.name.indexOf(hS)<0&&(u.eventListeners[r]||(u.eventListeners[r]=[]),u.eventListeners[r].push(c));return u}_toKonvaCanvas(e){e=e||{};const n=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(n.x),s=e.y!==void 0?e.y:Math.floor(n.y),l=e.pixelRatio||1,c=new ha.SceneCanvas({width:e.width||Math.ceil(n.width)||(r?r.width():0),height:e.height||Math.ceil(n.height)||(r?r.height():0),pixelRatio:l}),u=c.getContext(),f=new ha.SceneCanvas({width:c.width/c.pixelRatio+Math.abs(i),height:c.height/c.pixelRatio+Math.abs(s),pixelRatio:c.pixelRatio});return e.imageSmoothingEnabled===!1&&(u._context.imageSmoothingEnabled=!1),u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(c,void 0,f),u.restore(),c}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};const n=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(n,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((n,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,Ie.Util._urlToImage(this.toDataURL(e),function(s){n(s),i==null||i(s)})}catch(i){r(i)}})}toBlob(e){return new Promise((n,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,this.toCanvas(e).toBlob(s=>{n(s),i==null||i(s)},e==null?void 0:e.mimeType,e==null?void 0:e.quality)}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():ci.Konva.dragDistance}_off(e,n,r){let i=this.eventListeners[e],s,l,c;for(s=0;s<i.length;s++)if(l=i[s].name,c=i[s].handler,(l!=="konva"||n==="konva")&&(!n||l===n)&&(!r||r===c)){if(i.splice(s,1),i.length===0){delete this.eventListeners[e];break}s--}}_fireChangeEvent(e,n,r){this._fire(e+dS,{oldVal:n,newVal:r})}addName(e){if(!this.hasName(e)){const n=this.name(),r=n?n+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const n=this.name();return n?(n||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){const n=(this.name()||"").split(/\s/g),r=n.indexOf(e);return r!==-1&&(n.splice(r,1),this.name(n.join(" "))),this}setAttr(e,n){const r=this[n2+Ie.Util._capitalize(e)];return Ie.Util._isFunction(r)?r.call(this,n):this._setAttr(e,n),this}_requestDraw(){if(ci.Konva.autoDrawEnabled){const e=this.getLayer()||this.getStage();e==null||e.batchDraw()}}_setAttr(e,n){const r=this.attrs[e];r===n&&!Ie.Util.isObject(n)||(n==null?delete this.attrs[e]:this.attrs[e]=n,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,n),this._requestDraw())}_setComponentAttr(e,n,r){let i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][n]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,n,r){if(n&&this.nodeType===r2&&(n.target=this),!((e===e2||e===t2)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r))){this._fire(e,n);const s=(e===e2||e===t2)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(n&&!n.cancelBubble||!n)&&this.parent&&this.parent.isListening()&&!s&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,n,r):this._fireAndBubble.call(this.parent,e,n))}}_getProtoListeners(e){var n,r,i;const s=(n=this._cache.get(Au))!==null&&n!==void 0?n:{};let l=s==null?void 0:s[e];if(l===void 0){l=[];let c=Object.getPrototypeOf(this);for(;c;){const u=(i=(r=c.eventListeners)===null||r===void 0?void 0:r[e])!==null&&i!==void 0?i:[];l.push(...u),c=Object.getPrototypeOf(c)}s[e]=l,this._cache.set(Au,s)}return l}_fire(e,n){n=n||{},n.currentTarget=this,n.type=e;const r=this._getProtoListeners(e);if(r)for(var i=0;i<r.length;i++)r[i].handler.call(this,n);const s=this.eventListeners[e];if(s)for(var i=0;i<s.length;i++)s[i].handler.call(this,n)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const n=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition();if(!r)return;const s=r._getPointerById(n)||r._changedPointerPositions[0]||i;Ln.DD._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-i.x,y:s.y-i.y},dragStatus:"ready",pointerId:n})}startDrag(e,n=!0){Ln.DD._dragElements.has(this._id)||this._createDragElement(e);const r=Ln.DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},n)}_setDragPosition(e,n){const r=this.getStage()._getPointerById(n.pointerId);if(!r)return;let i={x:r.x-n.offset.x,y:r.y-n.offset.y};const s=this.dragBoundFunc();if(s!==void 0){const l=s.call(this,i,e);l?i=l:Ie.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(e){const n=Ln.DD._dragElements.get(this._id);n&&(n.dragStatus="stopped"),Ln.DD._endDragBefore(e),Ln.DD._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=Ln.DD._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||ci.Konva.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let i=!1;Ln.DD._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(i=!0)}),i||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const n=Ln.DD._dragElements.get(this._id),r=n&&n.dragStatus==="dragging",i=n&&n.dragStatus==="ready";r?this.stopDrag():i&&Ln.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const n=this.getStage();if(!n)return!1;const r={x:-e.x,y:-e.y,width:n.width()+2*e.x,height:n.height()+2*e.y};return Ie.Util.haveIntersection(r,this.getClientRect())}static create(e,n){return Ie.Util._isString(e)&&(e=JSON.parse(e)),this._createNode(e,n)}static _createNode(e,n){let r=Se.prototype.getClassName.call(e),i=e.children,s,l,c;n&&(e.attrs.container=n),ci.Konva[r]||(Ie.Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const u=ci.Konva[r];if(s=new u(e.attrs),i)for(l=i.length,c=0;c<l;c++)s.add(Se._createNode(i[c]));return s}}tt.Node=Se;Se.prototype.nodeType="Node";Se.prototype._attrsAffectingSize=[];Se.prototype.eventListeners={};Se.prototype.on.call(Se.prototype,gS,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(di),this._clearSelfAndDescendantCache(Lr)});Se.prototype.on.call(Se.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ep)});Se.prototype.on.call(Se.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(J0)});Se.prototype.on.call(Se.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Ku)});const We=fl.Factory.addGetterSetter;We(Se,"zIndex");We(Se,"absolutePosition");We(Se,"position");We(Se,"x",0,(0,pt.getNumberValidator)());We(Se,"y",0,(0,pt.getNumberValidator)());We(Se,"globalCompositeOperation","source-over",(0,pt.getStringValidator)());We(Se,"opacity",1,(0,pt.getNumberValidator)());We(Se,"name","",(0,pt.getStringValidator)());We(Se,"id","",(0,pt.getStringValidator)());We(Se,"rotation",0,(0,pt.getNumberValidator)());fl.Factory.addComponentsGetterSetter(Se,"scale",["x","y"]);We(Se,"scaleX",1,(0,pt.getNumberValidator)());We(Se,"scaleY",1,(0,pt.getNumberValidator)());fl.Factory.addComponentsGetterSetter(Se,"skew",["x","y"]);We(Se,"skewX",0,(0,pt.getNumberValidator)());We(Se,"skewY",0,(0,pt.getNumberValidator)());fl.Factory.addComponentsGetterSetter(Se,"offset",["x","y"]);We(Se,"offsetX",0,(0,pt.getNumberValidator)());We(Se,"offsetY",0,(0,pt.getNumberValidator)());We(Se,"dragDistance",void 0,(0,pt.getNumberValidator)());We(Se,"width",0,(0,pt.getNumberValidator)());We(Se,"height",0,(0,pt.getNumberValidator)());We(Se,"listening",!0,(0,pt.getBooleanValidator)());We(Se,"preventDefault",!0,(0,pt.getBooleanValidator)());We(Se,"filters",void 0,function(t){return this._filterUpToDate=!1,t});We(Se,"visible",!0,(0,pt.getBooleanValidator)());We(Se,"transformsEnabled","all",(0,pt.getStringValidator)());We(Se,"size");We(Se,"dragBoundFunc");We(Se,"draggable",!1,(0,pt.getBooleanValidator)());fl.Factory.backCompat(Se,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var fs={};Object.defineProperty(fs,"__esModule",{value:!0});fs.Container=void 0;const No=Ae,zh=tt,Zc=_e;class hs extends zh.Node{constructor(){super(...arguments),this.children=[]}getChildren(e){if(!e)return this.children||[];const n=this.children||[],r=[];return n.forEach(function(i){e(i)&&r.push(i)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let r=0;r<e.length;r++)this.add(e[r]);return this}const n=e[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const n=this._generalFind(e,!0);return n.length>0?n[0]:void 0}_generalFind(e,n){const r=[];return this._descendants(i=>{const s=i._isMatch(e);return s&&r.push(i),!!(s&&n)}),r}_descendants(e){let n=!1;const r=this.getChildren();for(const i of r){if(n=e(i),n)return!0;if(i.hasChildren()&&(n=i._descendants(e),n))return!0}return!1}toObject(){const e=zh.Node.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(n=>{e.children.push(n.toObject())}),e}isAncestorOf(e){let n=e.getParent();for(;n;){if(n._id===this._id)return!0;n=n.getParent()}return!1}clone(e){const n=zh.Node.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){n.add(r.clone())}),n}getAllIntersections(e){const n=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&n.push(r)}),n}_clearSelfAndDescendantCache(e){var n;super._clearSelfAndDescendantCache(e),!this.isCached()&&((n=this.children)===null||n===void 0||n.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(n,r){n.index=r}),this._requestDraw()}drawScene(e,n,r){const i=this.getLayer(),s=e||i&&i.getCanvas(),l=s&&s.getContext(),c=this._getCanvasCache(),u=c&&c.scene,f=s&&s.isCache;if(!this.isVisible()&&!f)return this;if(u){l.save();const h=this.getAbsoluteTransform(n).getMatrix();l.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(l),l.restore()}else this._drawChildren("drawScene",s,n,r);return this}drawHit(e,n){if(!this.shouldDrawHit(n))return this;const r=this.getLayer(),i=e||r&&r.hitCanvas,s=i&&i.getContext(),l=this._getCanvasCache();if(l&&l.hit){s.save();const u=this.getAbsoluteTransform(n).getMatrix();s.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",i,n);return this}_drawChildren(e,n,r,i){var s;const l=n&&n.getContext(),c=this.clipWidth(),u=this.clipHeight(),f=this.clipFunc(),h=typeof c=="number"&&typeof u=="number"||f,m=r===this;if(h){l.save();const y=this.getAbsoluteTransform(r);let w=y.getMatrix();l.transform(w[0],w[1],w[2],w[3],w[4],w[5]),l.beginPath();let T;if(f)T=f.call(this,l,this);else{const k=this.clipX(),_=this.clipY();l.rect(k||0,_||0,c,u)}l.clip.apply(l,T),w=y.copy().invert().getMatrix(),l.transform(w[0],w[1],w[2],w[3],w[4],w[5])}const x=!m&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";x&&(l.save(),l._applyGlobalCompositeOperation(this)),(s=this.children)===null||s===void 0||s.forEach(function(y){y[e](n,r,i)}),x&&l.restore(),h&&l.restore()}getClientRect(e={}){var n;const r=e.skipTransform,i=e.relativeTo;let s,l,c,u,f={x:1/0,y:1/0,width:0,height:0};const h=this;(n=this.children)===null||n===void 0||n.forEach(function(y){if(!y.visible())return;const w=y.getClientRect({relativeTo:h,skipShadow:e.skipShadow,skipStroke:e.skipStroke});w.width===0&&w.height===0||(s===void 0?(s=w.x,l=w.y,c=w.x+w.width,u=w.y+w.height):(s=Math.min(s,w.x),l=Math.min(l,w.y),c=Math.max(c,w.x+w.width),u=Math.max(u,w.y+w.height)))});const m=this.find("Shape");let x=!1;for(let y=0;y<m.length;y++)if(m[y]._isVisible(this)){x=!0;break}return x&&s!==void 0?f={x:s,y:l,width:c-s,height:u-l}:f={x:0,y:0,width:0,height:0},r?f:this._transformedRect(f,i)}}fs.Container=hs;No.Factory.addComponentsGetterSetter(hs,"clip",["x","y","width","height"]);No.Factory.addGetterSetter(hs,"clipX",void 0,(0,Zc.getNumberValidator)());No.Factory.addGetterSetter(hs,"clipY",void 0,(0,Zc.getNumberValidator)());No.Factory.addGetterSetter(hs,"clipWidth",void 0,(0,Zc.getNumberValidator)());No.Factory.addGetterSetter(hs,"clipHeight",void 0,(0,Zc.getNumberValidator)());No.Factory.addGetterSetter(hs,"clipFunc");var L5={},Ii={};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.getCapturedShape=vS;Ii.createEvent=ug;Ii.hasPointerCapture=xS;Ii.setPointerCapture=wS;Ii.releaseCapture=j5;const yS=Pe,el=new Map,F5=yS.Konva._global.PointerEvent!==void 0;function vS(t){return el.get(t)}function ug(t){return{evt:t,pointerId:t.pointerId}}function xS(t,e){return el.get(t)===e}function wS(t,e){j5(t),e.getStage()&&(el.set(t,e),F5&&e._fire("gotpointercapture",ug(new PointerEvent("gotpointercapture"))))}function j5(t,e){const n=el.get(t);if(!n)return;const r=n.getStage();r&&r.content,el.delete(t),F5&&n._fire("lostpointercapture",ug(new PointerEvent("lostpointercapture")))}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=at,n=Ae,r=fs,i=Pe,s=sr,l=Qc,c=Pe,u=Ii,f="Stage",h="string",m="px",x="mouseout",y="mouseleave",w="mouseover",T="mouseenter",k="mousemove",_="mousedown",C="mouseup",g="pointermove",S="pointerdown",b="pointerup",N="pointercancel",I="lostpointercapture",A="pointerout",F="pointerleave",M="pointerover",R="pointerenter",z="contextmenu",V="touchstart",j="touchend",D="touchmove",G="touchcancel",H="wheel",O=5,$=[[T,"_pointerenter"],[_,"_pointerdown"],[k,"_pointermove"],[C,"_pointerup"],[y,"_pointerleave"],[V,"_pointerdown"],[D,"_pointermove"],[j,"_pointerup"],[G,"_pointercancel"],[w,"_pointerover"],[H,"_wheel"],[z,"_contextmenu"],[S,"_pointerdown"],[g,"_pointermove"],[b,"_pointerup"],[N,"_pointercancel"],[I,"_lostpointercapture"]],W={mouse:{[A]:x,[F]:y,[M]:w,[R]:T,[g]:k,[S]:_,[b]:C,[N]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[A]:"touchout",[F]:"touchleave",[M]:"touchover",[R]:"touchenter",[g]:D,[S]:V,[b]:j,[N]:G,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[A]:A,[F]:F,[M]:M,[R]:R,[g]:g,[S]:S,[b]:b,[N]:N,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},K=ye=>ye.indexOf("pointer")>=0?"pointer":ye.indexOf("touch")>=0?"touch":"mouse",Q=ye=>{const U=K(ye);if(U==="pointer")return i.Konva.pointerEventsEnabled&&W.pointer;if(U==="touch")return W.touch;if(U==="mouse")return W.mouse};function q(ye={}){return(ye.clipFunc||ye.clipWidth||ye.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),ye}const oe="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class we extends r.Container{constructor(U){super(q(U)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{q(this.attrs)}),this._checkVisibility()}_validateAdd(U){const te=U.getType()==="Layer",ae=U.getType()==="FastLayer";te||ae||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const U=this.visible()?"":"none";this.content.style.display=U}setContainer(U){if(typeof U===h){if(U.charAt(0)==="."){const ae=U.slice(1);U=document.getElementsByClassName(ae)[0]}else{var te;U.charAt(0)!=="#"?te=U:te=U.slice(1),U=document.getElementById(te)}if(!U)throw"Can not find container in document with id "+te}return this._setAttr("container",U),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),U.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const U=this.children,te=U.length;for(let ae=0;ae<te;ae++)U[ae].clear();return this}clone(U){return U||(U={}),U.container=typeof document<"u"&&document.createElement("div"),r.Container.prototype.clone.call(this,U)}destroy(){super.destroy();const U=this.content;U&&e.Util._isInDocument(U)&&this.container().removeChild(U);const te=t.stages.indexOf(this);return te>-1&&t.stages.splice(te,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const U=this._pointerPositions[0]||this._changedPointerPositions[0];return U?{x:U.x,y:U.y}:(e.Util.warn(oe),null)}_getPointerById(U){return this._pointerPositions.find(te=>te.id===U)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(U){U=U||{},U.x=U.x||0,U.y=U.y||0,U.width=U.width||this.width(),U.height=U.height||this.height();const te=new s.SceneCanvas({width:U.width,height:U.height,pixelRatio:U.pixelRatio||1}),ae=te.getContext()._context,xe=this.children;return(U.x||U.y)&&ae.translate(-1*U.x,-1*U.y),xe.forEach(function(ve){if(!ve.isVisible())return;const Le=ve._toKonvaCanvas(U);ae.drawImage(Le._canvas,U.x,U.y,Le.getWidth()/Le.getPixelRatio(),Le.getHeight()/Le.getPixelRatio())}),te}getIntersection(U){if(!U)return null;const te=this.children,ae=te.length,xe=ae-1;for(let ve=xe;ve>=0;ve--){const Le=te[ve].getIntersection(U);if(Le)return Le}return null}_resizeDOM(){const U=this.width(),te=this.height();this.content&&(this.content.style.width=U+m,this.content.style.height=te+m),this.bufferCanvas.setSize(U,te),this.bufferHitCanvas.setSize(U,te),this.children.forEach(ae=>{ae.setSize({width:U,height:te}),ae.draw()})}add(U,...te){if(arguments.length>1){for(let xe=0;xe<arguments.length;xe++)this.add(arguments[xe]);return this}super.add(U);const ae=this.children.length;return ae>O&&e.Util.warn("The stage has "+ae+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),U.setSize({width:this.width(),height:this.height()}),U.draw(),i.Konva.isBrowser&&this.content.appendChild(U.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(U){return u.hasPointerCapture(U,this)}setPointerCapture(U){u.setPointerCapture(U,this)}releaseCapture(U){u.releaseCapture(U,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&$.forEach(([U,te])=>{this.content.addEventListener(U,ae=>{this[te](ae)},{passive:!1})})}_pointerenter(U){this.setPointersPositions(U);const te=Q(U.type);te&&this._fire(te.pointerenter,{evt:U,target:this,currentTarget:this})}_pointerover(U){this.setPointersPositions(U);const te=Q(U.type);te&&this._fire(te.pointerover,{evt:U,target:this,currentTarget:this})}_getTargetShape(U){let te=this[U+"targetShape"];return te&&!te.getStage()&&(te=null),te}_pointerleave(U){const te=Q(U.type),ae=K(U.type);if(!te)return;this.setPointersPositions(U);const xe=this._getTargetShape(ae),ve=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;xe&&ve?(xe._fireAndBubble(te.pointerout,{evt:U}),xe._fireAndBubble(te.pointerleave,{evt:U}),this._fire(te.pointerleave,{evt:U,target:this,currentTarget:this}),this[ae+"targetShape"]=null):ve&&(this._fire(te.pointerleave,{evt:U,target:this,currentTarget:this}),this._fire(te.pointerout,{evt:U,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(U){const te=Q(U.type),ae=K(U.type);if(!te)return;this.setPointersPositions(U);let xe=!1;this._changedPointerPositions.forEach(ve=>{const Le=this.getIntersection(ve);if(l.DD.justDragged=!1,i.Konva["_"+ae+"ListenClick"]=!0,!Le||!Le.isListening()){this[ae+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&Le.setPointerCapture(ve.id),this[ae+"ClickStartShape"]=Le,Le._fireAndBubble(te.pointerdown,{evt:U,pointerId:ve.id}),xe=!0;const ie=U.type.indexOf("touch")>=0;Le.preventDefault()&&U.cancelable&&ie&&U.preventDefault()}),xe||this._fire(te.pointerdown,{evt:U,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(U){const te=Q(U.type),ae=K(U.type);if(!te||(i.Konva.isDragging()&&l.DD.node.preventDefault()&&U.cancelable&&U.preventDefault(),this.setPointersPositions(U),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const ve={};let Le=!1;const ie=this._getTargetShape(ae);this._changedPointerPositions.forEach(se=>{const de=u.getCapturedShape(se.id)||this.getIntersection(se),ke=se.id,Me={evt:U,pointerId:ke},ue=ie!==de;if(ue&&ie&&(ie._fireAndBubble(te.pointerout,{...Me},de),ie._fireAndBubble(te.pointerleave,{...Me},de)),de){if(ve[de._id])return;ve[de._id]=!0}de&&de.isListening()?(Le=!0,ue&&(de._fireAndBubble(te.pointerover,{...Me},ie),de._fireAndBubble(te.pointerenter,{...Me},ie),this[ae+"targetShape"]=de),de._fireAndBubble(te.pointermove,{...Me})):ie&&(this._fire(te.pointerover,{evt:U,target:this,currentTarget:this,pointerId:ke}),this[ae+"targetShape"]=null)}),Le||this._fire(te.pointermove,{evt:U,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(U){const te=Q(U.type),ae=K(U.type);if(!te)return;this.setPointersPositions(U);const xe=this[ae+"ClickStartShape"],ve=this[ae+"ClickEndShape"],Le={};let ie=!1;this._changedPointerPositions.forEach(se=>{const de=u.getCapturedShape(se.id)||this.getIntersection(se);if(de){if(de.releaseCapture(se.id),Le[de._id])return;Le[de._id]=!0}const ke=se.id,Me={evt:U,pointerId:ke};let ue=!1;i.Konva["_"+ae+"InDblClickWindow"]?(ue=!0,clearTimeout(this[ae+"DblTimeout"])):l.DD.justDragged||(i.Konva["_"+ae+"InDblClickWindow"]=!0,clearTimeout(this[ae+"DblTimeout"])),this[ae+"DblTimeout"]=setTimeout(function(){i.Konva["_"+ae+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),de&&de.isListening()?(ie=!0,this[ae+"ClickEndShape"]=de,de._fireAndBubble(te.pointerup,{...Me}),i.Konva["_"+ae+"ListenClick"]&&xe&&xe===de&&(de._fireAndBubble(te.pointerclick,{...Me}),ue&&ve&&ve===de&&de._fireAndBubble(te.pointerdblclick,{...Me}))):(this[ae+"ClickEndShape"]=null,i.Konva["_"+ae+"ListenClick"]&&this._fire(te.pointerclick,{evt:U,target:this,currentTarget:this,pointerId:ke}),ue&&this._fire(te.pointerdblclick,{evt:U,target:this,currentTarget:this,pointerId:ke}))}),ie||this._fire(te.pointerup,{evt:U,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+ae+"ListenClick"]=!1,U.cancelable&&ae!=="touch"&&ae!=="pointer"&&U.preventDefault()}_contextmenu(U){this.setPointersPositions(U);const te=this.getIntersection(this.getPointerPosition());te&&te.isListening()?te._fireAndBubble(z,{evt:U}):this._fire(z,{evt:U,target:this,currentTarget:this})}_wheel(U){this.setPointersPositions(U);const te=this.getIntersection(this.getPointerPosition());te&&te.isListening()?te._fireAndBubble(H,{evt:U}):this._fire(H,{evt:U,target:this,currentTarget:this})}_pointercancel(U){this.setPointersPositions(U);const te=u.getCapturedShape(U.pointerId)||this.getIntersection(this.getPointerPosition());te&&te._fireAndBubble(b,u.createEvent(U)),u.releaseCapture(U.pointerId)}_lostpointercapture(U){u.releaseCapture(U.pointerId)}setPointersPositions(U){const te=this._getContentPosition();let ae=null,xe=null;U=U||window.event,U.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(U.touches,ve=>{this._pointerPositions.push({id:ve.identifier,x:(ve.clientX-te.left)/te.scaleX,y:(ve.clientY-te.top)/te.scaleY})}),Array.prototype.forEach.call(U.changedTouches||U.touches,ve=>{this._changedPointerPositions.push({id:ve.identifier,x:(ve.clientX-te.left)/te.scaleX,y:(ve.clientY-te.top)/te.scaleY})})):(ae=(U.clientX-te.left)/te.scaleX,xe=(U.clientY-te.top)/te.scaleY,this.pointerPos={x:ae,y:xe},this._pointerPositions=[{x:ae,y:xe,id:e.Util._getFirstPointerId(U)}],this._changedPointerPositions=[{x:ae,y:xe,id:e.Util._getFirstPointerId(U)}])}_setPointerPosition(U){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(U)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const U=this.content.getBoundingClientRect();return{top:U.top,left:U.left,scaleX:U.width/this.content.clientWidth||1,scaleY:U.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new s.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new s.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const U=this.container();if(!U)throw"Stage has no container. A container is required.";U.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),U.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(U){U.batchDraw()}),this}}t.Stage=we,we.prototype.nodeType=f,(0,c._registerNode)(we),n.Factory.addGetterSetter(we,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(ye=>{ye.batchDraw()})})})(L5);var hl={},St={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Pe,n=at,r=Ae,i=tt,s=_e,l=Pe,c=Ii,u="hasShadow",f="shadowRGBA",h="patternImage",m="linearGradient",x="radialGradient";let y;function w(){return y||(y=n.Util.createCanvasElement().getContext("2d"),y)}t.shapes={};function T(F){const M=this.attrs.fillRule;M?F.fill(M):F.fill()}function k(F){F.stroke()}function _(F){const M=this.attrs.fillRule;M?F.fill(M):F.fill()}function C(F){F.stroke()}function g(){this._clearCache(u)}function S(){this._clearCache(f)}function b(){this._clearCache(h)}function N(){this._clearCache(m)}function I(){this._clearCache(x)}class A extends i.Node{constructor(M){super(M);let R;for(;R=n.Util.getRandomColor(),!(R&&!(R in t.shapes)););this.colorKey=R,t.shapes[R]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(u,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const R=w().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(R&&R.setTransform){const z=new n.Transform;z.translate(this.fillPatternX(),this.fillPatternY()),z.rotate(e.Konva.getAngle(this.fillPatternRotation())),z.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),z.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const V=z.getMatrix(),j=typeof DOMMatrix>"u"?{a:V[0],b:V[1],c:V[2],d:V[3],e:V[4],f:V[5]}:new DOMMatrix(V);R.setTransform(j)}return R}}_getLinearGradient(){return this._getCache(m,this.__getLinearGradient)}__getLinearGradient(){const M=this.fillLinearGradientColorStops();if(M){const R=w(),z=this.fillLinearGradientStartPoint(),V=this.fillLinearGradientEndPoint(),j=R.createLinearGradient(z.x,z.y,V.x,V.y);for(let D=0;D<M.length;D+=2)j.addColorStop(M[D],M[D+1]);return j}}_getRadialGradient(){return this._getCache(x,this.__getRadialGradient)}__getRadialGradient(){const M=this.fillRadialGradientColorStops();if(M){const R=w(),z=this.fillRadialGradientStartPoint(),V=this.fillRadialGradientEndPoint(),j=R.createRadialGradient(z.x,z.y,this.fillRadialGradientStartRadius(),V.x,V.y,this.fillRadialGradientEndRadius());for(let D=0;D<M.length;D+=2)j.addColorStop(M[D],M[D+1]);return j}}getShadowRGBA(){return this._getCache(f,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const M=n.Util.colorToRGBA(this.shadowColor());if(M)return"rgba("+M.r+","+M.g+","+M.b+","+M.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const M=this.hitStrokeWidth();return M==="auto"?this.hasStroke():this.strokeEnabled()&&!!M}intersects(M){const R=this.getStage();if(!R)return!1;const z=R.bufferHitCanvas;return z.getContext().clear(),this.drawHit(z,void 0,!0),z.context.getImageData(Math.round(M.x),Math.round(M.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(M){var R;if(!((R=this.attrs.perfectDrawEnabled)!==null&&R!==void 0?R:!0))return!1;const V=M||this.hasFill(),j=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(V&&j&&D)return!0;const G=this.hasShadow(),H=this.shadowForStrokeEnabled();return!!(V&&j&&G&&H)}setStrokeHitEnabled(M){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),M?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const M=this.size();return{x:this._centroid?-M.width/2:0,y:this._centroid?-M.height/2:0,width:M.width,height:M.height}}getClientRect(M={}){let R=!1,z=this.getParent();for(;z;){if(z.isCached()){R=!0;break}z=z.getParent()}const V=M.skipTransform,j=M.relativeTo||R&&this.getStage()||void 0,D=this.getSelfRect(),H=!M.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,O=D.width+H,$=D.height+H,W=!M.skipShadow&&this.hasShadow(),K=W?this.shadowOffsetX():0,Q=W?this.shadowOffsetY():0,q=O+Math.abs(K),oe=$+Math.abs(Q),we=W&&this.shadowBlur()||0,ye=q+we*2,U=oe+we*2,te={width:ye,height:U,x:-(H/2+we)+Math.min(K,0)+D.x,y:-(H/2+we)+Math.min(Q,0)+D.y};return V?te:this._transformedRect(te,j)}drawScene(M,R,z){const V=this.getLayer();let j=M||V.getCanvas(),D=j.getContext(),G=this._getCanvasCache(),H=this.getSceneFunc(),O=this.hasShadow(),$,W;const K=j.isCache,Q=R===this;if(!this.isVisible()&&!Q)return this;if(G){D.save();const oe=this.getAbsoluteTransform(R).getMatrix();return D.transform(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!H)return this;if(D.save(),this._useBufferCanvas()&&!K){$=this.getStage();const oe=z||$.bufferCanvas;W=oe.getContext(),W.clear(),W.save(),W._applyLineJoin(this);var q=this.getAbsoluteTransform(R).getMatrix();W.transform(q[0],q[1],q[2],q[3],q[4],q[5]),H.call(this,W,this),W.restore();const we=oe.pixelRatio;O&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(oe._canvas,0,0,oe.width/we,oe.height/we)}else{if(D._applyLineJoin(this),!Q){var q=this.getAbsoluteTransform(R).getMatrix();D.transform(q[0],q[1],q[2],q[3],q[4],q[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}O&&D._applyShadow(this),H.call(this,D,this)}return D.restore(),this}drawHit(M,R,z=!1){if(!this.shouldDrawHit(R,z))return this;const V=this.getLayer(),j=M||V.hitCanvas,D=j&&j.getContext(),G=this.hitFunc()||this.sceneFunc(),H=this._getCanvasCache(),O=H&&H.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),O){D.save();const W=this.getAbsoluteTransform(R).getMatrix();return D.transform(W[0],W[1],W[2],W[3],W[4],W[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!G)return this;if(D.save(),D._applyLineJoin(this),!(this===R)){const W=this.getAbsoluteTransform(R).getMatrix();D.transform(W[0],W[1],W[2],W[3],W[4],W[5])}return G.call(this,D,this),D.restore(),this}drawHitFromCache(M=0){const R=this._getCanvasCache(),z=this._getCachedSceneCanvas(),V=R.hit,j=V.getContext(),D=V.getWidth(),G=V.getHeight();j.clear(),j.drawImage(z._canvas,0,0,D,G);try{const H=j.getImageData(0,0,D,G),O=H.data,$=O.length,W=n.Util._hexToRgb(this.colorKey);for(let K=0;K<$;K+=4)O[K+3]>M?(O[K]=W.r,O[K+1]=W.g,O[K+2]=W.b,O[K+3]=255):O[K+3]=0;j.putImageData(H,0,0)}catch(H){n.Util.error("Unable to draw hit graph from cached scene canvas. "+H.message)}return this}hasPointerCapture(M){return c.hasPointerCapture(M,this)}setPointerCapture(M){c.setPointerCapture(M,this)}releaseCapture(M){c.releaseCapture(M,this)}}t.Shape=A,A.prototype._fillFunc=T,A.prototype._strokeFunc=k,A.prototype._fillFuncHit=_,A.prototype._strokeFuncHit=C,A.prototype._centroid=!1,A.prototype.nodeType="Shape",(0,l._registerNode)(A),A.prototype.eventListeners={},A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",g),A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",S),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",b),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",N),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",I),r.Factory.addGetterSetter(A,"stroke",void 0,(0,s.getStringOrGradientValidator)()),r.Factory.addGetterSetter(A,"strokeWidth",2,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillAfterStrokeEnabled",!1),r.Factory.addGetterSetter(A,"hitStrokeWidth","auto",(0,s.getNumberOrAutoValidator)()),r.Factory.addGetterSetter(A,"strokeHitEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(A,"perfectDrawEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(A,"shadowForStrokeEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(A,"lineJoin"),r.Factory.addGetterSetter(A,"lineCap"),r.Factory.addGetterSetter(A,"sceneFunc"),r.Factory.addGetterSetter(A,"hitFunc"),r.Factory.addGetterSetter(A,"dash"),r.Factory.addGetterSetter(A,"dashOffset",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowColor",void 0,(0,s.getStringValidator)()),r.Factory.addGetterSetter(A,"shadowBlur",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowOpacity",1,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"shadowOffset",["x","y"]),r.Factory.addGetterSetter(A,"shadowOffsetX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowOffsetY",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternImage"),r.Factory.addGetterSetter(A,"fill",void 0,(0,s.getStringOrGradientValidator)()),r.Factory.addGetterSetter(A,"fillPatternX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternY",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillLinearGradientColorStops"),r.Factory.addGetterSetter(A,"strokeLinearGradientColorStops"),r.Factory.addGetterSetter(A,"fillRadialGradientStartRadius",0),r.Factory.addGetterSetter(A,"fillRadialGradientEndRadius",0),r.Factory.addGetterSetter(A,"fillRadialGradientColorStops"),r.Factory.addGetterSetter(A,"fillPatternRepeat","repeat"),r.Factory.addGetterSetter(A,"fillEnabled",!0),r.Factory.addGetterSetter(A,"strokeEnabled",!0),r.Factory.addGetterSetter(A,"shadowEnabled",!0),r.Factory.addGetterSetter(A,"dashEnabled",!0),r.Factory.addGetterSetter(A,"strokeScaleEnabled",!0),r.Factory.addGetterSetter(A,"fillPriority","color"),r.Factory.addComponentsGetterSetter(A,"fillPatternOffset",["x","y"]),r.Factory.addGetterSetter(A,"fillPatternOffsetX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternOffsetY",0,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"fillPatternScale",["x","y"]),r.Factory.addGetterSetter(A,"fillPatternScaleX",1,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternScaleY",1,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"fillLinearGradientStartPoint",["x","y"]),r.Factory.addComponentsGetterSetter(A,"strokeLinearGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillLinearGradientStartPointX",0),r.Factory.addGetterSetter(A,"strokeLinearGradientStartPointX",0),r.Factory.addGetterSetter(A,"fillLinearGradientStartPointY",0),r.Factory.addGetterSetter(A,"strokeLinearGradientStartPointY",0),r.Factory.addComponentsGetterSetter(A,"fillLinearGradientEndPoint",["x","y"]),r.Factory.addComponentsGetterSetter(A,"strokeLinearGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillLinearGradientEndPointX",0),r.Factory.addGetterSetter(A,"strokeLinearGradientEndPointX",0),r.Factory.addGetterSetter(A,"fillLinearGradientEndPointY",0),r.Factory.addGetterSetter(A,"strokeLinearGradientEndPointY",0),r.Factory.addComponentsGetterSetter(A,"fillRadialGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillRadialGradientStartPointX",0),r.Factory.addGetterSetter(A,"fillRadialGradientStartPointY",0),r.Factory.addComponentsGetterSetter(A,"fillRadialGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillRadialGradientEndPointX",0),r.Factory.addGetterSetter(A,"fillRadialGradientEndPointY",0),r.Factory.addGetterSetter(A,"fillPatternRotation",0),r.Factory.addGetterSetter(A,"fillRule",void 0,(0,s.getStringValidator)()),r.Factory.backCompat(A,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(St);Object.defineProperty(hl,"__esModule",{value:!0});hl.Layer=void 0;const Ir=at,Bh=fs,Bs=tt,cg=Ae,s2=sr,_S=_e,SS=St,kS=Pe,TS="#",CS="beforeDraw",bS="draw",O5=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],ES=O5.length;let Ao=class extends Bh.Container{constructor(e){super(e),this.canvas=new s2.SceneCanvas,this.hitCanvas=new s2.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const n=this.getStage();return n&&n.content&&(n.content.removeChild(this.getNativeCanvasElement()),e<n.children.length-1?n.content.insertBefore(this.getNativeCanvasElement(),n.children[e+1].getCanvas()._canvas):n.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Bs.Node.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!Bs.Node.prototype.moveUp.call(this))return!1;const n=this.getStage();return!n||!n.content?!1:(n.content.removeChild(this.getNativeCanvasElement()),this.index<n.children.length-1?n.content.insertBefore(this.getNativeCanvasElement(),n.children[this.index+1].getCanvas()._canvas):n.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(Bs.Node.prototype.moveDown.call(this)){const e=this.getStage();if(e){const n=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),n[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Bs.Node.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const n=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),n[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return Bs.Node.prototype.remove.call(this),e&&e.parentNode&&Ir.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:n}){return this.canvas.setSize(e,n),this.hitCanvas.setSize(e,n),this._setSmoothEnabled(),this}_validateAdd(e){const n=e.getType();n!=="Group"&&n!=="Shape"&&Ir.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e=e||{},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),Bs.Node.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Ir.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Ir.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Ir.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let n=1,r=!1;for(;;){for(let i=0;i<ES;i++){const s=O5[i],l=this._getIntersection({x:e.x+s.x*n,y:e.y+s.y*n}),c=l.shape;if(c)return c;if(r=!!l.antialiased,!l.antialiased)break}if(r)n+=1;else return null}}_getIntersection(e){const n=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*n),Math.round(e.y*n),1,1).data,i=r[3];if(i===255){const s=Ir.Util._rgbToHex(r[0],r[1],r[2]),l=SS.shapes[TS+s];return l?{shape:l}:{antialiased:!0}}else if(i>0)return{antialiased:!0};return{}}drawScene(e,n){const r=this.getLayer(),i=e||r&&r.getCanvas();return this._fire(CS,{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),Bh.Container.prototype.drawScene.call(this,i,n),this._fire(bS,{node:this}),this}drawHit(e,n){const r=this.getLayer(),i=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),Bh.Container.prototype.drawHit.call(this,i,n),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){Ir.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return Ir.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return Ir.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};hl.Layer=Ao;Ao.prototype.nodeType="Layer";(0,kS._registerNode)(Ao);cg.Factory.addGetterSetter(Ao,"imageSmoothingEnabled",!0);cg.Factory.addGetterSetter(Ao,"clearBeforeDraw",!0);cg.Factory.addGetterSetter(Ao,"hitGraphEnabled",!0,(0,_S.getBooleanValidator)());var qc={};Object.defineProperty(qc,"__esModule",{value:!0});qc.FastLayer=void 0;const PS=at,NS=hl,AS=Pe;class dg extends NS.Layer{constructor(e){super(e),this.listening(!1),PS.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}qc.FastLayer=dg;dg.prototype.nodeType="FastLayer";(0,AS._registerNode)(dg);var Mo={};Object.defineProperty(Mo,"__esModule",{value:!0});Mo.Group=void 0;const MS=at,RS=fs,IS=Pe;let fg=class extends RS.Container{_validateAdd(e){const n=e.getType();n!=="Group"&&n!=="Shape"&&MS.Util.throw("You may only add groups and shapes to groups.")}};Mo.Group=fg;fg.prototype.nodeType="Group";(0,IS._registerNode)(fg);var Ro={};Object.defineProperty(Ro,"__esModule",{value:!0});Ro.Animation=void 0;const Uh=Pe,o2=at,Gh=function(){return Uh.glob.performance&&Uh.glob.performance.now?function(){return Uh.glob.performance.now()}:function(){return new Date().getTime()}}();class _r{constructor(e,n){this.id=_r.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Gh(),frameRate:0},this.func=e,this.setLayers(n)}setLayers(e){let n=[];return e&&(n=Array.isArray(e)?e:[e]),this.layers=n,this}getLayers(){return this.layers}addLayer(e){const n=this.layers,r=n.length;for(let i=0;i<r;i++)if(n[i]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const n=_r.animations,r=n.length;for(let i=0;i<r;i++)if(n[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Gh(),_r._addAnimation(this),this}stop(){return _r._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const n=e.id,r=this.animations,i=r.length;for(let s=0;s<i;s++)if(r[s].id===n){this.animations.splice(s,1);break}}static _runFrames(){const e={},n=this.animations;for(let r=0;r<n.length;r++){const i=n[r],s=i.layers,l=i.func;i._updateFrameObject(Gh());const c=s.length;let u;if(l?u=l.call(i,i.frame)!==!1:u=!0,!!u)for(let f=0;f<c;f++){const h=s[f];h._id!==void 0&&(e[h._id]=h)}}for(const r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=_r;e.animations.length?(e._runFrames(),o2.Util.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,o2.Util.requestAnimFrame(this._animationLoop))}}Ro.Animation=_r;_r.animations=[];_r.animIdCounter=0;_r.animRunning=!1;var D5={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=at,n=Ro,r=tt,i=Pe,s={node:1,duration:1,easing:1,onFinish:1,yoyo:1},l=1,c=2,u=3,f=["fill","stroke","shadowColor"];let h=0;class m{constructor(w,T,k,_,C,g,S){this.prop=w,this.propFunc=T,this.begin=_,this._pos=_,this.duration=g,this._change=0,this.prevPos=0,this.yoyo=S,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=k,this._change=C-this.begin,this.pause()}fire(w){const T=this[w];T&&T()}setTime(w){w>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():w<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=w,this.update())}getTime(){return this._time}setPosition(w){this.prevPos=this._pos,this.propFunc(w),this._pos=w}getPosition(w){return w===void 0&&(w=this._time),this.func(w,this.begin,this._change,this.duration)}play(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=u,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(w){this.pause(),this._time=w,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const w=this.getTimer()-this._startTime;this.state===c?this.setTime(w):this.state===u&&this.setTime(this.duration-w)}pause(){this.state=l,this.fire("onPause")}getTimer(){return new Date().getTime()}}class x{constructor(w){const T=this,k=w.node,_=k._id,C=w.easing||t.Easings.Linear,g=!!w.yoyo;let S,b;typeof w.duration>"u"?S=.3:w.duration===0?S=.001:S=w.duration,this.node=k,this._id=h++;const N=k.getLayer()||(k instanceof i.Konva.Stage?k.getLayers():null);N||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){T.tween.onEnterFrame()},N),this.tween=new m(b,function(I){T._tweenFunc(I)},C,0,1,S*1e3,g),this._addListeners(),x.attrs[_]||(x.attrs[_]={}),x.attrs[_][this._id]||(x.attrs[_][this._id]={}),x.tweens[_]||(x.tweens[_]={});for(b in w)s[b]===void 0&&this._addAttr(b,w[b]);this.reset(),this.onFinish=w.onFinish,this.onReset=w.onReset,this.onUpdate=w.onUpdate}_addAttr(w,T){const k=this.node,_=k._id;let C,g,S,b,N;const I=x.tweens[_][w];I&&delete x.attrs[_][I][w];let A=k.getAttr(w);if(e.Util._isArray(T))if(C=[],g=Math.max(T.length,A.length),w==="points"&&T.length!==A.length&&(T.length>A.length?(b=A,A=e.Util._prepareArrayForTween(A,T,k.closed())):(S=T,T=e.Util._prepareArrayForTween(T,A,k.closed()))),w.indexOf("fill")===0)for(let F=0;F<g;F++)if(F%2===0)C.push(T[F]-A[F]);else{const M=e.Util.colorToRGBA(A[F]);N=e.Util.colorToRGBA(T[F]),A[F]=M,C.push({r:N.r-M.r,g:N.g-M.g,b:N.b-M.b,a:N.a-M.a})}else for(let F=0;F<g;F++)C.push(T[F]-A[F]);else f.indexOf(w)!==-1?(A=e.Util.colorToRGBA(A),N=e.Util.colorToRGBA(T),C={r:N.r-A.r,g:N.g-A.g,b:N.b-A.b,a:N.a-A.a}):C=T-A;x.attrs[_][this._id][w]={start:A,diff:C,end:T,trueEnd:S,trueStart:b},x.tweens[_][w]=this._id}_tweenFunc(w){const T=this.node,k=x.attrs[T._id][this._id];let _,C,g,S,b,N,I,A;for(_ in k){if(C=k[_],g=C.start,S=C.diff,A=C.end,e.Util._isArray(g))if(b=[],I=Math.max(g.length,A.length),_.indexOf("fill")===0)for(N=0;N<I;N++)N%2===0?b.push((g[N]||0)+S[N]*w):b.push("rgba("+Math.round(g[N].r+S[N].r*w)+","+Math.round(g[N].g+S[N].g*w)+","+Math.round(g[N].b+S[N].b*w)+","+(g[N].a+S[N].a*w)+")");else for(N=0;N<I;N++)b.push((g[N]||0)+S[N]*w);else f.indexOf(_)!==-1?b="rgba("+Math.round(g.r+S.r*w)+","+Math.round(g.g+S.g*w)+","+Math.round(g.b+S.b*w)+","+(g.a+S.a*w)+")":b=g+S*w;T.setAttr(_,b)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const w=this.node,T=x.attrs[w._id][this._id];T.points&&T.points.trueEnd&&w.setAttr("points",T.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const w=this.node,T=x.attrs[w._id][this._id];T.points&&T.points.trueStart&&w.points(T.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(w){return this.tween.seek(w*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const w=this.node._id,T=this._id,k=x.tweens[w];this.pause();for(const _ in k)delete x.tweens[w][_];delete x.attrs[w][T]}}t.Tween=x,x.attrs={},x.tweens={},r.Node.prototype.to=function(y){const w=y.onFinish;y.node=this,y.onFinish=function(){this.destroy(),w&&w()},new x(y).play()},t.Easings={BackEaseIn(y,w,T,k){return T*(y/=k)*y*((1.70158+1)*y-1.70158)+w},BackEaseOut(y,w,T,k){return T*((y=y/k-1)*y*((1.70158+1)*y+1.70158)+1)+w},BackEaseInOut(y,w,T,k){let _=1.70158;return(y/=k/2)<1?T/2*(y*y*(((_*=1.525)+1)*y-_))+w:T/2*((y-=2)*y*(((_*=1.525)+1)*y+_)+2)+w},ElasticEaseIn(y,w,T,k,_,C){let g=0;return y===0?w:(y/=k)===1?w+T:(C||(C=k*.3),!_||_<Math.abs(T)?(_=T,g=C/4):g=C/(2*Math.PI)*Math.asin(T/_),-(_*Math.pow(2,10*(y-=1))*Math.sin((y*k-g)*(2*Math.PI)/C))+w)},ElasticEaseOut(y,w,T,k,_,C){let g=0;return y===0?w:(y/=k)===1?w+T:(C||(C=k*.3),!_||_<Math.abs(T)?(_=T,g=C/4):g=C/(2*Math.PI)*Math.asin(T/_),_*Math.pow(2,-10*y)*Math.sin((y*k-g)*(2*Math.PI)/C)+T+w)},ElasticEaseInOut(y,w,T,k,_,C){let g=0;return y===0?w:(y/=k/2)===2?w+T:(C||(C=k*(.3*1.5)),!_||_<Math.abs(T)?(_=T,g=C/4):g=C/(2*Math.PI)*Math.asin(T/_),y<1?-.5*(_*Math.pow(2,10*(y-=1))*Math.sin((y*k-g)*(2*Math.PI)/C))+w:_*Math.pow(2,-10*(y-=1))*Math.sin((y*k-g)*(2*Math.PI)/C)*.5+T+w)},BounceEaseOut(y,w,T,k){return(y/=k)<1/2.75?T*(7.5625*y*y)+w:y<2/2.75?T*(7.5625*(y-=1.5/2.75)*y+.75)+w:y<2.5/2.75?T*(7.5625*(y-=2.25/2.75)*y+.9375)+w:T*(7.5625*(y-=2.625/2.75)*y+.984375)+w},BounceEaseIn(y,w,T,k){return T-t.Easings.BounceEaseOut(k-y,0,T,k)+w},BounceEaseInOut(y,w,T,k){return y<k/2?t.Easings.BounceEaseIn(y*2,0,T,k)*.5+w:t.Easings.BounceEaseOut(y*2-k,0,T,k)*.5+T*.5+w},EaseIn(y,w,T,k){return T*(y/=k)*y+w},EaseOut(y,w,T,k){return-T*(y/=k)*(y-2)+w},EaseInOut(y,w,T,k){return(y/=k/2)<1?T/2*y*y+w:-T/2*(--y*(y-2)-1)+w},StrongEaseIn(y,w,T,k){return T*(y/=k)*y*y*y*y+w},StrongEaseOut(y,w,T,k){return T*((y=y/k-1)*y*y*y*y+1)+w},StrongEaseInOut(y,w,T,k){return(y/=k/2)<1?T/2*y*y*y*y*y+w:T/2*((y-=2)*y*y*y*y+2)+w},Linear(y,w,T,k){return T*y/k+w}}})(D5);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Pe,n=at,r=tt,i=fs,s=L5,l=hl,c=qc,u=Mo,f=Qc,h=St,m=Ro,x=D5,y=Ur,w=sr;t.Konva=n.Util._assign(e.Konva,{Util:n.Util,Transform:n.Transform,Node:r.Node,Container:i.Container,Stage:s.Stage,stages:s.stages,Layer:l.Layer,FastLayer:c.FastLayer,Group:u.Group,DD:f.DD,Shape:h.Shape,shapes:h.shapes,Animation:m.Animation,Tween:x.Tween,Easings:x.Easings,Context:y.Context,Canvas:w.Canvas}),t.default=t.Konva})(Cc);var Jc={};Object.defineProperty(Jc,"__esModule",{value:!0});Jc.Arc=void 0;const ed=Ae,LS=St,a2=Pe,td=_e,FS=Pe;class Kr extends LS.Shape{_sceneFunc(e){const n=a2.Konva.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,n,r),e.arc(0,0,this.innerRadius(),n,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),n=this.outerRadius(),r=this.clockwise(),i=a2.Konva.getAngle(r?360-this.angle():this.angle()),s=Math.cos(Math.min(i,Math.PI)),l=1,c=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),u=Math.sin(Math.min(i,Math.PI/2)),f=s*(s>0?e:n),h=l*n,m=c*(c>0?e:n),x=u*(u>0?n:e);return{x:f,y:r?-1*x:m,width:h-f,height:x-m}}}Jc.Arc=Kr;Kr.prototype._centroid=!0;Kr.prototype.className="Arc";Kr.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];(0,FS._registerNode)(Kr);ed.Factory.addGetterSetter(Kr,"innerRadius",0,(0,td.getNumberValidator)());ed.Factory.addGetterSetter(Kr,"outerRadius",0,(0,td.getNumberValidator)());ed.Factory.addGetterSetter(Kr,"angle",0,(0,td.getNumberValidator)());ed.Factory.addGetterSetter(Kr,"clockwise",!1,(0,td.getBooleanValidator)());var nd={},pl={};Object.defineProperty(pl,"__esModule",{value:!0});pl.Line=void 0;const rd=Ae,jS=Pe,OS=St,z5=_e;function tp(t,e,n,r,i,s,l){const c=Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2)),u=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=l*c/(c+u),h=l*u/(c+u),m=n-f*(i-t),x=r-f*(s-e),y=n+h*(i-t),w=r+h*(s-e);return[m,x,y,w]}function l2(t,e){const n=t.length,r=[];for(let i=2;i<n-2;i+=2){const s=tp(t[i-2],t[i-1],t[i],t[i+1],t[i+2],t[i+3],e);isNaN(s[0])||(r.push(s[0]),r.push(s[1]),r.push(t[i]),r.push(t[i+1]),r.push(s[2]),r.push(s[3]))}return r}let Li=class extends OS.Shape{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){let n=this.points(),r=n.length,i=this.tension(),s=this.closed(),l=this.bezier(),c,u,f;if(r){if(e.beginPath(),e.moveTo(n[0],n[1]),i!==0&&r>4){for(c=this.getTensionPoints(),u=c.length,f=s?0:4,s||e.quadraticCurveTo(c[0],c[1],c[2],c[3]);f<u-2;)e.bezierCurveTo(c[f++],c[f++],c[f++],c[f++],c[f++],c[f++]);s||e.quadraticCurveTo(c[u-2],c[u-1],n[r-2],n[r-1])}else if(l)for(f=2;f<r;)e.bezierCurveTo(n[f++],n[f++],n[f++],n[f++],n[f++],n[f++]);else for(f=2;f<r;f+=2)e.lineTo(n[f],n[f+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():l2(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),n=e.length,r=this.tension(),i=tp(e[n-2],e[n-1],e[0],e[1],e[2],e[3],r),s=tp(e[n-4],e[n-3],e[n-2],e[n-1],e[0],e[1],r),l=l2(e,r);return[i[2],i[3]].concat(l).concat([s[0],s[1],e[n-2],e[n-1],s[2],s[3],i[0],i[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let n=e[0],r=e[0],i=e[1],s=e[1],l,c;for(let u=0;u<e.length/2;u++)l=e[u*2],c=e[u*2+1],n=Math.min(n,l),r=Math.max(r,l),i=Math.min(i,c),s=Math.max(s,c);return{x:n,y:i,width:r-n,height:s-i}}};pl.Line=Li;Li.prototype.className="Line";Li.prototype._attrsAffectingSize=["points","bezier","tension"];(0,jS._registerNode)(Li);rd.Factory.addGetterSetter(Li,"closed",!1);rd.Factory.addGetterSetter(Li,"bezier",!1);rd.Factory.addGetterSetter(Li,"tension",0,(0,z5.getNumberValidator)());rd.Factory.addGetterSetter(Li,"points",[],(0,z5.getNumberArrayValidator)());var Io={},B5={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(l,c,u)=>{let f,h;const x=u/2;f=0;for(let y=0;y<20;y++)h=x*t.tValues[20][y]+x,f+=t.cValues[20][y]*r(l,c,h);return x*f};t.getCubicArcLength=e;const n=(l,c,u)=>{u===void 0&&(u=1);const f=l[0]-2*l[1]+l[2],h=c[0]-2*c[1]+c[2],m=2*l[1]-2*l[0],x=2*c[1]-2*c[0],y=4*(f*f+h*h),w=4*(f*m+h*x),T=m*m+x*x;if(y===0)return u*Math.sqrt(Math.pow(l[2]-l[0],2)+Math.pow(c[2]-c[0],2));const k=w/(2*y),_=T/y,C=u+k,g=_-k*k,S=C*C+g>0?Math.sqrt(C*C+g):0,b=k*k+g>0?Math.sqrt(k*k+g):0,N=k+Math.sqrt(k*k+g)!==0?g*Math.log(Math.abs((C+S)/(k+b))):0;return Math.sqrt(y)/2*(C*S-k*b+N)};t.getQuadraticArcLength=n;function r(l,c,u){const f=i(1,u,l),h=i(1,u,c),m=f*f+h*h;return Math.sqrt(m)}const i=(l,c,u)=>{const f=u.length-1;let h,m;if(f===0)return 0;if(l===0){m=0;for(let x=0;x<=f;x++)m+=t.binomialCoefficients[f][x]*Math.pow(1-c,f-x)*Math.pow(c,x)*u[x];return m}else{h=new Array(f);for(let x=0;x<f;x++)h[x]=f*(u[x+1]-u[x]);return i(l-1,c,h)}},s=(l,c,u)=>{let f=1,h=l/c,m=(l-u(h))/c,x=0;for(;f>.001;){const y=u(h+m),w=Math.abs(l-y)/c;if(w<f)f=w,h+=m;else{const T=u(h-m),k=Math.abs(l-T)/c;k<f?(f=k,h-=m):m/=2}if(x++,x>500)break}return h};t.t2length=s})(B5);Object.defineProperty(Io,"__esModule",{value:!0});Io.Path=void 0;const DS=Ae,zS=St,BS=Pe,Us=B5;class xt extends zS.Shape{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=xt.parsePathData(this.data()),this.pathLength=xt.getPathLength(this.dataArray)}_sceneFunc(e){const n=this.dataArray;e.beginPath();let r=!1;for(let T=0;T<n.length;T++){const k=n[T].command,_=n[T].points;switch(k){case"L":e.lineTo(_[0],_[1]);break;case"M":e.moveTo(_[0],_[1]);break;case"C":e.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5]);break;case"Q":e.quadraticCurveTo(_[0],_[1],_[2],_[3]);break;case"A":var i=_[0],s=_[1],l=_[2],c=_[3],u=_[4],f=_[5],h=_[6],m=_[7],x=l>c?l:c,y=l>c?1:l/c,w=l>c?c/l:1;e.translate(i,s),e.rotate(h),e.scale(y,w),e.arc(0,0,x,u,u+f,1-m),e.scale(1/y,1/w),e.rotate(-h),e.translate(-i,-s);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(u){if(u.command==="A"){const f=u.points[4],h=u.points[5],m=u.points[4]+h;let x=Math.PI/180;if(Math.abs(f-m)<x&&(x=Math.abs(f-m)),h<0)for(let y=f-x;y>m;y-=x){const w=xt.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],y,0);e.push(w.x,w.y)}else for(let y=f+x;y<m;y+=x){const w=xt.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],y,0);e.push(w.x,w.y)}}else if(u.command==="C")for(let f=0;f<=1;f+=.01){const h=xt.getPointOnCubicBezier(f,u.start.x,u.start.y,u.points[0],u.points[1],u.points[2],u.points[3],u.points[4],u.points[5]);e.push(h.x,h.y)}else e=e.concat(u.points)});let n=e[0],r=e[0],i=e[1],s=e[1],l,c;for(let u=0;u<e.length/2;u++)l=e[u*2],c=e[u*2+1],isNaN(l)||(n=Math.min(n,l),r=Math.max(r,l)),isNaN(c)||(i=Math.min(i,c),s=Math.max(s,c));return{x:n,y:i,width:r-n,height:s-i}}getLength(){return this.pathLength}getPointAtLength(e){return xt.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,n,r,i){return Math.sqrt((r-e)*(r-e)+(i-n)*(i-n))}static getPathLength(e){let n=0;for(let r=0;r<e.length;++r)n+=e[r].pathLength;return n}static getPointAtLengthOfDataArray(e,n){let r,i=0,s=n.length;if(!s)return null;for(;i<s&&e>n[i].pathLength;)e-=n[i].pathLength,++i;if(i===s)return r=n[i-1].points.slice(-2),{x:r[0],y:r[1]};if(e<.01)return r=n[i].points.slice(0,2),{x:r[0],y:r[1]};const l=n[i],c=l.points;switch(l.command){case"L":return xt.getPointOnLine(e,l.start.x,l.start.y,c[0],c[1]);case"C":return xt.getPointOnCubicBezier((0,Us.t2length)(e,xt.getPathLength(n),T=>(0,Us.getCubicArcLength)([l.start.x,c[0],c[2],c[4]],[l.start.y,c[1],c[3],c[5]],T)),l.start.x,l.start.y,c[0],c[1],c[2],c[3],c[4],c[5]);case"Q":return xt.getPointOnQuadraticBezier((0,Us.t2length)(e,xt.getPathLength(n),T=>(0,Us.getQuadraticArcLength)([l.start.x,c[0],c[2]],[l.start.y,c[1],c[3]],T)),l.start.x,l.start.y,c[0],c[1],c[2],c[3]);case"A":var u=c[0],f=c[1],h=c[2],m=c[3],x=c[4],y=c[5],w=c[6];return x+=y*e/l.pathLength,xt.getPointOnEllipticalArc(u,f,h,m,x,w)}return null}static getPointOnLine(e,n,r,i,s,l,c){l=l??n,c=c??r;const u=this.getLineLength(n,r,i,s);if(u<1e-10)return{x:n,y:r};if(i===n)return{x:l,y:c+(s>r?e:-e)};const f=(s-r)/(i-n),h=Math.sqrt(e*e/(1+f*f))*(i<n?-1:1),m=f*h;if(Math.abs(c-r-f*(l-n))<1e-10)return{x:l+h,y:c+m};const x=((l-n)*(i-n)+(c-r)*(s-r))/(u*u),y=n+x*(i-n),w=r+x*(s-r),T=this.getLineLength(l,c,y,w),k=Math.sqrt(e*e-T*T),_=Math.sqrt(k*k/(1+f*f))*(i<n?-1:1),C=f*_;return{x:y+_,y:w+C}}static getPointOnCubicBezier(e,n,r,i,s,l,c,u,f){function h(k){return k*k*k}function m(k){return 3*k*k*(1-k)}function x(k){return 3*k*(1-k)*(1-k)}function y(k){return(1-k)*(1-k)*(1-k)}const w=u*h(e)+l*m(e)+i*x(e)+n*y(e),T=f*h(e)+c*m(e)+s*x(e)+r*y(e);return{x:w,y:T}}static getPointOnQuadraticBezier(e,n,r,i,s,l,c){function u(y){return y*y}function f(y){return 2*y*(1-y)}function h(y){return(1-y)*(1-y)}const m=l*u(e)+i*f(e)+n*h(e),x=c*u(e)+s*f(e)+r*h(e);return{x:m,y:x}}static getPointOnEllipticalArc(e,n,r,i,s,l){const c=Math.cos(l),u=Math.sin(l),f={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:e+(f.x*c-f.y*u),y:n+(f.x*u+f.y*c)}}static parsePathData(e){if(!e)return[];let n=e;const r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];n=n.replace(new RegExp(" ","g"),",");for(var i=0;i<r.length;i++)n=n.replace(new RegExp(r[i],"g"),"|"+r[i]);const s=n.split("|"),l=[],c=[];let u=0,f=0;const h=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let m;for(i=1;i<s.length;i++){let A=s[i],F=A.charAt(0);for(A=A.slice(1),c.length=0;m=h.exec(A);)c.push(m[0]);const M=[];for(let R=0,z=c.length;R<z;R++){if(c[R]==="00"){M.push(0,0);continue}const V=parseFloat(c[R]);isNaN(V)?M.push(0):M.push(V)}for(;M.length>0&&!isNaN(M[0]);){let R="",z=[];const V=u,j=f;var x,y,w,T,k,_,C,g,S,b;switch(F){case"l":u+=M.shift(),f+=M.shift(),R="L",z.push(u,f);break;case"L":u=M.shift(),f=M.shift(),z.push(u,f);break;case"m":var N=M.shift(),I=M.shift();if(u+=N,f+=I,R="M",l.length>2&&l[l.length-1].command==="z"){for(let D=l.length-2;D>=0;D--)if(l[D].command==="M"){u=l[D].points[0]+N,f=l[D].points[1]+I;break}}z.push(u,f),F="l";break;case"M":u=M.shift(),f=M.shift(),R="M",z.push(u,f),F="L";break;case"h":u+=M.shift(),R="L",z.push(u,f);break;case"H":u=M.shift(),R="L",z.push(u,f);break;case"v":f+=M.shift(),R="L",z.push(u,f);break;case"V":f=M.shift(),R="L",z.push(u,f);break;case"C":z.push(M.shift(),M.shift(),M.shift(),M.shift()),u=M.shift(),f=M.shift(),z.push(u,f);break;case"c":z.push(u+M.shift(),f+M.shift(),u+M.shift(),f+M.shift()),u+=M.shift(),f+=M.shift(),R="C",z.push(u,f);break;case"S":y=u,w=f,x=l[l.length-1],x.command==="C"&&(y=u+(u-x.points[2]),w=f+(f-x.points[3])),z.push(y,w,M.shift(),M.shift()),u=M.shift(),f=M.shift(),R="C",z.push(u,f);break;case"s":y=u,w=f,x=l[l.length-1],x.command==="C"&&(y=u+(u-x.points[2]),w=f+(f-x.points[3])),z.push(y,w,u+M.shift(),f+M.shift()),u+=M.shift(),f+=M.shift(),R="C",z.push(u,f);break;case"Q":z.push(M.shift(),M.shift()),u=M.shift(),f=M.shift(),z.push(u,f);break;case"q":z.push(u+M.shift(),f+M.shift()),u+=M.shift(),f+=M.shift(),R="Q",z.push(u,f);break;case"T":y=u,w=f,x=l[l.length-1],x.command==="Q"&&(y=u+(u-x.points[0]),w=f+(f-x.points[1])),u=M.shift(),f=M.shift(),R="Q",z.push(y,w,u,f);break;case"t":y=u,w=f,x=l[l.length-1],x.command==="Q"&&(y=u+(u-x.points[0]),w=f+(f-x.points[1])),u+=M.shift(),f+=M.shift(),R="Q",z.push(y,w,u,f);break;case"A":T=M.shift(),k=M.shift(),_=M.shift(),C=M.shift(),g=M.shift(),S=u,b=f,u=M.shift(),f=M.shift(),R="A",z=this.convertEndpointToCenterParameterization(S,b,u,f,C,g,T,k,_);break;case"a":T=M.shift(),k=M.shift(),_=M.shift(),C=M.shift(),g=M.shift(),S=u,b=f,u+=M.shift(),f+=M.shift(),R="A",z=this.convertEndpointToCenterParameterization(S,b,u,f,C,g,T,k,_);break}l.push({command:R||F,points:z,start:{x:V,y:j},pathLength:this.calcLength(V,j,R||F,z)})}(F==="z"||F==="Z")&&l.push({command:"z",points:[],start:void 0,pathLength:0})}return l}static calcLength(e,n,r,i){let s,l,c,u;const f=xt;switch(r){case"L":return f.getLineLength(e,n,i[0],i[1]);case"C":return(0,Us.getCubicArcLength)([e,i[0],i[2],i[4]],[n,i[1],i[3],i[5]],1);case"Q":return(0,Us.getQuadraticArcLength)([e,i[0],i[2]],[n,i[1],i[3]],1);case"A":s=0;var h=i[4],m=i[5],x=i[4]+m,y=Math.PI/180;if(Math.abs(h-x)<y&&(y=Math.abs(h-x)),l=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),m<0)for(u=h-y;u>x;u-=y)c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),l=c;else for(u=h+y;u<x;u+=y)c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),l=c;return c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],x,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),s}return 0}static convertEndpointToCenterParameterization(e,n,r,i,s,l,c,u,f){const h=f*(Math.PI/180),m=Math.cos(h)*(e-r)/2+Math.sin(h)*(n-i)/2,x=-1*Math.sin(h)*(e-r)/2+Math.cos(h)*(n-i)/2,y=m*m/(c*c)+x*x/(u*u);y>1&&(c*=Math.sqrt(y),u*=Math.sqrt(y));let w=Math.sqrt((c*c*(u*u)-c*c*(x*x)-u*u*(m*m))/(c*c*(x*x)+u*u*(m*m)));s===l&&(w*=-1),isNaN(w)&&(w=0);const T=w*c*x/u,k=w*-u*m/c,_=(e+r)/2+Math.cos(h)*T-Math.sin(h)*k,C=(n+i)/2+Math.sin(h)*T+Math.cos(h)*k,g=function(M){return Math.sqrt(M[0]*M[0]+M[1]*M[1])},S=function(M,R){return(M[0]*R[0]+M[1]*R[1])/(g(M)*g(R))},b=function(M,R){return(M[0]*R[1]<M[1]*R[0]?-1:1)*Math.acos(S(M,R))},N=b([1,0],[(m-T)/c,(x-k)/u]),I=[(m-T)/c,(x-k)/u],A=[(-1*m-T)/c,(-1*x-k)/u];let F=b(I,A);return S(I,A)<=-1&&(F=Math.PI),S(I,A)>=1&&(F=0),l===0&&F>0&&(F=F-2*Math.PI),l===1&&F<0&&(F=F+2*Math.PI),[_,C,c,u,N,F,h,l]}}Io.Path=xt;xt.prototype.className="Path";xt.prototype._attrsAffectingSize=["data"];(0,BS._registerNode)(xt);DS.Factory.addGetterSetter(xt,"data");Object.defineProperty(nd,"__esModule",{value:!0});nd.Arrow=void 0;const id=Ae,US=pl,U5=_e,GS=Pe,u2=Io;let ps=class extends US.Line{_sceneFunc(e){super._sceneFunc(e);const n=Math.PI*2,r=this.points();let i=r;const s=this.tension()!==0&&r.length>4;s&&(i=this.getTensionPoints());const l=this.pointerLength(),c=r.length;let u,f;if(s){const x=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[c-2],r[c-1]],y=u2.Path.calcLength(i[i.length-4],i[i.length-3],"C",x),w=u2.Path.getPointOnQuadraticBezier(Math.min(1,1-l/y),x[0],x[1],x[2],x[3],x[4],x[5]);u=r[c-2]-w.x,f=r[c-1]-w.y}else u=r[c-2]-r[c-4],f=r[c-1]-r[c-3];const h=(Math.atan2(f,u)+n)%n,m=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[c-2],r[c-1]),e.rotate(h),e.moveTo(0,0),e.lineTo(-l,m/2),e.lineTo(-l,-m/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),s?(u=(i[0]+i[2])/2-r[0],f=(i[1]+i[3])/2-r[1]):(u=r[2]-r[0],f=r[3]-r[1]),e.rotate((Math.atan2(-f,-u)+n)%n),e.moveTo(0,0),e.lineTo(-l,m/2),e.lineTo(-l,-m/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const n=this.dashEnabled();n&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),n&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),n=this.pointerWidth()/2;return{x:e.x,y:e.y-n,width:e.width,height:e.height+n*2}}};nd.Arrow=ps;ps.prototype.className="Arrow";(0,GS._registerNode)(ps);id.Factory.addGetterSetter(ps,"pointerLength",10,(0,U5.getNumberValidator)());id.Factory.addGetterSetter(ps,"pointerWidth",10,(0,U5.getNumberValidator)());id.Factory.addGetterSetter(ps,"pointerAtBeginning",!1);id.Factory.addGetterSetter(ps,"pointerAtEnding",!0);var sd={};Object.defineProperty(sd,"__esModule",{value:!0});sd.Circle=void 0;const VS=Ae,WS=St,$S=_e,HS=Pe;let Lo=class extends WS.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};sd.Circle=Lo;Lo.prototype._centroid=!0;Lo.prototype.className="Circle";Lo.prototype._attrsAffectingSize=["radius"];(0,HS._registerNode)(Lo);VS.Factory.addGetterSetter(Lo,"radius",0,(0,$S.getNumberValidator)());var od={};Object.defineProperty(od,"__esModule",{value:!0});od.Ellipse=void 0;const hg=Ae,XS=St,G5=_e,YS=Pe;class Fi extends XS.Shape{_sceneFunc(e){const n=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),n!==r&&e.scale(1,r/n),e.arc(0,0,n,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}od.Ellipse=Fi;Fi.prototype.className="Ellipse";Fi.prototype._centroid=!0;Fi.prototype._attrsAffectingSize=["radiusX","radiusY"];(0,YS._registerNode)(Fi);hg.Factory.addComponentsGetterSetter(Fi,"radius",["x","y"]);hg.Factory.addGetterSetter(Fi,"radiusX",0,(0,G5.getNumberValidator)());hg.Factory.addGetterSetter(Fi,"radiusY",0,(0,G5.getNumberValidator)());var ad={};Object.defineProperty(ad,"__esModule",{value:!0});ad.Image=void 0;const Vh=at,gs=Ae,KS=St,QS=Pe,gl=_e;class Vn extends KS.Shape{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",n=>{this._removeImageLoad(n.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),n=this.hasShadow();return e&&n?!0:super._useBufferCanvas(!0)}_sceneFunc(e){const n=this.getWidth(),r=this.getHeight(),i=this.cornerRadius(),s=this.attrs.image;let l;if(s){const c=this.attrs.cropWidth,u=this.attrs.cropHeight;c&&u?l=[s,this.cropX(),this.cropY(),c,u,0,0,n,r]:l=[s,0,0,n,r]}(this.hasFill()||this.hasStroke()||i)&&(e.beginPath(),i?Vh.Util.drawRoundedRectPath(e,n,r,i):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)),s&&(i&&e.clip(),e.drawImage.apply(e,l))}_hitFunc(e){const n=this.width(),r=this.height(),i=this.cornerRadius();e.beginPath(),i?Vh.Util.drawRoundedRectPath(e,n,r,i):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,n;return(e=this.attrs.width)!==null&&e!==void 0?e:(n=this.image())===null||n===void 0?void 0:n.width}getHeight(){var e,n;return(e=this.attrs.height)!==null&&e!==void 0?e:(n=this.image())===null||n===void 0?void 0:n.height}static fromURL(e,n,r=null){const i=Vh.Util.createImageElement();i.onload=function(){const s=new Vn({image:i});n(s)},i.onerror=r,i.crossOrigin="Anonymous",i.src=e}}ad.Image=Vn;Vn.prototype.className="Image";(0,QS._registerNode)(Vn);gs.Factory.addGetterSetter(Vn,"cornerRadius",0,(0,gl.getNumberOrArrayOfNumbersValidator)(4));gs.Factory.addGetterSetter(Vn,"image");gs.Factory.addComponentsGetterSetter(Vn,"crop",["x","y","width","height"]);gs.Factory.addGetterSetter(Vn,"cropX",0,(0,gl.getNumberValidator)());gs.Factory.addGetterSetter(Vn,"cropY",0,(0,gl.getNumberValidator)());gs.Factory.addGetterSetter(Vn,"cropWidth",0,(0,gl.getNumberValidator)());gs.Factory.addGetterSetter(Vn,"cropHeight",0,(0,gl.getNumberValidator)());var wo={};Object.defineProperty(wo,"__esModule",{value:!0});wo.Tag=wo.Label=void 0;const ld=Ae,ZS=St,qS=Mo,pg=_e,V5=Pe,W5=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],JS="Change.konva",ek="none",np="up",rp="right",ip="down",sp="left",tk=W5.length;class gg extends qS.Group{constructor(e){super(e),this.on("add.konva",function(n){this._addListeners(n.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let n=this,r;const i=function(){n._sync()};for(r=0;r<tk;r++)e.on(W5[r]+JS,i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),n=this.getTag(),r,i,s,l,c,u,f;if(e&&n){switch(r=e.width(),i=e.height(),s=n.pointerDirection(),l=n.pointerWidth(),f=n.pointerHeight(),c=0,u=0,s){case np:c=r/2,u=-1*f;break;case rp:c=r+l,u=i/2;break;case ip:c=r/2,u=i+f;break;case sp:c=-1*l,u=i/2;break}n.setAttrs({x:-1*c,y:-1*u,width:r,height:i}),e.setAttrs({x:-1*c,y:-1*u})}}}wo.Label=gg;gg.prototype.className="Label";(0,V5._registerNode)(gg);class ms extends ZS.Shape{_sceneFunc(e){const n=this.width(),r=this.height(),i=this.pointerDirection(),s=this.pointerWidth(),l=this.pointerHeight(),c=this.cornerRadius();let u=0,f=0,h=0,m=0;typeof c=="number"?u=f=h=m=Math.min(c,n/2,r/2):(u=Math.min(c[0]||0,n/2,r/2),f=Math.min(c[1]||0,n/2,r/2),m=Math.min(c[2]||0,n/2,r/2),h=Math.min(c[3]||0,n/2,r/2)),e.beginPath(),e.moveTo(u,0),i===np&&(e.lineTo((n-s)/2,0),e.lineTo(n/2,-1*l),e.lineTo((n+s)/2,0)),e.lineTo(n-f,0),e.arc(n-f,f,f,Math.PI*3/2,0,!1),i===rp&&(e.lineTo(n,(r-l)/2),e.lineTo(n+s,r/2),e.lineTo(n,(r+l)/2)),e.lineTo(n,r-m),e.arc(n-m,r-m,m,0,Math.PI/2,!1),i===ip&&(e.lineTo((n+s)/2,r),e.lineTo(n/2,r+l),e.lineTo((n-s)/2,r)),e.lineTo(h,r),e.arc(h,r-h,h,Math.PI/2,Math.PI,!1),i===sp&&(e.lineTo(0,(r+l)/2),e.lineTo(-1*s,r/2),e.lineTo(0,(r-l)/2)),e.lineTo(0,u),e.arc(u,u,u,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,n=0,r=this.pointerWidth(),i=this.pointerHeight(),s=this.pointerDirection(),l=this.width(),c=this.height();return s===np?(n-=i,c+=i):s===ip?c+=i:s===sp?(e-=r*1.5,l+=r):s===rp&&(l+=r*1.5),{x:e,y:n,width:l,height:c}}}wo.Tag=ms;ms.prototype.className="Tag";(0,V5._registerNode)(ms);ld.Factory.addGetterSetter(ms,"pointerDirection",ek);ld.Factory.addGetterSetter(ms,"pointerWidth",0,(0,pg.getNumberValidator)());ld.Factory.addGetterSetter(ms,"pointerHeight",0,(0,pg.getNumberValidator)());ld.Factory.addGetterSetter(ms,"cornerRadius",0,(0,pg.getNumberOrArrayOfNumbersValidator)(4));var ml={};Object.defineProperty(ml,"__esModule",{value:!0});ml.Rect=void 0;const nk=Ae,rk=St,ik=Pe,sk=at,ok=_e;let ud=class extends rk.Shape{_sceneFunc(e){const n=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),n?sk.Util.drawRoundedRectPath(e,r,i,n):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}};ml.Rect=ud;ud.prototype.className="Rect";(0,ik._registerNode)(ud);nk.Factory.addGetterSetter(ud,"cornerRadius",0,(0,ok.getNumberOrArrayOfNumbersValidator)(4));var cd={};Object.defineProperty(cd,"__esModule",{value:!0});cd.RegularPolygon=void 0;const $5=Ae,ak=St,H5=_e,lk=Pe;class ys extends ak.Shape{_sceneFunc(e){const n=this._getPoints();e.beginPath(),e.moveTo(n[0].x,n[0].y);for(let r=1;r<n.length;r++)e.lineTo(n[r].x,n[r].y);e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,n=this.attrs.radius||0,r=[];for(let i=0;i<e;i++)r.push({x:n*Math.sin(i*2*Math.PI/e),y:-1*n*Math.cos(i*2*Math.PI/e)});return r}getSelfRect(){const e=this._getPoints();let n=e[0].x,r=e[0].y,i=e[0].x,s=e[0].y;return e.forEach(l=>{n=Math.min(n,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),s=Math.max(s,l.y)}),{x:n,y:i,width:r-n,height:s-i}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}cd.RegularPolygon=ys;ys.prototype.className="RegularPolygon";ys.prototype._centroid=!0;ys.prototype._attrsAffectingSize=["radius"];(0,lk._registerNode)(ys);$5.Factory.addGetterSetter(ys,"radius",0,(0,H5.getNumberValidator)());$5.Factory.addGetterSetter(ys,"sides",0,(0,H5.getNumberValidator)());var dd={};Object.defineProperty(dd,"__esModule",{value:!0});dd.Ring=void 0;const X5=Ae,uk=St,Y5=_e,ck=Pe,c2=Math.PI*2;class vs extends uk.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,c2,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),c2,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}dd.Ring=vs;vs.prototype.className="Ring";vs.prototype._centroid=!0;vs.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,ck._registerNode)(vs);X5.Factory.addGetterSetter(vs,"innerRadius",0,(0,Y5.getNumberValidator)());X5.Factory.addGetterSetter(vs,"outerRadius",0,(0,Y5.getNumberValidator)());var fd={};Object.defineProperty(fd,"__esModule",{value:!0});fd.Sprite=void 0;const xs=Ae,dk=St,fk=Ro,K5=_e,hk=Pe;class Cr extends dk.Shape{constructor(e){super(e),this._updated=!0,this.anim=new fk.Animation(()=>{const n=this._updated;return this._updated=!1,n}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const n=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[n],l=this.frameOffsets(),c=s[i+0],u=s[i+1],f=s[i+2],h=s[i+3],m=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,f,h),e.closePath(),e.fillStrokeShape(this)),m)if(l){const x=l[n],y=r*2;e.drawImage(m,c,u,f,h,x[y+0],x[y+1],f,h)}else e.drawImage(m,c,u,f,h,0,0,f,h)}_hitFunc(e){const n=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[n],l=this.frameOffsets(),c=s[i+2],u=s[i+3];if(e.beginPath(),l){const f=l[n],h=r*2;e.rect(f[h+0],f[h+1],c,u)}else e.rect(0,0,c,u);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),n=this.animation(),r=this.animations(),i=r[n],s=i.length/4;e<s-1?this.frameIndex(e+1):this.frameIndex(0)}}fd.Sprite=Cr;Cr.prototype.className="Sprite";(0,hk._registerNode)(Cr);xs.Factory.addGetterSetter(Cr,"animation");xs.Factory.addGetterSetter(Cr,"animations");xs.Factory.addGetterSetter(Cr,"frameOffsets");xs.Factory.addGetterSetter(Cr,"image");xs.Factory.addGetterSetter(Cr,"frameIndex",0,(0,K5.getNumberValidator)());xs.Factory.addGetterSetter(Cr,"frameRate",17,(0,K5.getNumberValidator)());xs.Factory.backCompat(Cr,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});var hd={};Object.defineProperty(hd,"__esModule",{value:!0});hd.Star=void 0;const mg=Ae,pk=St,yg=_e,gk=Pe;class ji extends pk.Shape{_sceneFunc(e){const n=this.innerRadius(),r=this.outerRadius(),i=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(let s=1;s<i*2;s++){const l=s%2===0?r:n,c=l*Math.sin(s*Math.PI/i),u=-1*l*Math.cos(s*Math.PI/i);e.lineTo(c,u)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}hd.Star=ji;ji.prototype.className="Star";ji.prototype._centroid=!0;ji.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,gk._registerNode)(ji);mg.Factory.addGetterSetter(ji,"numPoints",5,(0,yg.getNumberValidator)());mg.Factory.addGetterSetter(ji,"innerRadius",0,(0,yg.getNumberValidator)());mg.Factory.addGetterSetter(ji,"outerRadius",0,(0,yg.getNumberValidator)());var Fo={};Object.defineProperty(Fo,"__esModule",{value:!0});Fo.Text=void 0;Fo.stringToArray=Ji;const op=at,Kt=Ae,mk=St,Wh=Pe,Oi=_e,yk=Pe;function Ji(t){return[...t].reduce((e,n,r,i)=>{if(/\p{Emoji}/u.test(n)){const s=i[r+1];s&&/\p{Emoji_Modifier}|\u200D/u.test(s)?(e.push(n+s),i[r+1]=""):e.push(n)}else/\p{Regional_Indicator}{2}/u.test(n+(i[r+1]||""))?e.push(n+i[r+1]):r>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(n)?e[e.length-1]+=n:n&&e.push(n);return e},[])}const Gs="auto",vk="center",Q5="inherit",pa="justify",xk="Change.konva",wk="2d",d2="-",Z5="left",_k="text",Sk="Text",kk="top",Tk="bottom",f2="middle",q5="normal",Ck="px ",Mu=" ",bk="right",h2="rtl",Ek="word",Pk="char",p2="none",$h="",J5=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Nk=J5.length;function Ak(t){return t.split(",").map(e=>{e=e.trim();const n=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return n&&!r&&(e=`"${e}"`),e}).join(", ")}let Ru;function Hh(){return Ru||(Ru=op.Util.createCanvasElement().getContext(wk),Ru)}function Mk(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Rk(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Ik(t){return t=t||{},!t.fillLinearGradientColorStops&&!t.fillRadialGradientColorStops&&!t.fillPatternImage&&(t.fill=t.fill||"black"),t}let ct=class extends mk.Shape{constructor(e){super(Ik(e)),this._partialTextX=0,this._partialTextY=0;for(let n=0;n<Nk;n++)this.on(J5[n]+xk,this._setTextData);this._setTextData()}_sceneFunc(e){const n=this.textArr,r=n.length;if(!this.text())return;let i=this.padding(),s=this.fontSize(),l=this.lineHeight()*s,c=this.verticalAlign(),u=this.direction(),f=0,h=this.align(),m=this.getWidth(),x=this.letterSpacing(),y=this.fill(),w=this.textDecoration(),T=w.indexOf("underline")!==-1,k=w.indexOf("line-through")!==-1,_;u=u===Q5?e.direction:u;let C=l/2,g=f2;if(Wh.Konva._fixTextRendering){const z=this.measureSize("M");g="alphabetic",C=(z.fontBoundingBoxAscent-z.fontBoundingBoxDescent)/2+l/2}var S=0,b=0;for(u===h2&&e.setAttr("direction",u),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",g),e.setAttr("textAlign",Z5),c===f2?f=(this.getHeight()-r*l-i*2)/2:c===Tk&&(f=this.getHeight()-r*l-i*2),e.translate(i,f+i),_=0;_<r;_++){var S=0,b=0,N=n[_],I=N.text,A=N.width,F=N.lastInParagraph,M,R;if(e.save(),h===bk?S+=m-A-i*2:h===vk&&(S+=(m-A-i*2)/2),T){e.save(),e.beginPath();const j=Wh.Konva._fixTextRendering?Math.round(s/4):Math.round(s/2),D=S,G=C+b+j;e.moveTo(D,G),M=I.split(" ").length-1,R=h===pa&&!F?m-i*2:A,e.lineTo(D+Math.round(R),G),e.lineWidth=s/15;const H=this._getLinearGradient();e.strokeStyle=H||y,e.stroke(),e.restore()}if(k){e.save(),e.beginPath();const j=Wh.Konva._fixTextRendering?-Math.round(s/4):0;e.moveTo(S,C+b+j),M=I.split(" ").length-1,R=h===pa&&!F?m-i*2:A,e.lineTo(S+Math.round(R),C+b+j),e.lineWidth=s/15;const D=this._getLinearGradient();e.strokeStyle=D||y,e.stroke(),e.restore()}if(u!==h2&&(x!==0||h===pa)){M=I.split(" ").length-1;const j=Ji(I);for(let D=0;D<j.length;D++){const G=j[D];G===" "&&!F&&h===pa&&(S+=(m-i*2-A)/M),this._partialTextX=S,this._partialTextY=C+b,this._partialText=G,e.fillStrokeShape(this),S+=this.measureSize(G).width+x}}else x!==0&&e.setAttr("letterSpacing",`${x}px`),this._partialTextX=S,this._partialTextY=C+b,this._partialText=I,e.fillStrokeShape(this);e.restore(),r>1&&(C+=l)}}_hitFunc(e){const n=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}setText(e){const n=op.Util._isString(e)?e:e==null?"":e+"";return this._setAttr(_k,n),this}getWidth(){return this.attrs.width===Gs||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===Gs||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return op.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var n,r,i,s,l,c,u,f,h,m,x;let y=Hh(),w=this.fontSize(),T;y.save(),y.font=this._getContextFont(),T=y.measureText(e),y.restore();const k=w/100;return{actualBoundingBoxAscent:(n=T.actualBoundingBoxAscent)!==null&&n!==void 0?n:71.58203125*k,actualBoundingBoxDescent:(r=T.actualBoundingBoxDescent)!==null&&r!==void 0?r:0,actualBoundingBoxLeft:(i=T.actualBoundingBoxLeft)!==null&&i!==void 0?i:-7.421875*k,actualBoundingBoxRight:(s=T.actualBoundingBoxRight)!==null&&s!==void 0?s:75.732421875*k,alphabeticBaseline:(l=T.alphabeticBaseline)!==null&&l!==void 0?l:0,emHeightAscent:(c=T.emHeightAscent)!==null&&c!==void 0?c:100*k,emHeightDescent:(u=T.emHeightDescent)!==null&&u!==void 0?u:-20*k,fontBoundingBoxAscent:(f=T.fontBoundingBoxAscent)!==null&&f!==void 0?f:91*k,fontBoundingBoxDescent:(h=T.fontBoundingBoxDescent)!==null&&h!==void 0?h:21*k,hangingBaseline:(m=T.hangingBaseline)!==null&&m!==void 0?m:72.80000305175781*k,ideographicBaseline:(x=T.ideographicBaseline)!==null&&x!==void 0?x:-21*k,width:T.width,height:w}}_getContextFont(){return this.fontStyle()+Mu+this.fontVariant()+Mu+(this.fontSize()+Ck)+Ak(this.fontFamily())}_addTextLine(e){this.align()===pa&&(e=e.trim());const r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){const n=this.letterSpacing(),r=e.length;return Hh().measureText(e).width+n*r}_setTextData(){let e=this.text().split(`
`),n=+this.fontSize(),r=0,i=this.lineHeight()*n,s=this.attrs.width,l=this.attrs.height,c=s!==Gs&&s!==void 0,u=l!==Gs&&l!==void 0,f=this.padding(),h=s-f*2,m=l-f*2,x=0,y=this.wrap(),w=y!==p2,T=y!==Pk&&w,k=this.ellipsis();this.textArr=[],Hh().font=this._getContextFont();const _=k?this._getTextWidth($h):0;for(let C=0,g=e.length;C<g;++C){let S=e[C],b=this._getTextWidth(S);if(c&&b>h)for(;S.length>0;){let N=0,I=Ji(S).length,A="",F=0;for(;N<I;){const M=N+I>>>1,R=Ji(S),z=R.slice(0,M+1).join(""),V=this._getTextWidth(z);(k&&u&&x+i>m?V+_:V)<=h?(N=M+1,A=z,F=V):I=M}if(A){if(T){const z=Ji(S),V=Ji(A),j=z[V.length],D=j===Mu||j===d2;let G;if(D&&F<=h)G=V.length;else{const H=V.lastIndexOf(Mu),O=V.lastIndexOf(d2);G=Math.max(H,O)+1}G>0&&(N=G,A=z.slice(0,N).join(""),F=this._getTextWidth(A))}if(A=A.trimRight(),this._addTextLine(A),r=Math.max(r,F),x+=i,this._shouldHandleEllipsis(x)){this._tryToAddEllipsisToLastLine();break}if(S=Ji(S).slice(N).join("").trimLeft(),S.length>0&&(b=this._getTextWidth(S),b<=h)){this._addTextLine(S),x+=i,r=Math.max(r,b);break}}else break}else this._addTextLine(S),x+=i,r=Math.max(r,b),this._shouldHandleEllipsis(x)&&C<g-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),u&&x+i>m)break}this.textHeight=n,this.textWidth=r}_shouldHandleEllipsis(e){const n=+this.fontSize(),r=this.lineHeight()*n,i=this.attrs.height,s=i!==Gs&&i!==void 0,l=this.padding(),c=i-l*2;return!(this.wrap()!==p2)||s&&e+r>c}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,n=e!==Gs&&e!==void 0,r=this.padding(),i=e-r*2,s=this.ellipsis(),l=this.textArr[this.textArr.length-1];!l||!s||(n&&(this._getTextWidth(l.text+$h)<i||(l.text=l.text.slice(0,l.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(l.text+$h))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,n=this.hasShadow();return e&&n?!0:super._useBufferCanvas()}};Fo.Text=ct;ct.prototype._fillFunc=Mk;ct.prototype._strokeFunc=Rk;ct.prototype.className=Sk;ct.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,yk._registerNode)(ct);Kt.Factory.overWriteSetter(ct,"width",(0,Oi.getNumberOrAutoValidator)());Kt.Factory.overWriteSetter(ct,"height",(0,Oi.getNumberOrAutoValidator)());Kt.Factory.addGetterSetter(ct,"direction",Q5);Kt.Factory.addGetterSetter(ct,"fontFamily","Arial");Kt.Factory.addGetterSetter(ct,"fontSize",12,(0,Oi.getNumberValidator)());Kt.Factory.addGetterSetter(ct,"fontStyle",q5);Kt.Factory.addGetterSetter(ct,"fontVariant",q5);Kt.Factory.addGetterSetter(ct,"padding",0,(0,Oi.getNumberValidator)());Kt.Factory.addGetterSetter(ct,"align",Z5);Kt.Factory.addGetterSetter(ct,"verticalAlign",kk);Kt.Factory.addGetterSetter(ct,"lineHeight",1,(0,Oi.getNumberValidator)());Kt.Factory.addGetterSetter(ct,"wrap",Ek);Kt.Factory.addGetterSetter(ct,"ellipsis",!1,(0,Oi.getBooleanValidator)());Kt.Factory.addGetterSetter(ct,"letterSpacing",0,(0,Oi.getNumberValidator)());Kt.Factory.addGetterSetter(ct,"text","",(0,Oi.getStringValidator)());Kt.Factory.addGetterSetter(ct,"textDecoration","");var pd={};Object.defineProperty(pd,"__esModule",{value:!0});pd.TextPath=void 0;const Xh=at,ar=Ae,Lk=St,ga=Io,Yh=Fo,e4=_e,Fk=Pe,jk="",t4="normal";function n4(t){t.fillText(this.partialText,0,0)}function r4(t){t.strokeText(this.partialText,0,0)}class kt extends Lk.Shape{constructor(e){super(e),this.dummyCanvas=Xh.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return ga.Path.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;const n=this.pathLength;return e-1>n?null:ga.Path.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=ga.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const n=this.textDecoration(),r=this.fill(),i=this.fontSize(),s=this.glyphInfo;n==="underline"&&e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),this.partialText=s[l].text,e.fillStrokeShape(this),n==="underline"&&(l===0&&e.moveTo(0,i/2+1),e.lineTo(i,i/2+1)),e.restore()}n==="underline"&&(e.strokeStyle=r,e.lineWidth=i/20,e.stroke()),e.restore()}_hitFunc(e){e.beginPath();const n=this.glyphInfo;if(n.length>=1){const r=n[0].p0;e.moveTo(r.x,r.y)}for(let r=0;r<n.length;r++){const i=n[r].p1;e.lineTo(i.x,i.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return Xh.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return Yh.Text.prototype.setText.call(this,e)}_getContextFont(){return Yh.Text.prototype._getContextFont.call(this)}_getTextSize(e){const r=this.dummyCanvas.getContext("2d");r.save(),r.font=this._getContextFont();const i=r.measureText(e);return r.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:e,height:n}=this._getTextSize(this.attrs.text);if(this.textWidth=e,this.textHeight=n,this.glyphInfo=[],!this.attrs.data)return null;const r=this.letterSpacing(),i=this.align(),s=this.kerningFunc(),l=Math.max(this.textWidth+((this.attrs.text||"").length-1)*r,0);let c=0;i==="center"&&(c=Math.max(0,this.pathLength/2-l/2)),i==="right"&&(c=Math.max(0,this.pathLength-l));const u=(0,Yh.stringToArray)(this.text());let f=c;for(let h=0;h<u.length;h++){const m=this._getPointAtLength(f);if(!m)return;let x=this._getTextSize(u[h]).width+r;if(u[h]===" "&&i==="justify"){const C=this.text().split(" ").length-1;x+=(this.pathLength-l)/C}const y=this._getPointAtLength(f+x);if(!y)return;const w=ga.Path.getLineLength(m.x,m.y,y.x,y.y);let T=0;if(s)try{T=s(u[h-1],u[h])*this.fontSize()}catch{T=0}m.x+=T,y.x+=T,this.textWidth+=T;const k=ga.Path.getPointOnLine(T+w/2,m.x,m.y,y.x,y.y),_=Math.atan2(y.y-m.y,y.x-m.x);this.glyphInfo.push({transposeX:k.x,transposeY:k.y,text:u[h],rotation:_,p0:m,p1:y}),f+=x}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(f){e.push(f.p0.x),e.push(f.p0.y),e.push(f.p1.x),e.push(f.p1.y)});let n=e[0]||0,r=e[0]||0,i=e[1]||0,s=e[1]||0,l,c;for(let f=0;f<e.length/2;f++)l=e[f*2],c=e[f*2+1],n=Math.min(n,l),r=Math.max(r,l),i=Math.min(i,c),s=Math.max(s,c);const u=this.fontSize();return{x:n-u/2,y:i-u/2,width:r-n+u,height:s-i+u}}destroy(){return Xh.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}pd.TextPath=kt;kt.prototype._fillFunc=n4;kt.prototype._strokeFunc=r4;kt.prototype._fillFuncHit=n4;kt.prototype._strokeFuncHit=r4;kt.prototype.className="TextPath";kt.prototype._attrsAffectingSize=["text","fontSize","data"];(0,Fk._registerNode)(kt);ar.Factory.addGetterSetter(kt,"data");ar.Factory.addGetterSetter(kt,"fontFamily","Arial");ar.Factory.addGetterSetter(kt,"fontSize",12,(0,e4.getNumberValidator)());ar.Factory.addGetterSetter(kt,"fontStyle",t4);ar.Factory.addGetterSetter(kt,"align","left");ar.Factory.addGetterSetter(kt,"letterSpacing",0,(0,e4.getNumberValidator)());ar.Factory.addGetterSetter(kt,"textBaseline","middle");ar.Factory.addGetterSetter(kt,"fontVariant",t4);ar.Factory.addGetterSetter(kt,"text",jk);ar.Factory.addGetterSetter(kt,"textDecoration","");ar.Factory.addGetterSetter(kt,"kerningFunc",void 0);var gd={};Object.defineProperty(gd,"__esModule",{value:!0});gd.Transformer=void 0;const Ge=at,Be=Ae,g2=tt,Ok=St,Dk=ml,m2=Mo,Zn=Pe,Di=_e,zk=Pe,i4="tr-konva",Bk=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(t=>t+`.${i4}`).join(" "),y2="nodesRect",Uk=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],Gk={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Vk="ontouchstart"in Zn.Konva._global;function Wk(t,e,n){if(t==="rotater")return n;e+=Ge.Util.degToRad(Gk[t]||0);const r=(Ge.Util.radToDeg(e)%360+360)%360;return Ge.Util._inRange(r,315+22.5,360)||Ge.Util._inRange(r,0,22.5)?"ns-resize":Ge.Util._inRange(r,45-22.5,45+22.5)?"nesw-resize":Ge.Util._inRange(r,90-22.5,90+22.5)?"ew-resize":Ge.Util._inRange(r,135-22.5,135+22.5)?"nwse-resize":Ge.Util._inRange(r,180-22.5,180+22.5)?"ns-resize":Ge.Util._inRange(r,225-22.5,225+22.5)?"nesw-resize":Ge.Util._inRange(r,270-22.5,270+22.5)?"ew-resize":Ge.Util._inRange(r,315-22.5,315+22.5)?"nwse-resize":(Ge.Util.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}const Ec=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],v2=1e8;function $k(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}function s4(t,e,n){const r=n.x+(t.x-n.x)*Math.cos(e)-(t.y-n.y)*Math.sin(e),i=n.y+(t.x-n.x)*Math.sin(e)+(t.y-n.y)*Math.cos(e);return{...t,rotation:t.rotation+e,x:r,y:i}}function Hk(t,e){const n=$k(t);return s4(t,e,n)}function Xk(t,e,n){let r=e;for(let i=0;i<t.length;i++){const s=Zn.Konva.getAngle(t[i]),l=Math.abs(s-e)%(Math.PI*2);Math.min(l,Math.PI*2-l)<n&&(r=s)}return r}let ap=0;class Fe extends m2.Group{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Bk,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return Ge.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return i4+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const n=e.filter(i=>i.isAncestorOf(this)?(Ge.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=n,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(i=>{const s=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(i._attrsAffectingSize.length){const l=i._attrsAffectingSize.map(c=>c+"Change."+this._getEventNamespace()).join(" ");i.on(l,s)}i.on(Uk.map(l=>l+`.${this._getEventNamespace()}`).join(" "),s),i.on(`absoluteTransformChange.${this._getEventNamespace()}`,s),this._proxyDrag(i)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let n;e.on(`dragstart.${this._getEventNamespace()}`,r=>{n=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(r,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!n)return;const i=e.getAbsolutePosition(),s=i.x-n.x,l=i.y-n.y;this.nodes().forEach(c=>{if(c===e||c.isDragging())return;const u=c.getAbsolutePosition();c.setAbsolutePosition({x:u.x+s,y:u.y+l}),c.startDrag(r)}),n=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(y2),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(y2,this.__getNodeRect)}__getNodeShape(e,n=this.rotation(),r){const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=e.getAbsoluteScale(r),l=e.getAbsolutePosition(r),c=i.x*s.x-e.offsetX()*s.x,u=i.y*s.y-e.offsetY()*s.y,f=(Zn.Konva.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),h={x:l.x+c*Math.cos(f)+u*Math.sin(-f),y:l.y+u*Math.cos(f)+c*Math.sin(f),width:i.width*s.x,height:i.height*s.y,rotation:f};return s4(h,-Zn.Konva.getAngle(n),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-v2,y:-v2,width:0,height:0,rotation:0};const n=[];this.nodes().map(f=>{const h=f.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),m=[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}],x=f.getAbsoluteTransform();m.forEach(function(y){const w=x.point(y);n.push(w)})});const r=new Ge.Transform;r.rotate(-Zn.Konva.getAngle(this.rotation()));let i=1/0,s=1/0,l=-1/0,c=-1/0;n.forEach(function(f){const h=r.point(f);i===void 0&&(i=l=h.x,s=c=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),c=Math.max(c,h.y)}),r.invert();const u=r.point({x:i,y:s});return{x:u.x,y:u.y,width:l-i,height:c-s,rotation:Zn.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Ec.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const n=new Dk.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Vk?10:"auto"}),r=this;n.on("mousedown touchstart",function(i){r._handleMouseDown(i)}),n.on("dragstart",i=>{n.stopDrag(),i.cancelBubble=!0}),n.on("dragend",i=>{i.cancelBubble=!0}),n.on("mouseenter",()=>{const i=Zn.Konva.getAngle(this.rotation()),s=this.rotateAnchorCursor(),l=Wk(e,i,s);n.getStage().content&&(n.getStage().content.style.cursor=l),this._cursorChange=!0}),n.on("mouseout",()=>{n.getStage().content&&(n.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(n)}_createBack(){const e=new Ok.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(n,r){const i=r.getParent(),s=i.padding();n.beginPath(),n.rect(-s,-s,r.width()+s*2,r.height()+s*2),n.moveTo(r.width()/2,-s),i.rotateEnabled()&&i.rotateLineVisible()&&n.lineTo(r.width()/2,-i.rotateAnchorOffset()*Ge.Util._sign(r.height())-s),n.fillStrokeShape(r)},hitFunc:(n,r)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();n.beginPath(),n.rect(-i,-i,r.width()+i*2,r.height()+i*2),n.fillStrokeShape(r)}});this.add(e),this._proxyDrag(e),e.on("dragstart",n=>{n.cancelBubble=!0}),e.on("dragmove",n=>{n.cancelBubble=!0}),e.on("dragend",n=>{n.cancelBubble=!0}),this.on("dragmove",n=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const n=this._getNodeRect(),r=n.width,i=n.height,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));this.sin=Math.abs(i/s),this.cos=Math.abs(r/s),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const l=e.target.getAbsolutePosition(),c=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:c.x-l.x,y:c.y-l.y},ap++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(u=>{u._fire("transformstart",{evt:e.evt,target:u})})}_handleMouseMove(e){let n,r,i;const s=this.findOne("."+this._movingAnchorName),l=s.getStage();l.setPointersPositions(e);const c=l.getPointerPosition();let u={x:c.x-this._anchorDragOffset.x,y:c.y-this._anchorDragOffset.y};const f=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(u=this.anchorDragBoundFunc()(f,u,e)),s.setAbsolutePosition(u);const h=s.getAbsolutePosition();if(f.x===h.x&&f.y===h.y)return;if(this._movingAnchorName==="rotater"){const b=this._getNodeRect();n=s.x()-b.width/2,r=-s.y()+b.height/2;let N=Math.atan2(-r,n)+Math.PI/2;b.height<0&&(N-=Math.PI);const A=Zn.Konva.getAngle(this.rotation())+N,F=Zn.Konva.getAngle(this.rotationSnapTolerance()),R=Xk(this.rotationSnaps(),A,F)-b.rotation,z=Hk(b,R);this._fitNodesInto(z,e);return}const m=this.shiftBehavior();let x;m==="inverted"?x=this.keepRatio()&&!e.shiftKey:m==="none"?x=this.keepRatio():x=this.keepRatio()||e.shiftKey;var _=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(x){var y=_?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(y.x-s.x(),2)+Math.pow(y.y-s.y(),2));var w=this.findOne(".top-left").x()>y.x?-1:1,T=this.findOne(".top-left").y()>y.y?-1:1;n=i*this.cos*w,r=i*this.sin*T,this.findOne(".top-left").x(y.x-n),this.findOne(".top-left").y(y.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(s.y());else if(this._movingAnchorName==="top-right"){if(x){var y=_?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(s.x()-y.x,2)+Math.pow(y.y-s.y(),2));var w=this.findOne(".top-right").x()<y.x?-1:1,T=this.findOne(".top-right").y()>y.y?-1:1;n=i*this.cos*w,r=i*this.sin*T,this.findOne(".top-right").x(y.x+n),this.findOne(".top-right").y(y.y-r)}var k=s.position();this.findOne(".top-left").y(k.y),this.findOne(".bottom-right").x(k.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(s.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(s.x());else if(this._movingAnchorName==="bottom-left"){if(x){var y=_?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(y.x-s.x(),2)+Math.pow(s.y()-y.y,2));var w=y.x<s.x()?-1:1,T=s.y()<y.y?-1:1;n=i*this.cos*w,r=i*this.sin*T,s.x(y.x-n),s.y(y.y+r)}k=s.position(),this.findOne(".top-left").x(k.x),this.findOne(".bottom-right").y(k.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(s.y());else if(this._movingAnchorName==="bottom-right"){if(x){var y=_?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(s.x()-y.x,2)+Math.pow(s.y()-y.y,2));var w=this.findOne(".bottom-right").x()<y.x?-1:1,T=this.findOne(".bottom-right").y()<y.y?-1:1;n=i*this.cos*w,r=i*this.sin*T,this.findOne(".bottom-right").x(y.x+n),this.findOne(".bottom-right").y(y.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var _=this.centeredScaling()||e.altKey;if(_){const b=this.findOne(".top-left"),N=this.findOne(".bottom-right"),I=b.x(),A=b.y(),F=this.getWidth()-N.x(),M=this.getHeight()-N.y();N.move({x:-I,y:-A}),b.move({x:F,y:M})}const C=this.findOne(".top-left").getAbsolutePosition();n=C.x,r=C.y;const g=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),S=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:n,y:r,width:g,height:S,rotation:Zn.Konva.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var n;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const r=this.getNode();ap--,this._fire("transformend",{evt:e,target:r}),(n=this.getLayer())===null||n===void 0||n.batchDraw(),r&&this._nodes.forEach(i=>{var s;i._fire("transformend",{evt:e,target:i}),(s=i.getLayer())===null||s===void 0||s.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,n){const r=this._getNodeRect(),i=1;if(Ge.Util._inRange(e.width,-this.padding()*2-i,i)){this.update();return}if(Ge.Util._inRange(e.height,-this.padding()*2-i,i)){this.update();return}const s=new Ge.Transform;if(s.rotate(Zn.Konva.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const x=s.point({x:-this.padding()*2,y:0});e.x+=x.x,e.y+=x.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const x=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const x=s.point({x:0,y:-this.padding()*2});e.x+=x.x,e.y+=x.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const x=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){const x=this.boundBoxFunc()(r,e);x?e=x:Ge.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const l=1e7,c=new Ge.Transform;c.translate(r.x,r.y),c.rotate(r.rotation),c.scale(r.width/l,r.height/l);const u=new Ge.Transform,f=e.width/l,h=e.height/l;this.flipEnabled()===!1?(u.translate(e.x,e.y),u.rotate(e.rotation),u.translate(e.width<0?e.width:0,e.height<0?e.height:0),u.scale(Math.abs(f),Math.abs(h))):(u.translate(e.x,e.y),u.rotate(e.rotation),u.scale(f,h));const m=u.multiply(c.invert());this._nodes.forEach(x=>{var y;const w=x.getParent().getAbsoluteTransform(),T=x.getTransform().copy();T.translate(x.offsetX(),x.offsetY());const k=new Ge.Transform;k.multiply(w.copy().invert()).multiply(m).multiply(w).multiply(T);const _=k.decompose();x.setAttrs(_),(y=x.getLayer())===null||y===void 0||y.batchDraw()}),this.rotation(Ge.Util._getRotation(e.rotation)),this._nodes.forEach(x=>{this._fire("transform",{evt:n,target:x}),x._fire("transform",{evt:n,target:x})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,n){this.findOne(e).setAttrs(n)}update(){var e;const n=this._getNodeRect();this.rotation(Ge.Util._getRotation(n.rotation));const r=n.width,i=n.height,s=this.enabledAnchors(),l=this.resizeEnabled(),c=this.padding(),u=this.anchorSize(),f=this.find("._anchor");f.forEach(m=>{m.setAttrs({width:u,height:u,offsetX:u/2,offsetY:u/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:u/2+c,offsetY:u/2+c,visible:l&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:u/2+c,visible:l&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:u/2-c,offsetY:u/2+c,visible:l&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:u/2+c,visible:l&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:i/2,offsetX:u/2-c,visible:l&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:u/2+c,offsetY:u/2-c,visible:l&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:i,offsetY:u/2-c,visible:l&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:i,offsetX:u/2-c,offsetY:u/2-c,visible:l&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*Ge.Util._sign(i)-c,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const h=this.anchorStyleFunc();h&&f.forEach(m=>{h(m)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),m2.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return g2.Node.prototype.toObject.call(this)}clone(e){return g2.Node.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}gd.Transformer=Fe;Fe.isTransforming=()=>ap>0;function Yk(t){return t instanceof Array||Ge.Util.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach(function(e){Ec.indexOf(e)===-1&&Ge.Util.warn("Unknown anchor name: "+e+". Available names are: "+Ec.join(", "))}),t||[]}Fe.prototype.className="Transformer";(0,zk._registerNode)(Fe);Be.Factory.addGetterSetter(Fe,"enabledAnchors",Ec,Yk);Be.Factory.addGetterSetter(Fe,"flipEnabled",!0,(0,Di.getBooleanValidator)());Be.Factory.addGetterSetter(Fe,"resizeEnabled",!0);Be.Factory.addGetterSetter(Fe,"anchorSize",10,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"rotateEnabled",!0);Be.Factory.addGetterSetter(Fe,"rotateLineVisible",!0);Be.Factory.addGetterSetter(Fe,"rotationSnaps",[]);Be.Factory.addGetterSetter(Fe,"rotateAnchorOffset",50,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"rotateAnchorCursor","crosshair");Be.Factory.addGetterSetter(Fe,"rotationSnapTolerance",5,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"borderEnabled",!0);Be.Factory.addGetterSetter(Fe,"anchorStroke","rgb(0, 161, 255)");Be.Factory.addGetterSetter(Fe,"anchorStrokeWidth",1,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"anchorFill","white");Be.Factory.addGetterSetter(Fe,"anchorCornerRadius",0,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"borderStroke","rgb(0, 161, 255)");Be.Factory.addGetterSetter(Fe,"borderStrokeWidth",1,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"borderDash");Be.Factory.addGetterSetter(Fe,"keepRatio",!0);Be.Factory.addGetterSetter(Fe,"shiftBehavior","default");Be.Factory.addGetterSetter(Fe,"centeredScaling",!1);Be.Factory.addGetterSetter(Fe,"ignoreStroke",!1);Be.Factory.addGetterSetter(Fe,"padding",0,(0,Di.getNumberValidator)());Be.Factory.addGetterSetter(Fe,"nodes");Be.Factory.addGetterSetter(Fe,"node");Be.Factory.addGetterSetter(Fe,"boundBoxFunc");Be.Factory.addGetterSetter(Fe,"anchorDragBoundFunc");Be.Factory.addGetterSetter(Fe,"anchorStyleFunc");Be.Factory.addGetterSetter(Fe,"shouldOverdrawWholeArea",!1);Be.Factory.addGetterSetter(Fe,"useSingleNodeRotation",!0);Be.Factory.backCompat(Fe,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});var md={};Object.defineProperty(md,"__esModule",{value:!0});md.Wedge=void 0;const yd=Ae,Kk=St,Qk=Pe,o4=_e,Zk=Pe;class Qr extends Kk.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,Qk.Konva.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}md.Wedge=Qr;Qr.prototype.className="Wedge";Qr.prototype._centroid=!0;Qr.prototype._attrsAffectingSize=["radius"];(0,Zk._registerNode)(Qr);yd.Factory.addGetterSetter(Qr,"radius",0,(0,o4.getNumberValidator)());yd.Factory.addGetterSetter(Qr,"angle",0,(0,o4.getNumberValidator)());yd.Factory.addGetterSetter(Qr,"clockwise",!1);yd.Factory.backCompat(Qr,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var vd={};Object.defineProperty(vd,"__esModule",{value:!0});vd.Blur=void 0;const x2=Ae,qk=tt,Jk=_e;function w2(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const eT=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],tT=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function nT(t,e){const n=t.data,r=t.width,i=t.height;let s,l,c,u,f,h,m,x,y,w,T,k,_,C,g,S,b,N,I,A,F,M,R,z;const V=e+e+1,j=r-1,D=i-1,G=e+1,H=G*(G+1)/2,O=new w2,$=eT[e],W=tT[e];let K=null,Q=O,q=null,oe=null;for(c=1;c<V;c++)Q=Q.next=new w2,c===G&&(K=Q);for(Q.next=O,m=h=0,l=0;l<i;l++){for(S=b=N=I=x=y=w=T=0,k=G*(A=n[h]),_=G*(F=n[h+1]),C=G*(M=n[h+2]),g=G*(R=n[h+3]),x+=H*A,y+=H*F,w+=H*M,T+=H*R,Q=O,c=0;c<G;c++)Q.r=A,Q.g=F,Q.b=M,Q.a=R,Q=Q.next;for(c=1;c<G;c++)u=h+((j<c?j:c)<<2),x+=(Q.r=A=n[u])*(z=G-c),y+=(Q.g=F=n[u+1])*z,w+=(Q.b=M=n[u+2])*z,T+=(Q.a=R=n[u+3])*z,S+=A,b+=F,N+=M,I+=R,Q=Q.next;for(q=O,oe=K,s=0;s<r;s++)n[h+3]=R=T*$>>W,R!==0?(R=255/R,n[h]=(x*$>>W)*R,n[h+1]=(y*$>>W)*R,n[h+2]=(w*$>>W)*R):n[h]=n[h+1]=n[h+2]=0,x-=k,y-=_,w-=C,T-=g,k-=q.r,_-=q.g,C-=q.b,g-=q.a,u=m+((u=s+e+1)<j?u:j)<<2,S+=q.r=n[u],b+=q.g=n[u+1],N+=q.b=n[u+2],I+=q.a=n[u+3],x+=S,y+=b,w+=N,T+=I,q=q.next,k+=A=oe.r,_+=F=oe.g,C+=M=oe.b,g+=R=oe.a,S-=A,b-=F,N-=M,I-=R,oe=oe.next,h+=4;m+=r}for(s=0;s<r;s++){for(b=N=I=S=y=w=T=x=0,h=s<<2,k=G*(A=n[h]),_=G*(F=n[h+1]),C=G*(M=n[h+2]),g=G*(R=n[h+3]),x+=H*A,y+=H*F,w+=H*M,T+=H*R,Q=O,c=0;c<G;c++)Q.r=A,Q.g=F,Q.b=M,Q.a=R,Q=Q.next;for(f=r,c=1;c<=e;c++)h=f+s<<2,x+=(Q.r=A=n[h])*(z=G-c),y+=(Q.g=F=n[h+1])*z,w+=(Q.b=M=n[h+2])*z,T+=(Q.a=R=n[h+3])*z,S+=A,b+=F,N+=M,I+=R,Q=Q.next,c<D&&(f+=r);for(h=s,q=O,oe=K,l=0;l<i;l++)u=h<<2,n[u+3]=R=T*$>>W,R>0?(R=255/R,n[u]=(x*$>>W)*R,n[u+1]=(y*$>>W)*R,n[u+2]=(w*$>>W)*R):n[u]=n[u+1]=n[u+2]=0,x-=k,y-=_,w-=C,T-=g,k-=q.r,_-=q.g,C-=q.b,g-=q.a,u=s+((u=l+G)<D?u:D)*r<<2,x+=S+=q.r=n[u],y+=b+=q.g=n[u+1],w+=N+=q.b=n[u+2],T+=I+=q.a=n[u+3],q=q.next,k+=A=oe.r,_+=F=oe.g,C+=M=oe.b,g+=R=oe.a,S-=A,b-=F,N-=M,I-=R,oe=oe.next,h+=r}}const rT=function(e){const n=Math.round(this.blurRadius());n>0&&nT(e,n)};vd.Blur=rT;x2.Factory.addGetterSetter(qk.Node,"blurRadius",0,(0,Jk.getNumberValidator)(),x2.Factory.afterSetFilter);var xd={};Object.defineProperty(xd,"__esModule",{value:!0});xd.Brighten=void 0;const _2=Ae,iT=tt,sT=_e,oT=function(t){const e=this.brightness()*255,n=t.data,r=n.length;for(let i=0;i<r;i+=4)n[i]+=e,n[i+1]+=e,n[i+2]+=e};xd.Brighten=oT;_2.Factory.addGetterSetter(iT.Node,"brightness",0,(0,sT.getNumberValidator)(),_2.Factory.afterSetFilter);var wd={};Object.defineProperty(wd,"__esModule",{value:!0});wd.Contrast=void 0;const S2=Ae,aT=tt,lT=_e,uT=function(t){const e=Math.pow((this.contrast()+100)/100,2),n=t.data,r=n.length;let i=150,s=150,l=150;for(let c=0;c<r;c+=4)i=n[c],s=n[c+1],l=n[c+2],i/=255,i-=.5,i*=e,i+=.5,i*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,l/=255,l-=.5,l*=e,l+=.5,l*=255,i=i<0?0:i>255?255:i,s=s<0?0:s>255?255:s,l=l<0?0:l>255?255:l,n[c]=i,n[c+1]=s,n[c+2]=l};wd.Contrast=uT;S2.Factory.addGetterSetter(aT.Node,"contrast",0,(0,lT.getNumberValidator)(),S2.Factory.afterSetFilter);var _d={};Object.defineProperty(_d,"__esModule",{value:!0});_d.Emboss=void 0;const Ni=Ae,Sd=tt,cT=at,a4=_e,dT=function(t){const e=this.embossStrength()*10,n=this.embossWhiteLevel()*255,r=this.embossDirection(),i=this.embossBlend(),s=t.data,l=t.width,c=t.height,u=l*4;let f=0,h=0,m=c;switch(r){case"top-left":f=-1,h=-1;break;case"top":f=-1,h=0;break;case"top-right":f=-1,h=1;break;case"right":f=0,h=1;break;case"bottom-right":f=1,h=1;break;case"bottom":f=1,h=0;break;case"bottom-left":f=1,h=-1;break;case"left":f=0,h=-1;break;default:cT.Util.error("Unknown emboss direction: "+r)}do{const x=(m-1)*u;let y=f;m+y<1&&(y=0),m+y>c&&(y=0);const w=(m-1+y)*l*4;let T=l;do{const k=x+(T-1)*4;let _=h;T+_<1&&(_=0),T+_>l&&(_=0);const C=w+(T-1+_)*4,g=s[k]-s[C],S=s[k+1]-s[C+1],b=s[k+2]-s[C+2];let N=g;const I=N>0?N:-N,A=S>0?S:-S,F=b>0?b:-b;if(A>I&&(N=S),F>I&&(N=b),N*=e,i){const M=s[k]+N,R=s[k+1]+N,z=s[k+2]+N;s[k]=M>255?255:M<0?0:M,s[k+1]=R>255?255:R<0?0:R,s[k+2]=z>255?255:z<0?0:z}else{let M=n-N;M<0?M=0:M>255&&(M=255),s[k]=s[k+1]=s[k+2]=M}}while(--T)}while(--m)};_d.Emboss=dT;Ni.Factory.addGetterSetter(Sd.Node,"embossStrength",.5,(0,a4.getNumberValidator)(),Ni.Factory.afterSetFilter);Ni.Factory.addGetterSetter(Sd.Node,"embossWhiteLevel",.5,(0,a4.getNumberValidator)(),Ni.Factory.afterSetFilter);Ni.Factory.addGetterSetter(Sd.Node,"embossDirection","top-left",void 0,Ni.Factory.afterSetFilter);Ni.Factory.addGetterSetter(Sd.Node,"embossBlend",!1,void 0,Ni.Factory.afterSetFilter);var kd={};Object.defineProperty(kd,"__esModule",{value:!0});kd.Enhance=void 0;const k2=Ae,fT=tt,hT=_e;function Kh(t,e,n,r,i){const s=n-e,l=i-r;if(s===0)return r+l/2;if(l===0)return r;let c=(t-e)/s;return c=l*c+r,c}const pT=function(t){const e=t.data,n=e.length;let r=e[0],i=r,s,l=e[1],c=l,u,f=e[2],h=f,m;const x=this.enhance();if(x===0)return;for(let N=0;N<n;N+=4)s=e[N+0],s<r?r=s:s>i&&(i=s),u=e[N+1],u<l?l=u:u>c&&(c=u),m=e[N+2],m<f?f=m:m>h&&(h=m);i===r&&(i=255,r=0),c===l&&(c=255,l=0),h===f&&(h=255,f=0);let y,w,T,k,_,C,g,S,b;x>0?(w=i+x*(255-i),T=r-x*(r-0),_=c+x*(255-c),C=l-x*(l-0),S=h+x*(255-h),b=f-x*(f-0)):(y=(i+r)*.5,w=i+x*(i-y),T=r+x*(r-y),k=(c+l)*.5,_=c+x*(c-k),C=l+x*(l-k),g=(h+f)*.5,S=h+x*(h-g),b=f+x*(f-g));for(let N=0;N<n;N+=4)e[N+0]=Kh(e[N+0],r,i,T,w),e[N+1]=Kh(e[N+1],l,c,C,_),e[N+2]=Kh(e[N+2],f,h,b,S)};kd.Enhance=pT;k2.Factory.addGetterSetter(fT.Node,"enhance",0,(0,hT.getNumberValidator)(),k2.Factory.afterSetFilter);var Td={};Object.defineProperty(Td,"__esModule",{value:!0});Td.Grayscale=void 0;const gT=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4){const i=.34*e[r]+.5*e[r+1]+.16*e[r+2];e[r]=i,e[r+1]=i,e[r+2]=i}};Td.Grayscale=gT;var Cd={};Object.defineProperty(Cd,"__esModule",{value:!0});Cd.HSL=void 0;const _o=Ae,vg=tt,xg=_e;_o.Factory.addGetterSetter(vg.Node,"hue",0,(0,xg.getNumberValidator)(),_o.Factory.afterSetFilter);_o.Factory.addGetterSetter(vg.Node,"saturation",0,(0,xg.getNumberValidator)(),_o.Factory.afterSetFilter);_o.Factory.addGetterSetter(vg.Node,"luminance",0,(0,xg.getNumberValidator)(),_o.Factory.afterSetFilter);const mT=function(t){const e=t.data,n=e.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,l=this.luminance()*127,c=r*i*Math.cos(s*Math.PI/180),u=r*i*Math.sin(s*Math.PI/180),f=.299*r+.701*c+.167*u,h=.587*r-.587*c+.33*u,m=.114*r-.114*c-.497*u,x=.299*r-.299*c-.328*u,y=.587*r+.413*c+.035*u,w=.114*r-.114*c+.293*u,T=.299*r-.3*c+1.25*u,k=.587*r-.586*c-1.05*u,_=.114*r+.886*c-.2*u;let C,g,S,b;for(let N=0;N<n;N+=4)C=e[N+0],g=e[N+1],S=e[N+2],b=e[N+3],e[N+0]=f*C+h*g+m*S+l,e[N+1]=x*C+y*g+w*S+l,e[N+2]=T*C+k*g+_*S+l,e[N+3]=b};Cd.HSL=mT;var bd={};Object.defineProperty(bd,"__esModule",{value:!0});bd.HSV=void 0;const So=Ae,wg=tt,_g=_e,yT=function(t){const e=t.data,n=e.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,l=r*i*Math.cos(s*Math.PI/180),c=r*i*Math.sin(s*Math.PI/180),u=.299*r+.701*l+.167*c,f=.587*r-.587*l+.33*c,h=.114*r-.114*l-.497*c,m=.299*r-.299*l-.328*c,x=.587*r+.413*l+.035*c,y=.114*r-.114*l+.293*c,w=.299*r-.3*l+1.25*c,T=.587*r-.586*l-1.05*c,k=.114*r+.886*l-.2*c;let _,C,g,S;for(let b=0;b<n;b+=4)_=e[b+0],C=e[b+1],g=e[b+2],S=e[b+3],e[b+0]=u*_+f*C+h*g,e[b+1]=m*_+x*C+y*g,e[b+2]=w*_+T*C+k*g,e[b+3]=S};bd.HSV=yT;So.Factory.addGetterSetter(wg.Node,"hue",0,(0,_g.getNumberValidator)(),So.Factory.afterSetFilter);So.Factory.addGetterSetter(wg.Node,"saturation",0,(0,_g.getNumberValidator)(),So.Factory.afterSetFilter);So.Factory.addGetterSetter(wg.Node,"value",0,(0,_g.getNumberValidator)(),So.Factory.afterSetFilter);var Ed={};Object.defineProperty(Ed,"__esModule",{value:!0});Ed.Invert=void 0;const vT=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]};Ed.Invert=vT;var Pd={};Object.defineProperty(Pd,"__esModule",{value:!0});Pd.Kaleidoscope=void 0;const Pc=Ae,l4=tt,T2=at,u4=_e,xT=function(t,e,n){const r=t.data,i=e.data,s=t.width,l=t.height,c=n.polarCenterX||s/2,u=n.polarCenterY||l/2;let f=Math.sqrt(c*c+u*u),h=s-c,m=l-u;const x=Math.sqrt(h*h+m*m);f=x>f?x:f;const y=l,w=s,T=360/w*Math.PI/180;for(let k=0;k<w;k+=1){const _=Math.sin(k*T),C=Math.cos(k*T);for(let g=0;g<y;g+=1){h=Math.floor(c+f*g/y*C),m=Math.floor(u+f*g/y*_);let S=(m*s+h)*4;const b=r[S+0],N=r[S+1],I=r[S+2],A=r[S+3];S=(k+g*s)*4,i[S+0]=b,i[S+1]=N,i[S+2]=I,i[S+3]=A}}},wT=function(t,e,n){const r=t.data,i=e.data,s=t.width,l=t.height,c=n.polarCenterX||s/2,u=n.polarCenterY||l/2;let f=Math.sqrt(c*c+u*u),h=s-c,m=l-u;const x=Math.sqrt(h*h+m*m);f=x>f?x:f;const y=l,w=s,T=n.polarRotation||0;let k,_;for(h=0;h<s;h+=1)for(m=0;m<l;m+=1){const C=h-c,g=m-u,S=Math.sqrt(C*C+g*g)*y/f;let b=(Math.atan2(g,C)*180/Math.PI+360+T)%360;b=b*w/360,k=Math.floor(b),_=Math.floor(S);let N=(_*s+k)*4;const I=r[N+0],A=r[N+1],F=r[N+2],M=r[N+3];N=(m*s+h)*4,i[N+0]=I,i[N+1]=A,i[N+2]=F,i[N+3]=M}},_T=function(t){const e=t.width,n=t.height;let r,i,s,l,c,u,f,h,m,x,y=Math.round(this.kaleidoscopePower());const w=Math.round(this.kaleidoscopeAngle()),T=Math.floor(e*(w%360)/360);if(y<1)return;const k=T2.Util.createCanvasElement();k.width=e,k.height=n;const _=k.getContext("2d").getImageData(0,0,e,n);T2.Util.releaseCanvas(k),xT(t,_,{polarCenterX:e/2,polarCenterY:n/2});let C=e/Math.pow(2,y);for(;C<=8;)C=C*2,y-=1;C=Math.ceil(C);let g=C,S=0,b=g,N=1;for(T+C>e&&(S=g,b=0,N=-1),i=0;i<n;i+=1)for(r=S;r!==b;r+=N)s=Math.round(r+T)%e,m=(e*i+s)*4,c=_.data[m+0],u=_.data[m+1],f=_.data[m+2],h=_.data[m+3],x=(e*i+r)*4,_.data[x+0]=c,_.data[x+1]=u,_.data[x+2]=f,_.data[x+3]=h;for(i=0;i<n;i+=1)for(g=Math.floor(C),l=0;l<y;l+=1){for(r=0;r<g+1;r+=1)m=(e*i+r)*4,c=_.data[m+0],u=_.data[m+1],f=_.data[m+2],h=_.data[m+3],x=(e*i+g*2-r-1)*4,_.data[x+0]=c,_.data[x+1]=u,_.data[x+2]=f,_.data[x+3]=h;g*=2}wT(_,t,{polarRotation:0})};Pd.Kaleidoscope=_T;Pc.Factory.addGetterSetter(l4.Node,"kaleidoscopePower",2,(0,u4.getNumberValidator)(),Pc.Factory.afterSetFilter);Pc.Factory.addGetterSetter(l4.Node,"kaleidoscopeAngle",0,(0,u4.getNumberValidator)(),Pc.Factory.afterSetFilter);var Nd={};Object.defineProperty(Nd,"__esModule",{value:!0});Nd.Mask=void 0;const C2=Ae,ST=tt,kT=_e;function Iu(t,e,n){let r=(n*t.width+e)*4;const i=[];return i.push(t.data[r++],t.data[r++],t.data[r++],t.data[r++]),i}function ma(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function TT(t){const e=[0,0,0];for(let n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function CT(t,e){const n=Iu(t,0,0),r=Iu(t,t.width-1,0),i=Iu(t,0,t.height-1),s=Iu(t,t.width-1,t.height-1),l=e||10;if(ma(n,r)<l&&ma(r,s)<l&&ma(s,i)<l&&ma(i,n)<l){const c=TT([r,n,s,i]),u=[];for(let f=0;f<t.width*t.height;f++){const h=ma(c,[t.data[f*4],t.data[f*4+1],t.data[f*4+2]]);u[f]=h<l?0:255}return u}}function bT(t,e){for(let n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}function ET(t,e,n){const r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let h=0;for(let m=0;m<i;m++)for(let x=0;x<i;x++){const y=c+m-s,w=u+x-s;if(y>=0&&y<n&&w>=0&&w<e){const T=y*e+w,k=r[m*i+x];h+=t[T]*k}}l[f]=h===255*8?255:0}return l}function PT(t,e,n){const r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let h=0;for(let m=0;m<i;m++)for(let x=0;x<i;x++){const y=c+m-s,w=u+x-s;if(y>=0&&y<n&&w>=0&&w<e){const T=y*e+w,k=r[m*i+x];h+=t[T]*k}}l[f]=h>=255*4?255:0}return l}function NT(t,e,n){const r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let h=0;for(let m=0;m<i;m++)for(let x=0;x<i;x++){const y=c+m-s,w=u+x-s;if(y>=0&&y<n&&w>=0&&w<e){const T=y*e+w,k=r[m*i+x];h+=t[T]*k}}l[f]=h}return l}const AT=function(t){const e=this.threshold();let n=CT(t,e);return n&&(n=ET(n,t.width,t.height),n=PT(n,t.width,t.height),n=NT(n,t.width,t.height),bT(t,n)),t};Nd.Mask=AT;C2.Factory.addGetterSetter(ST.Node,"threshold",0,(0,kT.getNumberValidator)(),C2.Factory.afterSetFilter);var Ad={};Object.defineProperty(Ad,"__esModule",{value:!0});Ad.Noise=void 0;const b2=Ae,MT=tt,RT=_e,IT=function(t){const e=this.noise()*255,n=t.data,r=n.length,i=e/2;for(let s=0;s<r;s+=4)n[s+0]+=i-2*i*Math.random(),n[s+1]+=i-2*i*Math.random(),n[s+2]+=i-2*i*Math.random()};Ad.Noise=IT;b2.Factory.addGetterSetter(MT.Node,"noise",.2,(0,RT.getNumberValidator)(),b2.Factory.afterSetFilter);var Md={};Object.defineProperty(Md,"__esModule",{value:!0});Md.Pixelate=void 0;const E2=Ae,LT=at,FT=tt,jT=_e,OT=function(t){let e=Math.ceil(this.pixelSize()),n=t.width,r=t.height,i,s,l,c,u,f,h,m=Math.ceil(n/e),x=Math.ceil(r/e),y,w,T,k,_,C,g,S=t.data;if(e<=0){LT.Util.error("pixelSize value can not be <= 0");return}for(_=0;_<m;_+=1)for(C=0;C<x;C+=1){for(c=0,u=0,f=0,h=0,y=_*e,w=y+e,T=C*e,k=T+e,g=0,i=y;i<w;i+=1)if(!(i>=n))for(s=T;s<k;s+=1)s>=r||(l=(n*s+i)*4,c+=S[l+0],u+=S[l+1],f+=S[l+2],h+=S[l+3],g+=1);for(c=c/g,u=u/g,f=f/g,h=h/g,i=y;i<w;i+=1)if(!(i>=n))for(s=T;s<k;s+=1)s>=r||(l=(n*s+i)*4,S[l+0]=c,S[l+1]=u,S[l+2]=f,S[l+3]=h)}};Md.Pixelate=OT;E2.Factory.addGetterSetter(FT.Node,"pixelSize",8,(0,jT.getNumberValidator)(),E2.Factory.afterSetFilter);var Rd={};Object.defineProperty(Rd,"__esModule",{value:!0});Rd.Posterize=void 0;const P2=Ae,DT=tt,zT=_e,BT=function(t){const e=Math.round(this.levels()*254)+1,n=t.data,r=n.length,i=255/e;for(let s=0;s<r;s+=1)n[s]=Math.floor(n[s]/i)*i};Rd.Posterize=BT;P2.Factory.addGetterSetter(DT.Node,"levels",.5,(0,zT.getNumberValidator)(),P2.Factory.afterSetFilter);var Id={};Object.defineProperty(Id,"__esModule",{value:!0});Id.RGB=void 0;const Nc=Ae,Sg=tt,UT=_e,GT=function(t){const e=t.data,n=e.length,r=this.red(),i=this.green(),s=this.blue();for(let l=0;l<n;l+=4){const c=(.34*e[l]+.5*e[l+1]+.16*e[l+2])/255;e[l]=c*r,e[l+1]=c*i,e[l+2]=c*s,e[l+3]=e[l+3]}};Id.RGB=GT;Nc.Factory.addGetterSetter(Sg.Node,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});Nc.Factory.addGetterSetter(Sg.Node,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});Nc.Factory.addGetterSetter(Sg.Node,"blue",0,UT.RGBComponent,Nc.Factory.afterSetFilter);var Ld={};Object.defineProperty(Ld,"__esModule",{value:!0});Ld.RGBA=void 0;const tl=Ae,Fd=tt,VT=_e,WT=function(t){const e=t.data,n=e.length,r=this.red(),i=this.green(),s=this.blue(),l=this.alpha();for(let c=0;c<n;c+=4){const u=1-l;e[c]=r*l+e[c]*u,e[c+1]=i*l+e[c+1]*u,e[c+2]=s*l+e[c+2]*u}};Ld.RGBA=WT;tl.Factory.addGetterSetter(Fd.Node,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});tl.Factory.addGetterSetter(Fd.Node,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});tl.Factory.addGetterSetter(Fd.Node,"blue",0,VT.RGBComponent,tl.Factory.afterSetFilter);tl.Factory.addGetterSetter(Fd.Node,"alpha",1,function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t});var jd={};Object.defineProperty(jd,"__esModule",{value:!0});jd.Sepia=void 0;const $T=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4){const i=e[r+0],s=e[r+1],l=e[r+2];e[r+0]=Math.min(255,i*.393+s*.769+l*.189),e[r+1]=Math.min(255,i*.349+s*.686+l*.168),e[r+2]=Math.min(255,i*.272+s*.534+l*.131)}};jd.Sepia=$T;var Od={};Object.defineProperty(Od,"__esModule",{value:!0});Od.Solarize=void 0;const HT=function(t){const e=t.data,n=t.width,r=t.height,i=n*4;let s=r;do{const l=(s-1)*i;let c=n;do{const u=l+(c-1)*4;let f=e[u],h=e[u+1],m=e[u+2];f>127&&(f=255-f),h>127&&(h=255-h),m>127&&(m=255-m),e[u]=f,e[u+1]=h,e[u+2]=m}while(--c)}while(--s)};Od.Solarize=HT;var Dd={};Object.defineProperty(Dd,"__esModule",{value:!0});Dd.Threshold=void 0;const N2=Ae,XT=tt,YT=_e,KT=function(t){const e=this.threshold()*255,n=t.data,r=n.length;for(let i=0;i<r;i+=1)n[i]=n[i]<e?0:255};Dd.Threshold=KT;N2.Factory.addGetterSetter(XT.Node,"threshold",.5,(0,YT.getNumberValidator)(),N2.Factory.afterSetFilter);Object.defineProperty(Yc,"__esModule",{value:!0});Yc.Konva=void 0;const A2=Cc,QT=Jc,ZT=nd,qT=sd,JT=od,eC=ad,M2=wo,tC=pl,nC=Io,rC=ml,iC=cd,sC=dd,oC=fd,aC=hd,lC=Fo,uC=pd,cC=gd,dC=md,fC=vd,hC=xd,pC=wd,gC=_d,mC=kd,yC=Td,vC=Cd,xC=bd,wC=Ed,_C=Pd,SC=Nd,kC=Ad,TC=Md,CC=Rd,bC=Id,EC=Ld,PC=jd,NC=Od,AC=Dd;Yc.Konva=A2.Konva.Util._assign(A2.Konva,{Arc:QT.Arc,Arrow:ZT.Arrow,Circle:qT.Circle,Ellipse:JT.Ellipse,Image:eC.Image,Label:M2.Label,Tag:M2.Tag,Line:tC.Line,Path:nC.Path,Rect:rC.Rect,RegularPolygon:iC.RegularPolygon,Ring:sC.Ring,Sprite:oC.Sprite,Star:aC.Star,Text:lC.Text,TextPath:uC.TextPath,Transformer:cC.Transformer,Wedge:dC.Wedge,Filters:{Blur:fC.Blur,Brighten:hC.Brighten,Contrast:pC.Contrast,Emboss:gC.Emboss,Enhance:mC.Enhance,Grayscale:yC.Grayscale,HSL:vC.HSL,HSV:xC.HSV,Invert:wC.Invert,Kaleidoscope:_C.Kaleidoscope,Mask:SC.Mask,Noise:kC.Noise,Pixelate:TC.Pixelate,Posterize:CC.Posterize,RGB:bC.RGB,RGBA:EC.RGBA,Sepia:PC.Sepia,Solarize:NC.Solarize,Threshold:AC.Threshold}});var MC=A5.exports;Object.defineProperty(MC,"__esModule",{value:!0});const RC=Yc;A5.exports=RC.Konva;var lp={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var n=Cc;Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return n.Konva}});const r=Cc;t.exports=r.Konva})(lp,lp.exports);var IC=lp.exports;const nl=il(IC);var c4={exports:{}};/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LC=function(e){var n={},r=B,i=Sa,s=Object.assign;function l(o){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),f=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),w=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),S=Symbol.for("react.offscreen"),b=Symbol.iterator;function N(o){return o===null||typeof o!="object"?null:(o=b&&o[b]||o["@@iterator"],typeof o=="function"?o:null)}function I(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case h:return"Fragment";case f:return"Portal";case x:return"Profiler";case m:return"StrictMode";case k:return"Suspense";case _:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case w:return(o.displayName||"Context")+".Consumer";case y:return(o._context.displayName||"Context")+".Provider";case T:var a=o.render;return o=o.displayName,o||(o=a.displayName||a.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case C:return a=o.displayName||null,a!==null?a:I(o.type)||"Memo";case g:a=o._payload,o=o._init;try{return I(o(a))}catch{}}return null}function A(o){var a=o.type;switch(o.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=a.render,o=o.displayName||o.name||"",a.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return I(a);case 8:return a===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function F(o){var a=o,d=o;if(o.alternate)for(;a.return;)a=a.return;else{o=a;do a=o,a.flags&4098&&(d=a.return),o=a.return;while(o)}return a.tag===3?d:null}function M(o){if(F(o)!==o)throw Error(l(188))}function R(o){var a=o.alternate;if(!a){if(a=F(o),a===null)throw Error(l(188));return a!==o?null:o}for(var d=o,p=a;;){var v=d.return;if(v===null)break;var E=v.alternate;if(E===null){if(p=v.return,p!==null){d=p;continue}break}if(v.child===E.child){for(E=v.child;E;){if(E===d)return M(v),o;if(E===p)return M(v),a;E=E.sibling}throw Error(l(188))}if(d.return!==p.return)d=v,p=E;else{for(var L=!1,X=v.child;X;){if(X===d){L=!0,d=v,p=E;break}if(X===p){L=!0,p=v,d=E;break}X=X.sibling}if(!L){for(X=E.child;X;){if(X===d){L=!0,d=E,p=v;break}if(X===p){L=!0,p=E,d=v;break}X=X.sibling}if(!L)throw Error(l(189))}}if(d.alternate!==p)throw Error(l(190))}if(d.tag!==3)throw Error(l(188));return d.stateNode.current===d?o:a}function z(o){return o=R(o),o!==null?V(o):null}function V(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var a=V(o);if(a!==null)return a;o=o.sibling}return null}function j(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){if(o.tag!==4){var a=j(o);if(a!==null)return a}o=o.sibling}return null}var D=Array.isArray,G=e.getPublicInstance,H=e.getRootHostContext,O=e.getChildHostContext,$=e.prepareForCommit,W=e.resetAfterCommit,K=e.createInstance,Q=e.appendInitialChild,q=e.finalizeInitialChildren,oe=e.prepareUpdate,we=e.shouldSetTextContent,ye=e.createTextInstance,U=e.scheduleTimeout,te=e.cancelTimeout,ae=e.noTimeout,xe=e.isPrimaryRenderer,ve=e.supportsMutation,Le=e.supportsPersistence,ie=e.supportsHydration,se=e.getInstanceFromNode,de=e.preparePortalMount,ke=e.getCurrentEventPriority,Me=e.detachDeletedInstance,ue=e.supportsMicrotasks,dt=e.scheduleMicrotask,Tt=e.supportsTestSelectors,Qt=e.findFiberRoot,_s=e.getBoundingRect,Ss=e.getTextContent,lr=e.isHiddenSubtree,ks=e.matchAccessibilityRole,Mt=e.setFocusIfFocusable,Zr=e.setupIntersectionObserver,Ts=e.appendChild,yl=e.appendChildToContainer,Te=e.commitTextUpdate,Xe=e.commitMount,rn=e.commitUpdate,qr=e.insertBefore,k4=e.insertInContainerBefore,T4=e.removeChild,C4=e.removeChildFromContainer,Pg=e.resetTextContent,b4=e.hideInstance,E4=e.hideTextInstance,P4=e.unhideInstance,N4=e.unhideTextInstance,A4=e.clearContainer,M4=e.cloneInstance,Ng=e.createContainerChildSet,Ag=e.appendChildToContainerChildSet,R4=e.finalizeContainerChildren,Ud=e.replaceContainerChildren,Mg=e.cloneHiddenInstance,Rg=e.cloneHiddenTextInstance,I4=e.canHydrateInstance,L4=e.canHydrateTextInstance,F4=e.canHydrateSuspenseInstance,Ig=e.isSuspenseInstancePending,Gd=e.isSuspenseInstanceFallback,j4=e.getSuspenseInstanceFallbackErrorDetails,O4=e.registerSuspenseInstanceRetry,vl=e.getNextHydratableSibling,D4=e.getFirstHydratableChild,z4=e.getFirstHydratableChildWithinContainer,B4=e.getFirstHydratableChildWithinSuspenseInstance,U4=e.hydrateInstance,G4=e.hydrateTextInstance,V4=e.hydrateSuspenseInstance,W4=e.getNextHydratableInstanceAfterSuspenseInstance,$4=e.commitHydratedContainer,H4=e.commitHydratedSuspenseInstance,X4=e.clearSuspenseBoundary,Y4=e.clearSuspenseBoundaryFromContainer,K4=e.shouldDeleteUnhydratedTailInstances,Q4=e.didNotMatchHydratedContainerTextInstance,Z4=e.didNotMatchHydratedTextInstance,Vd;function jo(o){if(Vd===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);Vd=a&&a[1]||""}return`
`+Vd+o}var Wd=!1;function $d(o,a){if(!o||Wd)return"";Wd=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(re){var p=re}Reflect.construct(o,[],a)}else{try{a.call()}catch(re){p=re}o.call(a.prototype)}else{try{throw Error()}catch(re){p=re}o()}}catch(re){if(re&&p&&typeof re.stack=="string"){for(var v=re.stack.split(`
`),E=p.stack.split(`
`),L=v.length-1,X=E.length-1;1<=L&&0<=X&&v[L]!==E[X];)X--;for(;1<=L&&0<=X;L--,X--)if(v[L]!==E[X]){if(L!==1||X!==1)do if(L--,X--,0>X||v[L]!==E[X]){var J=`
`+v[L].replace(" at new "," at ");return o.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",o.displayName)),J}while(1<=L&&0<=X);break}}}finally{Wd=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?jo(o):""}var q4=Object.prototype.hasOwnProperty,Hd=[],Cs=-1;function Jr(o){return{current:o}}function Ye(o){0>Cs||(o.current=Hd[Cs],Hd[Cs]=null,Cs--)}function $e(o,a){Cs++,Hd[Cs]=o.current,o.current=a}var ei={},zt=Jr(ei),sn=Jr(!1),Bi=ei;function bs(o,a){var d=o.type.contextTypes;if(!d)return ei;var p=o.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===a)return p.__reactInternalMemoizedMaskedChildContext;var v={},E;for(E in d)v[E]=a[E];return p&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=a,o.__reactInternalMemoizedMaskedChildContext=v),v}function on(o){return o=o.childContextTypes,o!=null}function xl(){Ye(sn),Ye(zt)}function Lg(o,a,d){if(zt.current!==ei)throw Error(l(168));$e(zt,a),$e(sn,d)}function Fg(o,a,d){var p=o.stateNode;if(a=a.childContextTypes,typeof p.getChildContext!="function")return d;p=p.getChildContext();for(var v in p)if(!(v in a))throw Error(l(108,A(o)||"Unknown",v));return s({},d,p)}function wl(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||ei,Bi=zt.current,$e(zt,o),$e(sn,sn.current),!0}function jg(o,a,d){var p=o.stateNode;if(!p)throw Error(l(169));d?(o=Fg(o,a,Bi),p.__reactInternalMemoizedMergedChildContext=o,Ye(sn),Ye(zt),$e(zt,o)):Ye(sn),$e(sn,d)}var Wn=Math.clz32?Math.clz32:t6,J4=Math.log,e6=Math.LN2;function t6(o){return o>>>=0,o===0?32:31-(J4(o)/e6|0)|0}var _l=64,Sl=4194304;function Oo(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function kl(o,a){var d=o.pendingLanes;if(d===0)return 0;var p=0,v=o.suspendedLanes,E=o.pingedLanes,L=d&268435455;if(L!==0){var X=L&~v;X!==0?p=Oo(X):(E&=L,E!==0&&(p=Oo(E)))}else L=d&~v,L!==0?p=Oo(L):E!==0&&(p=Oo(E));if(p===0)return 0;if(a!==0&&a!==p&&!(a&v)&&(v=p&-p,E=a&-a,v>=E||v===16&&(E&4194240)!==0))return a;if(p&4&&(p|=d&16),a=o.entangledLanes,a!==0)for(o=o.entanglements,a&=p;0<a;)d=31-Wn(a),v=1<<d,p|=o[d],a&=~v;return p}function n6(o,a){switch(o){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function r6(o,a){for(var d=o.suspendedLanes,p=o.pingedLanes,v=o.expirationTimes,E=o.pendingLanes;0<E;){var L=31-Wn(E),X=1<<L,J=v[L];J===-1?(!(X&d)||X&p)&&(v[L]=n6(X,a)):J<=a&&(o.expiredLanes|=X),E&=~X}}function Xd(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Og(){var o=_l;return _l<<=1,!(_l&4194240)&&(_l=64),o}function Yd(o){for(var a=[],d=0;31>d;d++)a.push(o);return a}function Do(o,a,d){o.pendingLanes|=a,a!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,a=31-Wn(a),o[a]=d}function i6(o,a){var d=o.pendingLanes&~a;o.pendingLanes=a,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=a,o.mutableReadLanes&=a,o.entangledLanes&=a,a=o.entanglements;var p=o.eventTimes;for(o=o.expirationTimes;0<d;){var v=31-Wn(d),E=1<<v;a[v]=0,p[v]=-1,o[v]=-1,d&=~E}}function Kd(o,a){var d=o.entangledLanes|=a;for(o=o.entanglements;d;){var p=31-Wn(d),v=1<<p;v&a|o[p]&a&&(o[p]|=a),d&=~v}}var Oe=0;function Dg(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var Qd=i.unstable_scheduleCallback,zg=i.unstable_cancelCallback,s6=i.unstable_shouldYield,o6=i.unstable_requestPaint,Ct=i.unstable_now,Zd=i.unstable_ImmediatePriority,a6=i.unstable_UserBlockingPriority,qd=i.unstable_NormalPriority,l6=i.unstable_IdlePriority,Tl=null,ur=null;function u6(o){if(ur&&typeof ur.onCommitFiberRoot=="function")try{ur.onCommitFiberRoot(Tl,o,void 0,(o.current.flags&128)===128)}catch{}}function c6(o,a){return o===a&&(o!==0||1/o===1/a)||o!==o&&a!==a}var $n=typeof Object.is=="function"?Object.is:c6,br=null,Cl=!1,Jd=!1;function Bg(o){br===null?br=[o]:br.push(o)}function d6(o){Cl=!0,Bg(o)}function cr(){if(!Jd&&br!==null){Jd=!0;var o=0,a=Oe;try{var d=br;for(Oe=1;o<d.length;o++){var p=d[o];do p=p(!0);while(p!==null)}br=null,Cl=!1}catch(v){throw br!==null&&(br=br.slice(o+1)),Qd(Zd,cr),v}finally{Oe=a,Jd=!1}}return null}var Es=[],Ps=0,bl=null,El=0,bn=[],En=0,Ui=null,Er=1,Pr="";function Gi(o,a){Es[Ps++]=El,Es[Ps++]=bl,bl=o,El=a}function Ug(o,a,d){bn[En++]=Er,bn[En++]=Pr,bn[En++]=Ui,Ui=o;var p=Er;o=Pr;var v=32-Wn(p)-1;p&=~(1<<v),d+=1;var E=32-Wn(a)+v;if(30<E){var L=v-v%5;E=(p&(1<<L)-1).toString(32),p>>=L,v-=L,Er=1<<32-Wn(a)+v|d<<v|p,Pr=E+o}else Er=1<<E|d<<v|p,Pr=o}function ef(o){o.return!==null&&(Gi(o,1),Ug(o,1,0))}function tf(o){for(;o===bl;)bl=Es[--Ps],Es[Ps]=null,El=Es[--Ps],Es[Ps]=null;for(;o===Ui;)Ui=bn[--En],bn[En]=null,Pr=bn[--En],bn[En]=null,Er=bn[--En],bn[En]=null}var vn=null,Pn=null,qe=!1,zo=!1,Hn=null;function Gg(o,a){var d=In(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=o,a=o.deletions,a===null?(o.deletions=[d],o.flags|=16):a.push(d)}function Vg(o,a){switch(o.tag){case 5:return a=I4(a,o.type,o.pendingProps),a!==null?(o.stateNode=a,vn=o,Pn=D4(a),!0):!1;case 6:return a=L4(a,o.pendingProps),a!==null?(o.stateNode=a,vn=o,Pn=null,!0):!1;case 13:if(a=F4(a),a!==null){var d=Ui!==null?{id:Er,overflow:Pr}:null;return o.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=In(18,null,null,0),d.stateNode=a,d.return=o,o.child=d,vn=o,Pn=null,!0}return!1;default:return!1}}function nf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function rf(o){if(qe){var a=Pn;if(a){var d=a;if(!Vg(o,a)){if(nf(o))throw Error(l(418));a=vl(d);var p=vn;a&&Vg(o,a)?Gg(p,d):(o.flags=o.flags&-4097|2,qe=!1,vn=o)}}else{if(nf(o))throw Error(l(418));o.flags=o.flags&-4097|2,qe=!1,vn=o}}}function Wg(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;vn=o}function Pl(o){if(!ie||o!==vn)return!1;if(!qe)return Wg(o),qe=!0,!1;if(o.tag!==3&&(o.tag!==5||K4(o.type)&&!we(o.type,o.memoizedProps))){var a=Pn;if(a){if(nf(o))throw $g(),Error(l(418));for(;a;)Gg(o,a),a=vl(a)}}if(Wg(o),o.tag===13){if(!ie)throw Error(l(316));if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(l(317));Pn=W4(o)}else Pn=vn?vl(o.stateNode):null;return!0}function $g(){for(var o=Pn;o;)o=vl(o)}function Ns(){ie&&(Pn=vn=null,zo=qe=!1)}function sf(o){Hn===null?Hn=[o]:Hn.push(o)}var f6=c.ReactCurrentBatchConfig;function Nl(o,a){if($n(o,a))return!0;if(typeof o!="object"||o===null||typeof a!="object"||a===null)return!1;var d=Object.keys(o),p=Object.keys(a);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var v=d[p];if(!q4.call(a,v)||!$n(o[v],a[v]))return!1}return!0}function h6(o){switch(o.tag){case 5:return jo(o.type);case 16:return jo("Lazy");case 13:return jo("Suspense");case 19:return jo("SuspenseList");case 0:case 2:case 15:return o=$d(o.type,!1),o;case 11:return o=$d(o.type.render,!1),o;case 1:return o=$d(o.type,!0),o;default:return""}}function Bo(o,a,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(l(309));var p=d.stateNode}if(!p)throw Error(l(147,o));var v=p,E=""+o;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===E?a.ref:(a=function(L){var X=v.refs;L===null?delete X[E]:X[E]=L},a._stringRef=E,a)}if(typeof o!="string")throw Error(l(284));if(!d._owner)throw Error(l(290,o))}return o}function Al(o,a){throw o=Object.prototype.toString.call(a),Error(l(31,o==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":o))}function Hg(o){var a=o._init;return a(o._payload)}function Xg(o){function a(Z,Y){if(o){var ee=Z.deletions;ee===null?(Z.deletions=[Y],Z.flags|=16):ee.push(Y)}}function d(Z,Y){if(!o)return null;for(;Y!==null;)a(Z,Y),Y=Y.sibling;return null}function p(Z,Y){for(Z=new Map;Y!==null;)Y.key!==null?Z.set(Y.key,Y):Z.set(Y.index,Y),Y=Y.sibling;return Z}function v(Z,Y){return Z=ai(Z,Y),Z.index=0,Z.sibling=null,Z}function E(Z,Y,ee){return Z.index=ee,o?(ee=Z.alternate,ee!==null?(ee=ee.index,ee<Y?(Z.flags|=2,Y):ee):(Z.flags|=2,Y)):(Z.flags|=1048576,Y)}function L(Z){return o&&Z.alternate===null&&(Z.flags|=2),Z}function X(Z,Y,ee,ce){return Y===null||Y.tag!==6?(Y=eh(ee,Z.mode,ce),Y.return=Z,Y):(Y=v(Y,ee),Y.return=Z,Y)}function J(Z,Y,ee,ce){var me=ee.type;return me===h?ge(Z,Y,ee.props.children,ce,ee.key):Y!==null&&(Y.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===g&&Hg(me)===Y.type)?(ce=v(Y,ee.props),ce.ref=Bo(Z,Y,ee),ce.return=Z,ce):(ce=au(ee.type,ee.key,ee.props,null,Z.mode,ce),ce.ref=Bo(Z,Y,ee),ce.return=Z,ce)}function re(Z,Y,ee,ce){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==ee.containerInfo||Y.stateNode.implementation!==ee.implementation?(Y=th(ee,Z.mode,ce),Y.return=Z,Y):(Y=v(Y,ee.children||[]),Y.return=Z,Y)}function ge(Z,Y,ee,ce,me){return Y===null||Y.tag!==7?(Y=Ki(ee,Z.mode,ce,me),Y.return=Z,Y):(Y=v(Y,ee),Y.return=Z,Y)}function Ce(Z,Y,ee){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=eh(""+Y,Z.mode,ee),Y.return=Z,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case u:return ee=au(Y.type,Y.key,Y.props,null,Z.mode,ee),ee.ref=Bo(Z,null,Y),ee.return=Z,ee;case f:return Y=th(Y,Z.mode,ee),Y.return=Z,Y;case g:var ce=Y._init;return Ce(Z,ce(Y._payload),ee)}if(D(Y)||N(Y))return Y=Ki(Y,Z.mode,ee,null),Y.return=Z,Y;Al(Z,Y)}return null}function le(Z,Y,ee,ce){var me=Y!==null?Y.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return me!==null?null:X(Z,Y,""+ee,ce);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case u:return ee.key===me?J(Z,Y,ee,ce):null;case f:return ee.key===me?re(Z,Y,ee,ce):null;case g:return me=ee._init,le(Z,Y,me(ee._payload),ce)}if(D(ee)||N(ee))return me!==null?null:ge(Z,Y,ee,ce,null);Al(Z,ee)}return null}function Ke(Z,Y,ee,ce,me){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return Z=Z.get(ee)||null,X(Y,Z,""+ce,me);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case u:return Z=Z.get(ce.key===null?ee:ce.key)||null,J(Y,Z,ce,me);case f:return Z=Z.get(ce.key===null?ee:ce.key)||null,re(Y,Z,ce,me);case g:var Ee=ce._init;return Ke(Z,Y,ee,Ee(ce._payload),me)}if(D(ce)||N(ce))return Z=Z.get(ee)||null,ge(Y,Z,ce,me,null);Al(Y,ce)}return null}function Ve(Z,Y,ee,ce){for(var me=null,Ee=null,be=Y,De=Y=0,Pt=null;be!==null&&De<ee.length;De++){be.index>De?(Pt=be,be=null):Pt=be.sibling;var ze=le(Z,be,ee[De],ce);if(ze===null){be===null&&(be=Pt);break}o&&be&&ze.alternate===null&&a(Z,be),Y=E(ze,Y,De),Ee===null?me=ze:Ee.sibling=ze,Ee=ze,be=Pt}if(De===ee.length)return d(Z,be),qe&&Gi(Z,De),me;if(be===null){for(;De<ee.length;De++)be=Ce(Z,ee[De],ce),be!==null&&(Y=E(be,Y,De),Ee===null?me=be:Ee.sibling=be,Ee=be);return qe&&Gi(Z,De),me}for(be=p(Z,be);De<ee.length;De++)Pt=Ke(be,Z,De,ee[De],ce),Pt!==null&&(o&&Pt.alternate!==null&&be.delete(Pt.key===null?De:Pt.key),Y=E(Pt,Y,De),Ee===null?me=Pt:Ee.sibling=Pt,Ee=Pt);return o&&be.forEach(function(li){return a(Z,li)}),qe&&Gi(Z,De),me}function cn(Z,Y,ee,ce){var me=N(ee);if(typeof me!="function")throw Error(l(150));if(ee=me.call(ee),ee==null)throw Error(l(151));for(var Ee=me=null,be=Y,De=Y=0,Pt=null,ze=ee.next();be!==null&&!ze.done;De++,ze=ee.next()){be.index>De?(Pt=be,be=null):Pt=be.sibling;var li=le(Z,be,ze.value,ce);if(li===null){be===null&&(be=Pt);break}o&&be&&li.alternate===null&&a(Z,be),Y=E(li,Y,De),Ee===null?me=li:Ee.sibling=li,Ee=li,be=Pt}if(ze.done)return d(Z,be),qe&&Gi(Z,De),me;if(be===null){for(;!ze.done;De++,ze=ee.next())ze=Ce(Z,ze.value,ce),ze!==null&&(Y=E(ze,Y,De),Ee===null?me=ze:Ee.sibling=ze,Ee=ze);return qe&&Gi(Z,De),me}for(be=p(Z,be);!ze.done;De++,ze=ee.next())ze=Ke(be,Z,De,ze.value,ce),ze!==null&&(o&&ze.alternate!==null&&be.delete(ze.key===null?De:ze.key),Y=E(ze,Y,De),Ee===null?me=ze:Ee.sibling=ze,Ee=ze);return o&&be.forEach(function(V6){return a(Z,V6)}),qe&&Gi(Z,De),me}function Rr(Z,Y,ee,ce){if(typeof ee=="object"&&ee!==null&&ee.type===h&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case u:e:{for(var me=ee.key,Ee=Y;Ee!==null;){if(Ee.key===me){if(me=ee.type,me===h){if(Ee.tag===7){d(Z,Ee.sibling),Y=v(Ee,ee.props.children),Y.return=Z,Z=Y;break e}}else if(Ee.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===g&&Hg(me)===Ee.type){d(Z,Ee.sibling),Y=v(Ee,ee.props),Y.ref=Bo(Z,Ee,ee),Y.return=Z,Z=Y;break e}d(Z,Ee);break}else a(Z,Ee);Ee=Ee.sibling}ee.type===h?(Y=Ki(ee.props.children,Z.mode,ce,ee.key),Y.return=Z,Z=Y):(ce=au(ee.type,ee.key,ee.props,null,Z.mode,ce),ce.ref=Bo(Z,Y,ee),ce.return=Z,Z=ce)}return L(Z);case f:e:{for(Ee=ee.key;Y!==null;){if(Y.key===Ee)if(Y.tag===4&&Y.stateNode.containerInfo===ee.containerInfo&&Y.stateNode.implementation===ee.implementation){d(Z,Y.sibling),Y=v(Y,ee.children||[]),Y.return=Z,Z=Y;break e}else{d(Z,Y);break}else a(Z,Y);Y=Y.sibling}Y=th(ee,Z.mode,ce),Y.return=Z,Z=Y}return L(Z);case g:return Ee=ee._init,Rr(Z,Y,Ee(ee._payload),ce)}if(D(ee))return Ve(Z,Y,ee,ce);if(N(ee))return cn(Z,Y,ee,ce);Al(Z,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,Y!==null&&Y.tag===6?(d(Z,Y.sibling),Y=v(Y,ee),Y.return=Z,Z=Y):(d(Z,Y),Y=eh(ee,Z.mode,ce),Y.return=Z,Z=Y),L(Z)):d(Z,Y)}return Rr}var As=Xg(!0),Yg=Xg(!1),Ml=Jr(null),Rl=null,Ms=null,of=null;function af(){of=Ms=Rl=null}function Kg(o,a,d){xe?($e(Ml,a._currentValue),a._currentValue=d):($e(Ml,a._currentValue2),a._currentValue2=d)}function lf(o){var a=Ml.current;Ye(Ml),xe?o._currentValue=a:o._currentValue2=a}function uf(o,a,d){for(;o!==null;){var p=o.alternate;if((o.childLanes&a)!==a?(o.childLanes|=a,p!==null&&(p.childLanes|=a)):p!==null&&(p.childLanes&a)!==a&&(p.childLanes|=a),o===d)break;o=o.return}}function Rs(o,a){Rl=o,of=Ms=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&a&&(an=!0),o.firstContext=null)}function Nn(o){var a=xe?o._currentValue:o._currentValue2;if(of!==o)if(o={context:o,memoizedValue:a,next:null},Ms===null){if(Rl===null)throw Error(l(308));Ms=o,Rl.dependencies={lanes:0,firstContext:o}}else Ms=Ms.next=o;return a}var Vi=null;function cf(o){Vi===null?Vi=[o]:Vi.push(o)}function Qg(o,a,d,p){var v=a.interleaved;return v===null?(d.next=d,cf(a)):(d.next=v.next,v.next=d),a.interleaved=d,dr(o,p)}function dr(o,a){o.lanes|=a;var d=o.alternate;for(d!==null&&(d.lanes|=a),d=o,o=o.return;o!==null;)o.childLanes|=a,d=o.alternate,d!==null&&(d.childLanes|=a),d=o,o=o.return;return d.tag===3?d.stateNode:null}var ti=!1;function df(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Zg(o,a){o=o.updateQueue,a.updateQueue===o&&(a.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Nr(o,a){return{eventTime:o,lane:a,tag:0,payload:null,callback:null,next:null}}function ni(o,a,d){var p=o.updateQueue;if(p===null)return null;if(p=p.shared,Ne&2){var v=p.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),p.pending=a,dr(o,d)}return v=p.interleaved,v===null?(a.next=a,cf(p)):(a.next=v.next,v.next=a),p.interleaved=a,dr(o,d)}function Il(o,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var p=a.lanes;p&=o.pendingLanes,d|=p,a.lanes=d,Kd(o,d)}}function qg(o,a){var d=o.updateQueue,p=o.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var v=null,E=null;if(d=d.firstBaseUpdate,d!==null){do{var L={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};E===null?v=E=L:E=E.next=L,d=d.next}while(d!==null);E===null?v=E=a:E=E.next=a}else v=E=a;d={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:E,shared:p.shared,effects:p.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=a:o.next=a,d.lastBaseUpdate=a}function Ll(o,a,d,p){var v=o.updateQueue;ti=!1;var E=v.firstBaseUpdate,L=v.lastBaseUpdate,X=v.shared.pending;if(X!==null){v.shared.pending=null;var J=X,re=J.next;J.next=null,L===null?E=re:L.next=re,L=J;var ge=o.alternate;ge!==null&&(ge=ge.updateQueue,X=ge.lastBaseUpdate,X!==L&&(X===null?ge.firstBaseUpdate=re:X.next=re,ge.lastBaseUpdate=J))}if(E!==null){var Ce=v.baseState;L=0,ge=re=J=null,X=E;do{var le=X.lane,Ke=X.eventTime;if((p&le)===le){ge!==null&&(ge=ge.next={eventTime:Ke,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Ve=o,cn=X;switch(le=a,Ke=d,cn.tag){case 1:if(Ve=cn.payload,typeof Ve=="function"){Ce=Ve.call(Ke,Ce,le);break e}Ce=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=cn.payload,le=typeof Ve=="function"?Ve.call(Ke,Ce,le):Ve,le==null)break e;Ce=s({},Ce,le);break e;case 2:ti=!0}}X.callback!==null&&X.lane!==0&&(o.flags|=64,le=v.effects,le===null?v.effects=[X]:le.push(X))}else Ke={eventTime:Ke,lane:le,tag:X.tag,payload:X.payload,callback:X.callback,next:null},ge===null?(re=ge=Ke,J=Ce):ge=ge.next=Ke,L|=le;if(X=X.next,X===null){if(X=v.shared.pending,X===null)break;le=X,X=le.next,le.next=null,v.lastBaseUpdate=le,v.shared.pending=null}}while(1);if(ge===null&&(J=Ce),v.baseState=J,v.firstBaseUpdate=re,v.lastBaseUpdate=ge,a=v.shared.interleaved,a!==null){v=a;do L|=v.lane,v=v.next;while(v!==a)}else E===null&&(v.shared.lanes=0);$i|=L,o.lanes=L,o.memoizedState=Ce}}function Jg(o,a,d){if(o=a.effects,a.effects=null,o!==null)for(a=0;a<o.length;a++){var p=o[a],v=p.callback;if(v!==null){if(p.callback=null,p=d,typeof v!="function")throw Error(l(191,v));v.call(p)}}}var Uo={},An=Jr(Uo),Go=Jr(Uo),Is=Jr(Uo);function fr(o){if(o===Uo)throw Error(l(174));return o}function ff(o,a){$e(Is,a),$e(Go,o),$e(An,Uo),o=H(a),Ye(An),$e(An,o)}function Ls(){Ye(An),Ye(Go),Ye(Is)}function e1(o){var a=fr(Is.current),d=fr(An.current);a=O(d,o.type,a),d!==a&&($e(Go,o),$e(An,a))}function hf(o){Go.current===o&&(Ye(An),Ye(Go))}var nt=Jr(0);function Fl(o){for(var a=o;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Ig(d)||Gd(d)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var pf=[];function gf(){for(var o=0;o<pf.length;o++){var a=pf[o];xe?a._workInProgressVersionPrimary=null:a._workInProgressVersionSecondary=null}pf.length=0}var jl=c.ReactCurrentDispatcher,mf=c.ReactCurrentBatchConfig,Wi=0,rt=null,yt=null,bt=null,Ol=!1,Vo=!1,Wo=0,p6=0;function Bt(){throw Error(l(321))}function yf(o,a){if(a===null)return!1;for(var d=0;d<a.length&&d<o.length;d++)if(!$n(o[d],a[d]))return!1;return!0}function vf(o,a,d,p,v,E){if(Wi=E,rt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,jl.current=o===null||o.memoizedState===null?v6:x6,o=d(p,v),Vo){E=0;do{if(Vo=!1,Wo=0,25<=E)throw Error(l(301));E+=1,bt=yt=null,a.updateQueue=null,jl.current=w6,o=d(p,v)}while(Vo)}if(jl.current=Bl,a=yt!==null&&yt.next!==null,Wi=0,bt=yt=rt=null,Ol=!1,a)throw Error(l(300));return o}function xf(){var o=Wo!==0;return Wo=0,o}function hr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?rt.memoizedState=bt=o:bt=bt.next=o,bt}function Mn(){if(yt===null){var o=rt.alternate;o=o!==null?o.memoizedState:null}else o=yt.next;var a=bt===null?rt.memoizedState:bt.next;if(a!==null)bt=a,yt=o;else{if(o===null)throw Error(l(310));yt=o,o={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},bt===null?rt.memoizedState=bt=o:bt=bt.next=o}return bt}function $o(o,a){return typeof a=="function"?a(o):a}function wf(o){var a=Mn(),d=a.queue;if(d===null)throw Error(l(311));d.lastRenderedReducer=o;var p=yt,v=p.baseQueue,E=d.pending;if(E!==null){if(v!==null){var L=v.next;v.next=E.next,E.next=L}p.baseQueue=v=E,d.pending=null}if(v!==null){E=v.next,p=p.baseState;var X=L=null,J=null,re=E;do{var ge=re.lane;if((Wi&ge)===ge)J!==null&&(J=J.next={lane:0,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null}),p=re.hasEagerState?re.eagerState:o(p,re.action);else{var Ce={lane:ge,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null};J===null?(X=J=Ce,L=p):J=J.next=Ce,rt.lanes|=ge,$i|=ge}re=re.next}while(re!==null&&re!==E);J===null?L=p:J.next=X,$n(p,a.memoizedState)||(an=!0),a.memoizedState=p,a.baseState=L,a.baseQueue=J,d.lastRenderedState=p}if(o=d.interleaved,o!==null){v=o;do E=v.lane,rt.lanes|=E,$i|=E,v=v.next;while(v!==o)}else v===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function _f(o){var a=Mn(),d=a.queue;if(d===null)throw Error(l(311));d.lastRenderedReducer=o;var p=d.dispatch,v=d.pending,E=a.memoizedState;if(v!==null){d.pending=null;var L=v=v.next;do E=o(E,L.action),L=L.next;while(L!==v);$n(E,a.memoizedState)||(an=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),d.lastRenderedState=E}return[E,p]}function t1(){}function n1(o,a){var d=rt,p=Mn(),v=a(),E=!$n(p.memoizedState,v);if(E&&(p.memoizedState=v,an=!0),p=p.queue,Sf(s1.bind(null,d,p,o),[o]),p.getSnapshot!==a||E||bt!==null&&bt.memoizedState.tag&1){if(d.flags|=2048,Ho(9,i1.bind(null,d,p,v,a),void 0,null),Et===null)throw Error(l(349));Wi&30||r1(d,a,v)}return v}function r1(o,a,d){o.flags|=16384,o={getSnapshot:a,value:d},a=rt.updateQueue,a===null?(a={lastEffect:null,stores:null},rt.updateQueue=a,a.stores=[o]):(d=a.stores,d===null?a.stores=[o]:d.push(o))}function i1(o,a,d,p){a.value=d,a.getSnapshot=p,o1(a)&&a1(o)}function s1(o,a,d){return d(function(){o1(a)&&a1(o)})}function o1(o){var a=o.getSnapshot;o=o.value;try{var d=a();return!$n(o,d)}catch{return!0}}function a1(o){var a=dr(o,1);a!==null&&Rn(a,o,1,-1)}function l1(o){var a=hr();return typeof o=="function"&&(o=o()),a.memoizedState=a.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:o},a.queue=o,o=o.dispatch=y6.bind(null,rt,o),[a.memoizedState,o]}function Ho(o,a,d,p){return o={tag:o,create:a,destroy:d,deps:p,next:null},a=rt.updateQueue,a===null?(a={lastEffect:null,stores:null},rt.updateQueue=a,a.lastEffect=o.next=o):(d=a.lastEffect,d===null?a.lastEffect=o.next=o:(p=d.next,d.next=o,o.next=p,a.lastEffect=o)),o}function u1(){return Mn().memoizedState}function Dl(o,a,d,p){var v=hr();rt.flags|=o,v.memoizedState=Ho(1|a,d,void 0,p===void 0?null:p)}function zl(o,a,d,p){var v=Mn();p=p===void 0?null:p;var E=void 0;if(yt!==null){var L=yt.memoizedState;if(E=L.destroy,p!==null&&yf(p,L.deps)){v.memoizedState=Ho(a,d,E,p);return}}rt.flags|=o,v.memoizedState=Ho(1|a,d,E,p)}function c1(o,a){return Dl(8390656,8,o,a)}function Sf(o,a){return zl(2048,8,o,a)}function d1(o,a){return zl(4,2,o,a)}function f1(o,a){return zl(4,4,o,a)}function h1(o,a){if(typeof a=="function")return o=o(),a(o),function(){a(null)};if(a!=null)return o=o(),a.current=o,function(){a.current=null}}function p1(o,a,d){return d=d!=null?d.concat([o]):null,zl(4,4,h1.bind(null,a,o),d)}function kf(){}function g1(o,a){var d=Mn();a=a===void 0?null:a;var p=d.memoizedState;return p!==null&&a!==null&&yf(a,p[1])?p[0]:(d.memoizedState=[o,a],o)}function m1(o,a){var d=Mn();a=a===void 0?null:a;var p=d.memoizedState;return p!==null&&a!==null&&yf(a,p[1])?p[0]:(o=o(),d.memoizedState=[o,a],o)}function y1(o,a,d){return Wi&21?($n(d,a)||(d=Og(),rt.lanes|=d,$i|=d,o.baseState=!0),a):(o.baseState&&(o.baseState=!1,an=!0),o.memoizedState=d)}function g6(o,a){var d=Oe;Oe=d!==0&&4>d?d:4,o(!0);var p=mf.transition;mf.transition={};try{o(!1),a()}finally{Oe=d,mf.transition=p}}function v1(){return Mn().memoizedState}function m6(o,a,d){var p=si(o);if(d={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null},x1(o))w1(a,d);else if(d=Qg(o,a,d,p),d!==null){var v=Vt();Rn(d,o,p,v),_1(d,a,p)}}function y6(o,a,d){var p=si(o),v={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null};if(x1(o))w1(a,v);else{var E=o.alternate;if(o.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var L=a.lastRenderedState,X=E(L,d);if(v.hasEagerState=!0,v.eagerState=X,$n(X,L)){var J=a.interleaved;J===null?(v.next=v,cf(a)):(v.next=J.next,J.next=v),a.interleaved=v;return}}catch{}finally{}d=Qg(o,a,v,p),d!==null&&(v=Vt(),Rn(d,o,p,v),_1(d,a,p))}}function x1(o){var a=o.alternate;return o===rt||a!==null&&a===rt}function w1(o,a){Vo=Ol=!0;var d=o.pending;d===null?a.next=a:(a.next=d.next,d.next=a),o.pending=a}function _1(o,a,d){if(d&4194240){var p=a.lanes;p&=o.pendingLanes,d|=p,a.lanes=d,Kd(o,d)}}var Bl={readContext:Nn,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useInsertionEffect:Bt,useLayoutEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useMutableSource:Bt,useSyncExternalStore:Bt,useId:Bt,unstable_isNewReconciler:!1},v6={readContext:Nn,useCallback:function(o,a){return hr().memoizedState=[o,a===void 0?null:a],o},useContext:Nn,useEffect:c1,useImperativeHandle:function(o,a,d){return d=d!=null?d.concat([o]):null,Dl(4194308,4,h1.bind(null,a,o),d)},useLayoutEffect:function(o,a){return Dl(4194308,4,o,a)},useInsertionEffect:function(o,a){return Dl(4,2,o,a)},useMemo:function(o,a){var d=hr();return a=a===void 0?null:a,o=o(),d.memoizedState=[o,a],o},useReducer:function(o,a,d){var p=hr();return a=d!==void 0?d(a):a,p.memoizedState=p.baseState=a,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:a},p.queue=o,o=o.dispatch=m6.bind(null,rt,o),[p.memoizedState,o]},useRef:function(o){var a=hr();return o={current:o},a.memoizedState=o},useState:l1,useDebugValue:kf,useDeferredValue:function(o){return hr().memoizedState=o},useTransition:function(){var o=l1(!1),a=o[0];return o=g6.bind(null,o[1]),hr().memoizedState=o,[a,o]},useMutableSource:function(){},useSyncExternalStore:function(o,a,d){var p=rt,v=hr();if(qe){if(d===void 0)throw Error(l(407));d=d()}else{if(d=a(),Et===null)throw Error(l(349));Wi&30||r1(p,a,d)}v.memoizedState=d;var E={value:d,getSnapshot:a};return v.queue=E,c1(s1.bind(null,p,E,o),[o]),p.flags|=2048,Ho(9,i1.bind(null,p,E,d,a),void 0,null),d},useId:function(){var o=hr(),a=Et.identifierPrefix;if(qe){var d=Pr,p=Er;d=(p&~(1<<32-Wn(p)-1)).toString(32)+d,a=":"+a+"R"+d,d=Wo++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=p6++,a=":"+a+"r"+d.toString(32)+":";return o.memoizedState=a},unstable_isNewReconciler:!1},x6={readContext:Nn,useCallback:g1,useContext:Nn,useEffect:Sf,useImperativeHandle:p1,useInsertionEffect:d1,useLayoutEffect:f1,useMemo:m1,useReducer:wf,useRef:u1,useState:function(){return wf($o)},useDebugValue:kf,useDeferredValue:function(o){var a=Mn();return y1(a,yt.memoizedState,o)},useTransition:function(){var o=wf($o)[0],a=Mn().memoizedState;return[o,a]},useMutableSource:t1,useSyncExternalStore:n1,useId:v1,unstable_isNewReconciler:!1},w6={readContext:Nn,useCallback:g1,useContext:Nn,useEffect:Sf,useImperativeHandle:p1,useInsertionEffect:d1,useLayoutEffect:f1,useMemo:m1,useReducer:_f,useRef:u1,useState:function(){return _f($o)},useDebugValue:kf,useDeferredValue:function(o){var a=Mn();return yt===null?a.memoizedState=o:y1(a,yt.memoizedState,o)},useTransition:function(){var o=_f($o)[0],a=Mn().memoizedState;return[o,a]},useMutableSource:t1,useSyncExternalStore:n1,useId:v1,unstable_isNewReconciler:!1};function Xn(o,a){if(o&&o.defaultProps){a=s({},a),o=o.defaultProps;for(var d in o)a[d]===void 0&&(a[d]=o[d]);return a}return a}function Tf(o,a,d,p){a=o.memoizedState,d=d(p,a),d=d==null?a:s({},a,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var Ul={isMounted:function(o){return(o=o._reactInternals)?F(o)===o:!1},enqueueSetState:function(o,a,d){o=o._reactInternals;var p=Vt(),v=si(o),E=Nr(p,v);E.payload=a,d!=null&&(E.callback=d),a=ni(o,E,v),a!==null&&(Rn(a,o,v,p),Il(a,o,v))},enqueueReplaceState:function(o,a,d){o=o._reactInternals;var p=Vt(),v=si(o),E=Nr(p,v);E.tag=1,E.payload=a,d!=null&&(E.callback=d),a=ni(o,E,v),a!==null&&(Rn(a,o,v,p),Il(a,o,v))},enqueueForceUpdate:function(o,a){o=o._reactInternals;var d=Vt(),p=si(o),v=Nr(d,p);v.tag=2,a!=null&&(v.callback=a),a=ni(o,v,p),a!==null&&(Rn(a,o,p,d),Il(a,o,p))}};function S1(o,a,d,p,v,E,L){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(p,E,L):a.prototype&&a.prototype.isPureReactComponent?!Nl(d,p)||!Nl(v,E):!0}function k1(o,a,d){var p=!1,v=ei,E=a.contextType;return typeof E=="object"&&E!==null?E=Nn(E):(v=on(a)?Bi:zt.current,p=a.contextTypes,E=(p=p!=null)?bs(o,v):ei),a=new a(d,E),o.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Ul,o.stateNode=a,a._reactInternals=o,p&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=v,o.__reactInternalMemoizedMaskedChildContext=E),a}function T1(o,a,d,p){o=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,p),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,p),a.state!==o&&Ul.enqueueReplaceState(a,a.state,null)}function Cf(o,a,d,p){var v=o.stateNode;v.props=d,v.state=o.memoizedState,v.refs={},df(o);var E=a.contextType;typeof E=="object"&&E!==null?v.context=Nn(E):(E=on(a)?Bi:zt.current,v.context=bs(o,E)),v.state=o.memoizedState,E=a.getDerivedStateFromProps,typeof E=="function"&&(Tf(o,a,E,d),v.state=o.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(a=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),a!==v.state&&Ul.enqueueReplaceState(v,v.state,null),Ll(o,d,v,p),v.state=o.memoizedState),typeof v.componentDidMount=="function"&&(o.flags|=4194308)}function Fs(o,a){try{var d="",p=a;do d+=h6(p),p=p.return;while(p);var v=d}catch(E){v=`
Error generating stack: `+E.message+`
`+E.stack}return{value:o,source:a,stack:v,digest:null}}function bf(o,a,d){return{value:o,source:null,stack:d??null,digest:a??null}}function Ef(o,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var _6=typeof WeakMap=="function"?WeakMap:Map;function C1(o,a,d){d=Nr(-1,d),d.tag=3,d.payload={element:null};var p=a.value;return d.callback=function(){tu||(tu=!0,Xf=p),Ef(o,a)},d}function b1(o,a,d){d=Nr(-1,d),d.tag=3;var p=o.type.getDerivedStateFromError;if(typeof p=="function"){var v=a.value;d.payload=function(){return p(v)},d.callback=function(){Ef(o,a)}}var E=o.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(d.callback=function(){Ef(o,a),typeof p!="function"&&(ri===null?ri=new Set([this]):ri.add(this));var L=a.stack;this.componentDidCatch(a.value,{componentStack:L!==null?L:""})}),d}function E1(o,a,d){var p=o.pingCache;if(p===null){p=o.pingCache=new _6;var v=new Set;p.set(a,v)}else v=p.get(a),v===void 0&&(v=new Set,p.set(a,v));v.has(d)||(v.add(d),o=F6.bind(null,o,a,d),a.then(o,o))}function P1(o){do{var a;if((a=o.tag===13)&&(a=o.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return o;o=o.return}while(o!==null);return null}function N1(o,a,d,p,v){return o.mode&1?(o.flags|=65536,o.lanes=v,o):(o===a?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=Nr(-1,1),a.tag=2,ni(d,a,1))),d.lanes|=1),o)}var S6=c.ReactCurrentOwner,an=!1;function Zt(o,a,d,p){a.child=o===null?Yg(a,null,d,p):As(a,o.child,d,p)}function A1(o,a,d,p,v){d=d.render;var E=a.ref;return Rs(a,v),p=vf(o,a,d,p,E,v),d=xf(),o!==null&&!an?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~v,Ar(o,a,v)):(qe&&d&&ef(a),a.flags|=1,Zt(o,a,p,v),a.child)}function M1(o,a,d,p,v){if(o===null){var E=d.type;return typeof E=="function"&&!Jf(E)&&E.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=E,R1(o,a,E,p,v)):(o=au(d.type,null,p,a,a.mode,v),o.ref=a.ref,o.return=a,a.child=o)}if(E=o.child,!(o.lanes&v)){var L=E.memoizedProps;if(d=d.compare,d=d!==null?d:Nl,d(L,p)&&o.ref===a.ref)return Ar(o,a,v)}return a.flags|=1,o=ai(E,p),o.ref=a.ref,o.return=a,a.child=o}function R1(o,a,d,p,v){if(o!==null){var E=o.memoizedProps;if(Nl(E,p)&&o.ref===a.ref)if(an=!1,a.pendingProps=p=E,(o.lanes&v)!==0)o.flags&131072&&(an=!0);else return a.lanes=o.lanes,Ar(o,a,v)}return Pf(o,a,d,p,v)}function I1(o,a,d){var p=a.pendingProps,v=p.children,E=o!==null?o.memoizedState:null;if(p.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},$e(Os,xn),xn|=d;else{if(!(d&1073741824))return o=E!==null?E.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:o,cachePool:null,transitions:null},a.updateQueue=null,$e(Os,xn),xn|=o,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=E!==null?E.baseLanes:d,$e(Os,xn),xn|=p}else E!==null?(p=E.baseLanes|d,a.memoizedState=null):p=d,$e(Os,xn),xn|=p;return Zt(o,a,v,d),a.child}function L1(o,a){var d=a.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function Pf(o,a,d,p,v){var E=on(d)?Bi:zt.current;return E=bs(a,E),Rs(a,v),d=vf(o,a,d,p,E,v),p=xf(),o!==null&&!an?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~v,Ar(o,a,v)):(qe&&p&&ef(a),a.flags|=1,Zt(o,a,d,v),a.child)}function F1(o,a,d,p,v){if(on(d)){var E=!0;wl(a)}else E=!1;if(Rs(a,v),a.stateNode===null)Vl(o,a),k1(a,d,p),Cf(a,d,p,v),p=!0;else if(o===null){var L=a.stateNode,X=a.memoizedProps;L.props=X;var J=L.context,re=d.contextType;typeof re=="object"&&re!==null?re=Nn(re):(re=on(d)?Bi:zt.current,re=bs(a,re));var ge=d.getDerivedStateFromProps,Ce=typeof ge=="function"||typeof L.getSnapshotBeforeUpdate=="function";Ce||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(X!==p||J!==re)&&T1(a,L,p,re),ti=!1;var le=a.memoizedState;L.state=le,Ll(a,p,L,v),J=a.memoizedState,X!==p||le!==J||sn.current||ti?(typeof ge=="function"&&(Tf(a,d,ge,p),J=a.memoizedState),(X=ti||S1(a,d,X,p,le,J,re))?(Ce||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(a.flags|=4194308)):(typeof L.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=p,a.memoizedState=J),L.props=p,L.state=J,L.context=re,p=X):(typeof L.componentDidMount=="function"&&(a.flags|=4194308),p=!1)}else{L=a.stateNode,Zg(o,a),X=a.memoizedProps,re=a.type===a.elementType?X:Xn(a.type,X),L.props=re,Ce=a.pendingProps,le=L.context,J=d.contextType,typeof J=="object"&&J!==null?J=Nn(J):(J=on(d)?Bi:zt.current,J=bs(a,J));var Ke=d.getDerivedStateFromProps;(ge=typeof Ke=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(X!==Ce||le!==J)&&T1(a,L,p,J),ti=!1,le=a.memoizedState,L.state=le,Ll(a,p,L,v);var Ve=a.memoizedState;X!==Ce||le!==Ve||sn.current||ti?(typeof Ke=="function"&&(Tf(a,d,Ke,p),Ve=a.memoizedState),(re=ti||S1(a,d,re,p,le,Ve,J)||!1)?(ge||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(p,Ve,J),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(p,Ve,J)),typeof L.componentDidUpdate=="function"&&(a.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof L.componentDidUpdate!="function"||X===o.memoizedProps&&le===o.memoizedState||(a.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||X===o.memoizedProps&&le===o.memoizedState||(a.flags|=1024),a.memoizedProps=p,a.memoizedState=Ve),L.props=p,L.state=Ve,L.context=J,p=re):(typeof L.componentDidUpdate!="function"||X===o.memoizedProps&&le===o.memoizedState||(a.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||X===o.memoizedProps&&le===o.memoizedState||(a.flags|=1024),p=!1)}return Nf(o,a,d,p,E,v)}function Nf(o,a,d,p,v,E){L1(o,a);var L=(a.flags&128)!==0;if(!p&&!L)return v&&jg(a,d,!1),Ar(o,a,E);p=a.stateNode,S6.current=a;var X=L&&typeof d.getDerivedStateFromError!="function"?null:p.render();return a.flags|=1,o!==null&&L?(a.child=As(a,o.child,null,E),a.child=As(a,null,X,E)):Zt(o,a,X,E),a.memoizedState=p.state,v&&jg(a,d,!0),a.child}function j1(o){var a=o.stateNode;a.pendingContext?Lg(o,a.pendingContext,a.pendingContext!==a.context):a.context&&Lg(o,a.context,!1),ff(o,a.containerInfo)}function O1(o,a,d,p,v){return Ns(),sf(v),a.flags|=256,Zt(o,a,d,p),a.child}var Af={dehydrated:null,treeContext:null,retryLane:0};function Mf(o){return{baseLanes:o,cachePool:null,transitions:null}}function D1(o,a,d){var p=a.pendingProps,v=nt.current,E=!1,L=(a.flags&128)!==0,X;if((X=L)||(X=o!==null&&o.memoizedState===null?!1:(v&2)!==0),X?(E=!0,a.flags&=-129):(o===null||o.memoizedState!==null)&&(v|=1),$e(nt,v&1),o===null)return rf(a),o=a.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(a.mode&1?Gd(o)?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(L=p.children,o=p.fallback,E?(p=a.mode,E=a.child,L={mode:"hidden",children:L},!(p&1)&&E!==null?(E.childLanes=0,E.pendingProps=L):E=lu(L,p,0,null),o=Ki(o,p,d,null),E.return=a,o.return=a,E.sibling=o,a.child=E,a.child.memoizedState=Mf(d),a.memoizedState=Af,o):Rf(a,L));if(v=o.memoizedState,v!==null&&(X=v.dehydrated,X!==null))return k6(o,a,L,p,X,v,d);if(E){E=p.fallback,L=a.mode,v=o.child,X=v.sibling;var J={mode:"hidden",children:p.children};return!(L&1)&&a.child!==v?(p=a.child,p.childLanes=0,p.pendingProps=J,a.deletions=null):(p=ai(v,J),p.subtreeFlags=v.subtreeFlags&14680064),X!==null?E=ai(X,E):(E=Ki(E,L,d,null),E.flags|=2),E.return=a,p.return=a,p.sibling=E,a.child=p,p=E,E=a.child,L=o.child.memoizedState,L=L===null?Mf(d):{baseLanes:L.baseLanes|d,cachePool:null,transitions:L.transitions},E.memoizedState=L,E.childLanes=o.childLanes&~d,a.memoizedState=Af,p}return E=o.child,o=E.sibling,p=ai(E,{mode:"visible",children:p.children}),!(a.mode&1)&&(p.lanes=d),p.return=a,p.sibling=null,o!==null&&(d=a.deletions,d===null?(a.deletions=[o],a.flags|=16):d.push(o)),a.child=p,a.memoizedState=null,p}function Rf(o,a){return a=lu({mode:"visible",children:a},o.mode,0,null),a.return=o,o.child=a}function Gl(o,a,d,p){return p!==null&&sf(p),As(a,o.child,null,d),o=Rf(a,a.pendingProps.children),o.flags|=2,a.memoizedState=null,o}function k6(o,a,d,p,v,E,L){if(d)return a.flags&256?(a.flags&=-257,p=bf(Error(l(422))),Gl(o,a,L,p)):a.memoizedState!==null?(a.child=o.child,a.flags|=128,null):(E=p.fallback,v=a.mode,p=lu({mode:"visible",children:p.children},v,0,null),E=Ki(E,v,L,null),E.flags|=2,p.return=a,E.return=a,p.sibling=E,a.child=p,a.mode&1&&As(a,o.child,null,L),a.child.memoizedState=Mf(L),a.memoizedState=Af,E);if(!(a.mode&1))return Gl(o,a,L,null);if(Gd(v))return p=j4(v).digest,E=Error(l(419)),p=bf(E,p,void 0),Gl(o,a,L,p);if(d=(L&o.childLanes)!==0,an||d){if(p=Et,p!==null){switch(L&-L){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(p.suspendedLanes|L)?0:v,v!==0&&v!==E.retryLane&&(E.retryLane=v,dr(o,v),Rn(p,o,v,-1))}return qf(),p=bf(Error(l(421))),Gl(o,a,L,p)}return Ig(v)?(a.flags|=128,a.child=o.child,a=j6.bind(null,o),O4(v,a),null):(o=E.treeContext,ie&&(Pn=B4(v),vn=a,qe=!0,Hn=null,zo=!1,o!==null&&(bn[En++]=Er,bn[En++]=Pr,bn[En++]=Ui,Er=o.id,Pr=o.overflow,Ui=a)),a=Rf(a,p.children),a.flags|=4096,a)}function z1(o,a,d){o.lanes|=a;var p=o.alternate;p!==null&&(p.lanes|=a),uf(o.return,a,d)}function If(o,a,d,p,v){var E=o.memoizedState;E===null?o.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:v}:(E.isBackwards=a,E.rendering=null,E.renderingStartTime=0,E.last=p,E.tail=d,E.tailMode=v)}function B1(o,a,d){var p=a.pendingProps,v=p.revealOrder,E=p.tail;if(Zt(o,a,p.children,d),p=nt.current,p&2)p=p&1|2,a.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=a.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&z1(o,d,a);else if(o.tag===19)z1(o,d,a);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}p&=1}if($e(nt,p),!(a.mode&1))a.memoizedState=null;else switch(v){case"forwards":for(d=a.child,v=null;d!==null;)o=d.alternate,o!==null&&Fl(o)===null&&(v=d),d=d.sibling;d=v,d===null?(v=a.child,a.child=null):(v=d.sibling,d.sibling=null),If(a,!1,v,d,E);break;case"backwards":for(d=null,v=a.child,a.child=null;v!==null;){if(o=v.alternate,o!==null&&Fl(o)===null){a.child=v;break}o=v.sibling,v.sibling=d,d=v,v=o}If(a,!0,d,null,E);break;case"together":If(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Vl(o,a){!(a.mode&1)&&o!==null&&(o.alternate=null,a.alternate=null,a.flags|=2)}function Ar(o,a,d){if(o!==null&&(a.dependencies=o.dependencies),$i|=a.lanes,!(d&a.childLanes))return null;if(o!==null&&a.child!==o.child)throw Error(l(153));if(a.child!==null){for(o=a.child,d=ai(o,o.pendingProps),a.child=d,d.return=a;o.sibling!==null;)o=o.sibling,d=d.sibling=ai(o,o.pendingProps),d.return=a;d.sibling=null}return a.child}function T6(o,a,d){switch(a.tag){case 3:j1(a),Ns();break;case 5:e1(a);break;case 1:on(a.type)&&wl(a);break;case 4:ff(a,a.stateNode.containerInfo);break;case 10:Kg(a,a.type._context,a.memoizedProps.value);break;case 13:var p=a.memoizedState;if(p!==null)return p.dehydrated!==null?($e(nt,nt.current&1),a.flags|=128,null):d&a.child.childLanes?D1(o,a,d):($e(nt,nt.current&1),o=Ar(o,a,d),o!==null?o.sibling:null);$e(nt,nt.current&1);break;case 19:if(p=(d&a.childLanes)!==0,o.flags&128){if(p)return B1(o,a,d);a.flags|=128}var v=a.memoizedState;if(v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),$e(nt,nt.current),p)break;return null;case 22:case 23:return a.lanes=0,I1(o,a,d)}return Ar(o,a,d)}function pr(o){o.flags|=4}function U1(o,a){if(o!==null&&o.child===a.child)return!0;if(a.flags&16)return!1;for(o=a.child;o!==null;){if(o.flags&12854||o.subtreeFlags&12854)return!1;o=o.sibling}return!0}var Xo,Yo,Wl,$l;if(ve)Xo=function(o,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)Q(o,d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Yo=function(){},Wl=function(o,a,d,p,v){if(o=o.memoizedProps,o!==p){var E=a.stateNode,L=fr(An.current);d=oe(E,d,o,p,v,L),(a.updateQueue=d)&&pr(a)}},$l=function(o,a,d,p){d!==p&&pr(a)};else if(Le){Xo=function(o,a,d,p){for(var v=a.child;v!==null;){if(v.tag===5){var E=v.stateNode;d&&p&&(E=Mg(E,v.type,v.memoizedProps,v)),Q(o,E)}else if(v.tag===6)E=v.stateNode,d&&p&&(E=Rg(E,v.memoizedProps,v)),Q(o,E);else if(v.tag!==4){if(v.tag===22&&v.memoizedState!==null)E=v.child,E!==null&&(E.return=v),Xo(o,v,!0,!0);else if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===a)break;for(;v.sibling===null;){if(v.return===null||v.return===a)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};var G1=function(o,a,d,p){for(var v=a.child;v!==null;){if(v.tag===5){var E=v.stateNode;d&&p&&(E=Mg(E,v.type,v.memoizedProps,v)),Ag(o,E)}else if(v.tag===6)E=v.stateNode,d&&p&&(E=Rg(E,v.memoizedProps,v)),Ag(o,E);else if(v.tag!==4){if(v.tag===22&&v.memoizedState!==null)E=v.child,E!==null&&(E.return=v),G1(o,v,!0,!0);else if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===a)break;for(;v.sibling===null;){if(v.return===null||v.return===a)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};Yo=function(o,a){var d=a.stateNode;if(!U1(o,a)){o=d.containerInfo;var p=Ng(o);G1(p,a,!1,!1),d.pendingChildren=p,pr(a),R4(o,p)}},Wl=function(o,a,d,p,v){var E=o.stateNode,L=o.memoizedProps;if((o=U1(o,a))&&L===p)a.stateNode=E;else{var X=a.stateNode,J=fr(An.current),re=null;L!==p&&(re=oe(X,d,L,p,v,J)),o&&re===null?a.stateNode=E:(E=M4(E,re,d,L,p,a,o,X),q(E,d,p,v,J)&&pr(a),a.stateNode=E,o?pr(a):Xo(E,a,!1,!1))}},$l=function(o,a,d,p){d!==p?(o=fr(Is.current),d=fr(An.current),a.stateNode=ye(p,o,d,a),pr(a)):a.stateNode=o.stateNode}}else Yo=function(){},Wl=function(){},$l=function(){};function Ko(o,a){if(!qe)switch(o.tailMode){case"hidden":a=o.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?a||o.tail===null?o.tail=null:o.tail.sibling=null:p.sibling=null}}function Ut(o){var a=o.alternate!==null&&o.alternate.child===o.child,d=0,p=0;if(a)for(var v=o.child;v!==null;)d|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=o,v=v.sibling;else for(v=o.child;v!==null;)d|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=o,v=v.sibling;return o.subtreeFlags|=p,o.childLanes=d,a}function C6(o,a,d){var p=a.pendingProps;switch(tf(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(a),null;case 1:return on(a.type)&&xl(),Ut(a),null;case 3:return d=a.stateNode,Ls(),Ye(sn),Ye(zt),gf(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(o===null||o.child===null)&&(Pl(a)?pr(a):o===null||o.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Hn!==null&&(Qf(Hn),Hn=null))),Yo(o,a),Ut(a),null;case 5:hf(a),d=fr(Is.current);var v=a.type;if(o!==null&&a.stateNode!=null)Wl(o,a,v,p,d),o.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!p){if(a.stateNode===null)throw Error(l(166));return Ut(a),null}if(o=fr(An.current),Pl(a)){if(!ie)throw Error(l(175));o=U4(a.stateNode,a.type,a.memoizedProps,d,o,a,!zo),a.updateQueue=o,o!==null&&pr(a)}else{var E=K(v,p,d,o,a);Xo(E,a,!1,!1),a.stateNode=E,q(E,v,p,d,o)&&pr(a)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Ut(a),null;case 6:if(o&&a.stateNode!=null)$l(o,a,o.memoizedProps,p);else{if(typeof p!="string"&&a.stateNode===null)throw Error(l(166));if(o=fr(Is.current),d=fr(An.current),Pl(a)){if(!ie)throw Error(l(176));if(o=a.stateNode,d=a.memoizedProps,(p=G4(o,d,a,!zo))&&(v=vn,v!==null))switch(v.tag){case 3:Q4(v.stateNode.containerInfo,o,d,(v.mode&1)!==0);break;case 5:Z4(v.type,v.memoizedProps,v.stateNode,o,d,(v.mode&1)!==0)}p&&pr(a)}else a.stateNode=ye(p,o,d,a)}return Ut(a),null;case 13:if(Ye(nt),p=a.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(qe&&Pn!==null&&a.mode&1&&!(a.flags&128))$g(),Ns(),a.flags|=98560,v=!1;else if(v=Pl(a),p!==null&&p.dehydrated!==null){if(o===null){if(!v)throw Error(l(318));if(!ie)throw Error(l(344));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(l(317));V4(v,a)}else Ns(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Ut(a),v=!1}else Hn!==null&&(Qf(Hn),Hn=null),v=!0;if(!v)return a.flags&65536?a:null}return a.flags&128?(a.lanes=d,a):(d=p!==null,d!==(o!==null&&o.memoizedState!==null)&&d&&(a.child.flags|=8192,a.mode&1&&(o===null||nt.current&1?vt===0&&(vt=3):qf())),a.updateQueue!==null&&(a.flags|=4),Ut(a),null);case 4:return Ls(),Yo(o,a),o===null&&de(a.stateNode.containerInfo),Ut(a),null;case 10:return lf(a.type._context),Ut(a),null;case 17:return on(a.type)&&xl(),Ut(a),null;case 19:if(Ye(nt),v=a.memoizedState,v===null)return Ut(a),null;if(p=(a.flags&128)!==0,E=v.rendering,E===null)if(p)Ko(v,!1);else{if(vt!==0||o!==null&&o.flags&128)for(o=a.child;o!==null;){if(E=Fl(o),E!==null){for(a.flags|=128,Ko(v,!1),o=E.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),a.subtreeFlags=0,o=d,d=a.child;d!==null;)p=d,v=o,p.flags&=14680066,E=p.alternate,E===null?(p.childLanes=0,p.lanes=v,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=E.childLanes,p.lanes=E.lanes,p.child=E.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=E.memoizedProps,p.memoizedState=E.memoizedState,p.updateQueue=E.updateQueue,p.type=E.type,v=E.dependencies,p.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),d=d.sibling;return $e(nt,nt.current&1|2),a.child}o=o.sibling}v.tail!==null&&Ct()>Hf&&(a.flags|=128,p=!0,Ko(v,!1),a.lanes=4194304)}else{if(!p)if(o=Fl(E),o!==null){if(a.flags|=128,p=!0,o=o.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),Ko(v,!0),v.tail===null&&v.tailMode==="hidden"&&!E.alternate&&!qe)return Ut(a),null}else 2*Ct()-v.renderingStartTime>Hf&&d!==1073741824&&(a.flags|=128,p=!0,Ko(v,!1),a.lanes=4194304);v.isBackwards?(E.sibling=a.child,a.child=E):(o=v.last,o!==null?o.sibling=E:a.child=E,v.last=E)}return v.tail!==null?(a=v.tail,v.rendering=a,v.tail=a.sibling,v.renderingStartTime=Ct(),a.sibling=null,o=nt.current,$e(nt,p?o&1|2:o&1),a):(Ut(a),null);case 22:case 23:return Zf(),d=a.memoizedState!==null,o!==null&&o.memoizedState!==null!==d&&(a.flags|=8192),d&&a.mode&1?xn&1073741824&&(Ut(a),ve&&a.subtreeFlags&6&&(a.flags|=8192)):Ut(a),null;case 24:return null;case 25:return null}throw Error(l(156,a.tag))}function b6(o,a){switch(tf(a),a.tag){case 1:return on(a.type)&&xl(),o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 3:return Ls(),Ye(sn),Ye(zt),gf(),o=a.flags,o&65536&&!(o&128)?(a.flags=o&-65537|128,a):null;case 5:return hf(a),null;case 13:if(Ye(nt),o=a.memoizedState,o!==null&&o.dehydrated!==null){if(a.alternate===null)throw Error(l(340));Ns()}return o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 19:return Ye(nt),null;case 4:return Ls(),null;case 10:return lf(a.type._context),null;case 22:case 23:return Zf(),null;case 24:return null;default:return null}}var Hl=!1,Gt=!1,E6=typeof WeakSet=="function"?WeakSet:Set,fe=null;function js(o,a){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(p){Je(o,a,p)}else d.current=null}function Lf(o,a,d){try{d()}catch(p){Je(o,a,p)}}var V1=!1;function P6(o,a){for($(o.containerInfo),fe=a;fe!==null;)if(o=fe,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,fe=a;else for(;fe!==null;){o=fe;try{var d=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(d!==null){var p=d.memoizedProps,v=d.memoizedState,E=o.stateNode,L=E.getSnapshotBeforeUpdate(o.elementType===o.type?p:Xn(o.type,p),v);E.__reactInternalSnapshotBeforeUpdate=L}break;case 3:ve&&A4(o.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(X){Je(o,o.return,X)}if(a=o.sibling,a!==null){a.return=o.return,fe=a;break}fe=o.return}return d=V1,V1=!1,d}function Qo(o,a,d){var p=a.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&o)===o){var E=v.destroy;v.destroy=void 0,E!==void 0&&Lf(a,d,E)}v=v.next}while(v!==p)}}function Xl(o,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&o)===o){var p=d.create;d.destroy=p()}d=d.next}while(d!==a)}}function Ff(o){var a=o.ref;if(a!==null){var d=o.stateNode;switch(o.tag){case 5:o=G(d);break;default:o=d}typeof a=="function"?a(o):a.current=o}}function W1(o){var a=o.alternate;a!==null&&(o.alternate=null,W1(a)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(a=o.stateNode,a!==null&&Me(a)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function $1(o){return o.tag===5||o.tag===3||o.tag===4}function H1(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||$1(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function jf(o,a,d){var p=o.tag;if(p===5||p===6)o=o.stateNode,a?k4(d,o,a):yl(d,o);else if(p!==4&&(o=o.child,o!==null))for(jf(o,a,d),o=o.sibling;o!==null;)jf(o,a,d),o=o.sibling}function Of(o,a,d){var p=o.tag;if(p===5||p===6)o=o.stateNode,a?qr(d,o,a):Ts(d,o);else if(p!==4&&(o=o.child,o!==null))for(Of(o,a,d),o=o.sibling;o!==null;)Of(o,a,d),o=o.sibling}var Rt=null,Yn=!1;function gr(o,a,d){for(d=d.child;d!==null;)Df(o,a,d),d=d.sibling}function Df(o,a,d){if(ur&&typeof ur.onCommitFiberUnmount=="function")try{ur.onCommitFiberUnmount(Tl,d)}catch{}switch(d.tag){case 5:Gt||js(d,a);case 6:if(ve){var p=Rt,v=Yn;Rt=null,gr(o,a,d),Rt=p,Yn=v,Rt!==null&&(Yn?C4(Rt,d.stateNode):T4(Rt,d.stateNode))}else gr(o,a,d);break;case 18:ve&&Rt!==null&&(Yn?Y4(Rt,d.stateNode):X4(Rt,d.stateNode));break;case 4:ve?(p=Rt,v=Yn,Rt=d.stateNode.containerInfo,Yn=!0,gr(o,a,d),Rt=p,Yn=v):(Le&&(p=d.stateNode.containerInfo,v=Ng(p),Ud(p,v)),gr(o,a,d));break;case 0:case 11:case 14:case 15:if(!Gt&&(p=d.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var E=v,L=E.destroy;E=E.tag,L!==void 0&&(E&2||E&4)&&Lf(d,a,L),v=v.next}while(v!==p)}gr(o,a,d);break;case 1:if(!Gt&&(js(d,a),p=d.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=d.memoizedProps,p.state=d.memoizedState,p.componentWillUnmount()}catch(X){Je(d,a,X)}gr(o,a,d);break;case 21:gr(o,a,d);break;case 22:d.mode&1?(Gt=(p=Gt)||d.memoizedState!==null,gr(o,a,d),Gt=p):gr(o,a,d);break;default:gr(o,a,d)}}function X1(o){var a=o.updateQueue;if(a!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new E6),a.forEach(function(p){var v=O6.bind(null,o,p);d.has(p)||(d.add(p),p.then(v,v))})}}function Kn(o,a){var d=a.deletions;if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];try{var E=o,L=a;if(ve){var X=L;e:for(;X!==null;){switch(X.tag){case 5:Rt=X.stateNode,Yn=!1;break e;case 3:Rt=X.stateNode.containerInfo,Yn=!0;break e;case 4:Rt=X.stateNode.containerInfo,Yn=!0;break e}X=X.return}if(Rt===null)throw Error(l(160));Df(E,L,v),Rt=null,Yn=!1}else Df(E,L,v);var J=v.alternate;J!==null&&(J.return=null),v.return=null}catch(re){Je(v,a,re)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)Y1(a,o),a=a.sibling}function Y1(o,a){var d=o.alternate,p=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(Kn(a,o),mr(o),p&4){try{Qo(3,o,o.return),Xl(3,o)}catch(le){Je(o,o.return,le)}try{Qo(5,o,o.return)}catch(le){Je(o,o.return,le)}}break;case 1:Kn(a,o),mr(o),p&512&&d!==null&&js(d,d.return);break;case 5:if(Kn(a,o),mr(o),p&512&&d!==null&&js(d,d.return),ve){if(o.flags&32){var v=o.stateNode;try{Pg(v)}catch(le){Je(o,o.return,le)}}if(p&4&&(v=o.stateNode,v!=null)){var E=o.memoizedProps;if(d=d!==null?d.memoizedProps:E,p=o.type,a=o.updateQueue,o.updateQueue=null,a!==null)try{rn(v,a,p,d,E,o)}catch(le){Je(o,o.return,le)}}}break;case 6:if(Kn(a,o),mr(o),p&4&&ve){if(o.stateNode===null)throw Error(l(162));v=o.stateNode,E=o.memoizedProps,d=d!==null?d.memoizedProps:E;try{Te(v,d,E)}catch(le){Je(o,o.return,le)}}break;case 3:if(Kn(a,o),mr(o),p&4){if(ve&&ie&&d!==null&&d.memoizedState.isDehydrated)try{$4(a.containerInfo)}catch(le){Je(o,o.return,le)}if(Le){v=a.containerInfo,E=a.pendingChildren;try{Ud(v,E)}catch(le){Je(o,o.return,le)}}}break;case 4:if(Kn(a,o),mr(o),p&4&&Le){E=o.stateNode,v=E.containerInfo,E=E.pendingChildren;try{Ud(v,E)}catch(le){Je(o,o.return,le)}}break;case 13:Kn(a,o),mr(o),v=o.child,v.flags&8192&&(E=v.memoizedState!==null,v.stateNode.isHidden=E,!E||v.alternate!==null&&v.alternate.memoizedState!==null||($f=Ct())),p&4&&X1(o);break;case 22:var L=d!==null&&d.memoizedState!==null;if(o.mode&1?(Gt=(d=Gt)||L,Kn(a,o),Gt=d):Kn(a,o),mr(o),p&8192){if(d=o.memoizedState!==null,(o.stateNode.isHidden=d)&&!L&&o.mode&1)for(fe=o,p=o.child;p!==null;){for(a=fe=p;fe!==null;){L=fe;var X=L.child;switch(L.tag){case 0:case 11:case 14:case 15:Qo(4,L,L.return);break;case 1:js(L,L.return);var J=L.stateNode;if(typeof J.componentWillUnmount=="function"){var re=L,ge=L.return;try{var Ce=re;J.props=Ce.memoizedProps,J.state=Ce.memoizedState,J.componentWillUnmount()}catch(le){Je(re,ge,le)}}break;case 5:js(L,L.return);break;case 22:if(L.memoizedState!==null){Z1(a);continue}}X!==null?(X.return=L,fe=X):Z1(a)}p=p.sibling}if(ve){e:if(p=null,ve)for(a=o;;){if(a.tag===5){if(p===null){p=a;try{v=a.stateNode,d?b4(v):P4(a.stateNode,a.memoizedProps)}catch(le){Je(o,o.return,le)}}}else if(a.tag===6){if(p===null)try{E=a.stateNode,d?E4(E):N4(E,a.memoizedProps)}catch(le){Je(o,o.return,le)}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===o)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;p===a&&(p=null),a=a.return}p===a&&(p=null),a.sibling.return=a.return,a=a.sibling}}}break;case 19:Kn(a,o),mr(o),p&4&&X1(o);break;case 21:break;default:Kn(a,o),mr(o)}}function mr(o){var a=o.flags;if(a&2){try{if(ve){e:{for(var d=o.return;d!==null;){if($1(d)){var p=d;break e}d=d.return}throw Error(l(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(Pg(v),p.flags&=-33);var E=H1(o);Of(o,E,v);break;case 3:case 4:var L=p.stateNode.containerInfo,X=H1(o);jf(o,X,L);break;default:throw Error(l(161))}}}catch(J){Je(o,o.return,J)}o.flags&=-3}a&4096&&(o.flags&=-4097)}function N6(o,a,d){fe=o,K1(o)}function K1(o,a,d){for(var p=(o.mode&1)!==0;fe!==null;){var v=fe,E=v.child;if(v.tag===22&&p){var L=v.memoizedState!==null||Hl;if(!L){var X=v.alternate,J=X!==null&&X.memoizedState!==null||Gt;X=Hl;var re=Gt;if(Hl=L,(Gt=J)&&!re)for(fe=v;fe!==null;)L=fe,J=L.child,L.tag===22&&L.memoizedState!==null?q1(v):J!==null?(J.return=L,fe=J):q1(v);for(;E!==null;)fe=E,K1(E),E=E.sibling;fe=v,Hl=X,Gt=re}Q1(o)}else v.subtreeFlags&8772&&E!==null?(E.return=v,fe=E):Q1(o)}}function Q1(o){for(;fe!==null;){var a=fe;if(a.flags&8772){var d=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Gt||Xl(5,a);break;case 1:var p=a.stateNode;if(a.flags&4&&!Gt)if(d===null)p.componentDidMount();else{var v=a.elementType===a.type?d.memoizedProps:Xn(a.type,d.memoizedProps);p.componentDidUpdate(v,d.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var E=a.updateQueue;E!==null&&Jg(a,E,p);break;case 3:var L=a.updateQueue;if(L!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=G(a.child.stateNode);break;case 1:d=a.child.stateNode}Jg(a,L,d)}break;case 5:var X=a.stateNode;d===null&&a.flags&4&&Xe(X,a.type,a.memoizedProps,a);break;case 6:break;case 4:break;case 12:break;case 13:if(ie&&a.memoizedState===null){var J=a.alternate;if(J!==null){var re=J.memoizedState;if(re!==null){var ge=re.dehydrated;ge!==null&&H4(ge)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(l(163))}Gt||a.flags&512&&Ff(a)}catch(Ce){Je(a,a.return,Ce)}}if(a===o){fe=null;break}if(d=a.sibling,d!==null){d.return=a.return,fe=d;break}fe=a.return}}function Z1(o){for(;fe!==null;){var a=fe;if(a===o){fe=null;break}var d=a.sibling;if(d!==null){d.return=a.return,fe=d;break}fe=a.return}}function q1(o){for(;fe!==null;){var a=fe;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{Xl(4,a)}catch(J){Je(a,d,J)}break;case 1:var p=a.stateNode;if(typeof p.componentDidMount=="function"){var v=a.return;try{p.componentDidMount()}catch(J){Je(a,v,J)}}var E=a.return;try{Ff(a)}catch(J){Je(a,E,J)}break;case 5:var L=a.return;try{Ff(a)}catch(J){Je(a,L,J)}}}catch(J){Je(a,a.return,J)}if(a===o){fe=null;break}var X=a.sibling;if(X!==null){X.return=a.return,fe=X;break}fe=a.return}}var Yl=0,Kl=1,Ql=2,Zl=3,ql=4;if(typeof Symbol=="function"&&Symbol.for){var Zo=Symbol.for;Yl=Zo("selector.component"),Kl=Zo("selector.has_pseudo_class"),Ql=Zo("selector.role"),Zl=Zo("selector.test_id"),ql=Zo("selector.text")}function zf(o){var a=se(o);if(a!=null){if(typeof a.memoizedProps["data-testname"]!="string")throw Error(l(364));return a}if(o=Qt(o),o===null)throw Error(l(362));return o.stateNode.current}function Bf(o,a){switch(a.$$typeof){case Yl:if(o.type===a.value)return!0;break;case Kl:e:{a=a.value,o=[o,0];for(var d=0;d<o.length;){var p=o[d++],v=o[d++],E=a[v];if(p.tag!==5||!lr(p)){for(;E!=null&&Bf(p,E);)v++,E=a[v];if(v===a.length){a=!0;break e}else for(p=p.child;p!==null;)o.push(p,v),p=p.sibling}}a=!1}return a;case Ql:if(o.tag===5&&ks(o.stateNode,a.value))return!0;break;case ql:if((o.tag===5||o.tag===6)&&(o=Ss(o),o!==null&&0<=o.indexOf(a.value)))return!0;break;case Zl:if(o.tag===5&&(o=o.memoizedProps["data-testname"],typeof o=="string"&&o.toLowerCase()===a.value.toLowerCase()))return!0;break;default:throw Error(l(365))}return!1}function Uf(o){switch(o.$$typeof){case Yl:return"<"+(I(o.value)||"Unknown")+">";case Kl:return":has("+(Uf(o)||"")+")";case Ql:return'[role="'+o.value+'"]';case ql:return'"'+o.value+'"';case Zl:return'[data-testname="'+o.value+'"]';default:throw Error(l(365))}}function J1(o,a){var d=[];o=[o,0];for(var p=0;p<o.length;){var v=o[p++],E=o[p++],L=a[E];if(v.tag!==5||!lr(v)){for(;L!=null&&Bf(v,L);)E++,L=a[E];if(E===a.length)d.push(v);else for(v=v.child;v!==null;)o.push(v,E),v=v.sibling}}return d}function Gf(o,a){if(!Tt)throw Error(l(363));o=zf(o),o=J1(o,a),a=[],o=Array.from(o);for(var d=0;d<o.length;){var p=o[d++];if(p.tag===5)lr(p)||a.push(p.stateNode);else for(p=p.child;p!==null;)o.push(p),p=p.sibling}return a}var A6=Math.ceil,Jl=c.ReactCurrentDispatcher,Vf=c.ReactCurrentOwner,ft=c.ReactCurrentBatchConfig,Ne=0,Et=null,gt=null,It=0,xn=0,Os=Jr(0),vt=0,qo=null,$i=0,eu=0,Wf=0,Jo=null,ln=null,$f=0,Hf=1/0,Mr=null;function Ds(){Hf=Ct()+500}var tu=!1,Xf=null,ri=null,nu=!1,ii=null,ru=0,ea=0,Yf=null,iu=-1,su=0;function Vt(){return Ne&6?Ct():iu!==-1?iu:iu=Ct()}function si(o){return o.mode&1?Ne&2&&It!==0?It&-It:f6.transition!==null?(su===0&&(su=Og()),su):(o=Oe,o!==0?o:ke()):1}function Rn(o,a,d,p){if(50<ea)throw ea=0,Yf=null,Error(l(185));Do(o,d,p),(!(Ne&2)||o!==Et)&&(o===Et&&(!(Ne&2)&&(eu|=d),vt===4&&oi(o,It)),un(o,p),d===1&&Ne===0&&!(a.mode&1)&&(Ds(),Cl&&cr()))}function un(o,a){var d=o.callbackNode;r6(o,a);var p=kl(o,o===Et?It:0);if(p===0)d!==null&&zg(d),o.callbackNode=null,o.callbackPriority=0;else if(a=p&-p,o.callbackPriority!==a){if(d!=null&&zg(d),a===1)o.tag===0?d6(tm.bind(null,o)):Bg(tm.bind(null,o)),ue?dt(function(){!(Ne&6)&&cr()}):Qd(Zd,cr),d=null;else{switch(Dg(p)){case 1:d=Zd;break;case 4:d=a6;break;case 16:d=qd;break;case 536870912:d=l6;break;default:d=qd}d=cm(d,em.bind(null,o))}o.callbackPriority=a,o.callbackNode=d}}function em(o,a){if(iu=-1,su=0,Ne&6)throw Error(l(327));var d=o.callbackNode;if(Yi()&&o.callbackNode!==d)return null;var p=kl(o,o===Et?It:0);if(p===0)return null;if(p&30||p&o.expiredLanes||a)a=ou(o,p);else{a=p;var v=Ne;Ne|=2;var E=im();(Et!==o||It!==a)&&(Mr=null,Ds(),Hi(o,a));do try{I6();break}catch(X){rm(o,X)}while(1);af(),Jl.current=E,Ne=v,gt!==null?a=0:(Et=null,It=0,a=vt)}if(a!==0){if(a===2&&(v=Xd(o),v!==0&&(p=v,a=Kf(o,v))),a===1)throw d=qo,Hi(o,0),oi(o,p),un(o,Ct()),d;if(a===6)oi(o,p);else{if(v=o.current.alternate,!(p&30)&&!M6(v)&&(a=ou(o,p),a===2&&(E=Xd(o),E!==0&&(p=E,a=Kf(o,E))),a===1))throw d=qo,Hi(o,0),oi(o,p),un(o,Ct()),d;switch(o.finishedWork=v,o.finishedLanes=p,a){case 0:case 1:throw Error(l(345));case 2:Xi(o,ln,Mr);break;case 3:if(oi(o,p),(p&130023424)===p&&(a=$f+500-Ct(),10<a)){if(kl(o,0)!==0)break;if(v=o.suspendedLanes,(v&p)!==p){Vt(),o.pingedLanes|=o.suspendedLanes&v;break}o.timeoutHandle=U(Xi.bind(null,o,ln,Mr),a);break}Xi(o,ln,Mr);break;case 4:if(oi(o,p),(p&4194240)===p)break;for(a=o.eventTimes,v=-1;0<p;){var L=31-Wn(p);E=1<<L,L=a[L],L>v&&(v=L),p&=~E}if(p=v,p=Ct()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*A6(p/1960))-p,10<p){o.timeoutHandle=U(Xi.bind(null,o,ln,Mr),p);break}Xi(o,ln,Mr);break;case 5:Xi(o,ln,Mr);break;default:throw Error(l(329))}}}return un(o,Ct()),o.callbackNode===d?em.bind(null,o):null}function Kf(o,a){var d=Jo;return o.current.memoizedState.isDehydrated&&(Hi(o,a).flags|=256),o=ou(o,a),o!==2&&(a=ln,ln=d,a!==null&&Qf(a)),o}function Qf(o){ln===null?ln=o:ln.push.apply(ln,o)}function M6(o){for(var a=o;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var p=0;p<d.length;p++){var v=d[p],E=v.getSnapshot;v=v.value;try{if(!$n(E(),v))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function oi(o,a){for(a&=~Wf,a&=~eu,o.suspendedLanes|=a,o.pingedLanes&=~a,o=o.expirationTimes;0<a;){var d=31-Wn(a),p=1<<d;o[d]=-1,a&=~p}}function tm(o){if(Ne&6)throw Error(l(327));Yi();var a=kl(o,0);if(!(a&1))return un(o,Ct()),null;var d=ou(o,a);if(o.tag!==0&&d===2){var p=Xd(o);p!==0&&(a=p,d=Kf(o,p))}if(d===1)throw d=qo,Hi(o,0),oi(o,a),un(o,Ct()),d;if(d===6)throw Error(l(345));return o.finishedWork=o.current.alternate,o.finishedLanes=a,Xi(o,ln,Mr),un(o,Ct()),null}function nm(o){ii!==null&&ii.tag===0&&!(Ne&6)&&Yi();var a=Ne;Ne|=1;var d=ft.transition,p=Oe;try{if(ft.transition=null,Oe=1,o)return o()}finally{Oe=p,ft.transition=d,Ne=a,!(Ne&6)&&cr()}}function Zf(){xn=Os.current,Ye(Os)}function Hi(o,a){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==ae&&(o.timeoutHandle=ae,te(d)),gt!==null)for(d=gt.return;d!==null;){var p=d;switch(tf(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&xl();break;case 3:Ls(),Ye(sn),Ye(zt),gf();break;case 5:hf(p);break;case 4:Ls();break;case 13:Ye(nt);break;case 19:Ye(nt);break;case 10:lf(p.type._context);break;case 22:case 23:Zf()}d=d.return}if(Et=o,gt=o=ai(o.current,null),It=xn=a,vt=0,qo=null,Wf=eu=$i=0,ln=Jo=null,Vi!==null){for(a=0;a<Vi.length;a++)if(d=Vi[a],p=d.interleaved,p!==null){d.interleaved=null;var v=p.next,E=d.pending;if(E!==null){var L=E.next;E.next=v,p.next=L}d.pending=p}Vi=null}return o}function rm(o,a){do{var d=gt;try{if(af(),jl.current=Bl,Ol){for(var p=rt.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}Ol=!1}if(Wi=0,bt=yt=rt=null,Vo=!1,Wo=0,Vf.current=null,d===null||d.return===null){vt=1,qo=a,gt=null;break}e:{var E=o,L=d.return,X=d,J=a;if(a=It,X.flags|=32768,J!==null&&typeof J=="object"&&typeof J.then=="function"){var re=J,ge=X,Ce=ge.tag;if(!(ge.mode&1)&&(Ce===0||Ce===11||Ce===15)){var le=ge.alternate;le?(ge.updateQueue=le.updateQueue,ge.memoizedState=le.memoizedState,ge.lanes=le.lanes):(ge.updateQueue=null,ge.memoizedState=null)}var Ke=P1(L);if(Ke!==null){Ke.flags&=-257,N1(Ke,L,X,E,a),Ke.mode&1&&E1(E,re,a),a=Ke,J=re;var Ve=a.updateQueue;if(Ve===null){var cn=new Set;cn.add(J),a.updateQueue=cn}else Ve.add(J);break e}else{if(!(a&1)){E1(E,re,a),qf();break e}J=Error(l(426))}}else if(qe&&X.mode&1){var Rr=P1(L);if(Rr!==null){!(Rr.flags&65536)&&(Rr.flags|=256),N1(Rr,L,X,E,a),sf(Fs(J,X));break e}}E=J=Fs(J,X),vt!==4&&(vt=2),Jo===null?Jo=[E]:Jo.push(E),E=L;do{switch(E.tag){case 3:E.flags|=65536,a&=-a,E.lanes|=a;var Z=C1(E,J,a);qg(E,Z);break e;case 1:X=J;var Y=E.type,ee=E.stateNode;if(!(E.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&(ri===null||!ri.has(ee)))){E.flags|=65536,a&=-a,E.lanes|=a;var ce=b1(E,X,a);qg(E,ce);break e}}E=E.return}while(E!==null)}om(d)}catch(me){a=me,gt===d&&d!==null&&(gt=d=d.return);continue}break}while(1)}function im(){var o=Jl.current;return Jl.current=Bl,o===null?Bl:o}function qf(){(vt===0||vt===3||vt===2)&&(vt=4),Et===null||!($i&268435455)&&!(eu&268435455)||oi(Et,It)}function ou(o,a){var d=Ne;Ne|=2;var p=im();(Et!==o||It!==a)&&(Mr=null,Hi(o,a));do try{R6();break}catch(v){rm(o,v)}while(1);if(af(),Ne=d,Jl.current=p,gt!==null)throw Error(l(261));return Et=null,It=0,vt}function R6(){for(;gt!==null;)sm(gt)}function I6(){for(;gt!==null&&!s6();)sm(gt)}function sm(o){var a=um(o.alternate,o,xn);o.memoizedProps=o.pendingProps,a===null?om(o):gt=a,Vf.current=null}function om(o){var a=o;do{var d=a.alternate;if(o=a.return,a.flags&32768){if(d=b6(d,a),d!==null){d.flags&=32767,gt=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{vt=6,gt=null;return}}else if(d=C6(d,a,xn),d!==null){gt=d;return}if(a=a.sibling,a!==null){gt=a;return}gt=a=o}while(a!==null);vt===0&&(vt=5)}function Xi(o,a,d){var p=Oe,v=ft.transition;try{ft.transition=null,Oe=1,L6(o,a,d,p)}finally{ft.transition=v,Oe=p}return null}function L6(o,a,d,p){do Yi();while(ii!==null);if(Ne&6)throw Error(l(327));d=o.finishedWork;var v=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(l(177));o.callbackNode=null,o.callbackPriority=0;var E=d.lanes|d.childLanes;if(i6(o,E),o===Et&&(gt=Et=null,It=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||nu||(nu=!0,cm(qd,function(){return Yi(),null})),E=(d.flags&15990)!==0,d.subtreeFlags&15990||E){E=ft.transition,ft.transition=null;var L=Oe;Oe=1;var X=Ne;Ne|=4,Vf.current=null,P6(o,d),Y1(d,o),W(o.containerInfo),o.current=d,N6(d),o6(),Ne=X,Oe=L,ft.transition=E}else o.current=d;if(nu&&(nu=!1,ii=o,ru=v),E=o.pendingLanes,E===0&&(ri=null),u6(d.stateNode),un(o,Ct()),a!==null)for(p=o.onRecoverableError,d=0;d<a.length;d++)v=a[d],p(v.value,{componentStack:v.stack,digest:v.digest});if(tu)throw tu=!1,o=Xf,Xf=null,o;return ru&1&&o.tag!==0&&Yi(),E=o.pendingLanes,E&1?o===Yf?ea++:(ea=0,Yf=o):ea=0,cr(),null}function Yi(){if(ii!==null){var o=Dg(ru),a=ft.transition,d=Oe;try{if(ft.transition=null,Oe=16>o?16:o,ii===null)var p=!1;else{if(o=ii,ii=null,ru=0,Ne&6)throw Error(l(331));var v=Ne;for(Ne|=4,fe=o.current;fe!==null;){var E=fe,L=E.child;if(fe.flags&16){var X=E.deletions;if(X!==null){for(var J=0;J<X.length;J++){var re=X[J];for(fe=re;fe!==null;){var ge=fe;switch(ge.tag){case 0:case 11:case 15:Qo(8,ge,E)}var Ce=ge.child;if(Ce!==null)Ce.return=ge,fe=Ce;else for(;fe!==null;){ge=fe;var le=ge.sibling,Ke=ge.return;if(W1(ge),ge===re){fe=null;break}if(le!==null){le.return=Ke,fe=le;break}fe=Ke}}}var Ve=E.alternate;if(Ve!==null){var cn=Ve.child;if(cn!==null){Ve.child=null;do{var Rr=cn.sibling;cn.sibling=null,cn=Rr}while(cn!==null)}}fe=E}}if(E.subtreeFlags&2064&&L!==null)L.return=E,fe=L;else e:for(;fe!==null;){if(E=fe,E.flags&2048)switch(E.tag){case 0:case 11:case 15:Qo(9,E,E.return)}var Z=E.sibling;if(Z!==null){Z.return=E.return,fe=Z;break e}fe=E.return}}var Y=o.current;for(fe=Y;fe!==null;){L=fe;var ee=L.child;if(L.subtreeFlags&2064&&ee!==null)ee.return=L,fe=ee;else e:for(L=Y;fe!==null;){if(X=fe,X.flags&2048)try{switch(X.tag){case 0:case 11:case 15:Xl(9,X)}}catch(me){Je(X,X.return,me)}if(X===L){fe=null;break e}var ce=X.sibling;if(ce!==null){ce.return=X.return,fe=ce;break e}fe=X.return}}if(Ne=v,cr(),ur&&typeof ur.onPostCommitFiberRoot=="function")try{ur.onPostCommitFiberRoot(Tl,o)}catch{}p=!0}return p}finally{Oe=d,ft.transition=a}}return!1}function am(o,a,d){a=Fs(d,a),a=C1(o,a,1),o=ni(o,a,1),a=Vt(),o!==null&&(Do(o,1,a),un(o,a))}function Je(o,a,d){if(o.tag===3)am(o,o,d);else for(;a!==null;){if(a.tag===3){am(a,o,d);break}else if(a.tag===1){var p=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ri===null||!ri.has(p))){o=Fs(d,o),o=b1(a,o,1),a=ni(a,o,1),o=Vt(),a!==null&&(Do(a,1,o),un(a,o));break}}a=a.return}}function F6(o,a,d){var p=o.pingCache;p!==null&&p.delete(a),a=Vt(),o.pingedLanes|=o.suspendedLanes&d,Et===o&&(It&d)===d&&(vt===4||vt===3&&(It&130023424)===It&&500>Ct()-$f?Hi(o,0):Wf|=d),un(o,a)}function lm(o,a){a===0&&(o.mode&1?(a=Sl,Sl<<=1,!(Sl&130023424)&&(Sl=4194304)):a=1);var d=Vt();o=dr(o,a),o!==null&&(Do(o,a,d),un(o,d))}function j6(o){var a=o.memoizedState,d=0;a!==null&&(d=a.retryLane),lm(o,d)}function O6(o,a){var d=0;switch(o.tag){case 13:var p=o.stateNode,v=o.memoizedState;v!==null&&(d=v.retryLane);break;case 19:p=o.stateNode;break;default:throw Error(l(314))}p!==null&&p.delete(a),lm(o,d)}var um;um=function(o,a,d){if(o!==null)if(o.memoizedProps!==a.pendingProps||sn.current)an=!0;else{if(!(o.lanes&d)&&!(a.flags&128))return an=!1,T6(o,a,d);an=!!(o.flags&131072)}else an=!1,qe&&a.flags&1048576&&Ug(a,El,a.index);switch(a.lanes=0,a.tag){case 2:var p=a.type;Vl(o,a),o=a.pendingProps;var v=bs(a,zt.current);Rs(a,d),v=vf(null,a,p,o,v,d);var E=xf();return a.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,on(p)?(E=!0,wl(a)):E=!1,a.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,df(a),v.updater=Ul,a.stateNode=v,v._reactInternals=a,Cf(a,p,o,d),a=Nf(null,a,p,!0,E,d)):(a.tag=0,qe&&E&&ef(a),Zt(null,a,v,d),a=a.child),a;case 16:p=a.elementType;e:{switch(Vl(o,a),o=a.pendingProps,v=p._init,p=v(p._payload),a.type=p,v=a.tag=z6(p),o=Xn(p,o),v){case 0:a=Pf(null,a,p,o,d);break e;case 1:a=F1(null,a,p,o,d);break e;case 11:a=A1(null,a,p,o,d);break e;case 14:a=M1(null,a,p,Xn(p.type,o),d);break e}throw Error(l(306,p,""))}return a;case 0:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Xn(p,v),Pf(o,a,p,v,d);case 1:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Xn(p,v),F1(o,a,p,v,d);case 3:e:{if(j1(a),o===null)throw Error(l(387));p=a.pendingProps,E=a.memoizedState,v=E.element,Zg(o,a),Ll(a,p,null,d);var L=a.memoizedState;if(p=L.element,ie&&E.isDehydrated)if(E={element:p,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){v=Fs(Error(l(423)),a),a=O1(o,a,p,d,v);break e}else if(p!==v){v=Fs(Error(l(424)),a),a=O1(o,a,p,d,v);break e}else for(ie&&(Pn=z4(a.stateNode.containerInfo),vn=a,qe=!0,Hn=null,zo=!1),d=Yg(a,null,p,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ns(),p===v){a=Ar(o,a,d);break e}Zt(o,a,p,d)}a=a.child}return a;case 5:return e1(a),o===null&&rf(a),p=a.type,v=a.pendingProps,E=o!==null?o.memoizedProps:null,L=v.children,we(p,v)?L=null:E!==null&&we(p,E)&&(a.flags|=32),L1(o,a),Zt(o,a,L,d),a.child;case 6:return o===null&&rf(a),null;case 13:return D1(o,a,d);case 4:return ff(a,a.stateNode.containerInfo),p=a.pendingProps,o===null?a.child=As(a,null,p,d):Zt(o,a,p,d),a.child;case 11:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Xn(p,v),A1(o,a,p,v,d);case 7:return Zt(o,a,a.pendingProps,d),a.child;case 8:return Zt(o,a,a.pendingProps.children,d),a.child;case 12:return Zt(o,a,a.pendingProps.children,d),a.child;case 10:e:{if(p=a.type._context,v=a.pendingProps,E=a.memoizedProps,L=v.value,Kg(a,p,L),E!==null)if($n(E.value,L)){if(E.children===v.children&&!sn.current){a=Ar(o,a,d);break e}}else for(E=a.child,E!==null&&(E.return=a);E!==null;){var X=E.dependencies;if(X!==null){L=E.child;for(var J=X.firstContext;J!==null;){if(J.context===p){if(E.tag===1){J=Nr(-1,d&-d),J.tag=2;var re=E.updateQueue;if(re!==null){re=re.shared;var ge=re.pending;ge===null?J.next=J:(J.next=ge.next,ge.next=J),re.pending=J}}E.lanes|=d,J=E.alternate,J!==null&&(J.lanes|=d),uf(E.return,d,a),X.lanes|=d;break}J=J.next}}else if(E.tag===10)L=E.type===a.type?null:E.child;else if(E.tag===18){if(L=E.return,L===null)throw Error(l(341));L.lanes|=d,X=L.alternate,X!==null&&(X.lanes|=d),uf(L,d,a),L=E.sibling}else L=E.child;if(L!==null)L.return=E;else for(L=E;L!==null;){if(L===a){L=null;break}if(E=L.sibling,E!==null){E.return=L.return,L=E;break}L=L.return}E=L}Zt(o,a,v.children,d),a=a.child}return a;case 9:return v=a.type,p=a.pendingProps.children,Rs(a,d),v=Nn(v),p=p(v),a.flags|=1,Zt(o,a,p,d),a.child;case 14:return p=a.type,v=Xn(p,a.pendingProps),v=Xn(p.type,v),M1(o,a,p,v,d);case 15:return R1(o,a,a.type,a.pendingProps,d);case 17:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Xn(p,v),Vl(o,a),a.tag=1,on(p)?(o=!0,wl(a)):o=!1,Rs(a,d),k1(a,p,v),Cf(a,p,v,d),Nf(null,a,p,!0,o,d);case 19:return B1(o,a,d);case 22:return I1(o,a,d)}throw Error(l(156,a.tag))};function cm(o,a){return Qd(o,a)}function D6(o,a,d,p){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(o,a,d,p){return new D6(o,a,d,p)}function Jf(o){return o=o.prototype,!(!o||!o.isReactComponent)}function z6(o){if(typeof o=="function")return Jf(o)?1:0;if(o!=null){if(o=o.$$typeof,o===T)return 11;if(o===C)return 14}return 2}function ai(o,a){var d=o.alternate;return d===null?(d=In(o.tag,a,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=a,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,a=o.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function au(o,a,d,p,v,E){var L=2;if(p=o,typeof o=="function")Jf(o)&&(L=1);else if(typeof o=="string")L=5;else e:switch(o){case h:return Ki(d.children,v,E,a);case m:L=8,v|=8;break;case x:return o=In(12,d,a,v|2),o.elementType=x,o.lanes=E,o;case k:return o=In(13,d,a,v),o.elementType=k,o.lanes=E,o;case _:return o=In(19,d,a,v),o.elementType=_,o.lanes=E,o;case S:return lu(d,v,E,a);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case y:L=10;break e;case w:L=9;break e;case T:L=11;break e;case C:L=14;break e;case g:L=16,p=null;break e}throw Error(l(130,o==null?o:typeof o,""))}return a=In(L,d,a,v),a.elementType=o,a.type=p,a.lanes=E,a}function Ki(o,a,d,p){return o=In(7,o,p,a),o.lanes=d,o}function lu(o,a,d,p){return o=In(22,o,p,a),o.elementType=S,o.lanes=d,o.stateNode={isHidden:!1},o}function eh(o,a,d){return o=In(6,o,null,a),o.lanes=d,o}function th(o,a,d){return a=In(4,o.children!==null?o.children:[],o.key,a),a.lanes=d,a.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},a}function B6(o,a,d,p,v){this.tag=a,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ae,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yd(0),this.expirationTimes=Yd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yd(0),this.identifierPrefix=p,this.onRecoverableError=v,ie&&(this.mutableSourceEagerHydrationData=null)}function dm(o,a,d,p,v,E,L,X,J){return o=new B6(o,a,d,X,J),a===1?(a=1,E===!0&&(a|=8)):a=0,E=In(3,null,null,a),o.current=E,E.stateNode=o,E.memoizedState={element:p,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},df(E),o}function fm(o){if(!o)return ei;o=o._reactInternals;e:{if(F(o)!==o||o.tag!==1)throw Error(l(170));var a=o;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(on(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(l(171))}if(o.tag===1){var d=o.type;if(on(d))return Fg(o,d,a)}return a}function hm(o){var a=o._reactInternals;if(a===void 0)throw typeof o.render=="function"?Error(l(188)):(o=Object.keys(o).join(","),Error(l(268,o)));return o=z(a),o===null?null:o.stateNode}function pm(o,a){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<a?d:a}}function uu(o,a){pm(o,a),(o=o.alternate)&&pm(o,a)}function U6(o){return o=z(o),o===null?null:o.stateNode}function G6(){return null}return n.attemptContinuousHydration=function(o){if(o.tag===13){var a=dr(o,134217728);if(a!==null){var d=Vt();Rn(a,o,134217728,d)}uu(o,134217728)}},n.attemptDiscreteHydration=function(o){if(o.tag===13){var a=dr(o,1);if(a!==null){var d=Vt();Rn(a,o,1,d)}uu(o,1)}},n.attemptHydrationAtCurrentPriority=function(o){if(o.tag===13){var a=si(o),d=dr(o,a);if(d!==null){var p=Vt();Rn(d,o,a,p)}uu(o,a)}},n.attemptSynchronousHydration=function(o){switch(o.tag){case 3:var a=o.stateNode;if(a.current.memoizedState.isDehydrated){var d=Oo(a.pendingLanes);d!==0&&(Kd(a,d|1),un(a,Ct()),!(Ne&6)&&(Ds(),cr()))}break;case 13:nm(function(){var p=dr(o,1);if(p!==null){var v=Vt();Rn(p,o,1,v)}}),uu(o,1)}},n.batchedUpdates=function(o,a){var d=Ne;Ne|=1;try{return o(a)}finally{Ne=d,Ne===0&&(Ds(),Cl&&cr())}},n.createComponentSelector=function(o){return{$$typeof:Yl,value:o}},n.createContainer=function(o,a,d,p,v,E,L){return dm(o,a,!1,null,d,p,v,E,L)},n.createHasPseudoClassSelector=function(o){return{$$typeof:Kl,value:o}},n.createHydrationContainer=function(o,a,d,p,v,E,L,X,J){return o=dm(d,p,!0,o,v,E,L,X,J),o.context=fm(null),d=o.current,p=Vt(),v=si(d),E=Nr(p,v),E.callback=a??null,ni(d,E,v),o.current.lanes=v,Do(o,v,p),un(o,p),o},n.createPortal=function(o,a,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:p==null?null:""+p,children:o,containerInfo:a,implementation:d}},n.createRoleSelector=function(o){return{$$typeof:Ql,value:o}},n.createTestNameSelector=function(o){return{$$typeof:Zl,value:o}},n.createTextSelector=function(o){return{$$typeof:ql,value:o}},n.deferredUpdates=function(o){var a=Oe,d=ft.transition;try{return ft.transition=null,Oe=16,o()}finally{Oe=a,ft.transition=d}},n.discreteUpdates=function(o,a,d,p,v){var E=Oe,L=ft.transition;try{return ft.transition=null,Oe=1,o(a,d,p,v)}finally{Oe=E,ft.transition=L,Ne===0&&Ds()}},n.findAllNodes=Gf,n.findBoundingRects=function(o,a){if(!Tt)throw Error(l(363));a=Gf(o,a),o=[];for(var d=0;d<a.length;d++)o.push(_s(a[d]));for(a=o.length-1;0<a;a--){d=o[a];for(var p=d.x,v=p+d.width,E=d.y,L=E+d.height,X=a-1;0<=X;X--)if(a!==X){var J=o[X],re=J.x,ge=re+J.width,Ce=J.y,le=Ce+J.height;if(p>=re&&E>=Ce&&v<=ge&&L<=le){o.splice(a,1);break}else if(p!==re||d.width!==J.width||le<E||Ce>L){if(!(E!==Ce||d.height!==J.height||ge<p||re>v)){re>p&&(J.width+=re-p,J.x=p),ge<v&&(J.width=v-re),o.splice(a,1);break}}else{Ce>E&&(J.height+=Ce-E,J.y=E),le<L&&(J.height=L-Ce),o.splice(a,1);break}}}return o},n.findHostInstance=hm,n.findHostInstanceWithNoPortals=function(o){return o=R(o),o=o!==null?j(o):null,o===null?null:o.stateNode},n.findHostInstanceWithWarning=function(o){return hm(o)},n.flushControlled=function(o){var a=Ne;Ne|=1;var d=ft.transition,p=Oe;try{ft.transition=null,Oe=1,o()}finally{Oe=p,ft.transition=d,Ne=a,Ne===0&&(Ds(),cr())}},n.flushPassiveEffects=Yi,n.flushSync=nm,n.focusWithin=function(o,a){if(!Tt)throw Error(l(363));for(o=zf(o),a=J1(o,a),a=Array.from(a),o=0;o<a.length;){var d=a[o++];if(!lr(d)){if(d.tag===5&&Mt(d.stateNode))return!0;for(d=d.child;d!==null;)a.push(d),d=d.sibling}}return!1},n.getCurrentUpdatePriority=function(){return Oe},n.getFindAllNodesFailureDescription=function(o,a){if(!Tt)throw Error(l(363));var d=0,p=[];o=[zf(o),0];for(var v=0;v<o.length;){var E=o[v++],L=o[v++],X=a[L];if((E.tag!==5||!lr(E))&&(Bf(E,X)&&(p.push(Uf(X)),L++,L>d&&(d=L)),L<a.length))for(E=E.child;E!==null;)o.push(E,L),E=E.sibling}if(d<a.length){for(o=[];d<a.length;d++)o.push(Uf(a[d]));return`findAllNodes was able to match part of the selector:
  `+(p.join(" > ")+`

No matching component was found for:
  `)+o.join(" > ")}return null},n.getPublicRootInstance=function(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return G(o.child.stateNode);default:return o.child.stateNode}},n.injectIntoDevTools=function(o){if(o={bundleType:o.bundleType,version:o.version,rendererPackageName:o.rendererPackageName,rendererConfig:o.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:c.ReactCurrentDispatcher,findHostInstanceByFiber:U6,findFiberByHostInstance:o.findFiberByHostInstance||G6,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")o=!1;else{var a=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(a.isDisabled||!a.supportsFiber)o=!0;else{try{Tl=a.inject(o),ur=a}catch{}o=!!a.checkDCE}}return o},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(o,a,d,p){if(!Tt)throw Error(l(363));o=Gf(o,a);var v=Zr(o,d,p).disconnect;return{disconnect:function(){v()}}},n.registerMutableSourceForHydration=function(o,a){var d=a._getVersion;d=d(a._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[a,d]:o.mutableSourceEagerHydrationData.push(a,d)},n.runWithPriority=function(o,a){var d=Oe;try{return Oe=o,a()}finally{Oe=d}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(o,a,d,p){var v=a.current,E=Vt(),L=si(v);return d=fm(d),a.context===null?a.context=d:a.pendingContext=d,a=Nr(E,L),a.payload={element:o},p=p===void 0?null:p,p!==null&&(a.callback=p),o=ni(v,a,L),o!==null&&(Rn(o,v,L,E),Il(o,v,L)),L},n};c4.exports=LC;var FC=c4.exports;const jC=il(FC);var d4={exports:{}},ws={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */ws.ConcurrentRoot=1;ws.ContinuousEventPriority=4;ws.DefaultEventPriority=16;ws.DiscreteEventPriority=1;ws.IdleEventPriority=536870912;ws.LegacyRoot=0;d4.exports=ws;var f4=d4.exports;const R2={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let I2=!1,L2=!1;const kg=".react-konva-event",OC=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,DC=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,zC={};function zd(t,e,n=zC){if(!I2&&"zIndex"in e&&(console.warn(DC),I2=!0),!L2&&e.draggable){var r=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;r&&!i&&(console.warn(OC),L2=!0)}for(var s in n)if(!R2[s]){var l=s.slice(0,2)==="on",c=n[s]!==e[s];if(l&&c){var u=s.substr(2).toLowerCase();u.substr(0,7)==="content"&&(u="content"+u.substr(7,1).toUpperCase()+u.substr(8)),t.off(u,n[s])}var f=!e.hasOwnProperty(s);f&&t.setAttr(s,void 0)}var h=e._useStrictMode,m={},x=!1;const y={};for(var s in e)if(!R2[s]){var l=s.slice(0,2)==="on",w=n[s]!==e[s];if(l&&w){var u=s.substr(2).toLowerCase();u.substr(0,7)==="content"&&(u="content"+u.substr(7,1).toUpperCase()+u.substr(8)),e[s]&&(y[u]=e[s])}!l&&(e[s]!==n[s]||h&&e[s]!==t.getAttr(s))&&(x=!0,m[s]=e[s])}x&&(t.setAttrs(m),zi(t));for(var u in y)t.on(u+kg,y[u])}function zi(t){if(!Pe.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}const h4={},BC={};nl.Node.prototype._applyProps=zd;function UC(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),zi(t)}function GC(t,e,n){let r=nl[t];r||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),r=nl.Group);const i={},s={};for(var l in e){var c=l.slice(0,2)==="on";c?s[l]=e[l]:i[l]=e[l]}const u=new r(i);return zd(u,s),u}function VC(t,e,n){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function WC(t,e,n){return!1}function $C(t){return t}function HC(){return null}function XC(){return null}function YC(t,e,n,r){return BC}function KC(){}function QC(t){}function ZC(t,e){return!1}function qC(){return h4}function JC(){return h4}const eb=setTimeout,tb=clearTimeout,nb=-1;function rb(t,e){return!1}const ib=!1,sb=!0,ob=!0;function ab(t,e){e.parent===t?e.moveToTop():t.add(e),zi(t)}function lb(t,e){e.parent===t?e.moveToTop():t.add(e),zi(t)}function p4(t,e,n){e._remove(),t.add(e),e.setZIndex(n.getZIndex()),zi(t)}function ub(t,e,n){p4(t,e,n)}function cb(t,e){e.destroy(),e.off(kg),zi(t)}function db(t,e){e.destroy(),e.off(kg),zi(t)}function fb(t,e,n){console.error(`Text components are not yet supported in ReactKonva. You text is: "${n}"`)}function hb(t,e,n){}function pb(t,e,n,r,i){zd(t,i,r)}function gb(t){t.hide(),zi(t)}function mb(t){}function yb(t,e){(e.visible==null||e.visible)&&t.show()}function vb(t,e){}function xb(t){}function wb(){}const _b=()=>f4.DefaultEventPriority,Sb=Object.freeze(Object.defineProperty({__proto__:null,appendChild:ab,appendChildToContainer:lb,appendInitialChild:UC,cancelTimeout:tb,clearContainer:xb,commitMount:hb,commitTextUpdate:fb,commitUpdate:pb,createInstance:GC,createTextInstance:VC,detachDeletedInstance:wb,finalizeInitialChildren:WC,getChildHostContext:JC,getCurrentEventPriority:_b,getPublicInstance:$C,getRootHostContext:qC,hideInstance:gb,hideTextInstance:mb,idlePriority:Sa.unstable_IdlePriority,insertBefore:p4,insertInContainerBefore:ub,isPrimaryRenderer:ib,noTimeout:nb,now:Sa.unstable_now,prepareForCommit:HC,preparePortalMount:XC,prepareUpdate:YC,removeChild:cb,removeChildFromContainer:db,resetAfterCommit:KC,resetTextContent:QC,run:Sa.unstable_runWithPriority,scheduleTimeout:eb,shouldDeprioritizeSubtree:ZC,shouldSetTextContent:rb,supportsMutation:ob,unhideInstance:yb,unhideTextInstance:vb,warnsIfNotActing:sb},Symbol.toStringTag,{value:"Module"}));var kb=Object.defineProperty,Tb=Object.defineProperties,Cb=Object.getOwnPropertyDescriptors,F2=Object.getOwnPropertySymbols,bb=Object.prototype.hasOwnProperty,Eb=Object.prototype.propertyIsEnumerable,j2=(t,e,n)=>e in t?kb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,O2=(t,e)=>{for(var n in e||(e={}))bb.call(e,n)&&j2(t,n,e[n]);if(F2)for(var n of F2(e))Eb.call(e,n)&&j2(t,n,e[n]);return t},Pb=(t,e)=>Tb(t,Cb(e)),D2,z2;typeof window<"u"&&((D2=window.document)!=null&&D2.createElement||((z2=window.navigator)==null?void 0:z2.product)==="ReactNative")?B.useLayoutEffect:B.useEffect;function g4(t,e,n){if(!t)return;if(n(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const i=g4(r,e,n);if(i)return i;r=e?null:r.sibling}}function m4(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const B2=console.error;console.error=function(){const t=[...arguments].join("");if(t!=null&&t.startsWith("Warning:")&&t.includes("useContext")){console.error=B2;return}return B2.apply(this,arguments)};const Tg=m4(B.createContext(null));class y4 extends B.Component{render(){return B.createElement(Tg.Provider,{value:this._reactInternals},this.props.children)}}function Nb(){const t=B.useContext(Tg);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=B.useId();return B.useMemo(()=>{for(const r of[t,t==null?void 0:t.alternate]){if(!r)continue;const i=g4(r,!1,s=>{let l=s.memoizedState;for(;l;){if(l.memoizedState===e)return!0;l=l.next}});if(i)return i}},[t,e])}function Ab(){const t=Nb(),[e]=B.useState(()=>new Map);e.clear();let n=t;for(;n;){if(n.type&&typeof n.type=="object"){const i=n.type._context===void 0&&n.type.Provider===n.type?n.type:n.type._context;i&&i!==Tg&&!e.has(i)&&e.set(i,B.useContext(m4(i)))}n=n.return}return e}function Mb(){const t=Ab();return B.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>B.createElement(e,null,B.createElement(n.Provider,Pb(O2({},r),{value:t.get(n)}))),e=>B.createElement(y4,O2({},e))),[t])}function Rb(t){const e=Ht.useRef({});return Ht.useLayoutEffect(()=>{e.current=t}),Ht.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const Ib=t=>{const e=Ht.useRef(),n=Ht.useRef(),r=Ht.useRef(),i=Rb(t),s=Mb(),l=c=>{const{forwardedRef:u}=t;u&&(typeof u=="function"?u(c):u.current=c)};return Ht.useLayoutEffect(()=>(n.current=new nl.Stage({width:t.width,height:t.height,container:e.current}),l(n.current),r.current=_a.createContainer(n.current,f4.LegacyRoot,!1,null),_a.updateContainer(Ht.createElement(s,{},t.children),r.current),()=>{nl.isBrowser&&(l(null),_a.updateContainer(null,r.current,null),n.current.destroy())}),[]),Ht.useLayoutEffect(()=>{l(n.current),zd(n.current,t,i),_a.updateContainer(Ht.createElement(s,{},t.children),r.current,null)}),Ht.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},Ac="Layer",Bd="Group",Mc="Rect",rl="Circle",up="Line",Dn="Text",Lb="Arrow",_a=jC(Sb);_a.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:Ht.version,rendererPackageName:"react-konva"});const Fb=Ht.forwardRef((t,e)=>Ht.createElement(y4,{},Ht.createElement(Ib,{...t,forwardedRef:e}))),v4=()=>{const{elements:t,setElements:e,arcStart:n,setArcStart:r,setTempArcEnd:i,setSelectedElement:s,snapToGrid:l,gridSnappingEnabled:c}=en(),u=B.useCallback((x,y)=>{if(x.id===y.id)return;if(x.type===y.type){console.warn("Invalid arc: Cannot connect elements of the same type."),r(null),i(null),s(null);return}const w={id:co(),source:x.id,target:y.id,weight:1,anglePoints:[],sourceType:x.type,targetType:y.type};e(T=>({...T,arcs:[...T.arcs,w]})),r(null),i(null),s(null)},[e,r,i,s]),f=B.useCallback((x,y)=>{e(w=>{const T=w.arcs.map(k=>{if(k.id===x){const _=c?l(y.x,y.y):y,C=k.anglePoints?[...k.anglePoints]:[];return C.push(_),{...k,anglePoints:C}}return k});return{...w,arcs:T}})},[e,c,l]),h=B.useCallback((x,y,w)=>{e(T=>{const k=T.arcs.map(_=>{if(_.id===x&&_.anglePoints&&_.anglePoints[y]){const C=c?l(w.x,w.y):w,g=[..._.anglePoints];return g[y]=C,{..._,anglePoints:g}}return _});return{...T,arcs:k}})},[e,c,l]),m=B.useCallback((x,y)=>{e(w=>{const T=w.arcs.map(k=>{if(k.id===x&&k.anglePoints&&k.anglePoints[y]){const _=[...k.anglePoints];return _.splice(y,1),{...k,anglePoints:_}}return k});return{...w,arcs:T}})},[e]);return{handleCompleteArc:u,handleAddAnglePoint:f,handleDragAnglePoint:h,handleDeleteAnglePoint:m}};function U2(t,e){if(!t||!e)return!1;const n=Math.min(e.x,e.x+e.w),r=Math.min(e.y,e.y+e.h),i=Math.max(e.x,e.x+e.w),s=Math.max(e.y,e.y+e.h);return t.x>=n&&t.x<=i&&t.y>=r&&t.y<=s}function G2(t,e){if(!t||!e)return[];const n=[];return(t.places||[]).forEach(r=>{U2({x:r.x,y:r.y},e)&&n.push({id:r.id,type:"place"})}),(t.transitions||[]).forEach(r=>{U2({x:r.x,y:r.y},e)&&n.push({id:r.id,type:"transition"})}),n}function jb(t,e){return t.some(r=>r.id===e.id&&r.type===e.type)?t.filter(r=>!(r.id===e.id&&r.type===e.type)):[...t,e]}function x4(t,e,n,r={}){if(!e||!e.startPositions)return t;const{dx:i,dy:s}=n||{dx:0,dy:0},{gridSnappingEnabled:l=!1,snapToGrid:c=(f,h)=>({x:f,y:h})}=r,u={...t};return u.places=(t.places||[]).map(f=>{const h=e.startPositions.get(f.id);if(!h||h.type!=="place")return f;const m=h.x+i,x=h.y+s,y=l?c(m,x):{x:m,y:x};return{...f,x:y.x,y:y.y}}),u.transitions=(t.transitions||[]).map(f=>{const h=e.startPositions.get(f.id);if(!h||h.type!=="transition")return f;const m=h.x+i,x=h.y+s,y=l?c(m,x):{x:m,y:x};return{...f,x:y.x,y:y.y}}),e.startArcPoints&&(u.arcs=(t.arcs||[]).map(f=>{const h=e.startArcPoints.get(f.id);if(!h)return f;const m=h.map(x=>({x:x.x+i,y:x.y+s}));return{...f,anglePoints:m}})),u}const Cg=()=>{var A,F;const{gridSnappingEnabled:t}=Po(),{elements:e,setElements:n,selectedElement:r,setSelectedElement:i,selectedElements:s,setSelectedElements:l,isIdSelected:c,setSelection:u,mode:f,arcStart:h,setArcStart:m,tempArcEnd:x,setTempArcEnd:y,snapToGrid:w,isShiftPressedRef:T}=en(),{handleCompleteArc:k}=v4(),_=B.useCallback(()=>{if(!r)return;const{type:M,id:R}=r;let z=JSON.parse(JSON.stringify(e));M==="place"?(z.places=z.places.filter(V=>V.id!==R),z.arcs=z.arcs.filter(V=>V.source!==R&&V.target!==R)):M==="transition"?(z.transitions=z.transitions.filter(V=>V.id!==R),z.arcs=z.arcs.filter(V=>V.source!==R&&V.target!==R)):M==="arc"&&(z.arcs=z.arcs.filter(V=>V.id!==R)),n(z),i(null)},[r,e,n,i]),C=B.useCallback(()=>{n({places:[],transitions:[],arcs:[]}),i(null),m(null),y(null)},[n,i,m,y]),g=B.useCallback(M=>{var z,V;if(!M)return;let R=t?w(M.x,M.y):M;if(f==="place"){const j=((z=e==null?void 0:e.places)==null?void 0:z.length)||0,D={id:co(),x:R.x,y:R.y,label:`P${j+1}`,tokens:0};n(G=>({...G,places:[...(G==null?void 0:G.places)||[],D]}))}else if(f==="transition"){const j=((V=e==null?void 0:e.transitions)==null?void 0:V.length)||0,D={id:co(),x:R.x,y:R.y,label:`T${j+1}`};n(G=>({...G,transitions:[...(G==null?void 0:G.transitions)||[],D]}))}},[f,(A=e==null?void 0:e.places)==null?void 0:A.length,(F=e==null?void 0:e.transitions)==null?void 0:F.length,n,w,t]),S=B.useCallback((M,R,z)=>{var G,H;let V=null,j=null,D=null;typeof z<"u"?(V=M,j=R,D=z):(j=M,D=R),f==="select"||f==="arc_angle"?(!!(V&&((G=V.evt)!=null&&G.shiftKey||(H=V.evt)!=null&&H.getModifierState&&V.evt.getModifierState("Shift")))||!!(T&&T.current)?(l($=>jb($,{id:j.id,type:D})),i({...j,type:D})):u([{id:j.id,type:D}]),m(null),y(null)):f==="arc"&&(h?k(h.element,{...j,type:D}):(i({...j,type:D}),m({element:{id:j.id,type:D},point:{x:j.x,y:j.y}}),y({sourcePoint:{x:j.x,y:j.y},x:j.x,y:j.y,potentialTarget:null})))},[f,h,i,l,c,u,m,y,k]),b=B.useCallback((M,R,z)=>{const V=t?w(z.x,z.y):z;n(j=>{const D={...j};return R==="place"?D.places=j.places.map(G=>G.id===M.id?{...G,x:V.x,y:V.y}:G):R==="transition"&&(D.transitions=j.transitions.map(G=>G.id===M.id?{...G,x:V.x,y:V.y}:G)),D})},[n,t,w]),N=B.useCallback(M=>w5(e,M),[e]),I=B.useCallback((M,R={x:40,y:40})=>{if(!M)return null;const{newPlaces:z,newTransitions:V,newArcs:j,newSelection:D}=_5(M,co,R);return n(G=>({...G,places:[...G.places,...z],transitions:[...G.transitions,...V],arcs:[...G.arcs,...j]})),D},[n]);return{handleDeleteElement:_,clearAllElements:C,handleCreateElement:g,handleElementClick:S,handleElementDragEnd:b,collectClipboard:N,pasteClipboard:I}},Ob=30,Db=4,zb=4,bg=4,tr=2,Bb=12,cp=10,Ub=10,Eg=.48,Qh=.25,Gb={},w4=new WeakMap;function Lu(t,e,n){return w4.set(t,{baseRadius:e,visuals:n}),n}function Vb(t,e,n=2){const r=t.x+t.width,i=t.y+t.height,s=e.x+e.width,l=e.y+e.height;return!(r+n<=e.x||s+n<=t.x||i+n<=e.y||l+n<=t.y)}function Wb(t){if(t<=0)return[];const e=[[t]];if(t>=4){const n=Math.min(6,t-1);for(let r=n;r>=Math.ceil(t/2);r-=1){const i=t-r;i>=1&&e.push([r,i])}}if(t>=7){const n=Math.min(6,t-3),r=Math.max(2,Math.ceil((t-n)/2)),i=t-n-r;i>0&&e.push([n,r,i])}return e}function $b(t,e,n){const r=[...e].sort((l,c)=>n[c].width-n[l].width),i=[];let s=0;for(let l=0;l<t.length;l+=1){const c=t[l],u=r.slice(s,s+c);if(u.length<c)return null;i.push(u),s+=c}return i}function Hb(t,e,n,r,i){const s=t.length;if(s===0)return[];const l=new Array(s),c=t[0],u=Math.max(...c.map(k=>e[k].diagonal),r);let f=n-u-tr;if(f<=0)return null;const h=i?i+r+tr:r+tr;if(s===1)return l[0]=Math.max(f,h),l;const m=t[s-1],x=Math.max(...m.map(k=>e[k].diagonal),r),y=Math.max(h,x+tr),w=f-y,T=Math.max(r+tr,w/s);l[0]=f;for(let k=1;k<s;k+=1){const C=l[k-1]-T,g=t[k],S=Math.max(...g.map(N=>e[N].diagonal),r),b=Math.max(S+tr,h);if(l[k]=Math.max(C,b),l[k]<=0)return null}return l[s-1]<y&&(l[s-1]=y),l}function Zu(t,e,n){if(!t||t.length===0)return e;let r=0;t.forEach(s=>{const l=s.x+s.width/2,c=s.y+s.height/2,u=Math.hypot(s.width/2,s.height/2),f=Math.hypot(l,c)+u+bg;f>r&&(r=f)});const i=Math.ceil(r);return i>n&&n>=e?n:Math.max(e,i)}function qu(t){return typeof t=="boolean"?t?"T":"F":typeof t=="string"?`'${t}'`:Array.isArray(t)?`[${t.map(qu).join(", ")}]`:t&&typeof t=="object"&&t.__pair__?`(${qu(t.fst)}, ${qu(t.snd)})`:String(t)}function _4(t,e){return t.length?Math.max(e,t.length*e*Eg):e}function Xb(t,e,n){const r=t.length;if(r===0)return null;const i=e-bg;if(i<=0)return null;const s=i*2,l=[];for(let u=1;u<=r;u+=1){const f=Math.ceil(r/u);u===1&&r>4||f===1&&r>4||l.push({cols:u,rows:f})}l.sort((u,f)=>{const h=Math.abs(u.cols-u.rows)-Math.abs(f.cols-f.rows);return h!==0?h:u.cols-f.cols});const c=Math.max(...t.map(u=>u.length||1),1);for(const u of l){const f=u.cols,h=u.rows,m=s-tr*(f-1),x=s-tr*(h-1);if(m<=0||x<=0)continue;const y=m/f,w=x/h,T=w*.8,k=y/(c*Eg||1),_=Math.min(Bb,T,k);if(_<cp)continue;const C=[];let g=!0;const S=y+tr,b=w+tr,N=S*(f-1),I=b*(h-1),A=-N/2,F=-I/2;if(t.forEach((M,R)=>{if(!g)return;const z=Math.floor(R/f),V=R%f,j=r-z*f,D=z===h-1?Math.min(j,f):f,H=A+(f-D)*S/2+V*S,O=F+z*b,W=_4(M,_)/2,K=_/2,Q=Math.hypot(W,K);if(Math.hypot(H,O)+Q>i){g=!1;return}C.push({key:`token-${R}`,text:M,fontSize:_,x:H-y/2,y:O-_/2,width:y,height:_})}),g)return{radius:Zu(C,n,e),layout:C}}return null}function Yb(t,e,n){const r=t.length;if(r===0)return{layout:[],radius:n};const i=e-bg;if(i<=0)return null;const s=Math.max(...t.map(f=>f.length||1),1),l=Math.max(cp,Math.min(12,i*2/(s*Eg))),c=t.map((f,h)=>h),u=f=>{const h=c.map(_=>{const C=_4(t[_],f);return{width:C,halfWidth:C/2,halfHeight:f/2,diagonal:Math.hypot(C/2,f/2)}});if(r===1){const _=h[0];if(_.diagonal>i)return null;const C=_.width*(1+Qh),g=[{key:"token-0",text:t[0],fontSize:f,x:-C/2,y:-_.halfHeight,width:C,height:f}];return{layout:g,radius:Zu(g,n,e)}}let m=null,x=0;if(r%2===1&&r>1){const C=[...c].sort((A,F)=>h[F].width-h[A].width)[0],g=h[C].diagonal,S=c.filter(A=>A!==C),b=S.length?Math.max(...S.map(A=>h[A].diagonal)):0,N=g+f*.5;i-b-2>=N&&(m=C,x=g)}const y=new Array(r);if(m!==null){const _=h[m];if(_.diagonal>i)return null;const C=_.width*(1+Qh);y[m]={key:`token-${m}`,text:t[m],fontSize:f,x:-C/2,y:-_.halfHeight,width:C,height:f}}const w=c.filter(_=>_!==m);if(w.length===0){const _=y.filter(Boolean);return{layout:_,radius:Zu(_,n,e)}}const T=y.slice(),k=Wb(w.length);for(const _ of k){const C=$b(_,w,h);if(!C)continue;const g=Hb(C,h,i,f,x);if(!g)continue;const S=T.slice();let b=!0;if(C.forEach((A,F)=>{const M=g[F],R=A.length;if(!R)return;const z=F%2===1?Math.PI/R:0;A.forEach((V,j)=>{if(!b)return;const D=h[V],G=D.width*(1+Qh),H=G/2,O=-Math.PI/2+2*Math.PI*j/R+z,$=Math.cos(O)*M,W=Math.sin(O)*M;if(Math.hypot($,W)+D.diagonal>i+tr){b=!1;return}S[V]={key:`token-${V}`,text:t[V],fontSize:f,x:$-H,y:W-D.halfHeight,width:G,height:f}})}),!b)continue;const N=S.filter(Boolean);if(N.length!==r)continue;let I=!1;for(let A=0;A<N.length;A+=1){for(let F=A+1;F<N.length;F+=1)if(Vb(N[A],N[F])){I=!0;break}if(I)break}if(!I){const A=Zu(N,n,e);return{layout:N,radius:A}}}return null};for(let f=l;f>=cp;f-=.5){const h=u(f);if(h&&h.layout&&h.layout.length===r)return h}return null}function S4(t,e=Ob){var c;const n=Array.isArray(t)?t:Gb,r=w4.get(n);if(r&&r.baseRadius===e)return r.visuals;const i=Array.isArray(t)?t:[];if(i.length===0)return Lu(n,e,{radius:e,tokens:[],indicator:null});const s=i.map(qu),l=e*Db;for(let u=e;u<=l;u+=zb){if(s.length<=Ub){const h=Yb(s,u,e);if(h&&((c=h.layout)==null?void 0:c.length)===s.length){const m=Math.max(e,Math.min(h.radius,u));return Lu(n,e,{radius:m,tokens:h.layout,indicator:null})}}const f=Xb(s,u,e);if(f){const h=Math.max(e,Math.min(f.radius,u));return Lu(n,e,{radius:h,tokens:f.layout,indicator:null})}}return Lu(n,e,{radius:e,tokens:[],indicator:s.length})}const Kb=({id:t,x:e,y:n,label:r,tokens:i,valueTokens:s,isSelected:l,onSelect:c,onChange:u})=>{const{setIsDragging:f,snapToGrid:h,netMode:m,elements:x,selectedElements:y,setElements:w,multiDragRef:T,isIdSelected:k,mode:_,arcStart:C}=en(),{gridSnappingEnabled:g,setSnapIndicator:S}=Po(),b=30,N=B.useRef({pending:!1,rafId:null,delta:{dx:0,dy:0},lastApplied:{dx:0,dy:0}}),I=B.useCallback(()=>{const O=N.current;O.pending=!1,O.rafId=null,!(!T.current||!T.current.startPositions)&&w($=>{if(!T.current||!T.current.startPositions)return $;const W=T.current,K=x4($,W,O.delta,{gridSnappingEnabled:g,snapToGrid:h});return O.lastApplied={...O.delta},K})},[g,h,w,T]),A=B.useCallback(O=>{const $=N.current;if(!($.pending&&$.delta&&$.delta.dx===O.dx&&$.delta.dy===O.dy||!$.pending&&$.lastApplied&&$.lastApplied.dx===O.dx&&$.lastApplied.dy===O.dy)){if($.delta=O,typeof window>"u"||typeof window.requestAnimationFrame!="function"){I();return}$.pending||($.pending=!0,$.rafId=window.requestAnimationFrame(I))}},[I]),F=B.useCallback(()=>{const O=N.current;typeof window<"u"&&typeof window.cancelAnimationFrame=="function"&&O.rafId!==null&&window.cancelAnimationFrame(O.rafId),(O.pending||O.rafId!==null)&&I()},[I]),M=m==="algebraic-int"||Array.isArray(s),R=B.useMemo(()=>M?S4(s||[],b):{radius:b,tokens:[],indicator:null},[M,s]),z=M?R.radius:b,V=B.useCallback(O=>{const $=new Map;x.places.forEach(K=>{O.has(K.id)&&$.set(K.id,{type:"place",x:K.x,y:K.y})}),x.transitions.forEach(K=>{O.has(K.id)&&$.set(K.id,{type:"transition",x:K.x,y:K.y})});const W=new Map;return x.arcs.forEach(K=>{if(O.has(K.source)&&O.has(K.target)){const Q=Array.isArray(K.anglePoints)?K.anglePoints.map(q=>({x:q.x,y:q.y})):[];W.set(K.id,Q)}}),{startPositions:$,startArcPoints:W}},[x]),j=()=>{f(!0);const O=N.current;O.lastApplied={dx:0,dy:0};const $=k(t,"place");let W;$?W=new Set(y.filter(Q=>Q.type==="place"||Q.type==="transition").map(Q=>Q.id)):(W=new Set([t]),typeof c=="function"&&c(t));const K=V(W);T.current={baseId:t,...K}},D=O=>{let $={x:O.target.x(),y:O.target.y()};if(g){const W=h($.x,$.y);S({visible:!0,position:W,elementType:"place"}),O.target.position({x:W.x,y:W.y}),$=W}if(T.current&&T.current.startPositions&&T.current.baseId===t){const W=T.current.startPositions.get(t);if(!W)return;const K=$.x-W.x,Q=$.y-W.y;A({dx:K,dy:Q})}},G=O=>{const $={x:O.target.x(),y:O.target.y()};f(!1),S({visible:!1,position:null,elementType:null}),F(),u($),T.current=null},H=()=>M?R.tokens.length>0?P.jsx(P.Fragment,{children:R.tokens.map(O=>P.jsx(Dn,{text:O.text,fontSize:O.fontSize,fill:"black",x:O.x,y:O.y,width:O.width,align:"center",wrap:"none",listening:!1},O.key))}):R.indicator?P.jsx(Dn,{text:`(${R.indicator})`,fontSize:12,fill:"black",x:-z,y:-7,width:z*2,align:"center",wrap:"none",listening:!1}):null:i===0?m==="algebraic-int"||Array.isArray(s)?null:P.jsx(Dn,{text:"0",fontSize:14,fill:"black",x:-z,y:-7,width:z*2,align:"center",listening:!1}):i<=5?P.jsxs(P.Fragment,{children:[Array.from({length:i}).map((O,$)=>{const W=2*Math.PI*$/i,K=4,Q=z/2,q=Math.cos(W)*Q,oe=Math.sin(W)*Q;return P.jsx(rl,{x:q,y:oe,radius:K,fill:"black",listening:!1},$)}),P.jsx(Dn,{text:i.toString(),fontSize:14,fill:"black",x:-z,y:-7,width:z*2,align:"center",listening:!1})]}):P.jsx(Dn,{text:i.toString(),fontSize:16,fill:"black",x:-z,y:-8,width:z*2,align:"center",listening:!1});return P.jsxs(Bd,{x:e,y:n,draggable:_!=="arc"||!C,onDragStart:j,onDragMove:D,onDragEnd:G,onClick:()=>c(t),onTap:()=>c(t),onTouchEnd:O=>{_==="arc"&&C&&C.element.id!==t&&c(t)},id:t,name:"element",elementType:"place",children:[P.jsx(rl,{radius:z,fill:"white",stroke:l?"blue":"black",strokeWidth:2}),P.jsx(Dn,{text:r,fontSize:12,fill:"black",x:-z,y:z+5,width:z*2,align:"center",listening:!1}),H()]})},Zh=11,Qb=.48,V2=160,Zb=6,qb=({id:t,x:e,y:n,label:r,guard:i,isSelected:s,isEnabled:l,onSelect:c,onChange:u})=>{const{gridSnappingEnabled:m,setSnapIndicator:x}=Po(),{setIsDragging:y,snapToGrid:w,simulationSettings:T,netMode:k,elements:_,selectedElements:C,setElements:g,multiDragRef:S,isIdSelected:b,setSelection:N,mode:I,arcStart:A}=en(),F=B.useRef({pending:!1,rafId:null,delta:{dx:0,dy:0},lastApplied:{dx:0,dy:0}}),M=B.useCallback(()=>{const W=F.current;W.pending=!1,W.rafId=null,!(!S.current||!S.current.startPositions)&&g(K=>{if(!S.current||!S.current.startPositions)return K;const Q=S.current,q=x4(K,Q,W.delta,{gridSnappingEnabled:m,snapToGrid:w});return W.lastApplied={...W.delta},q})},[m,w,g,S]),R=B.useCallback(W=>{const K=F.current;if(!(K.pending&&K.delta&&K.delta.dx===W.dx&&K.delta.dy===W.dy||!K.pending&&K.lastApplied&&K.lastApplied.dx===W.dx&&K.lastApplied.dy===W.dy)){if(K.delta=W,typeof window>"u"||typeof window.requestAnimationFrame!="function"){M();return}K.pending||(K.pending=!0,K.rafId=window.requestAnimationFrame(M))}},[M]),z=B.useCallback(()=>{const W=F.current;typeof window<"u"&&typeof window.cancelAnimationFrame=="function"&&W.rafId!==null&&window.cancelAnimationFrame(W.rafId),(W.pending||W.rafId!==null)&&M()},[M]),V=B.useCallback(W=>{const K=new Map;_.places.forEach(q=>{W.has(q.id)&&K.set(q.id,{type:"place",x:q.x,y:q.y})}),_.transitions.forEach(q=>{W.has(q.id)&&K.set(q.id,{type:"transition",x:q.x,y:q.y})});const Q=new Map;return _.arcs.forEach(q=>{if(W.has(q.source)&&W.has(q.target)){const oe=Array.isArray(q.anglePoints)?q.anglePoints.map(we=>({x:we.x,y:we.y})):[];Q.set(q.id,oe)}}),{startPositions:K,startArcPoints:Q}},[_]),j=()=>{y(!0);const W=F.current;W.lastApplied={dx:0,dy:0};const K=b(t,"transition");let Q;K?Q=new Set(C.filter(oe=>oe.type==="place"||oe.type==="transition").map(oe=>oe.id)):(Q=new Set([t]),typeof c=="function"&&c(t));const q=V(Q);S.current={baseId:t,...q}},D=W=>{let K={x:W.target.x(),y:W.target.y()};if(m){const Q=w(K.x,K.y);x({visible:!0,position:Q,elementType:"transition"}),W.target.position({x:Q.x,y:Q.y}),K=Q}if(S.current&&S.current.startPositions&&S.current.baseId===t){const Q=S.current.startPositions.get(t);if(!Q)return;const q=K.x-Q.x,oe=K.y-Q.y;R({dx:q,dy:oe})}},G=W=>{const K={x:W.target.x(),y:W.target.y()};y(!1),x({visible:!1,position:null,elementType:null}),z(),u(K),S.current=null},H=k==="algebraic-int"?String(i||""):"";let O=40,$="none";if(H){const W=H.length*Zh*Qb+Zb*2;W<=V2?O=Math.max(40,W):(O=V2,$="char")}return P.jsxs(Bd,{x:e,y:n,onClick:W=>c(t,W),onTap:W=>c(t,W),onTouchEnd:W=>{I==="arc"&&A&&A.element.id!==t&&c(t,W)},draggable:I!=="arc"||!A,onDragStart:j,onDragMove:D,onDragEnd:G,id:t,name:"element",elementType:"transition",children:[P.jsx(Mc,{x:-40/2,y:-50/2,width:40,height:50,fill:l?"rgba(255, 255, 0, 0.8)":"gray",stroke:s?"blue":l?"rgba(255, 180, 0, 1)":"black",strokeWidth:s||l?3:2}),P.jsx(Dn,{text:r,fontSize:14,fill:"black",x:-40/2,y:50/2+5,width:40,align:"center",listening:!1}),k==="algebraic-int"&&H&&P.jsx(Dn,{text:H,fontSize:Zh,fill:"#333",x:-O/2,y:-50/2-14,width:O,align:"center",wrap:$,listening:!1,ellipsis:$!=="none"}),k==="algebraic-int"&&!H&&P.jsx(Dn,{text:"",fontSize:Zh,fill:"gray",x:-40/2,y:-50/2-14,width:40,align:"center",listening:!1})]})},Jb=({elements:t,selectedElement:e,handleElementClick:n,handleElementDragEnd:r,enabledTransitionIds:i})=>{var l,c;const{isIdSelected:s}=en();return P.jsxs(Ac,{children:[(l=t==null?void 0:t.places)==null?void 0:l.map(u=>P.jsx(Kb,{...u,isSelected:s(u.id,"place"),onSelect:f=>n(u,"place"),onChange:f=>r(u,"place",f)},u.id)),(c=t==null?void 0:t.transitions)==null?void 0:c.map(u=>P.jsx(qb,{...u,isSelected:s(u.id,"transition"),onSelect:f=>n(u,"transition"),onChange:f=>r(u,"transition",f),isEnabled:Array.isArray(i)?i.includes(u.id):!1},u.id))]})};function eE(t){return t!=null&&t.sourceType?t.sourceType:(t==null?void 0:t.type)==="place-to-transition"?"place":(t==null?void 0:t.type)==="transition-to-place"?"transition":"place"}function tE(t){return t!=null&&t.targetType?t.targetType:(t==null?void 0:t.type)==="place-to-transition"?"transition":(t==null?void 0:t.type)==="transition-to-place"?"place":"transition"}const nE=.52,qh=(t="",e=12,{padding:n=4,maxWidth:r=1/0}={})=>{if(!t.length)return{width:0,wrap:"none"};const i=t.length*e*nE+n*2;return i<=r?{width:i,wrap:"none"}:{width:r,wrap:"char"}},Jh=(t,e)=>t.width||e*2,Vs=t=>Number.isFinite(t),rE=()=>{var _;const{elements:t,selectedElement:e,selectedElements:n,mode:r,tempArcEnd:i,getVirtualPointerPosition:s,gridSnappingEnabled:l,snapToGrid:c,simulationSettings:u}=en(),f=(u==null?void 0:u.netMode)||"pt",{handleElementClick:h}=Cg(),{handleAddAnglePoint:m,handleDragAnglePoint:x,handleDeleteAnglePoint:y}=v4(),w=C=>!C||typeof C!="string"?null:t.places.find(g=>g.id===C)||t.transitions.find(g=>g.id===C),T=C=>{if(!C)return 30;if(f==="algebraic-int"||Array.isArray(C.valueTokens)){const g=S4(C.valueTokens,30);if(g&&typeof g.radius=="number"&&Number.isFinite(g.radius))return g.radius}return 30},k=(C,g,S=[])=>{if(!C||!g||typeof C.x!="number"||typeof C.y!="number"||typeof g.x!="number"||typeof g.y!="number")return[0,0,100,100];const b={x:C.x,y:C.y},N={x:g.x,y:g.y},I=[{...C},...S,{...g}],A=40,F=50,M={...I[0]},R={...I[I.length-1]},z=I[1]||R,V=I[I.length-2]||M;let j=z.x-M.x,D=z.y-M.y,G=Math.atan2(D,j);if(C.type==="place"){const q=T(C);M.x+=q*Math.cos(G),M.y+=q*Math.sin(G)}else{const q=A/2,oe=F/2,we=Math.abs(Math.cos(G)),ye=Math.abs(Math.sin(G)),U=Math.tan(G);if(q*ye<=oe*we)M.x+=Math.sign(j)*q,M.y+=Math.sign(j)*q*U;else{const te=Math.abs(U)<1e-6?1e-6*Math.sign(U||1):U;M.x+=Math.sign(D)*oe/te,M.y+=Math.sign(D)*oe}}let H=R.x-V.x,O=R.y-V.y,$=Math.atan2(O,H);if(g.type==="place"){const q=T(g);R.x-=q*Math.cos($),R.y-=q*Math.sin($)}else{const q=A/2,oe=F/2,we=Math.abs(Math.cos($)),ye=Math.abs(Math.sin($)),U=Math.tan($);if(q*ye<=oe*we)R.x-=Math.sign(H)*q,R.y-=Math.sign(H)*q*U;else{const te=Math.abs(U)<1e-6?1e-6*Math.sign(U||1):U;R.x-=Math.sign(O)*oe/te,R.y-=Math.sign(O)*oe}}const W=[M.x,M.y];if(S.forEach(q=>W.push(q.x,q.y)),W.push(R.x,R.y),W.every(q=>Number.isFinite(q)))return W;const Q=[b.x,b.y];return S.forEach(q=>Q.push(q.x,q.y)),Q.push(N.x,N.y),Q};return[P.jsxs(Ac,{children:[(_=t==null?void 0:t.arcs)==null?void 0:_.map(C=>{if(!C||!C.source||!C.target)return null;const g=w(C.source),S=w(C.target);if(!g||!S)return null;const b=k({...g,type:eE(C)},{...S,type:tE(C)},Array.isArray(C.anglePoints)?C.anglePoints:[]),N=(b[0]+b[b.length-2])/2,I=(b[1]+b[b.length-1])/2,A=(n==null?void 0:n.some(Mt=>Mt.id===C.id&&Mt.type==="arc"))||(n==null?void 0:n.some(Mt=>Mt.id===g.id))&&(n==null?void 0:n.some(Mt=>Mt.id===S.id)),F=12,M=12,R=12,z=C.label?`${C.label}`:"",V=C.weight>1?`${C.weight}`:"",j=f==="algebraic-int"&&Array.isArray(C.bindings)&&C.bindings.length>0?C.bindings.map(s5).join(", "):"",D=qh(z,F,{padding:6,maxWidth:220}),G=qh(V,M,{padding:4,maxWidth:80}),H=qh(j,R,{padding:6,maxWidth:240}),O=b[0],$=b[1],W=b[b.length-2],K=b[b.length-1],Q=W-O,q=K-$,oe=Math.hypot(Q,q);let we=0,ye=-1;oe>.001&&(we=-q/oe,ye=Q/oe);const U=6,te=9,ae=8,xe=.66,ve=Math.abs(we),Le=Math.abs(ye),ie=(Mt,Zr,Ts=4)=>Mt/2*ve+Zr/2*Le+Ts,se=Jh(G,M),de=Jh(D,F),ke=Jh(H,R),Me=Math.max(U,ie(se,M)),ue=Math.max(te,ie(de,F)),dt=Math.max(ue+ae,ie(ke,R,6)*xe),Tt=N-we*Me,Qt=I-ye*Me,_s=N+we*ue,Ss=I+ye*ue,lr=N+we*dt,ks=I+ye*dt;return!Vs(Tt)||!Vs(Qt)||!Vs(_s)||!Vs(Ss)||!Vs(lr)||!Vs(ks)?null:P.jsxs(Bd,{children:[P.jsx(Lb,{points:b,stroke:(e==null?void 0:e.id)===C.id||A?"blue":"black",strokeWidth:2,fill:"black",pointerLength:10,pointerWidth:10,hitStrokeWidth:12,onClick:Mt=>h(Mt,C,"arc"),onTap:Mt=>h(Mt,C,"arc"),onDblClick:Mt=>{if(r==="arc_angle"){const Zr=s();Zr&&m(C.id,Zr)}}}),C.weight>1&&P.jsx(Dn,{x:Tt,y:Qt,text:V,fontSize:M,width:se,offsetX:se/2,offsetY:M/2,align:"center",listening:!1}),C.label&&P.jsx(Dn,{x:_s,y:Ss,text:z,fontSize:F,fill:"gray",width:de,offsetX:de/2,offsetY:F/2,align:"center",wrap:D.wrap,ellipsis:D.wrap!=="none",listening:!1}),j&&P.jsx(Dn,{x:lr,y:ks,text:j,fontSize:R,fill:"#333",width:ke,offsetX:ke/2,offsetY:R/2,align:"center",wrap:H.wrap,ellipsis:H.wrap!=="none",listening:!1})]},C.id)}),i&&i.sourcePoint&&P.jsx(up,{points:[i.sourcePoint.x,i.sourcePoint.y,i.x,i.y],stroke:"grey",strokeWidth:2,dash:[5,5],listening:!1})]},"arcs-layer"),P.jsx(Ac,{children:(e==null?void 0:e.type)==="arc"&&r==="arc_angle"&&e.anglePoints.map((C,g)=>P.jsx(rl,{x:C.x,y:C.y,radius:6,fill:"red",stroke:"black",strokeWidth:1,draggable:!0,onDragEnd:S=>{const b={x:S.target.x(),y:S.target.y()},N=l?c(b.x,b.y):b;x(e.id,g,N)},onClick:S=>{S.evt.button===2&&(S.evt.preventDefault(),y(e.id,g))},onContextMenu:S=>{S.evt.preventDefault(),y(e.id,g)}},`angle-${e.id}-${g}`))},"handles-layer")]},iE=({width:t,height:e,gridSize:n})=>{const r=[],i=[],s=Math.ceil(e/n),l=Math.ceil(t/n);for(let c=0;c<=s;c++){const u=c*n;r.push(P.jsx(up,{points:[0,u,t,u],stroke:"#ddd",strokeWidth:c%5===0?.5:.2,perfectDrawEnabled:!1,listening:!1},`h-${c}`))}for(let c=0;c<=l;c++){const u=c*n;i.push(P.jsx(up,{points:[u,0,u,e],stroke:"#ddd",strokeWidth:c%5===0?.5:.2,perfectDrawEnabled:!1,listening:!1},`v-${c}`))}return P.jsxs(Bd,{listening:!1,perfectDrawEnabled:!1,children:[r,i]})},W2=({orientation:t,contentSize:e,viewportSize:n,scrollPosition:r,onScroll:i})=>{const s=B.useRef(null),l=B.useRef(null),[c,u]=B.useState(!1),f=B.useRef(0),h=B.useRef(0),m=t==="horizontal",x=B.useCallback(A=>{A.preventDefault(),A.stopPropagation(),u(!0),f.current=r,h.current=m?A.clientX:A.clientY},[m,r]),y=B.useCallback(A=>{if(s.current&&l.current&&!l.current.contains(A.target)){const{left:F,top:M,width:R,height:z}=s.current.getBoundingClientRect(),V=m?R:z,j=Math.max(20,V*(n/e)),D=Math.max(0,e-n),G=Math.max(0,V-j);let O=((m?A.clientX-F:A.clientY-M)-j/2)/G*D;O=Math.max(0,Math.min(O,D)),i(O)}},[e,n,m,i]);if(B.useEffect(()=>{const A=M=>{if(!c||!s.current)return;const z=(m?M.clientX:M.clientY)-h.current,V=m?s.current.clientWidth:s.current.clientHeight,j=Math.max(20,V*(n/e)),D=Math.max(0,e-n),G=Math.max(0,V-j);if(G<=0)return;const H=D/G,O=f.current+z*H;i(Math.max(0,Math.min(O,D)))},F=()=>{c&&u(!1)};return c&&(document.addEventListener("mousemove",A),document.addEventListener("mouseup",F),document.body.style.cursor=m?"ew-resize":"ns-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",F),document.body.style.cursor="default",document.body.style.userSelect="auto"}},[c,m,i,e,n]),e<=n)return null;const w=s.current?m?s.current.clientWidth:s.current.clientHeight:0,T=w>0?w*(n/e):0,k=Math.max(20,Math.min(T,w)),_=Math.max(0,e-n),C=Math.max(0,w-k),g=Math.max(0,Math.min(r,_)),S=_>0?Math.min(g/_*C,C):0,b={position:"absolute",zIndex:50,padding:0,margin:0,...m?{left:"0px",right:"0px",bottom:"0px",height:"10px"}:{top:"0px",bottom:"0px",right:"0px",width:"10px"}},N={position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"6px",overflow:"hidden"},I={position:"absolute",backgroundColor:"rgba(0,0,0,0.45)",borderRadius:"6px",cursor:"pointer",willChange:"transform",...m?{left:`${Math.round(S)}px`,top:"0px",width:`${Math.round(k)}px`,height:"100%"}:{top:`${Math.round(S)}px`,left:"0px",height:`${Math.round(k)}px`,width:"100%"}};return P.jsx("div",{style:b,children:P.jsx("div",{ref:s,style:N,onMouseDown:y,children:P.jsx("div",{ref:l,style:I,onMouseDown:x})})})},sE=({position:t,visible:e,elementType:n})=>!e||!t?null:n==="place"?P.jsx(rl,{x:t.x,y:t.y,radius:5,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}):n==="transition"?P.jsx(Mc,{x:t.x-5,y:t.y-5,width:10,height:10,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}):P.jsx(rl,{x:t.x,y:t.y,radius:5,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}),oE=({handleZoom:t,ZOOM_STEP:e,isSingleFingerPanningActive:n})=>{const{stageDimensions:r,setStageDimensions:i,virtualCanvasDimensions:s,canvasScroll:l,setCanvasScroll:c,zoomLevel:u,setContainerRef:f,stageRef:h,gridSize:m,gridSnappingEnabled:x,snapIndicator:y,setSnapIndicator:w}=Po(),{mode:T,setMode:k,arcStart:_,setArcStart:C,tempArcEnd:g,setTempArcEnd:S,selectedElement:b,setSelectedElement:N,elements:I,enabledTransitionIds:A,snapToGrid:F,selectedElements:M,setSelection:R,isDragging:z}=en(),{handleCreateElement:V,handleElementClick:j,handleElementDragEnd:D}=Cg(),G=B.useRef(null),H=B.useRef({isSelecting:!1,start:null}),[O,$]=B.useState(null),[W,K]=B.useState(!1),Q=B.useRef({firstTap:null,secondTap:null,isDoubleTapActive:!1,holdTimer:null,resetTimer:null}),q=300,oe=50,we=100,ye=1e3;B.useEffect(()=>{if(typeof window>"u")return;const ie=window.matchMedia("(pointer: coarse)"),se=de=>K(de.matches);return se(ie),ie.addEventListener?ie.addEventListener("change",se):ie.addListener(se),()=>{ie.removeEventListener?ie.removeEventListener("change",se):ie.removeListener(se)}},[]),B.useEffect(()=>{const ie=G.current;if(!ie)return;f(ie);const se=new ResizeObserver(de=>{for(let ke of de){const{width:Me,height:ue}=ke.contentRect;Me>0&&ue>0&&i({width:Me,height:ue})}});return se.observe(ie),()=>{se.disconnect()}},[i,f]);const U=()=>{const ie=h.current;if(!ie)return null;const se=ie.getPointerPosition();if(!se)return null;const de=ie.getAbsoluteTransform().copy();de.invert();const{x:ke,y:Me}=de.point(se);return{x:ke,y:Me}},te=ie=>{if(ie.target.name()!=="background")return;const se=U();se&&V(se)},ae=ie=>{if(ie.target.name()!=="background")return;const se=U();se&&V(se)},xe=ie=>{const se=U();if(!se)return;if(T==="arc"&&_){let ue=null;const dt=h.current;if(dt){const Tt=dt.getPointerPosition(),Qt=dt.getIntersection(Tt);Qt&&(Qt.attrs.elementType==="place"||Qt.attrs.elementType==="transition")&&Qt.attrs.id!==_.element.id&&(ue={id:Qt.attrs.id,type:Qt.attrs.elementType})}S({sourcePoint:_.point,x:se.x,y:se.y,potentialTarget:ue})}const de=Q.current,ke=W&&de.isDoubleTapActive,Me=!W;if(n&&!ke){H.current.isSelecting&&(H.current={isSelecting:!1,start:null},$(null));return}if(T==="select"){if(ke){if(!H.current.isSelecting&&de.secondTap&&(H.current={isSelecting:!0,start:{x:de.secondTap.x,y:de.secondTap.y}}),H.current.isSelecting&&H.current.start){const ue=H.current.start;$({x:ue.x,y:ue.y,w:se.x-ue.x,h:se.y-ue.y})}}else if(Me&&H.current.isSelecting&&H.current.start){const ue=H.current.start;$({x:ue.x,y:ue.y,w:se.x-ue.x,h:se.y-ue.y})}}if(x&&(T==="place"||T==="transition")){const ue=F(se.x,se.y);w({visible:!0,position:ue,elementType:T})}else y.visible&&w({visible:!1,position:null,elementType:null})},ve=B.useCallback(ie=>{if(ie.preventDefault(),ie.stopPropagation(),ie.ctrlKey||ie.metaKey){const se=ie.deltaY>0?-e:e;t(se,{clientX:ie.clientX,clientY:ie.clientY})}else{const se=ie.deltaX/u,de=ie.deltaY/u;c(ke=>{if(!s||!r)return ke;const Me=Math.max(0,s.width-r.width/u),ue=Math.max(0,s.height-r.height/u);return{x:Math.max(0,Math.min(Me,ke.x+se)),y:Math.max(0,Math.min(ue,ke.y+de))}})}},[e,t,c,u,s,r]);B.useEffect(()=>{const ie=G.current;if(!ie)return;const se=de=>{ie.contains(de.target)&&ve(de)};return document.addEventListener("wheel",se,{passive:!1}),()=>{document.removeEventListener("wheel",se)}},[ve]);const Le=B.useCallback((ie,se)=>{c(de=>{const ke=Math.max(0,s.width-r.width/u),Me=Math.max(0,s.height-r.height/u),ue=(Tt,Qt)=>Math.max(0,Math.min(Tt,Qt)),dt={...de};return ie==="x"&&(dt.x=ue(se,ke)),ie==="y"&&(dt.y=ue(se,Me)),dt})},[c,s,r,u]);return P.jsxs("div",{ref:G,className:"canvas-container",style:{width:"100%",height:"100%",position:"relative",backgroundColor:"#f0f0f0",overflow:"hidden",touchAction:W?"none":"auto"},children:[P.jsxs(Fb,{ref:h,width:r.width,height:r.height,listening:!0,onClick:te,onTap:ae,onMouseMove:xe,onTouchMove:xe,onMouseDown:ie=>{if(T!=="select"||ie.target&&ie.target.name&&ie.target.name()!=="background")return;const se=U();se&&(H.current={isSelecting:!0,start:se},$({x:se.x,y:se.y,w:0,h:0}))},onTouchStart:ie=>{const se=ie.target&&ie.target.name&&ie.target.name()==="background";if(n){H.current={isSelecting:!1,start:null},$(null),Q.current.holdTimer&&clearTimeout(Q.current.holdTimer),Q.current={firstTap:null,secondTap:null,isDoubleTapActive:!1,holdTimer:null};return}if(T==="select"&&se&&ie.touches.length===1){const de=ie.touches[0],ke=U();if(!ke)return;const Me=Date.now(),ue=Q.current;if(ue.firstTap&&Me-ue.firstTap.time<q)if(Math.hypot(ke.x-ue.firstTap.x,ke.y-ue.firstTap.y)<oe){ue.resetTimer&&(clearTimeout(ue.resetTimer),ue.resetTimer=null),ue.secondTap={time:Me,x:ke.x,y:ke.y,touchId:de.identifier},ue.isDoubleTapActive=!1,de.identifier;const Tt={x:ke.x,y:ke.y};ue.holdTimer=setTimeout(()=>{ue.isDoubleTapActive=!0,H.current={isSelecting:!0,start:Tt},$({x:Tt.x,y:Tt.y,w:0,h:0})},we)}else ue.resetTimer&&clearTimeout(ue.resetTimer),ue.firstTap={time:Me,x:ke.x,y:ke.y},ue.secondTap=null,ue.isDoubleTapActive=!1,ue.resetTimer=setTimeout(()=>{ue.firstTap=null,ue.resetTimer=null},ye);else ue.firstTap={time:Me,x:ke.x,y:ke.y},ue.secondTap=null,ue.isDoubleTapActive=!1,ue.holdTimer&&(clearTimeout(ue.holdTimer),ue.holdTimer=null),ue.resetTimer&&clearTimeout(ue.resetTimer),ue.resetTimer=setTimeout(()=>{ue.firstTap=null,ue.resetTimer=null},ye)}else{const de=Q.current;de.holdTimer&&clearTimeout(de.holdTimer),de.resetTimer&&clearTimeout(de.resetTimer),Q.current={firstTap:null,secondTap:null,isDoubleTapActive:!1,holdTimer:null,resetTimer:null}}},onMouseUp:()=>{if(T!=="select"||!H.current.isSelecting||!O)return;const ie=G2(I,O);R(ie),H.current={isSelecting:!1,start:null},$(null)},onTouchEnd:ie=>{const se=Q.current;if(se.holdTimer&&(clearTimeout(se.holdTimer),se.holdTimer=null),se.resetTimer&&(clearTimeout(se.resetTimer),se.resetTimer=null),se.secondTap&&!se.isDoubleTapActive&&(se.firstTap=null,se.secondTap=null,se.isDoubleTapActive=!1),T==="select"){if(!H.current.isSelecting||!O){se.firstTap=null,se.secondTap=null,se.isDoubleTapActive=!1;return}const de=G2(I,O);R(de),H.current={isSelecting:!1,start:null},$(null),se.firstTap=null,se.secondTap=null,se.isDoubleTapActive=!1,se.resetTimer&&(clearTimeout(se.resetTimer),se.resetTimer=null)}else T==="arc"&&_&&setTimeout(()=>{if(T==="arc"&&_){const de=h.current;if(de){const ke=de.getPointerPosition();if(ke){const Me=de.getIntersection(ke);(!Me||Me.attrs.elementType!=="place"&&Me.attrs.elementType!=="transition")&&(C(null),S(null))}else C(null),S(null)}else C(null),S(null)}},20)},scaleX:u,scaleY:u,x:-l.x*u,y:-l.y*u,children:[P.jsxs(Ac,{children:[P.jsx(Mc,{x:0,y:0,width:s.width,height:s.height,fill:"#FFFFFF",name:"background",onClick:()=>{T==="arc"&&_&&(C(null),S(null)),N(null)},onTap:()=>{T==="arc"&&_&&(C(null),S(null)),N(null)},onTouchEnd:()=>{T==="arc"&&_&&(C(null),S(null)),N(null)}}),O&&P.jsx(Mc,{x:Math.min(O.x,O.x+O.w),y:Math.min(O.y,O.y+O.h),width:Math.abs(O.w),height:Math.abs(O.h),stroke:"#3399FF",strokeWidth:1,dash:[4,4],fill:"rgba(51,153,255,0.15)",listening:!1}),P.jsx(iE,{width:s.width,height:s.height,gridSize:m}),P.jsx(sE,{position:y.position,visible:y.visible,elementType:y.elementType})]}),P.jsx(Jb,{elements:I,selectedElement:b,handleElementClick:j,handleElementDragEnd:D,enabledTransitionIds:A}),P.jsx(rE,{})]}),!W&&r.width>0&&s.width>r.width/u&&P.jsx(W2,{orientation:"horizontal",contentSize:s.width,viewportSize:r.width/u,scrollPosition:l.x,onScroll:ie=>Le("x",ie)}),!W&&r.height>0&&s.height>r.height/u&&P.jsx(W2,{orientation:"vertical",contentSize:s.height,viewportSize:r.height/u,scrollPosition:l.y,onScroll:ie=>{pe.debug("Vertical scroll callback:",{newScroll:ie,currentScroll:l.y,maxScroll:Math.max(0,s.height-r.height/u)}),Le("y",ie)}})]})},aE=()=>{const{mode:t,setMode:e}=en(),[n,r]=B.useState(!1);if(B.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia("(pointer: coarse)"),l=c=>r(c.matches);return l(s),s.addEventListener?s.addEventListener("change",l):s.addListener(l),()=>{s.removeEventListener?s.removeEventListener("change",l):s.removeListener(l)}},[]),!n)return null;const i=s=>({width:"56px",height:"56px",borderRadius:"50%",backgroundColor:s?"#4338ca":"white",color:s?"white":"#374151",border:s?"2px solid #312e81":"1px solid #d1d5db",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",marginBottom:"12px",cursor:"pointer",position:"relative"});return P.jsxs("div",{className:"fixed bottom-6 left-6 z-50 flex flex-col items-center",children:[P.jsx("button",{style:i(t==="arc"),onClick:()=>e("arc"),title:"Arc Tool",className:"active:scale-95",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:P.jsx("path",{d:"M3 21l18-18M3 21l7-1M3 21l1-7"})})}),P.jsx("button",{style:i(t==="transition"),onClick:()=>e("transition"),title:"Transition Tool",className:"active:scale-95",children:P.jsx("div",{style:{width:"14px",height:"32px",backgroundColor:"currentColor"}})}),P.jsx("button",{style:i(t==="place"),onClick:()=>e("place"),title:"Place Tool",className:"active:scale-95",children:P.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",border:"2px solid currentColor",backgroundColor:"transparent"}})}),P.jsx("button",{style:i(t==="select"),onClick:()=>e("select"),title:"Select Tool",className:"active:scale-95",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:P.jsx("path",{d:"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"})})})]})};function lE({MIN_ZOOM:t,MAX_ZOOM:e,zoomLevel:n,setZoomLevel:r,virtualCanvasDimensions:i,canvasScroll:s,setCanvasScroll:l,setContainerRef:c,isDragging:u=!1}){const f=B.useRef(null),h=B.useRef(!1),m=B.useRef({active:!1}),x=B.useRef({active:!1,startX:0,startY:0,lastX:0,lastY:0}),[y,w]=B.useState(!1),T=B.useRef({active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null}),k=B.useRef(n);B.useEffect(()=>{k.current=n},[n]);const _=B.useCallback(A=>Math.max(t,Math.min(e,A)),[t,e]),C=B.useCallback((A,F,M)=>{if(!f.current||!i)return;const R=f.current,z=R.clientWidth||1,V=R.clientHeight||1,j=R.getBoundingClientRect(),D=M?Math.min(Math.max(M.clientX-j.left,0),z):z/2,G=M?Math.min(Math.max(M.clientY-j.top,0),V):V/2,H=(s.x+D)/A,O=(s.y+G)/A,$=Math.max(0,i.width-z/F),W=Math.max(0,i.height-V/F),K=Math.max(0,Math.min($,H*F-D)),Q=Math.max(0,Math.min(W,O*F-G));l({x:K,y:Q})},[s,l,i]),g=B.useCallback((A,F,M)=>{if(!f.current||!i||!Number.isFinite(M)||M<=0)return;const R=f.current,z=R.clientWidth||1,V=R.clientHeight||1,j=Math.max(0,i.width-z/M),D=Math.max(0,i.height-V/M);l(G=>{const H=Math.max(0,Math.min(j,G.x-A/M)),O=Math.max(0,Math.min(D,G.y-F/M));return H===G.x&&O===G.y?G:{x:H,y:O}})},[l,i]),S=B.useCallback((A,F)=>{r(M=>{const R=_(A(M));return R!==M&&C(M,R,F),R})},[C,_,r]),b=B.useCallback((A,F)=>{typeof A!="number"||Number.isNaN(A)||A===0||S(M=>M+A,F)},[S]),N=B.useCallback((A,F)=>{typeof A!="number"||Number.isNaN(A)||S(()=>A,F)},[S]),I=B.useCallback(A=>{if(h.current){h.current=!1;return}l&&l({x:A.target.scrollLeft,y:A.target.scrollTop})},[l]);return B.useEffect(()=>{f.current&&(h.current=!0,f.current.scrollLeft!==s.x&&(f.current.scrollLeft=s.x),f.current.scrollTop!==s.y&&(f.current.scrollTop=s.y))},[s,f]),B.useEffect(()=>{f.current&&c&&c(f.current)},[f,c]),B.useEffect(()=>{const A=f.current;if(!A)return;const F=j=>{const[D,G]=j;return Math.hypot(D.clientX-G.clientX,D.clientY-G.clientY)},M=j=>{const[D,G]=j;return{clientX:(D.clientX+G.clientX)/2,clientY:(D.clientY+G.clientY)/2}},R=j=>{if(j.touches.length===2){T.current.holdTimer&&(clearTimeout(T.current.holdTimer),T.current.holdTimer=null),T.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null};const D=M(j.touches),G=F(j.touches);m.current={active:!1,startDistance:G,startZoom:k.current,lastCenter:D},x.current={active:!1,startX:D.clientX,startY:D.clientY,lastX:D.clientX,lastY:D.clientY}}else if(j.touches.length===1){if(u){const H=T.current;H.holdTimer&&(clearTimeout(H.holdTimer),H.holdTimer=null),H.active=!1,w(!1);return}const D=j.touches[0],G=T.current;G.holdTimer&&clearTimeout(G.holdTimer),x.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},m.current={active:!1},G.startX=D.clientX,G.startY=D.clientY,G.lastX=D.clientX,G.lastY=D.clientY,G.active=!1,G.touchId=D.identifier,G.holdTimer=setTimeout(()=>{!u&&j.touches.length===1&&j.touches[0].identifier===G.touchId&&(G.active=!0,w(!0))},500)}else T.current.holdTimer&&(clearTimeout(T.current.holdTimer),T.current.holdTimer=null),T.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null},w(!1),x.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},m.current={active:!1}},z=j=>{if(j.touches.length===2){T.current.holdTimer&&(clearTimeout(T.current.holdTimer),T.current.holdTimer=null),T.current.active=!1,w(!1);const D=M(j.touches),G=F(j.touches),H=m.current,O=H.startDistance>0?G/H.startDistance:1;if(Math.abs(O-1)>.05){H.active||(m.current={...H,active:!0}),j.preventDefault(),j.stopPropagation();const K=_(H.startZoom*O);N(K,D),m.current={...H,active:!0,startDistance:H.startDistance,startZoom:H.startZoom,lastCenter:D}}else{const K=x.current,Q=D.clientX-K.lastX,q=D.clientY-K.lastY,oe=D.clientX-K.startX,we=D.clientY-K.startY,ye=Math.hypot(oe,we),U=5;!K.active&&ye>U&&(x.current={...K,active:!0}),K.active&&(j.preventDefault(),j.stopPropagation(),g(-Q,-q,k.current)),x.current={...K,lastX:D.clientX,lastY:D.clientY}}return}else if(j.touches.length===1){if(u){const H=T.current;H.holdTimer&&(clearTimeout(H.holdTimer),H.holdTimer=null),H.active&&(H.active=!1,w(!1));return}const D=T.current,G=j.touches[0];if(D.active&&G.identifier===D.touchId){const H=G.clientX-D.lastX,O=G.clientY-D.lastY;j.preventDefault(),j.stopPropagation(),g(-H,-O,k.current),D.lastX=G.clientX,D.lastY=G.clientY}else G.identifier===D.touchId&&(D.lastX=G.clientX,D.lastY=G.clientY)}else T.current.holdTimer&&(clearTimeout(T.current.holdTimer),T.current.holdTimer=null),T.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null},w(!1),m.current={active:!1},x.current={active:!1,startX:0,startY:0,lastX:0,lastY:0}},V=()=>{T.current.holdTimer&&(clearTimeout(T.current.holdTimer),T.current.holdTimer=null),T.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null},w(!1),m.current={active:!1},x.current={active:!1,startX:0,startY:0,lastX:0,lastY:0}};return A.addEventListener("touchstart",R,{passive:!1}),A.addEventListener("touchmove",z,{passive:!1}),A.addEventListener("touchend",V,{passive:!0}),A.addEventListener("touchcancel",V,{passive:!0}),()=>{A.removeEventListener("touchstart",R),A.removeEventListener("touchmove",z),A.removeEventListener("touchend",V),A.removeEventListener("touchcancel",V)}},[g,_,N,u]),{localCanvasContainerDivRef:f,handleZoom:b,handleNativeCanvasScroll:I,isSingleFingerPanningActive:y}}function uE({elements:t,selectedElements:e,mode:n,clipboardRef:r,simulationSettings:i,simulatorCore:s}){try{if(t&&(window.__PETRI_NET_STATE__={places:t.places,transitions:t.transitions,arcs:t.arcs,selectedElements:e||[]}),typeof n<"u"&&(window.__PETRI_NET_MODE__=n),r&&(window.__PETRI_NET_CLIPBOARD__=r),i){const c=!!(i!=null&&i.batchMode),u=!!(i!=null&&i.limitIterations),f=Number(i==null?void 0:i.maxIterations),h=Number.isFinite(f)&&f>0?Math.floor(f):2e5,m=!!(i!=null&&i.useNonVisualRun||c);window.__PETRI_NET_NON_VISUAL_RUN__=m,window.__PETRI_NET_SETTINGS__={...window.__PETRI_NET_SETTINGS__||{},batchMode:c,limitIterations:u,maxIterations:h}}s&&!window.__PETRI_NET_SIM_CORE__&&(window.__PETRI_NET_SIM_CORE__=s)}catch{}}const cE=()=>{const{stageDimensions:e,virtualCanvasDimensions:n,canvasScroll:r,setCanvasScroll:i,zoomLevel:s,setZoomLevel:l,gridSnappingEnabled:c,toggleGridSnapping:u,MIN_ZOOM:f,MAX_ZOOM:h,appRef:m,containerRef:x,setContainerRef:y,stageRef:w}=Po(),{elements:T,setElements:k,selectedElement:_,setSelectedElement:C,selectedElements:g,mode:S,setMode:b,arcStart:N,setArcStart:I,tempArcEnd:A,setTempArcEnd:F,clearSelection:M,setSelection:R,isSettingsDialogOpen:z,setIsSettingsDialogOpen:V,simulationSettings:j,setSimulationSettings:D,historyManagerRef:G,canUndo:H,canRedo:O,handleUndo:$,handleRedo:W,updateHistory:K,snapToGrid:Q,resetEditor:q,simulatorCore:oe,enabledTransitionIds:we,clipboardRef:ye,setClipboard:U,getClipboard:te,isShiftPressedRef:ae}=en(),[xe,ve]=B.useState(!1);B.useEffect(()=>{typeof SharedArrayBuffer>"u"?console.warn(" SharedArrayBuffer is not available. This is required for Z3 workers in batch mode. The COOP/COEP service worker should enable this. If this warning persists, the service worker may not be active. Try refreshing the page or checking browser console for service worker errors."):console.log(" SharedArrayBuffer is available - Z3 workers should work correctly")},[]);const{isDragging:Le}=en(),{localCanvasContainerDivRef:ie,handleZoom:se,handleNativeCanvasScroll:de,isSingleFingerPanningActive:ke}=lE({MIN_ZOOM:f,MAX_ZOOM:h,zoomLevel:s,setZoomLevel:l,virtualCanvasDimensions:n,canvasScroll:r,setCanvasScroll:i,setContainerRef:y,isDragging:Le}),{handleDeleteElement:Me,clearAllElements:ue}=Cg();return B.useEffect(()=>{uE({elements:T,selectedElements:g,mode:S,clipboardRef:ye,simulationSettings:j,simulatorCore:oe})},[T.places,T.transitions,T.arcs,g,S,j==null?void 0:j.useNonVisualRun,j==null?void 0:j.batchMode,j==null?void 0:j.limitIterations,j==null?void 0:j.maxIterations,ye,oe]),S5({elements:T,setElements:k,selectedElement:_,selectedElements:g,clearSelection:M,setSelection:R,clipboardRef:ye,netMode:(j==null?void 0:j.netMode)||"pt",setClipboard:U,getClipboard:te,onClipboardMismatch:void 0,handleUndo:$,handleRedo:W,setMode:b,arcStart:N,setArcStart:I,setTempArcEnd:F,setSelectedElement:C,isShiftPressedRef:ae}),P.jsxs("div",{ref:m,className:"app-container h-screen max-h-screen overflow-hidden",tabIndex:-1,children:[P.jsx("button",{className:"fixed top-2.5 right-2 z-50 p-2 bg-white rounded-md shadow-md lg:hidden",onClick:()=>ve(!xe),children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})})}),P.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-white",onWheel:dt=>dt.stopPropagation(),children:P.jsx(__,{mode:S,setMode:b,onNew:ue,onUndo:$,canUndo:H,onRedo:W,canRedo:O,gridSnappingEnabled:c,onToggleGridSnapping:u,onOpenSettings:()=>V(!0),elements:T,setElements:k,updateHistory:K,simulationSettings:j,setSimulationSettings:D,resetEditor:q})}),P.jsxs("div",{className:`fixed w-80 right-0 top-16 bottom-0 z-30 bg-gray-100 shadow-lg pt-4 flex flex-col overflow-hidden transform transition-transform duration-300 ease-in-out ${xe?"translate-x-0":"translate-x-full"} lg:translate-x-0`,onWheel:dt=>dt.stopPropagation(),children:[P.jsx("div",{className:"overflow-y-auto pr-2",children:P.jsx(I_,{selectedElement:_,elements:T,setElements:k,updateHistory:K,simulationSettings:j})}),P.jsx("div",{className:"flex-1 overflow-y-auto pr-2 border-t-2 border-gray-200",children:P.jsx(F_,{elements:T,enabledTransitionIds:we})}),P.jsx("div",{className:"border-t-2 border-gray-200 w-full"}),P.jsx("div",{className:"mt-auto sticky bottom-0 bg-gray-100",children:P.jsx(Qy,{})})]}),P.jsxs("div",{className:"fixed top-20 left-0 bottom-0 right-0 lg:right-80 transition-all duration-300",children:[P.jsx("div",{className:"absolute inset-0 overflow-hidden stage-container bg-gray-200 dark:bg-gray-700","data-testid":"canvas-container",ref:ie,onScroll:de,children:P.jsx(oE,{handleZoom:se,ZOOM_STEP:.1,isSingleFingerPanningActive:ke})}),P.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-40",children:P.jsx(Qy,{isMobile:!0})}),P.jsxs("div",{className:"hidden lg:flex fixed top-24 right-[336px] z-10 flex-col space-y-2 pointer-events-auto",children:[P.jsx("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none",onClick:()=>se(.1),title:"Zoom In",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),P.jsx("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none",onClick:()=>se(-.1),title:"Zoom Out",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})}),P.jsxs("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none text-xs font-mono",onClick:()=>{l(1),i({x:0,y:0})},title:"Reset Zoom",children:[Math.round(s*100),"%"]})]}),P.jsx(aE,{})]}),P.jsx(O_,{isOpen:z,onClose:()=>V(!1)})]})},dE=()=>P.jsx(vw,{children:P.jsx(x_,{children:P.jsx(w_,{children:P.jsx(cE,{})})})});e0.createRoot(document.getElementById("root")).render(P.jsx(Ht.StrictMode,{children:P.jsx(dE,{})}));export{xo as a,Fn as b,ua as c,uo as d,nr as e,Ew as f,Cw as g,hE as h,fE as i,il as j,bw as p};
//# sourceMappingURL=index-f673dd08.js.map
