(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var fb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function il(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function hb(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var V2={exports:{}},Ac={},W2={exports:{}},Ae={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sl=Symbol.for("react.element"),G6=Symbol.for("react.portal"),V6=Symbol.for("react.fragment"),W6=Symbol.for("react.strict_mode"),$6=Symbol.for("react.profiler"),H6=Symbol.for("react.provider"),X6=Symbol.for("react.context"),Y6=Symbol.for("react.forward_ref"),K6=Symbol.for("react.suspense"),Q6=Symbol.for("react.memo"),Z6=Symbol.for("react.lazy"),pm=Symbol.iterator;function q6(t){return t===null||typeof t!="object"?null:(t=pm&&t[pm]||t["@@iterator"],typeof t=="function"?t:null)}var $2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H2=Object.assign,X2={};function ko(t,e,n){this.props=t,this.context=e,this.refs=X2,this.updater=n||$2}ko.prototype.isReactComponent={};ko.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ko.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Y2(){}Y2.prototype=ko.prototype;function cp(t,e,n){this.props=t,this.context=e,this.refs=X2,this.updater=n||$2}var dp=cp.prototype=new Y2;dp.constructor=cp;H2(dp,ko.prototype);dp.isPureReactComponent=!0;var gm=Array.isArray,K2=Object.prototype.hasOwnProperty,fp={current:null},Q2={key:!0,ref:!0,__self:!0,__source:!0};function Z2(t,e,n){var r,i={},s=null,l=null;if(e!=null)for(r in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(s=""+e.key),e)K2.call(e,r)&&!Q2.hasOwnProperty(r)&&(i[r]=e[r]);var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){for(var u=Array(c),f=0;f<c;f++)u[f]=arguments[f+2];i.children=u}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)i[r]===void 0&&(i[r]=c[r]);return{$$typeof:sl,type:t,key:s,ref:l,props:i,_owner:fp.current}}function J6(t,e){return{$$typeof:sl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function hp(t){return typeof t=="object"&&t!==null&&t.$$typeof===sl}function ex(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var mm=/\/+/g;function th(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ex(""+t.key):e.toString(36)}function Ru(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case sl:case G6:l=!0}}if(l)return l=t,i=i(l),t=r===""?"."+th(l,0):r,gm(i)?(n="",t!=null&&(n=t.replace(mm,"$&/")+"/"),Ru(i,e,n,"",function(f){return f})):i!=null&&(hp(i)&&(i=J6(i,n+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(mm,"$&/")+"/")+t)),e.push(i)),1;if(l=0,r=r===""?".":r+":",gm(t))for(var c=0;c<t.length;c++){s=t[c];var u=r+th(s,c);l+=Ru(s,e,n,u,i)}else if(u=q6(t),typeof u=="function")for(t=u.call(t),c=0;!(s=t.next()).done;)s=s.value,u=r+th(s,c++),l+=Ru(s,e,n,u,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function cu(t,e,n){if(t==null)return t;var r=[],i=0;return Ru(t,r,"","",function(s){return e.call(n,s,i++)}),r}function tx(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Jt={current:null},Fu={transition:null},nx={ReactCurrentDispatcher:Jt,ReactCurrentBatchConfig:Fu,ReactCurrentOwner:fp};function q2(){throw Error("act(...) is not supported in production builds of React.")}Ae.Children={map:cu,forEach:function(t,e,n){cu(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cu(t,function(){e++}),e},toArray:function(t){return cu(t,function(e){return e})||[]},only:function(t){if(!hp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ae.Component=ko;Ae.Fragment=V6;Ae.Profiler=$6;Ae.PureComponent=cp;Ae.StrictMode=W6;Ae.Suspense=K6;Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nx;Ae.act=q2;Ae.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=H2({},t.props),i=t.key,s=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,l=fp.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(u in e)K2.call(e,u)&&!Q2.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&c!==void 0?c[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var f=0;f<u;f++)c[f]=arguments[f+2];r.children=c}return{$$typeof:sl,type:t.type,key:i,ref:s,props:r,_owner:l}};Ae.createContext=function(t){return t={$$typeof:X6,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:H6,_context:t},t.Consumer=t};Ae.createElement=Z2;Ae.createFactory=function(t){var e=Z2.bind(null,t);return e.type=t,e};Ae.createRef=function(){return{current:null}};Ae.forwardRef=function(t){return{$$typeof:Y6,render:t}};Ae.isValidElement=hp;Ae.lazy=function(t){return{$$typeof:Z6,_payload:{_status:-1,_result:t},_init:tx}};Ae.memo=function(t,e){return{$$typeof:Q6,type:t,compare:e===void 0?null:e}};Ae.startTransition=function(t){var e=Fu.transition;Fu.transition={};try{t()}finally{Fu.transition=e}};Ae.unstable_act=q2;Ae.useCallback=function(t,e){return Jt.current.useCallback(t,e)};Ae.useContext=function(t){return Jt.current.useContext(t)};Ae.useDebugValue=function(){};Ae.useDeferredValue=function(t){return Jt.current.useDeferredValue(t)};Ae.useEffect=function(t,e){return Jt.current.useEffect(t,e)};Ae.useId=function(){return Jt.current.useId()};Ae.useImperativeHandle=function(t,e,n){return Jt.current.useImperativeHandle(t,e,n)};Ae.useInsertionEffect=function(t,e){return Jt.current.useInsertionEffect(t,e)};Ae.useLayoutEffect=function(t,e){return Jt.current.useLayoutEffect(t,e)};Ae.useMemo=function(t,e){return Jt.current.useMemo(t,e)};Ae.useReducer=function(t,e,n){return Jt.current.useReducer(t,e,n)};Ae.useRef=function(t){return Jt.current.useRef(t)};Ae.useState=function(t){return Jt.current.useState(t)};Ae.useSyncExternalStore=function(t,e,n){return Jt.current.useSyncExternalStore(t,e,n)};Ae.useTransition=function(){return Jt.current.useTransition()};Ae.version="18.3.1";W2.exports=Ae;var z=W2.exports;const $t=il(z);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rx=z,ix=Symbol.for("react.element"),sx=Symbol.for("react.fragment"),ox=Object.prototype.hasOwnProperty,ax=rx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lx={key:!0,ref:!0,__self:!0,__source:!0};function J2(t,e,n){var r,i={},s=null,l=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)ox.call(e,r)&&!lx.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ix,type:t,key:s,ref:l,props:i,_owner:ax.current}}Ac.Fragment=sx;Ac.jsx=J2;Ac.jsxs=J2;V2.exports=Ac;var P=V2.exports,Jh={},ev={exports:{}},kn={},tv={exports:{}},nv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,U){var G=F.length;F.push(U);e:for(;0<G;){var K=G-1>>>1,Q=F[K];if(0<i(Q,U))F[K]=U,F[G]=Q,G=K;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var U=F[0],G=F.pop();if(G!==U){F[0]=G;e:for(var K=0,Q=F.length,Z=Q>>>1;K<Z;){var se=2*(K+1)-1,xe=F[se],ge=se+1,V=F[ge];if(0>i(xe,G))ge<Q&&0>i(V,xe)?(F[K]=V,F[ge]=G,K=ge):(F[K]=xe,F[se]=G,K=se);else if(ge<Q&&0>i(V,G))F[K]=V,F[ge]=G,K=ge;else break e}}return U}function i(F,U){var G=F.sortIndex-U.sortIndex;return G!==0?G:F.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var u=[],f=[],h=1,m=null,x=3,y=!1,w=!1,E=!1,_=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(F){for(var U=n(f);U!==null;){if(U.callback===null)r(f);else if(U.startTime<=F)r(f),U.sortIndex=U.expirationTime,e(u,U);else break;U=n(f)}}function k(F){if(E=!1,g(F),!w)if(n(u)!==null)w=!0,$(T);else{var U=n(f);U!==null&&X(k,U.startTime-F)}}function T(F,U){w=!1,E&&(E=!1,S(A),A=-1),y=!0;var G=x;try{for(g(U),m=n(u);m!==null&&(!(m.expirationTime>U)||F&&!I());){var K=m.callback;if(typeof K=="function"){m.callback=null,x=m.priorityLevel;var Q=K(m.expirationTime<=U);U=t.unstable_now(),typeof Q=="function"?m.callback=Q:m===n(u)&&r(u),g(U)}else r(u);m=n(u)}if(m!==null)var Z=!0;else{var se=n(f);se!==null&&X(k,se.startTime-U),Z=!1}return Z}finally{m=null,x=G,y=!1}}var N=!1,L=null,A=-1,R=5,M=-1;function I(){return!(t.unstable_now()-M<R)}function O(){if(L!==null){var F=t.unstable_now();M=F;var U=!0;try{U=L(!0,F)}finally{U?W():(N=!1,L=null)}}else N=!1}var W;if(typeof C=="function")W=function(){C(O)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,D=B.port2;B.port1.onmessage=O,W=function(){D.postMessage(null)}}else W=function(){_(O,0)};function $(F){L=F,N||(N=!0,W())}function X(F,U){A=_(function(){F(t.unstable_now())},U)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){w||y||(w=!0,$(T))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(F){switch(x){case 1:case 2:case 3:var U=3;break;default:U=x}var G=x;x=U;try{return F()}finally{x=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,U){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var G=x;x=F;try{return U()}finally{x=G}},t.unstable_scheduleCallback=function(F,U,G){var K=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?K+G:K):G=K,F){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=G+Q,F={id:h++,callback:U,priorityLevel:F,startTime:G,expirationTime:Q,sortIndex:-1},G>K?(F.sortIndex=G,e(f,F),n(u)===null&&F===n(f)&&(E?(S(A),A=-1):E=!0,X(k,G-K))):(F.sortIndex=Q,e(u,F),w||y||(w=!0,$(T))),F},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(F){var U=x;return function(){var G=x;x=U;try{return F.apply(this,arguments)}finally{x=G}}}})(nv);tv.exports=nv;var Sa=tv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ux=z,Sn=Sa;function ne(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rv=new Set,ja={};function us(t,e){fo(t,e),fo(t+"Capture",e)}function fo(t,e){for(ja[t]=e,t=0;t<e.length;t++)rv.add(e[t])}var Ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),e0=Object.prototype.hasOwnProperty,cx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ym={},vm={};function dx(t){return e0.call(vm,t)?!0:e0.call(ym,t)?!1:cx.test(t)?vm[t]=!0:(ym[t]=!0,!1)}function fx(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function hx(t,e,n,r){if(e===null||typeof e>"u"||fx(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function en(t,e,n,r,i,s,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=l}var jt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){jt[t]=new en(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];jt[e]=new en(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){jt[t]=new en(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){jt[t]=new en(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){jt[t]=new en(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){jt[t]=new en(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){jt[t]=new en(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){jt[t]=new en(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){jt[t]=new en(t,5,!1,t.toLowerCase(),null,!1,!1)});var pp=/[\-:]([a-z])/g;function gp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pp,gp);jt[e]=new en(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pp,gp);jt[e]=new en(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pp,gp);jt[e]=new en(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){jt[t]=new en(t,1,!1,t.toLowerCase(),null,!1,!1)});jt.xlinkHref=new en("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){jt[t]=new en(t,1,!1,t.toLowerCase(),null,!0,!0)});function mp(t,e,n,r){var i=jt.hasOwnProperty(e)?jt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(hx(e,n,i,r)&&(n=null),r||i===null?dx(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var $r=ux.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,du=Symbol.for("react.element"),Ws=Symbol.for("react.portal"),$s=Symbol.for("react.fragment"),yp=Symbol.for("react.strict_mode"),t0=Symbol.for("react.profiler"),iv=Symbol.for("react.provider"),sv=Symbol.for("react.context"),vp=Symbol.for("react.forward_ref"),n0=Symbol.for("react.suspense"),r0=Symbol.for("react.suspense_list"),xp=Symbol.for("react.memo"),di=Symbol.for("react.lazy"),ov=Symbol.for("react.offscreen"),xm=Symbol.iterator;function ta(t){return t===null||typeof t!="object"?null:(t=xm&&t[xm]||t["@@iterator"],typeof t=="function"?t:null)}var ot=Object.assign,nh;function ya(t){if(nh===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);nh=e&&e[1]||""}return`
`+nh+t}var rh=!1;function ih(t,e){if(!t||rh)return"";rh=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(f){var r=f}Reflect.construct(t,[],e)}else{try{e.call()}catch(f){r=f}t.call(e.prototype)}else{try{throw Error()}catch(f){r=f}t()}}catch(f){if(f&&r&&typeof f.stack=="string"){for(var i=f.stack.split(`
`),s=r.stack.split(`
`),l=i.length-1,c=s.length-1;1<=l&&0<=c&&i[l]!==s[c];)c--;for(;1<=l&&0<=c;l--,c--)if(i[l]!==s[c]){if(l!==1||c!==1)do if(l--,c--,0>c||i[l]!==s[c]){var u=`
`+i[l].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=l&&0<=c);break}}}finally{rh=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ya(t):""}function px(t){switch(t.tag){case 5:return ya(t.type);case 16:return ya("Lazy");case 13:return ya("Suspense");case 19:return ya("SuspenseList");case 0:case 2:case 15:return t=ih(t.type,!1),t;case 11:return t=ih(t.type.render,!1),t;case 1:return t=ih(t.type,!0),t;default:return""}}function i0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $s:return"Fragment";case Ws:return"Portal";case t0:return"Profiler";case yp:return"StrictMode";case n0:return"Suspense";case r0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case sv:return(t.displayName||"Context")+".Consumer";case iv:return(t._context.displayName||"Context")+".Provider";case vp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case xp:return e=t.displayName||null,e!==null?e:i0(t.type)||"Memo";case di:e=t._payload,t=t._init;try{return i0(t(e))}catch{}}return null}function gx(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return i0(e);case 8:return e===yp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ei(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function av(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mx(t){var e=av(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(l){r=""+l,s.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fu(t){t._valueTracker||(t._valueTracker=mx(t))}function lv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=av(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function qu(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function s0(t,e){var n=e.checked;return ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function wm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ei(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function uv(t,e){e=e.checked,e!=null&&mp(t,"checked",e,!1)}function o0(t,e){uv(t,e);var n=Ei(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?a0(t,e.type,n):e.hasOwnProperty("defaultValue")&&a0(t,e.type,Ei(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function _m(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function a0(t,e,n){(e!=="number"||qu(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var va=Array.isArray;function ro(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ei(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function l0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Sm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ne(92));if(va(n)){if(1<n.length)throw Error(ne(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ei(n)}}function cv(t,e){var n=Ei(e.value),r=Ei(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function km(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function dv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function u0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?dv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hu,fv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hu=hu||document.createElement("div"),hu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Oa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ka={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yx=["Webkit","ms","Moz","O"];Object.keys(ka).forEach(function(t){yx.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ka[e]=ka[t]})});function hv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ka.hasOwnProperty(t)&&ka[t]?(""+e).trim():e+"px"}function pv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=hv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var vx=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function c0(t,e){if(e){if(vx[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function d0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var f0=null;function wp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var h0=null,io=null,so=null;function Cm(t){if(t=ll(t)){if(typeof h0!="function")throw Error(ne(280));var e=t.stateNode;e&&(e=jc(e),h0(t.stateNode,t.type,e))}}function gv(t){io?so?so.push(t):so=[t]:io=t}function mv(){if(io){var t=io,e=so;if(so=io=null,Cm(t),e)for(t=0;t<e.length;t++)Cm(e[t])}}function yv(t,e){return t(e)}function vv(){}var sh=!1;function xv(t,e,n){if(sh)return t(e,n);sh=!0;try{return yv(t,e,n)}finally{sh=!1,(io!==null||so!==null)&&(vv(),mv())}}function Da(t,e){var n=t.stateNode;if(n===null)return null;var r=jc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ne(231,e,typeof n));return n}var p0=!1;if(Ur)try{var na={};Object.defineProperty(na,"passive",{get:function(){p0=!0}}),window.addEventListener("test",na,na),window.removeEventListener("test",na,na)}catch{p0=!1}function xx(t,e,n,r,i,s,l,c,u){var f=Array.prototype.slice.call(arguments,3);try{e.apply(n,f)}catch(h){this.onError(h)}}var Ca=!1,Ju=null,ec=!1,g0=null,wx={onError:function(t){Ca=!0,Ju=t}};function _x(t,e,n,r,i,s,l,c,u){Ca=!1,Ju=null,xx.apply(wx,arguments)}function Sx(t,e,n,r,i,s,l,c,u){if(_x.apply(this,arguments),Ca){if(Ca){var f=Ju;Ca=!1,Ju=null}else throw Error(ne(198));ec||(ec=!0,g0=f)}}function cs(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function wv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Tm(t){if(cs(t)!==t)throw Error(ne(188))}function kx(t){var e=t.alternate;if(!e){if(e=cs(t),e===null)throw Error(ne(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Tm(i),t;if(s===r)return Tm(i),e;s=s.sibling}throw Error(ne(188))}if(n.return!==r.return)n=i,r=s;else{for(var l=!1,c=i.child;c;){if(c===n){l=!0,n=i,r=s;break}if(c===r){l=!0,r=i,n=s;break}c=c.sibling}if(!l){for(c=s.child;c;){if(c===n){l=!0,n=s,r=i;break}if(c===r){l=!0,r=s,n=i;break}c=c.sibling}if(!l)throw Error(ne(189))}}if(n.alternate!==r)throw Error(ne(190))}if(n.tag!==3)throw Error(ne(188));return n.stateNode.current===n?t:e}function _v(t){return t=kx(t),t!==null?Sv(t):null}function Sv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Sv(t);if(e!==null)return e;t=t.sibling}return null}var kv=Sn.unstable_scheduleCallback,Em=Sn.unstable_cancelCallback,Cx=Sn.unstable_shouldYield,Tx=Sn.unstable_requestPaint,ft=Sn.unstable_now,Ex=Sn.unstable_getCurrentPriorityLevel,_p=Sn.unstable_ImmediatePriority,Cv=Sn.unstable_UserBlockingPriority,tc=Sn.unstable_NormalPriority,bx=Sn.unstable_LowPriority,Tv=Sn.unstable_IdlePriority,Ic=null,Sr=null;function Px(t){if(Sr&&typeof Sr.onCommitFiberRoot=="function")try{Sr.onCommitFiberRoot(Ic,t,void 0,(t.current.flags&128)===128)}catch{}}var nr=Math.clz32?Math.clz32:Ax,Nx=Math.log,Mx=Math.LN2;function Ax(t){return t>>>=0,t===0?32:31-(Nx(t)/Mx|0)|0}var pu=64,gu=4194304;function xa(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function nc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,l=n&268435455;if(l!==0){var c=l&~i;c!==0?r=xa(c):(s&=l,s!==0&&(r=xa(s)))}else l=n&~i,l!==0?r=xa(l):s!==0&&(r=xa(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-nr(e),i=1<<n,r|=t[n],e&=~i;return r}function Ix(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lx(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var l=31-nr(s),c=1<<l,u=i[l];u===-1?(!(c&n)||c&r)&&(i[l]=Ix(c,e)):u<=e&&(t.expiredLanes|=c),s&=~c}}function m0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Ev(){var t=pu;return pu<<=1,!(pu&4194240)&&(pu=64),t}function oh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ol(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-nr(e),t[e]=n}function Rx(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-nr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Sp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-nr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Ue=0;function bv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Pv,kp,Nv,Mv,Av,y0=!1,mu=[],vi=null,xi=null,wi=null,za=new Map,Ba=new Map,pi=[],Fx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bm(t,e){switch(t){case"focusin":case"focusout":vi=null;break;case"dragenter":case"dragleave":xi=null;break;case"mouseover":case"mouseout":wi=null;break;case"pointerover":case"pointerout":za.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ba.delete(e.pointerId)}}function ra(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=ll(e),e!==null&&kp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function jx(t,e,n,r,i){switch(e){case"focusin":return vi=ra(vi,t,e,n,r,i),!0;case"dragenter":return xi=ra(xi,t,e,n,r,i),!0;case"mouseover":return wi=ra(wi,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return za.set(s,ra(za.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ba.set(s,ra(Ba.get(s)||null,t,e,n,r,i)),!0}return!1}function Iv(t){var e=Ji(t.target);if(e!==null){var n=cs(e);if(n!==null){if(e=n.tag,e===13){if(e=wv(n),e!==null){t.blockedOn=e,Av(t.priority,function(){Nv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ju(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=v0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);f0=r,n.target.dispatchEvent(r),f0=null}else return e=ll(n),e!==null&&kp(e),t.blockedOn=n,!1;e.shift()}return!0}function Pm(t,e,n){ju(t)&&n.delete(e)}function Ox(){y0=!1,vi!==null&&ju(vi)&&(vi=null),xi!==null&&ju(xi)&&(xi=null),wi!==null&&ju(wi)&&(wi=null),za.forEach(Pm),Ba.forEach(Pm)}function ia(t,e){t.blockedOn===e&&(t.blockedOn=null,y0||(y0=!0,Sn.unstable_scheduleCallback(Sn.unstable_NormalPriority,Ox)))}function Ua(t){function e(i){return ia(i,t)}if(0<mu.length){ia(mu[0],t);for(var n=1;n<mu.length;n++){var r=mu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(vi!==null&&ia(vi,t),xi!==null&&ia(xi,t),wi!==null&&ia(wi,t),za.forEach(e),Ba.forEach(e),n=0;n<pi.length;n++)r=pi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<pi.length&&(n=pi[0],n.blockedOn===null);)Iv(n),n.blockedOn===null&&pi.shift()}var oo=$r.ReactCurrentBatchConfig,rc=!0;function Dx(t,e,n,r){var i=Ue,s=oo.transition;oo.transition=null;try{Ue=1,Cp(t,e,n,r)}finally{Ue=i,oo.transition=s}}function zx(t,e,n,r){var i=Ue,s=oo.transition;oo.transition=null;try{Ue=4,Cp(t,e,n,r)}finally{Ue=i,oo.transition=s}}function Cp(t,e,n,r){if(rc){var i=v0(t,e,n,r);if(i===null)mh(t,e,r,ic,n),bm(t,r);else if(jx(i,t,e,n,r))r.stopPropagation();else if(bm(t,r),e&4&&-1<Fx.indexOf(t)){for(;i!==null;){var s=ll(i);if(s!==null&&Pv(s),s=v0(t,e,n,r),s===null&&mh(t,e,r,ic,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else mh(t,e,r,null,n)}}var ic=null;function v0(t,e,n,r){if(ic=null,t=wp(r),t=Ji(t),t!==null)if(e=cs(t),e===null)t=null;else if(n=e.tag,n===13){if(t=wv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ic=t,null}function Lv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ex()){case _p:return 1;case Cv:return 4;case tc:case bx:return 16;case Tv:return 536870912;default:return 16}default:return 16}}var mi=null,Tp=null,Ou=null;function Rv(){if(Ou)return Ou;var t,e=Tp,n=e.length,r,i="value"in mi?mi.value:mi.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var l=n-t;for(r=1;r<=l&&e[n-r]===i[s-r];r++);return Ou=i.slice(t,1<r?1-r:void 0)}function Du(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yu(){return!0}function Nm(){return!1}function Cn(t){function e(n,r,i,s,l){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=l,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(s):s[c]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?yu:Nm,this.isPropagationStopped=Nm,this}return ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=yu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=yu)},persist:function(){},isPersistent:yu}),e}var Co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ep=Cn(Co),al=ot({},Co,{view:0,detail:0}),Bx=Cn(al),ah,lh,sa,Lc=ot({},al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==sa&&(sa&&t.type==="mousemove"?(ah=t.screenX-sa.screenX,lh=t.screenY-sa.screenY):lh=ah=0,sa=t),ah)},movementY:function(t){return"movementY"in t?t.movementY:lh}}),Mm=Cn(Lc),Ux=ot({},Lc,{dataTransfer:0}),Gx=Cn(Ux),Vx=ot({},al,{relatedTarget:0}),uh=Cn(Vx),Wx=ot({},Co,{animationName:0,elapsedTime:0,pseudoElement:0}),$x=Cn(Wx),Hx=ot({},Co,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Xx=Cn(Hx),Yx=ot({},Co,{data:0}),Am=Cn(Yx),Kx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qx(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Zx[t])?!!e[t]:!1}function bp(){return qx}var Jx=ot({},al,{key:function(t){if(t.key){var e=Kx[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Du(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Qx[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bp,charCode:function(t){return t.type==="keypress"?Du(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Du(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),e8=Cn(Jx),t8=ot({},Lc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Im=Cn(t8),n8=ot({},al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bp}),r8=Cn(n8),i8=ot({},Co,{propertyName:0,elapsedTime:0,pseudoElement:0}),s8=Cn(i8),o8=ot({},Lc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),a8=Cn(o8),l8=[9,13,27,32],Pp=Ur&&"CompositionEvent"in window,Ta=null;Ur&&"documentMode"in document&&(Ta=document.documentMode);var u8=Ur&&"TextEvent"in window&&!Ta,Fv=Ur&&(!Pp||Ta&&8<Ta&&11>=Ta),Lm=String.fromCharCode(32),Rm=!1;function jv(t,e){switch(t){case"keyup":return l8.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ov(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Hs=!1;function c8(t,e){switch(t){case"compositionend":return Ov(e);case"keypress":return e.which!==32?null:(Rm=!0,Lm);case"textInput":return t=e.data,t===Lm&&Rm?null:t;default:return null}}function d8(t,e){if(Hs)return t==="compositionend"||!Pp&&jv(t,e)?(t=Rv(),Ou=Tp=mi=null,Hs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Fv&&e.locale!=="ko"?null:e.data;default:return null}}var f8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!f8[t.type]:e==="textarea"}function Dv(t,e,n,r){gv(r),e=sc(e,"onChange"),0<e.length&&(n=new Ep("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ea=null,Ga=null;function h8(t){Kv(t,0)}function Rc(t){var e=Ks(t);if(lv(e))return t}function p8(t,e){if(t==="change")return e}var zv=!1;if(Ur){var ch;if(Ur){var dh="oninput"in document;if(!dh){var jm=document.createElement("div");jm.setAttribute("oninput","return;"),dh=typeof jm.oninput=="function"}ch=dh}else ch=!1;zv=ch&&(!document.documentMode||9<document.documentMode)}function Om(){Ea&&(Ea.detachEvent("onpropertychange",Bv),Ga=Ea=null)}function Bv(t){if(t.propertyName==="value"&&Rc(Ga)){var e=[];Dv(e,Ga,t,wp(t)),xv(h8,e)}}function g8(t,e,n){t==="focusin"?(Om(),Ea=e,Ga=n,Ea.attachEvent("onpropertychange",Bv)):t==="focusout"&&Om()}function m8(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Rc(Ga)}function y8(t,e){if(t==="click")return Rc(e)}function v8(t,e){if(t==="input"||t==="change")return Rc(e)}function x8(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var sr=typeof Object.is=="function"?Object.is:x8;function Va(t,e){if(sr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!e0.call(e,i)||!sr(t[i],e[i]))return!1}return!0}function Dm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function zm(t,e){var n=Dm(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Dm(n)}}function Uv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Uv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Gv(){for(var t=window,e=qu();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=qu(t.document)}return e}function Np(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function w8(t){var e=Gv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Uv(n.ownerDocument.documentElement,n)){if(r!==null&&Np(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=zm(n,s);var l=zm(n,r);i&&l&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _8=Ur&&"documentMode"in document&&11>=document.documentMode,Xs=null,x0=null,ba=null,w0=!1;function Bm(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;w0||Xs==null||Xs!==qu(r)||(r=Xs,"selectionStart"in r&&Np(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ba&&Va(ba,r)||(ba=r,r=sc(x0,"onSelect"),0<r.length&&(e=new Ep("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Xs)))}function vu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ys={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionend:vu("Transition","TransitionEnd")},fh={},Vv={};Ur&&(Vv=document.createElement("div").style,"AnimationEvent"in window||(delete Ys.animationend.animation,delete Ys.animationiteration.animation,delete Ys.animationstart.animation),"TransitionEvent"in window||delete Ys.transitionend.transition);function Fc(t){if(fh[t])return fh[t];if(!Ys[t])return t;var e=Ys[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Vv)return fh[t]=e[n];return t}var Wv=Fc("animationend"),$v=Fc("animationiteration"),Hv=Fc("animationstart"),Xv=Fc("transitionend"),Yv=new Map,Um="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ni(t,e){Yv.set(t,e),us(e,[t])}for(var hh=0;hh<Um.length;hh++){var ph=Um[hh],S8=ph.toLowerCase(),k8=ph[0].toUpperCase()+ph.slice(1);Ni(S8,"on"+k8)}Ni(Wv,"onAnimationEnd");Ni($v,"onAnimationIteration");Ni(Hv,"onAnimationStart");Ni("dblclick","onDoubleClick");Ni("focusin","onFocus");Ni("focusout","onBlur");Ni(Xv,"onTransitionEnd");fo("onMouseEnter",["mouseout","mouseover"]);fo("onMouseLeave",["mouseout","mouseover"]);fo("onPointerEnter",["pointerout","pointerover"]);fo("onPointerLeave",["pointerout","pointerover"]);us("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));us("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));us("onBeforeInput",["compositionend","keypress","textInput","paste"]);us("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));us("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));us("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C8=new Set("cancel close invalid load scroll toggle".split(" ").concat(wa));function Gm(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Sx(r,e,void 0,t),t.currentTarget=null}function Kv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var l=r.length-1;0<=l;l--){var c=r[l],u=c.instance,f=c.currentTarget;if(c=c.listener,u!==s&&i.isPropagationStopped())break e;Gm(i,c,f),s=u}else for(l=0;l<r.length;l++){if(c=r[l],u=c.instance,f=c.currentTarget,c=c.listener,u!==s&&i.isPropagationStopped())break e;Gm(i,c,f),s=u}}}if(ec)throw t=g0,ec=!1,g0=null,t}function Qe(t,e){var n=e[T0];n===void 0&&(n=e[T0]=new Set);var r=t+"__bubble";n.has(r)||(Qv(e,t,2,!1),n.add(r))}function gh(t,e,n){var r=0;e&&(r|=4),Qv(n,t,r,e)}var xu="_reactListening"+Math.random().toString(36).slice(2);function Wa(t){if(!t[xu]){t[xu]=!0,rv.forEach(function(n){n!=="selectionchange"&&(C8.has(n)||gh(n,!1,t),gh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[xu]||(e[xu]=!0,gh("selectionchange",!1,e))}}function Qv(t,e,n,r){switch(Lv(e)){case 1:var i=Dx;break;case 4:i=zx;break;default:i=Cp}n=i.bind(null,e,n,t),i=void 0,!p0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function mh(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===i||c.nodeType===8&&c.parentNode===i)break;if(l===4)for(l=r.return;l!==null;){var u=l.tag;if((u===3||u===4)&&(u=l.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;l=l.return}for(;c!==null;){if(l=Ji(c),l===null)return;if(u=l.tag,u===5||u===6){r=s=l;continue e}c=c.parentNode}}r=r.return}xv(function(){var f=s,h=wp(n),m=[];e:{var x=Yv.get(t);if(x!==void 0){var y=Ep,w=t;switch(t){case"keypress":if(Du(n)===0)break e;case"keydown":case"keyup":y=e8;break;case"focusin":w="focus",y=uh;break;case"focusout":w="blur",y=uh;break;case"beforeblur":case"afterblur":y=uh;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=Mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=Gx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=r8;break;case Wv:case $v:case Hv:y=$x;break;case Xv:y=s8;break;case"scroll":y=Bx;break;case"wheel":y=a8;break;case"copy":case"cut":case"paste":y=Xx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Im}var E=(e&4)!==0,_=!E&&t==="scroll",S=E?x!==null?x+"Capture":null:x;E=[];for(var C=f,g;C!==null;){g=C;var k=g.stateNode;if(g.tag===5&&k!==null&&(g=k,S!==null&&(k=Da(C,S),k!=null&&E.push($a(C,k,g)))),_)break;C=C.return}0<E.length&&(x=new y(x,w,null,n,h),m.push({event:x,listeners:E}))}}if(!(e&7)){e:{if(x=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",x&&n!==f0&&(w=n.relatedTarget||n.fromElement)&&(Ji(w)||w[Gr]))break e;if((y||x)&&(x=h.window===h?h:(x=h.ownerDocument)?x.defaultView||x.parentWindow:window,y?(w=n.relatedTarget||n.toElement,y=f,w=w?Ji(w):null,w!==null&&(_=cs(w),w!==_||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=f),y!==w)){if(E=Mm,k="onMouseLeave",S="onMouseEnter",C="mouse",(t==="pointerout"||t==="pointerover")&&(E=Im,k="onPointerLeave",S="onPointerEnter",C="pointer"),_=y==null?x:Ks(y),g=w==null?x:Ks(w),x=new E(k,C+"leave",y,n,h),x.target=_,x.relatedTarget=g,k=null,Ji(h)===f&&(E=new E(S,C+"enter",w,n,h),E.target=g,E.relatedTarget=_,k=E),_=k,y&&w)t:{for(E=y,S=w,C=0,g=E;g;g=zs(g))C++;for(g=0,k=S;k;k=zs(k))g++;for(;0<C-g;)E=zs(E),C--;for(;0<g-C;)S=zs(S),g--;for(;C--;){if(E===S||S!==null&&E===S.alternate)break t;E=zs(E),S=zs(S)}E=null}else E=null;y!==null&&Vm(m,x,y,E,!1),w!==null&&_!==null&&Vm(m,_,w,E,!0)}}e:{if(x=f?Ks(f):window,y=x.nodeName&&x.nodeName.toLowerCase(),y==="select"||y==="input"&&x.type==="file")var T=p8;else if(Fm(x))if(zv)T=v8;else{T=m8;var N=g8}else(y=x.nodeName)&&y.toLowerCase()==="input"&&(x.type==="checkbox"||x.type==="radio")&&(T=y8);if(T&&(T=T(t,f))){Dv(m,T,n,h);break e}N&&N(t,x,f),t==="focusout"&&(N=x._wrapperState)&&N.controlled&&x.type==="number"&&a0(x,"number",x.value)}switch(N=f?Ks(f):window,t){case"focusin":(Fm(N)||N.contentEditable==="true")&&(Xs=N,x0=f,ba=null);break;case"focusout":ba=x0=Xs=null;break;case"mousedown":w0=!0;break;case"contextmenu":case"mouseup":case"dragend":w0=!1,Bm(m,n,h);break;case"selectionchange":if(_8)break;case"keydown":case"keyup":Bm(m,n,h)}var L;if(Pp)e:{switch(t){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Hs?jv(t,n)&&(A="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(A="onCompositionStart");A&&(Fv&&n.locale!=="ko"&&(Hs||A!=="onCompositionStart"?A==="onCompositionEnd"&&Hs&&(L=Rv()):(mi=h,Tp="value"in mi?mi.value:mi.textContent,Hs=!0)),N=sc(f,A),0<N.length&&(A=new Am(A,t,null,n,h),m.push({event:A,listeners:N}),L?A.data=L:(L=Ov(n),L!==null&&(A.data=L)))),(L=u8?c8(t,n):d8(t,n))&&(f=sc(f,"onBeforeInput"),0<f.length&&(h=new Am("onBeforeInput","beforeinput",null,n,h),m.push({event:h,listeners:f}),h.data=L))}Kv(m,e)})}function $a(t,e,n){return{instance:t,listener:e,currentTarget:n}}function sc(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Da(t,n),s!=null&&r.unshift($a(t,s,i)),s=Da(t,e),s!=null&&r.push($a(t,s,i))),t=t.return}return r}function zs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Vm(t,e,n,r,i){for(var s=e._reactName,l=[];n!==null&&n!==r;){var c=n,u=c.alternate,f=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&f!==null&&(c=f,i?(u=Da(n,s),u!=null&&l.unshift($a(n,u,c))):i||(u=Da(n,s),u!=null&&l.push($a(n,u,c)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var T8=/\r\n?/g,E8=/\u0000|\uFFFD/g;function Wm(t){return(typeof t=="string"?t:""+t).replace(T8,`
`).replace(E8,"")}function wu(t,e,n){if(e=Wm(e),Wm(t)!==e&&n)throw Error(ne(425))}function oc(){}var _0=null,S0=null;function k0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var C0=typeof setTimeout=="function"?setTimeout:void 0,b8=typeof clearTimeout=="function"?clearTimeout:void 0,$m=typeof Promise=="function"?Promise:void 0,P8=typeof queueMicrotask=="function"?queueMicrotask:typeof $m<"u"?function(t){return $m.resolve(null).then(t).catch(N8)}:C0;function N8(t){setTimeout(function(){throw t})}function yh(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ua(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ua(e)}function _i(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Hm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var To=Math.random().toString(36).slice(2),xr="__reactFiber$"+To,Ha="__reactProps$"+To,Gr="__reactContainer$"+To,T0="__reactEvents$"+To,M8="__reactListeners$"+To,A8="__reactHandles$"+To;function Ji(t){var e=t[xr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Gr]||n[xr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Hm(t);t!==null;){if(n=t[xr])return n;t=Hm(t)}return e}t=n,n=t.parentNode}return null}function ll(t){return t=t[xr]||t[Gr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ks(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ne(33))}function jc(t){return t[Ha]||null}var E0=[],Qs=-1;function Mi(t){return{current:t}}function Ze(t){0>Qs||(t.current=E0[Qs],E0[Qs]=null,Qs--)}function He(t,e){Qs++,E0[Qs]=t.current,t.current=e}var bi={},Xt=Mi(bi),pn=Mi(!1),is=bi;function ho(t,e){var n=t.type.contextTypes;if(!n)return bi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function gn(t){return t=t.childContextTypes,t!=null}function ac(){Ze(pn),Ze(Xt)}function Xm(t,e,n){if(Xt.current!==bi)throw Error(ne(168));He(Xt,e),He(pn,n)}function Zv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ne(108,gx(t)||"Unknown",i));return ot({},n,r)}function lc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||bi,is=Xt.current,He(Xt,t),He(pn,pn.current),!0}function Ym(t,e,n){var r=t.stateNode;if(!r)throw Error(ne(169));n?(t=Zv(t,e,is),r.__reactInternalMemoizedMergedChildContext=t,Ze(pn),Ze(Xt),He(Xt,t)):Ze(pn),He(pn,n)}var Fr=null,Oc=!1,vh=!1;function qv(t){Fr===null?Fr=[t]:Fr.push(t)}function I8(t){Oc=!0,qv(t)}function Ai(){if(!vh&&Fr!==null){vh=!0;var t=0,e=Ue;try{var n=Fr;for(Ue=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Fr=null,Oc=!1}catch(i){throw Fr!==null&&(Fr=Fr.slice(t+1)),kv(_p,Ai),i}finally{Ue=e,vh=!1}}return null}var Zs=[],qs=0,uc=null,cc=0,Fn=[],jn=0,ss=null,jr=1,Or="";function Qi(t,e){Zs[qs++]=cc,Zs[qs++]=uc,uc=t,cc=e}function Jv(t,e,n){Fn[jn++]=jr,Fn[jn++]=Or,Fn[jn++]=ss,ss=t;var r=jr;t=Or;var i=32-nr(r)-1;r&=~(1<<i),n+=1;var s=32-nr(e)+i;if(30<s){var l=i-i%5;s=(r&(1<<l)-1).toString(32),r>>=l,i-=l,jr=1<<32-nr(e)+i|n<<i|r,Or=s+t}else jr=1<<s|n<<i|r,Or=t}function Mp(t){t.return!==null&&(Qi(t,1),Jv(t,1,0))}function Ap(t){for(;t===uc;)uc=Zs[--qs],Zs[qs]=null,cc=Zs[--qs],Zs[qs]=null;for(;t===ss;)ss=Fn[--jn],Fn[jn]=null,Or=Fn[--jn],Fn[jn]=null,jr=Fn[--jn],Fn[jn]=null}var _n=null,wn=null,et=!1,Jn=null;function e3(t,e){var n=Dn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Km(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,_n=t,wn=_i(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,_n=t,wn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ss!==null?{id:jr,overflow:Or}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Dn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,_n=t,wn=null,!0):!1;default:return!1}}function b0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function P0(t){if(et){var e=wn;if(e){var n=e;if(!Km(t,e)){if(b0(t))throw Error(ne(418));e=_i(n.nextSibling);var r=_n;e&&Km(t,e)?e3(r,n):(t.flags=t.flags&-4097|2,et=!1,_n=t)}}else{if(b0(t))throw Error(ne(418));t.flags=t.flags&-4097|2,et=!1,_n=t}}}function Qm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;_n=t}function _u(t){if(t!==_n)return!1;if(!et)return Qm(t),et=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!k0(t.type,t.memoizedProps)),e&&(e=wn)){if(b0(t))throw t3(),Error(ne(418));for(;e;)e3(t,e),e=_i(e.nextSibling)}if(Qm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ne(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){wn=_i(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}wn=null}}else wn=_n?_i(t.stateNode.nextSibling):null;return!0}function t3(){for(var t=wn;t;)t=_i(t.nextSibling)}function po(){wn=_n=null,et=!1}function Ip(t){Jn===null?Jn=[t]:Jn.push(t)}var L8=$r.ReactCurrentBatchConfig;function oa(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ne(309));var r=n.stateNode}if(!r)throw Error(ne(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(l){var c=i.refs;l===null?delete c[s]:c[s]=l},e._stringRef=s,e)}if(typeof t!="string")throw Error(ne(284));if(!n._owner)throw Error(ne(290,t))}return t}function Su(t,e){throw t=Object.prototype.toString.call(e),Error(ne(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Zm(t){var e=t._init;return e(t._payload)}function n3(t){function e(S,C){if(t){var g=S.deletions;g===null?(S.deletions=[C],S.flags|=16):g.push(C)}}function n(S,C){if(!t)return null;for(;C!==null;)e(S,C),C=C.sibling;return null}function r(S,C){for(S=new Map;C!==null;)C.key!==null?S.set(C.key,C):S.set(C.index,C),C=C.sibling;return S}function i(S,C){return S=Ti(S,C),S.index=0,S.sibling=null,S}function s(S,C,g){return S.index=g,t?(g=S.alternate,g!==null?(g=g.index,g<C?(S.flags|=2,C):g):(S.flags|=2,C)):(S.flags|=1048576,C)}function l(S){return t&&S.alternate===null&&(S.flags|=2),S}function c(S,C,g,k){return C===null||C.tag!==6?(C=Th(g,S.mode,k),C.return=S,C):(C=i(C,g),C.return=S,C)}function u(S,C,g,k){var T=g.type;return T===$s?h(S,C,g.props.children,k,g.key):C!==null&&(C.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===di&&Zm(T)===C.type)?(k=i(C,g.props),k.ref=oa(S,C,g),k.return=S,k):(k=$u(g.type,g.key,g.props,null,S.mode,k),k.ref=oa(S,C,g),k.return=S,k)}function f(S,C,g,k){return C===null||C.tag!==4||C.stateNode.containerInfo!==g.containerInfo||C.stateNode.implementation!==g.implementation?(C=Eh(g,S.mode,k),C.return=S,C):(C=i(C,g.children||[]),C.return=S,C)}function h(S,C,g,k,T){return C===null||C.tag!==7?(C=rs(g,S.mode,k,T),C.return=S,C):(C=i(C,g),C.return=S,C)}function m(S,C,g){if(typeof C=="string"&&C!==""||typeof C=="number")return C=Th(""+C,S.mode,g),C.return=S,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case du:return g=$u(C.type,C.key,C.props,null,S.mode,g),g.ref=oa(S,null,C),g.return=S,g;case Ws:return C=Eh(C,S.mode,g),C.return=S,C;case di:var k=C._init;return m(S,k(C._payload),g)}if(va(C)||ta(C))return C=rs(C,S.mode,g,null),C.return=S,C;Su(S,C)}return null}function x(S,C,g,k){var T=C!==null?C.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return T!==null?null:c(S,C,""+g,k);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case du:return g.key===T?u(S,C,g,k):null;case Ws:return g.key===T?f(S,C,g,k):null;case di:return T=g._init,x(S,C,T(g._payload),k)}if(va(g)||ta(g))return T!==null?null:h(S,C,g,k,null);Su(S,g)}return null}function y(S,C,g,k,T){if(typeof k=="string"&&k!==""||typeof k=="number")return S=S.get(g)||null,c(C,S,""+k,T);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case du:return S=S.get(k.key===null?g:k.key)||null,u(C,S,k,T);case Ws:return S=S.get(k.key===null?g:k.key)||null,f(C,S,k,T);case di:var N=k._init;return y(S,C,g,N(k._payload),T)}if(va(k)||ta(k))return S=S.get(g)||null,h(C,S,k,T,null);Su(C,k)}return null}function w(S,C,g,k){for(var T=null,N=null,L=C,A=C=0,R=null;L!==null&&A<g.length;A++){L.index>A?(R=L,L=null):R=L.sibling;var M=x(S,L,g[A],k);if(M===null){L===null&&(L=R);break}t&&L&&M.alternate===null&&e(S,L),C=s(M,C,A),N===null?T=M:N.sibling=M,N=M,L=R}if(A===g.length)return n(S,L),et&&Qi(S,A),T;if(L===null){for(;A<g.length;A++)L=m(S,g[A],k),L!==null&&(C=s(L,C,A),N===null?T=L:N.sibling=L,N=L);return et&&Qi(S,A),T}for(L=r(S,L);A<g.length;A++)R=y(L,S,A,g[A],k),R!==null&&(t&&R.alternate!==null&&L.delete(R.key===null?A:R.key),C=s(R,C,A),N===null?T=R:N.sibling=R,N=R);return t&&L.forEach(function(I){return e(S,I)}),et&&Qi(S,A),T}function E(S,C,g,k){var T=ta(g);if(typeof T!="function")throw Error(ne(150));if(g=T.call(g),g==null)throw Error(ne(151));for(var N=T=null,L=C,A=C=0,R=null,M=g.next();L!==null&&!M.done;A++,M=g.next()){L.index>A?(R=L,L=null):R=L.sibling;var I=x(S,L,M.value,k);if(I===null){L===null&&(L=R);break}t&&L&&I.alternate===null&&e(S,L),C=s(I,C,A),N===null?T=I:N.sibling=I,N=I,L=R}if(M.done)return n(S,L),et&&Qi(S,A),T;if(L===null){for(;!M.done;A++,M=g.next())M=m(S,M.value,k),M!==null&&(C=s(M,C,A),N===null?T=M:N.sibling=M,N=M);return et&&Qi(S,A),T}for(L=r(S,L);!M.done;A++,M=g.next())M=y(L,S,A,M.value,k),M!==null&&(t&&M.alternate!==null&&L.delete(M.key===null?A:M.key),C=s(M,C,A),N===null?T=M:N.sibling=M,N=M);return t&&L.forEach(function(O){return e(S,O)}),et&&Qi(S,A),T}function _(S,C,g,k){if(typeof g=="object"&&g!==null&&g.type===$s&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case du:e:{for(var T=g.key,N=C;N!==null;){if(N.key===T){if(T=g.type,T===$s){if(N.tag===7){n(S,N.sibling),C=i(N,g.props.children),C.return=S,S=C;break e}}else if(N.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===di&&Zm(T)===N.type){n(S,N.sibling),C=i(N,g.props),C.ref=oa(S,N,g),C.return=S,S=C;break e}n(S,N);break}else e(S,N);N=N.sibling}g.type===$s?(C=rs(g.props.children,S.mode,k,g.key),C.return=S,S=C):(k=$u(g.type,g.key,g.props,null,S.mode,k),k.ref=oa(S,C,g),k.return=S,S=k)}return l(S);case Ws:e:{for(N=g.key;C!==null;){if(C.key===N)if(C.tag===4&&C.stateNode.containerInfo===g.containerInfo&&C.stateNode.implementation===g.implementation){n(S,C.sibling),C=i(C,g.children||[]),C.return=S,S=C;break e}else{n(S,C);break}else e(S,C);C=C.sibling}C=Eh(g,S.mode,k),C.return=S,S=C}return l(S);case di:return N=g._init,_(S,C,N(g._payload),k)}if(va(g))return w(S,C,g,k);if(ta(g))return E(S,C,g,k);Su(S,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,C!==null&&C.tag===6?(n(S,C.sibling),C=i(C,g),C.return=S,S=C):(n(S,C),C=Th(g,S.mode,k),C.return=S,S=C),l(S)):n(S,C)}return _}var go=n3(!0),r3=n3(!1),dc=Mi(null),fc=null,Js=null,Lp=null;function Rp(){Lp=Js=fc=null}function Fp(t){var e=dc.current;Ze(dc),t._currentValue=e}function N0(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ao(t,e){fc=t,Lp=Js=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(fn=!0),t.firstContext=null)}function Bn(t){var e=t._currentValue;if(Lp!==t)if(t={context:t,memoizedValue:e,next:null},Js===null){if(fc===null)throw Error(ne(308));Js=t,fc.dependencies={lanes:0,firstContext:t}}else Js=Js.next=t;return e}var es=null;function jp(t){es===null?es=[t]:es.push(t)}function i3(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,jp(e)):(n.next=i.next,i.next=n),e.interleaved=n,Vr(t,r)}function Vr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var fi=!1;function Op(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function s3(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Dr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Si(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,je&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Vr(t,n)}return i=r.interleaved,i===null?(e.next=e,jp(r)):(e.next=i.next,i.next=e),r.interleaved=e,Vr(t,n)}function zu(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sp(t,n)}}function qm(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=l:s=s.next=l,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hc(t,e,n,r){var i=t.updateQueue;fi=!1;var s=i.firstBaseUpdate,l=i.lastBaseUpdate,c=i.shared.pending;if(c!==null){i.shared.pending=null;var u=c,f=u.next;u.next=null,l===null?s=f:l.next=f,l=u;var h=t.alternate;h!==null&&(h=h.updateQueue,c=h.lastBaseUpdate,c!==l&&(c===null?h.firstBaseUpdate=f:c.next=f,h.lastBaseUpdate=u))}if(s!==null){var m=i.baseState;l=0,h=f=u=null,c=s;do{var x=c.lane,y=c.eventTime;if((r&x)===x){h!==null&&(h=h.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var w=t,E=c;switch(x=e,y=n,E.tag){case 1:if(w=E.payload,typeof w=="function"){m=w.call(y,m,x);break e}m=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=E.payload,x=typeof w=="function"?w.call(y,m,x):w,x==null)break e;m=ot({},m,x);break e;case 2:fi=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,x=i.effects,x===null?i.effects=[c]:x.push(c))}else y={eventTime:y,lane:x,tag:c.tag,payload:c.payload,callback:c.callback,next:null},h===null?(f=h=y,u=m):h=h.next=y,l|=x;if(c=c.next,c===null){if(c=i.shared.pending,c===null)break;x=c,c=x.next,x.next=null,i.lastBaseUpdate=x,i.shared.pending=null}}while(1);if(h===null&&(u=m),i.baseState=u,i.firstBaseUpdate=f,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do l|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);as|=l,t.lanes=l,t.memoizedState=m}}function Jm(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(ne(191,i));i.call(r)}}}var ul={},kr=Mi(ul),Xa=Mi(ul),Ya=Mi(ul);function ts(t){if(t===ul)throw Error(ne(174));return t}function Dp(t,e){switch(He(Ya,e),He(Xa,t),He(kr,ul),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:u0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=u0(e,t)}Ze(kr),He(kr,e)}function mo(){Ze(kr),Ze(Xa),Ze(Ya)}function o3(t){ts(Ya.current);var e=ts(kr.current),n=u0(e,t.type);e!==n&&(He(Xa,t),He(kr,n))}function zp(t){Xa.current===t&&(Ze(kr),Ze(Xa))}var it=Mi(0);function pc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xh=[];function Bp(){for(var t=0;t<xh.length;t++)xh[t]._workInProgressVersionPrimary=null;xh.length=0}var Bu=$r.ReactCurrentDispatcher,wh=$r.ReactCurrentBatchConfig,os=0,st=null,xt=null,bt=null,gc=!1,Pa=!1,Ka=0,R8=0;function Vt(){throw Error(ne(321))}function Up(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!sr(t[n],e[n]))return!1;return!0}function Gp(t,e,n,r,i,s){if(os=s,st=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bu.current=t===null||t.memoizedState===null?D8:z8,t=n(r,i),Pa){s=0;do{if(Pa=!1,Ka=0,25<=s)throw Error(ne(301));s+=1,bt=xt=null,e.updateQueue=null,Bu.current=B8,t=n(r,i)}while(Pa)}if(Bu.current=mc,e=xt!==null&&xt.next!==null,os=0,bt=xt=st=null,gc=!1,e)throw Error(ne(300));return t}function Vp(){var t=Ka!==0;return Ka=0,t}function yr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?st.memoizedState=bt=t:bt=bt.next=t,bt}function Un(){if(xt===null){var t=st.alternate;t=t!==null?t.memoizedState:null}else t=xt.next;var e=bt===null?st.memoizedState:bt.next;if(e!==null)bt=e,xt=t;else{if(t===null)throw Error(ne(310));xt=t,t={memoizedState:xt.memoizedState,baseState:xt.baseState,baseQueue:xt.baseQueue,queue:xt.queue,next:null},bt===null?st.memoizedState=bt=t:bt=bt.next=t}return bt}function Qa(t,e){return typeof e=="function"?e(t):e}function _h(t){var e=Un(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var r=xt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var l=i.next;i.next=s.next,s.next=l}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var c=l=null,u=null,f=s;do{var h=f.lane;if((os&h)===h)u!==null&&(u=u.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),r=f.hasEagerState?f.eagerState:t(r,f.action);else{var m={lane:h,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};u===null?(c=u=m,l=r):u=u.next=m,st.lanes|=h,as|=h}f=f.next}while(f!==null&&f!==s);u===null?l=r:u.next=c,sr(r,e.memoizedState)||(fn=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,st.lanes|=s,as|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Sh(t){var e=Un(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var l=i=i.next;do s=t(s,l.action),l=l.next;while(l!==i);sr(s,e.memoizedState)||(fn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function a3(){}function l3(t,e){var n=st,r=Un(),i=e(),s=!sr(r.memoizedState,i);if(s&&(r.memoizedState=i,fn=!0),r=r.queue,Wp(d3.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||bt!==null&&bt.memoizedState.tag&1){if(n.flags|=2048,Za(9,c3.bind(null,n,r,i,e),void 0,null),Pt===null)throw Error(ne(349));os&30||u3(n,e,i)}return i}function u3(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=st.updateQueue,e===null?(e={lastEffect:null,stores:null},st.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function c3(t,e,n,r){e.value=n,e.getSnapshot=r,f3(e)&&h3(t)}function d3(t,e,n){return n(function(){f3(e)&&h3(t)})}function f3(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!sr(t,n)}catch{return!0}}function h3(t){var e=Vr(t,1);e!==null&&rr(e,t,1,-1)}function ey(t){var e=yr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qa,lastRenderedState:t},e.queue=t,t=t.dispatch=O8.bind(null,st,t),[e.memoizedState,t]}function Za(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=st.updateQueue,e===null?(e={lastEffect:null,stores:null},st.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function p3(){return Un().memoizedState}function Uu(t,e,n,r){var i=yr();st.flags|=t,i.memoizedState=Za(1|e,n,void 0,r===void 0?null:r)}function Dc(t,e,n,r){var i=Un();r=r===void 0?null:r;var s=void 0;if(xt!==null){var l=xt.memoizedState;if(s=l.destroy,r!==null&&Up(r,l.deps)){i.memoizedState=Za(e,n,s,r);return}}st.flags|=t,i.memoizedState=Za(1|e,n,s,r)}function ty(t,e){return Uu(8390656,8,t,e)}function Wp(t,e){return Dc(2048,8,t,e)}function g3(t,e){return Dc(4,2,t,e)}function m3(t,e){return Dc(4,4,t,e)}function y3(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function v3(t,e,n){return n=n!=null?n.concat([t]):null,Dc(4,4,y3.bind(null,e,t),n)}function $p(){}function x3(t,e){var n=Un();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Up(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function w3(t,e){var n=Un();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Up(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function _3(t,e,n){return os&21?(sr(n,e)||(n=Ev(),st.lanes|=n,as|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,fn=!0),t.memoizedState=n)}function F8(t,e){var n=Ue;Ue=n!==0&&4>n?n:4,t(!0);var r=wh.transition;wh.transition={};try{t(!1),e()}finally{Ue=n,wh.transition=r}}function S3(){return Un().memoizedState}function j8(t,e,n){var r=Ci(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},k3(t))C3(e,n);else if(n=i3(t,e,n,r),n!==null){var i=Zt();rr(n,t,r,i),T3(n,e,r)}}function O8(t,e,n){var r=Ci(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(k3(t))C3(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var l=e.lastRenderedState,c=s(l,n);if(i.hasEagerState=!0,i.eagerState=c,sr(c,l)){var u=e.interleaved;u===null?(i.next=i,jp(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=i3(t,e,i,r),n!==null&&(i=Zt(),rr(n,t,r,i),T3(n,e,r))}}function k3(t){var e=t.alternate;return t===st||e!==null&&e===st}function C3(t,e){Pa=gc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function T3(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sp(t,n)}}var mc={readContext:Bn,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useInsertionEffect:Vt,useLayoutEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useMutableSource:Vt,useSyncExternalStore:Vt,useId:Vt,unstable_isNewReconciler:!1},D8={readContext:Bn,useCallback:function(t,e){return yr().memoizedState=[t,e===void 0?null:e],t},useContext:Bn,useEffect:ty,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Uu(4194308,4,y3.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Uu(4194308,4,t,e)},useInsertionEffect:function(t,e){return Uu(4,2,t,e)},useMemo:function(t,e){var n=yr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=yr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=j8.bind(null,st,t),[r.memoizedState,t]},useRef:function(t){var e=yr();return t={current:t},e.memoizedState=t},useState:ey,useDebugValue:$p,useDeferredValue:function(t){return yr().memoizedState=t},useTransition:function(){var t=ey(!1),e=t[0];return t=F8.bind(null,t[1]),yr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=st,i=yr();if(et){if(n===void 0)throw Error(ne(407));n=n()}else{if(n=e(),Pt===null)throw Error(ne(349));os&30||u3(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,ty(d3.bind(null,r,s,t),[t]),r.flags|=2048,Za(9,c3.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=yr(),e=Pt.identifierPrefix;if(et){var n=Or,r=jr;n=(r&~(1<<32-nr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ka++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=R8++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},z8={readContext:Bn,useCallback:x3,useContext:Bn,useEffect:Wp,useImperativeHandle:v3,useInsertionEffect:g3,useLayoutEffect:m3,useMemo:w3,useReducer:_h,useRef:p3,useState:function(){return _h(Qa)},useDebugValue:$p,useDeferredValue:function(t){var e=Un();return _3(e,xt.memoizedState,t)},useTransition:function(){var t=_h(Qa)[0],e=Un().memoizedState;return[t,e]},useMutableSource:a3,useSyncExternalStore:l3,useId:S3,unstable_isNewReconciler:!1},B8={readContext:Bn,useCallback:x3,useContext:Bn,useEffect:Wp,useImperativeHandle:v3,useInsertionEffect:g3,useLayoutEffect:m3,useMemo:w3,useReducer:Sh,useRef:p3,useState:function(){return Sh(Qa)},useDebugValue:$p,useDeferredValue:function(t){var e=Un();return xt===null?e.memoizedState=t:_3(e,xt.memoizedState,t)},useTransition:function(){var t=Sh(Qa)[0],e=Un().memoizedState;return[t,e]},useMutableSource:a3,useSyncExternalStore:l3,useId:S3,unstable_isNewReconciler:!1};function Zn(t,e){if(t&&t.defaultProps){e=ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function M0(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var zc={isMounted:function(t){return(t=t._reactInternals)?cs(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Zt(),i=Ci(t),s=Dr(r,i);s.payload=e,n!=null&&(s.callback=n),e=Si(t,s,i),e!==null&&(rr(e,t,i,r),zu(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Zt(),i=Ci(t),s=Dr(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Si(t,s,i),e!==null&&(rr(e,t,i,r),zu(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zt(),r=Ci(t),i=Dr(n,r);i.tag=2,e!=null&&(i.callback=e),e=Si(t,i,r),e!==null&&(rr(e,t,r,n),zu(e,t,r))}};function ny(t,e,n,r,i,s,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,l):e.prototype&&e.prototype.isPureReactComponent?!Va(n,r)||!Va(i,s):!0}function E3(t,e,n){var r=!1,i=bi,s=e.contextType;return typeof s=="object"&&s!==null?s=Bn(s):(i=gn(e)?is:Xt.current,r=e.contextTypes,s=(r=r!=null)?ho(t,i):bi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=zc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function ry(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&zc.enqueueReplaceState(e,e.state,null)}function A0(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Op(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Bn(s):(s=gn(e)?is:Xt.current,i.context=ho(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(M0(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&zc.enqueueReplaceState(i,i.state,null),hc(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function yo(t,e){try{var n="",r=e;do n+=px(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function kh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function I0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var U8=typeof WeakMap=="function"?WeakMap:Map;function b3(t,e,n){n=Dr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){vc||(vc=!0,G0=r),I0(t,e)},n}function P3(t,e,n){n=Dr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){I0(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){I0(t,e),typeof r!="function"&&(ki===null?ki=new Set([this]):ki.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function iy(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new U8;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=tw.bind(null,t,e,n),e.then(t,t))}function sy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function oy(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Dr(-1,1),e.tag=2,Si(n,e,1))),n.lanes|=1),t)}var G8=$r.ReactCurrentOwner,fn=!1;function Qt(t,e,n,r){e.child=t===null?r3(e,null,n,r):go(e,t.child,n,r)}function ay(t,e,n,r,i){n=n.render;var s=e.ref;return ao(e,i),r=Gp(t,e,n,r,s,i),n=Vp(),t!==null&&!fn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Wr(t,e,i)):(et&&n&&Mp(e),e.flags|=1,Qt(t,e,r,i),e.child)}function ly(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Jp(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,N3(t,e,s,r,i)):(t=$u(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var l=s.memoizedProps;if(n=n.compare,n=n!==null?n:Va,n(l,r)&&t.ref===e.ref)return Wr(t,e,i)}return e.flags|=1,t=Ti(s,r),t.ref=e.ref,t.return=e,e.child=t}function N3(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Va(s,r)&&t.ref===e.ref)if(fn=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(fn=!0);else return e.lanes=t.lanes,Wr(t,e,i)}return L0(t,e,n,r,i)}function M3(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},He(to,xn),xn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,He(to,xn),xn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,He(to,xn),xn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,He(to,xn),xn|=r;return Qt(t,e,i,n),e.child}function A3(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function L0(t,e,n,r,i){var s=gn(n)?is:Xt.current;return s=ho(e,s),ao(e,i),n=Gp(t,e,n,r,s,i),r=Vp(),t!==null&&!fn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Wr(t,e,i)):(et&&r&&Mp(e),e.flags|=1,Qt(t,e,n,i),e.child)}function uy(t,e,n,r,i){if(gn(n)){var s=!0;lc(e)}else s=!1;if(ao(e,i),e.stateNode===null)Gu(t,e),E3(e,n,r),A0(e,n,r,i),r=!0;else if(t===null){var l=e.stateNode,c=e.memoizedProps;l.props=c;var u=l.context,f=n.contextType;typeof f=="object"&&f!==null?f=Bn(f):(f=gn(n)?is:Xt.current,f=ho(e,f));var h=n.getDerivedStateFromProps,m=typeof h=="function"||typeof l.getSnapshotBeforeUpdate=="function";m||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||u!==f)&&ry(e,l,r,f),fi=!1;var x=e.memoizedState;l.state=x,hc(e,r,l,i),u=e.memoizedState,c!==r||x!==u||pn.current||fi?(typeof h=="function"&&(M0(e,n,h,r),u=e.memoizedState),(c=fi||ny(e,n,c,r,x,u,f))?(m||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),l.props=r,l.state=u,l.context=f,r=c):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{l=e.stateNode,s3(t,e),c=e.memoizedProps,f=e.type===e.elementType?c:Zn(e.type,c),l.props=f,m=e.pendingProps,x=l.context,u=n.contextType,typeof u=="object"&&u!==null?u=Bn(u):(u=gn(n)?is:Xt.current,u=ho(e,u));var y=n.getDerivedStateFromProps;(h=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==m||x!==u)&&ry(e,l,r,u),fi=!1,x=e.memoizedState,l.state=x,hc(e,r,l,i);var w=e.memoizedState;c!==m||x!==w||pn.current||fi?(typeof y=="function"&&(M0(e,n,y,r),w=e.memoizedState),(f=fi||ny(e,n,f,r,x,w,u)||!1)?(h||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,w,u),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,w,u)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),l.props=r,l.state=w,l.context=u,r=f):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&x===t.memoizedState||(e.flags|=1024),r=!1)}return R0(t,e,n,r,s,i)}function R0(t,e,n,r,i,s){A3(t,e);var l=(e.flags&128)!==0;if(!r&&!l)return i&&Ym(e,n,!1),Wr(t,e,s);r=e.stateNode,G8.current=e;var c=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&l?(e.child=go(e,t.child,null,s),e.child=go(e,null,c,s)):Qt(t,e,c,s),e.memoizedState=r.state,i&&Ym(e,n,!0),e.child}function I3(t){var e=t.stateNode;e.pendingContext?Xm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Xm(t,e.context,!1),Dp(t,e.containerInfo)}function cy(t,e,n,r,i){return po(),Ip(i),e.flags|=256,Qt(t,e,n,r),e.child}var F0={dehydrated:null,treeContext:null,retryLane:0};function j0(t){return{baseLanes:t,cachePool:null,transitions:null}}function L3(t,e,n){var r=e.pendingProps,i=it.current,s=!1,l=(e.flags&128)!==0,c;if((c=l)||(c=t!==null&&t.memoizedState===null?!1:(i&2)!==0),c?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),He(it,i&1),t===null)return P0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,t=r.fallback,s?(r=e.mode,s=e.child,l={mode:"hidden",children:l},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=l):s=Gc(l,r,0,null),t=rs(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=j0(n),e.memoizedState=F0,t):Hp(e,l));if(i=t.memoizedState,i!==null&&(c=i.dehydrated,c!==null))return V8(t,e,l,r,c,i,n);if(s){s=r.fallback,l=e.mode,i=t.child,c=i.sibling;var u={mode:"hidden",children:r.children};return!(l&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Ti(i,u),r.subtreeFlags=i.subtreeFlags&14680064),c!==null?s=Ti(c,s):(s=rs(s,l,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,l=t.child.memoizedState,l=l===null?j0(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=t.childLanes&~n,e.memoizedState=F0,r}return s=t.child,t=s.sibling,r=Ti(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Hp(t,e){return e=Gc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ku(t,e,n,r){return r!==null&&Ip(r),go(e,t.child,null,n),t=Hp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function V8(t,e,n,r,i,s,l){if(n)return e.flags&256?(e.flags&=-257,r=kh(Error(ne(422))),ku(t,e,l,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Gc({mode:"visible",children:r.children},i,0,null),s=rs(s,i,l,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&go(e,t.child,null,l),e.child.memoizedState=j0(l),e.memoizedState=F0,s);if(!(e.mode&1))return ku(t,e,l,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var c=r.dgst;return r=c,s=Error(ne(419)),r=kh(s,r,void 0),ku(t,e,l,r)}if(c=(l&t.childLanes)!==0,fn||c){if(r=Pt,r!==null){switch(l&-l){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|l)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Vr(t,i),rr(r,t,i,-1))}return qp(),r=kh(Error(ne(421))),ku(t,e,l,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=nw.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,wn=_i(i.nextSibling),_n=e,et=!0,Jn=null,t!==null&&(Fn[jn++]=jr,Fn[jn++]=Or,Fn[jn++]=ss,jr=t.id,Or=t.overflow,ss=e),e=Hp(e,r.children),e.flags|=4096,e)}function dy(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),N0(t.return,e,n)}function Ch(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function R3(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Qt(t,e,r.children,n),r=it.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&dy(t,n,e);else if(t.tag===19)dy(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(He(it,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&pc(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Ch(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&pc(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Ch(e,!0,n,null,s);break;case"together":Ch(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gu(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Wr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),as|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ne(153));if(e.child!==null){for(t=e.child,n=Ti(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ti(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function W8(t,e,n){switch(e.tag){case 3:I3(e),po();break;case 5:o3(e);break;case 1:gn(e.type)&&lc(e);break;case 4:Dp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;He(dc,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(He(it,it.current&1),e.flags|=128,null):n&e.child.childLanes?L3(t,e,n):(He(it,it.current&1),t=Wr(t,e,n),t!==null?t.sibling:null);He(it,it.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return R3(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),He(it,it.current),r)break;return null;case 22:case 23:return e.lanes=0,M3(t,e,n)}return Wr(t,e,n)}var F3,O0,j3,O3;F3=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};O0=function(){};j3=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ts(kr.current);var s=null;switch(n){case"input":i=s0(t,i),r=s0(t,r),s=[];break;case"select":i=ot({},i,{value:void 0}),r=ot({},r,{value:void 0}),s=[];break;case"textarea":i=l0(t,i),r=l0(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=oc)}c0(n,r);var l;n=null;for(f in i)if(!r.hasOwnProperty(f)&&i.hasOwnProperty(f)&&i[f]!=null)if(f==="style"){var c=i[f];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(ja.hasOwnProperty(f)?s||(s=[]):(s=s||[]).push(f,null));for(f in r){var u=r[f];if(c=i!=null?i[f]:void 0,r.hasOwnProperty(f)&&u!==c&&(u!=null||c!=null))if(f==="style")if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(n||(n={}),n[l]=u[l])}else n||(s||(s=[]),s.push(f,n)),n=u;else f==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(s=s||[]).push(f,u)):f==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(f,""+u):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(ja.hasOwnProperty(f)?(u!=null&&f==="onScroll"&&Qe("scroll",t),s||c===u||(s=[])):(s=s||[]).push(f,u))}n&&(s=s||[]).push("style",n);var f=s;(e.updateQueue=f)&&(e.flags|=4)}};O3=function(t,e,n,r){n!==r&&(e.flags|=4)};function aa(t,e){if(!et)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Wt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function $8(t,e,n){var r=e.pendingProps;switch(Ap(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(e),null;case 1:return gn(e.type)&&ac(),Wt(e),null;case 3:return r=e.stateNode,mo(),Ze(pn),Ze(Xt),Bp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(_u(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Jn!==null&&($0(Jn),Jn=null))),O0(t,e),Wt(e),null;case 5:zp(e);var i=ts(Ya.current);if(n=e.type,t!==null&&e.stateNode!=null)j3(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ne(166));return Wt(e),null}if(t=ts(kr.current),_u(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[xr]=e,r[Ha]=s,t=(e.mode&1)!==0,n){case"dialog":Qe("cancel",r),Qe("close",r);break;case"iframe":case"object":case"embed":Qe("load",r);break;case"video":case"audio":for(i=0;i<wa.length;i++)Qe(wa[i],r);break;case"source":Qe("error",r);break;case"img":case"image":case"link":Qe("error",r),Qe("load",r);break;case"details":Qe("toggle",r);break;case"input":wm(r,s),Qe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Qe("invalid",r);break;case"textarea":Sm(r,s),Qe("invalid",r)}c0(n,s),i=null;for(var l in s)if(s.hasOwnProperty(l)){var c=s[l];l==="children"?typeof c=="string"?r.textContent!==c&&(s.suppressHydrationWarning!==!0&&wu(r.textContent,c,t),i=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(s.suppressHydrationWarning!==!0&&wu(r.textContent,c,t),i=["children",""+c]):ja.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&Qe("scroll",r)}switch(n){case"input":fu(r),_m(r,s,!0);break;case"textarea":fu(r),km(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=oc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{l=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=dv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),n==="select"&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[xr]=e,t[Ha]=r,F3(t,e,!1,!1),e.stateNode=t;e:{switch(l=d0(n,r),n){case"dialog":Qe("cancel",t),Qe("close",t),i=r;break;case"iframe":case"object":case"embed":Qe("load",t),i=r;break;case"video":case"audio":for(i=0;i<wa.length;i++)Qe(wa[i],t);i=r;break;case"source":Qe("error",t),i=r;break;case"img":case"image":case"link":Qe("error",t),Qe("load",t),i=r;break;case"details":Qe("toggle",t),i=r;break;case"input":wm(t,r),i=s0(t,r),Qe("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ot({},r,{value:void 0}),Qe("invalid",t);break;case"textarea":Sm(t,r),i=l0(t,r),Qe("invalid",t);break;default:i=r}c0(n,i),c=i;for(s in c)if(c.hasOwnProperty(s)){var u=c[s];s==="style"?pv(t,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&fv(t,u)):s==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Oa(t,u):typeof u=="number"&&Oa(t,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ja.hasOwnProperty(s)?u!=null&&s==="onScroll"&&Qe("scroll",t):u!=null&&mp(t,s,u,l))}switch(n){case"input":fu(t),_m(t,r,!1);break;case"textarea":fu(t),km(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ei(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?ro(t,!!r.multiple,s,!1):r.defaultValue!=null&&ro(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=oc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Wt(e),null;case 6:if(t&&e.stateNode!=null)O3(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ne(166));if(n=ts(Ya.current),ts(kr.current),_u(e)){if(r=e.stateNode,n=e.memoizedProps,r[xr]=e,(s=r.nodeValue!==n)&&(t=_n,t!==null))switch(t.tag){case 3:wu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&wu(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[xr]=e,e.stateNode=r}return Wt(e),null;case 13:if(Ze(it),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(et&&wn!==null&&e.mode&1&&!(e.flags&128))t3(),po(),e.flags|=98560,s=!1;else if(s=_u(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(ne(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ne(317));s[xr]=e}else po(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Wt(e),s=!1}else Jn!==null&&($0(Jn),Jn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||it.current&1?wt===0&&(wt=3):qp())),e.updateQueue!==null&&(e.flags|=4),Wt(e),null);case 4:return mo(),O0(t,e),t===null&&Wa(e.stateNode.containerInfo),Wt(e),null;case 10:return Fp(e.type._context),Wt(e),null;case 17:return gn(e.type)&&ac(),Wt(e),null;case 19:if(Ze(it),s=e.memoizedState,s===null)return Wt(e),null;if(r=(e.flags&128)!==0,l=s.rendering,l===null)if(r)aa(s,!1);else{if(wt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=pc(t),l!==null){for(e.flags|=128,aa(s,!1),r=l.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,l=s.alternate,l===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,t=l.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return He(it,it.current&1|2),e.child}t=t.sibling}s.tail!==null&&ft()>vo&&(e.flags|=128,r=!0,aa(s,!1),e.lanes=4194304)}else{if(!r)if(t=pc(l),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),aa(s,!0),s.tail===null&&s.tailMode==="hidden"&&!l.alternate&&!et)return Wt(e),null}else 2*ft()-s.renderingStartTime>vo&&n!==1073741824&&(e.flags|=128,r=!0,aa(s,!1),e.lanes=4194304);s.isBackwards?(l.sibling=e.child,e.child=l):(n=s.last,n!==null?n.sibling=l:e.child=l,s.last=l)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ft(),e.sibling=null,n=it.current,He(it,r?n&1|2:n&1),e):(Wt(e),null);case 22:case 23:return Zp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?xn&1073741824&&(Wt(e),e.subtreeFlags&6&&(e.flags|=8192)):Wt(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function H8(t,e){switch(Ap(e),e.tag){case 1:return gn(e.type)&&ac(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mo(),Ze(pn),Ze(Xt),Bp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return zp(e),null;case 13:if(Ze(it),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));po()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ze(it),null;case 4:return mo(),null;case 10:return Fp(e.type._context),null;case 22:case 23:return Zp(),null;case 24:return null;default:return null}}var Cu=!1,Ht=!1,X8=typeof WeakSet=="function"?WeakSet:Set,fe=null;function eo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){lt(t,e,r)}else n.current=null}function D0(t,e,n){try{n()}catch(r){lt(t,e,r)}}var fy=!1;function Y8(t,e){if(_0=rc,t=Gv(),Np(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var l=0,c=-1,u=-1,f=0,h=0,m=t,x=null;t:for(;;){for(var y;m!==n||i!==0&&m.nodeType!==3||(c=l+i),m!==s||r!==0&&m.nodeType!==3||(u=l+r),m.nodeType===3&&(l+=m.nodeValue.length),(y=m.firstChild)!==null;)x=m,m=y;for(;;){if(m===t)break t;if(x===n&&++f===i&&(c=l),x===s&&++h===r&&(u=l),(y=m.nextSibling)!==null)break;m=x,x=m.parentNode}m=y}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(S0={focusedElem:t,selectionRange:n},rc=!1,fe=e;fe!==null;)if(e=fe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,fe=t;else for(;fe!==null;){e=fe;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var E=w.memoizedProps,_=w.memoizedState,S=e.stateNode,C=S.getSnapshotBeforeUpdate(e.elementType===e.type?E:Zn(e.type,E),_);S.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(k){lt(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,fe=t;break}fe=e.return}return w=fy,fy=!1,w}function Na(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&D0(e,n,s)}i=i.next}while(i!==r)}}function Bc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function z0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function D3(t){var e=t.alternate;e!==null&&(t.alternate=null,D3(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[xr],delete e[Ha],delete e[T0],delete e[M8],delete e[A8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function z3(t){return t.tag===5||t.tag===3||t.tag===4}function hy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||z3(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function B0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=oc));else if(r!==4&&(t=t.child,t!==null))for(B0(t,e,n),t=t.sibling;t!==null;)B0(t,e,n),t=t.sibling}function U0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(U0(t,e,n),t=t.sibling;t!==null;)U0(t,e,n),t=t.sibling}var Lt=null,qn=!1;function li(t,e,n){for(n=n.child;n!==null;)B3(t,e,n),n=n.sibling}function B3(t,e,n){if(Sr&&typeof Sr.onCommitFiberUnmount=="function")try{Sr.onCommitFiberUnmount(Ic,n)}catch{}switch(n.tag){case 5:Ht||eo(n,e);case 6:var r=Lt,i=qn;Lt=null,li(t,e,n),Lt=r,qn=i,Lt!==null&&(qn?(t=Lt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Lt.removeChild(n.stateNode));break;case 18:Lt!==null&&(qn?(t=Lt,n=n.stateNode,t.nodeType===8?yh(t.parentNode,n):t.nodeType===1&&yh(t,n),Ua(t)):yh(Lt,n.stateNode));break;case 4:r=Lt,i=qn,Lt=n.stateNode.containerInfo,qn=!0,li(t,e,n),Lt=r,qn=i;break;case 0:case 11:case 14:case 15:if(!Ht&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,l=s.destroy;s=s.tag,l!==void 0&&(s&2||s&4)&&D0(n,e,l),i=i.next}while(i!==r)}li(t,e,n);break;case 1:if(!Ht&&(eo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){lt(n,e,c)}li(t,e,n);break;case 21:li(t,e,n);break;case 22:n.mode&1?(Ht=(r=Ht)||n.memoizedState!==null,li(t,e,n),Ht=r):li(t,e,n);break;default:li(t,e,n)}}function py(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new X8),e.forEach(function(r){var i=rw.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Kn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,l=e,c=l;e:for(;c!==null;){switch(c.tag){case 5:Lt=c.stateNode,qn=!1;break e;case 3:Lt=c.stateNode.containerInfo,qn=!0;break e;case 4:Lt=c.stateNode.containerInfo,qn=!0;break e}c=c.return}if(Lt===null)throw Error(ne(160));B3(s,l,i),Lt=null,qn=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(f){lt(i,e,f)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)U3(e,t),e=e.sibling}function U3(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Kn(e,t),mr(t),r&4){try{Na(3,t,t.return),Bc(3,t)}catch(E){lt(t,t.return,E)}try{Na(5,t,t.return)}catch(E){lt(t,t.return,E)}}break;case 1:Kn(e,t),mr(t),r&512&&n!==null&&eo(n,n.return);break;case 5:if(Kn(e,t),mr(t),r&512&&n!==null&&eo(n,n.return),t.flags&32){var i=t.stateNode;try{Oa(i,"")}catch(E){lt(t,t.return,E)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,l=n!==null?n.memoizedProps:s,c=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{c==="input"&&s.type==="radio"&&s.name!=null&&uv(i,s),d0(c,l);var f=d0(c,s);for(l=0;l<u.length;l+=2){var h=u[l],m=u[l+1];h==="style"?pv(i,m):h==="dangerouslySetInnerHTML"?fv(i,m):h==="children"?Oa(i,m):mp(i,h,m,f)}switch(c){case"input":o0(i,s);break;case"textarea":cv(i,s);break;case"select":var x=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var y=s.value;y!=null?ro(i,!!s.multiple,y,!1):x!==!!s.multiple&&(s.defaultValue!=null?ro(i,!!s.multiple,s.defaultValue,!0):ro(i,!!s.multiple,s.multiple?[]:"",!1))}i[Ha]=s}catch(E){lt(t,t.return,E)}}break;case 6:if(Kn(e,t),mr(t),r&4){if(t.stateNode===null)throw Error(ne(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(E){lt(t,t.return,E)}}break;case 3:if(Kn(e,t),mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ua(e.containerInfo)}catch(E){lt(t,t.return,E)}break;case 4:Kn(e,t),mr(t);break;case 13:Kn(e,t),mr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Kp=ft())),r&4&&py(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Ht=(f=Ht)||h,Kn(e,t),Ht=f):Kn(e,t),mr(t),r&8192){if(f=t.memoizedState!==null,(t.stateNode.isHidden=f)&&!h&&t.mode&1)for(fe=t,h=t.child;h!==null;){for(m=fe=h;fe!==null;){switch(x=fe,y=x.child,x.tag){case 0:case 11:case 14:case 15:Na(4,x,x.return);break;case 1:eo(x,x.return);var w=x.stateNode;if(typeof w.componentWillUnmount=="function"){r=x,n=x.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(E){lt(r,n,E)}}break;case 5:eo(x,x.return);break;case 22:if(x.memoizedState!==null){my(m);continue}}y!==null?(y.return=x,fe=y):my(m)}h=h.sibling}e:for(h=null,m=t;;){if(m.tag===5){if(h===null){h=m;try{i=m.stateNode,f?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(c=m.stateNode,u=m.memoizedProps.style,l=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=hv("display",l))}catch(E){lt(t,t.return,E)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=f?"":m.memoizedProps}catch(E){lt(t,t.return,E)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Kn(e,t),mr(t),r&4&&py(t);break;case 21:break;default:Kn(e,t),mr(t)}}function mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(z3(n)){var r=n;break e}n=n.return}throw Error(ne(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Oa(i,""),r.flags&=-33);var s=hy(t);U0(t,s,i);break;case 3:case 4:var l=r.stateNode.containerInfo,c=hy(t);B0(t,c,l);break;default:throw Error(ne(161))}}catch(u){lt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function K8(t,e,n){fe=t,G3(t)}function G3(t,e,n){for(var r=(t.mode&1)!==0;fe!==null;){var i=fe,s=i.child;if(i.tag===22&&r){var l=i.memoizedState!==null||Cu;if(!l){var c=i.alternate,u=c!==null&&c.memoizedState!==null||Ht;c=Cu;var f=Ht;if(Cu=l,(Ht=u)&&!f)for(fe=i;fe!==null;)l=fe,u=l.child,l.tag===22&&l.memoizedState!==null?yy(i):u!==null?(u.return=l,fe=u):yy(i);for(;s!==null;)fe=s,G3(s),s=s.sibling;fe=i,Cu=c,Ht=f}gy(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,fe=s):gy(t)}}function gy(t){for(;fe!==null;){var e=fe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ht||Bc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ht)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Zn(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Jm(e,s,r);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Jm(e,l,n)}break;case 5:var c=e.stateNode;if(n===null&&e.flags&4){n=c;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var f=e.alternate;if(f!==null){var h=f.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Ua(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}Ht||e.flags&512&&z0(e)}catch(x){lt(e,e.return,x)}}if(e===t){fe=null;break}if(n=e.sibling,n!==null){n.return=e.return,fe=n;break}fe=e.return}}function my(t){for(;fe!==null;){var e=fe;if(e===t){fe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,fe=n;break}fe=e.return}}function yy(t){for(;fe!==null;){var e=fe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Bc(4,e)}catch(u){lt(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){lt(e,i,u)}}var s=e.return;try{z0(e)}catch(u){lt(e,s,u)}break;case 5:var l=e.return;try{z0(e)}catch(u){lt(e,l,u)}}}catch(u){lt(e,e.return,u)}if(e===t){fe=null;break}var c=e.sibling;if(c!==null){c.return=e.return,fe=c;break}fe=e.return}}var Q8=Math.ceil,yc=$r.ReactCurrentDispatcher,Xp=$r.ReactCurrentOwner,zn=$r.ReactCurrentBatchConfig,je=0,Pt=null,gt=null,Ft=0,xn=0,to=Mi(0),wt=0,qa=null,as=0,Uc=0,Yp=0,Ma=null,dn=null,Kp=0,vo=1/0,Rr=null,vc=!1,G0=null,ki=null,Tu=!1,yi=null,xc=0,Aa=0,V0=null,Vu=-1,Wu=0;function Zt(){return je&6?ft():Vu!==-1?Vu:Vu=ft()}function Ci(t){return t.mode&1?je&2&&Ft!==0?Ft&-Ft:L8.transition!==null?(Wu===0&&(Wu=Ev()),Wu):(t=Ue,t!==0||(t=window.event,t=t===void 0?16:Lv(t.type)),t):1}function rr(t,e,n,r){if(50<Aa)throw Aa=0,V0=null,Error(ne(185));ol(t,n,r),(!(je&2)||t!==Pt)&&(t===Pt&&(!(je&2)&&(Uc|=n),wt===4&&gi(t,Ft)),mn(t,r),n===1&&je===0&&!(e.mode&1)&&(vo=ft()+500,Oc&&Ai()))}function mn(t,e){var n=t.callbackNode;Lx(t,e);var r=nc(t,t===Pt?Ft:0);if(r===0)n!==null&&Em(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Em(n),e===1)t.tag===0?I8(vy.bind(null,t)):qv(vy.bind(null,t)),P8(function(){!(je&6)&&Ai()}),n=null;else{switch(bv(r)){case 1:n=_p;break;case 4:n=Cv;break;case 16:n=tc;break;case 536870912:n=Tv;break;default:n=tc}n=Q3(n,V3.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function V3(t,e){if(Vu=-1,Wu=0,je&6)throw Error(ne(327));var n=t.callbackNode;if(lo()&&t.callbackNode!==n)return null;var r=nc(t,t===Pt?Ft:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=wc(t,r);else{e=r;var i=je;je|=2;var s=$3();(Pt!==t||Ft!==e)&&(Rr=null,vo=ft()+500,ns(t,e));do try{J8();break}catch(c){W3(t,c)}while(1);Rp(),yc.current=s,je=i,gt!==null?e=0:(Pt=null,Ft=0,e=wt)}if(e!==0){if(e===2&&(i=m0(t),i!==0&&(r=i,e=W0(t,i))),e===1)throw n=qa,ns(t,0),gi(t,r),mn(t,ft()),n;if(e===6)gi(t,r);else{if(i=t.current.alternate,!(r&30)&&!Z8(i)&&(e=wc(t,r),e===2&&(s=m0(t),s!==0&&(r=s,e=W0(t,s))),e===1))throw n=qa,ns(t,0),gi(t,r),mn(t,ft()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(ne(345));case 2:Zi(t,dn,Rr);break;case 3:if(gi(t,r),(r&130023424)===r&&(e=Kp+500-ft(),10<e)){if(nc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Zt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=C0(Zi.bind(null,t,dn,Rr),e);break}Zi(t,dn,Rr);break;case 4:if(gi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var l=31-nr(r);s=1<<l,l=e[l],l>i&&(i=l),r&=~s}if(r=i,r=ft()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Q8(r/1960))-r,10<r){t.timeoutHandle=C0(Zi.bind(null,t,dn,Rr),r);break}Zi(t,dn,Rr);break;case 5:Zi(t,dn,Rr);break;default:throw Error(ne(329))}}}return mn(t,ft()),t.callbackNode===n?V3.bind(null,t):null}function W0(t,e){var n=Ma;return t.current.memoizedState.isDehydrated&&(ns(t,e).flags|=256),t=wc(t,e),t!==2&&(e=dn,dn=n,e!==null&&$0(e)),t}function $0(t){dn===null?dn=t:dn.push.apply(dn,t)}function Z8(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!sr(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function gi(t,e){for(e&=~Yp,e&=~Uc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-nr(e),r=1<<n;t[n]=-1,e&=~r}}function vy(t){if(je&6)throw Error(ne(327));lo();var e=nc(t,0);if(!(e&1))return mn(t,ft()),null;var n=wc(t,e);if(t.tag!==0&&n===2){var r=m0(t);r!==0&&(e=r,n=W0(t,r))}if(n===1)throw n=qa,ns(t,0),gi(t,e),mn(t,ft()),n;if(n===6)throw Error(ne(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Zi(t,dn,Rr),mn(t,ft()),null}function Qp(t,e){var n=je;je|=1;try{return t(e)}finally{je=n,je===0&&(vo=ft()+500,Oc&&Ai())}}function ls(t){yi!==null&&yi.tag===0&&!(je&6)&&lo();var e=je;je|=1;var n=zn.transition,r=Ue;try{if(zn.transition=null,Ue=1,t)return t()}finally{Ue=r,zn.transition=n,je=e,!(je&6)&&Ai()}}function Zp(){xn=to.current,Ze(to)}function ns(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,b8(n)),gt!==null)for(n=gt.return;n!==null;){var r=n;switch(Ap(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ac();break;case 3:mo(),Ze(pn),Ze(Xt),Bp();break;case 5:zp(r);break;case 4:mo();break;case 13:Ze(it);break;case 19:Ze(it);break;case 10:Fp(r.type._context);break;case 22:case 23:Zp()}n=n.return}if(Pt=t,gt=t=Ti(t.current,null),Ft=xn=e,wt=0,qa=null,Yp=Uc=as=0,dn=Ma=null,es!==null){for(e=0;e<es.length;e++)if(n=es[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var l=s.next;s.next=i,r.next=l}n.pending=r}es=null}return t}function W3(t,e){do{var n=gt;try{if(Rp(),Bu.current=mc,gc){for(var r=st.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}gc=!1}if(os=0,bt=xt=st=null,Pa=!1,Ka=0,Xp.current=null,n===null||n.return===null){wt=1,qa=e,gt=null;break}e:{var s=t,l=n.return,c=n,u=e;if(e=Ft,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var f=u,h=c,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var x=h.alternate;x?(h.updateQueue=x.updateQueue,h.memoizedState=x.memoizedState,h.lanes=x.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=sy(l);if(y!==null){y.flags&=-257,oy(y,l,c,s,e),y.mode&1&&iy(s,f,e),e=y,u=f;var w=e.updateQueue;if(w===null){var E=new Set;E.add(u),e.updateQueue=E}else w.add(u);break e}else{if(!(e&1)){iy(s,f,e),qp();break e}u=Error(ne(426))}}else if(et&&c.mode&1){var _=sy(l);if(_!==null){!(_.flags&65536)&&(_.flags|=256),oy(_,l,c,s,e),Ip(yo(u,c));break e}}s=u=yo(u,c),wt!==4&&(wt=2),Ma===null?Ma=[s]:Ma.push(s),s=l;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var S=b3(s,u,e);qm(s,S);break e;case 1:c=u;var C=s.type,g=s.stateNode;if(!(s.flags&128)&&(typeof C.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ki===null||!ki.has(g)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=P3(s,c,e);qm(s,k);break e}}s=s.return}while(s!==null)}X3(n)}catch(T){e=T,gt===n&&n!==null&&(gt=n=n.return);continue}break}while(1)}function $3(){var t=yc.current;return yc.current=mc,t===null?mc:t}function qp(){(wt===0||wt===3||wt===2)&&(wt=4),Pt===null||!(as&268435455)&&!(Uc&268435455)||gi(Pt,Ft)}function wc(t,e){var n=je;je|=2;var r=$3();(Pt!==t||Ft!==e)&&(Rr=null,ns(t,e));do try{q8();break}catch(i){W3(t,i)}while(1);if(Rp(),je=n,yc.current=r,gt!==null)throw Error(ne(261));return Pt=null,Ft=0,wt}function q8(){for(;gt!==null;)H3(gt)}function J8(){for(;gt!==null&&!Cx();)H3(gt)}function H3(t){var e=K3(t.alternate,t,xn);t.memoizedProps=t.pendingProps,e===null?X3(t):gt=e,Xp.current=null}function X3(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=H8(n,e),n!==null){n.flags&=32767,gt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{wt=6,gt=null;return}}else if(n=$8(n,e,xn),n!==null){gt=n;return}if(e=e.sibling,e!==null){gt=e;return}gt=e=t}while(e!==null);wt===0&&(wt=5)}function Zi(t,e,n){var r=Ue,i=zn.transition;try{zn.transition=null,Ue=1,ew(t,e,n,r)}finally{zn.transition=i,Ue=r}return null}function ew(t,e,n,r){do lo();while(yi!==null);if(je&6)throw Error(ne(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ne(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Rx(t,s),t===Pt&&(gt=Pt=null,Ft=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Tu||(Tu=!0,Q3(tc,function(){return lo(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=zn.transition,zn.transition=null;var l=Ue;Ue=1;var c=je;je|=4,Xp.current=null,Y8(t,n),U3(n,t),w8(S0),rc=!!_0,S0=_0=null,t.current=n,K8(n),Tx(),je=c,Ue=l,zn.transition=s}else t.current=n;if(Tu&&(Tu=!1,yi=t,xc=i),s=t.pendingLanes,s===0&&(ki=null),Px(n.stateNode),mn(t,ft()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(vc)throw vc=!1,t=G0,G0=null,t;return xc&1&&t.tag!==0&&lo(),s=t.pendingLanes,s&1?t===V0?Aa++:(Aa=0,V0=t):Aa=0,Ai(),null}function lo(){if(yi!==null){var t=bv(xc),e=zn.transition,n=Ue;try{if(zn.transition=null,Ue=16>t?16:t,yi===null)var r=!1;else{if(t=yi,yi=null,xc=0,je&6)throw Error(ne(331));var i=je;for(je|=4,fe=t.current;fe!==null;){var s=fe,l=s.child;if(fe.flags&16){var c=s.deletions;if(c!==null){for(var u=0;u<c.length;u++){var f=c[u];for(fe=f;fe!==null;){var h=fe;switch(h.tag){case 0:case 11:case 15:Na(8,h,s)}var m=h.child;if(m!==null)m.return=h,fe=m;else for(;fe!==null;){h=fe;var x=h.sibling,y=h.return;if(D3(h),h===f){fe=null;break}if(x!==null){x.return=y,fe=x;break}fe=y}}}var w=s.alternate;if(w!==null){var E=w.child;if(E!==null){w.child=null;do{var _=E.sibling;E.sibling=null,E=_}while(E!==null)}}fe=s}}if(s.subtreeFlags&2064&&l!==null)l.return=s,fe=l;else e:for(;fe!==null;){if(s=fe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Na(9,s,s.return)}var S=s.sibling;if(S!==null){S.return=s.return,fe=S;break e}fe=s.return}}var C=t.current;for(fe=C;fe!==null;){l=fe;var g=l.child;if(l.subtreeFlags&2064&&g!==null)g.return=l,fe=g;else e:for(l=C;fe!==null;){if(c=fe,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Bc(9,c)}}catch(T){lt(c,c.return,T)}if(c===l){fe=null;break e}var k=c.sibling;if(k!==null){k.return=c.return,fe=k;break e}fe=c.return}}if(je=i,Ai(),Sr&&typeof Sr.onPostCommitFiberRoot=="function")try{Sr.onPostCommitFiberRoot(Ic,t)}catch{}r=!0}return r}finally{Ue=n,zn.transition=e}}return!1}function xy(t,e,n){e=yo(n,e),e=b3(t,e,1),t=Si(t,e,1),e=Zt(),t!==null&&(ol(t,1,e),mn(t,e))}function lt(t,e,n){if(t.tag===3)xy(t,t,n);else for(;e!==null;){if(e.tag===3){xy(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ki===null||!ki.has(r))){t=yo(n,t),t=P3(e,t,1),e=Si(e,t,1),t=Zt(),e!==null&&(ol(e,1,t),mn(e,t));break}}e=e.return}}function tw(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Zt(),t.pingedLanes|=t.suspendedLanes&n,Pt===t&&(Ft&n)===n&&(wt===4||wt===3&&(Ft&130023424)===Ft&&500>ft()-Kp?ns(t,0):Yp|=n),mn(t,e)}function Y3(t,e){e===0&&(t.mode&1?(e=gu,gu<<=1,!(gu&130023424)&&(gu=4194304)):e=1);var n=Zt();t=Vr(t,e),t!==null&&(ol(t,e,n),mn(t,n))}function nw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Y3(t,n)}function rw(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ne(314))}r!==null&&r.delete(e),Y3(t,n)}var K3;K3=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||pn.current)fn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return fn=!1,W8(t,e,n);fn=!!(t.flags&131072)}else fn=!1,et&&e.flags&1048576&&Jv(e,cc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Gu(t,e),t=e.pendingProps;var i=ho(e,Xt.current);ao(e,n),i=Gp(null,e,r,t,i,n);var s=Vp();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,gn(r)?(s=!0,lc(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Op(e),i.updater=zc,e.stateNode=i,i._reactInternals=e,A0(e,r,t,n),e=R0(null,e,r,!0,s,n)):(e.tag=0,et&&s&&Mp(e),Qt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Gu(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=sw(r),t=Zn(r,t),i){case 0:e=L0(null,e,r,t,n);break e;case 1:e=uy(null,e,r,t,n);break e;case 11:e=ay(null,e,r,t,n);break e;case 14:e=ly(null,e,r,Zn(r.type,t),n);break e}throw Error(ne(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),L0(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),uy(t,e,r,i,n);case 3:e:{if(I3(e),t===null)throw Error(ne(387));r=e.pendingProps,s=e.memoizedState,i=s.element,s3(t,e),hc(e,r,null,n);var l=e.memoizedState;if(r=l.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=yo(Error(ne(423)),e),e=cy(t,e,r,n,i);break e}else if(r!==i){i=yo(Error(ne(424)),e),e=cy(t,e,r,n,i);break e}else for(wn=_i(e.stateNode.containerInfo.firstChild),_n=e,et=!0,Jn=null,n=r3(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(po(),r===i){e=Wr(t,e,n);break e}Qt(t,e,r,n)}e=e.child}return e;case 5:return o3(e),t===null&&P0(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,l=i.children,k0(r,i)?l=null:s!==null&&k0(r,s)&&(e.flags|=32),A3(t,e),Qt(t,e,l,n),e.child;case 6:return t===null&&P0(e),null;case 13:return L3(t,e,n);case 4:return Dp(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=go(e,null,r,n):Qt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),ay(t,e,r,i,n);case 7:return Qt(t,e,e.pendingProps,n),e.child;case 8:return Qt(t,e,e.pendingProps.children,n),e.child;case 12:return Qt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,l=i.value,He(dc,r._currentValue),r._currentValue=l,s!==null)if(sr(s.value,l)){if(s.children===i.children&&!pn.current){e=Wr(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var c=s.dependencies;if(c!==null){l=s.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(s.tag===1){u=Dr(-1,n&-n),u.tag=2;var f=s.updateQueue;if(f!==null){f=f.shared;var h=f.pending;h===null?u.next=u:(u.next=h.next,h.next=u),f.pending=u}}s.lanes|=n,u=s.alternate,u!==null&&(u.lanes|=n),N0(s.return,n,e),c.lanes|=n;break}u=u.next}}else if(s.tag===10)l=s.type===e.type?null:s.child;else if(s.tag===18){if(l=s.return,l===null)throw Error(ne(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),N0(l,n,e),l=s.sibling}else l=s.child;if(l!==null)l.return=s;else for(l=s;l!==null;){if(l===e){l=null;break}if(s=l.sibling,s!==null){s.return=l.return,l=s;break}l=l.return}s=l}Qt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ao(e,n),i=Bn(i),r=r(i),e.flags|=1,Qt(t,e,r,n),e.child;case 14:return r=e.type,i=Zn(r,e.pendingProps),i=Zn(r.type,i),ly(t,e,r,i,n);case 15:return N3(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zn(r,i),Gu(t,e),e.tag=1,gn(r)?(t=!0,lc(e)):t=!1,ao(e,n),E3(e,r,i),A0(e,r,i,n),R0(null,e,r,!0,t,n);case 19:return R3(t,e,n);case 22:return M3(t,e,n)}throw Error(ne(156,e.tag))};function Q3(t,e){return kv(t,e)}function iw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dn(t,e,n,r){return new iw(t,e,n,r)}function Jp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function sw(t){if(typeof t=="function")return Jp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===vp)return 11;if(t===xp)return 14}return 2}function Ti(t,e){var n=t.alternate;return n===null?(n=Dn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function $u(t,e,n,r,i,s){var l=2;if(r=t,typeof t=="function")Jp(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case $s:return rs(n.children,i,s,e);case yp:l=8,i|=8;break;case t0:return t=Dn(12,n,e,i|2),t.elementType=t0,t.lanes=s,t;case n0:return t=Dn(13,n,e,i),t.elementType=n0,t.lanes=s,t;case r0:return t=Dn(19,n,e,i),t.elementType=r0,t.lanes=s,t;case ov:return Gc(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case iv:l=10;break e;case sv:l=9;break e;case vp:l=11;break e;case xp:l=14;break e;case di:l=16,r=null;break e}throw Error(ne(130,t==null?t:typeof t,""))}return e=Dn(l,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function rs(t,e,n,r){return t=Dn(7,t,r,e),t.lanes=n,t}function Gc(t,e,n,r){return t=Dn(22,t,r,e),t.elementType=ov,t.lanes=n,t.stateNode={isHidden:!1},t}function Th(t,e,n){return t=Dn(6,t,null,e),t.lanes=n,t}function Eh(t,e,n){return e=Dn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function ow(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oh(0),this.expirationTimes=oh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oh(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function eg(t,e,n,r,i,s,l,c,u){return t=new ow(t,e,n,c,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Dn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Op(s),t}function aw(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ws,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Z3(t){if(!t)return bi;t=t._reactInternals;e:{if(cs(t)!==t||t.tag!==1)throw Error(ne(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(gn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(t.tag===1){var n=t.type;if(gn(n))return Zv(t,n,e)}return e}function q3(t,e,n,r,i,s,l,c,u){return t=eg(n,r,!0,t,i,s,l,c,u),t.context=Z3(null),n=t.current,r=Zt(),i=Ci(n),s=Dr(r,i),s.callback=e??null,Si(n,s,i),t.current.lanes=i,ol(t,i,r),mn(t,r),t}function Vc(t,e,n,r){var i=e.current,s=Zt(),l=Ci(i);return n=Z3(n),e.context===null?e.context=n:e.pendingContext=n,e=Dr(s,l),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Si(i,e,l),t!==null&&(rr(t,i,l,s),zu(t,i,l)),l}function _c(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function wy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function tg(t,e){wy(t,e),(t=t.alternate)&&wy(t,e)}function lw(){return null}var J3=typeof reportError=="function"?reportError:function(t){console.error(t)};function ng(t){this._internalRoot=t}Wc.prototype.render=ng.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ne(409));Vc(t,e,null,null)};Wc.prototype.unmount=ng.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ls(function(){Vc(null,t,null,null)}),e[Gr]=null}};function Wc(t){this._internalRoot=t}Wc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Mv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<pi.length&&e!==0&&e<pi[n].priority;n++);pi.splice(n,0,t),n===0&&Iv(t)}};function rg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function $c(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _y(){}function uw(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var f=_c(l);s.call(f)}}var l=q3(e,r,t,0,null,!1,!1,"",_y);return t._reactRootContainer=l,t[Gr]=l.current,Wa(t.nodeType===8?t.parentNode:t),ls(),l}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var c=r;r=function(){var f=_c(u);c.call(f)}}var u=eg(t,0,!1,null,null,!1,!1,"",_y);return t._reactRootContainer=u,t[Gr]=u.current,Wa(t.nodeType===8?t.parentNode:t),ls(function(){Vc(e,u,n,r)}),u}function Hc(t,e,n,r,i){var s=n._reactRootContainer;if(s){var l=s;if(typeof i=="function"){var c=i;i=function(){var u=_c(l);c.call(u)}}Vc(e,l,t,i)}else l=uw(n,e,t,i,r);return _c(l)}Pv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=xa(e.pendingLanes);n!==0&&(Sp(e,n|1),mn(e,ft()),!(je&6)&&(vo=ft()+500,Ai()))}break;case 13:ls(function(){var r=Vr(t,1);if(r!==null){var i=Zt();rr(r,t,1,i)}}),tg(t,1)}};kp=function(t){if(t.tag===13){var e=Vr(t,134217728);if(e!==null){var n=Zt();rr(e,t,134217728,n)}tg(t,134217728)}};Nv=function(t){if(t.tag===13){var e=Ci(t),n=Vr(t,e);if(n!==null){var r=Zt();rr(n,t,e,r)}tg(t,e)}};Mv=function(){return Ue};Av=function(t,e){var n=Ue;try{return Ue=t,e()}finally{Ue=n}};h0=function(t,e,n){switch(e){case"input":if(o0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=jc(r);if(!i)throw Error(ne(90));lv(r),o0(r,i)}}}break;case"textarea":cv(t,n);break;case"select":e=n.value,e!=null&&ro(t,!!n.multiple,e,!1)}};yv=Qp;vv=ls;var cw={usingClientEntryPoint:!1,Events:[ll,Ks,jc,gv,mv,Qp]},la={findFiberByHostInstance:Ji,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},dw={bundleType:la.bundleType,version:la.version,rendererPackageName:la.rendererPackageName,rendererConfig:la.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$r.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=_v(t),t===null?null:t.stateNode},findFiberByHostInstance:la.findFiberByHostInstance||lw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Eu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Eu.isDisabled&&Eu.supportsFiber)try{Ic=Eu.inject(dw),Sr=Eu}catch{}}kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cw;kn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rg(e))throw Error(ne(200));return aw(t,e,null,n)};kn.createRoot=function(t,e){if(!rg(t))throw Error(ne(299));var n=!1,r="",i=J3;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=eg(t,1,!1,null,null,n,!1,r,i),t[Gr]=e.current,Wa(t.nodeType===8?t.parentNode:t),new ng(e)};kn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ne(188)):(t=Object.keys(t).join(","),Error(ne(268,t)));return t=_v(e),t=t===null?null:t.stateNode,t};kn.flushSync=function(t){return ls(t)};kn.hydrate=function(t,e,n){if(!$c(e))throw Error(ne(200));return Hc(null,t,e,!0,n)};kn.hydrateRoot=function(t,e,n){if(!rg(t))throw Error(ne(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",l=J3;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=q3(e,null,t,1,n??null,i,!1,s,l),t[Gr]=e.current,Wa(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Wc(e)};kn.render=function(t,e,n){if(!$c(e))throw Error(ne(200));return Hc(null,t,e,!1,n)};kn.unmountComponentAtNode=function(t){if(!$c(t))throw Error(ne(40));return t._reactRootContainer?(ls(function(){Hc(null,null,t,!1,function(){t._reactRootContainer=null,t[Gr]=null})}),!0):!1};kn.unstable_batchedUpdates=Qp;kn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!$c(n))throw Error(ne(200));if(t==null||t._reactInternals===void 0)throw Error(ne(38));return Hc(t,e,n,!1,r)};kn.version="18.3.1-next-f1338f8080-20240426";function e5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e5)}catch(t){console.error(t)}}e5(),ev.exports=kn;var fw=ev.exports,Sy=fw;Jh.createRoot=Sy.createRoot,Jh.hydrateRoot=Sy.hydrateRoot;const ky=({isLoading:t,onSave:e,onSaveAs:n,canSaveAs:r,onLoad:i,onClear:s,buttonStyle:l})=>P.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.jsx("button",{style:{...l(!1),opacity:t?.5:1},onClick:e,disabled:t,title:"Save as PNML",children:"Save"}),P.jsx("button",{style:{...l(!1),opacity:t||!r?.5:1},onClick:n,disabled:t||!r,title:"Save As (choose location and filename)",children:"Save as"}),P.jsx("button",{style:{...l(!1),opacity:t?.5:1},onClick:i,disabled:t,title:"Load PNML file",children:"Load"}),P.jsx("button",{style:{...l(!1)},onClick:s,title:"Clear canvas",children:"Clear"})]}),hw=({mode:t,setMode:e,buttonStyle:n})=>P.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.jsx("button",{style:{...n(t==="select")},"data-testid":"toolbar-select",onClick:()=>{t!=="select"&&e("select")},children:"Select"}),P.jsx("button",{style:n(t==="place"),"data-testid":"toolbar-place",onClick:()=>{t!=="place"&&e("place")},children:"Place"}),P.jsx("button",{style:n(t==="transition"),"data-testid":"toolbar-transition",onClick:()=>{t!=="transition"&&e("transition")},children:"Transition"}),P.jsx("button",{style:n(t==="arc"),"data-testid":"toolbar-arc",onClick:()=>{t!=="arc"&&e("arc")},children:"Arc"})]}),pw=({canUndo:t,canRedo:e,onUndo:n,onRedo:r,buttonStyle:i})=>P.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.jsx("button",{style:{...i(!1),opacity:t?1:.5},onClick:n,disabled:!t,title:"Undo (Ctrl+Z)",children:"Undo"}),P.jsx("button",{style:{...i(!1),opacity:e?1:.5},onClick:r,disabled:!e,title:"Redo (Ctrl+Y)",children:"Redo"})]}),Cy=({onOpenSettings:t,buttonStyle:e})=>P.jsx("div",{className:"flex flex-wrap gap-2",children:P.jsx("button",{style:e(!1),onClick:t,title:"Simulation Settings","data-testid":"toolbar-settings",children:"Settings"})});function bh(t){const e={types:[]};try{const r=new DOMParser().parseFromString(t,"application/xml"),i=r.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Invalid XML");const l=Array.from(r.getElementsByTagName("*")).filter(f=>f.localName==="algebraicDataTypes")[0];if(!l)return e;const u=Array.from(l.childNodes).filter(f=>f.nodeType===1).filter(f=>f.localName==="type");for(const f of u){const h=f.getAttribute("name")||"",x=Array.from(f.childNodes).filter(_=>_.nodeType===1&&_.localName==="operation").map(_=>{const C=Array.from(_.childNodes).filter(g=>g.nodeType===1&&g.localName==="param").map(g=>({index:Number(g.getAttribute("index")||"0"),type:g.getAttribute("type")||""}));return{name:_.getAttribute("name")||"",arity:Number(_.getAttribute("arity")||"0"),result:_.getAttribute("result")||"",params:C}}),y=Array.from(f.childNodes).find(_=>_.nodeType===1&&_.localName==="axioms"),E=(y?Array.from(y.childNodes).filter(_=>_.nodeType===1&&_.localName==="axiom"):[]).map(_=>({name:_.getAttribute("name")||"",equation:(_.textContent||"").trim()}));e.types.push({name:h,operations:x,axioms:E})}return e}catch(n){return console.error("Error parsing ADT XML:",n),e}}function gw(t){const e=[],n=new Set;for(const r of t.types||[]){r.name||e.push("Type missing name"),n.has(r.name)&&e.push(`Duplicate type: ${r.name}`),n.add(r.name);for(const i of r.operations||[])i.name||e.push(`Operation missing name in type ${r.name}`),(!Number.isInteger(i.arity)||i.arity<0)&&e.push(`Invalid arity for ${r.name}.${i.name}`),i.result||e.push(`Operation ${r.name}.${i.name} missing result type`);for(const i of r.axioms||[])(!i.equation||!i.equation.includes("="))&&e.push(`Axiom in ${r.name} must be an equation with '='`)}return{valid:e.length===0,errors:e}}const mw=`<?xml version="1.0"?>
<algebraicDataTypes xmlns="http://example.org/apn-adt">
  <type name="Int">
    <operation name="+" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="-" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="*" arity="2" result="Int">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&lt;" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&lt;=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&gt;" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <operation name="&gt;=" arity="2" result="Bool">
      <param index="0" type="Int"/>
      <param index="1" type="Int"/>
    </operation>
    <axioms>
      <axiom name="commutativity">x + y = y + x</axiom>
      <axiom name="associativity">(x + y) + z = x + (y + z)</axiom>
      <axiom name="multiplication_commutativity">x * y = y * x</axiom>
      <axiom name="multiplication_associativity">(x * y) * z = x * (y * z)</axiom>
      <axiom name="distributivity">x * (y + z) = (x * y) + (x * z)</axiom>
    </axioms>
  </type>
  <type name="Bool">
    <operation name="and" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="or" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="not" arity="1" result="Bool">
      <param index="0" type="Bool"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Bool"/>
      <param index="1" type="Bool"/>
    </operation>
    <axioms>
      <axiom name="and_commutativity">x and y = y and x</axiom>
      <axiom name="and_associativity">(x and y) and z = x and (y and z)</axiom>
      <axiom name="or_commutativity">x or y = y or x</axiom>
      <axiom name="or_associativity">(x or y) or z = x or (y or z)</axiom>
      <axiom name="de_morgan_and">not (x and y) = (not x) or (not y)</axiom>
      <axiom name="de_morgan_or">not (x or y) = (not x) and (not y)</axiom>
      <axiom name="double_negation">not (not x) = x</axiom>
    </axioms>
  </type>
  <type name="Pair">
    <operation name="fst" arity="1" result="Any">
      <param index="0" type="Pair"/>
    </operation>
    <operation name="snd" arity="1" result="Any">
      <param index="0" type="Pair"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="Pair"/>
      <param index="1" type="Pair"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="Pair"/>
      <param index="1" type="Pair"/>
    </operation>
    <axioms>
      <axiom name="pair_equality">(x, y) == (a, b) = (x == a) and (y == b)</axiom>
      <axiom name="fst_projection">fst((x, y)) = x</axiom>
      <axiom name="snd_projection">snd((x, y)) = y</axiom>
    </axioms>
  </type>
  <type name="String">
    <operation name="concat" arity="2" result="String">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="substring" arity="3" result="String">
      <param index="0" type="String"/>
      <param index="1" type="Int"/>
      <param index="2" type="Int"/>
    </operation>
    <operation name="isSubstringOf" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="length" arity="1" result="Int">
      <param index="0" type="String"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="String"/>
      <param index="1" type="String"/>
    </operation>
    <axioms>
      <axiom name="concat_associativity">concat(concat(x, y), z) = concat(x, concat(y, z))</axiom>
      <axiom name="concat_empty_left">concat('', x) = x</axiom>
      <axiom name="concat_empty_right">concat(x, '') = x</axiom>
      <axiom name="substring_bounds">substring(x, 0, length(x)) = x</axiom>
      <axiom name="length_concat">length(concat(x, y)) = length(x) + length(y)</axiom>
    </axioms>
  </type>
  <type name="List">
    <operation name="length" arity="1" result="Int">
      <param index="0" type="List"/>
    </operation>
    <operation name="concat" arity="2" result="List">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="head" arity="1" result="Any">
      <param index="0" type="List"/>
    </operation>
    <operation name="tail" arity="1" result="List">
      <param index="0" type="List"/>
    </operation>
    <operation name="append" arity="2" result="List">
      <param index="0" type="List"/>
      <param index="1" type="Any"/>
    </operation>
    <operation name="sublist" arity="3" result="List">
      <param index="0" type="List"/>
      <param index="1" type="Int"/>
      <param index="2" type="Int"/>
    </operation>
    <operation name="isSublistOf" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="==" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <operation name="!=" arity="2" result="Bool">
      <param index="0" type="List"/>
      <param index="1" type="List"/>
    </operation>
    <axioms>
      <axiom name="length_empty">length([]) = 0</axiom>
      <axiom name="concat_empty_left">concat([], x) = x</axiom>
      <axiom name="concat_empty_right">concat(x, []) = x</axiom>
      <axiom name="head_cons">head([h | t]) = h</axiom>
      <axiom name="tail_cons">tail([h | t]) = t</axiom>
      <axiom name="length_concat">length(concat(x, y)) = length(x) + length(y)</axiom>
    </axioms>
  </type>
</algebraicDataTypes>`,t5=z.createContext(null);function yw({children:t}){const e=z.useMemo(()=>bh(mw),[]),[n,r]=z.useState([]),i=z.useMemo(()=>{const h=new Map;for(const m of e.types||[])h.set(m.name,{...m,__readonly:!0});for(const m of n){const x=bh(m);for(const y of x.types||[])h.has(y.name)||h.set(y.name,{...y,__readonly:!1})}return h},[e,n]),s=z.useCallback(()=>Array.from(i.keys()),[i]),l=z.useCallback(h=>i.get(h)||null,[i]),c=z.useCallback(h=>{const m=bh(h),x=gw(m);if(!x.valid)return{ok:!1,errors:x.errors};for(const y of m.types||[])if(i.has(y.name))return{ok:!1,errors:[`Duplicate type: ${y.name}`]};return r(y=>[...y,h]),{ok:!0}},[i]),u=z.useCallback(()=>n.join(`
`),[n]),f=z.useMemo(()=>({listTypes:s,getType:l,registerCustomADTXml:c,exportCustomADTXml:u,baseReadOnly:!0,addOrReplaceCustomADT:h=>c(h),clearCustomADTs:()=>r([])}),[s,l,c,u]);return P.jsx(t5.Provider,{value:f,children:t})}function vw(){const t=z.useContext(t5);if(!t)throw new Error("useAdtRegistry must be used within AdtProvider");return t}function Rt(t){if(typeof t!="string")throw new Error("Expression must be a string");const e=t.trim();let n=0;function r(_){return _>="0"&&_<="9"}function i(){for(;n<e.length&&/\s/.test(e[n]);)n++}function s(){i();let _=n;for(;n<e.length&&r(e[n]);)n++;if(_===n)throw new Error(`Expected int at position ${n}`);const S=e.slice(_,n);return{type:"int",value:parseInt(S,10)}}function l(_){return/[A-Za-z_]/.test(_)}function c(_){return/[A-Za-z0-9_]/.test(_)}function u(){if(i(),e[n]!=="'")throw new Error(`Expected string literal at position ${n}`);n++;let _="";for(;n<e.length&&e[n]!=="'";){if(e[n]==="\\"&&n+1<e.length){n++;const S=e[n];S==="n"?_+=`
`:S==="t"?_+="	":S==="r"?_+="\r":S==="\\"?_+="\\":S==="'"?_+="'":_+=S}else _+=e[n];n++}if(n>=e.length)throw new Error("Unterminated string literal");return n++,{type:"string",value:_}}function f(){i();let _=n;if(!l(e[n]))throw new Error(`Expected identifier at position ${n}`);for(n++;n<e.length&&c(e[n]);)n++;const S=e.slice(_,n);if(S&&/^[A-Z]/.test(S))throw new Error(`Variable names must start with lowercase letter, got '${S}' (use 't' instead of 'T', 'f' instead of 'F')`);if(i(),e[n]==="("){n++;const g=[];if(i(),e[n]!==")")do if(i(),g.push(y()),i(),e[n]===",")n++;else break;while(n<e.length);if(i(),e[n]!==")")throw new Error(`Expected ')' after function arguments at position ${n}`);return n++,{type:"funcall",name:S,args:g}}const C=n;if(i(),e[n]===":"){n++,i();const g=n;for(;n<e.length&&/[A-Za-z]/.test(e[n]);)n++;const k=e.slice(g,n).toLowerCase();return k==="int"||k==="bool"||k==="pair"||k==="string"||k==="list"?{type:"var",name:S,varType:k}:(n=C,{type:"var",name:S})}return{type:"var",name:S}}function h(){if(i(),e[n]!=="[")throw new Error(`Expected '[' at position ${n}`);n++;const _=[];if(i(),e[n]==="]")return n++,{type:"list",elements:[]};for(;n<e.length;){if(i(),_.push(y()),i(),e[n]==="]")return n++,{type:"list",elements:_};if(e[n]===","){n++;continue}throw new Error(`Expected ',' or ']' at position ${n}`)}throw new Error("Unterminated list literal")}function m(){if(i(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);if(e[n]==="("){n++,i();const _=y();if(i(),e[n]===","){n++;const S=y();if(i(),n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,{type:"pair",fst:_,snd:S}}if(n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,_}if(e[n]==="[")return h();if(e[n]==="'")return u();if(r(e[n]))return s();if(/[A-Za-z_]/.test(e[n]))return f();throw new Error(`Unexpected character '${e[n]}' at position ${n}`)}function x(){let _=m();for(i();n<e.length&&(e[n]==="*"||e[n]==="/");){const S=e[n++],C=m();_={type:"binop",op:S,left:_,right:C},i()}return _}function y(){let _=x();for(i();n<e.length&&(e[n]==="+"||e[n]==="-");){const S=e[n++],C=x();_={type:"binop",op:S,left:_,right:C},i()}return _}let w=y();if(i(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);function E(_){return!_||typeof _!="object"||(_.type==="bin"&&(_.type="binop"),_.left&&(_.left=E(_.left)),_.right&&(_.right=E(_.right)),Array.isArray(_.args)&&(_.args=_.args.map(E)),Array.isArray(_.elements)&&(_.elements=_.elements.map(E))),_}return w=E(w),w}function n5(t){if(typeof t!="string")throw new Error("Pattern must be a string");const e=t.trim();let n=0;function r(){for(;n<e.length&&/\s/.test(e[n]);)n++}function i(){if(r(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);if(e.slice(n,n+1)==="T")return n++,{type:"boolLit",value:!0};if(e.slice(n,n+1)==="F")return n++,{type:"boolLit",value:!1};if(e.slice(n,n+4)==="true")return n+=4,{type:"boolLit",value:!0};if(e.slice(n,n+5)==="false")return n+=5,{type:"boolLit",value:!1};if(/[0-9]/.test(e[n])){let l=n;for(;n<e.length&&/[0-9]/.test(e[n]);)n++;return{type:"int",value:parseInt(e.slice(l,n),10)}}if(e[n]==="["){n++,r();const l=[];for(;n<e.length&&e[n]!=="]";)l.push(i()),r(),e[n]===","&&(n++,r());if(n>=e.length||e[n]!=="]")throw new Error(`Expected ']' at position ${n}`);return n++,{type:"listPattern",elements:l}}if(/[a-zA-Z_]/.test(e[n])){let l=n;for(;n<e.length&&/[a-zA-Z0-9_]/.test(e[n]);)n++;const c=e.slice(l,n);if(r(),e[n]===":"){n++,r();let u=n;for(;n<e.length&&/[a-zA-Z]/.test(e[n]);)n++;const f=e.slice(u,n).toLowerCase();if(f==="int"||f==="bool"||f==="pair"||f==="string"||f==="list")return{type:"var",name:c,varType:f};throw new Error(`Unknown type '${f}' at position ${u}`)}return{type:"var",name:c}}if(e[n]==="("){n++,r();const l=[];for(;n<e.length&&e[n]!==")";)l.push(i()),r(),n<e.length&&e[n]===","&&(n++,r());if(n>=e.length||e[n]!==")")throw new Error(`Expected ')' at position ${n}`);return n++,l.length===2?{type:"pairPattern",fst:l[0],snd:l[1]}:{type:"tuplePattern",elements:l}}throw new Error(`Unexpected character '${e[n]}' at position ${n}`)}const s=i();if(r(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);return s}function Ty(t,e){const n=new Map;function r(s,l){switch(s.type){case"int":return!(typeof l!="number"||l!==s.value);case"boolLit":return!(typeof l!="boolean"||l!==s.value);case"var":if(s.varType){const c=s.varType;if(c==="int"&&typeof l!="number"||c==="bool"&&typeof l!="boolean"||c==="string"&&typeof l!="string"||c==="list"&&!Array.isArray(l)||c==="pair"&&(!l||typeof l!="object"||!l.__pair__))return!1}if(n.has(s.name)){if(n.get(s.name)!==l)return!1}else n.set(s.name,l);return!0;case"pairPattern":return!(!l||typeof l!="object"||!l.__pair__||!r(s.fst,l.fst)||!r(s.snd,l.snd));case"tuplePattern":if(!Array.isArray(l)||l.length!==s.elements.length)return!1;for(let c=0;c<s.elements.length;c++)if(!r(s.elements[c],l[c]))return!1;return!0;case"listPattern":if(!Array.isArray(l)||l.length!==s.elements.length)return!1;for(let c=0;c<s.elements.length;c++)if(!r(s.elements[c],l[c]))return!1;return!0;default:return!1}}return r(t,e)?Object.fromEntries(n):null}function Ey(t,e=20){if(!t)return[];if(Array.isArray(t.valueTokens))return t.valueTokens.slice(0,e);const n=Number(t.tokens||0);return Number.isFinite(n)&&n>0?Array.from({length:Math.min(n,e)},()=>1):[]}function r5(t){return t.replace(/:int\b/g,":Int").replace(/:bool\b/g,":Bool").replace(/:pair\b/g,":Pair").replace(/:string\b/g,":String").replace(/:list\b/g,":List")}function Ja(t){return typeof t=="number"?"Int":typeof t=="boolean"?"Bool":typeof t=="string"?"String":Array.isArray(t)?"List":t&&typeof t=="object"&&t.__pair__?"Pair":"Int"}function Hu(t,e,n=null,r={}){if(!t||(!e||e.size===0)&&!n)return t;let i=t;const{overwrite:s=!1}=r||{},l=t.match(/\b[a-z][a-zA-Z0-9_]*\b/g);return l&&l.forEach(c=>{if(c!=="true"&&c!=="false"&&c!=="and"&&c!=="or"&&c!=="not"){const u=e.get(c)||n;if(!u)return;if(s){const f=new RegExp(`\\b${c}(?::[A-Za-z]+)?\\b`,"g");i=i.replace(f,`${c}:${u}`)}else if(!t.includes(`${c}:`)){const f=new RegExp(`\\b${c}(?!:)\\b`,"g");i=i.replace(f,`${c}:${u}`)}}}),i}const xw="modulepreload",ww=function(t,e){return new URL(t,e).href},by={},zr=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=ww(s,r),s in by)return;by[s]=!0;const l=s.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!r)for(let h=i.length-1;h>=0;h--){const m=i[h];if(m.href===s&&(!l||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${c}`))return;const f=document.createElement("link");if(f.rel=l?"stylesheet":xw,l||(f.as="script",f.crossOrigin=""),f.href=s,document.head.appendChild(f),l)return new Promise((h,m)=>{f.addEventListener("load",h),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s})},H0={silent:0,error:1,warn:2,info:3,debug:4},_w=(()=>{var r,i,s;const t=typeof globalThis<"u"?globalThis.__PETRI_NET_LOG_LEVEL__:void 0,e=typeof process<"u"?((r=process.env)==null?void 0:r.VITE_LOG_LEVEL)||((i=process.env)==null?void 0:i.LOG_LEVEL):void 0,n=typeof process<"u"&&((s=process.env)==null?void 0:s.NODE_ENV)==="production"?"warn":"debug";return(t||e||n||"warn").toLowerCase()})();function i5(t){if(!t)return"warn";const e=String(t).toLowerCase();return H0[e]!==void 0?e:"warn"}let Sw=i5(_w);function bu(t){const e=i5(t);return H0[e]<=H0[Sw]}const he={debug:(...t)=>{bu("debug")&&console.debug(...t)},info:(...t)=>{bu("info")&&console.info(...t)},warn:(...t)=>{bu("warn")&&console.warn(...t)},error:(...t)=>{bu("error")&&console.error(...t)}};let Ph=null;async function kw(){if(typeof process<"u"&&process.env&&{}.JEST_WORKER_ID){he.debug("Jest worker detected, skipping Z3 asset fetch");return}if(typeof document>"u"){if(typeof globalThis.initZ3=="function")return;const e=globalThis.Module;try{const r=(()=>{try{const{origin:y,pathname:w}=self.location||{};if(!y)return"";if(typeof w=="string"){const E=w.indexOf("/assets/");if(E!==-1)return`${y}${w.slice(0,E+1)}`;const _=w.lastIndexOf("/"),S=_>=0?w.slice(0,_+1):"/";return`${y}${S}`}return`${y}/`}catch{return""}})(),i=y=>{const w=y.startsWith("/")?y.slice(1):y;return r?`${r}${w}`:`/${w}`},s=i("z3-built.wasm.base64");he.debug("[Z3 worker] fetching WASM base64 from",s);const l=await fetch(s);if(!l.ok)throw new Error(`Failed to fetch WASM base64 from ${s}: ${l.status}`);const u=`data:application/wasm;base64,${await l.text()}`,f={...typeof e=="object"?e:{},locateFile:y=>{if(y.endsWith(".wasm"))return he.debug("[Z3 worker] locateFile",y,"->",`${u.substring(0,50)}...`),u;const w=i(y);return he.debug("[Z3 worker] locateFile",y,"->",w),w}};globalThis.Module=f;const h=i("z3-built.js"),m=await fetch(h);if(!m.ok)throw new Error(`Failed to fetch z3-built.js from ${h}: ${m.status}`);const x=await m.text();if((0,eval)(x),await new Promise(y=>setTimeout(y,20)),typeof globalThis.initZ3!="function")throw new Error("initZ3 not defined after eval");return}catch(n){throw new Error(`Failed to load Z3 in worker: ${n.message}`)}finally{typeof e=="object"?globalThis.Module=e:delete globalThis.Module}}typeof globalThis.initZ3!="function"&&(he.debug("initZ3 not found, loading Z3 built assets..."),await new Promise((e,n)=>{const r=document.createElement("script");r.src="/z3-built.js",r.async=!0,r.addEventListener("load",()=>{typeof globalThis.initZ3=="function"?(he.debug("Z3 built assets loaded successfully"),e()):n(new Error("initZ3 function not found after loading z3-built.js"))}),r.addEventListener("error",i=>{n(new Error(`Failed to load z3-built.js: ${(i==null?void 0:i.message)||i}`))}),document.head.appendChild(r)}))}async function Cw(){return Ph||(Ph=(async()=>{try{he.debug("Initializing Z3 context..."),await kw();const{init:t}=await zr(()=>import("./browser-a5fc759a.js").then(r=>r.b),[],import.meta.url);if(!t)throw new Error("Z3 init function not found. Z3-solver package may not be properly installed.");he.debug("Calling Z3 init...");const e=await t();if(!e)throw new Error("Z3 initialization failed. Check browser console for WASM loading errors.");he.debug("Creating Z3 context...");const n=new e.Context("main");if(!n)throw new Error("Failed to create Z3 context.");return he.debug("Z3 context initialized successfully"),{z3:e,ctx:n}}catch(t){he.error("Z3 initialization error:",t);const e=typeof process<"u"&&process.env&&{}.JEST_WORKER_ID;if(typeof document<"u"&&!e){he.debug("Retrying Z3 initialization with asset loading...");try{typeof globalThis.initZ3!="function"&&(he.debug("initZ3 not found, loading Z3 built assets..."),await new Promise((s,l)=>{const c=document.createElement("script");c.src="/z3-built.js",c.async=!0,c.addEventListener("load",()=>{typeof globalThis.initZ3=="function"?(he.debug("Z3 built assets loaded successfully"),s()):l(new Error("initZ3 function not found after loading z3-built.js"))}),c.addEventListener("error",u=>{l(new Error(`Failed to load z3-built.js: ${(u==null?void 0:u.message)||u}`))}),document.head.appendChild(c)}));const{init:n}=await zr(()=>import("./browser-a5fc759a.js").then(s=>s.b),[],import.meta.url),r=await n(),i=new r.Context("main");return he.debug("Z3 context initialized successfully (fallback)"),{z3:r,ctx:i}}catch(n){he.error("Fallback Z3 initialization also failed:",n)}}if(e||typeof document>"u"){he.debug("Retrying Z3 initialization for Node.js...");try{const{init:n}=await zr(()=>import("./browser-a5fc759a.js").then(s=>s.b),[],import.meta.url),r=await n(),i=new r.Context("main");return he.debug("Z3 context initialized successfully (Node.js)"),{z3:r,ctx:i}}catch(n){he.error("Node.js Z3 initialization also failed:",n)}}throw new Error(`initZ3 was not imported correctly. Please consult documentation on how to load Z3 in browser. Details: ${t.message}`)}})()),Ph}function ua(t,e=new Set){return t&&(t.type==="var"&&e.add(t.name),t.type==="pair"&&(ua(t.fst,e),ua(t.snd,e)),t.type==="binop"&&(ua(t.left,e),ua(t.right,e)),t.type==="funcall"&&t.args&&t.args.forEach(n=>ua(n,e))),e}function Rn(t,e,n){var s;const{Int:r,String:i}=t;switch(e.type){case"int":return r.val(e.value);case"string":return i.val(e.value);case"pair":const l=Rn(t,e.fst,n),c=Rn(t,e.snd,n);return l.concat(i.val(",")).concat(c);case"var":return n(e.name);case"funcall":{if(e.name==="length"&&e.args&&e.args.length===1&&((s=e.args[0])==null?void 0:s.type)==="string")return r.val((e.args[0].value||"").length);if(e.name==="concat"&&e.args&&e.args.length===2){const u=Rn(t,e.args[0],n),f=Rn(t,e.args[1],n);return u.concat(f)}if(e.name==="substring"&&e.args&&e.args.length===3){const u=Rn(t,e.args[0],n),f=Rn(t,e.args[1],n),h=Rn(t,e.args[2],n);return u.substr(f,h)}if(e.name==="length"&&e.args&&e.args.length===1)return Rn(t,e.args[0],n).length();throw new Error(`Unknown function '${e.name}'`)}case"binop":{const u=Rn(t,e.left,n),f=Rn(t,e.right,n);switch(e.op){case"+":return u.add(f);case"-":return u.sub(f);case"*":return u.mul(f);case"/":return u.div(f);default:throw new Error(`Unknown operator '${e.op}'`)}}default:throw new Error(`Unknown AST node '${e.type}'`)}}function tr(t,e){function n(r){if(r.type==="int")return r.value|0;if(r.type==="string")return r.value;if(r.type==="list")return(r.elements||[]).map(n);if(r.type==="pair")return{__pair__:!0,fst:n(r.fst),snd:n(r.snd)};if(r.type==="var"){const i=e==null?void 0:e[r.name];if(i===void 0)throw new Error(`Unbound variable '${r.name}'`);return i}if(r.type==="funcall"){if(r.name==="concat"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(typeof i=="string"&&typeof s=="string")return i+s;if(Array.isArray(i)&&Array.isArray(s))return[...i,...s];throw new Error("concat requires two strings or two lists")}if(r.name==="substring"&&r.args&&r.args.length===3){const i=n(r.args[0]),s=n(r.args[1]),l=n(r.args[2]);if(typeof i!="string"||typeof s!="number"||typeof l!="number")throw new Error("substring requires string, int, int");return i.substr(s,l)}if(r.name==="length"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Error("length requires string or list")}if(r.name==="isSubstringOf"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(typeof i!="string"||typeof s!="string")throw new Error("isSubstringOf requires two strings");return s.includes(i)}if(r.name==="head"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!Array.isArray(i)||i.length===0)throw new Error("head requires non-empty list");return i[0]}if(r.name==="tail"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!Array.isArray(i))throw new Error("tail requires list");return i.length===0?[]:i.slice(1)}if(r.name==="append"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(!Array.isArray(i))throw new Error("append requires list");return[...i,s]}if(r.name==="sublist"&&r.args&&r.args.length===3){const i=n(r.args[0]),s=n(r.args[1]),l=n(r.args[2]);if(!Array.isArray(i)||typeof s!="number"||typeof l!="number")throw new Error("sublist requires list, int, int");return i.slice(s,s+l)}if(r.name==="isSublistOf"&&r.args&&r.args.length===2){const i=n(r.args[0]),s=n(r.args[1]);if(!Array.isArray(i)||!Array.isArray(s))throw new Error("isSublistOf requires two lists");const l=i.length;if(l===0)return!0;for(let c=0;c<=s.length-l;c++){let u=!0;for(let f=0;f<l;f++)if(s[c+f]!==i[f]){u=!1;break}if(u)return!0}return!1}if(r.name==="fst"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!i||typeof i!="object"||i.__pair__!==!0)throw new Error("fst requires pair");return i.fst}if(r.name==="snd"&&r.args&&r.args.length===1){const i=n(r.args[0]);if(!i||typeof i!="object"||i.__pair__!==!0)throw new Error("snd requires pair");return i.snd}throw new Error(`Unknown function '${r.name}'`)}if(r.type==="binop"){const i=n(r.left),s=n(r.right);if(typeof i!="number"||typeof s!="number")throw new Error("Arithmetic operands must be numbers");switch(r.op){case"+":return i+s|0;case"-":return i-s|0;case"*":return i*s|0;case"/":if(s===0)throw new Error("Division by zero");return Math.trunc(i/s)|0;default:throw new Error(`Unknown operator '${r.op}'`)}}throw new Error(`Unknown node type '${r.type}'`)}return n(t)}function Tw(t,e){if(typeof t!="string")throw new Error("Predicate must be a string");const n=t.trim(),r=[">=","<=","==","!=",">","<"];let i=0,s=-1,l=null;for(let m=0;m<n.length;m++){const x=n[m];if(x==="("?i++:x===")"&&(i=Math.max(0,i-1)),i!==0)continue;const y=n.slice(m,m+2);if(r.includes(y)){l=y,s=m;break}if(r.includes(x)){l=x,s=m;break}}if(!l||s<0)throw new Error("Predicate must contain a comparison operator");const c=n.slice(0,s).trim(),u=n.slice(s+l.length).trim(),f=e(c),h=e(u);return{type:"cmp",op:l,left:f,right:h}}function xo(t,e){if(typeof t!="string")throw new Error("Boolean expression must be a string");const n=t.trim();let r=0;const i=()=>{for(;r<n.length&&/\s/.test(n[r]);)r++},s=(k,T)=>(k===0||/[^A-Za-z0-9_]/.test(n[k-1]||""))&&(k+T===n.length||/[^A-Za-z0-9_]/.test(n[k+T]||"")),l=k=>(i(),n.slice(r,r+k.length).toLowerCase()===k&&s(r,k.length)),c=()=>{i();const k=r;if(!/[A-Za-z_]/.test(n[r]||""))throw new Error(`Expected identifier at position ${r}`);for(r++;r<n.length&&/[A-Za-z0-9_]/.test(n[r]);)r++;const T=n.slice(k,r);if(T&&/^[A-Z]/.test(T))throw new Error(`Variable names must start with lowercase letter, got '${T}'`);const N=r;if(i(),n[r]===":"){r++,i();const L=r;for(;r<n.length&&/[A-Za-z]/.test(n[r]);)r++;const A=n.slice(L,r).toLowerCase();return A==="int"||A==="bool"||A==="pair"?{name:T,varType:A}:(r=N,{name:T})}return{name:T}},u=k=>{const T=String(k||"").trim();if(/^true$/i.test(T)||T==="T")return{type:"boolLit",value:!0};if(/^false$/i.test(T)||T==="F")return{type:"boolLit",value:!1};if(/^-?\d+$/.test(T))return{type:"int",value:parseInt(T,10)};if(T.startsWith("(")&&T.endsWith(")")){const R=T.slice(1,-1).trim();let M=0,I=-1;for(let O=0;O<R.length;O++){const W=R[O];if(W==="(")M++;else if(W===")")M=Math.max(0,M-1);else if(W===","&&M===0){I=O;break}}if(I>=0){const O=R.slice(0,I).trim(),W=R.slice(I+1).trim();if(O.length&&W.length)return{type:"pairLit",fst:u(O),snd:u(W)}}}try{if(typeof e=="function")return e(T)}catch{}const N=T.match(/^([A-Za-z_][A-Za-z0-9_]*)(?::([A-Za-z]+))?$/);if(!N)throw new Error(`Unrecognized term '${T}'`);const L=N[1];if(L&&/^[A-Z]/.test(L))throw new Error(`Variable names must start with lowercase letter, got '${L}'`);const A=(N[2]||"").toLowerCase();return A==="bool"?{type:"boolVar",name:L,varType:"bool"}:A==="pair"?{type:"pairVar",name:L,varType:"pair"}:{type:"var",name:L}},f=()=>{if(i(),r>=n.length)throw new Error("Unexpected end");if(n[r]==="T"&&s(r,1))return r+=1,{type:"boolLit",value:!0};if(n[r]==="F"&&s(r,1))return r+=1,{type:"boolLit",value:!1};if(l("true"))return r+=4,{type:"boolLit",value:!0};if(l("false"))return r+=5,{type:"boolLit",value:!1};if(n.slice(r).startsWith("isSubstringOf")){if(r+=13,i(),n[r]!=="(")throw new Error("Expected '('");let M=r+1,I=1;for(r++;r<n.length&&I>0;r++){const F=n[r];F==="("?I++:F===")"&&I--}if(I!==0)throw new Error("Unterminated isSubstringOf arguments");const O=n.slice(M,r-1).trim();let W=0,B="";const D=[];for(let F=0;F<O.length;F++){const U=O[F];if(U==="("){W++,B+=U;continue}if(U===")"){W=Math.max(0,W-1),B+=U;continue}if(U===","&&W===0){D.push(B.trim()),B="";continue}B+=U}if(B.trim().length&&D.push(B.trim()),D.length!==2)throw new Error("isSubstringOf expects two arguments");const $=e(D[0]),X=e(D[1]);return{type:"boolFuncall",name:"isSubstringOf",args:[$,X]}}const k=[">=","<=","==","!=",">","<"];let T=0,N=-1,L=null;for(let M=r;M<n.length;M++){const I=n[M];if(I==="("?T++:I===")"&&(T=Math.max(0,T-1)),T!==0)continue;if(n.slice(M,M+3)==="<->"){M+=2;continue}if(n.slice(M,M+2)==="->"){M+=1;continue}const O=n.slice(M,M+2);if(k.includes(O)){L=O,N=M;break}if(k.includes(I)){L=I,N=M;break}}if(L&&N>=0){const M=n.slice(r,N).trim(),I=N+L.length;let O=n.length;T=0;const W=(F,U)=>(F===0||/[^A-Za-z0-9_]/.test(n[F-1]||""))&&(F+U===n.length||/[^A-Za-z0-9_]/.test(n[F+U]||"")),B=F=>{const U=n.slice(F),G=["&&","||","^","->","<->"],K=["and","or","xor","implies","iff"];for(const Q of G)if(U.startsWith(Q))return!0;for(const Q of K)if(U.toLowerCase().startsWith(Q)&&W(F,Q.length))return!0;return!1};for(let F=I;F<n.length;F++){const U=n[F];if(U==="("){T++;continue}if(U===")"){if(T===0){O=F;break}T=Math.max(0,T-1);continue}if(T===0&&B(F)){O=F;break}}const D=n.slice(I,O).trim(),$=u(M),X=u(D);return r=O,{type:"cmp",op:L,left:$,right:X}}if(n[r]==="("){r++;const M=C();if(i(),n[r]!==")")throw new Error(`Expected ')' at ${r}`);return r++,M}const{name:A,varType:R}=c();return R?{type:"boolVar",name:A,varType:R}:{type:"boolVar",name:A}},h={not:["not"],and:["and"],xor:["xor"],or:["or"],implies:["implies"],iff:["iff"]},m={not:["!"],and:["&&"],xor:["^"],or:["||"],implies:["->"],iff:["<->"]},x=(k,T)=>{i();for(const N of k)if(n.slice(r,r+N.length)===N)return r+=N.length,!0;for(const N of T)if(n.slice(r,r+N.length).toLowerCase()===N&&s(r,N.length))return r+=N.length,!0;return!1},y=()=>(i(),x(m.not,h.not)?{type:"not",expr:y()}:f()),w=()=>{let k=y();for(;i(),x(m.and,h.and);){const T=y();k={type:"and",left:k,right:T}}return k},E=()=>{let k=w();for(;i(),x(m.xor,h.xor);){const T=w();k={type:"xor",left:k,right:T}}return k},_=()=>{let k=E();for(;i(),x(m.or,h.or);){const T=E();k={type:"or",left:k,right:T}}return k},S=()=>{let k=_();for(;i(),x(m.implies,h.implies);){const T=_();k={type:"implies",left:k,right:T}}return k},C=()=>{let k=S();for(;i(),x(m.iff,h.iff);){const T=S();k={type:"iff",left:k,right:T}}return k},g=C();if(i(),r!==n.length)throw new Error(`Unexpected token '${n[r]}' at position ${r}`);return g}function uo(t,e,n){const r=l=>{if(typeof l=="boolean")return l;if(typeof l=="number")return l!==0;if(l&&typeof l=="object"&&l.__pair__)return!0;throw new Error("Non-bool binding in bool expression")},i=l=>{if(!l)throw new Error("Invalid term");if(l.type==="int"||l.type==="bin"||l.type==="var"){try{return tr(l,e)}catch{}if(l.type==="var"&&typeof(e==null?void 0:e[l.name])<"u")return e[l.name]}return l.type==="boolLit"?!!l.value:l.type==="boolVar"?!!(e!=null&&e[l.name]):l.type==="pairVar"?e==null?void 0:e[l.name]:l.type==="pairLit"?{__pair__:!0,fst:i(l.fst),snd:i(l.snd)}:tr(l,e)},s=l=>{switch(l.type){case"boolLit":return!!l.value;case"boolVar":return r(e==null?void 0:e[l.name]);case"boolFuncall":{if(l.name==="isSubstringOf"&&l.args&&l.args.length===2){const c=tr(l.args[0],e||{}),u=tr(l.args[1],e||{});if(typeof c!="string"||typeof u!="string")throw new Error("isSubstringOf requires two string arguments");return u.includes(c)}throw new Error(`Unknown boolean function '${l.name}'`)}case"not":return!s(l.expr);case"and":return s(l.left)&&s(l.right);case"or":return s(l.left)||s(l.right);case"xor":{const c=s(l.left),u=s(l.right);return c&&!u||!c&&u}case"implies":{const c=s(l.left),u=s(l.right);return!c||u}case"iff":{const c=s(l.left),u=s(l.right);return c===u}case"cmp":{const c=i(l.left),u=i(l.right),f=(h,m)=>h&&typeof h=="object"&&h.__pair__&&m&&typeof m=="object"&&m.__pair__?f(h.fst,m.fst)&&f(h.snd,m.snd):h===m;switch(l.op){case"==":return f(c,u);case"!=":return!f(c,u);case"<":return c<u;case"<=":return c<=u;case">":return c>u;case">=":return c>=u;default:return!1}}default:throw new Error(`Unknown bool AST node '${l.type}'`)}};return s(t)}async function Ew(t,e,n){const{ctx:r}=await Cw(),{Int:i,Bool:s,Solver:l,And:c,Not:u,Or:f}=r,h=typeof t=="string"?xo(t,n):t,m=new Set,x=new Set,y=g=>{if(g)switch(g.type){case"boolVar":x.add(g.name);break;case"and":case"or":y(g.left),y(g.right);break;case"not":y(g.expr);break;case"cmp":{const k=T=>{T&&(T.type==="var"&&m.add(T.name),T.type==="bin"&&(k(T.left),k(T.right)))};k(g.left),k(g.right);break}}};y(h);const w=new Map(Array.from(m).map(g=>[g,i.const(g)])),E=new Map(Array.from(x).map(g=>[g,s.const(g)])),_=g=>{switch(g.type){case"boolLit":return g.value?s.val(!0):s.val(!1);case"boolVar":return E.get(g.name);case"boolFuncall":{if(g.name==="isSubstringOf"&&g.args&&g.args.length===2)try{const k=tr(g.args[0],e||{}),T=tr(g.args[1],e||{});if(typeof k!="string"||typeof T!="string")throw new Error("isSubstringOf requires two string arguments");return T.includes(k)?s.val(!0):s.val(!1)}catch{try{const T=Rn(r,g.args[1],L=>w.get(L)),N=Rn(r,g.args[0],L=>w.get(L));return T.contains(N)}catch{return s.val(!1)}}throw new Error(`Unknown boolean function '${g.name}'`)}case"not":return u(_(g.expr));case"and":return c(_(g.left),_(g.right));case"or":return f(_(g.left),_(g.right));case"cmp":{const k=N=>N&&(N.type==="int"||N.type==="var"||N.type==="bin"||N.type==="binop");if(k(g.left)&&k(g.right)){const N=R=>{if(R.type==="int")return i.val(R.value);if(R.type==="var")return w.get(R.name);if(R.type==="bin"||R.type==="binop"){const M=N(R.left),I=N(R.right);switch(R.op){case"+":return M.add(I);case"-":return M.sub(I);case"*":return M.mul(I);case"/":return M.div(I);default:throw new Error("Unknown arithmetic operator")}}throw new Error("Unknown arithmetic AST in bool comparison")},L=N(g.left),A=N(g.right);switch(g.op){case"==":return L.eq(A);case"!=":return u(L.eq(A));case"<":return L.lt(A);case"<=":return L.le(A);case">":return L.gt(A);case">=":return L.ge(A);default:throw new Error(`Unsupported predicate operator '${g.op}'`)}}return uo({type:"cmp",op:g.op,left:g.left,right:g.right},e||{})?s.val(!0):s.val(!1)}default:throw new Error(`Unknown bool AST node '${g.type}'`)}},S=new l;try{let g=1e4;try{typeof window<"u"&&window.__Z3_SETTINGS__&&typeof window.__Z3_SETTINGS__.solverTimeoutMs=="number"&&(g=window.__Z3_SETTINGS__.solverTimeoutMs|0)}catch{}S.set("timeout",g)}catch{}if(e&&typeof e=="object"){const g=[];for(const[k,T]of Object.entries(e))w.has(k)&&typeof T=="number"?g.push(w.get(k).eq(i.val(T|0))):E.has(k)&&typeof T=="boolean"&&g.push(E.get(k).eq(T?s.val(!0):s.val(!1)));g.length&&S.add(c(...g))}S.add(_(h));const C=await S.check();return String(C)==="sat"}async function bw(t,e,n=5){const{solveEquation:r}=await zr(()=>import("./eval-bool-6409d318.js"),[],import.meta.url);return await r(t,e,n)}function Pw(t,e,n=Rt){if(!t||typeof t!="string")return{};const r={},i=t.split(",");for(const s of i){const l=s.indexOf("=");if(l===-1)continue;const c=s.slice(0,l).trim(),u=s.slice(l+1).trim();if(!c)continue;const f=n(u);r[c]=tr(f,e)}return r}function Nw(t){return t&&typeof t=="object"&&(t.__pair__||Object.prototype.hasOwnProperty.call(t,"fst")&&Object.prototype.hasOwnProperty.call(t,"snd"))}function Ia(t){return typeof t=="boolean"?t?"T":"F":typeof t=="string"?`'${t}'`:Array.isArray(t)?`[${t.map(Ia).join(", ")}]`:Nw(t)?`(${Ia(t.fst)}, ${Ia(t.snd)})`:String(t)}function s5(t){return!Array.isArray(t)||t.length===0?"":t.map(Ia).join(", ")}const Py="text-xs font-semibold text-gray-600 uppercase tracking-wider";function Mw({isOpen:t,onClose:e}){const n=vw(),r=n.listTypes(),[i,s]=z.useState("x + 2 * y"),[l,c]=z.useState("x=3, y=4"),[u,f]=z.useState(null),[h,m]=z.useState([]),[x,y]=z.useState(null),w=z.useMemo(()=>r.map(g=>n.getType(g)),[r,n]);if(!t)return null;function E(C){const g=String(C||"").trim();if(!g)return{};try{const T=JSON.parse(g);if(T&&typeof T=="object"&&!Array.isArray(T))return T}catch{}const k={};for(const T of g.split(",")){const N=T.trim();if(!N)continue;const L=N.indexOf("=");if(L===-1)continue;const A=N.slice(0,L).trim(),R=N.slice(L+1).trim(),M=Number.parseInt(R,10);A&&(k[A]=Number.isFinite(M)?M:0)}return k}function _(C){let g=0;for(let k=0;k<C.length;k++){const T=C[k];if(T==="("?g++:T===")"&&(g=Math.max(0,g-1)),g===0&&T==="="){const N=C[k-1]||"",L=C[k+1]||"";if(N!=="="&&L!=="="&&N!=="<"&&N!==">")return k}}return-1}const S=async()=>{y(null),f(null),m([]);try{const C=String(i||"").trim();if(!C)throw new Error("Please enter an expression or an equation.");const g=_(C),k=E(l);if(g>=0){const T=Rt(C.slice(0,g)),N=Rt(C.slice(g+1));if(Object.keys(k).length>0){const A=await uo({type:"cmp",op:"==",left:T,right:N},k,Rt);f(!!A)}else{const{solutions:L}=await bw(T,N,5);m(L||[])}}else try{const T=Rt(C),N=await tr(T,k);f(N)}catch{const N=xo(C,Rt),L=uo(N,k,Rt);f(!!L)}}catch(C){y(String(C.message||C))}};return P.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30",children:P.jsxs("div",{className:"bg-white rounded shadow-lg w-[1000px] max-h-[85vh] overflow-y-auto p-4",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsx("h3",{className:"text-lg font-semibold",children:"ADT Manager - Available Types and Operations"}),P.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded",onClick:e,children:"Close"})]}),P.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[P.jsxs("div",{children:[P.jsx("div",{className:Py,children:"Available Data Types"}),w.map(C=>P.jsxs("div",{className:"mt-3 p-3 border rounded bg-gray-50",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3",children:[P.jsx("div",{className:"font-semibold text-lg",children:C.name}),C.__readonly&&P.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded",children:"Built-in"})]}),P.jsxs("div",{className:"mb-3",children:[P.jsx("div",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Operations"}),P.jsxs("div",{className:"space-y-1",children:[(C.operations||[]).map((g,k)=>P.jsxs("div",{className:"text-sm font-mono bg-white p-2 rounded border",children:[P.jsx("span",{className:"text-blue-600 font-semibold",children:g.name}),P.jsxs("span",{className:"text-gray-600",children:["(",g.params?g.params.map((T,N)=>`${T.type} ${String.fromCharCode(97+N)}`).join(", "):"no params",")"]}),P.jsx("span",{className:"text-gray-500",children:"  "}),P.jsx("span",{className:"text-green-600 font-semibold",children:g.result})]},k)),(!C.operations||C.operations.length===0)&&P.jsx("div",{className:"text-sm text-gray-500 italic",children:"(no operations)"})]})]}),P.jsxs("div",{children:[P.jsx("div",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Axioms"}),P.jsxs("div",{className:"space-y-1",children:[(C.axioms||[]).map((g,k)=>P.jsxs("div",{className:"text-sm font-mono bg-white p-2 rounded border",children:[P.jsx("span",{className:"text-purple-600 font-semibold",children:g.name?g.name+": ":""}),P.jsx("span",{className:"text-gray-800",children:g.equation})]},k)),(!C.axioms||C.axioms.length===0)&&P.jsx("div",{className:"text-sm text-gray-500 italic",children:"(no axioms)"})]})]})]},C.name))]}),P.jsxs("div",{children:[P.jsx("div",{className:Py,children:"Interactive Tools"}),P.jsxs("div",{className:"mt-3 p-3 border rounded bg-gray-50",children:[P.jsx("div",{className:"text-sm font-semibold mb-3 text-gray-700",children:"Sandbox"}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-xs text-gray-700 mb-1",children:"Expression or Equation"}),P.jsx("input",{className:"w-full border rounded p-2 text-sm font-mono",placeholder:"Enter an expression (e.g., x + 2*y) or equation with '=' (e.g., x + y = 7)",value:i,onChange:C=>s(C.target.value),"data-testid":"sandbox-expr"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-xs text-gray-700 mb-1",children:"Variable Bindings"}),P.jsx("input",{className:"w-full border rounded p-2 text-sm font-mono",placeholder:'{"x":3, "y":4} or x=3, y=4',value:l,onChange:C=>c(C.target.value),"data-testid":"sandbox-bindings"})]}),P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",onClick:S,"data-testid":"sandbox-run",children:"Run"}),u!==null&&P.jsxs("span",{className:"text-sm","data-testid":"sandbox-result",children:["Result: ",P.jsx("span",{className:"font-mono bg-green-100 px-2 py-1 rounded",children:Ia(u)})]})]}),x&&P.jsx("div",{className:"p-2 text-red-700 bg-red-100 border border-red-200 rounded text-sm whitespace-pre-wrap",children:x}),h&&h.length>0&&P.jsxs("div",{className:"text-sm","data-testid":"sandbox-solutions",children:[P.jsx("div",{className:"font-semibold mb-2 text-gray-700",children:"Solutions (up to 5):"}),P.jsx("div",{className:"space-y-1",children:h.map((C,g)=>P.jsx("div",{className:"font-mono bg-white p-2 rounded border","data-testid":"sandbox-sol-entry",children:JSON.stringify(C)},g))})]})]})]}),P.jsxs("div",{className:"mt-4 p-3 border rounded bg-blue-50",children:[P.jsx("div",{className:"text-sm font-semibold mb-2 text-blue-800",children:"Usage Notes"}),P.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[P.jsx("div",{children:" Int operations: +(Int a, Int b), *(Int a, Int b), ==(Int a, Int b), etc."}),P.jsx("div",{children:" Bool operations: and(Bool a, Bool b), or(Bool a, Bool b), not(Bool a)"}),P.jsx("div",{children:" Pair operations: fst(Pair p), snd(Pair p), ==(Pair a, Pair b)"}),P.jsx("div",{children:" Pair literals: (value1, value2)"}),P.jsx("div",{children:" All operations support pattern matching and deconstruction"}),P.jsx("div",{children:" Parameter names (a, b, c, ...) are automatically assigned for display"})]})]})]})]})]})})}const Sc="http://example.org/apn",Aw="http://www.pnml.org/version-2009/grammar/pnml",Iw=500,o5={startX:40,startY:40,spacing:80,columns:25,transitionOffsetX:220};function Nh(t){return t?Array.from(t):[]}function Lw(t){const n=new DOMParser().parseFromString(t,"application/xml"),r=n.querySelector("parsererror");if(r)throw console.error("XML parsing error:",r.textContent),new Error("Invalid XML: "+r.textContent);const i=n.documentElement,s=i.namespaceURI||Aw;return{xmlDoc:n,pnmlElement:i,PNML_NS:s}}function Rw(t,e){const n=t.getElementsByTagNameNS(e,"net");if(n&&n.length>0)return n[0];const r=t.getElementsByTagName("net");return r&&r.length>0?r[0]:null}function Fw(t,e){const n=t.getElementsByTagNameNS(e,"page");if(n&&n.length>0)return n[0];const r=t.getElementsByTagName("page");return r&&r.length>0?r[0]:null}function a5(t){const e=(i,s)=>{if(!i)return[];const l=typeof i.getElementsByTagNameNS=="function"?i.getElementsByTagNameNS(t,s):[];if(l&&l.length>0)return Nh(l);const c=typeof i.getElementsByTagNameNS=="function"?i.getElementsByTagNameNS(Sc,s):[];if(c&&c.length>0)return Nh(c);const u=typeof i.getElementsByTagName=="function"?i.getElementsByTagName(s):[];return u&&u.length>0?Nh(u):[]},n=(i,s)=>e(i,s);return{getElements:e,findChildElements:n,getTextContent:(i,s)=>{const l=n(i,s);if(l.length===0)return"";const c=l[0],u=c.getElementsByTagName("text").length?c.getElementsByTagName("text"):c.getElementsByTagNameNS(Sc,"text");if(u&&u.length>0){const f=u[0];if(f&&typeof f.textContent=="string")return f.textContent}return typeof c.textContent=="string"?c.textContent:""}}}function Mh(t,e,n){return t?a5(e).getElements(t,n):[]}function jw(t){return t>=Iw}function l5(t,e,n,r,i){const{findChildElements:s}=e,{applyAutoLayout:l,layout:c=o5}=n,{startX:u,startY:f,spacing:h,columns:m,transitionOffsetX:x}=c,y=Ow(t,s);if(y.found||!l)return{x:y.x,y:y.y};const w=r%m,E=Math.floor(r/m),_=u+w*h,S=f+E*h;return i==="transition"?{x:_+x,y:S}:{x:_,y:S}}function Ow(t,e){const n=e(t,"graphics");if(n.length>0){const r=e(n[0],"position");if(r.length>0){const i=parseInt(r[0].getAttribute("x")||"0",10),s=parseInt(r[0].getAttribute("y")||"0",10);return{x:i,y:s,found:!0}}}return{x:0,y:0,found:!1}}function Dw(t,e={}){return{applyAutoLayout:t,layout:{...o5,...e}}}function ig(t){const e=[];let n="",r=0,i=0,s=!1;for(let c=0;c<t.length;c++){const u=t[c];if(s){n+=u,u==="'"&&t[c-1]!=="\\"&&(s=!1);continue}if(u==="'"){s=!0,n+=u;continue}if(u==="("){r++,n+=u;continue}if(u===")"){r=Math.max(0,r-1),n+=u;continue}if(u==="["){i++,n+=u;continue}if(u==="]"){i=Math.max(0,i-1),n+=u;continue}if(u===","&&r===0&&i===0){e.push(n.trim()),n="";continue}n+=u}const l=n.trim();return l.length>0&&e.push(l),e.filter(Boolean)}function La(t){const e=String(t||"").trim(),n=e.toLowerCase();if(e==="T"||n==="true")return!0;if(e==="F"||n==="false")return!1;if(/^[+-]?\d+$/.test(e))return parseInt(e,10);if(e.startsWith("'")&&e.endsWith("'")&&e.length>=2)return e.slice(1,-1).replace(/\\(.)/g,(i,s)=>s==="n"?`
`:s==="t"?"	":s==="r"?"\r":s==="\\"?"\\":s==="'"?"'":s);if(e.startsWith("[")&&e.endsWith("]")){const r=e.slice(1,-1).trim();return r.length===0?[]:ig(r).map(s=>La(s))}if(e.startsWith("(")&&e.endsWith(")")){const r=e.slice(1,-1).trim();let i=0,s=-1;for(let l=0;l<r.length;l++){const c=r[l];if(c==="(")i++;else if(c===")")i=Math.max(0,i-1);else if(c===","&&i===0){s=l;break}}if(s>=0){const l=r.slice(0,s).trim(),c=r.slice(s+1).trim();return{__pair__:!0,fst:La(l),snd:La(c)}}}return null}const zw=t=>`P${t+1}`;function Bw(t,e,n){const{getTextContent:r,getElements:i}=e,s=[];return t.forEach((l,c)=>{try{const u=l.getAttribute("id"),f=r(l,"name")||zw(c),h=l5(l,e,n,c,"place");let m=0,x;const y=i(l,"valueTokens").filter(E=>E.namespaceURI===Sc&&E.parentElement===l);if(y.length>0){const E=y[0],_=E.getElementsByTagNameNS?E.getElementsByTagNameNS(Sc,"token"):E.getElementsByTagName("token"),S=Array.from(_||[]).map(C=>{let g=r(C,"text");!g&&typeof C.textContent=="string"&&(g=C.textContent);const k=typeof g=="string"?g.trim():"";return k?La(k):null}).filter(C=>C!==null);x=S,m=S.length}else{const E=r(l,"initialMarking");if(E){const _=E.trim();if(_.startsWith("[")&&_.endsWith("]"))try{const S=_.slice(1,-1).trim();x=(S.length?ig(S):[]).map(La).filter(g=>g!==null),m=Array.isArray(x)?x.length:0}catch(S){console.warn(`Could not parse token list for ${u}:`,S)}else{const S=parseInt(_,10);Number.isFinite(S)&&(m=S)}}}const w=r(l,"type");s.push({id:u,name:f,label:f,x:h.x,y:h.y,tokens:m,valueTokens:x,type:w||void 0})}catch(u){console.error("Error processing place:",u)}}),s}const Uw=t=>`T${t+1}`;function Gw(t,e,n){const{getTextContent:r}=e,i=[];return t.forEach((s,l)=>{try{const c=s.getAttribute("id"),u=r(s,"name")||Uw(l),f=l5(s,e,n,l,"transition"),h=r(s,"guard"),m=r(s,"action");i.push({id:c,name:u,label:u,x:f.x,y:f.y,guard:h||void 0,action:m||void 0})}catch(c){console.error("Error processing transition:",c)}}),i}const Vw="north",Ww="south";function $w(t,e,n){const{getTextContent:r,findChildElements:i}=e,s=[],{placeIds:l,transitionIds:c}=n;return t.forEach(u=>{try{const f=u.getAttribute("id"),h=u.getAttribute("source"),m=u.getAttribute("target");if(!h||!m){console.warn(`Skipping arc ${f} due to missing source or target`);return}let x=Vw,y=Ww;const w=i(u,"graphics");if(w.length>0){const k=i(w[0],"metadata");if(k.length>0){const T=i(k[0],"sourceDirection");T.length>0&&T[0].textContent&&(x=T[0].textContent);const N=i(k[0],"targetDirection");N.length>0&&N[0].textContent&&(y=N[0].textContent)}}const E=Hw(f,h,m,l,c);let _=1;const S=r(u,"inscription");if(S){const k=parseInt(S,10);Number.isFinite(k)?_=k:console.warn(`Could not parse weight for ${f}: '${S}', defaulting to 1`)}const C=r(u,"binding");let g;if(C&&C.includes(","))try{g=ig(C)}catch{g=C.split(",").map(T=>T.trim()).filter(Boolean)}else C&&(g=[C.trim()]);s.push({id:f,source:h,target:m,type:E,weight:_,binding:g?void 0:C||void 0,bindings:g||void 0,sourceDirection:x,targetDirection:y})}catch(f){console.error("Error processing arc:",f)}}),s}function Hw(t,e,n,r,i){const s=r.includes(e),l=i.includes(e),c=r.includes(n),u=i.includes(n);return s&&u?"place-to-transition":l&&c?"transition-to-place":e.toLowerCase().includes("place")&&n.toLowerCase().includes("transition")?"place-to-transition":e.toLowerCase().includes("transition")&&n.toLowerCase().includes("place")?"transition-to-place":(console.warn(`Could not determine arc type for ${t}, defaulting to place-to-transition`),"place-to-transition")}function Xw(t){const e={places:[],transitions:[],arcs:[]};try{const{xmlDoc:n,PNML_NS:r}=Lw(t),i=Rw(n,r);if(!i)return console.error("No net element found in the PNML file"),e;const s=i.getAttribute("netMode");s&&(e.netMode=s);const l=Fw(i,r);if(!l)return console.error("No page element found in the PNML file"),e;const c=a5(r),u=Mh(l,r,"place"),f=Mh(l,r,"transition"),h=Mh(l,r,"arc"),m=u.length+f.length,x=Dw(jw(m));return e.places=Bw(u,c,x),e.transitions=Gw(f,c,x),e.arcs=$w(h,c,{placeIds:e.places.map(y=>y.id),transitionIds:e.transitions.map(y=>y.id)}),e}catch(n){return console.error("Error parsing PNML:",n),e}}const cn="http://example.org/apn";function Yw(t){try{const e=document.implementation.createDocument("http://www.pnml.org/version-2009/grammar/pnml","pnml",null),n=e.documentElement;let r=!1;const i=e.createElement("net");i.setAttribute("id","net1"),i.setAttribute("type","http://www.pnml.org/version-2009/grammar/ptnet"),n.appendChild(i),t.netMode&&i.setAttribute("netMode",t.netMode);const s=e.createElement("name"),l=e.createElement("text");l.textContent="Petri Net",s.appendChild(l),i.appendChild(s);const c=e.createElement("page");c.setAttribute("id","page1"),i.appendChild(c);const u=t.places||[];u.forEach(E=>{const _=e.createElement("place");_.setAttribute("id",E.id);const S=e.createElement("name"),C=e.createElement("text");C.textContent=E.label||E.name||`P${E.id}`,S.appendChild(C),_.appendChild(S);const g=e.createElement("graphics"),k=e.createElement("position");if(k.setAttribute("x",E.x||0),k.setAttribute("y",E.y||0),g.appendChild(k),_.appendChild(g),E.type){const N=e.createElementNS(cn,"apn:type"),L=e.createElementNS(cn,"apn:text");L.textContent=String(E.type),N.appendChild(L),_.appendChild(N),r=!0}const T=N=>typeof N=="boolean"?N?"T":"F":typeof N=="string"?`'${N.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")}'`:Array.isArray(N)?`[${N.map(T).join(", ")}]`:N&&typeof N=="object"&&N.__pair__?`(${T(N.fst)}, ${T(N.snd)})`:String(N);if(Array.isArray(E.valueTokens)){const N=e.createElementNS(cn,"apn:valueTokens");E.valueTokens.forEach(L=>{const A=e.createElementNS(cn,"apn:token"),R=e.createElementNS(cn,"apn:text");R.textContent=T(L),A.appendChild(R),N.appendChild(A)}),_.appendChild(N),r=!0}else if(E.tokens>0){const N=e.createElement("initialMarking"),L=e.createElement("text");L.textContent=E.tokens,N.appendChild(L),_.appendChild(N)}c.appendChild(_)});const f=t.transitions||[];f.forEach(E=>{const _=e.createElement("transition");_.setAttribute("id",E.id);const S=e.createElement("name"),C=e.createElement("text");C.textContent=E.label||E.name||`T${E.id}`,S.appendChild(C),_.appendChild(S);const g=e.createElement("graphics"),k=e.createElement("position");if(k.setAttribute("x",E.x||0),k.setAttribute("y",E.y||0),g.appendChild(k),_.appendChild(g),E.guard){const T=e.createElementNS(cn,"apn:guard"),N=e.createElementNS(cn,"apn:text");N.textContent=String(E.guard),T.appendChild(N),_.appendChild(T),r=!0}if(E.action){const T=e.createElementNS(cn,"apn:action"),N=e.createElementNS(cn,"apn:text");N.textContent=String(E.action),T.appendChild(N),_.appendChild(T),r=!0}c.appendChild(_)});const h=t.arcs||[],m=new Set(u.map(E=>E.id)),x=new Set(f.map(E=>E.id));return h.filter(E=>{const _=E.source||E.sourceId,S=E.target||E.targetId;if(!_||!S||_==="undefined"||S==="undefined")return console.warn(`Skipping invalid arc ${E.id} during save - missing or undefined source/target`),!1;const C=m.has(_)||x.has(_),g=m.has(S)||x.has(S);return!C||!g?(console.warn(`Skipping invalid arc ${E.id} during save - references non-existent elements`),!1):!0}).forEach(E=>{const _=e.createElement("arc");_.setAttribute("id",E.id);const S=E.source||E.sourceId,C=E.target||E.targetId;_.setAttribute("source",S),_.setAttribute("target",C);const g=e.createElement("graphics"),k=e.createElement("metadata"),T=e.createElement("sourceDirection");T.textContent=E.sourceDirection||"north",k.appendChild(T);const N=e.createElement("targetDirection");if(N.textContent=E.targetDirection||"south",k.appendChild(N),g.appendChild(k),_.appendChild(g),E.weight>1&&!(E.binding||Array.isArray(E.bindings)&&E.bindings.length)){const L=e.createElement("inscription"),A=e.createElement("text");A.textContent=E.weight,L.appendChild(A),_.appendChild(L)}if(Array.isArray(E.bindings)&&E.bindings.length>0){const L=e.createElementNS(cn,"apn:binding"),A=e.createElementNS(cn,"apn:text");A.textContent=E.bindings.join(", "),L.appendChild(A),_.appendChild(L),r=!0}else if(E.binding){const L=e.createElementNS(cn,"apn:binding"),A=e.createElementNS(cn,"apn:text");A.textContent=String(E.binding),L.appendChild(A),_.appendChild(L),r=!0}c.appendChild(_)}),r&&n.setAttribute("xmlns:apn",cn),new XMLSerializer().serializeToString(e)}catch(e){throw console.error("Error generating PNML:",e),e}}async function Ny(t){try{return Yw(t)}catch(e){throw console.error("Error exporting to PNML:",e),e}}async function Kw(t){try{return Xw(t)}catch(e){throw console.error("Error importing from PNML:",e),e}}class Qw{constructor(){this.listeners=new Map}on(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)}off(e,n){if(!this.listeners.has(e))return;const r=this.listeners.get(e),i=r.indexOf(n);i>-1&&r.splice(i,1)}emit(e,n){if(!this.listeners.has(e))return;const r=this.listeners.get(e);for(const i of r)try{i(n)}catch(s){console.error(`Error in event listener for ${e}:`,s)}}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){return this.listeners.has(e)?this.listeners.get(e).length:0}}const no={transitionsChanged:"transitionsChanged",transitionFired:"transitionFired"},ca=new Qw;class u5{constructor(){this.isInitialized=!1,this.petriNet=null,this.eventBus=null,this.simulationMode="single"}async initialize(e,n={}){if(!this.validatePetriNet(e))throw new Error("Invalid Petri net structure");this.petriNet=this.normalizeNet(e),this.isInitialized=!0,this.simulationMode=n.simulationMode||"single",await this.initializeSpecific(this.petriNet,n)}async initializeSpecific(e,n){}async update(e){if(!this.isInitialized)throw new Error("Simulator not initialized");if(!this.validatePetriNet(e))throw new Error("Invalid Petri net structure");this.petriNet=this.normalizeNet(e),await this.updateSpecific(this.petriNet)}async updateSpecific(e){}async getEnabledTransitions(){return this.isInitialized?await this.getEnabledTransitionsSpecific():[]}async getEnabledTransitionsSpecific(){return[]}async fireTransition(e,n={}){if(!this.isInitialized)throw new Error("Simulator not initialized");if(!(n.skipEnabledCheck||!1)&&!(await this.getEnabledTransitions()).includes(e))throw new Error(`Transition ${e} is not enabled`);return await this.fireTransitionSpecific(e,n)}async fireTransitionSpecific(e){return this.petriNet}async stepSimulation(){if(!this.isInitialized)throw new Error("Simulator not initialized");return await this.stepSimulationSpecific()}async stepSimulationSpecific(){return this.petriNet}reset(){this.isInitialized=!1,this.petriNet=null,this.simulationMode="single",this.resetSpecific()}resetSpecific(){}setEventBus(e){this.eventBus=e}emitTransitionsChanged(e={}){if(!this.eventBus)return;const n=Array.isArray(e.enabled)?e.enabled:[],r=Array.isArray(e.previouslyEnabled)?e.previouslyEnabled:[],i=typeof e.hasEnabled=="boolean"?e.hasEnabled:n.length>0;this.eventBus.emit(no.transitionsChanged,{enabled:n,previouslyEnabled:r,hasEnabled:i})}emitTransitionFired(e={}){if(!this.eventBus)return;const{transitionId:n,newPetriNet:r}=e||{};n&&this.eventBus.emit(no.transitionFired,{transitionId:n,newPetriNet:r})}getType(){throw new Error("getType() must be implemented by subclasses")}validatePetriNet(e){if(!e||typeof e!="object")return!1;const{places:n,transitions:r,arcs:i}=e;return!(!Array.isArray(n)||!Array.isArray(r)||!Array.isArray(i))}normalizeNet(e){const n=JSON.parse(JSON.stringify(e||{places:[],transitions:[],arcs:[]})),r=Array.isArray(n.places)?n.places:[],i=Array.isArray(n.transitions)?n.transitions:[],s=Array.isArray(n.arcs)?n.arcs:[],l=new Set(r.map(u=>String(u.id))),c=new Set(i.map(u=>String(u.id)));for(const u of r){if(u.id=String(u.id),Array.isArray(u.valueTokens)){const f=u.valueTokens.length;(!Number.isFinite(u.tokens)||u.tokens!==f)&&(u.tokens=f)}else Number.isFinite(u.tokens)||(u.tokens=0);!u.label&&u.name&&(u.label=u.name),!u.name&&u.label&&(u.name=u.label)}for(const u of s){u.id!==void 0&&(u.id=String(u.id));const f=u.sourceId||u.source,h=u.targetId||u.target;u.sourceId=String(f),u.targetId=String(h),u.source===void 0&&(u.source=u.sourceId),u.target===void 0&&(u.target=u.targetId);const m=Number(u.weight);u.weight=Number.isFinite(m)&&m>0?m:1,Array.isArray(u.bindings)||(u.binding?u.bindings=[String(u.binding)]:u.bindings=[]),u.sourceType||(u.sourceType=l.has(u.sourceId)?"place":c.has(u.sourceId)?"transition":u.sourceType),u.targetType||(u.targetType=l.has(u.targetId)?"place":c.has(u.targetId)?"transition":u.targetType)}return n.places=r,n.transitions=i,n.arcs=s,n}isReady(){return this.isInitialized&&this.petriNet!==null}getSimulationStats(){if(!this.isInitialized)return{enabledTransitions:[],totalTokens:0,totalPlaces:0,totalTransitions:0};const{places:e,transitions:n}=this.petriNet,r=e.reduce((i,s)=>i+(s.tokens||0),0);return{enabledTransitions:[],totalTokens:r,totalPlaces:e.length,totalTransitions:n.length}}}function Zw(t){if(!(t!=null&&t.transitions)||!(t!=null&&t.places)||!(t!=null&&t.arcs))return!1;for(const e of t.transitions)if(c5(e.id,t))return!1;return!0}function c5(t,e){const n=qw(t,e.places,e.arcs);for(const r of n){const i=e.arcs.find(l=>(l.sourceId===r.id||l.source===r.id)&&(l.targetId===t||l.target===t));if(!i)continue;const s=i.weight||1;if((r.tokens||0)<s)return!1}return!0}function qw(t,e,n){const r=[];for(const i of n){const s=i.sourceId||i.source;if((i.targetId||i.target)===t){const c=e.find(u=>u.id===s);c&&r.push(c)}}return r}function Jw(t){var l,c,u,f,h;if(!t)return null;const e=((l=t.places)==null?void 0:l.length)||0,n=((c=t.transitions)==null?void 0:c.length)||0,r=((u=t.arcs)==null?void 0:u.length)||0,i=((f=t.places)==null?void 0:f.reduce((m,x)=>m+(x.tokens||0),0))||0,s=((h=t.transitions)==null?void 0:h.filter(m=>c5(m.id,t)))||[];return{placeCount:e,transitionCount:n,arcCount:r,totalTokens:i,enabledTransitionCount:s.length,enabledTransitions:s.map(m=>m.id),isDeadlock:Zw(t)}}function d5(t,e){const n=new Map;for(const r of t)r.srcId&&(n.has(r.srcId)||n.set(r.srcId,[]),n.get(r.srcId).push(r));for(const[r,i]of n.entries()){const s=e[r];if(!s)continue;const l=i.filter(u=>u.countFallback).length;if(l>0){const u=Number(s.tokens||0);s.tokens=Math.max(0,u-l)}const c=i.filter(u=>!u.countFallback);if(Array.isArray(s.valueTokens)&&c.length>0){c.sort((u,f)=>f.tokenIndex-u.tokenIndex);for(const u of c)u.tokenIndex>=0&&u.tokenIndex<s.valueTokens.length&&s.valueTokens.splice(u.tokenIndex,1);s.tokens=s.valueTokens.length}}}function e9(t,e,n,r,i){const{evaluateArithmeticWithBindings:s,evaluateBooleanWithBindings:l,evaluatePatternLiteral:c,parseArithmetic:u}=i;for(const f of t){const h=f.targetId,m=r[h];if(!m)continue;const x=e.get(f.id)||[];if(x.length>0){Array.isArray(m.valueTokens)||(m.valueTokens=[]);for(const y of x)try{let w;const{kind:E,ast:_}=y;_&&(_.type==="var"||_.type==="boolVar"||_.type==="pairVar")?w=(n||{})[_.name]:E==="arith"?w=s(_,n):E==="bool"?w=l(_,n,u):E==="pattern"?w=c(_,n||{}):E==="pair"&&_.type==="pairLit"&&(w=c(_,n||{})),Array.isArray(m.valueTokens)||(m.valueTokens=[]),typeof w=="number"?m.valueTokens.push(w|0):typeof w=="boolean"||typeof w=="string"||t9(w)?m.valueTokens.push(w):Array.isArray(w)&&(E==="arith"||E==="pair"||_&&(_.type==="list"||_.type==="listPattern"||_.type==="tuplePattern")?m.valueTokens.push(w):m.valueTokens.push(...w))}catch{}}else if(f.weight&&(f.weight|0)>0){const y=f.weight|0;for(let w=0;w<y;w++){const E=Object.values(n||{});if(Array.isArray(m.valueTokens)){const _=E[0];m.valueTokens.push(typeof _=="boolean"?!!_:Number.isFinite(_)?_|0:1)}else m.tokens=Number(m.tokens||0)+1|0}}else Array.isArray(m.valueTokens)?m.valueTokens.push(1):m.tokens=Number(m.tokens||0)+1|0;Array.isArray(m.valueTokens)&&(m.tokens=m.valueTokens.length)}}function t9(t){return!!(t&&typeof t=="object"&&t.__pair__===!0&&"fst"in t&&"snd"in t)}class n9 extends u5{constructor(){super(),this.maxTokens=1/0}getType(){return"pt"}async initializeSpecific(e,n={}){const r=Number(n.maxTokens);this.maxTokens=Number.isFinite(r)&&r>=0?r:1/0,this.validatePTNet(e),this.initializeTokens(e),he.debug("P/T Simulator initialized with",e.places.length,"places and",e.transitions.length,"transitions")}async updateSpecific(e){this.initializeTokens(e);const n=await this.getEnabledTransitionsSpecific();this.emitTransitionsChanged({enabled:n})}async getEnabledTransitionsSpecific(){if(!this.petriNet)return[];const{places:e,transitions:n,arcs:r}=this.petriNet,i=[];for(const s of n)this.isTransitionEnabled(s,e,r)&&i.push(s.id);return i}isTransitionEnabled(e,n,r){const i=r.filter(s=>s.target===e.id&&s.source!==e.id);for(const s of i){const l=n.find(f=>f.id===s.source);if(!l)continue;const c=s.weight||1;if((l.tokens||0)<c)return!1}return!0}async fireTransitionSpecific(e,n={}){const{places:r,transitions:i,arcs:s}=this.petriNet,l=n.skipEnabledCheck||!1,c=l?[]:await this.getEnabledTransitionsSpecific();if(!i.find(_=>_.id===e))throw new Error(`Transition ${e} not found`);const f=JSON.parse(JSON.stringify(this.petriNet)),h=f.places,m=s.filter(_=>_.target===e&&_.source!==e),x=s.filter(_=>_.source===e&&_.target!==e),y=[];for(const _ of m){const S=(_.weight||1)|0;for(let C=0;C<S;C++)y.push({srcId:_.source,countFallback:!0})}const w=Object.fromEntries(h.map(_=>[_.id,_]));d5(y,w);const E=x.map(_=>({id:_.id,sourceId:_.source,targetId:_.target,weight:_.weight||1}));for(const _ of E){const S=w[_.targetId];if(!S)continue;Array.isArray(S.valueTokens)&&delete S.valueTokens;const C=(_.weight||1)|0;S.tokens=Number(S.tokens||0)+C|0}for(const _ of h)Array.isArray(_.valueTokens)?(_.tokens=Math.min(this.maxTokens,Array.isArray(_.valueTokens)?_.valueTokens.length:_.tokens||0),delete _.valueTokens):_.tokens=Math.min(this.maxTokens,_.tokens||0);if(this.petriNet=f,!l){this.emitTransitionFired({transitionId:e,newPetriNet:f});const _=await this.getEnabledTransitionsSpecific();this.emitTransitionsChanged({enabled:_,previouslyEnabled:c})}return f}async stepSimulationSpecific(){return this.petriNet}resetSpecific(){this.maxTokens=1/0}validatePTNet(e){const{transitions:n}=e;for(const r of n){if(r.guard&&typeof r.guard=="string"&&(r.guard.includes("+")||r.guard.includes("-")||r.guard.includes("*")||r.guard.includes("/")||r.guard.includes("=")||r.guard.includes("<")||r.guard.includes(">")||r.guard.includes("!=")))throw new Error("P/T simulator cannot handle algebraic expressions. Use algebraic simulator instead.");if(r.action&&typeof r.action=="string"&&(r.action.includes("+")||r.action.includes("-")||r.action.includes("*")||r.action.includes("/")||r.action.includes("=")))throw new Error("P/T simulator cannot handle algebraic expressions. Use algebraic simulator instead.")}}initializeTokens(e){const{places:n}=e;for(const r of n)(r.tokens===void 0||r.tokens===null)&&(r.tokens=0),r.tokens=Math.min(this.maxTokens,Math.max(0,r.tokens))}getSimulationStats(){if(!this.isInitialized)return{enabledTransitions:[],totalTokens:0,totalPlaces:0,totalTransitions:0};const{places:e,transitions:n}=this.petriNet,r=e.reduce((s,l)=>s+(l.tokens||0),0);return{enabledTransitions:this.getEnabledTransitionsSync(),totalTokens:r,totalPlaces:e.length,totalTransitions:n.length}}getEnabledTransitionsSync(){if(!this.petriNet)return[];const{places:e,transitions:n,arcs:r}=this.petriNet,i=[];for(const s of n)this.isTransitionEnabled(s,e,r)&&i.push(s.id);return i}}function vr(t,e){if(!t)return null;switch(t.type){case"pairLit":return{__pair__:!0,fst:vr(t.fst,e),snd:vr(t.snd,e)};case"list":return(t.elements||[]).map(n=>vr(n,e));case"pairPattern":return{__pair__:!0,fst:vr(t.fst,e),snd:vr(t.snd,e)};case"tuplePattern":return(t.elements||t.components||[]).map(n=>vr(n,e));case"listPattern":return(t.elements||[]).map(n=>vr(n,e));case"boolLit":return!!t.value;case"int":return t.value|0;case"var":case"boolVar":case"pairVar":return(e||{})[t.name];default:return null}}function r9(t,e,n,r){var i;try{const s=(t.arcs||[]).filter(l=>l.sourceId===n&&(l.targetType==="place"||!l.targetType));for(const l of s){const c=((i=e==null?void 0:e.bindingAstsByArc)==null?void 0:i.get(l.id))||[];for(const u of c){const{ast:f}=u||{};if(f&&(f.type==="var"||f.type==="boolVar"||f.type==="pairVar")){const h=r?r[f.name]:void 0;if(h===void 0)continue;const m=f.varType;if(m==="int"&&typeof h!="number"||m==="bool"&&typeof h!="boolean"||m==="string"&&typeof h!="string"||m==="pair"&&!(h&&typeof h=="object"&&h.__pair__===!0)||m==="list"&&!Array.isArray(h))return!1}}}return!0}catch{return!1}}const i9=["concat","substring","length","head","tail","append","sublist","isSublistOf","isSubstringOf","fst","snd"],s9=new Set(i9);function o9(t,e,n,r){const i=new Map;for(const s of t.transitions||[])if(s.guard&&typeof s.guard=="string")try{const l=n(String(s.guard),e);i.set(s.id,l)}catch{try{const c=r(String(s.guard),e);i.set(s.id,c)}catch{}}return i}function a9(t,e){if(!t)return!1;const n=t.length;for(let r=0;r<n;r+=1){const i=t[r];if(!/[A-Za-z_]/.test(i))continue;let s=r+1;for(;s<n&&/[A-Za-z0-9_]/.test(t[s]);)s+=1;const l=t.slice(r,s);if(e.has(l)){let c=s;for(;c<n&&/\s/.test(t[c]);)c+=1;if(c<n&&t[c]==="(")return!0}r=s-1}return!1}function l9(t,e,n,r,i){const s=new Map;for(const l of t.arcs||[]){const c=l.id,u=Array.isArray(l.bindings)?l.bindings:l.binding?[l.binding]:[],f=[];for(const h of u){const m=String(h),x=m.trim(),y=a9(x,i),w=g=>{if(!g||typeof g!="object")return!0;switch(g.type){case"funcall":return i.has(g.name)?(g.args||[]).every(w):!1;case"pair":return w(g.fst)&&w(g.snd);case"list":return(g.elements||[]).every(w);case"binop":return w(g.left)&&w(g.right);default:return!0}},E=()=>{let g=null;try{g=n(m)}catch{g=null}return!g||!w(g)?!1:(g.type==="var"&&g.varType==="bool"?f.push({kind:"bool",ast:{type:"boolVar",name:g.name,varType:"bool"}}):g.type==="var"&&g.varType==="pair"?f.push({kind:"pair",ast:{type:"pairVar",name:g.name,varType:"pair"}}):f.push({kind:"arith",ast:g}),!0)},_=()=>{try{const g=e(m);return f.push({kind:"pattern",ast:g}),!0}catch{return!1}};let S=!1;if(y?(S=E(),S||(S=_())):(S=_(),S||(S=E())),S)continue;const C=m==="T"?!0:m==="F"?!1:null;if(C!==null){f.push({kind:"bool",ast:{type:"boolLit",value:C}});continue}try{f.push({kind:"bool",ast:r(m,n)});continue}catch{}}f.length&&s.set(c,f)}return s}function My(t){return!!(t&&typeof t=="object"&&t.__pair__===!0&&"fst"in t&&"snd"in t)}async function Ay({transition:t,inputArcs:e,placesById:n,bindingAstsByArc:r,guardAst:i,parseArithmetic:s,evaluateBooleanPredicate:l,matchPattern:c,getTokensForPlace:u,evaluateArithmeticWithBindings:f,evaluateBooleanWithBindings:h,evaluatePatternLiteral:m,maxTokensPerPlace:x=20}){const y=[],w=async(E,_)=>{if(E>=e.length){if(!i)return{env:_,picks:y};try{return h(i,_||{},s)?{env:_,picks:y}:null}catch{try{return await l(i,_||{},s)?{env:_,picks:y}:null}catch{return null}}}const S=e[E],C=S.id,g=S.sourceId||S.source,k=n[g],T=u(k,x),N=r.get(C)||[],L=N.length||(S.weight?Math.max(1,S.weight|0):0);if(L===0)return w(E+1,_);if(T.length<L)return null;const A=new Array(T.length).fill(!1),R=async(M,I)=>{if(M>=L)return w(E+1,I);for(let O=0;O<T.length;O++){if(A[O])continue;A[O]=!0;const W=T[O];let B=!0,D=I;const $=N[M];if($){const{kind:X,ast:F}=$;if(X==="pattern"){const U=c(F,W);if(U===null)B=!1;else{for(const[G,K]of Object.entries(U))if(D&&Object.prototype.hasOwnProperty.call(D,G)&&D[G]!==K){B=!1;break}B&&(D={...D||{},...U})}}else if(F&&(F.type==="var"||F.type==="boolVar"||F.type==="pairVar"))D&&Object.prototype.hasOwnProperty.call(D,F.name)&&D[F.name]!==W?B=!1:(typeof W=="boolean"&&F.varType&&F.varType!=="bool"&&(B=!1),typeof W=="number"&&F.varType&&F.varType!=="int"&&(B=!1),typeof W=="string"&&F.varType&&F.varType!=="string"&&(B=!1),Array.isArray(W)&&F.varType&&F.varType!=="list"&&(B=!1),My(W)&&F.varType&&F.varType!=="pair"&&(B=!1),B&&(D={...D||{},[F.name]:W}));else if(X==="arith")try{const U=f(F,I||{});(typeof W!="number"||U!==(W|0))&&(B=!1)}catch{B=!1}else if(X==="bool")try{const U=h(F,I||{},s);(typeof W!="bool"||U!==W)&&(B=!1)}catch{B=!1}else if(X==="pair")try{if(F.type==="pairLit"){const U=m(F,I||{});(!My(W)||JSON.stringify(U)!==JSON.stringify(W))&&(B=!1)}}catch{B=!1}}if(B){y.push({arcId:S.id,srcId:g,tokenIndex:O,value:W,countFallback:!Array.isArray(k==null?void 0:k.valueTokens)});const X=await R(M+1,D);if(X)return X;y.pop()}A[O]=!1}return null};return R(0,_||{})};return w(0,{})}function f5(t){const e=new Set;function n(r){if(r)switch(r.type){case"var":e.add(r.name);break;case"pairPattern":n(r.fst),n(r.snd);break;case"listPattern":Array.isArray(r.elements)&&r.elements.forEach(n);break;case"tuplePattern":r.elements&&r.elements.forEach(n);break}}return n(t),Array.from(e)}function h5(t){const e=new Set;function n(r){if(r)switch(r.type){case"var":case"boolVar":case"pairVar":e.add(r.name);break;case"binop":case"cmp":n(r.left),n(r.right);break;case"unop":n(r.operand);break;case"call":r.args&&r.args.forEach(n);break;case"pairPattern":n(r.fst),n(r.snd);break;case"tuplePattern":r.elements&&r.elements.forEach(n);break;case"pairLit":n(r.fst),n(r.snd);break}}return n(t),Array.from(e)}function u9(t,e,n,r,i){const s=new Set;for(const u of i){const f=e.get(u.id)||[];for(const h of f){const{kind:m,ast:x}=h||{};m==="pattern"&&f5(x).forEach(w=>s.add(w))}}const l=n.get(r);if(l){const u=h5(l);for(const f of u)if(!s.has(f))return!0}const c=(t.arcs||[]).filter(u=>u.sourceId===r&&(u.targetType==="place"||!u.targetType));for(const u of c){const f=e.get(u.id)||[];if(f.length===0)return!0;for(const h of f){const{kind:m,ast:x}=h||{};if(m==="pattern"&&x.type==="var"&&!s.has(x.name))return!0}}return!1}function c9(t){const e=(t.places||[]).map(l=>({id:l.id,label:l.label||"",tokens:Number(Array.isArray(l.valueTokens)?l.valueTokens.length:l.tokens||0),x:Number(l.x||0),y:Number(l.y||0),name:l.name||"",type:"place",valueTokens:Array.isArray(l.valueTokens)?[...l.valueTokens]:void 0})),n=(t.transitions||[]).map(l=>({id:l.id,label:l.label||"",x:Number(l.x||0),y:Number(l.y||0),name:l.name||"",type:"transition",guard:l.guard,action:l.action})),r=new Set(e.map(l=>l.id)),i=new Set(n.map(l=>l.id)),s=(t.arcs||[]).map(l=>{const c=l.sourceId||l.source,u=l.targetId||l.target,f=r.has(c)?"place":i.has(c)?"transition":l.sourceType||"place",h=r.has(u)?"place":i.has(u)?"transition":l.targetType||"transition",m=l.type||`${f}-to-${h}`;return{id:l.id,sourceId:c,targetId:u,source:c,target:u,weight:Number(l.weight||1),sourceType:f,targetType:h,type:m,bindings:Array.isArray(l.bindings)?[...l.bindings]:l.binding?[l.binding]:[]}});return{places:e,transitions:n,arcs:s}}let _r=[],d9=1;const Ra=new Map;let Iy=0,Ah=null;const cl=typeof Worker<"u",sg=typeof SharedArrayBuffer<"u",hn={poolSize:0,idleTimeoutMs:3e5,prewarmOnAlgebraicMode:!0,solverTimeoutMs:1e4};function f9(){try{if(typeof globalThis<"u"){const t=globalThis;t.__Z3_SETTINGS__={...t.__Z3_SETTINGS__||{},...hn}}}catch{}}function Eo(t){return Math.max(0,(Number.isFinite(t)?t:0)|0)}function h9(t={}){typeof t.poolSize=="number"&&(hn.poolSize=Eo(t.poolSize)),typeof t.idleTimeoutMs=="number"&&(hn.idleTimeoutMs=Math.max(1e3,t.idleTimeoutMs|0)),typeof t.prewarmOnAlgebraicMode=="boolean"&&(hn.prewarmOnAlgebraicMode=t.prewarmOnAlgebraicMode),typeof t.solverTimeoutMs=="number"&&(hn.solverTimeoutMs=Math.max(0,t.solverTimeoutMs|0)),p9()}function p5(){if(!cl)throw new Error("Z3 worker pool unavailable in this environment");if(!sg)throw new Error("SharedArrayBuffer not available. COOP/COEP headers may not be set correctly.");const t=new Worker(new URL(""+new URL("z3.worker-1562d2b4.js",import.meta.url).href,self.location),{type:"module"});return t.onerror=e=>{console.error("Z3 worker error:",e)},t.onmessage=({data:e})=>{const{id:n,ok:r,result:i,error:s}=e||{},l=Ra.get(n);l&&(Ra.delete(n),r?l.resolve(i):l.reject(new Error(s)),g5())},t}function p9(){if(f9(),!cl)return;const t=Eo(hn.poolSize);for(;_r.length<t;)_r.push(p5());for(;_r.length>t;){const e=_r.pop();try{e.terminate()}catch{}}}function g9(){if(!cl)throw new Error("Z3 worker pool unavailable in this environment");if(Eo(hn.poolSize)<=0)throw new Error("Z3 worker pool disabled");_r.length===0&&_r.push(p5());const e=_r[Iy%_r.length];return Iy++,e}function g5(){cl&&(hn.idleTimeoutMs<=0||(Ah&&clearTimeout(Ah),Ah=setTimeout(()=>{const t=Eo(hn.poolSize);for(;_r.length>t;){const e=_r.pop();try{e.terminate()}catch{}}},hn.idleTimeoutMs)))}function bo(t,...e){const n=g9(),r=d9++;return new Promise((i,s)=>{const l=setTimeout(()=>{Ra.delete(r),s(new Error(`Z3 worker operation "${t}" timed out after ${hn.solverTimeoutMs}ms`))},hn.solverTimeoutMs||1e4);Ra.set(r,{resolve:c=>{clearTimeout(l),i(c)},reject:c=>{clearTimeout(l),s(c)}});try{n.postMessage({id:r,op:t,args:e})}catch(c){clearTimeout(l),Ra.delete(r),s(c);return}g5()})}function X0(){return Eo(hn.poolSize)}function Y0(){return cl&&sg&&Eo(hn.poolSize)>0}function m9(){return sg}const y9=t=>bo("parseBooleanExpr",t),K0=(t,e,n)=>bo("evaluateBooleanPredicate",t,e),v9=(t,e,n)=>bo("evaluateArithmeticWithBindings",t,e),x9=(t,e)=>bo("evaluateAction",t,e),w9=(t,e)=>bo("solveEquation",t,e),_9=(t,e,n)=>bo("solveInequality",t,e,n),Fa=Object.freeze(Object.defineProperty({__proto__:null,evaluateAction:x9,evaluateArithmeticWithBindings:v9,evaluateBooleanPredicate:K0,getConfiguredPoolSize:X0,isSharedArrayBufferAvailable:m9,isWorkerPoolEnabled:Y0,parseBooleanExpr:y9,setZ3WorkerConfig:h9,solveEquation:w9,solveInequality:_9},Symbol.toStringTag,{value:"Module"})),Ih=async(t,e,n)=>{try{if((typeof Y0=="function"?Y0():!1)&&typeof K0=="function")try{return await K0(t,e,n)}catch{}}catch{}return Ew(t,e,n)},Ly=t=>JSON.parse(JSON.stringify(t||{places:[],transitions:[],arcs:[]})),S9=(t,e)=>{const n=new Set,r=l=>{if(l)switch(l.type){case"boolVar":case"pairVar":n.add(l.name);break;case"and":case"or":r(l.left),r(l.right);break;case"not":r(l.expr);break;case"cmp":i(l.left),i(l.right);break}},i=l=>{l&&(l.type==="var"||l.type==="boolVar"||l.type==="pairVar"?n.add(l.name):l.type==="bin"?(i(l.left),i(l.right)):l.type==="pairLit"&&(i(l.fst),i(l.snd)))};r(t);const s=new Set(Object.keys(e||{}));return Array.from(n).filter(l=>!s.has(l))},Ry=t=>{try{const e=Array.isArray(t==null?void 0:t.transitions)?t.transitions.slice():[],n=Array.isArray(t==null?void 0:t.arcs)?t.arcs.slice():[];e.sort((s,l)=>String(s.id).localeCompare(String(l.id))),n.sort((s,l)=>String(s.id).localeCompare(String(l.id)));const r=e.map(s=>`${s.id}|g:${String(s.guard||"")}|a:${String(s.action||"")}`).join(";"),i=n.map(s=>`${s.id}|b:${Array.isArray(s.bindings)?s.bindings.join(","):s.binding?String(s.binding):""}`).join(";");return`${r}||${i}`}catch{return String(Math.random())}};class k9 extends u5{constructor(){super(),this.lastEnabledTransitions=[],this.cache={guardAstByTransition:new Map,bindingAstsByArc:new Map},this._cacheSignature=null,this._config={maxTokensPerPlace:1/0},this._enabledCache=new Map}getType(){return"algebraic"}async initializeSpecific(e,n={}){this.lastEnabledTransitions=[],this._enabledCache.clear(),this._cacheSignature=null,this.petriNet=Ly(e),n&&typeof n.maxTokensPerPlace=="number"&&n.maxTokensPerPlace>=0?this._config.maxTokensPerPlace=n.maxTokensPerPlace|0:this._config.maxTokensPerPlace=1/0,await this.buildCaches(),await this.checkTransitionStateChanges()}async buildCaches(){this.cache.guardAstByTransition.clear(),this.cache.bindingAstsByArc.clear(),this.cache.guardAstByTransition=o9(this.petriNet,Rt,xo,Tw),this.cache.bindingAstsByArc=l9(this.petriNet,n5,Rt,xo,s9),this._cacheSignature=Ry(this.petriNet)}getStatus(){var e,n,r;return{isInitialized:this.isInitialized,hasPyodide:!1,hasSimulator:!0,hasPetriNet:!!this.petriNet,simulationMode:this.simulationMode,petriNetSize:this.petriNet?{places:((e=this.petriNet.places)==null?void 0:e.length)||0,transitions:((n=this.petriNet.transitions)==null?void 0:n.length)||0,arcs:((r=this.petriNet.arcs)==null?void 0:r.length)||0}:null}}async setSimulationMode(e){if(e==="single"||e==="maximal")this.simulationMode=e;else throw new Error("Mode must be 'single' or 'maximal'")}_outputBindingsTypeCompatible(e,n){return r9(this.petriNet,this.cache,e,n)}_invalidateEnabledCache(e){if(!e||e.size===0)return;const n=this.petriNet.arcs||[];for(const r of n){const i=r.sourceId||r.source;if((r.type==="place-to-transition"||r.sourceType==="place")&&e.has(i)){const l=String(r.targetId||r.target);this._enabledCache.delete(l)}}}_clearEnabledCache(){this._enabledCache.clear()}async updateSpecific(e){const r=Ry(e)!==this._cacheSignature;this.petriNet=Ly(e),r&&await this.buildCaches(),this._clearEnabledCache(),await this.checkTransitionStateChanges()}async getEnabledTransitionsSpecific(){const e=Array.isArray(this.petriNet.transitions)?this.petriNet.transitions:[];if(e.length===0)return[];const n=[];for(let i=0;i<e.length;i++){const s=String(e[i].id);this._enabledCache.has(s)||n.push(e[i])}if(n.length>0){const i=typeof X0=="function"?Number(X0()||0):0,s=Math.max(1,Math.min(n.length,i>0?i:1));if(s<=1)for(const l of n)try{const c=await this.isTransitionEnabled(l.id);this._enabledCache.set(String(l.id),c)}catch{this._enabledCache.set(String(l.id),!1)}else{const l=new Array(n.length).fill(!1);let c=0;const u=async()=>{for(;;){const h=c++;if(h>=n.length)break;const m=n[h];try{const x=await this.isTransitionEnabled(m.id);l[h]=x}catch{}}},f=Array.from({length:s},()=>u());await Promise.all(f);for(let h=0;h<n.length;h++)this._enabledCache.set(String(n[h].id),l[h])}}const r=[];for(const i of e){const s=String(i.id);this._enabledCache.get(s)===!0&&r.push(s)}return r}async checkForUnboundVariables(e,n){return u9(this.petriNet,this.cache.bindingAstsByArc,this.cache.guardAstByTransition,e,n)}extractVariablesFromPattern(e){return f5(e)}extractVariablesFromExpression(e){return h5(e)}async isTransitionEnabled(e){if(!this.isInitialized)return!1;const n=(this.petriNet.transitions||[]).find(u=>u.id===e);if(!n)return!1;const r=(this.petriNet.arcs||[]).filter(u=>(u.targetId===e||u.target===e)&&(u.sourceType==="place"||!u.sourceType));if(r.length===0)return!0;if(await this.checkForUnboundVariables(e,r))return he.debug("Transition disabled due to unbound variables:",e),!1;const s=this.cache.guardAstByTransition.get(e),l=Object.fromEntries((this.petriNet.places||[]).map(u=>[u.id,u])),c=await Ay({transition:n,inputArcs:r,placesById:l,bindingAstsByArc:this.cache.bindingAstsByArc,guardAst:s,parseArithmetic:Rt,evaluateBooleanPredicate:Ih,matchPattern:Ty,getTokensForPlace:Ey,evaluateArithmeticWithBindings:tr,evaluateBooleanWithBindings:uo,evaluatePatternLiteral:vr,maxTokensPerPlace:this._config.maxTokensPerPlace});return c?this._outputBindingsTypeCompatible(e,c.env||{}):!1}async stepSimulationSpecific(){return this.getCurrentState()}async fireTransitionSpecific(e,n={}){const r=n.skipEnabledCheck||!1,i=r?[]:await this.getEnabledTransitionsSpecific(),s=(this.petriNet.transitions||[]).find(w=>w.id===e);if(!s)return this.getCurrentState();const l=(this.petriNet.arcs||[]).filter(w=>(w.targetId===e||w.target===e)&&(w.sourceType==="place"||!w.sourceType)),c=(this.petriNet.arcs||[]).filter(w=>(w.sourceId===e||w.source===e)&&(w.targetType==="place"||!w.targetType)),u=Object.fromEntries((this.petriNet.places||[]).map(w=>[w.id,w])),f=this.cache.guardAstByTransition.get(e),h=await Ay({transition:s,inputArcs:l,placesById:u,bindingAstsByArc:this.cache.bindingAstsByArc,guardAst:f,parseArithmetic:Rt,evaluateBooleanPredicate:Ih,matchPattern:Ty,getTokensForPlace:Ey,evaluateArithmeticWithBindings:tr,evaluateBooleanWithBindings:uo,evaluatePatternLiteral:vr,maxTokensPerPlace:this._config.maxTokensPerPlace});if(!h)throw new Error(`Transition ${e} is not enabled`);let m=h.env||{};const x=h.picks||[];if(f&&S9(f,m).length>0)try{if(!await Ih(f,m,Rt))throw new Error("Guard unsatisfied under any extension")}catch{}const y=new Set;for(const w of x)y.add(w.srcId);for(const w of c)y.add(w.targetId||w.target);if(d5(x,u),e9(c,this.cache.bindingAstsByArc,m,u,{evaluateArithmeticWithBindings:tr,evaluateBooleanWithBindings:uo,evaluatePatternLiteral:vr,parseArithmetic:Rt}),s.action&&typeof s.action=="string")try{const w=Pw(s.action,m,Rt)}catch{}if(this._invalidateEnabledCache(y),!r){await this.checkTransitionStateChanges();const w=this.getCurrentState();this.emitTransitionFired({transitionId:e,newPetriNet:w});const E=await this.getEnabledTransitionsSpecific();return this.emitTransitionsChanged({enabled:E,previouslyEnabled:i}),w}return this.getCurrentState()}getCurrentState(){return c9(this.petriNet)}async checkTransitionStateChanges(){if(this.isInitialized)try{const e=await this.getEnabledTransitionsSpecific();if(JSON.stringify([...e].sort())!==JSON.stringify([...this.lastEnabledTransitions].sort())){const r=[...this.lastEnabledTransitions];this.lastEnabledTransitions=[...e],this.emitTransitionsChanged({enabled:e,previouslyEnabled:r})}}catch{}}resetSpecific(){this.lastEnabledTransitions=[],this.cache.guardAstByTransition.clear(),this.cache.bindingAstsByArc.clear(),this._cacheSignature=null,this._config.maxTokensPerPlace=1/0,this._clearEnabledCache()}}class C9{static createSimulator(e){switch(e){case"pt":return new n9;case"algebraic":return new k9;default:throw new Error(`Unknown net mode: ${e}`)}}static getAvailableTypes(){return["pt","algebraic"]}static isSupported(e){return this.getAvailableTypes().includes(e)}}const Fy=async()=>{try{await new Promise(t=>setTimeout(t,0))}catch{}try{typeof requestAnimationFrame<"u"&&await new Promise(t=>requestAnimationFrame(()=>t()))}catch{}},T9=t=>{const e=new Set;if(!t||!Array.isArray(t.transitions))return e;const n=Array.isArray(t.arcs)?t.arcs:[],r=Array.isArray(t.places)?t.places:[],i=new Set(r.map(s=>String(s.id)));for(const s of t.transitions){const l=String(s.id);let c=!1,u=!1;for(const f of n){const h=String(f.sourceId||f.source),m=String(f.targetId||f.target);if(m===l&&h!==l&&i.has(h)&&(c=!0),h===l&&m!==l&&i.has(m)&&(u=!0),c&&u)break}!c&&!u&&e.add(l)}return e},E9=(t,e,n)=>{const r=new Map;for(const c of t)r.set(c,new Set);for(const c of e||[]){const u=c.targetId||c.target,f=c.sourceId||c.source;(c.type==="place-to-transition"||c.sourceType==="place")&&r.has(u)&&r.get(u).add(f)}const i=t.slice();for(let c=i.length-1;c>0;c--){const u=Math.random()*(c+1)|0,f=i[c];i[c]=i[u],i[u]=f}const s=new Set,l=[];for(const c of i){const u=r.get(c)||new Set;let f=!0;for(const h of u)if(s.has(h)){f=!1;break}if(f){l.push(c);for(const h of u)s.add(h);if(n>0&&l.length>=n)break}}return l},b9=(t=[])=>t.map(e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){if(e.id)return e.id;if(e.get)return e.get("id")}return String(e)}).filter(Boolean),P9=async({simulator:t,mode:e="single",maxSteps:n=1e5,timeBudgetMs:r=3e4,yieldEvery:i=100,onProgress:s,shouldCancel:l,batchMax:c=0,progressEveryMs:u=0,yieldEveryMs:f=0})=>{const h=typeof performance<"u"&&performance.now?()=>performance.now():()=>Date.now(),m=h();let x=0,y=m,w=m,E=-1;const _=T=>{if(!s)return;const N=T-m,L=u>0?Math.floor(N/u):0;if(L!==E){E=L;try{s({steps:x,elapsedMs:N})}catch{}}},S=T9(t.petriNet||{}),C=async()=>{const T=await t.getEnabledTransitions();return b9(T).filter(L=>!S.has(String(L)))},g=async()=>{if(l&&l())return!1;const T=h(),N=T-m;if(i>0&&x%i===0){const L=h();_(L),await Fy();const A=h();return w=A,y=A,u>0&&_(A),!(r>0&&A-m>r||l&&l())}if(u>0&&T-y>=u&&(_(T),y=T),f>0&&T-w>=f){await Fy();const L=h();if(w=L,u>0&&L-y>=u&&(_(L),y=L),r>0&&L-m>r||l&&l())return!1}return!(r>0&&N>r||l&&l())};let k=!0;for(;k&&x<n&&!(l&&l());){const T=await C();if(!T||T.length===0)break;if(e==="maximal"){const N=t.petriNet||{},L=c>0?c:Number.POSITIVE_INFINITY;let A=E9(T,N.arcs||[],L);if(!A||A.length===0){const R=T[Math.floor(Math.random()*T.length)];A=R?[R]:[]}if(l&&l()){k=!1;break}await Promise.all(A.map(R=>t.fireTransition(R,{skipEnabledCheck:!0}))),x+=A.length,k=await g()}else{const N=T[Math.floor(Math.random()*T.length)];await t.fireTransition(N),x+=1,k=await g()}}if(s)try{s({steps:x,elapsedMs:h()-m})}catch{}return{petriNet:t.petriNet||null,steps:x}},jy=(t,e={})=>{he.debug("determineNetMode called with:",{petriNet:t,options:e});const n=(e==null?void 0:e.netMode)||(t==null?void 0:t.netMode);if(he.debug("Found netMode from options/petriNet:",n),n){const r=n==="algebraic-int"?"algebraic":n;return he.debug("Using configured netMode:",r),r}return he.debug("No configured netMode, detecting from content"),m5(t)},m5=t=>{const e=t||{},n=Array.isArray(e.transitions)?e.transitions:[],r=Array.isArray(e.arcs)?e.arcs:[],i=Array.isArray(e.places)?e.places:[];he.debug("Net mode detection:",{places:i,transitions:n,arcs:r});for(const s of n){if(typeof s.guard=="string"&&s.guard.trim().length>0)return he.debug("Found guard, using algebraic mode"),"algebraic";if(typeof s.action=="string"&&s.action.trim().length>0)return he.debug("Found action, using algebraic mode"),"algebraic"}for(const s of r){const l=Array.isArray(s.bindings)?s.bindings:s.binding?[s.binding]:[];if(he.debug("Checking arc bindings:",l),l.some(u=>typeof u=="string"&&(/:[ ]*(integer|boolean)/i.test(u)||u==="T"||u==="F"||/[+\-*/()]/.test(u))))return he.debug("Found algebraic binding, using algebraic mode"),"algebraic"}return i.some(s=>Array.isArray(s.valueTokens)&&s.valueTokens.length>0)?(he.debug("Found valueTokens, using algebraic mode"),"algebraic"):(he.debug("Using P/T mode"),"pt")};class N9{constructor(){this.currentSimulator=null,this._ready=!1,this.netMode=null,this.eventBus=null,this.pendingListeners=new Map}async initialize(e,n={}){try{he.debug("SimulatorCore.initialize called with:",{petriNet:e,options:n});const r=jy(e,n);return this.currentSimulator=C9.createSimulator(r),this.netMode=r,this.eventBus&&this.currentSimulator.setEventBus(this.eventBus),await this.currentSimulator.initialize(e,n),this._ready=!0,this.setupPendingListeners(),he.debug(`Simulator initialized with ${r} simulator`),{success:!0,netMode:r,simulatorType:this.currentSimulator.getType()}}catch(r){throw console.error("Failed to initialize simulator:",r),this._ready=!1,this.currentSimulator=null,r}}async update(e){if(!this.currentSimulator)return{success:!0};try{return await this.currentSimulator.update(e),{success:!0}}catch(n){throw console.error("Failed to update simulator:",n),n}}async getEnabledTransitions(){if(!this.currentSimulator)return[];try{return await this.currentSimulator.getEnabledTransitions()}catch(e){return console.error("Failed to get enabled transitions:",e),[]}}async fireTransition(e){if(!this.currentSimulator)throw new Error("Simulator not initialized");try{return await this.currentSimulator.fireTransition(e)}catch(n){throw console.error(`Failed to fire transition ${e}:`,n),n}}async stepSimulation(){if(!this.currentSimulator)throw new Error("Simulator not initialized");try{const e=await this.currentSimulator.getEnabledTransitions();if(!e||e.length===0)return this.currentSimulator.petriNet||null;const n=e[Math.floor(Math.random()*e.length)],r=typeof n=="string"?n:n&&n.id?n.id:String(n);return await this.currentSimulator.fireTransition(r)}catch(e){throw console.error("Failed to step simulation:",e),e}}async runToCompletion({mode:e="single",maxSteps:n=1e5,timeBudgetMs:r=3e4,yieldEvery:i=100,onProgress:s,shouldCancel:l,batchMax:c=0,progressEveryMs:u=0,yieldEveryMs:f=0}={}){if(!this.currentSimulator)throw new Error("Simulator not initialized");const h=this.currentSimulator.eventBus||null;try{this.currentSimulator.setEventBus&&this.currentSimulator.setEventBus(null)}catch{}try{return this.currentSimulator.setSimulationMode&&(this.currentSimulator.simulationMode=e),await P9({simulator:this.currentSimulator,mode:e,maxSteps:n,timeBudgetMs:r,yieldEvery:i,onProgress:s,shouldCancel:l,batchMax:c,progressEveryMs:u,yieldEveryMs:f})}finally{try{this.currentSimulator.setEventBus&&this.currentSimulator.setEventBus(h)}catch{}}}reset(){this.currentSimulator&&this.currentSimulator.reset(),this.currentSimulator=null,this._ready=!1,this.netMode=null,this.pendingListeners.clear()}deactivateSimulation(){this._active=!1}activateSimulation(e=!1){if(!this.currentSimulator)throw new Error("Simulator not initialized");he.debug(`Simulation activated (continuous: ${e})`)}async isReady(){return this._ready&&this.currentSimulator&&this.currentSimulator.isReady()}getSimulatorStatus(){var e;return{isReady:this._ready,netMode:this.netMode,simulatorType:((e=this.currentSimulator)==null?void 0:e.getType())||"none",simulatorStatus:{simulator:this.currentSimulator}}}getSimulatorType(){var e;return((e=this.currentSimulator)==null?void 0:e.getType())||"none"}getSimulationMode(){var e;return((e=this.currentSimulator)==null?void 0:e.simulationMode)||"single"}setSimulationMode(e){this.currentSimulator&&(this.currentSimulator.simulationMode=e)}setEventBus(e){this.eventBus=e,this.currentSimulator&&this.currentSimulator.setEventBus(e)}__queueListener(e,n){this.pendingListeners.has(e)||this.pendingListeners.set(e,[]),this.pendingListeners.get(e).push(n)}setupPendingListeners(){if(!(!this.currentSimulator||!this.eventBus)){for(const[e,n]of this.pendingListeners)for(const r of n)this.eventBus.on(e,r);this.pendingListeners.clear()}}determineNetMode(e,n){return jy(e,n)}detectNetModeFromContent(e){return m5(e)}}const hi=new N9;function M9(){try{return typeof window>"u"||typeof Worker>"u"||typeof process<"u"&&process.env&&{}.JEST_WORKER_ID?null:new Worker(new URL(""+new URL("simulation.worker-04867299.js",import.meta.url).href,self.location),{type:"module"})}catch(t){return console.error("Failed to create simulation worker:",t),null}}var A9="Expected a function",Oy=0/0,I9="[object Symbol]",L9=/^\s+|\s+$/g,R9=/^[-+]0x[0-9a-f]+$/i,F9=/^0b[01]+$/i,j9=/^0o[0-7]+$/i,O9=parseInt,D9=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,z9=typeof self=="object"&&self&&self.Object===Object&&self,B9=D9||z9||Function("return this")(),U9=Object.prototype,G9=U9.toString,V9=Math.max,W9=Math.min,Lh=function(){return B9.Date.now()};function $9(t,e,n){var r,i,s,l,c,u,f=0,h=!1,m=!1,x=!0;if(typeof t!="function")throw new TypeError(A9);e=Dy(e)||0,Q0(n)&&(h=!!n.leading,m="maxWait"in n,s=m?V9(Dy(n.maxWait)||0,e):s,x="trailing"in n?!!n.trailing:x);function y(N){var L=r,A=i;return r=i=void 0,f=N,l=t.apply(A,L),l}function w(N){return f=N,c=setTimeout(S,e),h?y(N):l}function E(N){var L=N-u,A=N-f,R=e-L;return m?W9(R,s-A):R}function _(N){var L=N-u,A=N-f;return u===void 0||L>=e||L<0||m&&A>=s}function S(){var N=Lh();if(_(N))return C(N);c=setTimeout(S,E(N))}function C(N){return c=void 0,x&&r?y(N):(r=i=void 0,l)}function g(){c!==void 0&&clearTimeout(c),f=0,r=u=i=c=void 0}function k(){return c===void 0?l:C(Lh())}function T(){var N=Lh(),L=_(N);if(r=arguments,i=this,u=N,L){if(c===void 0)return w(u);if(m)return c=setTimeout(S,e),y(u)}return c===void 0&&(c=setTimeout(S,e)),l}return T.cancel=g,T.flush=k,T}function Q0(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function H9(t){return!!t&&typeof t=="object"}function X9(t){return typeof t=="symbol"||H9(t)&&G9.call(t)==I9}function Dy(t){if(typeof t=="number")return t;if(X9(t))return Oy;if(Q0(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Q0(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(L9,"");var n=F9.test(t);return n||j9.test(t)?O9(t.slice(2),n?2:8):R9.test(t)?Oy:+t}var Y9=$9;const K9=il(Y9),Q9=({elements:t,netMode:e,simulatorCore:n,setElements:r,updateHistory:i,setEnabledTransitionIds:s,setIsSimulatorReady:l,setSimulationError:c,latestElementsRef:u,forceResetCounter:f})=>{z.useEffect(()=>{u.current=t},[t,u]),z.useEffect(()=>{try{n.setEventBus(ca)}catch{}},[n]),z.useEffect(()=>{(async()=>{var w,E;if(!(t&&t.places&&t.transitions&&t.arcs&&t.places.length>0&&t.transitions.length>0&&t.arcs.length>0)){try{await((w=n.deactivateSimulation)==null?void 0:w.call(n)),await((E=n.reset)==null?void 0:E.call(n)),s([]),l(!1),c(null)}catch(_){he.error("Failed to reset simulator:",_)}return}try{he.debug("Simulator force reset counter:",f),he.debug("Initializing/updating simulator",{elements:t,netMode:e}),await n.initialize(t,{netMode:e})}catch(_){he.error("Failed to initialize simulator:",_),s([]),l(!1);return}try{await n.update(u.current)}catch(_){he.error("Failed to update simulator:",_),s([]),l(!1),c("Failed to update simulator");return}try{if(n.isReady&&await n.isReady()){const _=await n.getEnabledTransitions();s(_||[]),l(_&&_.length>0)}else{const _=Jw(u.current),S=(_==null?void 0:_.enabledTransitions)||[];s(S),l(S.length>0)}c(_=>_==="Failed to update simulator"?null:_)}catch(_){he.error("Failed to compute enabled transitions:",_),s([]),l(!1),c("Failed to update simulator")}})()},[t,e,n,f,s,l,c,u]),z.useEffect(()=>{const x=w=>{s(w.enabled||[]),l(w.hasEnabled);try{typeof window<"u"&&(window.__ENABLED_TRANSITIONS__=Array.isArray(w.enabled)?w.enabled:[])}catch{}},y=w=>{try{typeof window<"u"&&(window.__LAST_FIRED_TRANSITION_ID__=w.transitionId||null)}catch{}w.newPetriNet&&(r(w.newPetriNet),u.current=w.newPetriNet,i&&i(w.newPetriNet,!0))};return ca.on(no.transitionsChanged,x),ca.on(no.transitionFired,y),()=>{ca.off(no.transitionsChanged,x),ca.off(no.transitionFired,y)}},[r,i,s,l,u]),z.useEffect(()=>()=>{try{n.deactivateSimulation()}catch{}},[n]);const h=z.useCallback(async()=>{try{if(n.isReady&&await n.isReady()){const x=await n.getEnabledTransitions();s(x||[]);const y=Array.isArray(x)&&x.length>0;return l(y),x||[]}return s([]),l(!1),[]}catch(x){return console.error("Error refreshing enabled transitions:",x),c("Failed to refresh enabled transitions"),[]}},[n,s,l,c]),m=z.useMemo(()=>K9(h,100),[h]);return z.useEffect(()=>()=>{m.cancel()},[m]),{refreshEnabledTransitions:h,debouncedRefresh:m}};class Z9{constructor(){this.conflictCache=new Map}areTransitionsInConflict(e,n,r,i){const s=`${e}-${n}`,l=`${n}-${e}`;if(this.conflictCache.has(s))return this.conflictCache.get(s);if(this.conflictCache.has(l))return this.conflictCache.get(l);const c=this._requiredCategories(e,i),u=this._requiredCategories(n,i);let f=!1;for(const[h,m]of c.entries()){const x=u.get(h);if(x&&(m.has("int")&&x.has("int")||m.has("bool")&&x.has("bool"))){f=!0;break}}return this.conflictCache.set(s,f),f}_requiredCategories(e,n){const r=new Map;for(const i of n){const s=i.sourceId||i.source;if(!((i.targetId||i.target)===e&&(i.sourceType==="place"||i.type==="place-to-transition")))continue;const c=Array.isArray(i.bindings)?i.bindings:i.binding?[i.binding]:[];r.has(s)||r.set(s,new Set);const u=r.get(s);for(const f of c){const h=String(f||"");/:[ ]*boolean/i.test(h)||h==="T"||h==="F"?u.add("bool"):u.add("int")}c.length===0&&u.add("int")}return r}findNonConflictingTransitions(e,n,r){if(e.length<=1)return e;this.conflictCache.clear();const i=[];for(let s=e.length;s>=1;s--){const l=this.getCombinations(e,s);for(const c of l)this.isNonConflictingSet(c,n,r)&&i.push(c);if(i.length>0)return i}return e.map(s=>[s])}isNonConflictingSet(e,n,r){for(let i=0;i<e.length;i++)for(let s=i+1;s<e.length;s++)if(this.areTransitionsInConflict(e[i].id,e[s].id,n,r))return!1;return!0}getCombinations(e,n){if(n===0)return[[]];if(n>e.length)return[];const r=[],i=(s,l)=>{if(l.length===n){r.push([...l]);return}for(let c=s;c<e.length;c++)l.push(e[c]),i(c+1,l),l.pop()};return i(0,[]),r}getInputPlaces(e,n,r){const i=[];for(const s of r){const l=s.sourceId||s.source,c=s.targetId||s.target;if(s.sourceType==="place"&&c===e||s.type==="place-to-transition"&&c===e){const f=n.find(h=>h.id===l);f&&i.push(f)}}return i}getOutputPlaces(e,n,r){const i=[];for(const s of r){const l=s.sourceId||s.source,c=s.targetId||s.target;if(s.targetType==="place"&&l===e||s.type==="transition-to-place"&&l===e){const f=n.find(h=>h.id===c);f&&i.push(f)}}return i}clearCache(){this.conflictCache.clear()}getCacheStats(){return{size:this.conflictCache.size,keys:Array.from(this.conflictCache.keys())}}}const q9=1e3,kc=t=>(t||[]).map(e=>typeof e=="string"?e:e&&typeof e=="object"?e.id??(e.get?e.get("id"):void 0):String(e)).filter(Boolean),y5=t=>(t.current||(t.current=new Z9),t.current),J9=({simulatorCore:t,setElements:e,updateHistory:n,clearError:r,refreshEnabledTransitions:i,setSimulationError:s,latestElementsRef:l})=>async c=>{try{if(t.getSimulatorType&&t.getSimulatorType()==="none")throw new Error("Simulator not initialized. Please wait for initialization to complete.");await t.activateSimulation(!1);const u=await t.fireTransition(c);if(!u||typeof u!="object")throw new Error("Invalid Petri net returned from simulator");if(!u.places||!Array.isArray(u.places)||!u.transitions||!Array.isArray(u.transitions)||!u.arcs||!Array.isArray(u.arcs))throw new Error("Incomplete Petri net structure returned from simulator");const f=JSON.parse(JSON.stringify(u));e(f),l.current=f,n&&n(f,!0),r(),await i(),setTimeout(()=>{try{t.activateSimulation()}catch{}},50)}catch(u){console.error(`Error firing transition ${c}:`,u),s(u.message||`Failed to fire transition ${c}.`)}},e7=({simulatorCore:t,handleFireTransition:e,conflictResolverRef:n,latestElementsRef:r,refreshEnabledTransitions:i,setSimulationError:s,stopAllSimulations:l})=>async()=>{var c,u;try{if(t.getSimulatorType&&t.getSimulatorType()==="none")throw new Error("Simulator not initialized. Please wait for initialization to complete.");let f="single";try{f=t.getSimulationMode?t.getSimulationMode():"single"}catch{}if(f==="maximal"){const y=await t.getEnabledTransitions();if(!y||y.length===0)return;const w=y5(n),E=kc(y).map(k=>({id:k})),_=w.findNonConflictingTransitions(E,((c=r.current)==null?void 0:c.places)||[],((u=r.current)==null?void 0:u.arcs)||[]),S=Array.isArray(_)?_:Array.from(_||[]),C=S.length?S[Math.floor(Math.random()*S.length)]:[],g=Array.isArray(C)?C:C?[C]:[];for(const k of g)await e(k.id);await i();return}const h=await t.getEnabledTransitions();if(!h||h.length===0)return;const m=kc(h),x=m[Math.floor(Math.random()*m.length)];await e(x)}catch(f){console.error("Error in step simulation:",f),s("Error during simulation step: "+(f.message||"Unknown error")),l()}},t7=t=>new Promise(e=>setTimeout(e,t)),n7=({simulatorCore:t,isContinuousSimulatingRef:e,isRunningRef:n,setIsContinuousSimulating:r,setEnabledTransitionIds:i,stepSimulation:s,refreshEnabledTransitions:l,setSimulationError:c})=>async()=>{if(!(e.current||n.current))try{await t.activateSimulation();const u=await t.getEnabledTransitions();if(!u||u.length===0)return;r(!0),e.current=!0;const f=kc(u);for(i(f);e.current;){await s();const h=await l();if(!h||h.length===0)break;await t7(q9)}}catch(u){console.error("Error starting continuous simulation:",u),c("Failed to start continuous simulation")}finally{e.current=!1,r(!1);try{t.deactivateSimulation()}catch{}}},r7=(t,e)=>{const n=Number(t);return!Number.isFinite(n)||n<=0?null:Math.max(1,Math.min(e,Math.floor(n)))},i7=()=>{try{const t=window.__Z3_SETTINGS__||{};return{poolSize:Number.isFinite(Number(t.poolSize))?Number(t.poolSize):0,idleTimeoutMs:t.idleTimeoutMs,prewarmOnAlgebraicMode:t.prewarmOnAlgebraicMode,solverTimeoutMs:t.solverTimeoutMs}}catch{return{poolSize:0}}},s7=({simulationSettings:t})=>{let e=!1;try{e=!!window.__PETRI_NET_NON_VISUAL_RUN__}catch{}const n=typeof window<"u"&&window.__PETRI_NET_SETTINGS__?window.__PETRI_NET_SETTINGS__:{};!e&&(t!=null&&t.useNonVisualRun)&&(e=!0);const r=t==null?void 0:t.batchMode,i=r!==void 0?!!r:!!(n!=null&&n.batchMode);i&&(e=!0);const s=!!((t==null?void 0:t.limitIterations)??(n==null?void 0:n.limitIterations)),l=r7((t==null?void 0:t.maxIterations)??(n==null?void 0:n.maxIterations),1e6);return{useNonVisual:e,batchMode:i,limitIterationsFlag:s,maxIterations:l}},o7=({simulatorCore:t,isContinuousSimulatingRef:e,isRunningRef:n,setIsRunning:r,setIsContinuousSimulating:i,refreshEnabledTransitions:s,simulationSettings:l,ensureWorker:c,setElements:u,latestElementsRef:f,updateHistory:h,setSimulationError:m,conflictResolverRef:x,elements:y,handleFireTransition:w,setCompletionStats:E,netMode:_})=>async()=>{if(!(e.current||n.current))try{await t.activateSimulation(!1),r(!0),i(!1),n.current=!0,await s();const{useNonVisual:S,batchMode:C,limitIterationsFlag:g,maxIterations:k}=s7({simulationSettings:l}),T=2e5,N=g?k??T:T;let L=null,A=!1;const R=async D=>{try{if(L||(L=i7()),Number(L.poolSize||0)>=D)return;(await zr(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url)).setZ3WorkerConfig({...L,poolSize:D}),A=!0}catch{}},M=async()=>{if(A){try{(await zr(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url)).setZ3WorkerConfig(L||{})}catch{}A=!1}};let I=!1;if(C){if(!(await zr(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url)).isSharedArrayBufferAvailable()){const X="SharedArrayBuffer not available. This is required for batch mode. Please ensure COOP/COEP headers are set correctly (service worker should handle this). Try refreshing the page.";console.error(X),m(X),n.current=!1,r(!1);return}await R(8);const $=await c();if($)try{let X="single";try{X=t.getSimulationMode?t.getSimulationMode():"single"}catch{}const F=setTimeout(()=>{$.removeEventListener("message",U),$.removeEventListener("error",G);const K="Simulation worker timed out after 5 minutes. This may indicate that Z3 workers are not responding. Check browser console for errors.";console.error(K),m(K),M(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}},5*60*1e3),U=async K=>{const{op:Q,payload:Z}=K.data||{};if(Q==="done"){clearTimeout(F),$.removeEventListener("message",U),$.removeEventListener("error",G),Z&&Z.elements&&typeof Z.elements=="object"&&(u(Z.elements),f.current=Z.elements,h&&h(Z.elements,!0)),await M(),await s(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}Z!=null&&Z.stats&&E({elapsedMs:Z.stats.elapsedMs,transitionsFired:Z.stats.steps?Z.stats.steps.toLocaleString():"0"})}else Q==="error"&&(clearTimeout(F),$.removeEventListener("message",U),$.removeEventListener("error",G),m((Z==null?void 0:Z.message)||"Worker error"),await M(),n.current=!1,r(!1))},G=K=>{clearTimeout(F),$.removeEventListener("message",U),$.removeEventListener("error",G);const Q=`Worker error: ${K.message||"Unknown error"}. This may indicate that Z3 workers failed to initialize.`;console.error(Q,K),m(Q),M(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}};$.addEventListener("message",U),$.addEventListener("error",G),$.postMessage({op:"start",payload:{elements:f.current,simOptions:{netMode:_},run:{mode:X,batchMax:0,maxSteps:N,timeBudgetMs:0,yieldEvery:5e3,progressEveryMs:0,yieldEveryMs:0},z3:typeof window<"u"?window.__Z3_SETTINGS__||{}:{}}}),I=!0}catch(X){console.error("Worker run failed, falling back to in-thread run:",X),m(`Worker initialization failed: ${X.message}. Falling back to in-thread execution.`),await M()}else{const X="Failed to create simulation worker. SharedArrayBuffer may not be available.";console.error(X),m(X),n.current=!1,r(!1);return}}if(I)return;if(S&&typeof t.runToCompletion=="function"){let D="single";try{D=t.getSimulationMode?t.getSimulationMode():"single"}catch{}const $=()=>{try{return!!window.__PETRI_NET_CANCEL_RUN__}catch{return!1}},X=performance.now?performance.now():Date.now();try{const F=await t.runToCompletion({mode:D,maxSteps:N,timeBudgetMs:0,yieldEvery:5e3,progressEveryMs:0,yieldEveryMs:0,onProgress:()=>{},shouldCancel:$,batchMax:0}),U=performance.now?performance.now():Date.now(),G=Math.round(U-X);F&&F.petriNet&&typeof F.petriNet=="object"&&(u(F.petriNet),f.current=F.petriNet,h&&h(F.petriNet,!0)),E({elapsedMs:G,transitionsFired:F!=null&&F.steps?F.steps.toLocaleString():"0"})}finally{await M(),await s(),n.current=!1,r(!1);try{t.deactivateSimulation()}catch{}}return}let O=N;const W=y5(x),B=async()=>{if(!n.current){r(!1);return}if(O<=0){n.current=!1,r(!1);return}try{const D=await t.getEnabledTransitions();if(!D||D.length===0){n.current=!1,r(!1);return}const $=kc(D).map(K=>({id:K})),X=W.findNonConflictingTransitions($,y.places||[],y.arcs||[]),F=Array.isArray(X)?X:Array.from(X||[]),U=F.length?F[Math.floor(Math.random()*F.length)]:[],G=Array.isArray(U)?U:U?[U]:[];for(const K of G){if(O<=0)break;await w(K.id),O-=1}if(O<=0){n.current=!1,r(!1);return}setTimeout(B,50)}catch(D){console.error("Error in run simulation:",D),m(D.message||"Error during simulation run"),n.current=!1,r(!1)}};B()}catch(S){console.error("Error starting run simulation:",S),m("Failed to start run simulation")}},a7=(t,e,n,r,i={},s)=>{const[l,c]=z.useState(!1),[u,f]=z.useState(!1),[h,m]=z.useState([]),[x,y]=z.useState(null),[w,E]=z.useState(!1),[_,S]=z.useState(0),[C,g]=z.useState(null),k=z.useRef(!1),T=z.useRef(!1),N=z.useRef(t),L=z.useRef(null),A=z.useRef(null),R=s||hi,M=z.useCallback(async()=>{if(A.current)return A.current;try{const K=M9();return A.current=K,K}catch(K){return console.error("Failed to create simulation worker:",K),null}},[]),{refreshEnabledTransitions:I,debouncedRefresh:O}=Q9({elements:t,netMode:r,simulatorCore:R,setElements:e,updateHistory:n,setEnabledTransitionIds:m,setIsSimulatorReady:E,setSimulationError:y,latestElementsRef:N,forceResetCounter:_});z.useEffect(()=>{N.current=t},[t]);const W=z.useCallback(()=>{y(null)},[]),B=z.useCallback(()=>{he.debug("Forcing simulator reset"),S(K=>K+1)},[]),D=z.useCallback(()=>{var K,Q;c(!1),f(!1),k.current=!1,T.current=!1;try{R.deactivateSimulation()}catch{}W(),m([]);try{(Q=(K=A.current)==null?void 0:K.postMessage)==null||Q.call(K,{op:"cancel"})}catch{}},[W,R]);z.useEffect(()=>{l||u?(R.activateSimulation(),I()):(R.deactivateSimulation(),I())},[l,u,I]),z.useEffect(()=>((u||l)&&O(),()=>O.cancel()),[u,l,O]);const $=z.useMemo(()=>J9({simulatorCore:R,setElements:e,updateHistory:n,clearError:W,refreshEnabledTransitions:I,setSimulationError:y,latestElementsRef:N}),[R,e,n,W,I,y]),X=z.useMemo(()=>e7({simulatorCore:R,handleFireTransition:$,conflictResolverRef:L,latestElementsRef:N,refreshEnabledTransitions:I,setSimulationError:y,stopAllSimulations:D}),[R,$,L,I,y,D]),F=z.useMemo(()=>n7({simulatorCore:R,isContinuousSimulatingRef:k,isRunningRef:T,setIsContinuousSimulating:c,setEnabledTransitionIds:m,stepSimulation:X,refreshEnabledTransitions:I,setSimulationError:y}),[R,k,T,c,m,X,I,y]),U=z.useMemo(()=>o7({simulatorCore:R,isContinuousSimulatingRef:k,isRunningRef:T,setIsRunning:f,setIsContinuousSimulating:c,refreshEnabledTransitions:I,simulationSettings:i,ensureWorker:M,setElements:e,latestElementsRef:N,updateHistory:n,setSimulationError:y,conflictResolverRef:L,elements:t,handleFireTransition:$,setCompletionStats:g,netMode:r}),[R,k,T,f,c,I,i==null?void 0:i.limitIterations,i==null?void 0:i.maxIterations,i==null?void 0:i.batchMode,i==null?void 0:i.useNonVisualRun,M,e,N,n,y,L,t,$,g,r]),G=z.useCallback(()=>{g(null)},[]);return{isContinuousSimulating:l,isRunning:u,enabledTransitionIds:h,simulationError:x,isSimulatorReady:w,handleFireTransition:$,stepSimulation:X,startContinuousSimulation:F,startRunSimulation:U,stopAllSimulations:D,clearError:W,forceSimulatorReset:B,completionStats:C,dismissCompletionDialog:G}};function l7(t){if(!t||typeof t!="object")return"pt";const e=Array.isArray(t.places)?t.places:[],n=Array.isArray(t.transitions)?t.transitions:[],r=Array.isArray(t.arcs)?t.arcs:[];return e.some(s=>Array.isArray(s.valueTokens)&&s.valueTokens.length>0||!!s.type)||n.some(s=>!!s.guard||!!s.action)||r.some(s=>Array.isArray(s.bindings)&&s.bindings.length>0||!!s.binding)?"algebraic-int":"pt"}function u7(t){const{elements:e,setElements:n,updateHistory:r,simulationSettings:i,setSimulationSettings:s,resetEditor:l,forceSimulatorReset:c,setIsLoading:u,setError:f,setSuccess:h,setIsAdtOpen:m,saveFileHandle:x,setSaveFileHandle:y,setIsMobileMenuOpen:w}=t||{},E=()=>{m&&m(!0)},_=async(T,N)=>{const L=await T.createWritable();await L.write(new Blob([N],{type:"application/xml"})),await L.close()};return{handleSave:async()=>{try{u==null||u(!0),f==null||f(null),h==null||h(null);const T={...e||{},netMode:(i==null?void 0:i.netMode)||"pt"},N=await Ny(T),L="petri-net.pnml";if(typeof window<"u"&&typeof window.showSaveFilePicker=="function")try{if(x)await _(x,N);else{const R=await window.showSaveFilePicker({suggestedName:L,types:[{description:"PNML Files",accept:{"application/xml":[".pnml",".xml"],"text/xml":[".pnml",".xml"]}}],excludeAcceptAllOption:!1});await _(R,N),y==null||y(R)}}catch(R){if(R&&(R.name==="AbortError"||R.name==="SecurityError"))h==null||h("Save cancelled.");else{const M=new Blob([N],{type:"application/xml"}),I=URL.createObjectURL(M),O=document.createElement("a");O.href=I,O.download=L,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(I)}}else{const R=new Blob([N],{type:"application/xml"}),M=URL.createObjectURL(R),I=document.createElement("a");I.href=M,I.download=L,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(M)}h==null||h("Petri net saved."),w==null||w(!1)}catch(T){console.error("Error saving Petri net:",T),f==null||f(`Error saving Petri net: ${T.message}`)}finally{u==null||u(!1)}},handleSaveAs:async()=>{try{u==null||u(!0),f==null||f(null),h==null||h(null);const T={...e||{},netMode:(i==null?void 0:i.netMode)||"pt"},N=await Ny(T),L="petri-net.pnml";if(typeof window<"u"&&typeof window.showSaveFilePicker=="function")try{const R=await window.showSaveFilePicker({suggestedName:L,types:[{description:"PNML Files",accept:{"application/xml":[".pnml",".xml"],"text/xml":[".pnml",".xml"]}}],excludeAcceptAllOption:!1});await _(R,N),y==null||y(R)}catch(R){if(R&&(R.name==="AbortError"||R.name==="SecurityError"))h==null||h("Save cancelled.");else{const M=new Blob([N],{type:"application/xml"}),I=URL.createObjectURL(M),O=document.createElement("a");O.href=I,O.download=L,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(I)}}else{const R=new Blob([N],{type:"application/xml"}),M=URL.createObjectURL(R),I=document.createElement("a");I.href=M,I.download=L,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(M)}h==null||h("Petri net saved."),w==null||w(!1)}catch(T){console.error("Error saving Petri net:",T),f==null||f(`Error saving Petri net: ${T.message}`)}finally{u==null||u(!1)}},handleLoad:()=>{const T=document.createElement("input");T.type="file",T.accept=".pnml,.xml";try{T.style.display="none",document.body.appendChild(T)}catch{}T.onchange=async N=>{const L=N.target.files[0];if(L)try{u==null||u(!0),f==null||f(null),h==null||h(null);const A=await new Promise((D,$)=>{const X=new FileReader;X.onload=F=>D(F.target.result),X.onerror=$,X.readAsText(L)});if(!A||String(A).trim()==="")throw new Error("The selected file is empty");if(!String(A).includes("<pnml")&&!String(A).includes("<PNML"))throw new Error("The file does not appear to be a valid PNML file");const R=Kw(A),M=new Promise((D,$)=>{setTimeout(()=>$(new Error("Operation timed out. The file may be too large or invalid.")),1e4)}),I=await Promise.race([R,M]);if(!I||typeof I!="object")throw new Error("Invalid data structure in the imported file");const O={places:Array.isArray(I.places)?I.places:[],transitions:Array.isArray(I.transitions)?I.transitions:[],arcs:Array.isArray(I.arcs)?I.arcs:[]},W=(O.arcs||[]).filter(D=>{if(D.source==="undefined"||D.target==="undefined"||!D.source||!D.target)return!1;const $=O.places.some(F=>F.id===D.source)||O.transitions.some(F=>F.id===D.source),X=O.places.some(F=>F.id===D.target)||O.transitions.some(F=>F.id===D.target);return $&&X});O.arcs=W.map(D=>{if(!D.type||D.type!=="place-to-transition"&&D.type!=="transition-to-place"){const $=O.places.some(F=>F.id===D.source),X=O.places.some(F=>F.id===D.target);return $&&!X?{...D,type:"place-to-transition"}:!$&&X?{...D,type:"transition-to-place"}:{...D,type:"place-to-transition"}}return D}),c&&c(),n==null||n(O);const B=O.netMode;if(B)s==null||s(D=>({...D||{},netMode:B}));else try{const D=l7(O);s==null||s($=>({...$||{},netMode:D}))}catch{}r&&r(O),h==null||h(`Petri net loaded successfully with ${O.places.length} places, ${O.transitions.length} transitions, and ${O.arcs.length} arcs.`),w==null||w(!1)}catch(A){console.error("Error loading Petri net:",A),f==null||f(`Error loading Petri net: ${A.message}`)}finally{u==null||u(!1);try{T&&T.parentNode&&T.parentNode.removeChild(T)}catch{}}},T.click()},handleClear:()=>{var T,N;try{(T=hi.deactivateSimulation)==null||T.call(hi),(N=hi.reset)==null||N.call(hi)}catch{}if(l)l();else{const L={places:[],transitions:[],arcs:[]};n==null||n(L),s==null||s(A=>({...A||{},netMode:"pt"})),r&&r(L)}h==null||h("Canvas cleared successfully."),w==null||w(!1)},handleOpenAdtManager:E}}const It=[];for(let t=0;t<256;++t)It.push((t+256).toString(16).slice(1));function c7(t,e=0){return(It[t[e+0]]+It[t[e+1]]+It[t[e+2]]+It[t[e+3]]+"-"+It[t[e+4]]+It[t[e+5]]+"-"+It[t[e+6]]+It[t[e+7]]+"-"+It[t[e+8]]+It[t[e+9]]+"-"+It[t[e+10]]+It[t[e+11]]+It[t[e+12]]+It[t[e+13]]+It[t[e+14]]+It[t[e+15]]).toLowerCase()}let Rh;const d7=new Uint8Array(16);function f7(){if(!Rh){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Rh=crypto.getRandomValues.bind(crypto)}return Rh(d7)}const h7=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zy={randomUUID:h7};function co(t,e,n){var i;if(zy.randomUUID&&!e&&!t)return zy.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??f7();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[n+s]=r[s];return e}return c7(r)}function v5(t,e){const n=new Set((e||[]).filter(l=>l.type==="place"||l.type==="transition").map(l=>l.id)),r=(t.places||[]).filter(l=>n.has(l.id)),i=(t.transitions||[]).filter(l=>n.has(l.id)),s=(t.arcs||[]).filter(l=>n.has(l.source)&&n.has(l.target));return{places:r,transitions:i,arcs:s}}function x5(t,e,n){if(!t)return null;const r=new Map,i=n&&typeof n.x=="number"?n.x:(n==null?void 0:n.dx)||0,s=n&&typeof n.y=="number"?n.y:(n==null?void 0:n.dy)||0,l=[],c=(t.places||[]).map(h=>{const m=e();r.set(h.id,m);const x=typeof h.x=="number"&&isFinite(h.x)?h.x:0,y=typeof h.y=="number"&&isFinite(h.y)?h.y:0,w={...h,id:m,x:x+i,y:y+s};return l.push({id:m,type:"place"}),w}),u=(t.transitions||[]).map(h=>{const m=e();r.set(h.id,m);const x=typeof h.x=="number"&&isFinite(h.x)?h.x:0,y=typeof h.y=="number"&&isFinite(h.y)?h.y:0,w={...h,id:m,x:x+i,y:y+s};return l.push({id:m,type:"transition"}),w}),f=(t.arcs||[]).map(h=>({...h,id:e(),source:r.get(h.source),target:r.get(h.target)}));return{newPlaces:c,newTransitions:u,newArcs:f,newSelection:l}}function p7(t,e){const n=new Set(Array.isArray(e)?e.map(i=>typeof i=="string"?i:i.id):[]),r={...t};return r.places=(t.places||[]).filter(i=>!n.has(i.id)),r.transitions=(t.transitions||[]).filter(i=>!n.has(i.id)),r.arcs=(t.arcs||[]).filter(i=>!n.has(i.source)&&!n.has(i.target)),r}function w5(t){const{elements:e,setElements:n,selectedElement:r,selectedElements:i,clearSelection:s,setSelection:l,clipboardRef:c,netMode:u,setClipboard:f,getClipboard:h,onClipboardMismatch:m,handleUndo:x,handleRedo:y,setMode:w,arcStart:E,setArcStart:_,setTempArcEnd:S,setSelectedElement:C}=t;z.useEffect(()=>{const g=T=>{const L=navigator.platform.toUpperCase().includes("MAC")?T.metaKey:T.ctrlKey;T.key==="Shift"&&t.isShiftPressedRef&&(t.isShiftPressedRef.current=!0);const A=T.target,R=A==null?void 0:A.tagName,M=R==="INPUT"||R==="TEXTAREA"||(A==null?void 0:A.isContentEditable);if(!M&&(T.key==="Delete"||T.key==="Backspace")){if(i.length===0&&!r)return;T.preventDefault(),n(I=>{const O=[],W=new Set;i.length>0?i.forEach(D=>{(D.type==="place"||D.type==="transition")&&O.push(D.id),D.type==="arc"&&W.add(D.id)}):r&&((r.type==="place"||r.type==="transition")&&O.push(r.id),r.type==="arc"&&W.add(r.id));let B=I;return O.length>0&&(B=p7(B,O)),W.size>0&&(B={...B,arcs:B.arcs.filter(D=>!W.has(D.id))}),B}),s();return}if(!M&&L&&(T.key==="a"||T.key==="A")){T.preventDefault();const I=[...e.places.map(O=>({id:O.id,type:"place"})),...e.transitions.map(O=>({id:O.id,type:"transition"})),...e.arcs.map(O=>({id:O.id,type:"arc"}))];l(I);return}if(!M&&L&&(T.key==="z"||T.key==="Z")&&typeof x=="function"){T.preventDefault(),x();return}if(!M&&L&&(T.key==="y"||T.key==="Y")&&typeof y=="function"){T.preventDefault(),y();return}if(!M&&!L){if((T.key==="p"||T.key==="P")&&typeof w=="function"){T.preventDefault(),w("place");return}if((T.key==="t"||T.key==="T")&&typeof w=="function"){T.preventDefault(),w("transition");return}if((T.key==="a"||T.key==="A")&&typeof w=="function"){T.preventDefault(),w("arc");return}if((T.key==="s"||T.key==="S")&&typeof w=="function"){T.preventDefault(),w("select");return}if(T.key==="Escape"){T.preventDefault(),typeof w=="function"&&w("select"),typeof _=="function"&&E&&_(null),typeof S=="function"&&S(null),typeof C=="function"&&C(null);return}}if(!M&&L&&(T.key==="c"||T.key==="C")){if(i.length===0)return;T.preventDefault();const I=v5(e,i),O=u||"pt";typeof f=="function"?f(I):c&&(c.current={payload:I,netMode:O,source:"local",timestamp:Date.now()});return}if(!M&&L&&(T.key==="v"||T.key==="V")){const I=u||"pt",O=typeof h=="function"?h():c==null?void 0:c.current;if(!O)return;const W=O.payload||O;if(!W)return;const B=O.netMode||I;if(B&&I&&B!==I){typeof m=="function"?m(B,I,O):console.warn(`Blocked paste: shared clipboard contains ${B} net, editor mode is ${I}.`);return}T.preventDefault();const{newPlaces:D,newTransitions:$,newArcs:X,newSelection:F}=x5(W,co,{x:40,y:40});n(U=>({...U,places:[...U.places,...D],transitions:[...U.transitions,...$],arcs:[...U.arcs,...X]})),l(F);return}},k=T=>{T.key==="Shift"&&t.isShiftPressedRef&&(t.isShiftPressedRef.current=!1)};return document.addEventListener("keydown",g),document.addEventListener("keyup",k),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",k)}},[e,i,r,n,s,l,c,t,x,y,w,E,_,S,C])}function g7(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var _5=g7,m7=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,y7=m7,v7=y7,x7=typeof self=="object"&&self&&self.Object===Object&&self,w7=v7||x7||Function("return this")(),S5=w7,_7=S5,S7=function(){return _7.Date.now()},k7=S7,C7=/\s/;function T7(t){for(var e=t.length;e--&&C7.test(t.charAt(e)););return e}var E7=T7,b7=E7,P7=/^\s+/;function N7(t){return t&&t.slice(0,b7(t)+1).replace(P7,"")}var M7=N7,A7=S5,I7=A7.Symbol,k5=I7,By=k5,C5=Object.prototype,L7=C5.hasOwnProperty,R7=C5.toString,da=By?By.toStringTag:void 0;function F7(t){var e=L7.call(t,da),n=t[da];try{t[da]=void 0;var r=!0}catch{}var i=R7.call(t);return r&&(e?t[da]=n:delete t[da]),i}var j7=F7,O7=Object.prototype,D7=O7.toString;function z7(t){return D7.call(t)}var B7=z7,Uy=k5,U7=j7,G7=B7,V7="[object Null]",W7="[object Undefined]",Gy=Uy?Uy.toStringTag:void 0;function $7(t){return t==null?t===void 0?W7:V7:Gy&&Gy in Object(t)?U7(t):G7(t)}var H7=$7;function X7(t){return t!=null&&typeof t=="object"}var Y7=X7,K7=H7,Q7=Y7,Z7="[object Symbol]";function q7(t){return typeof t=="symbol"||Q7(t)&&K7(t)==Z7}var J7=q7,e_=M7,Vy=_5,t_=J7,Wy=0/0,n_=/^[-+]0x[0-9a-f]+$/i,r_=/^0b[01]+$/i,i_=/^0o[0-7]+$/i,s_=parseInt;function o_(t){if(typeof t=="number")return t;if(t_(t))return Wy;if(Vy(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Vy(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=e_(t);var n=r_.test(t);return n||i_.test(t)?s_(t.slice(2),n?2:8):n_.test(t)?Wy:+t}var a_=o_,l_=_5,Fh=k7,$y=a_,u_="Expected a function",c_=Math.max,d_=Math.min;function f_(t,e,n){var r,i,s,l,c,u,f=0,h=!1,m=!1,x=!0;if(typeof t!="function")throw new TypeError(u_);e=$y(e)||0,l_(n)&&(h=!!n.leading,m="maxWait"in n,s=m?c_($y(n.maxWait)||0,e):s,x="trailing"in n?!!n.trailing:x);function y(N){var L=r,A=i;return r=i=void 0,f=N,l=t.apply(A,L),l}function w(N){return f=N,c=setTimeout(S,e),h?y(N):l}function E(N){var L=N-u,A=N-f,R=e-L;return m?d_(R,s-A):R}function _(N){var L=N-u,A=N-f;return u===void 0||L>=e||L<0||m&&A>=s}function S(){var N=Fh();if(_(N))return C(N);c=setTimeout(S,E(N))}function C(N){return c=void 0,x&&r?y(N):(r=i=void 0,l)}function g(){c!==void 0&&clearTimeout(c),f=0,r=u=i=c=void 0}function k(){return c===void 0?l:C(Fh())}function T(){var N=Fh(),L=_(N);if(r=arguments,i=this,u=N,L){if(c===void 0)return w(u);if(m)return clearTimeout(c),c=setTimeout(S,e),y(u)}return c===void 0&&(c=setTimeout(S,e)),l}return T.cancel=g,T.flush=k,T}var h_=f_;const p_=il(h_);function g_(t,e){return!t||!e||!jh(t.places,e.places,T5)||!jh(t.transitions,e.transitions,Z0)||!jh(t.arcs,e.arcs,E5)?!1:(he.debug("HistoryManager: States are identical"),!0)}function jh(t=[],e=[],n){if(t.length!==e.length){const i=n===T5?"places":n===Z0?"transitions":"arcs";return he.debug(`HistoryManager: States differ in number of ${i}`),!1}const r=new Map;e.forEach(i=>r.set(i.id,i));for(const i of t){const s=r.get(i.id);if(!s)return he.debug(`HistoryManager: ${n===E5?"Arc":n===Z0?"Transition":"Place"} ${i.id} not found in second state`),!1;if(!n(i,s))return!1}return!0}function T5(t,e){const n=JSON.stringify(t.valueTokens||[])===JSON.stringify(e.valueTokens||[]),r=t.x===e.x&&t.y===e.y&&t.tokens===e.tokens&&t.label===e.label&&t.name===e.name&&n;return r||he.debug(`HistoryManager: Place ${t.id} differs - x: ${t.x} vs ${e.x}, y: ${t.y} vs ${e.y}, tokens: ${t.tokens} vs ${e.tokens}, label: ${t.label} vs ${e.label}, name: ${t.name} vs ${e.name}`),r}function Z0(t,e){const n=t.x===e.x&&t.y===e.y&&t.label===e.label&&t.name===e.name&&(t.guard||"")===(e.guard||"");return n||he.debug(`HistoryManager: Transition ${t.id} differs - x: ${t.x} vs ${e.x}, y: ${t.y} vs ${e.y}, label: ${t.label} vs ${e.label}, name: ${t.name} vs ${e.name}`),n}function E5(t,e){if(!(t.source===e.source&&t.target===e.target&&t.weight===e.weight))return he.debug(`HistoryManager: Arc ${t.id} differs - source: ${t.source} vs ${e.source}, target: ${t.target} vs ${e.target}, weight: ${t.weight} vs ${e.weight}`),!1;const r=(t.label||"")===(e.label||"")&&(t.sourceType||"")===(e.sourceType||"")&&(t.targetType||"")===(e.targetType||"")&&JSON.stringify(t.bindings||[])===JSON.stringify(e.bindings||[])&&JSON.stringify(t.anglePoints||[])===JSON.stringify(e.anglePoints||[]);return r||he.debug(`HistoryManager: Arc ${t.id} differs in secondary properties`),r}function Xu(t){if(!t||!t.places||!t.transitions||!t.arcs)return{places:[],transitions:[],arcs:[]};const e=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(i=>e(i));const r={};for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const s=n[i];s===null||typeof s!="object"?r[i]=s:Array.isArray(s)?r[i]=[...s]:r[i]={...s}}return r};return{places:t.places.map(e),transitions:t.transitions.map(e),arcs:t.arcs.map(e)}}function Oh(t){return!t||!t.places||!t.transitions||!t.arcs?{places:[],transitions:[],arcs:[]}:Xu(t)}class Hy{constructor(e){this.states=[Xu(e)],this.currentIndex=0,this.maxStates=50}addState(e){const n=Xu(e),r=this.states[this.currentIndex];return this.currentIndex>=0&&g_(r,n)?(he.debug("HistoryManager: State unchanged, not adding to history"),{canUndo:this.canUndo(),canRedo:this.canRedo()}):(he.debug(`HistoryManager: Adding new state to history. Current index: ${this.currentIndex}, States count: ${this.states.length}`),this.currentIndex<this.states.length-1&&(he.debug(`HistoryManager: Removing ${this.states.length-this.currentIndex-1} future states`),this.states=this.states.slice(0,this.currentIndex+1)),this.states.push(n),this.currentIndex++,this.states.length>this.maxStates&&(this.states.shift(),this.currentIndex--),he.debug(`HistoryManager: New state added. Current index: ${this.currentIndex}, States count: ${this.states.length}`),{canUndo:this.canUndo(),canRedo:this.canRedo()})}undo(){if(!this.canUndo())return he.debug("HistoryManager: Cannot undo - no previous states"),null;this.currentIndex--;const e=this.states[this.currentIndex];return he.debug(`HistoryManager: Undoing to index ${this.currentIndex}, states count: ${this.states.length}`),{state:Oh(e),canUndo:this.canUndo(),canRedo:this.canRedo()}}redo(){if(!this.canRedo())return he.debug("HistoryManager: Cannot redo - no future states"),null;this.currentIndex++;const e=this.states[this.currentIndex];return he.debug(`HistoryManager: Redoing to index ${this.currentIndex}, states count: ${this.states.length}`),{state:Oh(e),canUndo:this.canUndo(),canRedo:this.canRedo()}}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.states.length-1}getCurrentState(){return this.states[this.currentIndex]}deepCopyState(e){return Xu(e)}validateState(e){return Oh(e)}}const m_="petri-net-shared-clipboard";function y_({clipboardRef:t,netMode:e,instanceId:n,onIncompatibleClipboard:r}){const i=z.useRef(null),s=z.useRef(e||"pt"),l=z.useRef(r||null);z.useEffect(()=>{s.current=e||"pt"},[e]),z.useEffect(()=>{l.current=r||null},[r]),z.useEffect(()=>{if(typeof window>"u"||typeof window.BroadcastChannel!="function")return;const f=new window.BroadcastChannel(m_);i.current=f;const h=m=>{var E;const x=m==null?void 0:m.data;if(!x||x.type!=="PETRI_NET_CLIPBOARD_UPDATE"||x.instanceId===n)return;const y={payload:x.payload,netMode:x.netMode,source:"remote",instanceId:x.instanceId,timestamp:x.timestamp||Date.now()};t&&(t.current=y);const w=s.current;y.netMode&&w&&y.netMode!==w&&((E=l.current)==null||E.call(l,y.netMode,w,y))};return f.addEventListener("message",h),()=>{f.removeEventListener("message",h),i.current=null,f.close()}},[t,n]);const c=z.useCallback(f=>{if(!f)return;const h={payload:f,netMode:s.current,source:"local",instanceId:n,timestamp:Date.now()};t&&(t.current=h);const m=i.current;if(m&&typeof m.postMessage=="function")try{m.postMessage({type:"PETRI_NET_CLIPBOARD_UPDATE",payload:f,netMode:h.netMode,instanceId:n,timestamp:h.timestamp})}catch(x){console.warn("Failed to broadcast clipboard payload:",x)}},[t,n]),u=z.useCallback(()=>t==null?void 0:t.current,[t]);return{setClipboard:c,getClipboard:u}}const b5=z.createContext(),v_=({children:t})=>{const[r,i]=z.useState({width:800,height:600}),[s,l]=z.useState({width:1e4,height:7500}),[c,u]=z.useState({x:0,y:0}),[f,h]=z.useState(1),[m,x]=z.useState(!0),y=20,w=z.useRef(null),[E,_]=z.useState(null),S=z.useRef(null),[C,g]=z.useState(!1),[k,T]=z.useState({visible:!1,position:null,elementType:null}),N=z.useRef("select"),A={stageDimensions:r,setStageDimensions:i,virtualCanvasDimensions:s,setVirtualCanvasDimensions:l,canvasScroll:c,setCanvasScroll:u,zoomLevel:f,setZoomLevel:h,gridSnappingEnabled:m,toggleGridSnapping:()=>{x(R=>!R)},gridSize:y,MIN_ZOOM:.1,MAX_ZOOM:3,appRef:w,containerRef:E,setContainerRef:_,stageRef:S,isDragging:C,setIsDragging:g,snapIndicator:k,setSnapIndicator:T,prevModeRef:N};return P.jsx(b5.Provider,{value:A,children:t})},Po=()=>{const t=z.useContext(b5);if(t===void 0)throw new Error("useEditorUI must be used within an EditorUIProvider");return t};function Xy(t){if(!(t!=null&&t.valueTokens)||t.valueTokens.length===0)return null;const e=Ja(t.valueTokens[0]);return t.valueTokens.every(r=>Ja(r)===e)?e:null}function dl(t,e,n=!0){if(!n)return console.log("[TypeInference] Disabled, returning original state"),t;if(e!=="algebraic-int"||!(t!=null&&t.places)||!(t!=null&&t.arcs)||!(t!=null&&t.transitions))return console.log("[TypeInference] Skipping - netMode:",e,"hasPlaces:",!!(t!=null&&t.places)),t;console.log("[TypeInference] Starting with overwrite=",n);const r={arcs:[],transitions:[]},i=!!n;t.places.forEach(c=>{const u=Xy(c);u&&t.arcs.filter(h=>h.source===c.id).forEach(h=>{if(h.bindings&&h.bindings.length>0){const m=[];let x=!1;for(const y of h.bindings){if(!y){m.push(y);continue}const w=new Map,E=y.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(E&&E.forEach(S=>{if(S!=="true"&&S!=="false"&&S!=="and"&&S!=="or"&&S!=="not")if(!y.includes(`${S}:`))w.set(S,u);else{const C=y.match(new RegExp(`${S}:(Int|Bool|Pair|String|List)`,"i"));C&&C[1]&&w.set(S,C[1])}}),u==="List"){const S=Array.isArray(c.valueTokens)?c.valueTokens:[];let C=null;if(S.length>0&&Array.isArray(S[0])&&S[0].length>0){const g=Ja(S[0][0]);S.every(T=>Array.isArray(T)&&T.every(N=>Ja(N)===g))&&(C=g)}if(C)for(const[g,k]of Array.from(w.entries()))k==="List"&&w.set(g,C);else w.clear()}const _=w.size>0?Hu(y,w,null,{overwrite:i}):y;_!==y&&(x=!0),m.push(_)}x&&r.arcs.push({arcId:h.id,newBindings:m})}})});const s=t.arcs.map(c=>{const u=r.arcs.find(f=>f.arcId===c.id);return u?u.newBindings?{...c,bindings:[...u.newBindings]}:{...c,bindings:[u.newBinding]}:c});return t.transitions.forEach(c=>{const u=s.filter(m=>m.target===c.id),f=new Map;if(console.log("[TypeInference] Processing transition:",c.id,"inputArcs:",u.length),u.forEach(m=>{m.bindings&&m.bindings.length>0&&m.bindings.forEach(x=>{if(!x)return;console.log("[TypeInference] Input arc binding:",x);const y=x.match(/\b([a-z][a-zA-Z0-9_]*)\:(Int|Bool|Pair|String|List)\b/gi);y&&y.forEach(E=>{const _=E.match(/\b([a-z][a-zA-Z0-9_]*)\:(Int|Bool|Pair|String|List)\b/i);_&&_[1]&&_[2]&&f.set(_[1],_[2])});const w=x.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(console.log("[TypeInference] All variable matches in binding:",w),w){const E=t.places.find(_=>_.id===m.source);if(E){const _=Xy(E);_&&w.forEach(S=>{S!=="true"&&S!=="false"&&S!=="and"&&S!=="or"&&S!=="not"&&(f.has(S)||f.set(S,_))})}}})}),console.log("[TypeInference] Extracted variable types for",c.id,":",JSON.stringify(Array.from(f.entries()))),c.guard&&f.size>0){const m=c.guard.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(m){const x=new Map;if(m.forEach(y=>{if(y!=="true"&&y!=="false"&&y!=="and"&&y!=="or"&&y!=="not"){const w=f.get(y);if(!w)return;i?x.set(y,w):new RegExp(`\\b${y}\\s*:(Int|Bool|Pair|String|List)\\b`,"i").test(c.guard)||x.set(y,w)}}),console.log("[TypeInference] Guard type map for",c.id,":",Array.from(x.entries())),x.size>0){const y=Hu(c.guard,x,null,{overwrite:i});console.log("[TypeInference] Guard before:",c.guard),console.log("[TypeInference] Guard after:",y),y!==c.guard&&r.transitions.push({transitionId:c.id,newGuard:y})}}}s.filter(m=>m.source===c.id).forEach(m=>{if(m.bindings&&m.bindings.length>0){const x=[];let y=!1;for(const w of m.bindings){if(!w){x.push(w);continue}const E=new Map,_=w.match(/\b[a-z][a-zA-Z0-9_]*\b/g);_&&_.forEach(C=>{if(C!=="true"&&C!=="false"&&C!=="and"&&C!=="or"&&C!=="not"){const g=f.get(C);if(!g)return;i?E.set(C,g):new RegExp(`\\b${C}\\s*:(Int|Bool|Pair|String|List)\\b`,"i").test(w)||E.set(C,g)}});const S=E.size>0?Hu(w,E,null,{overwrite:i}):w;S!==w&&(y=!0),x.push(S)}y&&r.arcs.push({arcId:m.id,newBindings:x})}})}),r.arcs.length===0&&r.transitions.length===0?t:{...t,arcs:t.arcs.map(c=>{const u=r.arcs.find(f=>f.arcId===c.id);return u?u.newBindings?{...c,bindings:[...u.newBindings]}:{...c,bindings:[u.newBinding]}:c}),transitions:t.transitions.map(c=>{const u=r.transitions.find(f=>f.transitionId===c.id);return u?{...c,guard:u.newGuard}:c})}}const og=z.createContext(),x_=({children:t})=>{const{gridSnappingEnabled:e,gridSize:n,setCanvasScroll:r,setZoomLevel:i}=Po(),[s,l]=z.useState({places:[],transitions:[],arcs:[]}),[c,u]=z.useState(null),[f,h]=z.useState([]),[m,x]=z.useState("select"),[y,w]=z.useState(null),[E,_]=z.useState(null),[S,C]=z.useState(!1),[g,k]=z.useState({maxIterations:2e5,limitIterations:!1,netMode:"pt",useNonVisualRun:!1,batchMode:!1,showInferredTypes:!1}),[T,N]=z.useState({poolSize:1,idleTimeoutMs:3e5,prewarmOnAlgebraicMode:!0,solverTimeoutMs:1e4}),[L,A]=z.useState(null),R=z.useRef(new Hy({places:[],transitions:[],arcs:[]})),[M,I]=z.useState(!1),[O,W]=z.useState(!1),B=z.useRef(p_(ke=>{const Xe=R.current.addState(ke);I(Xe.canUndo),W(Xe.canRedo)},500)),[D,$]=z.useState(!1),X=z.useRef(m),F=z.useRef(null),U=z.useRef(null),G=z.useRef(co()),K=z.useRef(!1),Q=(g==null?void 0:g.netMode)||"pt",Z=z.useRef(!!(g!=null&&g.showInferredTypes)),se=z.useRef(null),xe=z.useCallback((ke,Xe)=>{console.warn(`Shared clipboard net mode mismatch: received ${ke||"unknown"} while editor is ${Xe||Q}. Copy/paste is disabled until both editors use the same mode.`)},[Q]),{setClipboard:ge,getClipboard:V}=y_({clipboardRef:U,netMode:Q,instanceId:G.current,onIncompatibleClipboard:xe}),te=(ke,Xe=!1)=>{if(Xe){const nn=R.current.addState(ke);I(nn.canUndo),W(nn.canRedo)}else B.current(ke)},{isContinuousSimulating:ae,isRunning:ve,enabledTransitionIds:ye,simulationError:ie,isSimulatorReady:oe,handleFireTransition:Ee,stepSimulation:le,startContinuousSimulation:Se,startRunSimulation:Ie,stopAllSimulations:Fe,forceSimulatorReset:tn,completionStats:Ot,dismissCompletionDialog:ws}=a7(s,l,te,(g==null?void 0:g.netMode)||"pt",g);z.useEffect(()=>(!D&&X.current===m&&te(s),X.current=m,()=>B.current.cancel()),[s,D,m]),z.useEffect(()=>{const ke=!!(g!=null&&g.showInferredTypes),Xe=Z.current;if(ke!==Xe){if(Z.current=ke,ke&&Q==="algebraic-int"){l(nn=>(se.current=nn,dl(nn,Q,!0)));return}!ke&&se.current&&(l(se.current),se.current=null)}},[g==null?void 0:g.showInferredTypes,Q,l]);const _s=()=>{if(!M)return;he.debug("Undoing to previous state...");const ke=R.current.undo();ke&&(he.debug("Undo result:",ke.state),l(ke.state),I(ke.canUndo),W(ke.canRedo),tn())},Ss=()=>{if(!O)return;he.debug("Redoing to next state...");const ke=R.current.redo();ke&&(he.debug("Redo result:",ke.state),l(ke.state),I(ke.canUndo),W(ke.canRedo),tn())},ar=(ke,Xe)=>e?{x:Math.round(ke/n)*n,y:Math.round(Xe/n)*n}:{x:ke,y:Xe},ks=ke=>{k(ke),C(!1)};z.useEffect(()=>{(async()=>{if(!(typeof window>"u"))try{const{setZ3WorkerConfig:Xe}=await zr(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url);Xe(T)}catch{}})()},[T]);const Nt=()=>{const ke={places:[],transitions:[],arcs:[]};l(ke),u(null),h([]),x("select"),w(null),_(null),k({maxIterations:2e5,limitIterations:!1,netMode:"pt",useNonVisualRun:!1,batchMode:!1,showInferredTypes:!1}),r({x:0,y:0}),i(1),R.current=new Hy(ke),I(!1),W(!1),he.debug("Editor completely reset")},Qr=(ke,Xe)=>ke?f.some(nn=>nn.id===ke&&nn.type===Xe):!1,Cs=()=>{u(null),h([])},yl=ke=>{if(h(Array.isArray(ke)?ke:[]),Array.isArray(ke)&&ke.length>0){const Xe=ke[ke.length-1],nn=Xe.type==="place"?s.places.find(Zr=>Zr.id===Xe.id):Xe.type==="transition"?s.transitions.find(Zr=>Zr.id===Xe.id):s.arcs.find(Zr=>Zr.id===Xe.id);nn&&u({...nn,type:Xe.type})}else u(null)};return w5({elements:s,setElements:l,selectedElement:c,selectedElements:f,clearSelection:Cs,setSelection:yl,clipboardRef:U,isShiftPressedRef:K,netMode:Q,setClipboard:ge,getClipboard:V,onClipboardMismatch:xe}),P.jsx(og.Provider,{value:{elements:s,setElements:l,selectedElement:c,setSelectedElement:u,mode:m,setMode:x,arcStart:y,setArcStart:w,tempArcEnd:E,setTempArcEnd:_,isDragging:D,setIsDragging:$,isContinuousSimulating:ae,isRunning:ve,isSimulatorReady:oe,enabledTransitionIds:ye,simulationError:ie,stepSimulation:le,handleFireTransition:Ee,startContinuousSimulation:Se,startRunSimulation:Ie,stopAllSimulations:Fe,completionStats:Ot,dismissCompletionDialog:ws,isSettingsDialogOpen:S,setIsSettingsDialogOpen:C,simulationSettings:g,setSimulationSettings:k,netMode:Q,historyManagerRef:R,canUndo:M,setCanUndo:I,canRedo:O,setCanRedo:W,handleUndo:_s,handleRedo:Ss,updateHistory:te,snapToGrid:ar,handleSaveSettings:ks,z3Settings:T,setZ3Settings:N,resetEditor:Nt,simulatorCore:hi,forceSimulatorReset:tn,selectedElements:f,setSelectedElements:h,isIdSelected:Qr,clearSelection:Cs,setSelection:yl,multiDragRef:F,clipboardRef:U,setClipboard:ge,getClipboard:V,onClipboardMismatch:xe,instanceId:G.current,isShiftPressedRef:K,saveFileHandle:L,setSaveFileHandle:A},children:t})},qt=()=>{const t=z.useContext(og);if(t===void 0)throw new Error("usePetriNet must be used within a PetriNetProvider");return t},w_=({mode:t,setMode:e,gridSnappingEnabled:n,onToggleGridSnapping:r,canUndo:i,canRedo:s,onUndo:l,onRedo:c,elements:u,setElements:f,updateHistory:h,simulationSettings:m,setSimulationSettings:x,simulationMode:y,setSimulationMode:w,isSimulating:E,startSimulation:_,stopSimulation:S,clearCanvas:C,onOpenSettings:g,resetEditor:k})=>{const[T,N]=z.useState(!1),[L,A]=z.useState(null),[R,M]=z.useState(null),[I,O]=z.useState(!1),[W,B]=z.useState(!1),{saveFileHandle:D,setSaveFileHandle:$}=(()=>{try{return qt()}catch{return{saveFileHandle:null,setSaveFileHandle:()=>{}}}})(),{handleSave:X,handleSaveAs:F,handleLoad:U,handleClear:G,handleOpenAdtManager:K}=u7({elements:u,setElements:f,updateHistory:h,simulationSettings:m,setSimulationSettings:x,resetEditor:k,setIsLoading:N,setError:A,setSuccess:M,setIsAdtOpen:O,saveFileHandle:D,setSaveFileHandle:$,setIsMobileMenuOpen:B});z.useEffect(()=>{if(!R)return;const ae=setTimeout(()=>M(null),5e3);return()=>clearTimeout(ae)},[R]);const Q=z.useMemo(()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(min-width: 1024px)"):null,[]);z.useEffect(()=>{if(!Q)return;const ae=ve=>{ve.matches&&B(!1)};return Q.addEventListener?Q.addEventListener("change",ae):Q.addListener(ae),()=>{Q.removeEventListener?Q.removeEventListener("change",ae):Q.removeListener(ae)}},[Q]);const Z=(ae="desktop")=>ve=>({padding:"0.375rem 0.5rem",borderRadius:"0.25rem",backgroundColor:ve?"#4338ca":"white",color:ve?"rgba(255, 255, 255, 0.85)":"rgba(31, 41, 55, 0.7)",border:ve?"1px solid #3730a3":"1px solid #d1d5db",borderBottom:ve?"2px solid #312e81":"2px solid #9ca3af",margin:ae==="mobile"?"0 0 0.5rem 0":"0 0.125rem",minWidth:ae==="mobile"?"100%":"80px",width:ae==="mobile"?"100%":"80px",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",transition:"all 0.15s ease-in-out",textAlign:"center",height:"32px",display:"inline-flex",alignItems:"center",justifyContent:"center",boxShadow:ve?"inset 0 1px 0 rgba(255, 255, 255, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1)":"inset 0 1px 0 rgba(255, 255, 255, 0.7), 0 2px 4px rgba(0, 0, 0, 0.1)",position:"relative",top:"0",transform:ve?"translateY(1px)":"translateY(0)",textShadow:ve?"0 -1px 1px rgba(0, 0, 0, 0.5), 0 1px 0 rgba(255, 255, 255, 0.15)":"0 1px 0 rgba(255, 255, 255, 0.5), 0 -1px 0 rgba(0, 0, 0, 0.2)"}),se=z.useMemo(()=>Z("desktop"),[]),xe=z.useMemo(()=>Z("mobile"),[]),ge=ae=>({padding:"0.5rem",marginTop:"0.5rem",borderRadius:"0.25rem",backgroundColor:ae?"#fee2e2":"#d1fae5",color:ae?"#b91c1c":"#047857",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem"}),V=()=>P.jsxs("div",{className:"hidden lg:flex items-start",children:[P.jsxs("div",{className:"file-operations p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"File"}),P.jsx(ky,{isLoading:T,onSave:X,onSaveAs:F,canSaveAs:!!D,onLoad:U,onClear:G,buttonStyle:se})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"editing-tools p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"Editing"}),P.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[P.jsxs("div",{className:"flex items-center mr-4",children:[P.jsx("input",{type:"checkbox",id:"grid-snap-toggle","data-testid":"grid-snap-toggle",checked:n,onChange:r,className:"mr-1"}),P.jsx("label",{htmlFor:"grid-snap-toggle",className:"text-xs text-gray-700",children:"Snap to Grid"})]}),P.jsx(hw,{mode:t,setMode:e,buttonStyle:se})]})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"adt-tools p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"ADT Manager"}),P.jsx("div",{className:"flex justify-between",children:P.jsx("button",{style:se(!1),onClick:K,title:"Open ADT Manager","data-testid":"toolbar-adt-manager",children:"ADT"})})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"history-tools p-2",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"History"}),P.jsx(pw,{canUndo:i,canRedo:s,onUndo:l,onRedo:c,buttonStyle:se})]}),P.jsx("div",{className:"h-full",style:{borderRight:"1px solid rgba(180, 180, 190, 0.9)",borderLeft:"1px solid rgba(255, 255, 255, 0.9)",margin:"0 12px",height:"50px",alignSelf:"center",opacity:.85}}),P.jsxs("div",{className:"settings-tools p-2 ml-auto",children:[P.jsx("h3",{className:"text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wider",children:"Settings"}),P.jsx(Cy,{onOpenSettings:g,buttonStyle:se})]})]}),te=()=>P.jsxs("div",{className:"flex flex-col space-y-6",children:[P.jsxs("div",{className:"file-operations",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"File"}),P.jsx(ky,{isLoading:T,onSave:X,onSaveAs:F,canSaveAs:!!D,onLoad:U,onClear:G,buttonStyle:xe})]}),P.jsxs("div",{className:"editing-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"Editing"}),P.jsxs("div",{className:"flex items-center",children:[P.jsx("input",{type:"checkbox",id:"grid-snap-toggle-mobile","data-testid":"grid-snap-toggle-mobile",checked:n,onChange:r,className:"mr-2"}),P.jsx("label",{htmlFor:"grid-snap-toggle-mobile",className:"text-sm text-gray-700",children:"Snap to Grid"})]})]}),P.jsxs("div",{className:"adt-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"ADT Manager"}),P.jsx("button",{style:xe(!1),onClick:()=>{B(!1),K()},title:"Open ADT Manager","data-testid":"toolbar-adt-manager-mobile",children:"ADT"})]}),P.jsxs("div",{className:"settings-tools",children:[P.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:"Settings"}),P.jsx(Cy,{onOpenSettings:()=>{B(!1),g()},buttonStyle:xe})]})]});return P.jsxs("div",{className:"toolbar-container flex flex-col p-2 bg-gray-50 border-b border-gray-200 shadow-sm",style:{minHeight:"70px"},children:[P.jsx("div",{className:"hidden lg:block",children:V()}),P.jsxs("div",{className:"lg:hidden flex items-center gap-3 px-2 py-1",children:[P.jsxs("button",{type:"button",className:"flex items-center gap-2 px-3 py-2 rounded-md border border-gray-200 shadow-sm bg-white font-semibold text-gray-700",onClick:()=>B(!0),"aria-label":"Open toolbar menu",children:[P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),P.jsx("span",{children:"Menu"})]}),P.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[P.jsx("button",{type:"button",className:`p-2 rounded-md border border-gray-200 shadow-sm bg-white text-gray-700 transition-all ${i?"hover:bg-gray-50 active:scale-95":"opacity-50 cursor-not-allowed"}`,onClick:l,disabled:!i,title:"Undo","aria-label":"Undo",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})})}),P.jsx("button",{type:"button",className:`p-2 rounded-md border border-gray-200 shadow-sm bg-white text-gray-700 transition-all ${s?"hover:bg-gray-50 active:scale-95":"opacity-50 cursor-not-allowed"}`,onClick:c,disabled:!s,title:"Redo","aria-label":"Redo",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3"})})})]})]}),I&&P.jsx(Mw,{isOpen:I,onClose:()=>O(!1)}),L&&P.jsxs("div",{style:ge(!0),children:[L,P.jsx("button",{onClick:()=>A(null),style:{marginLeft:"0.5rem"},children:""})]}),R&&P.jsxs("div",{style:ge(!1),children:[R,P.jsx("button",{onClick:()=>M(null),style:{marginLeft:"0.5rem"},children:""})]}),P.jsxs("div",{className:"lg:hidden fixed inset-0 z-50 pointer-events-none",children:[P.jsx("div",{className:`absolute inset-0 bg-black transition-opacity duration-300 ease-in-out ${W?"opacity-40 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>B(!1)}),P.jsx("div",{className:`fixed w-80 left-0 top-16 bottom-0 z-50 bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300 ease-in-out ${W?"translate-x-0":"-translate-x-full"} pointer-events-auto`,onWheel:ae=>ae.stopPropagation(),children:P.jsxs("div",{className:"p-5",children:[P.jsx("div",{className:"mb-4",children:P.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Menu"})}),te()]})})]})]})},__=({mode:t,tokens:e,valueTokensInput:n,onTokensChange:r,onValueTokensChange:i,onValueTokensBlur:s})=>t==="pt"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tokens (PT mode)"}),P.jsx("input",{type:"number",min:"0",value:e,onChange:r,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}):t==="algebraic-int"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Algebraic Tokens"}),P.jsx("input",{type:"text",value:n,onChange:i,onBlur:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm",placeholder:"e.g., 2, 3, 'hello', T, F, (1, 2), [1, 2, 3]"})]}):null,S_=({mode:t,weight:e,bindingsInput:n,bindingError:r,onWeightChange:i,onBindingsChange:s,onBindingsBlur:l})=>t==="pt"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Weight"}),P.jsx("input",{type:"number",min:"1",value:e,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}):t==="algebraic-int"?P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bindings"}),P.jsx("input",{type:"text",value:n,onChange:s,onBlur:l,className:`w-full px-3 py-2 border rounded-md font-mono text-sm ${r?"border-red-500":"border-gray-300"}`,placeholder:"e.g., x, y, (a, b)"}),r&&P.jsx("p",{className:"text-red-600 text-xs mt-1",children:r})]}):null,k_=({guardText:t,guardError:e,onGuardChange:n,onGuardBlur:r})=>P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Guard"}),P.jsx("input",{type:"text",value:t,onChange:n,onBlur:r,className:`w-full px-3 py-2 border rounded-md font-mono text-sm ${e?"border-red-500":"border-gray-300"}`,placeholder:"e.g., x > 0 and y < 10"}),e&&P.jsx("p",{className:"text-red-600 text-xs mt-1",children:e})]});function C_(){const t=z.useCallback(r=>{const i=[];let s="",l=0,c=0,u=!1;for(let h=0;h<r.length;h++){const m=r[h];if(u){s+=m,m==="'"&&r[h-1]!=="\\"&&(u=!1);continue}if(m==="'"){u=!0,s+=m;continue}if(m==="("){l++,s+=m;continue}if(m===")"){l=Math.max(0,l-1),s+=m;continue}if(m==="["){c++,s+=m;continue}if(m==="]"){c=Math.max(0,c-1),s+=m;continue}if(m===","&&l===0&&c===0){i.push(s.trim()),s="";continue}s+=m}const f=s.trim();return f.length>0&&i.push(f),i},[]),e=z.useCallback(r=>{const i=String(r||"").trim(),s=i.toLowerCase();if(i==="T"||s==="true")return!0;if(i==="F"||s==="false")return!1;if(/^[+-]?\d+$/.test(i))return parseInt(i,10);if(i.startsWith("'")&&i.endsWith("'"))return i.slice(1,-1);if(i.startsWith("[")&&i.endsWith("]")){const l=i.slice(1,-1).trim();return l?t(l).map(e):[]}if(i.startsWith("(")&&i.endsWith(")")){const l=i.slice(1,-1).trim();let c=0,u=-1;for(let f=0;f<l.length;f++){const h=l[f];if(h==="(")c++;else if(h===")")c=Math.max(0,c-1);else if(h===","&&c===0){u=f;break}}if(u>=0)return{__pair__:!0,fst:e(l.slice(0,u)),snd:e(l.slice(u+1))}}return null},[t]);return{parseValueTokensInput:z.useCallback(r=>{const i=String(r||"").trim();return i?t(i).map(e).filter(s=>s!==null):[]},[t,e]),splitTopLevelCommas:t}}function T_(){const t=z.useCallback(n=>{const r=[];let i="",s=0,l=0;for(let c=0;c<n.length;c++){const u=n[c];if(u==="(")s++;else if(u===")")s=Math.max(0,s-1);else if(u==="[")l++;else if(u==="]")l=Math.max(0,l-1);else if(u===","&&s===0&&l===0){r.push(i.trim()),i="";continue}i+=u}return i.trim()&&r.push(i.trim()),r.filter(Boolean)},[]),e=z.useCallback(n=>{const r=t(String(n||""));for(const i of r){try{n5(i);continue}catch{}try{Rt(i);continue}catch{}try{xo(i,Rt);continue}catch{}return{ok:!1,error:`Invalid binding: ${i}`}}return{ok:!0,bindings:r}},[t]);return{splitTopLevel:t,validateBindings:e}}const E_=({getElementInfo:t,setElements:e,updateHistory:n,setFormValues:r})=>z.useCallback(i=>{const s=i.target.value;r(u=>({...u,label:s}));const{elementId:l,elementType:c}=t();c==="place"?e(u=>({...u,places:u.places.map(f=>f.id===l?{...f,label:s}:f)})):c==="transition"?e(u=>({...u,transitions:u.transitions.map(f=>f.id===l?{...f,label:s}:f)})):c==="arc"&&e(u=>({...u,arcs:u.arcs.map(f=>f.id===l?{...f,label:s}:f)})),n()},[t,e,n,r]),b_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,parseValueTokensInput:l,showInferredTypes:c})=>{const u=z.useCallback(m=>{let x=parseInt(m.target.value,10);Number.isFinite(x)||(x=0),x<0&&(x=0),e(w=>({...w,tokens:x}));const{elementId:y}=n();r(w=>({...w,places:w.places.map(E=>E.id===y?{...E,tokens:x}:E)})),i()},[n,r,i,e]),f=z.useCallback(()=>{const m=t.valueTokensInput.trim(),{elementId:x}=n();if(!m){r(w=>({...w,places:w.places.map(E=>E.id===x?{...E,valueTokens:[],tokens:0}:E)})),i();return}const y=l(m);r(w=>{const E={...w,places:w.places.map(_=>_.id===x?{..._,valueTokens:y,tokens:y.length}:_)};return dl(E,s,c)}),i()},[t.valueTokensInput,n,s,l,r,i,c]),h=z.useCallback(m=>Array.isArray(m.valueTokens)?s5(m.valueTokens):"",[]);return{handleTokensChange:u,handleValueTokensBlur:f,serializeTokensFromElement:h}},P_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,validateBindings:l,showInferredTypes:c})=>{const u=z.useCallback(m=>{const x=parseInt(m.target.value,10)||1;e(w=>({...w,weight:x}));const{elementId:y}=n();r(w=>({...w,arcs:w.arcs.map(E=>E.id===y?{...E,weight:x}:E)})),i()},[n,r,i,e]),f=z.useCallback(()=>{const m=t.bindingsInput.trim();e(_=>({..._,bindingError:null}));const{elementId:x}=n();if(!m){r(_=>({..._,arcs:_.arcs.map(S=>S.id===x?{...S,bindings:[]}:S)})),i();return}const{ok:y,bindings:w,error:E}=l(m);if(!y){e(_=>({..._,bindingError:E}));return}r(_=>({..._,arcs:_.arcs.map(S=>S.id===x?{...S,bindings:w}:S)})),i(),r(_=>{const S={..._,arcs:_.arcs.map(C=>C.id===x?{...C,bindings:w}:C)};return dl(S,s,c)}),i()},[t.bindingsInput,n,s,r,e,i,l,c]),h=z.useCallback((m,x)=>m!=="arc"||!Array.isArray(x.bindings)?"":x.bindings.map(y=>{const w=String(y||"");return/^true$/i.test(w)?"T":/^false$/i.test(w)?"F":r5(w)}).join(", "),[]);return{handleWeightChange:u,handleBindingsBlur:f,serializeBindingsFromElement:h}},N_=({formValues:t,setFormValues:e,getElementInfo:n,setElements:r,updateHistory:i,netMode:s,showInferredTypes:l})=>({handleGuardBlur:z.useCallback(()=>{const u=t.guardText.trim();e(h=>({...h,guardError:null}));const{elementId:f}=n();if(!u){r(h=>({...h,transitions:h.transitions.map(m=>m.id===f?{...m,guard:""}:m)})),i();return}try{xo(u,Rt),r(h=>({...h,transitions:h.transitions.map(m=>m.id===f?{...m,guard:u}:m)})),i(),r(h=>{const m={...h,transitions:h.transitions.map(x=>x.id===f?{...x,guard:u}:x)};return dl(m,s,l)}),i()}catch(h){e(m=>({...m,guardError:`Invalid guard: ${h.message}`}))}},[t.guardText,n,s,r,e,i,l])}),M_=({elements:t,netMode:e,setElements:n,updateHistory:r,showInferredTypes:i})=>{const s=i??!0,l=z.useCallback(u=>{if(!s||!(t!=null&&t.places)||!(t!=null&&t.arcs)||e!=="algebraic-int")return;const f=t.places.find(y=>y.id===u);if(!f||!f.valueTokens||f.valueTokens.length===0)return;const h=Ja(f.valueTokens[f.valueTokens.length-1]),x=t.arcs.filter(y=>y.source===u).reduce((y,w)=>{if(!Array.isArray(w.bindings)||w.bindings.length===0)return y;const E=w.bindings[0];if(!E||!s&&E.includes(":"))return y;const _=E.match(/\b[a-z][a-zA-Z0-9_]*\b/g);if(!_)return y;const S=new Map;if(_.forEach(g=>{["true","false","and","or","not"].includes(g)||S.set(g,h)}),S.size===0)return y;const C=Hu(E,S,null,{overwrite:s});return C!==E&&y.push({arcId:w.id,newBinding:C}),y},[]);x.length!==0&&(n(y=>({...y,arcs:y.arcs.map(w=>{const E=x.find(_=>_.arcId===w.id);return E?{...w,bindings:[E.newBinding]}:w})})),r())},[t,e,n,r,s]),c=z.useCallback(()=>{if(!s)return;const u=dl(t,e,s);u!==t&&(n(u),r())},[t,e,n,r,s]);return{inferTypesForPlace:l,performGlobalTypeInference:c}};function A_({selectedElement:t,elements:e,setElements:n,updateHistory:r,netMode:i,showInferredTypes:s=!0}){const[l,c]=z.useState({label:"",tokens:0,weight:1,valueTokensInput:"",bindingsInput:"",bindingError:null,guardText:"",guardError:null}),{parseValueTokensInput:u}=C_(),{validateBindings:f}=T_(),h=z.useCallback(()=>{if(!t)return{elementId:"",elementType:""};const T=t.id||t.element&&t.element.id||"",N=t.type||T.split("-")[0];return{elementId:T,elementType:N}},[t]),{handleTokensChange:m,handleValueTokensBlur:x,serializeTokensFromElement:y}=b_({formValues:l,setFormValues:c,getElementInfo:h,setElements:n,updateHistory:r,netMode:i,parseValueTokensInput:u,showInferredTypes:s}),{handleWeightChange:w,handleBindingsBlur:E,serializeBindingsFromElement:_}=P_({formValues:l,setFormValues:c,getElementInfo:h,setElements:n,updateHistory:r,netMode:i,validateBindings:f,showInferredTypes:s}),{handleGuardBlur:S}=N_({formValues:l,setFormValues:c,getElementInfo:h,setElements:n,updateHistory:r,netMode:i,showInferredTypes:s}),C=E_({getElementInfo:h,setElements:n,updateHistory:r,setFormValues:c}),{inferTypesForPlace:g,performGlobalTypeInference:k}=M_({elements:e,netMode:i,setElements:n,updateHistory:r,showInferredTypes:s});return z.useEffect(()=>{if(!t)return;const{elementType:T}=h(),N=T==="transition"?String(t.guard||"").replace(/\btrue\b/gi,"T").replace(/\bfalse\b/gi,"F"):"";c(L=>({...L,label:t.label||"",tokens:t.tokens||0,weight:t.weight!==void 0?t.weight:1,valueTokensInput:y(t),bindingsInput:_(T,t),guardText:N}))},[t,h,y,_,c]),{formValues:l,setFormValues:c,handleLabelChange:C,handleTokensChange:m,handleWeightChange:w,handleValueTokensBlur:x,handleBindingsBlur:E,handleGuardBlur:S,inferTypesForPlace:g,performGlobalTypeInference:k,getElementInfo:h}}const I_=({selectedElement:t,elements:e,setElements:n,updateHistory:r,simulationSettings:i})=>{const s=z.useContext(og)||{};s.enabledTransitionIds,s.isSimulatorReady;const l=(i==null?void 0:i.netMode)||"pt",c=!!(i!=null&&i.showInferredTypes),{formValues:u,setFormValues:f,handleLabelChange:h,handleTokensChange:m,handleWeightChange:x,handleValueTokensBlur:y,handleBindingsBlur:w,handleGuardBlur:E,getElementInfo:_}=A_({selectedElement:t,elements:e,setElements:n,updateHistory:r,netMode:l,showInferredTypes:c});if(!t)return null;const{elementType:S}=_();return P.jsxs("div",{className:"properties-panel w-full px-4 py-2 overflow-y-auto mx-0",children:[P.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Properties"}),P.jsxs("div",{className:"mb-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Label"}),P.jsx("input",{type:"text",value:u.label,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"P1, P2, etc."})]}),t&&S==="place"&&P.jsx(__,{mode:l,tokens:u.tokens,valueTokensInput:u.valueTokensInput,onTokensChange:m,onValueTokensChange:C=>f(g=>({...g,valueTokensInput:C.target.value})),onValueTokensBlur:y}),t&&S==="arc"&&P.jsx(S_,{mode:l,weight:u.weight,bindingsInput:u.bindingsInput,bindingError:u.bindingError,onWeightChange:x,onBindingsChange:C=>f(g=>({...g,bindingsInput:C.target.value})),onBindingsBlur:w}),t&&S==="transition"&&l==="algebraic-int"&&P.jsx(k_,{guardText:u.guardText,guardError:u.guardError,onGuardChange:C=>f(g=>({...g,guardText:C.target.value})),onGuardBlur:E})]})},L_=({enabledTransitions:t,isLoading:e,isOpen:n,onClose:r,onFire:i})=>n?P.jsxs("div",{"data-testid":"enabled-transitions",className:"enabled-transitions-panel mt-4 p-4 bg-gray-50 border border-gray-200 rounded-md",children:[P.jsxs("div",{className:"flex justify-between items-center mb-3",children:[P.jsx("h3",{className:"text-md font-semibold",children:"Enabled Transitions"}),P.jsx("span",{onClick:r,role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),r&&r())},className:"text-gray-500 hover:text-gray-800 cursor-pointer select-none","aria-label":"Close enabled transitions panel",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e?P.jsx("p",{className:"text-gray-500",children:"Loading..."}):t.length===0?P.jsx("p",{className:"text-gray-500",children:"No enabled transitions"}):P.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-64 overflow-y-auto pr-1",children:t.map(s=>P.jsx("button",{type:"button",className:"flex items-center text-left hover:bg-gray-100 rounded px-1 py-0.5",onClick:()=>i&&i(s.id),"data-testid":`enabled-${s.label||s.id}`,title:s.label||s.id,children:P.jsx("span",{className:"font-medium",children:s.label||s.id.substring(11,17)})},s.id))})]}):null,R_=({elements:t,enabledTransitionIds:e})=>{const{handleFireTransition:n,netMode:r}=qt(),[i,s]=z.useState(!1),[l,c]=z.useState(!1);return P.jsxs("div",{className:"pt-4 mt-4 px-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Petri Net"}),P.jsxs("div",{className:"mb-4 pl-1",children:[P.jsxs("div",{className:"flex justify-between items-center mb-2",children:[P.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Current Markings"}),P.jsxs("button",{"data-testid":"toggle-markings",className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm flex items-center space-x-1 transition-colors",onClick:()=>s(!i),children:[P.jsx("span",{children:i?"Hide":"Show"}),P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})]}),i&&P.jsx("div",{"data-testid":"current-marking",className:"markings-panel p-3 bg-gray-50 border border-gray-200 rounded-md",children:(t.places||[]).length===0?P.jsx("p",{className:"text-gray-500 text-sm",children:"No places defined"}):P.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto pr-1",children:(t.places||[]).filter(u=>r==="algebraic-int"?(Array.isArray(u.valueTokens)?u.valueTokens:[]).length>0:!0).map(u=>{const f=u.label||u.name||u.id.substring(6,12),h=u.tokens||0,m=Array.isArray(u.valueTokens)?u.valueTokens:[],x=r==="algebraic-int"&&Array.isArray(u.valueTokens),y=x?s5(m):"";return P.jsxs("div",{className:"flex items-start text-sm",children:[P.jsx("span",{className:"font-medium text-gray-800 mr-2 truncate",title:f,children:f}),x?P.jsx("div",{className:"flex-1 text-gray-800 bg-purple-50 border border-purple-200 rounded px-2 py-1 whitespace-pre-wrap break-words overflow-visible",title:y,children:y||"[]"}):P.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-purple-100 text-purple-800 border border-purple-200 font-semibold min-w-[2rem] justify-center",children:h})]},u.id)})})})]}),P.jsxs("div",{className:"mb-2 pl-1",children:[P.jsxs("div",{className:"flex justify-between items-center mb-2",children:[P.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Enabled Transitions"}),P.jsxs("button",{"data-testid":"show-enabled-transitions",className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm flex items-center space-x-1 transition-colors",onClick:()=>c(!l),children:[P.jsx("span",{children:l?"Hide":"Show"}),P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})]}),l&&P.jsx(L_,{isOpen:!0,enabledTransitions:(e||[]).map(u=>{const f=(t.transitions||[]).find(h=>h.id===u);return{id:u,label:f&&(f.label||f.name)||u}}),isLoading:!1,onClose:()=>c(!1),onFire:u=>n&&n(u)})]})]})};const Yy=({stats:t,onDismiss:e})=>{if(!t)return null;const n=r=>{if(r<1e3)return`${r}ms`;const i=Math.floor(r/1e3),s=Math.floor(i/60),l=i%60;return s>0?`${s}m ${l}s`:`${i}s`};return P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:P.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md mx-4",children:[P.jsxs("div",{className:"flex items-center mb-4",children:[P.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3",children:P.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),P.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Simulation Complete"})]}),P.jsxs("div",{className:"space-y-3 mb-6",children:[P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-gray-600",children:"Duration:"}),P.jsx("span",{className:"font-medium text-gray-900",children:n(t.elapsedMs)})]}),P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsx("span",{className:"text-gray-600",children:"Transitions Fired:"}),P.jsx("span",{className:"font-medium text-gray-900",children:t.transitionsFired})]})]}),P.jsx("div",{className:"flex justify-end",children:P.jsx("button",{onClick:e,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"OK"})})]})})},F_=({isMobile:t=!1})=>{const{isContinuousSimulating:e,isRunning:n,enabledTransitionIds:r,simulationError:i,isSimulatorReady:s,stepSimulation:l,startContinuousSimulation:c,startRunSimulation:u,stopAllSimulations:f,completionStats:h,dismissCompletionDialog:m}=qt(),[x,y]=z.useState(!1),[w,E]=z.useState(!1),_=e||n,S=s&&r.length>0,C=S?"opacity-100":"opacity-50";z.useEffect(()=>{_&&y(!0)},[_]);const g=()=>{E(!0),setTimeout(()=>{y(!1),E(!1)},200)},k=()=>{E(!1),y(!0)};if(t){const T=i&&P.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-full mb-2 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg text-xs whitespace-nowrap z-50",children:i}),N=({onClick:L,className:A=""})=>P.jsx("button",{onClick:L,className:`flex flex-col items-center justify-center cursor-pointer transition-all hover:opacity-70 py-1 ${A}`,title:"Tap to expand/collapse",children:P.jsxs("div",{className:"flex flex-col gap-0.5",children:[P.jsx("div",{className:"w-6 h-0.5 bg-gray-400 rounded-full"}),P.jsx("div",{className:"w-6 h-0.5 bg-gray-400 rounded-full"}),P.jsx("div",{className:"w-6 h-0.5 bg-gray-400 rounded-full"})]})});return P.jsxs(P.Fragment,{children:[P.jsxs("div",{"data-testid":"simulation-manager-mobile",className:`fixed bottom-4 left-1/2 transform -translate-x-1/2 z-40 transition-all duration-200 ease-out ${C}`,children:[T,!x&&!w&&P.jsx("div",{className:`bg-white/95 backdrop-blur-md rounded-full px-3 py-1.5 shadow-2xl border border-gray-200/50 flex items-center justify-center transition-all duration-200 ease-out ${S?"":"opacity-60"}`,children:P.jsx(N,{onClick:k})}),(x||w)&&_&&P.jsxs("div",{className:`bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-200/50 flex flex-col items-center ${x&&!w?"animate-slide-up":w?"animate-slide-down":""}`,children:[P.jsx("div",{className:"w-full flex justify-center pt-1.5 pb-0.5",children:P.jsx(N,{onClick:g})}),P.jsxs("div",{className:"flex items-center gap-3 px-4 pb-2",children:[n&&P.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[P.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full sim-pulse-strong"}),P.jsx("span",{className:"text-xs font-medium",children:"Running"})]}),P.jsx("button",{"data-testid":"sim-stop-mobile",className:"bg-red-600 text-white rounded-full p-3 hover:bg-red-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!0}catch{}f()},disabled:!_,title:"Stop simulation",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("rect",{x:"7",y:"7",width:"10",height:"10"})})})]})]}),(x||w)&&!_&&P.jsxs("div",{className:`bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl border border-gray-200/50 flex flex-col items-center ${x&&!w?"animate-slide-up":w?"animate-slide-down":""} ${S?"":"opacity-60"}`,children:[P.jsx("div",{className:"w-full flex justify-center pt-1.5 pb-0.5",children:P.jsx(N,{onClick:g})}),P.jsxs("div",{className:"flex items-center gap-2 px-3 pb-2",children:[P.jsx("button",{"data-testid":"sim-step-mobile",className:"bg-blue-600 text-white rounded-full p-3 hover:bg-blue-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:l,disabled:!s||r.length===0,title:"Step forward",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),P.jsx("button",{"data-testid":"sim-simulate-mobile",className:"bg-green-600 text-white rounded-full p-3 hover:bg-green-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:c,disabled:!s||r.length===0,title:"Simulate with animation",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})}),P.jsx("button",{"data-testid":"sim-run-mobile",className:"bg-yellow-600 text-white rounded-full p-3 hover:bg-yellow-700 disabled:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!1}catch{}u()},disabled:!s||r.length===0,title:"Run to completion",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7"})})})]})]})]}),P.jsx(Yy,{stats:h,onDismiss:m})]})}return P.jsxs("div",{"data-testid":"simulation-manager",className:"simulation-manager w-full px-4 py-2 mx-0",children:[P.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Simulation"}),i&&P.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4",children:i}),P.jsxs("div",{className:"bg-gray-200 p-3 rounded-lg shadow-lg border border-gray-300",children:[P.jsxs("div",{className:"flex items-center justify-between space-x-3 mb-3",children:[P.jsxs("button",{"data-testid":"sim-step",className:"flex-1 h-12 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:l,disabled:!s||_||r.length===0,title:"Execute one step forward",children:[P.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),P.jsx("span",{className:"text-xs font-bold",children:"Step"})]}),P.jsxs("button",{"data-testid":"sim-simulate",className:"flex-1 h-12 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:c,disabled:!s||_||r.length===0,title:"Simulate with animation",children:[P.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("path",{fillRule:"evenodd",d:"M10 18V6l8 6-8 6z",clipRule:"evenodd"})})}),P.jsx("span",{className:"text-xs font-bold",children:"Simulate"})]}),P.jsxs("button",{"data-testid":"sim-run",className:"flex-1 h-12 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:bg-gray-400 flex flex-col items-center justify-center transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!1}catch{}u()},disabled:!s||_||r.length===0,title:"Run to completion",children:[P.jsx("div",{style:{height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7"})})}),P.jsx("span",{className:"text-xs font-bold",children:"Run"})]})]}),P.jsx("div",{children:P.jsxs("button",{"data-testid":"sim-stop",className:"w-full h-10 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 flex items-center justify-center space-x-2 transition-all shadow-md",onClick:()=>{try{window.__PETRI_NET_CANCEL_RUN__=!0}catch{}f()},disabled:!_,title:"Stop simulation or run",children:[P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:P.jsx("rect",{x:"7",y:"7",width:"10",height:"10"})}),P.jsx("span",{className:"text-sm font-bold",children:"STOP"})]})}),n&&P.jsx("div",{className:"mt-2 flex items-center justify-center",children:P.jsxs("span",{className:"inline-flex items-center space-x-1 text-green-600",children:[P.jsx("span",{className:"w-4 h-4 bg-green-500 rounded-full sim-pulse-strong"}),P.jsx("span",{className:"font-medium text-sm",children:"Simulation running..."})]})})]}),P.jsx(Yy,{stats:h,onDismiss:m})]})},j_=({isOpen:t,onClose:e})=>{const{z3Settings:n,setZ3Settings:r}=qt(),[i,s]=z.useState(0),[l,c]=z.useState(3e5),[u,f]=z.useState(!0),[h,m]=z.useState(1e4);z.useEffect(()=>{t&&(s(Number((n==null?void 0:n.poolSize)??0)),c(Number((n==null?void 0:n.idleTimeoutMs)??3e5)),f(!!((n==null?void 0:n.prewarmOnAlgebraicMode)??!0)),m(Number((n==null?void 0:n.solverTimeoutMs)??1e4)))},[t,n]);const x=()=>{const y={poolSize:Math.max(0,Number(i)||0),idleTimeoutMs:Math.max(1e3,Number(l)||3e5),prewarmOnAlgebraicMode:!!u,solverTimeoutMs:Math.max(100,Number(h)||1e4)};try{typeof window<"u"&&zr(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url).then(w=>w.setZ3WorkerConfig(y)).catch(()=>{})}catch{}try{r(y)}catch{}e==null||e()};return t?P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:P.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4",children:[P.jsxs("div",{className:"flex justify-between items-center mb-4",children:[P.jsx("h2",{className:"text-xl font-semibold",children:"Z3 Settings"}),P.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:""})]}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Worker Pool"}),P.jsx("div",{className:"space-y-3",children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"Pool size (0 = on-demand)"}),P.jsx("input",{type:"number",min:0,max:8,value:i,onChange:y=>s(y.target.value),className:"w-24 border rounded px-2 py-1 text-sm"})]})})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lifecycle"}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"idleTimeoutMs"}),P.jsx("input",{type:"number",min:1e3,max:36e5,step:1e3,value:l,onChange:y=>c(y.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:u,onChange:y=>f(y.target.checked),className:"mr-2"}),"Pre-warm when switching to Algebraic mode"]}),P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"Solver timeout (ms)"}),P.jsx("input",{type:"number",min:100,max:6e4,step:100,value:h,onChange:y=>m(y.target.value),className:"w-28 border rounded px-2 py-1 text-sm"})]})]})]}),P.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-3",children:[P.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-1",children:"Notes"}),P.jsxs("ul",{className:"text-xs text-purple-700 space-y-1",children:[P.jsx("li",{children:" Pool size 0 keeps workers off until a batch run forces 8 workers"}),P.jsx("li",{children:" Idle timeout trims the pool back to the configured size after bursts"}),P.jsx("li",{children:" Pre-warm hides first-use latency when switching to algebraic-int"}),P.jsx("li",{children:" Solver timeout applies to boolean predicate checks (headless runs benefit from a shorter timeout)"})]})]})]}),P.jsxs("div",{className:"mt-6 flex justify-end",children:[P.jsx("button",{onClick:e,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors mr-2",children:"Cancel"}),P.jsx("button",{onClick:x,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:"Save"})]})]})}):null},fa=2e5,O_=({isOpen:t,onClose:e})=>{const{simulatorCore:n,simulationSettings:r,handleSaveSettings:i,elements:s,z3Settings:l,setZ3Settings:c}=qt(),[u,f]=z.useState("single"),[h,m]=z.useState(!1),[x,y]=z.useState(fa),[w,E]=z.useState(!1),[_,S]=z.useState("pt"),[C,g]=z.useState(!1),[k,T]=z.useState(!1),[N,L]=z.useState(!1),[A,R]=z.useState(!1),[M,I]=z.useState(!1);z.useEffect(()=>{var B,D,$;if(t){try{if(n){const Z=n.getSimulationMode?n.getSimulationMode():"single";f(Z)}}catch(Z){he.warn("Could not get current simulation mode:",Z)}const X=Number((r==null?void 0:r.maxIterations)??fa),F=!!(r!=null&&r.limitIterations);E(F);const U=Number.isFinite(X)&&X>0?Math.max(1,Math.min(1e6,Math.floor(X))):fa;y(U);const G=(r==null?void 0:r.netMode)||"pt";S(G);const K=!!(r!=null&&r.batchMode);R(K);const Q=!!(K||r!=null&&r.useNonVisualRun);L(Q),I(!!(r!=null&&r.showInferredTypes)),K&&u!=="maximal"&&O("maximal");try{const Z=(((B=s==null?void 0:s.places)==null?void 0:B.length)||0)>0||(((D=s==null?void 0:s.transitions)==null?void 0:D.length)||0)>0||((($=s==null?void 0:s.arcs)==null?void 0:$.length)||0)>0;g(!!Z)}catch{g(!1)}}},[t,n,r]);const O=async B=>{if(!n||!n.setSimulationMode){f(B);return}m(!0);try{await n.setSimulationMode(B),f(B),he.info("Simulation mode changed to:",B)}catch(D){he.error("Failed to change simulation mode:",D),f(u)}finally{m(!1)}},W=()=>{const B=!!w,D=Math.max(1,Math.min(1e6,Math.floor(Number(x)||fa)));i({...r,maxIterations:B?D:fa,limitIterations:B,netMode:_,useNonVisualRun:A?!0:N,batchMode:A,showInferredTypes:M}),e==null||e()};return t?P.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:[P.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4 max-h-[90vh] flex flex-col",children:[P.jsxs("div",{className:"flex justify-between items-center mb-4",children:[P.jsx("h2",{className:"text-xl font-semibold",children:"Simulation Settings"}),P.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold","data-testid":"settings-close",children:""})]}),P.jsxs("div",{className:"space-y-4 overflow-y-auto flex-1 pr-2",children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Limits"}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("div",{className:"text-sm",children:"Max iterations"}),P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx("input",{type:"number",min:1,max:1e6,value:x,onChange:B=>y(B.target.value),disabled:!w,className:"w-24 border rounded px-2 py-1 text-sm disabled:bg-gray-100"}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:w,onChange:B=>{const D=B.target.checked;E(D),D&&(!Number.isFinite(Number(x))||Number(x)<=0)&&y(100)},className:"mr-1"}),"Limit iterations"]})]})]}),!w&&P.jsx("div",{className:"text-xs text-gray-600",children:"Default runs allow up to 200,000 steps when this option is unchecked."})]})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Run Options"}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:A?!0:N,onChange:B=>{const D=B.target.checked;L(D)},disabled:A,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Use non-visual execution for Run"})," - No per-step animations"]})]}),P.jsxs("label",{className:"flex items-center text-sm mt-2",children:[P.jsx("input",{type:"checkbox",checked:A,onChange:B=>{const D=B.target.checked;if(R(D),D){L(!0),O("maximal");try{c($=>{const X=$?{...$}:l?{...l}:{};return Number(X.poolSize||0)>=8?X:{...X,poolSize:8}})}catch{}}},className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Batch mode"})," - Always headless, keeps background worker active"]})]}),A&&P.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Batch mode forces non-visual execution and reuses the simulation worker after the first run."})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type Annotations"}),P.jsxs("label",{className:"flex items-center text-sm",children:[P.jsx("input",{type:"checkbox",checked:M,onChange:B=>I(B.target.checked),className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Show inferred variable types"}),"  Display automatically inferred types in guards and bindings"]})]}),P.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"When off, only manually annotated types remain visible so expressions stay concise."})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulation Mode"}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"simulationMode",value:"single",checked:u==="single",onChange:B=>O(B.target.value),disabled:h,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Single Transition"})," - Fire one enabled transition at random"]})]}),P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"simulationMode",value:"maximal",checked:u==="maximal",onChange:B=>O(B.target.value),disabled:h,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Maximal Concurrent"})," - Fire all non-conflicting enabled transitions simultaneously"]})]})]})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Net Type"}),P.jsxs("div",{className:"space-y-2",children:[P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"netMode",value:"pt",checked:_==="pt",onChange:B=>S(B.target.value),disabled:C,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"P/T Net"})," - Classic place/transition nets with counts"]})]}),P.jsxs("label",{className:"flex items-center",children:[P.jsx("input",{type:"radio",name:"netMode",value:"algebraic-int",checked:_==="algebraic-int",onChange:B=>S(B.target.value),disabled:C,className:"mr-2"}),P.jsxs("span",{className:"text-sm",children:[P.jsx("strong",{children:"Algebraic (Integer)"})," - Integer tokens with guard and term labels"]})]}),C&&P.jsx("div",{className:"text-xs text-gray-600",children:"Net type is locked while the canvas has elements. Clear the canvas to switch."})]})]}),h&&P.jsx("div",{className:"text-center text-sm text-gray-600",children:"Updating simulation mode..."})]}),P.jsxs("div",{className:"mt-6 pt-4 flex justify-end border-t border-gray-200",children:[P.jsx("button",{onClick:()=>T(!0),className:"px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition-colors mr-auto",children:"Z3 Settings"}),P.jsx("button",{onClick:e,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors mr-2","data-testid":"settings-cancel",children:"Cancel"}),P.jsx("button",{onClick:W,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors","data-testid":"settings-save",children:"Save"})]})]}),k&&P.jsx(j_,{isOpen:k,onClose:()=>T(!1)})]}):null};var P5={exports:{}},Xc={},Cc={},Pe={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object globalThis]")}t.glob=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.20",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return t.Konva.angleDeg?i*e:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isTransforming(){var i;return(i=t.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(i){t.glob.Konva=i}};const r=i=>{t.Konva[i.prototype.getClassName()]=i};t._registerNode=r,t.Konva._injectGlobal(t.Konva)})(Pe);var at={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=Pe;class n{constructor(k=[1,0,0,1,0,0]){this.dirty=!1,this.m=k&&k.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(k){k.m[0]=this.m[0],k.m[1]=this.m[1],k.m[2]=this.m[2],k.m[3]=this.m[3],k.m[4]=this.m[4],k.m[5]=this.m[5]}point(k){const T=this.m;return{x:T[0]*k.x+T[2]*k.y+T[4],y:T[1]*k.x+T[3]*k.y+T[5]}}translate(k,T){return this.m[4]+=this.m[0]*k+this.m[2]*T,this.m[5]+=this.m[1]*k+this.m[3]*T,this}scale(k,T){return this.m[0]*=k,this.m[1]*=k,this.m[2]*=T,this.m[3]*=T,this}rotate(k){const T=Math.cos(k),N=Math.sin(k),L=this.m[0]*T+this.m[2]*N,A=this.m[1]*T+this.m[3]*N,R=this.m[0]*-N+this.m[2]*T,M=this.m[1]*-N+this.m[3]*T;return this.m[0]=L,this.m[1]=A,this.m[2]=R,this.m[3]=M,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(k,T){const N=this.m[0]+this.m[2]*T,L=this.m[1]+this.m[3]*T,A=this.m[2]+this.m[0]*k,R=this.m[3]+this.m[1]*k;return this.m[0]=N,this.m[1]=L,this.m[2]=A,this.m[3]=R,this}multiply(k){const T=this.m[0]*k.m[0]+this.m[2]*k.m[1],N=this.m[1]*k.m[0]+this.m[3]*k.m[1],L=this.m[0]*k.m[2]+this.m[2]*k.m[3],A=this.m[1]*k.m[2]+this.m[3]*k.m[3],R=this.m[0]*k.m[4]+this.m[2]*k.m[5]+this.m[4],M=this.m[1]*k.m[4]+this.m[3]*k.m[5]+this.m[5];return this.m[0]=T,this.m[1]=N,this.m[2]=L,this.m[3]=A,this.m[4]=R,this.m[5]=M,this}invert(){const k=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),T=this.m[3]*k,N=-this.m[1]*k,L=-this.m[2]*k,A=this.m[0]*k,R=k*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=k*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=T,this.m[1]=N,this.m[2]=L,this.m[3]=A,this.m[4]=R,this.m[5]=M,this}getMatrix(){return this.m}decompose(){const k=this.m[0],T=this.m[1],N=this.m[2],L=this.m[3],A=this.m[4],R=this.m[5],M=k*L-T*N,I={x:A,y:R,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(k!=0||T!=0){const O=Math.sqrt(k*k+T*T);I.rotation=T>0?Math.acos(k/O):-Math.acos(k/O),I.scaleX=O,I.scaleY=M/O,I.skewX=(k*N+T*L)/M,I.skewY=0}else if(N!=0||L!=0){const O=Math.sqrt(N*N+L*L);I.rotation=Math.PI/2-(L>0?Math.acos(-N/O):-Math.acos(N/O)),I.scaleX=M/O,I.scaleY=O,I.skewX=0,I.skewY=(k*N+T*L)/M}return I.rotation=t.Util._getRotation(I.rotation),I}}t.Transform=n;const r="[object Array]",i="[object Number]",s="[object String]",l="[object Boolean]",c=Math.PI/180,u=180/Math.PI,f="#",h="",m="0",x="Konva warning: ",y="Konva error: ",w="rgb(",E={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},_=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let S=[];const C=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(g){setTimeout(g,60)};t.Util={_isElement(g){return!!(g&&g.nodeType==1)},_isFunction(g){return!!(g&&g.constructor&&g.call&&g.apply)},_isPlainObject(g){return!!g&&g.constructor===Object},_isArray(g){return Object.prototype.toString.call(g)===r},_isNumber(g){return Object.prototype.toString.call(g)===i&&!isNaN(g)&&isFinite(g)},_isString(g){return Object.prototype.toString.call(g)===s},_isBoolean(g){return Object.prototype.toString.call(g)===l},isObject(g){return g instanceof Object},isValidSelector(g){if(typeof g!="string")return!1;const k=g[0];return k==="#"||k==="."||k===k.toUpperCase()},_sign(g){return g===0||g>0?1:-1},requestAnimFrame(g){S.push(g),S.length===1&&C(function(){const k=S;S=[],k.forEach(function(T){T()})})},createCanvasElement(){const g=document.createElement("canvas");try{g.style=g.style||{}}catch{}return g},createImageElement(){return document.createElement("img")},_isInDocument(g){for(;g=g.parentNode;)if(g==document)return!0;return!1},_urlToImage(g,k){const T=t.Util.createImageElement();T.onload=function(){k(T)},T.src=g},_rgbToHex(g,k,T){return((1<<24)+(g<<16)+(k<<8)+T).toString(16).slice(1)},_hexToRgb(g){g=g.replace(f,h);const k=parseInt(g,16);return{r:k>>16&255,g:k>>8&255,b:k&255}},getRandomColor(){let g=(Math.random()*16777215<<0).toString(16);for(;g.length<6;)g=m+g;return f+g},getRGB(g){let k;return g in E?(k=E[g],{r:k[0],g:k[1],b:k[2]}):g[0]===f?this._hexToRgb(g.substring(1)):g.substr(0,4)===w?(k=_.exec(g.replace(/ /g,"")),{r:parseInt(k[1],10),g:parseInt(k[2],10),b:parseInt(k[3],10)}):{r:0,g:0,b:0}},colorToRGBA(g){return g=g||"black",t.Util._namedColorToRBA(g)||t.Util._hex3ColorToRGBA(g)||t.Util._hex4ColorToRGBA(g)||t.Util._hex6ColorToRGBA(g)||t.Util._hex8ColorToRGBA(g)||t.Util._rgbColorToRGBA(g)||t.Util._rgbaColorToRGBA(g)||t.Util._hslColorToRGBA(g)},_namedColorToRBA(g){const k=E[g.toLowerCase()];return k?{r:k[0],g:k[1],b:k[2],a:1}:null},_rgbColorToRGBA(g){if(g.indexOf("rgb(")===0){g=g.match(/rgb\(([^)]+)\)/)[1];const k=g.split(/ *, */).map(Number);return{r:k[0],g:k[1],b:k[2],a:1}}},_rgbaColorToRGBA(g){if(g.indexOf("rgba(")===0){g=g.match(/rgba\(([^)]+)\)/)[1];const k=g.split(/ *, */).map((T,N)=>T.slice(-1)==="%"?N===3?parseInt(T)/100:parseInt(T)/100*255:Number(T));return{r:k[0],g:k[1],b:k[2],a:k[3]}}},_hex8ColorToRGBA(g){if(g[0]==="#"&&g.length===9)return{r:parseInt(g.slice(1,3),16),g:parseInt(g.slice(3,5),16),b:parseInt(g.slice(5,7),16),a:parseInt(g.slice(7,9),16)/255}},_hex6ColorToRGBA(g){if(g[0]==="#"&&g.length===7)return{r:parseInt(g.slice(1,3),16),g:parseInt(g.slice(3,5),16),b:parseInt(g.slice(5,7),16),a:1}},_hex4ColorToRGBA(g){if(g[0]==="#"&&g.length===5)return{r:parseInt(g[1]+g[1],16),g:parseInt(g[2]+g[2],16),b:parseInt(g[3]+g[3],16),a:parseInt(g[4]+g[4],16)/255}},_hex3ColorToRGBA(g){if(g[0]==="#"&&g.length===4)return{r:parseInt(g[1]+g[1],16),g:parseInt(g[2]+g[2],16),b:parseInt(g[3]+g[3],16),a:1}},_hslColorToRGBA(g){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(g)){const[k,...T]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(g),N=Number(T[0])/360,L=Number(T[1])/100,A=Number(T[2])/100;let R,M,I;if(L===0)return I=A*255,{r:Math.round(I),g:Math.round(I),b:Math.round(I),a:1};A<.5?R=A*(1+L):R=A+L-A*L;const O=2*A-R,W=[0,0,0];for(let B=0;B<3;B++)M=N+1/3*-(B-1),M<0&&M++,M>1&&M--,6*M<1?I=O+(R-O)*6*M:2*M<1?I=R:3*M<2?I=O+(R-O)*(2/3-M)*6:I=O,W[B]=I*255;return{r:Math.round(W[0]),g:Math.round(W[1]),b:Math.round(W[2]),a:1}}},haveIntersection(g,k){return!(k.x>g.x+g.width||k.x+k.width<g.x||k.y>g.y+g.height||k.y+k.height<g.y)},cloneObject(g){const k={};for(const T in g)this._isPlainObject(g[T])?k[T]=this.cloneObject(g[T]):this._isArray(g[T])?k[T]=this.cloneArray(g[T]):k[T]=g[T];return k},cloneArray(g){return g.slice(0)},degToRad(g){return g*c},radToDeg(g){return g*u},_degToRad(g){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(g)},_radToDeg(g){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(g)},_getRotation(g){return e.Konva.angleDeg?t.Util.radToDeg(g):g},_capitalize(g){return g.charAt(0).toUpperCase()+g.slice(1)},throw(g){throw new Error(y+g)},error(g){console.error(y+g)},warn(g){e.Konva.showWarnings&&console.warn(x+g)},each(g,k){for(const T in g)k(T,g[T])},_inRange(g,k,T){return k<=g&&g<T},_getProjectionToSegment(g,k,T,N,L,A){let R,M,I;const O=(g-T)*(g-T)+(k-N)*(k-N);if(O==0)R=g,M=k,I=(L-T)*(L-T)+(A-N)*(A-N);else{const W=((L-g)*(T-g)+(A-k)*(N-k))/O;W<0?(R=g,M=k,I=(g-L)*(g-L)+(k-A)*(k-A)):W>1?(R=T,M=N,I=(T-L)*(T-L)+(N-A)*(N-A)):(R=g+W*(T-g),M=k+W*(N-k),I=(R-L)*(R-L)+(M-A)*(M-A))}return[R,M,I]},_getProjectionToLine(g,k,T){const N=t.Util.cloneObject(g);let L=Number.MAX_VALUE;return k.forEach(function(A,R){if(!T&&R===k.length-1)return;const M=k[(R+1)%k.length],I=t.Util._getProjectionToSegment(A.x,A.y,M.x,M.y,g.x,g.y),O=I[0],W=I[1],B=I[2];B<L&&(N.x=O,N.y=W,L=B)}),N},_prepareArrayForTween(g,k,T){const N=[],L=[];if(g.length>k.length){const R=k;k=g,g=R}for(let R=0;R<g.length;R+=2)N.push({x:g[R],y:g[R+1]});for(let R=0;R<k.length;R+=2)L.push({x:k[R],y:k[R+1]});const A=[];return L.forEach(function(R){const M=t.Util._getProjectionToLine(R,N,T);A.push(M.x),A.push(M.y)}),A},_prepareToStringify(g){let k;g.visitedByCircularReferenceRemoval=!0;for(const T in g)if(g.hasOwnProperty(T)&&g[T]&&typeof g[T]=="object"){if(k=Object.getOwnPropertyDescriptor(g,T),g[T].visitedByCircularReferenceRemoval||t.Util._isElement(g[T]))if(k.configurable)delete g[T];else return null;else if(t.Util._prepareToStringify(g[T])===null)if(k.configurable)delete g[T];else return null}return delete g.visitedByCircularReferenceRemoval,g},_assign(g,k){for(const T in k)g[T]=k[T];return g},_getFirstPointerId(g){return g.touches?g.changedTouches[0].identifier:g.pointerId||999},releaseCanvas(...g){e.Konva.releaseCanvasOnDestroy&&g.forEach(k=>{k.width=0,k.height=0})},drawRoundedRectPath(g,k,T,N){let L=0,A=0,R=0,M=0;typeof N=="number"?L=A=R=M=Math.min(N,k/2,T/2):(L=Math.min(N[0]||0,k/2,T/2),A=Math.min(N[1]||0,k/2,T/2),M=Math.min(N[2]||0,k/2,T/2),R=Math.min(N[3]||0,k/2,T/2)),g.moveTo(L,0),g.lineTo(k-A,0),g.arc(k-A,A,A,Math.PI*3/2,0,!1),g.lineTo(k,T-M),g.arc(k-M,T-M,M,0,Math.PI/2,!1),g.lineTo(R,T),g.arc(R,T-R,R,Math.PI/2,Math.PI,!1),g.lineTo(0,L),g.arc(L,L,L,Math.PI,Math.PI*3/2,!1)}}})(at);var tt={},Me={},we={};Object.defineProperty(we,"__esModule",{value:!0});we.RGBComponent=D_;we.alphaComponent=z_;we.getNumberValidator=B_;we.getNumberOrArrayOfNumbersValidator=U_;we.getNumberOrAutoValidator=G_;we.getStringValidator=V_;we.getStringOrGradientValidator=W_;we.getFunctionValidator=$_;we.getNumberArrayValidator=H_;we.getBooleanValidator=X_;we.getComponentValidator=Y_;const Hr=Pe,ut=at;function Xr(t){return ut.Util._isString(t)?'"'+t+'"':Object.prototype.toString.call(t)==="[object Number]"||ut.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}function D_(t){return t>255?255:t<0?0:Math.round(t)}function z_(t){return t>1?1:t<1e-4?1e-4:t}function B_(){if(Hr.Konva.isUnminified)return function(t,e){return ut.Util._isNumber(t)||ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function U_(t){if(Hr.Konva.isUnminified)return function(e,n){let r=ut.Util._isNumber(e),i=ut.Util._isArray(e)&&e.length==t;return!r&&!i&&ut.Util.warn(Xr(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function G_(){if(Hr.Konva.isUnminified)return function(t,e){var n=ut.Util._isNumber(t),r=t==="auto";return n||r||ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function V_(){if(Hr.Konva.isUnminified)return function(t,e){return ut.Util._isString(t)||ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function W_(){if(Hr.Konva.isUnminified)return function(t,e){const n=ut.Util._isString(t),r=Object.prototype.toString.call(t)==="[object CanvasGradient]"||t&&t.addColorStop;return n||r||ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function $_(){if(Hr.Konva.isUnminified)return function(t,e){return ut.Util._isFunction(t)||ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),t}}function H_(){if(Hr.Konva.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(ut.Util._isArray(t)?t.forEach(function(r){ut.Util._isNumber(r)||ut.Util.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}function X_(){if(Hr.Konva.isUnminified)return function(t,e){var n=t===!0||t===!1;return n||ut.Util.warn(Xr(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}function Y_(t){if(Hr.Konva.isUnminified)return function(e,n){return e==null||ut.Util.isObject(e)||ut.Util.warn(Xr(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=at,n=we,r="get",i="set";t.Factory={addGetterSetter(s,l,c,u,f){t.Factory.addGetter(s,l,c),t.Factory.addSetter(s,l,u,f),t.Factory.addOverloadedGetterSetter(s,l)},addGetter(s,l,c){var u=r+e.Util._capitalize(l);s.prototype[u]=s.prototype[u]||function(){const f=this.attrs[l];return f===void 0?c:f}},addSetter(s,l,c,u){var f=i+e.Util._capitalize(l);s.prototype[f]||t.Factory.overWriteSetter(s,l,c,u)},overWriteSetter(s,l,c,u){var f=i+e.Util._capitalize(l);s.prototype[f]=function(h){return c&&h!==void 0&&h!==null&&(h=c.call(this,h,l)),this._setAttr(l,h),u&&u.call(this),this}},addComponentsGetterSetter(s,l,c,u,f){const h=c.length,m=e.Util._capitalize,x=r+m(l),y=i+m(l);s.prototype[x]=function(){const E={};for(let _=0;_<h;_++){const S=c[_];E[S]=this.getAttr(l+m(S))}return E};const w=(0,n.getComponentValidator)(c);s.prototype[y]=function(E){const _=this.attrs[l];u&&(E=u.call(this,E,l)),w&&w.call(this,E,l);for(const S in E)E.hasOwnProperty(S)&&this._setAttr(l+m(S),E[S]);return E||c.forEach(S=>{this._setAttr(l+m(S),void 0)}),this._fireChangeEvent(l,_,E),f&&f.call(this),this},t.Factory.addOverloadedGetterSetter(s,l)},addOverloadedGetterSetter(s,l){var c=e.Util._capitalize(l),u=i+c,f=r+c;s.prototype[l]=function(){return arguments.length?(this[u](arguments[0]),this):this[f]()}},addDeprecatedGetterSetter(s,l,c,u){e.Util.error("Adding deprecated "+l);const f=r+e.Util._capitalize(l),h=l+" property is deprecated and will be removed soon. Look at Konva change log for more information.";s.prototype[f]=function(){e.Util.error(h);const m=this.attrs[l];return m===void 0?c:m},t.Factory.addSetter(s,l,u,function(){e.Util.error(h)}),t.Factory.addOverloadedGetterSetter(s,l)},backCompat(s,l){e.Util.each(l,function(c,u){const f=s.prototype[u],h=r+e.Util._capitalize(c),m=i+e.Util._capitalize(c);function x(){f.apply(this,arguments),e.Util.error('"'+c+'" method is deprecated and will be removed soon. Use ""'+u+'" instead.')}s.prototype[c]=x,s.prototype[h]=x,s.prototype[m]=x})},afterSetFilter(){this._filterUpToDate=!1}}})(Me);var ir={},Br={};Object.defineProperty(Br,"__esModule",{value:!0});Br.HitContext=Br.SceneContext=Br.Context=void 0;const N5=at,K_=Pe;function Q_(t){const e=[],n=t.length,r=N5.Util;for(let i=0;i<n;i++){let s=t[i];r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s+""),e.push(s)}return e}const Ky=",",Z_="(",q_=")",J_="([",eS="])",tS=";",nS="()",rS="=",Qy=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],iS=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],sS=100;class Yc{constructor(e){this.canvas=e,K_.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,n){let r=this.traceArr,i=r.length,s="",l,c,u,f;for(l=0;l<i;l++)c=r[l],u=c.method,u?(f=c.args,s+=u,e?s+=nS:N5.Util._isArray(f[0])?s+=J_+f.join(Ky)+eS:(n&&(f=f.map(h=>typeof h=="number"?Math.floor(h):h)),s+=Z_+f.join(Ky)+q_)):(s+=c.property,e||(s+=rS+c.val)),s+=tS;return s}clearTrace(){this.traceArr=[]}_trace(e){let n=this.traceArr,r;n.push(e),r=n.length,r>=sS&&n.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const n=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,n.getWidth()/n.pixelRatio,n.getHeight()/n.pixelRatio)}_applyLineCap(e){const n=e.attrs.lineCap;n&&this.setAttr("lineCap",n)}_applyOpacity(e){const n=e.getAbsoluteOpacity();n!==1&&this.setAttr("globalAlpha",n)}_applyLineJoin(e){const n=e.attrs.lineJoin;n&&this.setAttr("lineJoin",n)}setAttr(e,n){this._context[e]=n}arc(e,n,r,i,s,l){this._context.arc(e,n,r,i,s,l)}arcTo(e,n,r,i,s){this._context.arcTo(e,n,r,i,s)}beginPath(){this._context.beginPath()}bezierCurveTo(e,n,r,i,s,l){this._context.bezierCurveTo(e,n,r,i,s,l)}clearRect(e,n,r,i){this._context.clearRect(e,n,r,i)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,n){const r=arguments;if(r.length===2)return this._context.createImageData(e,n);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,n,r,i){return this._context.createLinearGradient(e,n,r,i)}createPattern(e,n){return this._context.createPattern(e,n)}createRadialGradient(e,n,r,i,s,l){return this._context.createRadialGradient(e,n,r,i,s,l)}drawImage(e,n,r,i,s,l,c,u,f){const h=arguments,m=this._context;h.length===3?m.drawImage(e,n,r):h.length===5?m.drawImage(e,n,r,i,s):h.length===9&&m.drawImage(e,n,r,i,s,l,c,u,f)}ellipse(e,n,r,i,s,l,c,u){this._context.ellipse(e,n,r,i,s,l,c,u)}isPointInPath(e,n,r,i){return r?this._context.isPointInPath(r,e,n,i):this._context.isPointInPath(e,n,i)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,n,r,i){this._context.fillRect(e,n,r,i)}strokeRect(e,n,r,i){this._context.strokeRect(e,n,r,i)}fillText(e,n,r,i){i?this._context.fillText(e,n,r,i):this._context.fillText(e,n,r)}measureText(e){return this._context.measureText(e)}getImageData(e,n,r,i){return this._context.getImageData(e,n,r,i)}lineTo(e,n){this._context.lineTo(e,n)}moveTo(e,n){this._context.moveTo(e,n)}rect(e,n,r,i){this._context.rect(e,n,r,i)}roundRect(e,n,r,i,s){this._context.roundRect(e,n,r,i,s)}putImageData(e,n,r){this._context.putImageData(e,n,r)}quadraticCurveTo(e,n,r,i){this._context.quadraticCurveTo(e,n,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,n){this._context.scale(e,n)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,n,r,i,s,l){this._context.setTransform(e,n,r,i,s,l)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,n,r,i){this._context.strokeText(e,n,r,i)}transform(e,n,r,i,s,l){this._context.transform(e,n,r,i,s,l)}translate(e,n){this._context.translate(e,n)}_enableTrace(){let e=this,n=Qy.length,r=this.setAttr,i,s;const l=function(c){let u=e[c],f;e[c]=function(){return s=Q_(Array.prototype.slice.call(arguments,0)),f=u.apply(e,arguments),e._trace({method:c,args:s}),f}};for(i=0;i<n;i++)l(Qy[i]);e.setAttr=function(){r.apply(e,arguments);const c=arguments[0];let u=arguments[1];(c==="shadowOffsetX"||c==="shadowOffsetY"||c==="shadowBlur")&&(u=u/this.canvas.getPixelRatio()),e._trace({property:c,val:u})}}_applyGlobalCompositeOperation(e){const n=e.attrs.globalCompositeOperation;!n||n==="source-over"||this.setAttr("globalCompositeOperation",n)}}Br.Context=Yc;iS.forEach(function(t){Object.defineProperty(Yc.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class oS extends Yc{constructor(e,{willReadFrequently:n=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:n})}_fillColor(e){const n=e.fill();this.setAttr("fillStyle",n),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const n=e._getLinearGradient();n&&(this.setAttr("fillStyle",n),e._fillFunc(this))}_fillRadialGradient(e){const n=e._getRadialGradient();n&&(this.setAttr("fillStyle",n),e._fillFunc(this))}_fill(e){const n=e.fill(),r=e.getFillPriority();if(n&&r==="color"){this._fillColor(e);return}const i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}const s=e.getFillLinearGradientColorStops();if(s&&r==="linear-gradient"){this._fillLinearGradient(e);return}const l=e.getFillRadialGradientColorStops();if(l&&r==="radial-gradient"){this._fillRadialGradient(e);return}n?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):l&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const n=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(n.x,n.y,r.x,r.y);if(i){for(let l=0;l<i.length;l+=2)s.addColorStop(i[l],i[l+1]);this.setAttr("strokeStyle",s)}}_stroke(e){const n=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e),n&&e.dashEnabled()&&(this.setLineDash(n),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var n,r,i;const s=(n=e.getShadowRGBA())!==null&&n!==void 0?n:"black",l=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,c=(i=e.getShadowOffset())!==null&&i!==void 0?i:{x:0,y:0},u=e.getAbsoluteScale(),f=this.canvas.getPixelRatio(),h=u.x*f,m=u.y*f;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",l*Math.min(Math.abs(h),Math.abs(m))),this.setAttr("shadowOffsetX",c.x*h),this.setAttr("shadowOffsetY",c.y*m)}}Br.SceneContext=oS;class aS extends Yc{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const n=e.getStrokeScaleEnabled();if(!n){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e);const r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),n||this.restore()}}}Br.HitContext=aS;Object.defineProperty(ir,"__esModule",{value:!0});ir.HitCanvas=ir.SceneCanvas=ir.Canvas=void 0;const Tc=at,M5=Br,A5=Pe;let Pu;function lS(){if(Pu)return Pu;const t=Tc.Util.createCanvasElement(),e=t.getContext("2d");return Pu=function(){const n=A5.Konva._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return n/r}(),Tc.Util.releaseCanvas(t),Pu}class ag{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||A5.Konva.pixelRatio||lS();this.pixelRatio=r,this._canvas=Tc.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const n=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/n,this.getHeight()/n)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const n=this.pixelRatio;this.getContext()._context.scale(n,n)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const n=this.pixelRatio;this.getContext()._context.scale(n,n)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,n){this.setWidth(e||0),this.setHeight(n||0)}toDataURL(e,n){try{return this._canvas.toDataURL(e,n)}catch{try{return this._canvas.toDataURL()}catch(i){return Tc.Util.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}ir.Canvas=ag;class uS extends ag{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new M5.SceneContext(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}ir.SceneCanvas=uS;class cS extends ag{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new M5.HitContext(this),this.setSize(e.width,e.height)}}ir.HitCanvas=cS;var Kc={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=Pe,n=at;t.DD={get isDragging(){let r=!1;return t.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(r=!0)}),r},justDragged:!1,get node(){let r;return t.DD._dragElements.forEach(i=>{r=i.node}),r},_dragElements:new Map,_drag(r){const i=[];t.DD._dragElements.forEach((s,l)=>{const{node:c}=s,u=c.getStage();u.setPointersPositions(r),s.pointerId===void 0&&(s.pointerId=n.Util._getFirstPointerId(r));const f=u._changedPointerPositions.find(h=>h.id===s.pointerId);if(f){if(s.dragStatus!=="dragging"){const h=c.dragDistance();if(Math.max(Math.abs(f.x-s.startPointerPos.x),Math.abs(f.y-s.startPointerPos.y))<h||(c.startDrag({evt:r}),!c.isDragging()))return}c._setDragPosition(r,s),i.push(c)}}),i.forEach(s=>{s.fire("dragmove",{type:"dragmove",target:s,evt:r},!0)})},_endDragBefore(r){const i=[];t.DD._dragElements.forEach(s=>{const{node:l}=s,c=l.getStage();if(r&&c.setPointersPositions(r),!c._changedPointerPositions.find(h=>h.id===s.pointerId))return;(s.dragStatus==="dragging"||s.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,s.dragStatus="stopped");const f=s.node.getLayer()||s.node instanceof e.Konva.Stage&&s.node;f&&i.indexOf(f)===-1&&i.push(f)}),i.forEach(s=>{s.draw()})},_endDragAfter(r){t.DD._dragElements.forEach((i,s)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:r},!0),i.dragStatus!=="dragging"&&t.DD._dragElements.delete(s)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))})(Kc);Object.defineProperty(tt,"__esModule",{value:!0});tt.Node=void 0;const Le=at,fl=Me,ha=ir,ui=Pe,Ln=Kc,ht=we,Yu="absoluteOpacity",Nu="allEventListeners",Lr="absoluteTransform",Zy="absoluteScale",Ki="canvas",dS="Change",fS="children",hS="konva",q0="listening",qy="mouseenter",Jy="mouseleave",e2="set",t2="Shape",Ku=" ",n2="stage",ci="transform",pS="Stage",J0="visible",gS=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Ku);let mS=1;class _e{constructor(e){this._id=mS++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===ci||e===Lr)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,n){let r=this._cache.get(e);return(r===void 0||(e===ci||e===Lr)&&r.dirty===!0)&&(r=n.call(this),this._cache.set(e,r)),r}_calculate(e,n,r){if(!this._attachedDepsListeners.get(e)){const i=n.map(s=>s+"Change.konva").join(Ku);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(Ki)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Lr&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Ki)){const{scene:e,filter:n,hit:r}=this._cache.get(Ki);Le.Util.releaseCanvas(e,n,r),this._cache.delete(Ki)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const n=e||{};let r={};(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let i=Math.ceil(n.width||r.width),s=Math.ceil(n.height||r.height),l=n.pixelRatio,c=n.x===void 0?Math.floor(r.x):n.x,u=n.y===void 0?Math.floor(r.y):n.y,f=n.offset||0,h=n.drawBorder||!1,m=n.hitCanvasPixelRatio||1;if(!i||!s){Le.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const x=Math.abs(Math.round(r.x)-c)>.5?1:0,y=Math.abs(Math.round(r.y)-u)>.5?1:0;i+=f*2+x,s+=f*2+y,c-=f,u-=f;const w=new ha.SceneCanvas({pixelRatio:l,width:i,height:s}),E=new ha.SceneCanvas({pixelRatio:l,width:0,height:0,willReadFrequently:!0}),_=new ha.HitCanvas({pixelRatio:m,width:i,height:s}),S=w.getContext(),C=_.getContext();return _.isCache=!0,w.isCache=!0,this._cache.delete(Ki),this._filterUpToDate=!1,n.imageSmoothingEnabled===!1&&(w.getContext()._context.imageSmoothingEnabled=!1,E.getContext()._context.imageSmoothingEnabled=!1),S.save(),C.save(),S.translate(-c,-u),C.translate(-c,-u),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Yu),this._clearSelfAndDescendantCache(Zy),this.drawScene(w,this),this.drawHit(_,this),this._isUnderCache=!1,S.restore(),C.restore(),h&&(S.save(),S.beginPath(),S.rect(0,0,i,s),S.closePath(),S.setAttr("strokeStyle","red"),S.setAttr("lineWidth",5),S.stroke(),S.restore()),this._cache.set(Ki,{scene:w,filter:E,hit:_,x:c,y:u}),this._requestDraw(),this}isCached(){return this._cache.has(Ki)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,n){const r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let i=1/0,s=1/0,l=-1/0,c=-1/0;const u=this.getAbsoluteTransform(n);return r.forEach(function(f){const h=u.point(f);i===void 0&&(i=l=h.x,s=c=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),c=Math.max(c,h.y)}),{x:i,y:s,width:l-i,height:c-s}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const n=this._getCanvasCache();e.translate(n.x,n.y);const r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){const n=this._getCanvasCache(),r=n.hit;e.save(),e.translate(n.x,n.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),n=this._getCanvasCache(),r=n.scene,i=n.filter,s=i.getContext(),l,c,u,f;if(e){if(!this._filterUpToDate){const h=r.pixelRatio;i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(l=e.length,s.clear(),s.drawImage(r._canvas,0,0,r.getWidth()/h,r.getHeight()/h),c=s.getImageData(0,0,i.getWidth(),i.getHeight()),u=0;u<l;u++){if(f=e[u],typeof f!="function"){Le.Util.error("Filter should be type of function, but got "+typeof f+" instead. Please check correct filters");continue}f.call(this,c),s.putImageData(c,0,0)}}catch(m){Le.Util.error("Unable to apply filter. "+m.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return i}return r}on(e,n){if(this._cache&&this._cache.delete(Nu),arguments.length===3)return this._delegate.apply(this,arguments);let r=e.split(Ku),i=r.length,s,l,c,u,f;for(s=0;s<i;s++)l=r[s],c=l.split("."),u=c[0],f=c[1]||"",this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:f,handler:n});return this}off(e,n){let r=(e||"").split(Ku),i=r.length,s,l,c,u,f,h;if(this._cache&&this._cache.delete(Nu),!e)for(l in this.eventListeners)this._off(l);for(s=0;s<i;s++)if(c=r[s],u=c.split("."),f=u[0],h=u[1],f)this.eventListeners[f]&&this._off(f,h,n);else for(l in this.eventListeners)this._off(l,h,n);return this}dispatchEvent(e){const n={target:this,type:e.type,evt:e};return this.fire(e.type,n),this}addEventListener(e,n){return this.on(e,function(r){n.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,n,r){const i=this;this.on(e,function(s){const l=s.target.findAncestors(n,!0,i);for(let c=0;c<l.length;c++)s=Le.Util.cloneObject(s),s.currentTarget=l[c],r.call(l[c],s)})}remove(){return this.isDragging()&&this.stopDrag(),Ln.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Lr),this._clearSelfAndDescendantCache(Yu),this._clearSelfAndDescendantCache(Zy),this._clearSelfAndDescendantCache(n2),this._clearSelfAndDescendantCache(J0),this._clearSelfAndDescendantCache(q0)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const n="get"+Le.Util._capitalize(e);return Le.Util._isFunction(this[n])?this[n]():this.attrs[e]}getAncestors(){let e=this.getParent(),n=[];for(;e;)n.push(e),e=e.getParent();return n}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let n,r;if(!e)return this;for(n in e)n!==fS&&(r=e2+Le.Util._capitalize(n),Le.Util._isFunction(this[r])?this[r](e[n]):this._setAttr(n,e[n]))}),this}isListening(){return this._getCache(q0,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(J0,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,n=!1){if(e)return this._isVisible(e)&&this._isListening(e);const r=this.getLayer();let i=!1;Ln.DD._dragElements.forEach(l=>{l.dragStatus==="dragging"&&(l.node.nodeType==="Stage"||l.node.getLayer()===r)&&(i=!0)});const s=!n&&!ui.Konva.hitOnDragEnabled&&(i||ui.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),n=this,r=0,i,s,l,c;function u(h){for(i=[],s=h.length,l=0;l<s;l++)c=h[l],r++,c.nodeType!==t2&&(i=i.concat(c.getChildren().slice())),c._id===n._id&&(l=s);i.length>0&&i[0].getDepth()<=e&&u(i)}const f=this.getStage();return n.nodeType!==pS&&f&&u(f.getChildren()),r}getDepth(){let e=0,n=this.parent;for(;n;)e++,n=n.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(ci),this._clearSelfAndDescendantCache(Lr)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const n=e.getPointerPosition();if(!n)return null;const r=this.getAbsoluteTransform().copy();return r.invert(),r.point(n)}getAbsolutePosition(e){let n=!1,r=this.parent;for(;r;){if(r.isCached()){n=!0;break}r=r.parent}n&&!e&&(e=!0);const i=this.getAbsoluteTransform(e).getMatrix(),s=new Le.Transform,l=this.offset();return s.m=i.slice(),s.translate(l.x,l.y),s.getTranslation()}setAbsolutePosition(e){const{x:n,y:r,...i}=this._clearTransform();this.attrs.x=n,this.attrs.y=r,this._clearCache(ci);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(e.x,e.y),e={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(i),this.setPosition({x:e.x,y:e.y}),this._clearCache(ci),this._clearSelfAndDescendantCache(Lr),this}_setTransform(e){let n;for(n in e)this.attrs[n]=e[n]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let n=e.x,r=e.y,i=this.x(),s=this.y();return n!==void 0&&(i+=n),r!==void 0&&(s+=r),this.setPosition({x:i,y:s}),this}_eachAncestorReverse(e,n){let r=[],i=this.getParent(),s,l;if(!(n&&n._id===this._id)){for(r.unshift(this);i&&(!n||i._id!==n._id);)r.unshift(i),i=i.parent;for(s=r.length,l=0;l<s;l++)e(r[l])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return Le.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index,n=this.parent.getChildren().length;return e<n-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return Le.Util.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index,n=this.parent.getChildren().length;return e<n-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return Le.Util.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return Le.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return Le.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&Le.Util.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const n=this.index;return this.parent.children.splice(n,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Yu,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const n=this.getParent();return n&&!n._isUnderCache&&(e*=n.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),n,r,i,s,l;const c={attrs:{},className:this.getClassName()};for(n in e)r=e[n],l=Le.Util.isObject(r)&&!Le.Util._isPlainObject(r)&&!Le.Util._isArray(r),!l&&(i=typeof this[n]=="function"&&this[n],delete e[n],s=i?i.call(this):null,e[n]=r,s!==r&&(c.attrs[n]=r));return Le.Util._prepareToStringify(c)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,n,r){const i=[];n&&this._isMatch(e)&&i.push(this);let s=this.parent;for(;s;){if(s===r)return i;s._isMatch(e)&&i.push(s),s=s.parent}return i}isAncestorOf(e){return!1}findAncestor(e,n,r){return this.findAncestors(e,n,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let n=e.replace(/ /g,"").split(","),r=n.length,i,s;for(i=0;i<r;i++)if(s=n[i],Le.Util.isValidSelector(s)||(Le.Util.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Le.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Le.Util.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(n2,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,n={},r){return n.target=n.target||this,r?this._fireAndBubble(e,n):this._fire(e,n),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Lr,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let n;if(e)return n=new Le.Transform,this._eachAncestorReverse(function(r){const i=r.transformsEnabled();i==="all"?n.multiply(r.getTransform()):i==="position"&&n.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),n;{n=this._cache.get(Lr)||new Le.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(n):n.reset();const r=this.transformsEnabled();if(r==="all")n.multiply(this.getTransform());else if(r==="position"){const i=this.attrs.x||0,s=this.attrs.y||0,l=this.attrs.offsetX||0,c=this.attrs.offsetY||0;n.translate(i-l,s-c)}return n.dirty=!1,n}}getAbsoluteScale(e){let n=this;for(;n;)n._isUnderCache&&(e=n),n=n.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(ci,this._getTransform)}_getTransform(){var e,n;const r=this._cache.get(ci)||new Le.Transform;r.reset();const i=this.x(),s=this.y(),l=ui.Konva.getAngle(this.rotation()),c=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,u=(n=this.attrs.scaleY)!==null&&n!==void 0?n:1,f=this.attrs.skewX||0,h=this.attrs.skewY||0,m=this.attrs.offsetX||0,x=this.attrs.offsetY||0;return(i!==0||s!==0)&&r.translate(i,s),l!==0&&r.rotate(l),(f!==0||h!==0)&&r.skew(f,h),(c!==1||u!==1)&&r.scale(c,u),(m!==0||x!==0)&&r.translate(-1*m,-1*x),r.dirty=!1,r}clone(e){let n=Le.Util.cloneObject(this.attrs),r,i,s,l,c;for(r in e)n[r]=e[r];const u=new this.constructor(n);for(r in this.eventListeners)for(i=this.eventListeners[r],s=i.length,l=0;l<s;l++)c=i[l],c.name.indexOf(hS)<0&&(u.eventListeners[r]||(u.eventListeners[r]=[]),u.eventListeners[r].push(c));return u}_toKonvaCanvas(e){e=e||{};const n=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(n.x),s=e.y!==void 0?e.y:Math.floor(n.y),l=e.pixelRatio||1,c=new ha.SceneCanvas({width:e.width||Math.ceil(n.width)||(r?r.width():0),height:e.height||Math.ceil(n.height)||(r?r.height():0),pixelRatio:l}),u=c.getContext(),f=new ha.SceneCanvas({width:c.width/c.pixelRatio+Math.abs(i),height:c.height/c.pixelRatio+Math.abs(s),pixelRatio:c.pixelRatio});return e.imageSmoothingEnabled===!1&&(u._context.imageSmoothingEnabled=!1),u.save(),(i||s)&&u.translate(-1*i,-1*s),this.drawScene(c,void 0,f),u.restore(),c}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};const n=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(n,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((n,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,Le.Util._urlToImage(this.toDataURL(e),function(s){n(s),i==null||i(s)})}catch(i){r(i)}})}toBlob(e){return new Promise((n,r)=>{try{const i=e==null?void 0:e.callback;i&&delete e.callback,this.toCanvas(e).toBlob(s=>{n(s),i==null||i(s)},e==null?void 0:e.mimeType,e==null?void 0:e.quality)}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():ui.Konva.dragDistance}_off(e,n,r){let i=this.eventListeners[e],s,l,c;for(s=0;s<i.length;s++)if(l=i[s].name,c=i[s].handler,(l!=="konva"||n==="konva")&&(!n||l===n)&&(!r||r===c)){if(i.splice(s,1),i.length===0){delete this.eventListeners[e];break}s--}}_fireChangeEvent(e,n,r){this._fire(e+dS,{oldVal:n,newVal:r})}addName(e){if(!this.hasName(e)){const n=this.name(),r=n?n+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const n=this.name();return n?(n||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){const n=(this.name()||"").split(/\s/g),r=n.indexOf(e);return r!==-1&&(n.splice(r,1),this.name(n.join(" "))),this}setAttr(e,n){const r=this[e2+Le.Util._capitalize(e)];return Le.Util._isFunction(r)?r.call(this,n):this._setAttr(e,n),this}_requestDraw(){if(ui.Konva.autoDrawEnabled){const e=this.getLayer()||this.getStage();e==null||e.batchDraw()}}_setAttr(e,n){const r=this.attrs[e];r===n&&!Le.Util.isObject(n)||(n==null?delete this.attrs[e]:this.attrs[e]=n,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,n),this._requestDraw())}_setComponentAttr(e,n,r){let i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][n]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,n,r){if(n&&this.nodeType===t2&&(n.target=this),!((e===qy||e===Jy)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r))){this._fire(e,n);const s=(e===qy||e===Jy)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(n&&!n.cancelBubble||!n)&&this.parent&&this.parent.isListening()&&!s&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,n,r):this._fireAndBubble.call(this.parent,e,n))}}_getProtoListeners(e){var n,r,i;const s=(n=this._cache.get(Nu))!==null&&n!==void 0?n:{};let l=s==null?void 0:s[e];if(l===void 0){l=[];let c=Object.getPrototypeOf(this);for(;c;){const u=(i=(r=c.eventListeners)===null||r===void 0?void 0:r[e])!==null&&i!==void 0?i:[];l.push(...u),c=Object.getPrototypeOf(c)}s[e]=l,this._cache.set(Nu,s)}return l}_fire(e,n){n=n||{},n.currentTarget=this,n.type=e;const r=this._getProtoListeners(e);if(r)for(var i=0;i<r.length;i++)r[i].handler.call(this,n);const s=this.eventListeners[e];if(s)for(var i=0;i<s.length;i++)s[i].handler.call(this,n)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const n=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition();if(!r)return;const s=r._getPointerById(n)||r._changedPointerPositions[0]||i;Ln.DD._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-i.x,y:s.y-i.y},dragStatus:"ready",pointerId:n})}startDrag(e,n=!0){Ln.DD._dragElements.has(this._id)||this._createDragElement(e);const r=Ln.DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},n)}_setDragPosition(e,n){const r=this.getStage()._getPointerById(n.pointerId);if(!r)return;let i={x:r.x-n.offset.x,y:r.y-n.offset.y};const s=this.dragBoundFunc();if(s!==void 0){const l=s.call(this,i,e);l?i=l:Le.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(e){const n=Ln.DD._dragElements.get(this._id);n&&(n.dragStatus="stopped"),Ln.DD._endDragBefore(e),Ln.DD._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=Ln.DD._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||ui.Konva.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let i=!1;Ln.DD._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(i=!0)}),i||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const n=Ln.DD._dragElements.get(this._id),r=n&&n.dragStatus==="dragging",i=n&&n.dragStatus==="ready";r?this.stopDrag():i&&Ln.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const n=this.getStage();if(!n)return!1;const r={x:-e.x,y:-e.y,width:n.width()+2*e.x,height:n.height()+2*e.y};return Le.Util.haveIntersection(r,this.getClientRect())}static create(e,n){return Le.Util._isString(e)&&(e=JSON.parse(e)),this._createNode(e,n)}static _createNode(e,n){let r=_e.prototype.getClassName.call(e),i=e.children,s,l,c;n&&(e.attrs.container=n),ui.Konva[r]||(Le.Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const u=ui.Konva[r];if(s=new u(e.attrs),i)for(l=i.length,c=0;c<l;c++)s.add(_e._createNode(i[c]));return s}}tt.Node=_e;_e.prototype.nodeType="Node";_e.prototype._attrsAffectingSize=[];_e.prototype.eventListeners={};_e.prototype.on.call(_e.prototype,gS,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(ci),this._clearSelfAndDescendantCache(Lr)});_e.prototype.on.call(_e.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(J0)});_e.prototype.on.call(_e.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(q0)});_e.prototype.on.call(_e.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Yu)});const We=fl.Factory.addGetterSetter;We(_e,"zIndex");We(_e,"absolutePosition");We(_e,"position");We(_e,"x",0,(0,ht.getNumberValidator)());We(_e,"y",0,(0,ht.getNumberValidator)());We(_e,"globalCompositeOperation","source-over",(0,ht.getStringValidator)());We(_e,"opacity",1,(0,ht.getNumberValidator)());We(_e,"name","",(0,ht.getStringValidator)());We(_e,"id","",(0,ht.getStringValidator)());We(_e,"rotation",0,(0,ht.getNumberValidator)());fl.Factory.addComponentsGetterSetter(_e,"scale",["x","y"]);We(_e,"scaleX",1,(0,ht.getNumberValidator)());We(_e,"scaleY",1,(0,ht.getNumberValidator)());fl.Factory.addComponentsGetterSetter(_e,"skew",["x","y"]);We(_e,"skewX",0,(0,ht.getNumberValidator)());We(_e,"skewY",0,(0,ht.getNumberValidator)());fl.Factory.addComponentsGetterSetter(_e,"offset",["x","y"]);We(_e,"offsetX",0,(0,ht.getNumberValidator)());We(_e,"offsetY",0,(0,ht.getNumberValidator)());We(_e,"dragDistance",void 0,(0,ht.getNumberValidator)());We(_e,"width",0,(0,ht.getNumberValidator)());We(_e,"height",0,(0,ht.getNumberValidator)());We(_e,"listening",!0,(0,ht.getBooleanValidator)());We(_e,"preventDefault",!0,(0,ht.getBooleanValidator)());We(_e,"filters",void 0,function(t){return this._filterUpToDate=!1,t});We(_e,"visible",!0,(0,ht.getBooleanValidator)());We(_e,"transformsEnabled","all",(0,ht.getStringValidator)());We(_e,"size");We(_e,"dragBoundFunc");We(_e,"draggable",!1,(0,ht.getBooleanValidator)());fl.Factory.backCompat(_e,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var ds={};Object.defineProperty(ds,"__esModule",{value:!0});ds.Container=void 0;const No=Me,Dh=tt,Qc=we;class fs extends Dh.Node{constructor(){super(...arguments),this.children=[]}getChildren(e){if(!e)return this.children||[];const n=this.children||[],r=[];return n.forEach(function(i){e(i)&&r.push(i)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let r=0;r<e.length;r++)this.add(e[r]);return this}const n=e[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const n=this._generalFind(e,!0);return n.length>0?n[0]:void 0}_generalFind(e,n){const r=[];return this._descendants(i=>{const s=i._isMatch(e);return s&&r.push(i),!!(s&&n)}),r}_descendants(e){let n=!1;const r=this.getChildren();for(const i of r){if(n=e(i),n)return!0;if(i.hasChildren()&&(n=i._descendants(e),n))return!0}return!1}toObject(){const e=Dh.Node.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(n=>{e.children.push(n.toObject())}),e}isAncestorOf(e){let n=e.getParent();for(;n;){if(n._id===this._id)return!0;n=n.getParent()}return!1}clone(e){const n=Dh.Node.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){n.add(r.clone())}),n}getAllIntersections(e){const n=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&n.push(r)}),n}_clearSelfAndDescendantCache(e){var n;super._clearSelfAndDescendantCache(e),!this.isCached()&&((n=this.children)===null||n===void 0||n.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(n,r){n.index=r}),this._requestDraw()}drawScene(e,n,r){const i=this.getLayer(),s=e||i&&i.getCanvas(),l=s&&s.getContext(),c=this._getCanvasCache(),u=c&&c.scene,f=s&&s.isCache;if(!this.isVisible()&&!f)return this;if(u){l.save();const h=this.getAbsoluteTransform(n).getMatrix();l.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(l),l.restore()}else this._drawChildren("drawScene",s,n,r);return this}drawHit(e,n){if(!this.shouldDrawHit(n))return this;const r=this.getLayer(),i=e||r&&r.hitCanvas,s=i&&i.getContext(),l=this._getCanvasCache();if(l&&l.hit){s.save();const u=this.getAbsoluteTransform(n).getMatrix();s.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",i,n);return this}_drawChildren(e,n,r,i){var s;const l=n&&n.getContext(),c=this.clipWidth(),u=this.clipHeight(),f=this.clipFunc(),h=typeof c=="number"&&typeof u=="number"||f,m=r===this;if(h){l.save();const y=this.getAbsoluteTransform(r);let w=y.getMatrix();l.transform(w[0],w[1],w[2],w[3],w[4],w[5]),l.beginPath();let E;if(f)E=f.call(this,l,this);else{const _=this.clipX(),S=this.clipY();l.rect(_||0,S||0,c,u)}l.clip.apply(l,E),w=y.copy().invert().getMatrix(),l.transform(w[0],w[1],w[2],w[3],w[4],w[5])}const x=!m&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";x&&(l.save(),l._applyGlobalCompositeOperation(this)),(s=this.children)===null||s===void 0||s.forEach(function(y){y[e](n,r,i)}),x&&l.restore(),h&&l.restore()}getClientRect(e={}){var n;const r=e.skipTransform,i=e.relativeTo;let s,l,c,u,f={x:1/0,y:1/0,width:0,height:0};const h=this;(n=this.children)===null||n===void 0||n.forEach(function(y){if(!y.visible())return;const w=y.getClientRect({relativeTo:h,skipShadow:e.skipShadow,skipStroke:e.skipStroke});w.width===0&&w.height===0||(s===void 0?(s=w.x,l=w.y,c=w.x+w.width,u=w.y+w.height):(s=Math.min(s,w.x),l=Math.min(l,w.y),c=Math.max(c,w.x+w.width),u=Math.max(u,w.y+w.height)))});const m=this.find("Shape");let x=!1;for(let y=0;y<m.length;y++)if(m[y]._isVisible(this)){x=!0;break}return x&&s!==void 0?f={x:s,y:l,width:c-s,height:u-l}:f={x:0,y:0,width:0,height:0},r?f:this._transformedRect(f,i)}}ds.Container=fs;No.Factory.addComponentsGetterSetter(fs,"clip",["x","y","width","height"]);No.Factory.addGetterSetter(fs,"clipX",void 0,(0,Qc.getNumberValidator)());No.Factory.addGetterSetter(fs,"clipY",void 0,(0,Qc.getNumberValidator)());No.Factory.addGetterSetter(fs,"clipWidth",void 0,(0,Qc.getNumberValidator)());No.Factory.addGetterSetter(fs,"clipHeight",void 0,(0,Qc.getNumberValidator)());No.Factory.addGetterSetter(fs,"clipFunc");var I5={},Ii={};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.getCapturedShape=vS;Ii.createEvent=lg;Ii.hasPointerCapture=xS;Ii.setPointerCapture=wS;Ii.releaseCapture=R5;const yS=Pe,el=new Map,L5=yS.Konva._global.PointerEvent!==void 0;function vS(t){return el.get(t)}function lg(t){return{evt:t,pointerId:t.pointerId}}function xS(t,e){return el.get(t)===e}function wS(t,e){R5(t),e.getStage()&&(el.set(t,e),L5&&e._fire("gotpointercapture",lg(new PointerEvent("gotpointercapture"))))}function R5(t,e){const n=el.get(t);if(!n)return;const r=n.getStage();r&&r.content,el.delete(t),L5&&n._fire("lostpointercapture",lg(new PointerEvent("lostpointercapture")))}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=at,n=Me,r=ds,i=Pe,s=ir,l=Kc,c=Pe,u=Ii,f="Stage",h="string",m="px",x="mouseout",y="mouseleave",w="mouseover",E="mouseenter",_="mousemove",S="mousedown",C="mouseup",g="pointermove",k="pointerdown",T="pointerup",N="pointercancel",L="lostpointercapture",A="pointerout",R="pointerleave",M="pointerover",I="pointerenter",O="contextmenu",W="touchstart",B="touchend",D="touchmove",$="touchcancel",X="wheel",F=5,U=[[E,"_pointerenter"],[S,"_pointerdown"],[_,"_pointermove"],[C,"_pointerup"],[y,"_pointerleave"],[W,"_pointerdown"],[D,"_pointermove"],[B,"_pointerup"],[$,"_pointercancel"],[w,"_pointerover"],[X,"_wheel"],[O,"_contextmenu"],[k,"_pointerdown"],[g,"_pointermove"],[T,"_pointerup"],[N,"_pointercancel"],[L,"_lostpointercapture"]],G={mouse:{[A]:x,[R]:y,[M]:w,[I]:E,[g]:_,[k]:S,[T]:C,[N]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[A]:"touchout",[R]:"touchleave",[M]:"touchover",[I]:"touchenter",[g]:D,[k]:W,[T]:B,[N]:$,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[A]:A,[R]:R,[M]:M,[I]:I,[g]:g,[k]:k,[T]:T,[N]:N,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},K=ge=>ge.indexOf("pointer")>=0?"pointer":ge.indexOf("touch")>=0?"touch":"mouse",Q=ge=>{const V=K(ge);if(V==="pointer")return i.Konva.pointerEventsEnabled&&G.pointer;if(V==="touch")return G.touch;if(V==="mouse")return G.mouse};function Z(ge={}){return(ge.clipFunc||ge.clipWidth||ge.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),ge}const se="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class xe extends r.Container{constructor(V){super(Z(V)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Z(this.attrs)}),this._checkVisibility()}_validateAdd(V){const te=V.getType()==="Layer",ae=V.getType()==="FastLayer";te||ae||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const V=this.visible()?"":"none";this.content.style.display=V}setContainer(V){if(typeof V===h){if(V.charAt(0)==="."){const ae=V.slice(1);V=document.getElementsByClassName(ae)[0]}else{var te;V.charAt(0)!=="#"?te=V:te=V.slice(1),V=document.getElementById(te)}if(!V)throw"Can not find container in document with id "+te}return this._setAttr("container",V),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),V.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const V=this.children,te=V.length;for(let ae=0;ae<te;ae++)V[ae].clear();return this}clone(V){return V||(V={}),V.container=typeof document<"u"&&document.createElement("div"),r.Container.prototype.clone.call(this,V)}destroy(){super.destroy();const V=this.content;V&&e.Util._isInDocument(V)&&this.container().removeChild(V);const te=t.stages.indexOf(this);return te>-1&&t.stages.splice(te,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const V=this._pointerPositions[0]||this._changedPointerPositions[0];return V?{x:V.x,y:V.y}:(e.Util.warn(se),null)}_getPointerById(V){return this._pointerPositions.find(te=>te.id===V)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(V){V=V||{},V.x=V.x||0,V.y=V.y||0,V.width=V.width||this.width(),V.height=V.height||this.height();const te=new s.SceneCanvas({width:V.width,height:V.height,pixelRatio:V.pixelRatio||1}),ae=te.getContext()._context,ve=this.children;return(V.x||V.y)&&ae.translate(-1*V.x,-1*V.y),ve.forEach(function(ye){if(!ye.isVisible())return;const ie=ye._toKonvaCanvas(V);ae.drawImage(ie._canvas,V.x,V.y,ie.getWidth()/ie.getPixelRatio(),ie.getHeight()/ie.getPixelRatio())}),te}getIntersection(V){if(!V)return null;const te=this.children,ae=te.length,ve=ae-1;for(let ye=ve;ye>=0;ye--){const ie=te[ye].getIntersection(V);if(ie)return ie}return null}_resizeDOM(){const V=this.width(),te=this.height();this.content&&(this.content.style.width=V+m,this.content.style.height=te+m),this.bufferCanvas.setSize(V,te),this.bufferHitCanvas.setSize(V,te),this.children.forEach(ae=>{ae.setSize({width:V,height:te}),ae.draw()})}add(V,...te){if(arguments.length>1){for(let ve=0;ve<arguments.length;ve++)this.add(arguments[ve]);return this}super.add(V);const ae=this.children.length;return ae>F&&e.Util.warn("The stage has "+ae+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),V.setSize({width:this.width(),height:this.height()}),V.draw(),i.Konva.isBrowser&&this.content.appendChild(V.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(V){return u.hasPointerCapture(V,this)}setPointerCapture(V){u.setPointerCapture(V,this)}releaseCapture(V){u.releaseCapture(V,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&U.forEach(([V,te])=>{this.content.addEventListener(V,ae=>{this[te](ae)},{passive:!1})})}_pointerenter(V){this.setPointersPositions(V);const te=Q(V.type);te&&this._fire(te.pointerenter,{evt:V,target:this,currentTarget:this})}_pointerover(V){this.setPointersPositions(V);const te=Q(V.type);te&&this._fire(te.pointerover,{evt:V,target:this,currentTarget:this})}_getTargetShape(V){let te=this[V+"targetShape"];return te&&!te.getStage()&&(te=null),te}_pointerleave(V){const te=Q(V.type),ae=K(V.type);if(!te)return;this.setPointersPositions(V);const ve=this._getTargetShape(ae),ye=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ve&&ye?(ve._fireAndBubble(te.pointerout,{evt:V}),ve._fireAndBubble(te.pointerleave,{evt:V}),this._fire(te.pointerleave,{evt:V,target:this,currentTarget:this}),this[ae+"targetShape"]=null):ye&&(this._fire(te.pointerleave,{evt:V,target:this,currentTarget:this}),this._fire(te.pointerout,{evt:V,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(V){const te=Q(V.type),ae=K(V.type);if(!te)return;this.setPointersPositions(V);let ve=!1;this._changedPointerPositions.forEach(ye=>{const ie=this.getIntersection(ye);if(l.DD.justDragged=!1,i.Konva["_"+ae+"ListenClick"]=!0,!ie||!ie.isListening()){this[ae+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&ie.setPointerCapture(ye.id),this[ae+"ClickStartShape"]=ie,ie._fireAndBubble(te.pointerdown,{evt:V,pointerId:ye.id}),ve=!0;const oe=V.type.indexOf("touch")>=0;ie.preventDefault()&&V.cancelable&&oe&&V.preventDefault()}),ve||this._fire(te.pointerdown,{evt:V,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(V){const te=Q(V.type),ae=K(V.type);if(!te||(i.Konva.isDragging()&&l.DD.node.preventDefault()&&V.cancelable&&V.preventDefault(),this.setPointersPositions(V),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const ye={};let ie=!1;const oe=this._getTargetShape(ae);this._changedPointerPositions.forEach(Ee=>{const le=u.getCapturedShape(Ee.id)||this.getIntersection(Ee),Se=Ee.id,Ie={evt:V,pointerId:Se},Fe=oe!==le;if(Fe&&oe&&(oe._fireAndBubble(te.pointerout,{...Ie},le),oe._fireAndBubble(te.pointerleave,{...Ie},le)),le){if(ye[le._id])return;ye[le._id]=!0}le&&le.isListening()?(ie=!0,Fe&&(le._fireAndBubble(te.pointerover,{...Ie},oe),le._fireAndBubble(te.pointerenter,{...Ie},oe),this[ae+"targetShape"]=le),le._fireAndBubble(te.pointermove,{...Ie})):oe&&(this._fire(te.pointerover,{evt:V,target:this,currentTarget:this,pointerId:Se}),this[ae+"targetShape"]=null)}),ie||this._fire(te.pointermove,{evt:V,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(V){const te=Q(V.type),ae=K(V.type);if(!te)return;this.setPointersPositions(V);const ve=this[ae+"ClickStartShape"],ye=this[ae+"ClickEndShape"],ie={};let oe=!1;this._changedPointerPositions.forEach(Ee=>{const le=u.getCapturedShape(Ee.id)||this.getIntersection(Ee);if(le){if(le.releaseCapture(Ee.id),ie[le._id])return;ie[le._id]=!0}const Se=Ee.id,Ie={evt:V,pointerId:Se};let Fe=!1;i.Konva["_"+ae+"InDblClickWindow"]?(Fe=!0,clearTimeout(this[ae+"DblTimeout"])):l.DD.justDragged||(i.Konva["_"+ae+"InDblClickWindow"]=!0,clearTimeout(this[ae+"DblTimeout"])),this[ae+"DblTimeout"]=setTimeout(function(){i.Konva["_"+ae+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),le&&le.isListening()?(oe=!0,this[ae+"ClickEndShape"]=le,le._fireAndBubble(te.pointerup,{...Ie}),i.Konva["_"+ae+"ListenClick"]&&ve&&ve===le&&(le._fireAndBubble(te.pointerclick,{...Ie}),Fe&&ye&&ye===le&&le._fireAndBubble(te.pointerdblclick,{...Ie}))):(this[ae+"ClickEndShape"]=null,i.Konva["_"+ae+"ListenClick"]&&this._fire(te.pointerclick,{evt:V,target:this,currentTarget:this,pointerId:Se}),Fe&&this._fire(te.pointerdblclick,{evt:V,target:this,currentTarget:this,pointerId:Se}))}),oe||this._fire(te.pointerup,{evt:V,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+ae+"ListenClick"]=!1,V.cancelable&&ae!=="touch"&&ae!=="pointer"&&V.preventDefault()}_contextmenu(V){this.setPointersPositions(V);const te=this.getIntersection(this.getPointerPosition());te&&te.isListening()?te._fireAndBubble(O,{evt:V}):this._fire(O,{evt:V,target:this,currentTarget:this})}_wheel(V){this.setPointersPositions(V);const te=this.getIntersection(this.getPointerPosition());te&&te.isListening()?te._fireAndBubble(X,{evt:V}):this._fire(X,{evt:V,target:this,currentTarget:this})}_pointercancel(V){this.setPointersPositions(V);const te=u.getCapturedShape(V.pointerId)||this.getIntersection(this.getPointerPosition());te&&te._fireAndBubble(T,u.createEvent(V)),u.releaseCapture(V.pointerId)}_lostpointercapture(V){u.releaseCapture(V.pointerId)}setPointersPositions(V){const te=this._getContentPosition();let ae=null,ve=null;V=V||window.event,V.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(V.touches,ye=>{this._pointerPositions.push({id:ye.identifier,x:(ye.clientX-te.left)/te.scaleX,y:(ye.clientY-te.top)/te.scaleY})}),Array.prototype.forEach.call(V.changedTouches||V.touches,ye=>{this._changedPointerPositions.push({id:ye.identifier,x:(ye.clientX-te.left)/te.scaleX,y:(ye.clientY-te.top)/te.scaleY})})):(ae=(V.clientX-te.left)/te.scaleX,ve=(V.clientY-te.top)/te.scaleY,this.pointerPos={x:ae,y:ve},this._pointerPositions=[{x:ae,y:ve,id:e.Util._getFirstPointerId(V)}],this._changedPointerPositions=[{x:ae,y:ve,id:e.Util._getFirstPointerId(V)}])}_setPointerPosition(V){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(V)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const V=this.content.getBoundingClientRect();return{top:V.top,left:V.left,scaleX:V.width/this.content.clientWidth||1,scaleY:V.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new s.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new s.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const V=this.container();if(!V)throw"Stage has no container. A container is required.";V.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),V.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(V){V.batchDraw()}),this}}t.Stage=xe,xe.prototype.nodeType=f,(0,c._registerNode)(xe),n.Factory.addGetterSetter(xe,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(ge=>{ge.batchDraw()})})})(I5);var hl={},_t={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=Pe,n=at,r=Me,i=tt,s=we,l=Pe,c=Ii,u="hasShadow",f="shadowRGBA",h="patternImage",m="linearGradient",x="radialGradient";let y;function w(){return y||(y=n.Util.createCanvasElement().getContext("2d"),y)}t.shapes={};function E(R){const M=this.attrs.fillRule;M?R.fill(M):R.fill()}function _(R){R.stroke()}function S(R){const M=this.attrs.fillRule;M?R.fill(M):R.fill()}function C(R){R.stroke()}function g(){this._clearCache(u)}function k(){this._clearCache(f)}function T(){this._clearCache(h)}function N(){this._clearCache(m)}function L(){this._clearCache(x)}class A extends i.Node{constructor(M){super(M);let I;for(;I=n.Util.getRandomColor(),!(I&&!(I in t.shapes)););this.colorKey=I,t.shapes[I]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(u,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const I=w().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(I&&I.setTransform){const O=new n.Transform;O.translate(this.fillPatternX(),this.fillPatternY()),O.rotate(e.Konva.getAngle(this.fillPatternRotation())),O.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),O.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const W=O.getMatrix(),B=typeof DOMMatrix>"u"?{a:W[0],b:W[1],c:W[2],d:W[3],e:W[4],f:W[5]}:new DOMMatrix(W);I.setTransform(B)}return I}}_getLinearGradient(){return this._getCache(m,this.__getLinearGradient)}__getLinearGradient(){const M=this.fillLinearGradientColorStops();if(M){const I=w(),O=this.fillLinearGradientStartPoint(),W=this.fillLinearGradientEndPoint(),B=I.createLinearGradient(O.x,O.y,W.x,W.y);for(let D=0;D<M.length;D+=2)B.addColorStop(M[D],M[D+1]);return B}}_getRadialGradient(){return this._getCache(x,this.__getRadialGradient)}__getRadialGradient(){const M=this.fillRadialGradientColorStops();if(M){const I=w(),O=this.fillRadialGradientStartPoint(),W=this.fillRadialGradientEndPoint(),B=I.createRadialGradient(O.x,O.y,this.fillRadialGradientStartRadius(),W.x,W.y,this.fillRadialGradientEndRadius());for(let D=0;D<M.length;D+=2)B.addColorStop(M[D],M[D+1]);return B}}getShadowRGBA(){return this._getCache(f,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const M=n.Util.colorToRGBA(this.shadowColor());if(M)return"rgba("+M.r+","+M.g+","+M.b+","+M.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const M=this.hitStrokeWidth();return M==="auto"?this.hasStroke():this.strokeEnabled()&&!!M}intersects(M){const I=this.getStage();if(!I)return!1;const O=I.bufferHitCanvas;return O.getContext().clear(),this.drawHit(O,void 0,!0),O.context.getImageData(Math.round(M.x),Math.round(M.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(M){var I;if(!((I=this.attrs.perfectDrawEnabled)!==null&&I!==void 0?I:!0))return!1;const W=M||this.hasFill(),B=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(W&&B&&D)return!0;const $=this.hasShadow(),X=this.shadowForStrokeEnabled();return!!(W&&B&&$&&X)}setStrokeHitEnabled(M){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),M?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const M=this.size();return{x:this._centroid?-M.width/2:0,y:this._centroid?-M.height/2:0,width:M.width,height:M.height}}getClientRect(M={}){let I=!1,O=this.getParent();for(;O;){if(O.isCached()){I=!0;break}O=O.getParent()}const W=M.skipTransform,B=M.relativeTo||I&&this.getStage()||void 0,D=this.getSelfRect(),X=!M.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,F=D.width+X,U=D.height+X,G=!M.skipShadow&&this.hasShadow(),K=G?this.shadowOffsetX():0,Q=G?this.shadowOffsetY():0,Z=F+Math.abs(K),se=U+Math.abs(Q),xe=G&&this.shadowBlur()||0,ge=Z+xe*2,V=se+xe*2,te={width:ge,height:V,x:-(X/2+xe)+Math.min(K,0)+D.x,y:-(X/2+xe)+Math.min(Q,0)+D.y};return W?te:this._transformedRect(te,B)}drawScene(M,I,O){const W=this.getLayer();let B=M||W.getCanvas(),D=B.getContext(),$=this._getCanvasCache(),X=this.getSceneFunc(),F=this.hasShadow(),U,G;const K=B.isCache,Q=I===this;if(!this.isVisible()&&!Q)return this;if($){D.save();const se=this.getAbsoluteTransform(I).getMatrix();return D.transform(se[0],se[1],se[2],se[3],se[4],se[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!X)return this;if(D.save(),this._useBufferCanvas()&&!K){U=this.getStage();const se=O||U.bufferCanvas;G=se.getContext(),G.clear(),G.save(),G._applyLineJoin(this);var Z=this.getAbsoluteTransform(I).getMatrix();G.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),X.call(this,G,this),G.restore();const xe=se.pixelRatio;F&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(se._canvas,0,0,se.width/xe,se.height/xe)}else{if(D._applyLineJoin(this),!Q){var Z=this.getAbsoluteTransform(I).getMatrix();D.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}F&&D._applyShadow(this),X.call(this,D,this)}return D.restore(),this}drawHit(M,I,O=!1){if(!this.shouldDrawHit(I,O))return this;const W=this.getLayer(),B=M||W.hitCanvas,D=B&&B.getContext(),$=this.hitFunc()||this.sceneFunc(),X=this._getCanvasCache(),F=X&&X.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),F){D.save();const G=this.getAbsoluteTransform(I).getMatrix();return D.transform(G[0],G[1],G[2],G[3],G[4],G[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!$)return this;if(D.save(),D._applyLineJoin(this),!(this===I)){const G=this.getAbsoluteTransform(I).getMatrix();D.transform(G[0],G[1],G[2],G[3],G[4],G[5])}return $.call(this,D,this),D.restore(),this}drawHitFromCache(M=0){const I=this._getCanvasCache(),O=this._getCachedSceneCanvas(),W=I.hit,B=W.getContext(),D=W.getWidth(),$=W.getHeight();B.clear(),B.drawImage(O._canvas,0,0,D,$);try{const X=B.getImageData(0,0,D,$),F=X.data,U=F.length,G=n.Util._hexToRgb(this.colorKey);for(let K=0;K<U;K+=4)F[K+3]>M?(F[K]=G.r,F[K+1]=G.g,F[K+2]=G.b,F[K+3]=255):F[K+3]=0;B.putImageData(X,0,0)}catch(X){n.Util.error("Unable to draw hit graph from cached scene canvas. "+X.message)}return this}hasPointerCapture(M){return c.hasPointerCapture(M,this)}setPointerCapture(M){c.setPointerCapture(M,this)}releaseCapture(M){c.releaseCapture(M,this)}}t.Shape=A,A.prototype._fillFunc=E,A.prototype._strokeFunc=_,A.prototype._fillFuncHit=S,A.prototype._strokeFuncHit=C,A.prototype._centroid=!1,A.prototype.nodeType="Shape",(0,l._registerNode)(A),A.prototype.eventListeners={},A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",g),A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",k),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",T),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",N),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",L),r.Factory.addGetterSetter(A,"stroke",void 0,(0,s.getStringOrGradientValidator)()),r.Factory.addGetterSetter(A,"strokeWidth",2,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillAfterStrokeEnabled",!1),r.Factory.addGetterSetter(A,"hitStrokeWidth","auto",(0,s.getNumberOrAutoValidator)()),r.Factory.addGetterSetter(A,"strokeHitEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(A,"perfectDrawEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(A,"shadowForStrokeEnabled",!0,(0,s.getBooleanValidator)()),r.Factory.addGetterSetter(A,"lineJoin"),r.Factory.addGetterSetter(A,"lineCap"),r.Factory.addGetterSetter(A,"sceneFunc"),r.Factory.addGetterSetter(A,"hitFunc"),r.Factory.addGetterSetter(A,"dash"),r.Factory.addGetterSetter(A,"dashOffset",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowColor",void 0,(0,s.getStringValidator)()),r.Factory.addGetterSetter(A,"shadowBlur",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowOpacity",1,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"shadowOffset",["x","y"]),r.Factory.addGetterSetter(A,"shadowOffsetX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowOffsetY",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternImage"),r.Factory.addGetterSetter(A,"fill",void 0,(0,s.getStringOrGradientValidator)()),r.Factory.addGetterSetter(A,"fillPatternX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternY",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillLinearGradientColorStops"),r.Factory.addGetterSetter(A,"strokeLinearGradientColorStops"),r.Factory.addGetterSetter(A,"fillRadialGradientStartRadius",0),r.Factory.addGetterSetter(A,"fillRadialGradientEndRadius",0),r.Factory.addGetterSetter(A,"fillRadialGradientColorStops"),r.Factory.addGetterSetter(A,"fillPatternRepeat","repeat"),r.Factory.addGetterSetter(A,"fillEnabled",!0),r.Factory.addGetterSetter(A,"strokeEnabled",!0),r.Factory.addGetterSetter(A,"shadowEnabled",!0),r.Factory.addGetterSetter(A,"dashEnabled",!0),r.Factory.addGetterSetter(A,"strokeScaleEnabled",!0),r.Factory.addGetterSetter(A,"fillPriority","color"),r.Factory.addComponentsGetterSetter(A,"fillPatternOffset",["x","y"]),r.Factory.addGetterSetter(A,"fillPatternOffsetX",0,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternOffsetY",0,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"fillPatternScale",["x","y"]),r.Factory.addGetterSetter(A,"fillPatternScaleX",1,(0,s.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternScaleY",1,(0,s.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"fillLinearGradientStartPoint",["x","y"]),r.Factory.addComponentsGetterSetter(A,"strokeLinearGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillLinearGradientStartPointX",0),r.Factory.addGetterSetter(A,"strokeLinearGradientStartPointX",0),r.Factory.addGetterSetter(A,"fillLinearGradientStartPointY",0),r.Factory.addGetterSetter(A,"strokeLinearGradientStartPointY",0),r.Factory.addComponentsGetterSetter(A,"fillLinearGradientEndPoint",["x","y"]),r.Factory.addComponentsGetterSetter(A,"strokeLinearGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillLinearGradientEndPointX",0),r.Factory.addGetterSetter(A,"strokeLinearGradientEndPointX",0),r.Factory.addGetterSetter(A,"fillLinearGradientEndPointY",0),r.Factory.addGetterSetter(A,"strokeLinearGradientEndPointY",0),r.Factory.addComponentsGetterSetter(A,"fillRadialGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillRadialGradientStartPointX",0),r.Factory.addGetterSetter(A,"fillRadialGradientStartPointY",0),r.Factory.addComponentsGetterSetter(A,"fillRadialGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillRadialGradientEndPointX",0),r.Factory.addGetterSetter(A,"fillRadialGradientEndPointY",0),r.Factory.addGetterSetter(A,"fillPatternRotation",0),r.Factory.addGetterSetter(A,"fillRule",void 0,(0,s.getStringValidator)()),r.Factory.backCompat(A,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(_t);Object.defineProperty(hl,"__esModule",{value:!0});hl.Layer=void 0;const Ir=at,zh=ds,Bs=tt,ug=Me,r2=ir,_S=we,SS=_t,kS=Pe,CS="#",TS="beforeDraw",ES="draw",F5=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],bS=F5.length;let Mo=class extends zh.Container{constructor(e){super(e),this.canvas=new r2.SceneCanvas,this.hitCanvas=new r2.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const n=this.getStage();return n&&n.content&&(n.content.removeChild(this.getNativeCanvasElement()),e<n.children.length-1?n.content.insertBefore(this.getNativeCanvasElement(),n.children[e+1].getCanvas()._canvas):n.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Bs.Node.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!Bs.Node.prototype.moveUp.call(this))return!1;const n=this.getStage();return!n||!n.content?!1:(n.content.removeChild(this.getNativeCanvasElement()),this.index<n.children.length-1?n.content.insertBefore(this.getNativeCanvasElement(),n.children[this.index+1].getCanvas()._canvas):n.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(Bs.Node.prototype.moveDown.call(this)){const e=this.getStage();if(e){const n=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),n[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Bs.Node.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const n=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),n[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return Bs.Node.prototype.remove.call(this),e&&e.parentNode&&Ir.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:n}){return this.canvas.setSize(e,n),this.hitCanvas.setSize(e,n),this._setSmoothEnabled(),this}_validateAdd(e){const n=e.getType();n!=="Group"&&n!=="Shape"&&Ir.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e=e||{},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),Bs.Node.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Ir.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Ir.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Ir.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let n=1,r=!1;for(;;){for(let i=0;i<bS;i++){const s=F5[i],l=this._getIntersection({x:e.x+s.x*n,y:e.y+s.y*n}),c=l.shape;if(c)return c;if(r=!!l.antialiased,!l.antialiased)break}if(r)n+=1;else return null}}_getIntersection(e){const n=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*n),Math.round(e.y*n),1,1).data,i=r[3];if(i===255){const s=Ir.Util._rgbToHex(r[0],r[1],r[2]),l=SS.shapes[CS+s];return l?{shape:l}:{antialiased:!0}}else if(i>0)return{antialiased:!0};return{}}drawScene(e,n){const r=this.getLayer(),i=e||r&&r.getCanvas();return this._fire(TS,{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),zh.Container.prototype.drawScene.call(this,i,n),this._fire(ES,{node:this}),this}drawHit(e,n){const r=this.getLayer(),i=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),zh.Container.prototype.drawHit.call(this,i,n),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){Ir.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return Ir.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return Ir.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};hl.Layer=Mo;Mo.prototype.nodeType="Layer";(0,kS._registerNode)(Mo);ug.Factory.addGetterSetter(Mo,"imageSmoothingEnabled",!0);ug.Factory.addGetterSetter(Mo,"clearBeforeDraw",!0);ug.Factory.addGetterSetter(Mo,"hitGraphEnabled",!0,(0,_S.getBooleanValidator)());var Zc={};Object.defineProperty(Zc,"__esModule",{value:!0});Zc.FastLayer=void 0;const PS=at,NS=hl,MS=Pe;class cg extends NS.Layer{constructor(e){super(e),this.listening(!1),PS.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Zc.FastLayer=cg;cg.prototype.nodeType="FastLayer";(0,MS._registerNode)(cg);var Ao={};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.Group=void 0;const AS=at,IS=ds,LS=Pe;let dg=class extends IS.Container{_validateAdd(e){const n=e.getType();n!=="Group"&&n!=="Shape"&&AS.Util.throw("You may only add groups and shapes to groups.")}};Ao.Group=dg;dg.prototype.nodeType="Group";(0,LS._registerNode)(dg);var Io={};Object.defineProperty(Io,"__esModule",{value:!0});Io.Animation=void 0;const Bh=Pe,i2=at,Uh=function(){return Bh.glob.performance&&Bh.glob.performance.now?function(){return Bh.glob.performance.now()}:function(){return new Date().getTime()}}();class wr{constructor(e,n){this.id=wr.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Uh(),frameRate:0},this.func=e,this.setLayers(n)}setLayers(e){let n=[];return e&&(n=Array.isArray(e)?e:[e]),this.layers=n,this}getLayers(){return this.layers}addLayer(e){const n=this.layers,r=n.length;for(let i=0;i<r;i++)if(n[i]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const n=wr.animations,r=n.length;for(let i=0;i<r;i++)if(n[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Uh(),wr._addAnimation(this),this}stop(){return wr._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const n=e.id,r=this.animations,i=r.length;for(let s=0;s<i;s++)if(r[s].id===n){this.animations.splice(s,1);break}}static _runFrames(){const e={},n=this.animations;for(let r=0;r<n.length;r++){const i=n[r],s=i.layers,l=i.func;i._updateFrameObject(Uh());const c=s.length;let u;if(l?u=l.call(i,i.frame)!==!1:u=!0,!!u)for(let f=0;f<c;f++){const h=s[f];h._id!==void 0&&(e[h._id]=h)}}for(const r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=wr;e.animations.length?(e._runFrames(),i2.Util.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,i2.Util.requestAnimFrame(this._animationLoop))}}Io.Animation=wr;wr.animations=[];wr.animIdCounter=0;wr.animRunning=!1;var j5={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=at,n=Io,r=tt,i=Pe,s={node:1,duration:1,easing:1,onFinish:1,yoyo:1},l=1,c=2,u=3,f=["fill","stroke","shadowColor"];let h=0;class m{constructor(w,E,_,S,C,g,k){this.prop=w,this.propFunc=E,this.begin=S,this._pos=S,this.duration=g,this._change=0,this.prevPos=0,this.yoyo=k,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=_,this._change=C-this.begin,this.pause()}fire(w){const E=this[w];E&&E()}setTime(w){w>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():w<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=w,this.update())}getTime(){return this._time}setPosition(w){this.prevPos=this._pos,this.propFunc(w),this._pos=w}getPosition(w){return w===void 0&&(w=this._time),this.func(w,this.begin,this._change,this.duration)}play(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=u,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(w){this.pause(),this._time=w,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const w=this.getTimer()-this._startTime;this.state===c?this.setTime(w):this.state===u&&this.setTime(this.duration-w)}pause(){this.state=l,this.fire("onPause")}getTimer(){return new Date().getTime()}}class x{constructor(w){const E=this,_=w.node,S=_._id,C=w.easing||t.Easings.Linear,g=!!w.yoyo;let k,T;typeof w.duration>"u"?k=.3:w.duration===0?k=.001:k=w.duration,this.node=_,this._id=h++;const N=_.getLayer()||(_ instanceof i.Konva.Stage?_.getLayers():null);N||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){E.tween.onEnterFrame()},N),this.tween=new m(T,function(L){E._tweenFunc(L)},C,0,1,k*1e3,g),this._addListeners(),x.attrs[S]||(x.attrs[S]={}),x.attrs[S][this._id]||(x.attrs[S][this._id]={}),x.tweens[S]||(x.tweens[S]={});for(T in w)s[T]===void 0&&this._addAttr(T,w[T]);this.reset(),this.onFinish=w.onFinish,this.onReset=w.onReset,this.onUpdate=w.onUpdate}_addAttr(w,E){const _=this.node,S=_._id;let C,g,k,T,N;const L=x.tweens[S][w];L&&delete x.attrs[S][L][w];let A=_.getAttr(w);if(e.Util._isArray(E))if(C=[],g=Math.max(E.length,A.length),w==="points"&&E.length!==A.length&&(E.length>A.length?(T=A,A=e.Util._prepareArrayForTween(A,E,_.closed())):(k=E,E=e.Util._prepareArrayForTween(E,A,_.closed()))),w.indexOf("fill")===0)for(let R=0;R<g;R++)if(R%2===0)C.push(E[R]-A[R]);else{const M=e.Util.colorToRGBA(A[R]);N=e.Util.colorToRGBA(E[R]),A[R]=M,C.push({r:N.r-M.r,g:N.g-M.g,b:N.b-M.b,a:N.a-M.a})}else for(let R=0;R<g;R++)C.push(E[R]-A[R]);else f.indexOf(w)!==-1?(A=e.Util.colorToRGBA(A),N=e.Util.colorToRGBA(E),C={r:N.r-A.r,g:N.g-A.g,b:N.b-A.b,a:N.a-A.a}):C=E-A;x.attrs[S][this._id][w]={start:A,diff:C,end:E,trueEnd:k,trueStart:T},x.tweens[S][w]=this._id}_tweenFunc(w){const E=this.node,_=x.attrs[E._id][this._id];let S,C,g,k,T,N,L,A;for(S in _){if(C=_[S],g=C.start,k=C.diff,A=C.end,e.Util._isArray(g))if(T=[],L=Math.max(g.length,A.length),S.indexOf("fill")===0)for(N=0;N<L;N++)N%2===0?T.push((g[N]||0)+k[N]*w):T.push("rgba("+Math.round(g[N].r+k[N].r*w)+","+Math.round(g[N].g+k[N].g*w)+","+Math.round(g[N].b+k[N].b*w)+","+(g[N].a+k[N].a*w)+")");else for(N=0;N<L;N++)T.push((g[N]||0)+k[N]*w);else f.indexOf(S)!==-1?T="rgba("+Math.round(g.r+k.r*w)+","+Math.round(g.g+k.g*w)+","+Math.round(g.b+k.b*w)+","+(g.a+k.a*w)+")":T=g+k*w;E.setAttr(S,T)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const w=this.node,E=x.attrs[w._id][this._id];E.points&&E.points.trueEnd&&w.setAttr("points",E.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const w=this.node,E=x.attrs[w._id][this._id];E.points&&E.points.trueStart&&w.points(E.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(w){return this.tween.seek(w*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const w=this.node._id,E=this._id,_=x.tweens[w];this.pause();for(const S in _)delete x.tweens[w][S];delete x.attrs[w][E]}}t.Tween=x,x.attrs={},x.tweens={},r.Node.prototype.to=function(y){const w=y.onFinish;y.node=this,y.onFinish=function(){this.destroy(),w&&w()},new x(y).play()},t.Easings={BackEaseIn(y,w,E,_){return E*(y/=_)*y*((1.70158+1)*y-1.70158)+w},BackEaseOut(y,w,E,_){return E*((y=y/_-1)*y*((1.70158+1)*y+1.70158)+1)+w},BackEaseInOut(y,w,E,_){let S=1.70158;return(y/=_/2)<1?E/2*(y*y*(((S*=1.525)+1)*y-S))+w:E/2*((y-=2)*y*(((S*=1.525)+1)*y+S)+2)+w},ElasticEaseIn(y,w,E,_,S,C){let g=0;return y===0?w:(y/=_)===1?w+E:(C||(C=_*.3),!S||S<Math.abs(E)?(S=E,g=C/4):g=C/(2*Math.PI)*Math.asin(E/S),-(S*Math.pow(2,10*(y-=1))*Math.sin((y*_-g)*(2*Math.PI)/C))+w)},ElasticEaseOut(y,w,E,_,S,C){let g=0;return y===0?w:(y/=_)===1?w+E:(C||(C=_*.3),!S||S<Math.abs(E)?(S=E,g=C/4):g=C/(2*Math.PI)*Math.asin(E/S),S*Math.pow(2,-10*y)*Math.sin((y*_-g)*(2*Math.PI)/C)+E+w)},ElasticEaseInOut(y,w,E,_,S,C){let g=0;return y===0?w:(y/=_/2)===2?w+E:(C||(C=_*(.3*1.5)),!S||S<Math.abs(E)?(S=E,g=C/4):g=C/(2*Math.PI)*Math.asin(E/S),y<1?-.5*(S*Math.pow(2,10*(y-=1))*Math.sin((y*_-g)*(2*Math.PI)/C))+w:S*Math.pow(2,-10*(y-=1))*Math.sin((y*_-g)*(2*Math.PI)/C)*.5+E+w)},BounceEaseOut(y,w,E,_){return(y/=_)<1/2.75?E*(7.5625*y*y)+w:y<2/2.75?E*(7.5625*(y-=1.5/2.75)*y+.75)+w:y<2.5/2.75?E*(7.5625*(y-=2.25/2.75)*y+.9375)+w:E*(7.5625*(y-=2.625/2.75)*y+.984375)+w},BounceEaseIn(y,w,E,_){return E-t.Easings.BounceEaseOut(_-y,0,E,_)+w},BounceEaseInOut(y,w,E,_){return y<_/2?t.Easings.BounceEaseIn(y*2,0,E,_)*.5+w:t.Easings.BounceEaseOut(y*2-_,0,E,_)*.5+E*.5+w},EaseIn(y,w,E,_){return E*(y/=_)*y+w},EaseOut(y,w,E,_){return-E*(y/=_)*(y-2)+w},EaseInOut(y,w,E,_){return(y/=_/2)<1?E/2*y*y+w:-E/2*(--y*(y-2)-1)+w},StrongEaseIn(y,w,E,_){return E*(y/=_)*y*y*y*y+w},StrongEaseOut(y,w,E,_){return E*((y=y/_-1)*y*y*y*y+1)+w},StrongEaseInOut(y,w,E,_){return(y/=_/2)<1?E/2*y*y*y*y*y+w:E/2*((y-=2)*y*y*y*y+2)+w},Linear(y,w,E,_){return E*y/_+w}}})(j5);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=Pe,n=at,r=tt,i=ds,s=I5,l=hl,c=Zc,u=Ao,f=Kc,h=_t,m=Io,x=j5,y=Br,w=ir;t.Konva=n.Util._assign(e.Konva,{Util:n.Util,Transform:n.Transform,Node:r.Node,Container:i.Container,Stage:s.Stage,stages:s.stages,Layer:l.Layer,FastLayer:c.FastLayer,Group:u.Group,DD:f.DD,Shape:h.Shape,shapes:h.shapes,Animation:m.Animation,Tween:x.Tween,Easings:x.Easings,Context:y.Context,Canvas:w.Canvas}),t.default=t.Konva})(Cc);var qc={};Object.defineProperty(qc,"__esModule",{value:!0});qc.Arc=void 0;const Jc=Me,RS=_t,s2=Pe,ed=we,FS=Pe;class Yr extends RS.Shape{_sceneFunc(e){const n=s2.Konva.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,n,r),e.arc(0,0,this.innerRadius(),n,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),n=this.outerRadius(),r=this.clockwise(),i=s2.Konva.getAngle(r?360-this.angle():this.angle()),s=Math.cos(Math.min(i,Math.PI)),l=1,c=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),u=Math.sin(Math.min(i,Math.PI/2)),f=s*(s>0?e:n),h=l*n,m=c*(c>0?e:n),x=u*(u>0?n:e);return{x:f,y:r?-1*x:m,width:h-f,height:x-m}}}qc.Arc=Yr;Yr.prototype._centroid=!0;Yr.prototype.className="Arc";Yr.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];(0,FS._registerNode)(Yr);Jc.Factory.addGetterSetter(Yr,"innerRadius",0,(0,ed.getNumberValidator)());Jc.Factory.addGetterSetter(Yr,"outerRadius",0,(0,ed.getNumberValidator)());Jc.Factory.addGetterSetter(Yr,"angle",0,(0,ed.getNumberValidator)());Jc.Factory.addGetterSetter(Yr,"clockwise",!1,(0,ed.getBooleanValidator)());var td={},pl={};Object.defineProperty(pl,"__esModule",{value:!0});pl.Line=void 0;const nd=Me,jS=Pe,OS=_t,O5=we;function ep(t,e,n,r,i,s,l){const c=Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2)),u=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2)),f=l*c/(c+u),h=l*u/(c+u),m=n-f*(i-t),x=r-f*(s-e),y=n+h*(i-t),w=r+h*(s-e);return[m,x,y,w]}function o2(t,e){const n=t.length,r=[];for(let i=2;i<n-2;i+=2){const s=ep(t[i-2],t[i-1],t[i],t[i+1],t[i+2],t[i+3],e);isNaN(s[0])||(r.push(s[0]),r.push(s[1]),r.push(t[i]),r.push(t[i+1]),r.push(s[2]),r.push(s[3]))}return r}let Li=class extends OS.Shape{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){let n=this.points(),r=n.length,i=this.tension(),s=this.closed(),l=this.bezier(),c,u,f;if(r){if(e.beginPath(),e.moveTo(n[0],n[1]),i!==0&&r>4){for(c=this.getTensionPoints(),u=c.length,f=s?0:4,s||e.quadraticCurveTo(c[0],c[1],c[2],c[3]);f<u-2;)e.bezierCurveTo(c[f++],c[f++],c[f++],c[f++],c[f++],c[f++]);s||e.quadraticCurveTo(c[u-2],c[u-1],n[r-2],n[r-1])}else if(l)for(f=2;f<r;)e.bezierCurveTo(n[f++],n[f++],n[f++],n[f++],n[f++],n[f++]);else for(f=2;f<r;f+=2)e.lineTo(n[f],n[f+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o2(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),n=e.length,r=this.tension(),i=ep(e[n-2],e[n-1],e[0],e[1],e[2],e[3],r),s=ep(e[n-4],e[n-3],e[n-2],e[n-1],e[0],e[1],r),l=o2(e,r);return[i[2],i[3]].concat(l).concat([s[0],s[1],e[n-2],e[n-1],s[2],s[3],i[0],i[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let n=e[0],r=e[0],i=e[1],s=e[1],l,c;for(let u=0;u<e.length/2;u++)l=e[u*2],c=e[u*2+1],n=Math.min(n,l),r=Math.max(r,l),i=Math.min(i,c),s=Math.max(s,c);return{x:n,y:i,width:r-n,height:s-i}}};pl.Line=Li;Li.prototype.className="Line";Li.prototype._attrsAffectingSize=["points","bezier","tension"];(0,jS._registerNode)(Li);nd.Factory.addGetterSetter(Li,"closed",!1);nd.Factory.addGetterSetter(Li,"bezier",!1);nd.Factory.addGetterSetter(Li,"tension",0,(0,O5.getNumberValidator)());nd.Factory.addGetterSetter(Li,"points",[],(0,O5.getNumberArrayValidator)());var Lo={},D5={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.t2length=t.getQuadraticArcLength=t.getCubicArcLength=t.binomialCoefficients=t.cValues=t.tValues=void 0,t.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],t.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],t.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const e=(l,c,u)=>{let f,h;const x=u/2;f=0;for(let y=0;y<20;y++)h=x*t.tValues[20][y]+x,f+=t.cValues[20][y]*r(l,c,h);return x*f};t.getCubicArcLength=e;const n=(l,c,u)=>{u===void 0&&(u=1);const f=l[0]-2*l[1]+l[2],h=c[0]-2*c[1]+c[2],m=2*l[1]-2*l[0],x=2*c[1]-2*c[0],y=4*(f*f+h*h),w=4*(f*m+h*x),E=m*m+x*x;if(y===0)return u*Math.sqrt(Math.pow(l[2]-l[0],2)+Math.pow(c[2]-c[0],2));const _=w/(2*y),S=E/y,C=u+_,g=S-_*_,k=C*C+g>0?Math.sqrt(C*C+g):0,T=_*_+g>0?Math.sqrt(_*_+g):0,N=_+Math.sqrt(_*_+g)!==0?g*Math.log(Math.abs((C+k)/(_+T))):0;return Math.sqrt(y)/2*(C*k-_*T+N)};t.getQuadraticArcLength=n;function r(l,c,u){const f=i(1,u,l),h=i(1,u,c),m=f*f+h*h;return Math.sqrt(m)}const i=(l,c,u)=>{const f=u.length-1;let h,m;if(f===0)return 0;if(l===0){m=0;for(let x=0;x<=f;x++)m+=t.binomialCoefficients[f][x]*Math.pow(1-c,f-x)*Math.pow(c,x)*u[x];return m}else{h=new Array(f);for(let x=0;x<f;x++)h[x]=f*(u[x+1]-u[x]);return i(l-1,c,h)}},s=(l,c,u)=>{let f=1,h=l/c,m=(l-u(h))/c,x=0;for(;f>.001;){const y=u(h+m),w=Math.abs(l-y)/c;if(w<f)f=w,h+=m;else{const E=u(h-m),_=Math.abs(l-E)/c;_<f?(f=_,h-=m):m/=2}if(x++,x>500)break}return h};t.t2length=s})(D5);Object.defineProperty(Lo,"__esModule",{value:!0});Lo.Path=void 0;const DS=Me,zS=_t,BS=Pe,Us=D5;class vt extends zS.Shape{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=vt.parsePathData(this.data()),this.pathLength=vt.getPathLength(this.dataArray)}_sceneFunc(e){const n=this.dataArray;e.beginPath();let r=!1;for(let E=0;E<n.length;E++){const _=n[E].command,S=n[E].points;switch(_){case"L":e.lineTo(S[0],S[1]);break;case"M":e.moveTo(S[0],S[1]);break;case"C":e.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5]);break;case"Q":e.quadraticCurveTo(S[0],S[1],S[2],S[3]);break;case"A":var i=S[0],s=S[1],l=S[2],c=S[3],u=S[4],f=S[5],h=S[6],m=S[7],x=l>c?l:c,y=l>c?1:l/c,w=l>c?c/l:1;e.translate(i,s),e.rotate(h),e.scale(y,w),e.arc(0,0,x,u,u+f,1-m),e.scale(1/y,1/w),e.rotate(-h),e.translate(-i,-s);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(u){if(u.command==="A"){const f=u.points[4],h=u.points[5],m=u.points[4]+h;let x=Math.PI/180;if(Math.abs(f-m)<x&&(x=Math.abs(f-m)),h<0)for(let y=f-x;y>m;y-=x){const w=vt.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],y,0);e.push(w.x,w.y)}else for(let y=f+x;y<m;y+=x){const w=vt.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],y,0);e.push(w.x,w.y)}}else if(u.command==="C")for(let f=0;f<=1;f+=.01){const h=vt.getPointOnCubicBezier(f,u.start.x,u.start.y,u.points[0],u.points[1],u.points[2],u.points[3],u.points[4],u.points[5]);e.push(h.x,h.y)}else e=e.concat(u.points)});let n=e[0],r=e[0],i=e[1],s=e[1],l,c;for(let u=0;u<e.length/2;u++)l=e[u*2],c=e[u*2+1],isNaN(l)||(n=Math.min(n,l),r=Math.max(r,l)),isNaN(c)||(i=Math.min(i,c),s=Math.max(s,c));return{x:n,y:i,width:r-n,height:s-i}}getLength(){return this.pathLength}getPointAtLength(e){return vt.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,n,r,i){return Math.sqrt((r-e)*(r-e)+(i-n)*(i-n))}static getPathLength(e){let n=0;for(let r=0;r<e.length;++r)n+=e[r].pathLength;return n}static getPointAtLengthOfDataArray(e,n){let r,i=0,s=n.length;if(!s)return null;for(;i<s&&e>n[i].pathLength;)e-=n[i].pathLength,++i;if(i===s)return r=n[i-1].points.slice(-2),{x:r[0],y:r[1]};if(e<.01)return r=n[i].points.slice(0,2),{x:r[0],y:r[1]};const l=n[i],c=l.points;switch(l.command){case"L":return vt.getPointOnLine(e,l.start.x,l.start.y,c[0],c[1]);case"C":return vt.getPointOnCubicBezier((0,Us.t2length)(e,vt.getPathLength(n),E=>(0,Us.getCubicArcLength)([l.start.x,c[0],c[2],c[4]],[l.start.y,c[1],c[3],c[5]],E)),l.start.x,l.start.y,c[0],c[1],c[2],c[3],c[4],c[5]);case"Q":return vt.getPointOnQuadraticBezier((0,Us.t2length)(e,vt.getPathLength(n),E=>(0,Us.getQuadraticArcLength)([l.start.x,c[0],c[2]],[l.start.y,c[1],c[3]],E)),l.start.x,l.start.y,c[0],c[1],c[2],c[3]);case"A":var u=c[0],f=c[1],h=c[2],m=c[3],x=c[4],y=c[5],w=c[6];return x+=y*e/l.pathLength,vt.getPointOnEllipticalArc(u,f,h,m,x,w)}return null}static getPointOnLine(e,n,r,i,s,l,c){l=l??n,c=c??r;const u=this.getLineLength(n,r,i,s);if(u<1e-10)return{x:n,y:r};if(i===n)return{x:l,y:c+(s>r?e:-e)};const f=(s-r)/(i-n),h=Math.sqrt(e*e/(1+f*f))*(i<n?-1:1),m=f*h;if(Math.abs(c-r-f*(l-n))<1e-10)return{x:l+h,y:c+m};const x=((l-n)*(i-n)+(c-r)*(s-r))/(u*u),y=n+x*(i-n),w=r+x*(s-r),E=this.getLineLength(l,c,y,w),_=Math.sqrt(e*e-E*E),S=Math.sqrt(_*_/(1+f*f))*(i<n?-1:1),C=f*S;return{x:y+S,y:w+C}}static getPointOnCubicBezier(e,n,r,i,s,l,c,u,f){function h(_){return _*_*_}function m(_){return 3*_*_*(1-_)}function x(_){return 3*_*(1-_)*(1-_)}function y(_){return(1-_)*(1-_)*(1-_)}const w=u*h(e)+l*m(e)+i*x(e)+n*y(e),E=f*h(e)+c*m(e)+s*x(e)+r*y(e);return{x:w,y:E}}static getPointOnQuadraticBezier(e,n,r,i,s,l,c){function u(y){return y*y}function f(y){return 2*y*(1-y)}function h(y){return(1-y)*(1-y)}const m=l*u(e)+i*f(e)+n*h(e),x=c*u(e)+s*f(e)+r*h(e);return{x:m,y:x}}static getPointOnEllipticalArc(e,n,r,i,s,l){const c=Math.cos(l),u=Math.sin(l),f={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:e+(f.x*c-f.y*u),y:n+(f.x*u+f.y*c)}}static parsePathData(e){if(!e)return[];let n=e;const r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];n=n.replace(new RegExp(" ","g"),",");for(var i=0;i<r.length;i++)n=n.replace(new RegExp(r[i],"g"),"|"+r[i]);const s=n.split("|"),l=[],c=[];let u=0,f=0;const h=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let m;for(i=1;i<s.length;i++){let A=s[i],R=A.charAt(0);for(A=A.slice(1),c.length=0;m=h.exec(A);)c.push(m[0]);const M=[];for(let I=0,O=c.length;I<O;I++){if(c[I]==="00"){M.push(0,0);continue}const W=parseFloat(c[I]);isNaN(W)?M.push(0):M.push(W)}for(;M.length>0&&!isNaN(M[0]);){let I="",O=[];const W=u,B=f;var x,y,w,E,_,S,C,g,k,T;switch(R){case"l":u+=M.shift(),f+=M.shift(),I="L",O.push(u,f);break;case"L":u=M.shift(),f=M.shift(),O.push(u,f);break;case"m":var N=M.shift(),L=M.shift();if(u+=N,f+=L,I="M",l.length>2&&l[l.length-1].command==="z"){for(let D=l.length-2;D>=0;D--)if(l[D].command==="M"){u=l[D].points[0]+N,f=l[D].points[1]+L;break}}O.push(u,f),R="l";break;case"M":u=M.shift(),f=M.shift(),I="M",O.push(u,f),R="L";break;case"h":u+=M.shift(),I="L",O.push(u,f);break;case"H":u=M.shift(),I="L",O.push(u,f);break;case"v":f+=M.shift(),I="L",O.push(u,f);break;case"V":f=M.shift(),I="L",O.push(u,f);break;case"C":O.push(M.shift(),M.shift(),M.shift(),M.shift()),u=M.shift(),f=M.shift(),O.push(u,f);break;case"c":O.push(u+M.shift(),f+M.shift(),u+M.shift(),f+M.shift()),u+=M.shift(),f+=M.shift(),I="C",O.push(u,f);break;case"S":y=u,w=f,x=l[l.length-1],x.command==="C"&&(y=u+(u-x.points[2]),w=f+(f-x.points[3])),O.push(y,w,M.shift(),M.shift()),u=M.shift(),f=M.shift(),I="C",O.push(u,f);break;case"s":y=u,w=f,x=l[l.length-1],x.command==="C"&&(y=u+(u-x.points[2]),w=f+(f-x.points[3])),O.push(y,w,u+M.shift(),f+M.shift()),u+=M.shift(),f+=M.shift(),I="C",O.push(u,f);break;case"Q":O.push(M.shift(),M.shift()),u=M.shift(),f=M.shift(),O.push(u,f);break;case"q":O.push(u+M.shift(),f+M.shift()),u+=M.shift(),f+=M.shift(),I="Q",O.push(u,f);break;case"T":y=u,w=f,x=l[l.length-1],x.command==="Q"&&(y=u+(u-x.points[0]),w=f+(f-x.points[1])),u=M.shift(),f=M.shift(),I="Q",O.push(y,w,u,f);break;case"t":y=u,w=f,x=l[l.length-1],x.command==="Q"&&(y=u+(u-x.points[0]),w=f+(f-x.points[1])),u+=M.shift(),f+=M.shift(),I="Q",O.push(y,w,u,f);break;case"A":E=M.shift(),_=M.shift(),S=M.shift(),C=M.shift(),g=M.shift(),k=u,T=f,u=M.shift(),f=M.shift(),I="A",O=this.convertEndpointToCenterParameterization(k,T,u,f,C,g,E,_,S);break;case"a":E=M.shift(),_=M.shift(),S=M.shift(),C=M.shift(),g=M.shift(),k=u,T=f,u+=M.shift(),f+=M.shift(),I="A",O=this.convertEndpointToCenterParameterization(k,T,u,f,C,g,E,_,S);break}l.push({command:I||R,points:O,start:{x:W,y:B},pathLength:this.calcLength(W,B,I||R,O)})}(R==="z"||R==="Z")&&l.push({command:"z",points:[],start:void 0,pathLength:0})}return l}static calcLength(e,n,r,i){let s,l,c,u;const f=vt;switch(r){case"L":return f.getLineLength(e,n,i[0],i[1]);case"C":return(0,Us.getCubicArcLength)([e,i[0],i[2],i[4]],[n,i[1],i[3],i[5]],1);case"Q":return(0,Us.getQuadraticArcLength)([e,i[0],i[2]],[n,i[1],i[3]],1);case"A":s=0;var h=i[4],m=i[5],x=i[4]+m,y=Math.PI/180;if(Math.abs(h-x)<y&&(y=Math.abs(h-x)),l=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),m<0)for(u=h-y;u>x;u-=y)c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),l=c;else for(u=h+y;u<x;u+=y)c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),l=c;return c=f.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],x,0),s+=f.getLineLength(l.x,l.y,c.x,c.y),s}return 0}static convertEndpointToCenterParameterization(e,n,r,i,s,l,c,u,f){const h=f*(Math.PI/180),m=Math.cos(h)*(e-r)/2+Math.sin(h)*(n-i)/2,x=-1*Math.sin(h)*(e-r)/2+Math.cos(h)*(n-i)/2,y=m*m/(c*c)+x*x/(u*u);y>1&&(c*=Math.sqrt(y),u*=Math.sqrt(y));let w=Math.sqrt((c*c*(u*u)-c*c*(x*x)-u*u*(m*m))/(c*c*(x*x)+u*u*(m*m)));s===l&&(w*=-1),isNaN(w)&&(w=0);const E=w*c*x/u,_=w*-u*m/c,S=(e+r)/2+Math.cos(h)*E-Math.sin(h)*_,C=(n+i)/2+Math.sin(h)*E+Math.cos(h)*_,g=function(M){return Math.sqrt(M[0]*M[0]+M[1]*M[1])},k=function(M,I){return(M[0]*I[0]+M[1]*I[1])/(g(M)*g(I))},T=function(M,I){return(M[0]*I[1]<M[1]*I[0]?-1:1)*Math.acos(k(M,I))},N=T([1,0],[(m-E)/c,(x-_)/u]),L=[(m-E)/c,(x-_)/u],A=[(-1*m-E)/c,(-1*x-_)/u];let R=T(L,A);return k(L,A)<=-1&&(R=Math.PI),k(L,A)>=1&&(R=0),l===0&&R>0&&(R=R-2*Math.PI),l===1&&R<0&&(R=R+2*Math.PI),[S,C,c,u,N,R,h,l]}}Lo.Path=vt;vt.prototype.className="Path";vt.prototype._attrsAffectingSize=["data"];(0,BS._registerNode)(vt);DS.Factory.addGetterSetter(vt,"data");Object.defineProperty(td,"__esModule",{value:!0});td.Arrow=void 0;const rd=Me,US=pl,z5=we,GS=Pe,a2=Lo;let hs=class extends US.Line{_sceneFunc(e){super._sceneFunc(e);const n=Math.PI*2,r=this.points();let i=r;const s=this.tension()!==0&&r.length>4;s&&(i=this.getTensionPoints());const l=this.pointerLength(),c=r.length;let u,f;if(s){const x=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[c-2],r[c-1]],y=a2.Path.calcLength(i[i.length-4],i[i.length-3],"C",x),w=a2.Path.getPointOnQuadraticBezier(Math.min(1,1-l/y),x[0],x[1],x[2],x[3],x[4],x[5]);u=r[c-2]-w.x,f=r[c-1]-w.y}else u=r[c-2]-r[c-4],f=r[c-1]-r[c-3];const h=(Math.atan2(f,u)+n)%n,m=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[c-2],r[c-1]),e.rotate(h),e.moveTo(0,0),e.lineTo(-l,m/2),e.lineTo(-l,-m/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),s?(u=(i[0]+i[2])/2-r[0],f=(i[1]+i[3])/2-r[1]):(u=r[2]-r[0],f=r[3]-r[1]),e.rotate((Math.atan2(-f,-u)+n)%n),e.moveTo(0,0),e.lineTo(-l,m/2),e.lineTo(-l,-m/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const n=this.dashEnabled();n&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),n&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),n=this.pointerWidth()/2;return{x:e.x,y:e.y-n,width:e.width,height:e.height+n*2}}};td.Arrow=hs;hs.prototype.className="Arrow";(0,GS._registerNode)(hs);rd.Factory.addGetterSetter(hs,"pointerLength",10,(0,z5.getNumberValidator)());rd.Factory.addGetterSetter(hs,"pointerWidth",10,(0,z5.getNumberValidator)());rd.Factory.addGetterSetter(hs,"pointerAtBeginning",!1);rd.Factory.addGetterSetter(hs,"pointerAtEnding",!0);var id={};Object.defineProperty(id,"__esModule",{value:!0});id.Circle=void 0;const VS=Me,WS=_t,$S=we,HS=Pe;let Ro=class extends WS.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};id.Circle=Ro;Ro.prototype._centroid=!0;Ro.prototype.className="Circle";Ro.prototype._attrsAffectingSize=["radius"];(0,HS._registerNode)(Ro);VS.Factory.addGetterSetter(Ro,"radius",0,(0,$S.getNumberValidator)());var sd={};Object.defineProperty(sd,"__esModule",{value:!0});sd.Ellipse=void 0;const fg=Me,XS=_t,B5=we,YS=Pe;class Ri extends XS.Shape{_sceneFunc(e){const n=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),n!==r&&e.scale(1,r/n),e.arc(0,0,n,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}sd.Ellipse=Ri;Ri.prototype.className="Ellipse";Ri.prototype._centroid=!0;Ri.prototype._attrsAffectingSize=["radiusX","radiusY"];(0,YS._registerNode)(Ri);fg.Factory.addComponentsGetterSetter(Ri,"radius",["x","y"]);fg.Factory.addGetterSetter(Ri,"radiusX",0,(0,B5.getNumberValidator)());fg.Factory.addGetterSetter(Ri,"radiusY",0,(0,B5.getNumberValidator)());var od={};Object.defineProperty(od,"__esModule",{value:!0});od.Image=void 0;const Gh=at,ps=Me,KS=_t,QS=Pe,gl=we;class Gn extends KS.Shape{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",n=>{this._removeImageLoad(n.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),n=this.hasShadow();return e&&n?!0:super._useBufferCanvas(!0)}_sceneFunc(e){const n=this.getWidth(),r=this.getHeight(),i=this.cornerRadius(),s=this.attrs.image;let l;if(s){const c=this.attrs.cropWidth,u=this.attrs.cropHeight;c&&u?l=[s,this.cropX(),this.cropY(),c,u,0,0,n,r]:l=[s,0,0,n,r]}(this.hasFill()||this.hasStroke()||i)&&(e.beginPath(),i?Gh.Util.drawRoundedRectPath(e,n,r,i):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)),s&&(i&&e.clip(),e.drawImage.apply(e,l))}_hitFunc(e){const n=this.width(),r=this.height(),i=this.cornerRadius();e.beginPath(),i?Gh.Util.drawRoundedRectPath(e,n,r,i):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,n;return(e=this.attrs.width)!==null&&e!==void 0?e:(n=this.image())===null||n===void 0?void 0:n.width}getHeight(){var e,n;return(e=this.attrs.height)!==null&&e!==void 0?e:(n=this.image())===null||n===void 0?void 0:n.height}static fromURL(e,n,r=null){const i=Gh.Util.createImageElement();i.onload=function(){const s=new Gn({image:i});n(s)},i.onerror=r,i.crossOrigin="Anonymous",i.src=e}}od.Image=Gn;Gn.prototype.className="Image";(0,QS._registerNode)(Gn);ps.Factory.addGetterSetter(Gn,"cornerRadius",0,(0,gl.getNumberOrArrayOfNumbersValidator)(4));ps.Factory.addGetterSetter(Gn,"image");ps.Factory.addComponentsGetterSetter(Gn,"crop",["x","y","width","height"]);ps.Factory.addGetterSetter(Gn,"cropX",0,(0,gl.getNumberValidator)());ps.Factory.addGetterSetter(Gn,"cropY",0,(0,gl.getNumberValidator)());ps.Factory.addGetterSetter(Gn,"cropWidth",0,(0,gl.getNumberValidator)());ps.Factory.addGetterSetter(Gn,"cropHeight",0,(0,gl.getNumberValidator)());var wo={};Object.defineProperty(wo,"__esModule",{value:!0});wo.Tag=wo.Label=void 0;const ad=Me,ZS=_t,qS=Ao,hg=we,U5=Pe,G5=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],JS="Change.konva",ek="none",tp="up",np="right",rp="down",ip="left",tk=G5.length;class pg extends qS.Group{constructor(e){super(e),this.on("add.konva",function(n){this._addListeners(n.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let n=this,r;const i=function(){n._sync()};for(r=0;r<tk;r++)e.on(G5[r]+JS,i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),n=this.getTag(),r,i,s,l,c,u,f;if(e&&n){switch(r=e.width(),i=e.height(),s=n.pointerDirection(),l=n.pointerWidth(),f=n.pointerHeight(),c=0,u=0,s){case tp:c=r/2,u=-1*f;break;case np:c=r+l,u=i/2;break;case rp:c=r/2,u=i+f;break;case ip:c=-1*l,u=i/2;break}n.setAttrs({x:-1*c,y:-1*u,width:r,height:i}),e.setAttrs({x:-1*c,y:-1*u})}}}wo.Label=pg;pg.prototype.className="Label";(0,U5._registerNode)(pg);class gs extends ZS.Shape{_sceneFunc(e){const n=this.width(),r=this.height(),i=this.pointerDirection(),s=this.pointerWidth(),l=this.pointerHeight(),c=this.cornerRadius();let u=0,f=0,h=0,m=0;typeof c=="number"?u=f=h=m=Math.min(c,n/2,r/2):(u=Math.min(c[0]||0,n/2,r/2),f=Math.min(c[1]||0,n/2,r/2),m=Math.min(c[2]||0,n/2,r/2),h=Math.min(c[3]||0,n/2,r/2)),e.beginPath(),e.moveTo(u,0),i===tp&&(e.lineTo((n-s)/2,0),e.lineTo(n/2,-1*l),e.lineTo((n+s)/2,0)),e.lineTo(n-f,0),e.arc(n-f,f,f,Math.PI*3/2,0,!1),i===np&&(e.lineTo(n,(r-l)/2),e.lineTo(n+s,r/2),e.lineTo(n,(r+l)/2)),e.lineTo(n,r-m),e.arc(n-m,r-m,m,0,Math.PI/2,!1),i===rp&&(e.lineTo((n+s)/2,r),e.lineTo(n/2,r+l),e.lineTo((n-s)/2,r)),e.lineTo(h,r),e.arc(h,r-h,h,Math.PI/2,Math.PI,!1),i===ip&&(e.lineTo(0,(r+l)/2),e.lineTo(-1*s,r/2),e.lineTo(0,(r-l)/2)),e.lineTo(0,u),e.arc(u,u,u,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,n=0,r=this.pointerWidth(),i=this.pointerHeight(),s=this.pointerDirection(),l=this.width(),c=this.height();return s===tp?(n-=i,c+=i):s===rp?c+=i:s===ip?(e-=r*1.5,l+=r):s===np&&(l+=r*1.5),{x:e,y:n,width:l,height:c}}}wo.Tag=gs;gs.prototype.className="Tag";(0,U5._registerNode)(gs);ad.Factory.addGetterSetter(gs,"pointerDirection",ek);ad.Factory.addGetterSetter(gs,"pointerWidth",0,(0,hg.getNumberValidator)());ad.Factory.addGetterSetter(gs,"pointerHeight",0,(0,hg.getNumberValidator)());ad.Factory.addGetterSetter(gs,"cornerRadius",0,(0,hg.getNumberOrArrayOfNumbersValidator)(4));var ml={};Object.defineProperty(ml,"__esModule",{value:!0});ml.Rect=void 0;const nk=Me,rk=_t,ik=Pe,sk=at,ok=we;let ld=class extends rk.Shape{_sceneFunc(e){const n=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),n?sk.Util.drawRoundedRectPath(e,r,i,n):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}};ml.Rect=ld;ld.prototype.className="Rect";(0,ik._registerNode)(ld);nk.Factory.addGetterSetter(ld,"cornerRadius",0,(0,ok.getNumberOrArrayOfNumbersValidator)(4));var ud={};Object.defineProperty(ud,"__esModule",{value:!0});ud.RegularPolygon=void 0;const V5=Me,ak=_t,W5=we,lk=Pe;class ms extends ak.Shape{_sceneFunc(e){const n=this._getPoints();e.beginPath(),e.moveTo(n[0].x,n[0].y);for(let r=1;r<n.length;r++)e.lineTo(n[r].x,n[r].y);e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,n=this.attrs.radius||0,r=[];for(let i=0;i<e;i++)r.push({x:n*Math.sin(i*2*Math.PI/e),y:-1*n*Math.cos(i*2*Math.PI/e)});return r}getSelfRect(){const e=this._getPoints();let n=e[0].x,r=e[0].y,i=e[0].x,s=e[0].y;return e.forEach(l=>{n=Math.min(n,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),s=Math.max(s,l.y)}),{x:n,y:i,width:r-n,height:s-i}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}ud.RegularPolygon=ms;ms.prototype.className="RegularPolygon";ms.prototype._centroid=!0;ms.prototype._attrsAffectingSize=["radius"];(0,lk._registerNode)(ms);V5.Factory.addGetterSetter(ms,"radius",0,(0,W5.getNumberValidator)());V5.Factory.addGetterSetter(ms,"sides",0,(0,W5.getNumberValidator)());var cd={};Object.defineProperty(cd,"__esModule",{value:!0});cd.Ring=void 0;const $5=Me,uk=_t,H5=we,ck=Pe,l2=Math.PI*2;class ys extends uk.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,l2,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),l2,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}cd.Ring=ys;ys.prototype.className="Ring";ys.prototype._centroid=!0;ys.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,ck._registerNode)(ys);$5.Factory.addGetterSetter(ys,"innerRadius",0,(0,H5.getNumberValidator)());$5.Factory.addGetterSetter(ys,"outerRadius",0,(0,H5.getNumberValidator)());var dd={};Object.defineProperty(dd,"__esModule",{value:!0});dd.Sprite=void 0;const vs=Me,dk=_t,fk=Io,X5=we,hk=Pe;class Cr extends dk.Shape{constructor(e){super(e),this._updated=!0,this.anim=new fk.Animation(()=>{const n=this._updated;return this._updated=!1,n}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const n=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[n],l=this.frameOffsets(),c=s[i+0],u=s[i+1],f=s[i+2],h=s[i+3],m=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,f,h),e.closePath(),e.fillStrokeShape(this)),m)if(l){const x=l[n],y=r*2;e.drawImage(m,c,u,f,h,x[y+0],x[y+1],f,h)}else e.drawImage(m,c,u,f,h,0,0,f,h)}_hitFunc(e){const n=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[n],l=this.frameOffsets(),c=s[i+2],u=s[i+3];if(e.beginPath(),l){const f=l[n],h=r*2;e.rect(f[h+0],f[h+1],c,u)}else e.rect(0,0,c,u);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),n=this.animation(),r=this.animations(),i=r[n],s=i.length/4;e<s-1?this.frameIndex(e+1):this.frameIndex(0)}}dd.Sprite=Cr;Cr.prototype.className="Sprite";(0,hk._registerNode)(Cr);vs.Factory.addGetterSetter(Cr,"animation");vs.Factory.addGetterSetter(Cr,"animations");vs.Factory.addGetterSetter(Cr,"frameOffsets");vs.Factory.addGetterSetter(Cr,"image");vs.Factory.addGetterSetter(Cr,"frameIndex",0,(0,X5.getNumberValidator)());vs.Factory.addGetterSetter(Cr,"frameRate",17,(0,X5.getNumberValidator)());vs.Factory.backCompat(Cr,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});var fd={};Object.defineProperty(fd,"__esModule",{value:!0});fd.Star=void 0;const gg=Me,pk=_t,mg=we,gk=Pe;class Fi extends pk.Shape{_sceneFunc(e){const n=this.innerRadius(),r=this.outerRadius(),i=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(let s=1;s<i*2;s++){const l=s%2===0?r:n,c=l*Math.sin(s*Math.PI/i),u=-1*l*Math.cos(s*Math.PI/i);e.lineTo(c,u)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}fd.Star=Fi;Fi.prototype.className="Star";Fi.prototype._centroid=!0;Fi.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,gk._registerNode)(Fi);gg.Factory.addGetterSetter(Fi,"numPoints",5,(0,mg.getNumberValidator)());gg.Factory.addGetterSetter(Fi,"innerRadius",0,(0,mg.getNumberValidator)());gg.Factory.addGetterSetter(Fi,"outerRadius",0,(0,mg.getNumberValidator)());var Fo={};Object.defineProperty(Fo,"__esModule",{value:!0});Fo.Text=void 0;Fo.stringToArray=qi;const sp=at,Yt=Me,mk=_t,Vh=Pe,ji=we,yk=Pe;function qi(t){return[...t].reduce((e,n,r,i)=>{if(/\p{Emoji}/u.test(n)){const s=i[r+1];s&&/\p{Emoji_Modifier}|\u200D/u.test(s)?(e.push(n+s),i[r+1]=""):e.push(n)}else/\p{Regional_Indicator}{2}/u.test(n+(i[r+1]||""))?e.push(n+i[r+1]):r>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(n)?e[e.length-1]+=n:n&&e.push(n);return e},[])}const Gs="auto",vk="center",Y5="inherit",pa="justify",xk="Change.konva",wk="2d",u2="-",K5="left",_k="text",Sk="Text",kk="top",Ck="bottom",c2="middle",Q5="normal",Tk="px ",Mu=" ",Ek="right",d2="rtl",bk="word",Pk="char",f2="none",Wh="",Z5=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Nk=Z5.length;function Mk(t){return t.split(",").map(e=>{e=e.trim();const n=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return n&&!r&&(e=`"${e}"`),e}).join(", ")}let Au;function $h(){return Au||(Au=sp.Util.createCanvasElement().getContext(wk),Au)}function Ak(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Ik(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Lk(t){return t=t||{},!t.fillLinearGradientColorStops&&!t.fillRadialGradientColorStops&&!t.fillPatternImage&&(t.fill=t.fill||"black"),t}let ct=class extends mk.Shape{constructor(e){super(Lk(e)),this._partialTextX=0,this._partialTextY=0;for(let n=0;n<Nk;n++)this.on(Z5[n]+xk,this._setTextData);this._setTextData()}_sceneFunc(e){const n=this.textArr,r=n.length;if(!this.text())return;let i=this.padding(),s=this.fontSize(),l=this.lineHeight()*s,c=this.verticalAlign(),u=this.direction(),f=0,h=this.align(),m=this.getWidth(),x=this.letterSpacing(),y=this.fill(),w=this.textDecoration(),E=w.indexOf("underline")!==-1,_=w.indexOf("line-through")!==-1,S;u=u===Y5?e.direction:u;let C=l/2,g=c2;if(Vh.Konva._fixTextRendering){const O=this.measureSize("M");g="alphabetic",C=(O.fontBoundingBoxAscent-O.fontBoundingBoxDescent)/2+l/2}var k=0,T=0;for(u===d2&&e.setAttr("direction",u),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",g),e.setAttr("textAlign",K5),c===c2?f=(this.getHeight()-r*l-i*2)/2:c===Ck&&(f=this.getHeight()-r*l-i*2),e.translate(i,f+i),S=0;S<r;S++){var k=0,T=0,N=n[S],L=N.text,A=N.width,R=N.lastInParagraph,M,I;if(e.save(),h===Ek?k+=m-A-i*2:h===vk&&(k+=(m-A-i*2)/2),E){e.save(),e.beginPath();const B=Vh.Konva._fixTextRendering?Math.round(s/4):Math.round(s/2),D=k,$=C+T+B;e.moveTo(D,$),M=L.split(" ").length-1,I=h===pa&&!R?m-i*2:A,e.lineTo(D+Math.round(I),$),e.lineWidth=s/15;const X=this._getLinearGradient();e.strokeStyle=X||y,e.stroke(),e.restore()}if(_){e.save(),e.beginPath();const B=Vh.Konva._fixTextRendering?-Math.round(s/4):0;e.moveTo(k,C+T+B),M=L.split(" ").length-1,I=h===pa&&!R?m-i*2:A,e.lineTo(k+Math.round(I),C+T+B),e.lineWidth=s/15;const D=this._getLinearGradient();e.strokeStyle=D||y,e.stroke(),e.restore()}if(u!==d2&&(x!==0||h===pa)){M=L.split(" ").length-1;const B=qi(L);for(let D=0;D<B.length;D++){const $=B[D];$===" "&&!R&&h===pa&&(k+=(m-i*2-A)/M),this._partialTextX=k,this._partialTextY=C+T,this._partialText=$,e.fillStrokeShape(this),k+=this.measureSize($).width+x}}else x!==0&&e.setAttr("letterSpacing",`${x}px`),this._partialTextX=k,this._partialTextY=C+T,this._partialText=L,e.fillStrokeShape(this);e.restore(),r>1&&(C+=l)}}_hitFunc(e){const n=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}setText(e){const n=sp.Util._isString(e)?e:e==null?"":e+"";return this._setAttr(_k,n),this}getWidth(){return this.attrs.width===Gs||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===Gs||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return sp.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var n,r,i,s,l,c,u,f,h,m,x;let y=$h(),w=this.fontSize(),E;y.save(),y.font=this._getContextFont(),E=y.measureText(e),y.restore();const _=w/100;return{actualBoundingBoxAscent:(n=E.actualBoundingBoxAscent)!==null&&n!==void 0?n:71.58203125*_,actualBoundingBoxDescent:(r=E.actualBoundingBoxDescent)!==null&&r!==void 0?r:0,actualBoundingBoxLeft:(i=E.actualBoundingBoxLeft)!==null&&i!==void 0?i:-7.421875*_,actualBoundingBoxRight:(s=E.actualBoundingBoxRight)!==null&&s!==void 0?s:75.732421875*_,alphabeticBaseline:(l=E.alphabeticBaseline)!==null&&l!==void 0?l:0,emHeightAscent:(c=E.emHeightAscent)!==null&&c!==void 0?c:100*_,emHeightDescent:(u=E.emHeightDescent)!==null&&u!==void 0?u:-20*_,fontBoundingBoxAscent:(f=E.fontBoundingBoxAscent)!==null&&f!==void 0?f:91*_,fontBoundingBoxDescent:(h=E.fontBoundingBoxDescent)!==null&&h!==void 0?h:21*_,hangingBaseline:(m=E.hangingBaseline)!==null&&m!==void 0?m:72.80000305175781*_,ideographicBaseline:(x=E.ideographicBaseline)!==null&&x!==void 0?x:-21*_,width:E.width,height:w}}_getContextFont(){return this.fontStyle()+Mu+this.fontVariant()+Mu+(this.fontSize()+Tk)+Mk(this.fontFamily())}_addTextLine(e){this.align()===pa&&(e=e.trim());const r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){const n=this.letterSpacing(),r=e.length;return $h().measureText(e).width+n*r}_setTextData(){let e=this.text().split(`
`),n=+this.fontSize(),r=0,i=this.lineHeight()*n,s=this.attrs.width,l=this.attrs.height,c=s!==Gs&&s!==void 0,u=l!==Gs&&l!==void 0,f=this.padding(),h=s-f*2,m=l-f*2,x=0,y=this.wrap(),w=y!==f2,E=y!==Pk&&w,_=this.ellipsis();this.textArr=[],$h().font=this._getContextFont();const S=_?this._getTextWidth(Wh):0;for(let C=0,g=e.length;C<g;++C){let k=e[C],T=this._getTextWidth(k);if(c&&T>h)for(;k.length>0;){let N=0,L=qi(k).length,A="",R=0;for(;N<L;){const M=N+L>>>1,I=qi(k),O=I.slice(0,M+1).join(""),W=this._getTextWidth(O);(_&&u&&x+i>m?W+S:W)<=h?(N=M+1,A=O,R=W):L=M}if(A){if(E){const O=qi(k),W=qi(A),B=O[W.length],D=B===Mu||B===u2;let $;if(D&&R<=h)$=W.length;else{const X=W.lastIndexOf(Mu),F=W.lastIndexOf(u2);$=Math.max(X,F)+1}$>0&&(N=$,A=O.slice(0,N).join(""),R=this._getTextWidth(A))}if(A=A.trimRight(),this._addTextLine(A),r=Math.max(r,R),x+=i,this._shouldHandleEllipsis(x)){this._tryToAddEllipsisToLastLine();break}if(k=qi(k).slice(N).join("").trimLeft(),k.length>0&&(T=this._getTextWidth(k),T<=h)){this._addTextLine(k),x+=i,r=Math.max(r,T);break}}else break}else this._addTextLine(k),x+=i,r=Math.max(r,T),this._shouldHandleEllipsis(x)&&C<g-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),u&&x+i>m)break}this.textHeight=n,this.textWidth=r}_shouldHandleEllipsis(e){const n=+this.fontSize(),r=this.lineHeight()*n,i=this.attrs.height,s=i!==Gs&&i!==void 0,l=this.padding(),c=i-l*2;return!(this.wrap()!==f2)||s&&e+r>c}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,n=e!==Gs&&e!==void 0,r=this.padding(),i=e-r*2,s=this.ellipsis(),l=this.textArr[this.textArr.length-1];!l||!s||(n&&(this._getTextWidth(l.text+Wh)<i||(l.text=l.text.slice(0,l.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(l.text+Wh))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,n=this.hasShadow();return e&&n?!0:super._useBufferCanvas()}};Fo.Text=ct;ct.prototype._fillFunc=Ak;ct.prototype._strokeFunc=Ik;ct.prototype.className=Sk;ct.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,yk._registerNode)(ct);Yt.Factory.overWriteSetter(ct,"width",(0,ji.getNumberOrAutoValidator)());Yt.Factory.overWriteSetter(ct,"height",(0,ji.getNumberOrAutoValidator)());Yt.Factory.addGetterSetter(ct,"direction",Y5);Yt.Factory.addGetterSetter(ct,"fontFamily","Arial");Yt.Factory.addGetterSetter(ct,"fontSize",12,(0,ji.getNumberValidator)());Yt.Factory.addGetterSetter(ct,"fontStyle",Q5);Yt.Factory.addGetterSetter(ct,"fontVariant",Q5);Yt.Factory.addGetterSetter(ct,"padding",0,(0,ji.getNumberValidator)());Yt.Factory.addGetterSetter(ct,"align",K5);Yt.Factory.addGetterSetter(ct,"verticalAlign",kk);Yt.Factory.addGetterSetter(ct,"lineHeight",1,(0,ji.getNumberValidator)());Yt.Factory.addGetterSetter(ct,"wrap",bk);Yt.Factory.addGetterSetter(ct,"ellipsis",!1,(0,ji.getBooleanValidator)());Yt.Factory.addGetterSetter(ct,"letterSpacing",0,(0,ji.getNumberValidator)());Yt.Factory.addGetterSetter(ct,"text","",(0,ji.getStringValidator)());Yt.Factory.addGetterSetter(ct,"textDecoration","");var hd={};Object.defineProperty(hd,"__esModule",{value:!0});hd.TextPath=void 0;const Hh=at,or=Me,Rk=_t,ga=Lo,Xh=Fo,q5=we,Fk=Pe,jk="",J5="normal";function e4(t){t.fillText(this.partialText,0,0)}function t4(t){t.strokeText(this.partialText,0,0)}class St extends Rk.Shape{constructor(e){super(e),this.dummyCanvas=Hh.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return ga.Path.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;const n=this.pathLength;return e-1>n?null:ga.Path.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=ga.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const n=this.textDecoration(),r=this.fill(),i=this.fontSize(),s=this.glyphInfo;n==="underline"&&e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),this.partialText=s[l].text,e.fillStrokeShape(this),n==="underline"&&(l===0&&e.moveTo(0,i/2+1),e.lineTo(i,i/2+1)),e.restore()}n==="underline"&&(e.strokeStyle=r,e.lineWidth=i/20,e.stroke()),e.restore()}_hitFunc(e){e.beginPath();const n=this.glyphInfo;if(n.length>=1){const r=n[0].p0;e.moveTo(r.x,r.y)}for(let r=0;r<n.length;r++){const i=n[r].p1;e.lineTo(i.x,i.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return Hh.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return Xh.Text.prototype.setText.call(this,e)}_getContextFont(){return Xh.Text.prototype._getContextFont.call(this)}_getTextSize(e){const r=this.dummyCanvas.getContext("2d");r.save(),r.font=this._getContextFont();const i=r.measureText(e);return r.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:e,height:n}=this._getTextSize(this.attrs.text);if(this.textWidth=e,this.textHeight=n,this.glyphInfo=[],!this.attrs.data)return null;const r=this.letterSpacing(),i=this.align(),s=this.kerningFunc(),l=Math.max(this.textWidth+((this.attrs.text||"").length-1)*r,0);let c=0;i==="center"&&(c=Math.max(0,this.pathLength/2-l/2)),i==="right"&&(c=Math.max(0,this.pathLength-l));const u=(0,Xh.stringToArray)(this.text());let f=c;for(let h=0;h<u.length;h++){const m=this._getPointAtLength(f);if(!m)return;let x=this._getTextSize(u[h]).width+r;if(u[h]===" "&&i==="justify"){const C=this.text().split(" ").length-1;x+=(this.pathLength-l)/C}const y=this._getPointAtLength(f+x);if(!y)return;const w=ga.Path.getLineLength(m.x,m.y,y.x,y.y);let E=0;if(s)try{E=s(u[h-1],u[h])*this.fontSize()}catch{E=0}m.x+=E,y.x+=E,this.textWidth+=E;const _=ga.Path.getPointOnLine(E+w/2,m.x,m.y,y.x,y.y),S=Math.atan2(y.y-m.y,y.x-m.x);this.glyphInfo.push({transposeX:_.x,transposeY:_.y,text:u[h],rotation:S,p0:m,p1:y}),f+=x}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(f){e.push(f.p0.x),e.push(f.p0.y),e.push(f.p1.x),e.push(f.p1.y)});let n=e[0]||0,r=e[0]||0,i=e[1]||0,s=e[1]||0,l,c;for(let f=0;f<e.length/2;f++)l=e[f*2],c=e[f*2+1],n=Math.min(n,l),r=Math.max(r,l),i=Math.min(i,c),s=Math.max(s,c);const u=this.fontSize();return{x:n-u/2,y:i-u/2,width:r-n+u,height:s-i+u}}destroy(){return Hh.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}hd.TextPath=St;St.prototype._fillFunc=e4;St.prototype._strokeFunc=t4;St.prototype._fillFuncHit=e4;St.prototype._strokeFuncHit=t4;St.prototype.className="TextPath";St.prototype._attrsAffectingSize=["text","fontSize","data"];(0,Fk._registerNode)(St);or.Factory.addGetterSetter(St,"data");or.Factory.addGetterSetter(St,"fontFamily","Arial");or.Factory.addGetterSetter(St,"fontSize",12,(0,q5.getNumberValidator)());or.Factory.addGetterSetter(St,"fontStyle",J5);or.Factory.addGetterSetter(St,"align","left");or.Factory.addGetterSetter(St,"letterSpacing",0,(0,q5.getNumberValidator)());or.Factory.addGetterSetter(St,"textBaseline","middle");or.Factory.addGetterSetter(St,"fontVariant",J5);or.Factory.addGetterSetter(St,"text",jk);or.Factory.addGetterSetter(St,"textDecoration","");or.Factory.addGetterSetter(St,"kerningFunc",void 0);var pd={};Object.defineProperty(pd,"__esModule",{value:!0});pd.Transformer=void 0;const Ge=at,Be=Me,h2=tt,Ok=_t,Dk=ml,p2=Ao,Qn=Pe,Oi=we,zk=Pe,n4="tr-konva",Bk=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(t=>t+`.${n4}`).join(" "),g2="nodesRect",Uk=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],Gk={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Vk="ontouchstart"in Qn.Konva._global;function Wk(t,e,n){if(t==="rotater")return n;e+=Ge.Util.degToRad(Gk[t]||0);const r=(Ge.Util.radToDeg(e)%360+360)%360;return Ge.Util._inRange(r,315+22.5,360)||Ge.Util._inRange(r,0,22.5)?"ns-resize":Ge.Util._inRange(r,45-22.5,45+22.5)?"nesw-resize":Ge.Util._inRange(r,90-22.5,90+22.5)?"ew-resize":Ge.Util._inRange(r,135-22.5,135+22.5)?"nwse-resize":Ge.Util._inRange(r,180-22.5,180+22.5)?"ns-resize":Ge.Util._inRange(r,225-22.5,225+22.5)?"nesw-resize":Ge.Util._inRange(r,270-22.5,270+22.5)?"ew-resize":Ge.Util._inRange(r,315-22.5,315+22.5)?"nwse-resize":(Ge.Util.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}const Ec=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],m2=1e8;function $k(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}function r4(t,e,n){const r=n.x+(t.x-n.x)*Math.cos(e)-(t.y-n.y)*Math.sin(e),i=n.y+(t.x-n.x)*Math.sin(e)+(t.y-n.y)*Math.cos(e);return{...t,rotation:t.rotation+e,x:r,y:i}}function Hk(t,e){const n=$k(t);return r4(t,e,n)}function Xk(t,e,n){let r=e;for(let i=0;i<t.length;i++){const s=Qn.Konva.getAngle(t[i]),l=Math.abs(s-e)%(Math.PI*2);Math.min(l,Math.PI*2-l)<n&&(r=s)}return r}let op=0;class Re extends p2.Group{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Bk,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return Ge.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return n4+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const n=e.filter(i=>i.isAncestorOf(this)?(Ge.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=n,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(i=>{const s=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(i._attrsAffectingSize.length){const l=i._attrsAffectingSize.map(c=>c+"Change."+this._getEventNamespace()).join(" ");i.on(l,s)}i.on(Uk.map(l=>l+`.${this._getEventNamespace()}`).join(" "),s),i.on(`absoluteTransformChange.${this._getEventNamespace()}`,s),this._proxyDrag(i)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let n;e.on(`dragstart.${this._getEventNamespace()}`,r=>{n=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(r,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!n)return;const i=e.getAbsolutePosition(),s=i.x-n.x,l=i.y-n.y;this.nodes().forEach(c=>{if(c===e||c.isDragging())return;const u=c.getAbsolutePosition();c.setAbsolutePosition({x:u.x+s,y:u.y+l}),c.startDrag(r)}),n=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(g2),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(g2,this.__getNodeRect)}__getNodeShape(e,n=this.rotation(),r){const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=e.getAbsoluteScale(r),l=e.getAbsolutePosition(r),c=i.x*s.x-e.offsetX()*s.x,u=i.y*s.y-e.offsetY()*s.y,f=(Qn.Konva.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),h={x:l.x+c*Math.cos(f)+u*Math.sin(-f),y:l.y+u*Math.cos(f)+c*Math.sin(f),width:i.width*s.x,height:i.height*s.y,rotation:f};return r4(h,-Qn.Konva.getAngle(n),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-m2,y:-m2,width:0,height:0,rotation:0};const n=[];this.nodes().map(f=>{const h=f.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),m=[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}],x=f.getAbsoluteTransform();m.forEach(function(y){const w=x.point(y);n.push(w)})});const r=new Ge.Transform;r.rotate(-Qn.Konva.getAngle(this.rotation()));let i=1/0,s=1/0,l=-1/0,c=-1/0;n.forEach(function(f){const h=r.point(f);i===void 0&&(i=l=h.x,s=c=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),c=Math.max(c,h.y)}),r.invert();const u=r.point({x:i,y:s});return{x:u.x,y:u.y,width:l-i,height:c-s,rotation:Qn.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Ec.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const n=new Dk.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Vk?10:"auto"}),r=this;n.on("mousedown touchstart",function(i){r._handleMouseDown(i)}),n.on("dragstart",i=>{n.stopDrag(),i.cancelBubble=!0}),n.on("dragend",i=>{i.cancelBubble=!0}),n.on("mouseenter",()=>{const i=Qn.Konva.getAngle(this.rotation()),s=this.rotateAnchorCursor(),l=Wk(e,i,s);n.getStage().content&&(n.getStage().content.style.cursor=l),this._cursorChange=!0}),n.on("mouseout",()=>{n.getStage().content&&(n.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(n)}_createBack(){const e=new Ok.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(n,r){const i=r.getParent(),s=i.padding();n.beginPath(),n.rect(-s,-s,r.width()+s*2,r.height()+s*2),n.moveTo(r.width()/2,-s),i.rotateEnabled()&&i.rotateLineVisible()&&n.lineTo(r.width()/2,-i.rotateAnchorOffset()*Ge.Util._sign(r.height())-s),n.fillStrokeShape(r)},hitFunc:(n,r)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();n.beginPath(),n.rect(-i,-i,r.width()+i*2,r.height()+i*2),n.fillStrokeShape(r)}});this.add(e),this._proxyDrag(e),e.on("dragstart",n=>{n.cancelBubble=!0}),e.on("dragmove",n=>{n.cancelBubble=!0}),e.on("dragend",n=>{n.cancelBubble=!0}),this.on("dragmove",n=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const n=this._getNodeRect(),r=n.width,i=n.height,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));this.sin=Math.abs(i/s),this.cos=Math.abs(r/s),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const l=e.target.getAbsolutePosition(),c=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:c.x-l.x,y:c.y-l.y},op++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(u=>{u._fire("transformstart",{evt:e.evt,target:u})})}_handleMouseMove(e){let n,r,i;const s=this.findOne("."+this._movingAnchorName),l=s.getStage();l.setPointersPositions(e);const c=l.getPointerPosition();let u={x:c.x-this._anchorDragOffset.x,y:c.y-this._anchorDragOffset.y};const f=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(u=this.anchorDragBoundFunc()(f,u,e)),s.setAbsolutePosition(u);const h=s.getAbsolutePosition();if(f.x===h.x&&f.y===h.y)return;if(this._movingAnchorName==="rotater"){const T=this._getNodeRect();n=s.x()-T.width/2,r=-s.y()+T.height/2;let N=Math.atan2(-r,n)+Math.PI/2;T.height<0&&(N-=Math.PI);const A=Qn.Konva.getAngle(this.rotation())+N,R=Qn.Konva.getAngle(this.rotationSnapTolerance()),I=Xk(this.rotationSnaps(),A,R)-T.rotation,O=Hk(T,I);this._fitNodesInto(O,e);return}const m=this.shiftBehavior();let x;m==="inverted"?x=this.keepRatio()&&!e.shiftKey:m==="none"?x=this.keepRatio():x=this.keepRatio()||e.shiftKey;var S=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(x){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(y.x-s.x(),2)+Math.pow(y.y-s.y(),2));var w=this.findOne(".top-left").x()>y.x?-1:1,E=this.findOne(".top-left").y()>y.y?-1:1;n=i*this.cos*w,r=i*this.sin*E,this.findOne(".top-left").x(y.x-n),this.findOne(".top-left").y(y.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(s.y());else if(this._movingAnchorName==="top-right"){if(x){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(s.x()-y.x,2)+Math.pow(y.y-s.y(),2));var w=this.findOne(".top-right").x()<y.x?-1:1,E=this.findOne(".top-right").y()>y.y?-1:1;n=i*this.cos*w,r=i*this.sin*E,this.findOne(".top-right").x(y.x+n),this.findOne(".top-right").y(y.y-r)}var _=s.position();this.findOne(".top-left").y(_.y),this.findOne(".bottom-right").x(_.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(s.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(s.x());else if(this._movingAnchorName==="bottom-left"){if(x){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(y.x-s.x(),2)+Math.pow(s.y()-y.y,2));var w=y.x<s.x()?-1:1,E=s.y()<y.y?-1:1;n=i*this.cos*w,r=i*this.sin*E,s.x(y.x-n),s.y(y.y+r)}_=s.position(),this.findOne(".top-left").x(_.x),this.findOne(".bottom-right").y(_.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(s.y());else if(this._movingAnchorName==="bottom-right"){if(x){var y=S?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(s.x()-y.x,2)+Math.pow(s.y()-y.y,2));var w=this.findOne(".bottom-right").x()<y.x?-1:1,E=this.findOne(".bottom-right").y()<y.y?-1:1;n=i*this.cos*w,r=i*this.sin*E,this.findOne(".bottom-right").x(y.x+n),this.findOne(".bottom-right").y(y.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var S=this.centeredScaling()||e.altKey;if(S){const T=this.findOne(".top-left"),N=this.findOne(".bottom-right"),L=T.x(),A=T.y(),R=this.getWidth()-N.x(),M=this.getHeight()-N.y();N.move({x:-L,y:-A}),T.move({x:R,y:M})}const C=this.findOne(".top-left").getAbsolutePosition();n=C.x,r=C.y;const g=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),k=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:n,y:r,width:g,height:k,rotation:Qn.Konva.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var n;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const r=this.getNode();op--,this._fire("transformend",{evt:e,target:r}),(n=this.getLayer())===null||n===void 0||n.batchDraw(),r&&this._nodes.forEach(i=>{var s;i._fire("transformend",{evt:e,target:i}),(s=i.getLayer())===null||s===void 0||s.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,n){const r=this._getNodeRect(),i=1;if(Ge.Util._inRange(e.width,-this.padding()*2-i,i)){this.update();return}if(Ge.Util._inRange(e.height,-this.padding()*2-i,i)){this.update();return}const s=new Ge.Transform;if(s.rotate(Qn.Konva.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const x=s.point({x:-this.padding()*2,y:0});e.x+=x.x,e.y+=x.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const x=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const x=s.point({x:0,y:-this.padding()*2});e.x+=x.x,e.y+=x.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const x=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=x.x,this._anchorDragOffset.y-=x.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){const x=this.boundBoxFunc()(r,e);x?e=x:Ge.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const l=1e7,c=new Ge.Transform;c.translate(r.x,r.y),c.rotate(r.rotation),c.scale(r.width/l,r.height/l);const u=new Ge.Transform,f=e.width/l,h=e.height/l;this.flipEnabled()===!1?(u.translate(e.x,e.y),u.rotate(e.rotation),u.translate(e.width<0?e.width:0,e.height<0?e.height:0),u.scale(Math.abs(f),Math.abs(h))):(u.translate(e.x,e.y),u.rotate(e.rotation),u.scale(f,h));const m=u.multiply(c.invert());this._nodes.forEach(x=>{var y;const w=x.getParent().getAbsoluteTransform(),E=x.getTransform().copy();E.translate(x.offsetX(),x.offsetY());const _=new Ge.Transform;_.multiply(w.copy().invert()).multiply(m).multiply(w).multiply(E);const S=_.decompose();x.setAttrs(S),(y=x.getLayer())===null||y===void 0||y.batchDraw()}),this.rotation(Ge.Util._getRotation(e.rotation)),this._nodes.forEach(x=>{this._fire("transform",{evt:n,target:x}),x._fire("transform",{evt:n,target:x})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,n){this.findOne(e).setAttrs(n)}update(){var e;const n=this._getNodeRect();this.rotation(Ge.Util._getRotation(n.rotation));const r=n.width,i=n.height,s=this.enabledAnchors(),l=this.resizeEnabled(),c=this.padding(),u=this.anchorSize(),f=this.find("._anchor");f.forEach(m=>{m.setAttrs({width:u,height:u,offsetX:u/2,offsetY:u/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:u/2+c,offsetY:u/2+c,visible:l&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:u/2+c,visible:l&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:u/2-c,offsetY:u/2+c,visible:l&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:u/2+c,visible:l&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:i/2,offsetX:u/2-c,visible:l&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:u/2+c,offsetY:u/2-c,visible:l&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:i,offsetY:u/2-c,visible:l&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:i,offsetX:u/2-c,offsetY:u/2-c,visible:l&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*Ge.Util._sign(i)-c,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const h=this.anchorStyleFunc();h&&f.forEach(m=>{h(m)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),p2.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return h2.Node.prototype.toObject.call(this)}clone(e){return h2.Node.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}pd.Transformer=Re;Re.isTransforming=()=>op>0;function Yk(t){return t instanceof Array||Ge.Util.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach(function(e){Ec.indexOf(e)===-1&&Ge.Util.warn("Unknown anchor name: "+e+". Available names are: "+Ec.join(", "))}),t||[]}Re.prototype.className="Transformer";(0,zk._registerNode)(Re);Be.Factory.addGetterSetter(Re,"enabledAnchors",Ec,Yk);Be.Factory.addGetterSetter(Re,"flipEnabled",!0,(0,Oi.getBooleanValidator)());Be.Factory.addGetterSetter(Re,"resizeEnabled",!0);Be.Factory.addGetterSetter(Re,"anchorSize",10,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"rotateEnabled",!0);Be.Factory.addGetterSetter(Re,"rotateLineVisible",!0);Be.Factory.addGetterSetter(Re,"rotationSnaps",[]);Be.Factory.addGetterSetter(Re,"rotateAnchorOffset",50,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"rotateAnchorCursor","crosshair");Be.Factory.addGetterSetter(Re,"rotationSnapTolerance",5,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"borderEnabled",!0);Be.Factory.addGetterSetter(Re,"anchorStroke","rgb(0, 161, 255)");Be.Factory.addGetterSetter(Re,"anchorStrokeWidth",1,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"anchorFill","white");Be.Factory.addGetterSetter(Re,"anchorCornerRadius",0,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"borderStroke","rgb(0, 161, 255)");Be.Factory.addGetterSetter(Re,"borderStrokeWidth",1,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"borderDash");Be.Factory.addGetterSetter(Re,"keepRatio",!0);Be.Factory.addGetterSetter(Re,"shiftBehavior","default");Be.Factory.addGetterSetter(Re,"centeredScaling",!1);Be.Factory.addGetterSetter(Re,"ignoreStroke",!1);Be.Factory.addGetterSetter(Re,"padding",0,(0,Oi.getNumberValidator)());Be.Factory.addGetterSetter(Re,"nodes");Be.Factory.addGetterSetter(Re,"node");Be.Factory.addGetterSetter(Re,"boundBoxFunc");Be.Factory.addGetterSetter(Re,"anchorDragBoundFunc");Be.Factory.addGetterSetter(Re,"anchorStyleFunc");Be.Factory.addGetterSetter(Re,"shouldOverdrawWholeArea",!1);Be.Factory.addGetterSetter(Re,"useSingleNodeRotation",!0);Be.Factory.backCompat(Re,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});var gd={};Object.defineProperty(gd,"__esModule",{value:!0});gd.Wedge=void 0;const md=Me,Kk=_t,Qk=Pe,i4=we,Zk=Pe;class Kr extends Kk.Shape{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,Qk.Konva.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}gd.Wedge=Kr;Kr.prototype.className="Wedge";Kr.prototype._centroid=!0;Kr.prototype._attrsAffectingSize=["radius"];(0,Zk._registerNode)(Kr);md.Factory.addGetterSetter(Kr,"radius",0,(0,i4.getNumberValidator)());md.Factory.addGetterSetter(Kr,"angle",0,(0,i4.getNumberValidator)());md.Factory.addGetterSetter(Kr,"clockwise",!1);md.Factory.backCompat(Kr,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var yd={};Object.defineProperty(yd,"__esModule",{value:!0});yd.Blur=void 0;const y2=Me,qk=tt,Jk=we;function v2(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const eC=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],tC=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function nC(t,e){const n=t.data,r=t.width,i=t.height;let s,l,c,u,f,h,m,x,y,w,E,_,S,C,g,k,T,N,L,A,R,M,I,O;const W=e+e+1,B=r-1,D=i-1,$=e+1,X=$*($+1)/2,F=new v2,U=eC[e],G=tC[e];let K=null,Q=F,Z=null,se=null;for(c=1;c<W;c++)Q=Q.next=new v2,c===$&&(K=Q);for(Q.next=F,m=h=0,l=0;l<i;l++){for(k=T=N=L=x=y=w=E=0,_=$*(A=n[h]),S=$*(R=n[h+1]),C=$*(M=n[h+2]),g=$*(I=n[h+3]),x+=X*A,y+=X*R,w+=X*M,E+=X*I,Q=F,c=0;c<$;c++)Q.r=A,Q.g=R,Q.b=M,Q.a=I,Q=Q.next;for(c=1;c<$;c++)u=h+((B<c?B:c)<<2),x+=(Q.r=A=n[u])*(O=$-c),y+=(Q.g=R=n[u+1])*O,w+=(Q.b=M=n[u+2])*O,E+=(Q.a=I=n[u+3])*O,k+=A,T+=R,N+=M,L+=I,Q=Q.next;for(Z=F,se=K,s=0;s<r;s++)n[h+3]=I=E*U>>G,I!==0?(I=255/I,n[h]=(x*U>>G)*I,n[h+1]=(y*U>>G)*I,n[h+2]=(w*U>>G)*I):n[h]=n[h+1]=n[h+2]=0,x-=_,y-=S,w-=C,E-=g,_-=Z.r,S-=Z.g,C-=Z.b,g-=Z.a,u=m+((u=s+e+1)<B?u:B)<<2,k+=Z.r=n[u],T+=Z.g=n[u+1],N+=Z.b=n[u+2],L+=Z.a=n[u+3],x+=k,y+=T,w+=N,E+=L,Z=Z.next,_+=A=se.r,S+=R=se.g,C+=M=se.b,g+=I=se.a,k-=A,T-=R,N-=M,L-=I,se=se.next,h+=4;m+=r}for(s=0;s<r;s++){for(T=N=L=k=y=w=E=x=0,h=s<<2,_=$*(A=n[h]),S=$*(R=n[h+1]),C=$*(M=n[h+2]),g=$*(I=n[h+3]),x+=X*A,y+=X*R,w+=X*M,E+=X*I,Q=F,c=0;c<$;c++)Q.r=A,Q.g=R,Q.b=M,Q.a=I,Q=Q.next;for(f=r,c=1;c<=e;c++)h=f+s<<2,x+=(Q.r=A=n[h])*(O=$-c),y+=(Q.g=R=n[h+1])*O,w+=(Q.b=M=n[h+2])*O,E+=(Q.a=I=n[h+3])*O,k+=A,T+=R,N+=M,L+=I,Q=Q.next,c<D&&(f+=r);for(h=s,Z=F,se=K,l=0;l<i;l++)u=h<<2,n[u+3]=I=E*U>>G,I>0?(I=255/I,n[u]=(x*U>>G)*I,n[u+1]=(y*U>>G)*I,n[u+2]=(w*U>>G)*I):n[u]=n[u+1]=n[u+2]=0,x-=_,y-=S,w-=C,E-=g,_-=Z.r,S-=Z.g,C-=Z.b,g-=Z.a,u=s+((u=l+$)<D?u:D)*r<<2,x+=k+=Z.r=n[u],y+=T+=Z.g=n[u+1],w+=N+=Z.b=n[u+2],E+=L+=Z.a=n[u+3],Z=Z.next,_+=A=se.r,S+=R=se.g,C+=M=se.b,g+=I=se.a,k-=A,T-=R,N-=M,L-=I,se=se.next,h+=r}}const rC=function(e){const n=Math.round(this.blurRadius());n>0&&nC(e,n)};yd.Blur=rC;y2.Factory.addGetterSetter(qk.Node,"blurRadius",0,(0,Jk.getNumberValidator)(),y2.Factory.afterSetFilter);var vd={};Object.defineProperty(vd,"__esModule",{value:!0});vd.Brighten=void 0;const x2=Me,iC=tt,sC=we,oC=function(t){const e=this.brightness()*255,n=t.data,r=n.length;for(let i=0;i<r;i+=4)n[i]+=e,n[i+1]+=e,n[i+2]+=e};vd.Brighten=oC;x2.Factory.addGetterSetter(iC.Node,"brightness",0,(0,sC.getNumberValidator)(),x2.Factory.afterSetFilter);var xd={};Object.defineProperty(xd,"__esModule",{value:!0});xd.Contrast=void 0;const w2=Me,aC=tt,lC=we,uC=function(t){const e=Math.pow((this.contrast()+100)/100,2),n=t.data,r=n.length;let i=150,s=150,l=150;for(let c=0;c<r;c+=4)i=n[c],s=n[c+1],l=n[c+2],i/=255,i-=.5,i*=e,i+=.5,i*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,l/=255,l-=.5,l*=e,l+=.5,l*=255,i=i<0?0:i>255?255:i,s=s<0?0:s>255?255:s,l=l<0?0:l>255?255:l,n[c]=i,n[c+1]=s,n[c+2]=l};xd.Contrast=uC;w2.Factory.addGetterSetter(aC.Node,"contrast",0,(0,lC.getNumberValidator)(),w2.Factory.afterSetFilter);var wd={};Object.defineProperty(wd,"__esModule",{value:!0});wd.Emboss=void 0;const Pi=Me,_d=tt,cC=at,s4=we,dC=function(t){const e=this.embossStrength()*10,n=this.embossWhiteLevel()*255,r=this.embossDirection(),i=this.embossBlend(),s=t.data,l=t.width,c=t.height,u=l*4;let f=0,h=0,m=c;switch(r){case"top-left":f=-1,h=-1;break;case"top":f=-1,h=0;break;case"top-right":f=-1,h=1;break;case"right":f=0,h=1;break;case"bottom-right":f=1,h=1;break;case"bottom":f=1,h=0;break;case"bottom-left":f=1,h=-1;break;case"left":f=0,h=-1;break;default:cC.Util.error("Unknown emboss direction: "+r)}do{const x=(m-1)*u;let y=f;m+y<1&&(y=0),m+y>c&&(y=0);const w=(m-1+y)*l*4;let E=l;do{const _=x+(E-1)*4;let S=h;E+S<1&&(S=0),E+S>l&&(S=0);const C=w+(E-1+S)*4,g=s[_]-s[C],k=s[_+1]-s[C+1],T=s[_+2]-s[C+2];let N=g;const L=N>0?N:-N,A=k>0?k:-k,R=T>0?T:-T;if(A>L&&(N=k),R>L&&(N=T),N*=e,i){const M=s[_]+N,I=s[_+1]+N,O=s[_+2]+N;s[_]=M>255?255:M<0?0:M,s[_+1]=I>255?255:I<0?0:I,s[_+2]=O>255?255:O<0?0:O}else{let M=n-N;M<0?M=0:M>255&&(M=255),s[_]=s[_+1]=s[_+2]=M}}while(--E)}while(--m)};wd.Emboss=dC;Pi.Factory.addGetterSetter(_d.Node,"embossStrength",.5,(0,s4.getNumberValidator)(),Pi.Factory.afterSetFilter);Pi.Factory.addGetterSetter(_d.Node,"embossWhiteLevel",.5,(0,s4.getNumberValidator)(),Pi.Factory.afterSetFilter);Pi.Factory.addGetterSetter(_d.Node,"embossDirection","top-left",void 0,Pi.Factory.afterSetFilter);Pi.Factory.addGetterSetter(_d.Node,"embossBlend",!1,void 0,Pi.Factory.afterSetFilter);var Sd={};Object.defineProperty(Sd,"__esModule",{value:!0});Sd.Enhance=void 0;const _2=Me,fC=tt,hC=we;function Yh(t,e,n,r,i){const s=n-e,l=i-r;if(s===0)return r+l/2;if(l===0)return r;let c=(t-e)/s;return c=l*c+r,c}const pC=function(t){const e=t.data,n=e.length;let r=e[0],i=r,s,l=e[1],c=l,u,f=e[2],h=f,m;const x=this.enhance();if(x===0)return;for(let N=0;N<n;N+=4)s=e[N+0],s<r?r=s:s>i&&(i=s),u=e[N+1],u<l?l=u:u>c&&(c=u),m=e[N+2],m<f?f=m:m>h&&(h=m);i===r&&(i=255,r=0),c===l&&(c=255,l=0),h===f&&(h=255,f=0);let y,w,E,_,S,C,g,k,T;x>0?(w=i+x*(255-i),E=r-x*(r-0),S=c+x*(255-c),C=l-x*(l-0),k=h+x*(255-h),T=f-x*(f-0)):(y=(i+r)*.5,w=i+x*(i-y),E=r+x*(r-y),_=(c+l)*.5,S=c+x*(c-_),C=l+x*(l-_),g=(h+f)*.5,k=h+x*(h-g),T=f+x*(f-g));for(let N=0;N<n;N+=4)e[N+0]=Yh(e[N+0],r,i,E,w),e[N+1]=Yh(e[N+1],l,c,C,S),e[N+2]=Yh(e[N+2],f,h,T,k)};Sd.Enhance=pC;_2.Factory.addGetterSetter(fC.Node,"enhance",0,(0,hC.getNumberValidator)(),_2.Factory.afterSetFilter);var kd={};Object.defineProperty(kd,"__esModule",{value:!0});kd.Grayscale=void 0;const gC=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4){const i=.34*e[r]+.5*e[r+1]+.16*e[r+2];e[r]=i,e[r+1]=i,e[r+2]=i}};kd.Grayscale=gC;var Cd={};Object.defineProperty(Cd,"__esModule",{value:!0});Cd.HSL=void 0;const _o=Me,yg=tt,vg=we;_o.Factory.addGetterSetter(yg.Node,"hue",0,(0,vg.getNumberValidator)(),_o.Factory.afterSetFilter);_o.Factory.addGetterSetter(yg.Node,"saturation",0,(0,vg.getNumberValidator)(),_o.Factory.afterSetFilter);_o.Factory.addGetterSetter(yg.Node,"luminance",0,(0,vg.getNumberValidator)(),_o.Factory.afterSetFilter);const mC=function(t){const e=t.data,n=e.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,l=this.luminance()*127,c=r*i*Math.cos(s*Math.PI/180),u=r*i*Math.sin(s*Math.PI/180),f=.299*r+.701*c+.167*u,h=.587*r-.587*c+.33*u,m=.114*r-.114*c-.497*u,x=.299*r-.299*c-.328*u,y=.587*r+.413*c+.035*u,w=.114*r-.114*c+.293*u,E=.299*r-.3*c+1.25*u,_=.587*r-.586*c-1.05*u,S=.114*r+.886*c-.2*u;let C,g,k,T;for(let N=0;N<n;N+=4)C=e[N+0],g=e[N+1],k=e[N+2],T=e[N+3],e[N+0]=f*C+h*g+m*k+l,e[N+1]=x*C+y*g+w*k+l,e[N+2]=E*C+_*g+S*k+l,e[N+3]=T};Cd.HSL=mC;var Td={};Object.defineProperty(Td,"__esModule",{value:!0});Td.HSV=void 0;const So=Me,xg=tt,wg=we,yC=function(t){const e=t.data,n=e.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,l=r*i*Math.cos(s*Math.PI/180),c=r*i*Math.sin(s*Math.PI/180),u=.299*r+.701*l+.167*c,f=.587*r-.587*l+.33*c,h=.114*r-.114*l-.497*c,m=.299*r-.299*l-.328*c,x=.587*r+.413*l+.035*c,y=.114*r-.114*l+.293*c,w=.299*r-.3*l+1.25*c,E=.587*r-.586*l-1.05*c,_=.114*r+.886*l-.2*c;let S,C,g,k;for(let T=0;T<n;T+=4)S=e[T+0],C=e[T+1],g=e[T+2],k=e[T+3],e[T+0]=u*S+f*C+h*g,e[T+1]=m*S+x*C+y*g,e[T+2]=w*S+E*C+_*g,e[T+3]=k};Td.HSV=yC;So.Factory.addGetterSetter(xg.Node,"hue",0,(0,wg.getNumberValidator)(),So.Factory.afterSetFilter);So.Factory.addGetterSetter(xg.Node,"saturation",0,(0,wg.getNumberValidator)(),So.Factory.afterSetFilter);So.Factory.addGetterSetter(xg.Node,"value",0,(0,wg.getNumberValidator)(),So.Factory.afterSetFilter);var Ed={};Object.defineProperty(Ed,"__esModule",{value:!0});Ed.Invert=void 0;const vC=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]};Ed.Invert=vC;var bd={};Object.defineProperty(bd,"__esModule",{value:!0});bd.Kaleidoscope=void 0;const bc=Me,o4=tt,S2=at,a4=we,xC=function(t,e,n){const r=t.data,i=e.data,s=t.width,l=t.height,c=n.polarCenterX||s/2,u=n.polarCenterY||l/2;let f=Math.sqrt(c*c+u*u),h=s-c,m=l-u;const x=Math.sqrt(h*h+m*m);f=x>f?x:f;const y=l,w=s,E=360/w*Math.PI/180;for(let _=0;_<w;_+=1){const S=Math.sin(_*E),C=Math.cos(_*E);for(let g=0;g<y;g+=1){h=Math.floor(c+f*g/y*C),m=Math.floor(u+f*g/y*S);let k=(m*s+h)*4;const T=r[k+0],N=r[k+1],L=r[k+2],A=r[k+3];k=(_+g*s)*4,i[k+0]=T,i[k+1]=N,i[k+2]=L,i[k+3]=A}}},wC=function(t,e,n){const r=t.data,i=e.data,s=t.width,l=t.height,c=n.polarCenterX||s/2,u=n.polarCenterY||l/2;let f=Math.sqrt(c*c+u*u),h=s-c,m=l-u;const x=Math.sqrt(h*h+m*m);f=x>f?x:f;const y=l,w=s,E=n.polarRotation||0;let _,S;for(h=0;h<s;h+=1)for(m=0;m<l;m+=1){const C=h-c,g=m-u,k=Math.sqrt(C*C+g*g)*y/f;let T=(Math.atan2(g,C)*180/Math.PI+360+E)%360;T=T*w/360,_=Math.floor(T),S=Math.floor(k);let N=(S*s+_)*4;const L=r[N+0],A=r[N+1],R=r[N+2],M=r[N+3];N=(m*s+h)*4,i[N+0]=L,i[N+1]=A,i[N+2]=R,i[N+3]=M}},_C=function(t){const e=t.width,n=t.height;let r,i,s,l,c,u,f,h,m,x,y=Math.round(this.kaleidoscopePower());const w=Math.round(this.kaleidoscopeAngle()),E=Math.floor(e*(w%360)/360);if(y<1)return;const _=S2.Util.createCanvasElement();_.width=e,_.height=n;const S=_.getContext("2d").getImageData(0,0,e,n);S2.Util.releaseCanvas(_),xC(t,S,{polarCenterX:e/2,polarCenterY:n/2});let C=e/Math.pow(2,y);for(;C<=8;)C=C*2,y-=1;C=Math.ceil(C);let g=C,k=0,T=g,N=1;for(E+C>e&&(k=g,T=0,N=-1),i=0;i<n;i+=1)for(r=k;r!==T;r+=N)s=Math.round(r+E)%e,m=(e*i+s)*4,c=S.data[m+0],u=S.data[m+1],f=S.data[m+2],h=S.data[m+3],x=(e*i+r)*4,S.data[x+0]=c,S.data[x+1]=u,S.data[x+2]=f,S.data[x+3]=h;for(i=0;i<n;i+=1)for(g=Math.floor(C),l=0;l<y;l+=1){for(r=0;r<g+1;r+=1)m=(e*i+r)*4,c=S.data[m+0],u=S.data[m+1],f=S.data[m+2],h=S.data[m+3],x=(e*i+g*2-r-1)*4,S.data[x+0]=c,S.data[x+1]=u,S.data[x+2]=f,S.data[x+3]=h;g*=2}wC(S,t,{polarRotation:0})};bd.Kaleidoscope=_C;bc.Factory.addGetterSetter(o4.Node,"kaleidoscopePower",2,(0,a4.getNumberValidator)(),bc.Factory.afterSetFilter);bc.Factory.addGetterSetter(o4.Node,"kaleidoscopeAngle",0,(0,a4.getNumberValidator)(),bc.Factory.afterSetFilter);var Pd={};Object.defineProperty(Pd,"__esModule",{value:!0});Pd.Mask=void 0;const k2=Me,SC=tt,kC=we;function Iu(t,e,n){let r=(n*t.width+e)*4;const i=[];return i.push(t.data[r++],t.data[r++],t.data[r++],t.data[r++]),i}function ma(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function CC(t){const e=[0,0,0];for(let n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function TC(t,e){const n=Iu(t,0,0),r=Iu(t,t.width-1,0),i=Iu(t,0,t.height-1),s=Iu(t,t.width-1,t.height-1),l=e||10;if(ma(n,r)<l&&ma(r,s)<l&&ma(s,i)<l&&ma(i,n)<l){const c=CC([r,n,s,i]),u=[];for(let f=0;f<t.width*t.height;f++){const h=ma(c,[t.data[f*4],t.data[f*4+1],t.data[f*4+2]]);u[f]=h<l?0:255}return u}}function EC(t,e){for(let n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}function bC(t,e,n){const r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let h=0;for(let m=0;m<i;m++)for(let x=0;x<i;x++){const y=c+m-s,w=u+x-s;if(y>=0&&y<n&&w>=0&&w<e){const E=y*e+w,_=r[m*i+x];h+=t[E]*_}}l[f]=h===255*8?255:0}return l}function PC(t,e,n){const r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let h=0;for(let m=0;m<i;m++)for(let x=0;x<i;x++){const y=c+m-s,w=u+x-s;if(y>=0&&y<n&&w>=0&&w<e){const E=y*e+w,_=r[m*i+x];h+=t[E]*_}}l[f]=h>=255*4?255:0}return l}function NC(t,e,n){const r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),l=[];for(let c=0;c<n;c++)for(let u=0;u<e;u++){const f=c*e+u;let h=0;for(let m=0;m<i;m++)for(let x=0;x<i;x++){const y=c+m-s,w=u+x-s;if(y>=0&&y<n&&w>=0&&w<e){const E=y*e+w,_=r[m*i+x];h+=t[E]*_}}l[f]=h}return l}const MC=function(t){const e=this.threshold();let n=TC(t,e);return n&&(n=bC(n,t.width,t.height),n=PC(n,t.width,t.height),n=NC(n,t.width,t.height),EC(t,n)),t};Pd.Mask=MC;k2.Factory.addGetterSetter(SC.Node,"threshold",0,(0,kC.getNumberValidator)(),k2.Factory.afterSetFilter);var Nd={};Object.defineProperty(Nd,"__esModule",{value:!0});Nd.Noise=void 0;const C2=Me,AC=tt,IC=we,LC=function(t){const e=this.noise()*255,n=t.data,r=n.length,i=e/2;for(let s=0;s<r;s+=4)n[s+0]+=i-2*i*Math.random(),n[s+1]+=i-2*i*Math.random(),n[s+2]+=i-2*i*Math.random()};Nd.Noise=LC;C2.Factory.addGetterSetter(AC.Node,"noise",.2,(0,IC.getNumberValidator)(),C2.Factory.afterSetFilter);var Md={};Object.defineProperty(Md,"__esModule",{value:!0});Md.Pixelate=void 0;const T2=Me,RC=at,FC=tt,jC=we,OC=function(t){let e=Math.ceil(this.pixelSize()),n=t.width,r=t.height,i,s,l,c,u,f,h,m=Math.ceil(n/e),x=Math.ceil(r/e),y,w,E,_,S,C,g,k=t.data;if(e<=0){RC.Util.error("pixelSize value can not be <= 0");return}for(S=0;S<m;S+=1)for(C=0;C<x;C+=1){for(c=0,u=0,f=0,h=0,y=S*e,w=y+e,E=C*e,_=E+e,g=0,i=y;i<w;i+=1)if(!(i>=n))for(s=E;s<_;s+=1)s>=r||(l=(n*s+i)*4,c+=k[l+0],u+=k[l+1],f+=k[l+2],h+=k[l+3],g+=1);for(c=c/g,u=u/g,f=f/g,h=h/g,i=y;i<w;i+=1)if(!(i>=n))for(s=E;s<_;s+=1)s>=r||(l=(n*s+i)*4,k[l+0]=c,k[l+1]=u,k[l+2]=f,k[l+3]=h)}};Md.Pixelate=OC;T2.Factory.addGetterSetter(FC.Node,"pixelSize",8,(0,jC.getNumberValidator)(),T2.Factory.afterSetFilter);var Ad={};Object.defineProperty(Ad,"__esModule",{value:!0});Ad.Posterize=void 0;const E2=Me,DC=tt,zC=we,BC=function(t){const e=Math.round(this.levels()*254)+1,n=t.data,r=n.length,i=255/e;for(let s=0;s<r;s+=1)n[s]=Math.floor(n[s]/i)*i};Ad.Posterize=BC;E2.Factory.addGetterSetter(DC.Node,"levels",.5,(0,zC.getNumberValidator)(),E2.Factory.afterSetFilter);var Id={};Object.defineProperty(Id,"__esModule",{value:!0});Id.RGB=void 0;const Pc=Me,_g=tt,UC=we,GC=function(t){const e=t.data,n=e.length,r=this.red(),i=this.green(),s=this.blue();for(let l=0;l<n;l+=4){const c=(.34*e[l]+.5*e[l+1]+.16*e[l+2])/255;e[l]=c*r,e[l+1]=c*i,e[l+2]=c*s,e[l+3]=e[l+3]}};Id.RGB=GC;Pc.Factory.addGetterSetter(_g.Node,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});Pc.Factory.addGetterSetter(_g.Node,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});Pc.Factory.addGetterSetter(_g.Node,"blue",0,UC.RGBComponent,Pc.Factory.afterSetFilter);var Ld={};Object.defineProperty(Ld,"__esModule",{value:!0});Ld.RGBA=void 0;const tl=Me,Rd=tt,VC=we,WC=function(t){const e=t.data,n=e.length,r=this.red(),i=this.green(),s=this.blue(),l=this.alpha();for(let c=0;c<n;c+=4){const u=1-l;e[c]=r*l+e[c]*u,e[c+1]=i*l+e[c+1]*u,e[c+2]=s*l+e[c+2]*u}};Ld.RGBA=WC;tl.Factory.addGetterSetter(Rd.Node,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});tl.Factory.addGetterSetter(Rd.Node,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)});tl.Factory.addGetterSetter(Rd.Node,"blue",0,VC.RGBComponent,tl.Factory.afterSetFilter);tl.Factory.addGetterSetter(Rd.Node,"alpha",1,function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t});var Fd={};Object.defineProperty(Fd,"__esModule",{value:!0});Fd.Sepia=void 0;const $C=function(t){const e=t.data,n=e.length;for(let r=0;r<n;r+=4){const i=e[r+0],s=e[r+1],l=e[r+2];e[r+0]=Math.min(255,i*.393+s*.769+l*.189),e[r+1]=Math.min(255,i*.349+s*.686+l*.168),e[r+2]=Math.min(255,i*.272+s*.534+l*.131)}};Fd.Sepia=$C;var jd={};Object.defineProperty(jd,"__esModule",{value:!0});jd.Solarize=void 0;const HC=function(t){const e=t.data,n=t.width,r=t.height,i=n*4;let s=r;do{const l=(s-1)*i;let c=n;do{const u=l+(c-1)*4;let f=e[u],h=e[u+1],m=e[u+2];f>127&&(f=255-f),h>127&&(h=255-h),m>127&&(m=255-m),e[u]=f,e[u+1]=h,e[u+2]=m}while(--c)}while(--s)};jd.Solarize=HC;var Od={};Object.defineProperty(Od,"__esModule",{value:!0});Od.Threshold=void 0;const b2=Me,XC=tt,YC=we,KC=function(t){const e=this.threshold()*255,n=t.data,r=n.length;for(let i=0;i<r;i+=1)n[i]=n[i]<e?0:255};Od.Threshold=KC;b2.Factory.addGetterSetter(XC.Node,"threshold",.5,(0,YC.getNumberValidator)(),b2.Factory.afterSetFilter);Object.defineProperty(Xc,"__esModule",{value:!0});Xc.Konva=void 0;const P2=Cc,QC=qc,ZC=td,qC=id,JC=sd,eT=od,N2=wo,tT=pl,nT=Lo,rT=ml,iT=ud,sT=cd,oT=dd,aT=fd,lT=Fo,uT=hd,cT=pd,dT=gd,fT=yd,hT=vd,pT=xd,gT=wd,mT=Sd,yT=kd,vT=Cd,xT=Td,wT=Ed,_T=bd,ST=Pd,kT=Nd,CT=Md,TT=Ad,ET=Id,bT=Ld,PT=Fd,NT=jd,MT=Od;Xc.Konva=P2.Konva.Util._assign(P2.Konva,{Arc:QC.Arc,Arrow:ZC.Arrow,Circle:qC.Circle,Ellipse:JC.Ellipse,Image:eT.Image,Label:N2.Label,Tag:N2.Tag,Line:tT.Line,Path:nT.Path,Rect:rT.Rect,RegularPolygon:iT.RegularPolygon,Ring:sT.Ring,Sprite:oT.Sprite,Star:aT.Star,Text:lT.Text,TextPath:uT.TextPath,Transformer:cT.Transformer,Wedge:dT.Wedge,Filters:{Blur:fT.Blur,Brighten:hT.Brighten,Contrast:pT.Contrast,Emboss:gT.Emboss,Enhance:mT.Enhance,Grayscale:yT.Grayscale,HSL:vT.HSL,HSV:xT.HSV,Invert:wT.Invert,Kaleidoscope:_T.Kaleidoscope,Mask:ST.Mask,Noise:kT.Noise,Pixelate:CT.Pixelate,Posterize:TT.Posterize,RGB:ET.RGB,RGBA:bT.RGBA,Sepia:PT.Sepia,Solarize:NT.Solarize,Threshold:MT.Threshold}});var AT=P5.exports;Object.defineProperty(AT,"__esModule",{value:!0});const IT=Xc;P5.exports=IT.Konva;var ap={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var n=Cc;Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return n.Konva}});const r=Cc;t.exports=r.Konva})(ap,ap.exports);var LT=ap.exports;const nl=il(LT);var l4={exports:{}};/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RT=function(e){var n={},r=z,i=Sa,s=Object.assign;function l(o){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),f=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),w=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),k=Symbol.for("react.offscreen"),T=Symbol.iterator;function N(o){return o===null||typeof o!="object"?null:(o=T&&o[T]||o["@@iterator"],typeof o=="function"?o:null)}function L(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case h:return"Fragment";case f:return"Portal";case x:return"Profiler";case m:return"StrictMode";case _:return"Suspense";case S:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case w:return(o.displayName||"Context")+".Consumer";case y:return(o._context.displayName||"Context")+".Provider";case E:var a=o.render;return o=o.displayName,o||(o=a.displayName||a.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case C:return a=o.displayName||null,a!==null?a:L(o.type)||"Memo";case g:a=o._payload,o=o._init;try{return L(o(a))}catch{}}return null}function A(o){var a=o.type;switch(o.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=a.render,o=o.displayName||o.name||"",a.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return L(a);case 8:return a===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function R(o){var a=o,d=o;if(o.alternate)for(;a.return;)a=a.return;else{o=a;do a=o,a.flags&4098&&(d=a.return),o=a.return;while(o)}return a.tag===3?d:null}function M(o){if(R(o)!==o)throw Error(l(188))}function I(o){var a=o.alternate;if(!a){if(a=R(o),a===null)throw Error(l(188));return a!==o?null:o}for(var d=o,p=a;;){var v=d.return;if(v===null)break;var b=v.alternate;if(b===null){if(p=v.return,p!==null){d=p;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===d)return M(v),o;if(b===p)return M(v),a;b=b.sibling}throw Error(l(188))}if(d.return!==p.return)d=v,p=b;else{for(var j=!1,H=v.child;H;){if(H===d){j=!0,d=v,p=b;break}if(H===p){j=!0,p=v,d=b;break}H=H.sibling}if(!j){for(H=b.child;H;){if(H===d){j=!0,d=b,p=v;break}if(H===p){j=!0,p=b,d=v;break}H=H.sibling}if(!j)throw Error(l(189))}}if(d.alternate!==p)throw Error(l(190))}if(d.tag!==3)throw Error(l(188));return d.stateNode.current===d?o:a}function O(o){return o=I(o),o!==null?W(o):null}function W(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var a=W(o);if(a!==null)return a;o=o.sibling}return null}function B(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){if(o.tag!==4){var a=B(o);if(a!==null)return a}o=o.sibling}return null}var D=Array.isArray,$=e.getPublicInstance,X=e.getRootHostContext,F=e.getChildHostContext,U=e.prepareForCommit,G=e.resetAfterCommit,K=e.createInstance,Q=e.appendInitialChild,Z=e.finalizeInitialChildren,se=e.prepareUpdate,xe=e.shouldSetTextContent,ge=e.createTextInstance,V=e.scheduleTimeout,te=e.cancelTimeout,ae=e.noTimeout,ve=e.isPrimaryRenderer,ye=e.supportsMutation,ie=e.supportsPersistence,oe=e.supportsHydration,Ee=e.getInstanceFromNode,le=e.preparePortalMount,Se=e.getCurrentEventPriority,Ie=e.detachDeletedInstance,Fe=e.supportsMicrotasks,tn=e.scheduleMicrotask,Ot=e.supportsTestSelectors,ws=e.findFiberRoot,_s=e.getBoundingRect,Ss=e.getTextContent,ar=e.isHiddenSubtree,ks=e.matchAccessibilityRole,Nt=e.setFocusIfFocusable,Qr=e.setupIntersectionObserver,Cs=e.appendChild,yl=e.appendChildToContainer,ke=e.commitTextUpdate,Xe=e.commitMount,nn=e.commitUpdate,Zr=e.insertBefore,_4=e.insertInContainerBefore,S4=e.removeChild,k4=e.removeChildFromContainer,bg=e.resetTextContent,C4=e.hideInstance,T4=e.hideTextInstance,E4=e.unhideInstance,b4=e.unhideTextInstance,P4=e.clearContainer,N4=e.cloneInstance,Pg=e.createContainerChildSet,Ng=e.appendChildToContainerChildSet,M4=e.finalizeContainerChildren,Bd=e.replaceContainerChildren,Mg=e.cloneHiddenInstance,Ag=e.cloneHiddenTextInstance,A4=e.canHydrateInstance,I4=e.canHydrateTextInstance,L4=e.canHydrateSuspenseInstance,Ig=e.isSuspenseInstancePending,Ud=e.isSuspenseInstanceFallback,R4=e.getSuspenseInstanceFallbackErrorDetails,F4=e.registerSuspenseInstanceRetry,vl=e.getNextHydratableSibling,j4=e.getFirstHydratableChild,O4=e.getFirstHydratableChildWithinContainer,D4=e.getFirstHydratableChildWithinSuspenseInstance,z4=e.hydrateInstance,B4=e.hydrateTextInstance,U4=e.hydrateSuspenseInstance,G4=e.getNextHydratableInstanceAfterSuspenseInstance,V4=e.commitHydratedContainer,W4=e.commitHydratedSuspenseInstance,$4=e.clearSuspenseBoundary,H4=e.clearSuspenseBoundaryFromContainer,X4=e.shouldDeleteUnhydratedTailInstances,Y4=e.didNotMatchHydratedContainerTextInstance,K4=e.didNotMatchHydratedTextInstance,Gd;function jo(o){if(Gd===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);Gd=a&&a[1]||""}return`
`+Gd+o}var Vd=!1;function Wd(o,a){if(!o||Vd)return"";Vd=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(re){var p=re}Reflect.construct(o,[],a)}else{try{a.call()}catch(re){p=re}o.call(a.prototype)}else{try{throw Error()}catch(re){p=re}o()}}catch(re){if(re&&p&&typeof re.stack=="string"){for(var v=re.stack.split(`
`),b=p.stack.split(`
`),j=v.length-1,H=b.length-1;1<=j&&0<=H&&v[j]!==b[H];)H--;for(;1<=j&&0<=H;j--,H--)if(v[j]!==b[H]){if(j!==1||H!==1)do if(j--,H--,0>H||v[j]!==b[H]){var J=`
`+v[j].replace(" at new "," at ");return o.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",o.displayName)),J}while(1<=j&&0<=H);break}}}finally{Vd=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?jo(o):""}var Q4=Object.prototype.hasOwnProperty,$d=[],Ts=-1;function qr(o){return{current:o}}function Ye(o){0>Ts||(o.current=$d[Ts],$d[Ts]=null,Ts--)}function $e(o,a){Ts++,$d[Ts]=o.current,o.current=a}var Jr={},Dt=qr(Jr),rn=qr(!1),zi=Jr;function Es(o,a){var d=o.type.contextTypes;if(!d)return Jr;var p=o.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===a)return p.__reactInternalMemoizedMaskedChildContext;var v={},b;for(b in d)v[b]=a[b];return p&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=a,o.__reactInternalMemoizedMaskedChildContext=v),v}function sn(o){return o=o.childContextTypes,o!=null}function xl(){Ye(rn),Ye(Dt)}function Lg(o,a,d){if(Dt.current!==Jr)throw Error(l(168));$e(Dt,a),$e(rn,d)}function Rg(o,a,d){var p=o.stateNode;if(a=a.childContextTypes,typeof p.getChildContext!="function")return d;p=p.getChildContext();for(var v in p)if(!(v in a))throw Error(l(108,A(o)||"Unknown",v));return s({},d,p)}function wl(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Jr,zi=Dt.current,$e(Dt,o),$e(rn,rn.current),!0}function Fg(o,a,d){var p=o.stateNode;if(!p)throw Error(l(169));d?(o=Rg(o,a,zi),p.__reactInternalMemoizedMergedChildContext=o,Ye(rn),Ye(Dt),$e(Dt,o)):Ye(rn),$e(rn,d)}var Vn=Math.clz32?Math.clz32:J4,Z4=Math.log,q4=Math.LN2;function J4(o){return o>>>=0,o===0?32:31-(Z4(o)/q4|0)|0}var _l=64,Sl=4194304;function Oo(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function kl(o,a){var d=o.pendingLanes;if(d===0)return 0;var p=0,v=o.suspendedLanes,b=o.pingedLanes,j=d&268435455;if(j!==0){var H=j&~v;H!==0?p=Oo(H):(b&=j,b!==0&&(p=Oo(b)))}else j=d&~v,j!==0?p=Oo(j):b!==0&&(p=Oo(b));if(p===0)return 0;if(a!==0&&a!==p&&!(a&v)&&(v=p&-p,b=a&-a,v>=b||v===16&&(b&4194240)!==0))return a;if(p&4&&(p|=d&16),a=o.entangledLanes,a!==0)for(o=o.entanglements,a&=p;0<a;)d=31-Vn(a),v=1<<d,p|=o[d],a&=~v;return p}function e6(o,a){switch(o){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function t6(o,a){for(var d=o.suspendedLanes,p=o.pingedLanes,v=o.expirationTimes,b=o.pendingLanes;0<b;){var j=31-Vn(b),H=1<<j,J=v[j];J===-1?(!(H&d)||H&p)&&(v[j]=e6(H,a)):J<=a&&(o.expiredLanes|=H),b&=~H}}function Hd(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function jg(){var o=_l;return _l<<=1,!(_l&4194240)&&(_l=64),o}function Xd(o){for(var a=[],d=0;31>d;d++)a.push(o);return a}function Do(o,a,d){o.pendingLanes|=a,a!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,a=31-Vn(a),o[a]=d}function n6(o,a){var d=o.pendingLanes&~a;o.pendingLanes=a,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=a,o.mutableReadLanes&=a,o.entangledLanes&=a,a=o.entanglements;var p=o.eventTimes;for(o=o.expirationTimes;0<d;){var v=31-Vn(d),b=1<<v;a[v]=0,p[v]=-1,o[v]=-1,d&=~b}}function Yd(o,a){var d=o.entangledLanes|=a;for(o=o.entanglements;d;){var p=31-Vn(d),v=1<<p;v&a|o[p]&a&&(o[p]|=a),d&=~v}}var Oe=0;function Og(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var Kd=i.unstable_scheduleCallback,Dg=i.unstable_cancelCallback,r6=i.unstable_shouldYield,i6=i.unstable_requestPaint,kt=i.unstable_now,Qd=i.unstable_ImmediatePriority,s6=i.unstable_UserBlockingPriority,Zd=i.unstable_NormalPriority,o6=i.unstable_IdlePriority,Cl=null,lr=null;function a6(o){if(lr&&typeof lr.onCommitFiberRoot=="function")try{lr.onCommitFiberRoot(Cl,o,void 0,(o.current.flags&128)===128)}catch{}}function l6(o,a){return o===a&&(o!==0||1/o===1/a)||o!==o&&a!==a}var Wn=typeof Object.is=="function"?Object.is:l6,Tr=null,Tl=!1,qd=!1;function zg(o){Tr===null?Tr=[o]:Tr.push(o)}function u6(o){Tl=!0,zg(o)}function ur(){if(!qd&&Tr!==null){qd=!0;var o=0,a=Oe;try{var d=Tr;for(Oe=1;o<d.length;o++){var p=d[o];do p=p(!0);while(p!==null)}Tr=null,Tl=!1}catch(v){throw Tr!==null&&(Tr=Tr.slice(o+1)),Kd(Qd,ur),v}finally{Oe=a,qd=!1}}return null}var bs=[],Ps=0,El=null,bl=0,Tn=[],En=0,Bi=null,Er=1,br="";function Ui(o,a){bs[Ps++]=bl,bs[Ps++]=El,El=o,bl=a}function Bg(o,a,d){Tn[En++]=Er,Tn[En++]=br,Tn[En++]=Bi,Bi=o;var p=Er;o=br;var v=32-Vn(p)-1;p&=~(1<<v),d+=1;var b=32-Vn(a)+v;if(30<b){var j=v-v%5;b=(p&(1<<j)-1).toString(32),p>>=j,v-=j,Er=1<<32-Vn(a)+v|d<<v|p,br=b+o}else Er=1<<b|d<<v|p,br=o}function Jd(o){o.return!==null&&(Ui(o,1),Bg(o,1,0))}function ef(o){for(;o===El;)El=bs[--Ps],bs[Ps]=null,bl=bs[--Ps],bs[Ps]=null;for(;o===Bi;)Bi=Tn[--En],Tn[En]=null,br=Tn[--En],Tn[En]=null,Er=Tn[--En],Tn[En]=null}var yn=null,bn=null,qe=!1,zo=!1,$n=null;function Ug(o,a){var d=In(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=o,a=o.deletions,a===null?(o.deletions=[d],o.flags|=16):a.push(d)}function Gg(o,a){switch(o.tag){case 5:return a=A4(a,o.type,o.pendingProps),a!==null?(o.stateNode=a,yn=o,bn=j4(a),!0):!1;case 6:return a=I4(a,o.pendingProps),a!==null?(o.stateNode=a,yn=o,bn=null,!0):!1;case 13:if(a=L4(a),a!==null){var d=Bi!==null?{id:Er,overflow:br}:null;return o.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=In(18,null,null,0),d.stateNode=a,d.return=o,o.child=d,yn=o,bn=null,!0}return!1;default:return!1}}function tf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function nf(o){if(qe){var a=bn;if(a){var d=a;if(!Gg(o,a)){if(tf(o))throw Error(l(418));a=vl(d);var p=yn;a&&Gg(o,a)?Ug(p,d):(o.flags=o.flags&-4097|2,qe=!1,yn=o)}}else{if(tf(o))throw Error(l(418));o.flags=o.flags&-4097|2,qe=!1,yn=o}}}function Vg(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;yn=o}function Pl(o){if(!oe||o!==yn)return!1;if(!qe)return Vg(o),qe=!0,!1;if(o.tag!==3&&(o.tag!==5||X4(o.type)&&!xe(o.type,o.memoizedProps))){var a=bn;if(a){if(tf(o))throw Wg(),Error(l(418));for(;a;)Ug(o,a),a=vl(a)}}if(Vg(o),o.tag===13){if(!oe)throw Error(l(316));if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(l(317));bn=G4(o)}else bn=yn?vl(o.stateNode):null;return!0}function Wg(){for(var o=bn;o;)o=vl(o)}function Ns(){oe&&(bn=yn=null,zo=qe=!1)}function rf(o){$n===null?$n=[o]:$n.push(o)}var c6=c.ReactCurrentBatchConfig;function Nl(o,a){if(Wn(o,a))return!0;if(typeof o!="object"||o===null||typeof a!="object"||a===null)return!1;var d=Object.keys(o),p=Object.keys(a);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var v=d[p];if(!Q4.call(a,v)||!Wn(o[v],a[v]))return!1}return!0}function d6(o){switch(o.tag){case 5:return jo(o.type);case 16:return jo("Lazy");case 13:return jo("Suspense");case 19:return jo("SuspenseList");case 0:case 2:case 15:return o=Wd(o.type,!1),o;case 11:return o=Wd(o.type.render,!1),o;case 1:return o=Wd(o.type,!0),o;default:return""}}function Bo(o,a,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(l(309));var p=d.stateNode}if(!p)throw Error(l(147,o));var v=p,b=""+o;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===b?a.ref:(a=function(j){var H=v.refs;j===null?delete H[b]:H[b]=j},a._stringRef=b,a)}if(typeof o!="string")throw Error(l(284));if(!d._owner)throw Error(l(290,o))}return o}function Ml(o,a){throw o=Object.prototype.toString.call(a),Error(l(31,o==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":o))}function $g(o){var a=o._init;return a(o._payload)}function Hg(o){function a(q,Y){if(o){var ee=q.deletions;ee===null?(q.deletions=[Y],q.flags|=16):ee.push(Y)}}function d(q,Y){if(!o)return null;for(;Y!==null;)a(q,Y),Y=Y.sibling;return null}function p(q,Y){for(q=new Map;Y!==null;)Y.key!==null?q.set(Y.key,Y):q.set(Y.index,Y),Y=Y.sibling;return q}function v(q,Y){return q=oi(q,Y),q.index=0,q.sibling=null,q}function b(q,Y,ee){return q.index=ee,o?(ee=q.alternate,ee!==null?(ee=ee.index,ee<Y?(q.flags|=2,Y):ee):(q.flags|=2,Y)):(q.flags|=1048576,Y)}function j(q){return o&&q.alternate===null&&(q.flags|=2),q}function H(q,Y,ee,ce){return Y===null||Y.tag!==6?(Y=Jf(ee,q.mode,ce),Y.return=q,Y):(Y=v(Y,ee),Y.return=q,Y)}function J(q,Y,ee,ce){var me=ee.type;return me===h?pe(q,Y,ee.props.children,ce,ee.key):Y!==null&&(Y.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===g&&$g(me)===Y.type)?(ce=v(Y,ee.props),ce.ref=Bo(q,Y,ee),ce.return=q,ce):(ce=au(ee.type,ee.key,ee.props,null,q.mode,ce),ce.ref=Bo(q,Y,ee),ce.return=q,ce)}function re(q,Y,ee,ce){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==ee.containerInfo||Y.stateNode.implementation!==ee.implementation?(Y=eh(ee,q.mode,ce),Y.return=q,Y):(Y=v(Y,ee.children||[]),Y.return=q,Y)}function pe(q,Y,ee,ce,me){return Y===null||Y.tag!==7?(Y=Yi(ee,q.mode,ce,me),Y.return=q,Y):(Y=v(Y,ee),Y.return=q,Y)}function Ce(q,Y,ee){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=Jf(""+Y,q.mode,ee),Y.return=q,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case u:return ee=au(Y.type,Y.key,Y.props,null,q.mode,ee),ee.ref=Bo(q,null,Y),ee.return=q,ee;case f:return Y=eh(Y,q.mode,ee),Y.return=q,Y;case g:var ce=Y._init;return Ce(q,ce(Y._payload),ee)}if(D(Y)||N(Y))return Y=Yi(Y,q.mode,ee,null),Y.return=q,Y;Ml(q,Y)}return null}function ue(q,Y,ee,ce){var me=Y!==null?Y.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return me!==null?null:H(q,Y,""+ee,ce);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case u:return ee.key===me?J(q,Y,ee,ce):null;case f:return ee.key===me?re(q,Y,ee,ce):null;case g:return me=ee._init,ue(q,Y,me(ee._payload),ce)}if(D(ee)||N(ee))return me!==null?null:pe(q,Y,ee,ce,null);Ml(q,ee)}return null}function Ke(q,Y,ee,ce,me){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return q=q.get(ee)||null,H(Y,q,""+ce,me);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case u:return q=q.get(ce.key===null?ee:ce.key)||null,J(Y,q,ce,me);case f:return q=q.get(ce.key===null?ee:ce.key)||null,re(Y,q,ce,me);case g:var be=ce._init;return Ke(q,Y,ee,be(ce._payload),me)}if(D(ce)||N(ce))return q=q.get(ee)||null,pe(Y,q,ce,me,null);Ml(Y,ce)}return null}function Ve(q,Y,ee,ce){for(var me=null,be=null,Te=Y,De=Y=0,Et=null;Te!==null&&De<ee.length;De++){Te.index>De?(Et=Te,Te=null):Et=Te.sibling;var ze=ue(q,Te,ee[De],ce);if(ze===null){Te===null&&(Te=Et);break}o&&Te&&ze.alternate===null&&a(q,Te),Y=b(ze,Y,De),be===null?me=ze:be.sibling=ze,be=ze,Te=Et}if(De===ee.length)return d(q,Te),qe&&Ui(q,De),me;if(Te===null){for(;De<ee.length;De++)Te=Ce(q,ee[De],ce),Te!==null&&(Y=b(Te,Y,De),be===null?me=Te:be.sibling=Te,be=Te);return qe&&Ui(q,De),me}for(Te=p(q,Te);De<ee.length;De++)Et=Ke(Te,q,De,ee[De],ce),Et!==null&&(o&&Et.alternate!==null&&Te.delete(Et.key===null?De:Et.key),Y=b(Et,Y,De),be===null?me=Et:be.sibling=Et,be=Et);return o&&Te.forEach(function(ai){return a(q,ai)}),qe&&Ui(q,De),me}function un(q,Y,ee,ce){var me=N(ee);if(typeof me!="function")throw Error(l(150));if(ee=me.call(ee),ee==null)throw Error(l(151));for(var be=me=null,Te=Y,De=Y=0,Et=null,ze=ee.next();Te!==null&&!ze.done;De++,ze=ee.next()){Te.index>De?(Et=Te,Te=null):Et=Te.sibling;var ai=ue(q,Te,ze.value,ce);if(ai===null){Te===null&&(Te=Et);break}o&&Te&&ai.alternate===null&&a(q,Te),Y=b(ai,Y,De),be===null?me=ai:be.sibling=ai,be=ai,Te=Et}if(ze.done)return d(q,Te),qe&&Ui(q,De),me;if(Te===null){for(;!ze.done;De++,ze=ee.next())ze=Ce(q,ze.value,ce),ze!==null&&(Y=b(ze,Y,De),be===null?me=ze:be.sibling=ze,be=ze);return qe&&Ui(q,De),me}for(Te=p(q,Te);!ze.done;De++,ze=ee.next())ze=Ke(Te,q,De,ze.value,ce),ze!==null&&(o&&ze.alternate!==null&&Te.delete(ze.key===null?De:ze.key),Y=b(ze,Y,De),be===null?me=ze:be.sibling=ze,be=ze);return o&&Te.forEach(function(U6){return a(q,U6)}),qe&&Ui(q,De),me}function Ar(q,Y,ee,ce){if(typeof ee=="object"&&ee!==null&&ee.type===h&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case u:e:{for(var me=ee.key,be=Y;be!==null;){if(be.key===me){if(me=ee.type,me===h){if(be.tag===7){d(q,be.sibling),Y=v(be,ee.props.children),Y.return=q,q=Y;break e}}else if(be.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===g&&$g(me)===be.type){d(q,be.sibling),Y=v(be,ee.props),Y.ref=Bo(q,be,ee),Y.return=q,q=Y;break e}d(q,be);break}else a(q,be);be=be.sibling}ee.type===h?(Y=Yi(ee.props.children,q.mode,ce,ee.key),Y.return=q,q=Y):(ce=au(ee.type,ee.key,ee.props,null,q.mode,ce),ce.ref=Bo(q,Y,ee),ce.return=q,q=ce)}return j(q);case f:e:{for(be=ee.key;Y!==null;){if(Y.key===be)if(Y.tag===4&&Y.stateNode.containerInfo===ee.containerInfo&&Y.stateNode.implementation===ee.implementation){d(q,Y.sibling),Y=v(Y,ee.children||[]),Y.return=q,q=Y;break e}else{d(q,Y);break}else a(q,Y);Y=Y.sibling}Y=eh(ee,q.mode,ce),Y.return=q,q=Y}return j(q);case g:return be=ee._init,Ar(q,Y,be(ee._payload),ce)}if(D(ee))return Ve(q,Y,ee,ce);if(N(ee))return un(q,Y,ee,ce);Ml(q,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,Y!==null&&Y.tag===6?(d(q,Y.sibling),Y=v(Y,ee),Y.return=q,q=Y):(d(q,Y),Y=Jf(ee,q.mode,ce),Y.return=q,q=Y),j(q)):d(q,Y)}return Ar}var Ms=Hg(!0),Xg=Hg(!1),Al=qr(null),Il=null,As=null,sf=null;function of(){sf=As=Il=null}function Yg(o,a,d){ve?($e(Al,a._currentValue),a._currentValue=d):($e(Al,a._currentValue2),a._currentValue2=d)}function af(o){var a=Al.current;Ye(Al),ve?o._currentValue=a:o._currentValue2=a}function lf(o,a,d){for(;o!==null;){var p=o.alternate;if((o.childLanes&a)!==a?(o.childLanes|=a,p!==null&&(p.childLanes|=a)):p!==null&&(p.childLanes&a)!==a&&(p.childLanes|=a),o===d)break;o=o.return}}function Is(o,a){Il=o,sf=As=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&a&&(on=!0),o.firstContext=null)}function Pn(o){var a=ve?o._currentValue:o._currentValue2;if(sf!==o)if(o={context:o,memoizedValue:a,next:null},As===null){if(Il===null)throw Error(l(308));As=o,Il.dependencies={lanes:0,firstContext:o}}else As=As.next=o;return a}var Gi=null;function uf(o){Gi===null?Gi=[o]:Gi.push(o)}function Kg(o,a,d,p){var v=a.interleaved;return v===null?(d.next=d,uf(a)):(d.next=v.next,v.next=d),a.interleaved=d,cr(o,p)}function cr(o,a){o.lanes|=a;var d=o.alternate;for(d!==null&&(d.lanes|=a),d=o,o=o.return;o!==null;)o.childLanes|=a,d=o.alternate,d!==null&&(d.childLanes|=a),d=o,o=o.return;return d.tag===3?d.stateNode:null}var ei=!1;function cf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Qg(o,a){o=o.updateQueue,a.updateQueue===o&&(a.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Pr(o,a){return{eventTime:o,lane:a,tag:0,payload:null,callback:null,next:null}}function ti(o,a,d){var p=o.updateQueue;if(p===null)return null;if(p=p.shared,Ne&2){var v=p.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),p.pending=a,cr(o,d)}return v=p.interleaved,v===null?(a.next=a,uf(p)):(a.next=v.next,v.next=a),p.interleaved=a,cr(o,d)}function Ll(o,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var p=a.lanes;p&=o.pendingLanes,d|=p,a.lanes=d,Yd(o,d)}}function Zg(o,a){var d=o.updateQueue,p=o.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var v=null,b=null;if(d=d.firstBaseUpdate,d!==null){do{var j={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};b===null?v=b=j:b=b.next=j,d=d.next}while(d!==null);b===null?v=b=a:b=b.next=a}else v=b=a;d={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:p.shared,effects:p.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=a:o.next=a,d.lastBaseUpdate=a}function Rl(o,a,d,p){var v=o.updateQueue;ei=!1;var b=v.firstBaseUpdate,j=v.lastBaseUpdate,H=v.shared.pending;if(H!==null){v.shared.pending=null;var J=H,re=J.next;J.next=null,j===null?b=re:j.next=re,j=J;var pe=o.alternate;pe!==null&&(pe=pe.updateQueue,H=pe.lastBaseUpdate,H!==j&&(H===null?pe.firstBaseUpdate=re:H.next=re,pe.lastBaseUpdate=J))}if(b!==null){var Ce=v.baseState;j=0,pe=re=J=null,H=b;do{var ue=H.lane,Ke=H.eventTime;if((p&ue)===ue){pe!==null&&(pe=pe.next={eventTime:Ke,lane:0,tag:H.tag,payload:H.payload,callback:H.callback,next:null});e:{var Ve=o,un=H;switch(ue=a,Ke=d,un.tag){case 1:if(Ve=un.payload,typeof Ve=="function"){Ce=Ve.call(Ke,Ce,ue);break e}Ce=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=un.payload,ue=typeof Ve=="function"?Ve.call(Ke,Ce,ue):Ve,ue==null)break e;Ce=s({},Ce,ue);break e;case 2:ei=!0}}H.callback!==null&&H.lane!==0&&(o.flags|=64,ue=v.effects,ue===null?v.effects=[H]:ue.push(H))}else Ke={eventTime:Ke,lane:ue,tag:H.tag,payload:H.payload,callback:H.callback,next:null},pe===null?(re=pe=Ke,J=Ce):pe=pe.next=Ke,j|=ue;if(H=H.next,H===null){if(H=v.shared.pending,H===null)break;ue=H,H=ue.next,ue.next=null,v.lastBaseUpdate=ue,v.shared.pending=null}}while(1);if(pe===null&&(J=Ce),v.baseState=J,v.firstBaseUpdate=re,v.lastBaseUpdate=pe,a=v.shared.interleaved,a!==null){v=a;do j|=v.lane,v=v.next;while(v!==a)}else b===null&&(v.shared.lanes=0);Wi|=j,o.lanes=j,o.memoizedState=Ce}}function qg(o,a,d){if(o=a.effects,a.effects=null,o!==null)for(a=0;a<o.length;a++){var p=o[a],v=p.callback;if(v!==null){if(p.callback=null,p=d,typeof v!="function")throw Error(l(191,v));v.call(p)}}}var Uo={},Nn=qr(Uo),Go=qr(Uo),Ls=qr(Uo);function dr(o){if(o===Uo)throw Error(l(174));return o}function df(o,a){$e(Ls,a),$e(Go,o),$e(Nn,Uo),o=X(a),Ye(Nn),$e(Nn,o)}function Rs(){Ye(Nn),Ye(Go),Ye(Ls)}function Jg(o){var a=dr(Ls.current),d=dr(Nn.current);a=F(d,o.type,a),d!==a&&($e(Go,o),$e(Nn,a))}function ff(o){Go.current===o&&(Ye(Nn),Ye(Go))}var nt=qr(0);function Fl(o){for(var a=o;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Ig(d)||Ud(d)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var hf=[];function pf(){for(var o=0;o<hf.length;o++){var a=hf[o];ve?a._workInProgressVersionPrimary=null:a._workInProgressVersionSecondary=null}hf.length=0}var jl=c.ReactCurrentDispatcher,gf=c.ReactCurrentBatchConfig,Vi=0,rt=null,mt=null,Ct=null,Ol=!1,Vo=!1,Wo=0,f6=0;function zt(){throw Error(l(321))}function mf(o,a){if(a===null)return!1;for(var d=0;d<a.length&&d<o.length;d++)if(!Wn(o[d],a[d]))return!1;return!0}function yf(o,a,d,p,v,b){if(Vi=b,rt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,jl.current=o===null||o.memoizedState===null?m6:y6,o=d(p,v),Vo){b=0;do{if(Vo=!1,Wo=0,25<=b)throw Error(l(301));b+=1,Ct=mt=null,a.updateQueue=null,jl.current=v6,o=d(p,v)}while(Vo)}if(jl.current=Bl,a=mt!==null&&mt.next!==null,Vi=0,Ct=mt=rt=null,Ol=!1,a)throw Error(l(300));return o}function vf(){var o=Wo!==0;return Wo=0,o}function fr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?rt.memoizedState=Ct=o:Ct=Ct.next=o,Ct}function Mn(){if(mt===null){var o=rt.alternate;o=o!==null?o.memoizedState:null}else o=mt.next;var a=Ct===null?rt.memoizedState:Ct.next;if(a!==null)Ct=a,mt=o;else{if(o===null)throw Error(l(310));mt=o,o={memoizedState:mt.memoizedState,baseState:mt.baseState,baseQueue:mt.baseQueue,queue:mt.queue,next:null},Ct===null?rt.memoizedState=Ct=o:Ct=Ct.next=o}return Ct}function $o(o,a){return typeof a=="function"?a(o):a}function xf(o){var a=Mn(),d=a.queue;if(d===null)throw Error(l(311));d.lastRenderedReducer=o;var p=mt,v=p.baseQueue,b=d.pending;if(b!==null){if(v!==null){var j=v.next;v.next=b.next,b.next=j}p.baseQueue=v=b,d.pending=null}if(v!==null){b=v.next,p=p.baseState;var H=j=null,J=null,re=b;do{var pe=re.lane;if((Vi&pe)===pe)J!==null&&(J=J.next={lane:0,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null}),p=re.hasEagerState?re.eagerState:o(p,re.action);else{var Ce={lane:pe,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null};J===null?(H=J=Ce,j=p):J=J.next=Ce,rt.lanes|=pe,Wi|=pe}re=re.next}while(re!==null&&re!==b);J===null?j=p:J.next=H,Wn(p,a.memoizedState)||(on=!0),a.memoizedState=p,a.baseState=j,a.baseQueue=J,d.lastRenderedState=p}if(o=d.interleaved,o!==null){v=o;do b=v.lane,rt.lanes|=b,Wi|=b,v=v.next;while(v!==o)}else v===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function wf(o){var a=Mn(),d=a.queue;if(d===null)throw Error(l(311));d.lastRenderedReducer=o;var p=d.dispatch,v=d.pending,b=a.memoizedState;if(v!==null){d.pending=null;var j=v=v.next;do b=o(b,j.action),j=j.next;while(j!==v);Wn(b,a.memoizedState)||(on=!0),a.memoizedState=b,a.baseQueue===null&&(a.baseState=b),d.lastRenderedState=b}return[b,p]}function e1(){}function t1(o,a){var d=rt,p=Mn(),v=a(),b=!Wn(p.memoizedState,v);if(b&&(p.memoizedState=v,on=!0),p=p.queue,_f(i1.bind(null,d,p,o),[o]),p.getSnapshot!==a||b||Ct!==null&&Ct.memoizedState.tag&1){if(d.flags|=2048,Ho(9,r1.bind(null,d,p,v,a),void 0,null),Tt===null)throw Error(l(349));Vi&30||n1(d,a,v)}return v}function n1(o,a,d){o.flags|=16384,o={getSnapshot:a,value:d},a=rt.updateQueue,a===null?(a={lastEffect:null,stores:null},rt.updateQueue=a,a.stores=[o]):(d=a.stores,d===null?a.stores=[o]:d.push(o))}function r1(o,a,d,p){a.value=d,a.getSnapshot=p,s1(a)&&o1(o)}function i1(o,a,d){return d(function(){s1(a)&&o1(o)})}function s1(o){var a=o.getSnapshot;o=o.value;try{var d=a();return!Wn(o,d)}catch{return!0}}function o1(o){var a=cr(o,1);a!==null&&An(a,o,1,-1)}function a1(o){var a=fr();return typeof o=="function"&&(o=o()),a.memoizedState=a.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:o},a.queue=o,o=o.dispatch=g6.bind(null,rt,o),[a.memoizedState,o]}function Ho(o,a,d,p){return o={tag:o,create:a,destroy:d,deps:p,next:null},a=rt.updateQueue,a===null?(a={lastEffect:null,stores:null},rt.updateQueue=a,a.lastEffect=o.next=o):(d=a.lastEffect,d===null?a.lastEffect=o.next=o:(p=d.next,d.next=o,o.next=p,a.lastEffect=o)),o}function l1(){return Mn().memoizedState}function Dl(o,a,d,p){var v=fr();rt.flags|=o,v.memoizedState=Ho(1|a,d,void 0,p===void 0?null:p)}function zl(o,a,d,p){var v=Mn();p=p===void 0?null:p;var b=void 0;if(mt!==null){var j=mt.memoizedState;if(b=j.destroy,p!==null&&mf(p,j.deps)){v.memoizedState=Ho(a,d,b,p);return}}rt.flags|=o,v.memoizedState=Ho(1|a,d,b,p)}function u1(o,a){return Dl(8390656,8,o,a)}function _f(o,a){return zl(2048,8,o,a)}function c1(o,a){return zl(4,2,o,a)}function d1(o,a){return zl(4,4,o,a)}function f1(o,a){if(typeof a=="function")return o=o(),a(o),function(){a(null)};if(a!=null)return o=o(),a.current=o,function(){a.current=null}}function h1(o,a,d){return d=d!=null?d.concat([o]):null,zl(4,4,f1.bind(null,a,o),d)}function Sf(){}function p1(o,a){var d=Mn();a=a===void 0?null:a;var p=d.memoizedState;return p!==null&&a!==null&&mf(a,p[1])?p[0]:(d.memoizedState=[o,a],o)}function g1(o,a){var d=Mn();a=a===void 0?null:a;var p=d.memoizedState;return p!==null&&a!==null&&mf(a,p[1])?p[0]:(o=o(),d.memoizedState=[o,a],o)}function m1(o,a,d){return Vi&21?(Wn(d,a)||(d=jg(),rt.lanes|=d,Wi|=d,o.baseState=!0),a):(o.baseState&&(o.baseState=!1,on=!0),o.memoizedState=d)}function h6(o,a){var d=Oe;Oe=d!==0&&4>d?d:4,o(!0);var p=gf.transition;gf.transition={};try{o(!1),a()}finally{Oe=d,gf.transition=p}}function y1(){return Mn().memoizedState}function p6(o,a,d){var p=ii(o);if(d={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null},v1(o))x1(a,d);else if(d=Kg(o,a,d,p),d!==null){var v=Gt();An(d,o,p,v),w1(d,a,p)}}function g6(o,a,d){var p=ii(o),v={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null};if(v1(o))x1(a,v);else{var b=o.alternate;if(o.lanes===0&&(b===null||b.lanes===0)&&(b=a.lastRenderedReducer,b!==null))try{var j=a.lastRenderedState,H=b(j,d);if(v.hasEagerState=!0,v.eagerState=H,Wn(H,j)){var J=a.interleaved;J===null?(v.next=v,uf(a)):(v.next=J.next,J.next=v),a.interleaved=v;return}}catch{}finally{}d=Kg(o,a,v,p),d!==null&&(v=Gt(),An(d,o,p,v),w1(d,a,p))}}function v1(o){var a=o.alternate;return o===rt||a!==null&&a===rt}function x1(o,a){Vo=Ol=!0;var d=o.pending;d===null?a.next=a:(a.next=d.next,d.next=a),o.pending=a}function w1(o,a,d){if(d&4194240){var p=a.lanes;p&=o.pendingLanes,d|=p,a.lanes=d,Yd(o,d)}}var Bl={readContext:Pn,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useInsertionEffect:zt,useLayoutEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useMutableSource:zt,useSyncExternalStore:zt,useId:zt,unstable_isNewReconciler:!1},m6={readContext:Pn,useCallback:function(o,a){return fr().memoizedState=[o,a===void 0?null:a],o},useContext:Pn,useEffect:u1,useImperativeHandle:function(o,a,d){return d=d!=null?d.concat([o]):null,Dl(4194308,4,f1.bind(null,a,o),d)},useLayoutEffect:function(o,a){return Dl(4194308,4,o,a)},useInsertionEffect:function(o,a){return Dl(4,2,o,a)},useMemo:function(o,a){var d=fr();return a=a===void 0?null:a,o=o(),d.memoizedState=[o,a],o},useReducer:function(o,a,d){var p=fr();return a=d!==void 0?d(a):a,p.memoizedState=p.baseState=a,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:a},p.queue=o,o=o.dispatch=p6.bind(null,rt,o),[p.memoizedState,o]},useRef:function(o){var a=fr();return o={current:o},a.memoizedState=o},useState:a1,useDebugValue:Sf,useDeferredValue:function(o){return fr().memoizedState=o},useTransition:function(){var o=a1(!1),a=o[0];return o=h6.bind(null,o[1]),fr().memoizedState=o,[a,o]},useMutableSource:function(){},useSyncExternalStore:function(o,a,d){var p=rt,v=fr();if(qe){if(d===void 0)throw Error(l(407));d=d()}else{if(d=a(),Tt===null)throw Error(l(349));Vi&30||n1(p,a,d)}v.memoizedState=d;var b={value:d,getSnapshot:a};return v.queue=b,u1(i1.bind(null,p,b,o),[o]),p.flags|=2048,Ho(9,r1.bind(null,p,b,d,a),void 0,null),d},useId:function(){var o=fr(),a=Tt.identifierPrefix;if(qe){var d=br,p=Er;d=(p&~(1<<32-Vn(p)-1)).toString(32)+d,a=":"+a+"R"+d,d=Wo++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=f6++,a=":"+a+"r"+d.toString(32)+":";return o.memoizedState=a},unstable_isNewReconciler:!1},y6={readContext:Pn,useCallback:p1,useContext:Pn,useEffect:_f,useImperativeHandle:h1,useInsertionEffect:c1,useLayoutEffect:d1,useMemo:g1,useReducer:xf,useRef:l1,useState:function(){return xf($o)},useDebugValue:Sf,useDeferredValue:function(o){var a=Mn();return m1(a,mt.memoizedState,o)},useTransition:function(){var o=xf($o)[0],a=Mn().memoizedState;return[o,a]},useMutableSource:e1,useSyncExternalStore:t1,useId:y1,unstable_isNewReconciler:!1},v6={readContext:Pn,useCallback:p1,useContext:Pn,useEffect:_f,useImperativeHandle:h1,useInsertionEffect:c1,useLayoutEffect:d1,useMemo:g1,useReducer:wf,useRef:l1,useState:function(){return wf($o)},useDebugValue:Sf,useDeferredValue:function(o){var a=Mn();return mt===null?a.memoizedState=o:m1(a,mt.memoizedState,o)},useTransition:function(){var o=wf($o)[0],a=Mn().memoizedState;return[o,a]},useMutableSource:e1,useSyncExternalStore:t1,useId:y1,unstable_isNewReconciler:!1};function Hn(o,a){if(o&&o.defaultProps){a=s({},a),o=o.defaultProps;for(var d in o)a[d]===void 0&&(a[d]=o[d]);return a}return a}function kf(o,a,d,p){a=o.memoizedState,d=d(p,a),d=d==null?a:s({},a,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var Ul={isMounted:function(o){return(o=o._reactInternals)?R(o)===o:!1},enqueueSetState:function(o,a,d){o=o._reactInternals;var p=Gt(),v=ii(o),b=Pr(p,v);b.payload=a,d!=null&&(b.callback=d),a=ti(o,b,v),a!==null&&(An(a,o,v,p),Ll(a,o,v))},enqueueReplaceState:function(o,a,d){o=o._reactInternals;var p=Gt(),v=ii(o),b=Pr(p,v);b.tag=1,b.payload=a,d!=null&&(b.callback=d),a=ti(o,b,v),a!==null&&(An(a,o,v,p),Ll(a,o,v))},enqueueForceUpdate:function(o,a){o=o._reactInternals;var d=Gt(),p=ii(o),v=Pr(d,p);v.tag=2,a!=null&&(v.callback=a),a=ti(o,v,p),a!==null&&(An(a,o,p,d),Ll(a,o,p))}};function _1(o,a,d,p,v,b,j){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(p,b,j):a.prototype&&a.prototype.isPureReactComponent?!Nl(d,p)||!Nl(v,b):!0}function S1(o,a,d){var p=!1,v=Jr,b=a.contextType;return typeof b=="object"&&b!==null?b=Pn(b):(v=sn(a)?zi:Dt.current,p=a.contextTypes,b=(p=p!=null)?Es(o,v):Jr),a=new a(d,b),o.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Ul,o.stateNode=a,a._reactInternals=o,p&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=v,o.__reactInternalMemoizedMaskedChildContext=b),a}function k1(o,a,d,p){o=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,p),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,p),a.state!==o&&Ul.enqueueReplaceState(a,a.state,null)}function Cf(o,a,d,p){var v=o.stateNode;v.props=d,v.state=o.memoizedState,v.refs={},cf(o);var b=a.contextType;typeof b=="object"&&b!==null?v.context=Pn(b):(b=sn(a)?zi:Dt.current,v.context=Es(o,b)),v.state=o.memoizedState,b=a.getDerivedStateFromProps,typeof b=="function"&&(kf(o,a,b,d),v.state=o.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(a=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),a!==v.state&&Ul.enqueueReplaceState(v,v.state,null),Rl(o,d,v,p),v.state=o.memoizedState),typeof v.componentDidMount=="function"&&(o.flags|=4194308)}function Fs(o,a){try{var d="",p=a;do d+=d6(p),p=p.return;while(p);var v=d}catch(b){v=`
Error generating stack: `+b.message+`
`+b.stack}return{value:o,source:a,stack:v,digest:null}}function Tf(o,a,d){return{value:o,source:null,stack:d??null,digest:a??null}}function Ef(o,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var x6=typeof WeakMap=="function"?WeakMap:Map;function C1(o,a,d){d=Pr(-1,d),d.tag=3,d.payload={element:null};var p=a.value;return d.callback=function(){tu||(tu=!0,Hf=p),Ef(o,a)},d}function T1(o,a,d){d=Pr(-1,d),d.tag=3;var p=o.type.getDerivedStateFromError;if(typeof p=="function"){var v=a.value;d.payload=function(){return p(v)},d.callback=function(){Ef(o,a)}}var b=o.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(d.callback=function(){Ef(o,a),typeof p!="function"&&(ni===null?ni=new Set([this]):ni.add(this));var j=a.stack;this.componentDidCatch(a.value,{componentStack:j!==null?j:""})}),d}function E1(o,a,d){var p=o.pingCache;if(p===null){p=o.pingCache=new x6;var v=new Set;p.set(a,v)}else v=p.get(a),v===void 0&&(v=new Set,p.set(a,v));v.has(d)||(v.add(d),o=L6.bind(null,o,a,d),a.then(o,o))}function b1(o){do{var a;if((a=o.tag===13)&&(a=o.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return o;o=o.return}while(o!==null);return null}function P1(o,a,d,p,v){return o.mode&1?(o.flags|=65536,o.lanes=v,o):(o===a?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=Pr(-1,1),a.tag=2,ti(d,a,1))),d.lanes|=1),o)}var w6=c.ReactCurrentOwner,on=!1;function Kt(o,a,d,p){a.child=o===null?Xg(a,null,d,p):Ms(a,o.child,d,p)}function N1(o,a,d,p,v){d=d.render;var b=a.ref;return Is(a,v),p=yf(o,a,d,p,b,v),d=vf(),o!==null&&!on?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~v,Nr(o,a,v)):(qe&&d&&Jd(a),a.flags|=1,Kt(o,a,p,v),a.child)}function M1(o,a,d,p,v){if(o===null){var b=d.type;return typeof b=="function"&&!qf(b)&&b.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=b,A1(o,a,b,p,v)):(o=au(d.type,null,p,a,a.mode,v),o.ref=a.ref,o.return=a,a.child=o)}if(b=o.child,!(o.lanes&v)){var j=b.memoizedProps;if(d=d.compare,d=d!==null?d:Nl,d(j,p)&&o.ref===a.ref)return Nr(o,a,v)}return a.flags|=1,o=oi(b,p),o.ref=a.ref,o.return=a,a.child=o}function A1(o,a,d,p,v){if(o!==null){var b=o.memoizedProps;if(Nl(b,p)&&o.ref===a.ref)if(on=!1,a.pendingProps=p=b,(o.lanes&v)!==0)o.flags&131072&&(on=!0);else return a.lanes=o.lanes,Nr(o,a,v)}return bf(o,a,d,p,v)}function I1(o,a,d){var p=a.pendingProps,v=p.children,b=o!==null?o.memoizedState:null;if(p.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},$e(Os,vn),vn|=d;else{if(!(d&1073741824))return o=b!==null?b.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:o,cachePool:null,transitions:null},a.updateQueue=null,$e(Os,vn),vn|=o,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=b!==null?b.baseLanes:d,$e(Os,vn),vn|=p}else b!==null?(p=b.baseLanes|d,a.memoizedState=null):p=d,$e(Os,vn),vn|=p;return Kt(o,a,v,d),a.child}function L1(o,a){var d=a.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function bf(o,a,d,p,v){var b=sn(d)?zi:Dt.current;return b=Es(a,b),Is(a,v),d=yf(o,a,d,p,b,v),p=vf(),o!==null&&!on?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~v,Nr(o,a,v)):(qe&&p&&Jd(a),a.flags|=1,Kt(o,a,d,v),a.child)}function R1(o,a,d,p,v){if(sn(d)){var b=!0;wl(a)}else b=!1;if(Is(a,v),a.stateNode===null)Vl(o,a),S1(a,d,p),Cf(a,d,p,v),p=!0;else if(o===null){var j=a.stateNode,H=a.memoizedProps;j.props=H;var J=j.context,re=d.contextType;typeof re=="object"&&re!==null?re=Pn(re):(re=sn(d)?zi:Dt.current,re=Es(a,re));var pe=d.getDerivedStateFromProps,Ce=typeof pe=="function"||typeof j.getSnapshotBeforeUpdate=="function";Ce||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(H!==p||J!==re)&&k1(a,j,p,re),ei=!1;var ue=a.memoizedState;j.state=ue,Rl(a,p,j,v),J=a.memoizedState,H!==p||ue!==J||rn.current||ei?(typeof pe=="function"&&(kf(a,d,pe,p),J=a.memoizedState),(H=ei||_1(a,d,H,p,ue,J,re))?(Ce||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(a.flags|=4194308)):(typeof j.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=p,a.memoizedState=J),j.props=p,j.state=J,j.context=re,p=H):(typeof j.componentDidMount=="function"&&(a.flags|=4194308),p=!1)}else{j=a.stateNode,Qg(o,a),H=a.memoizedProps,re=a.type===a.elementType?H:Hn(a.type,H),j.props=re,Ce=a.pendingProps,ue=j.context,J=d.contextType,typeof J=="object"&&J!==null?J=Pn(J):(J=sn(d)?zi:Dt.current,J=Es(a,J));var Ke=d.getDerivedStateFromProps;(pe=typeof Ke=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(H!==Ce||ue!==J)&&k1(a,j,p,J),ei=!1,ue=a.memoizedState,j.state=ue,Rl(a,p,j,v);var Ve=a.memoizedState;H!==Ce||ue!==Ve||rn.current||ei?(typeof Ke=="function"&&(kf(a,d,Ke,p),Ve=a.memoizedState),(re=ei||_1(a,d,re,p,ue,Ve,J)||!1)?(pe||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(p,Ve,J),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(p,Ve,J)),typeof j.componentDidUpdate=="function"&&(a.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof j.componentDidUpdate!="function"||H===o.memoizedProps&&ue===o.memoizedState||(a.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||H===o.memoizedProps&&ue===o.memoizedState||(a.flags|=1024),a.memoizedProps=p,a.memoizedState=Ve),j.props=p,j.state=Ve,j.context=J,p=re):(typeof j.componentDidUpdate!="function"||H===o.memoizedProps&&ue===o.memoizedState||(a.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||H===o.memoizedProps&&ue===o.memoizedState||(a.flags|=1024),p=!1)}return Pf(o,a,d,p,b,v)}function Pf(o,a,d,p,v,b){L1(o,a);var j=(a.flags&128)!==0;if(!p&&!j)return v&&Fg(a,d,!1),Nr(o,a,b);p=a.stateNode,w6.current=a;var H=j&&typeof d.getDerivedStateFromError!="function"?null:p.render();return a.flags|=1,o!==null&&j?(a.child=Ms(a,o.child,null,b),a.child=Ms(a,null,H,b)):Kt(o,a,H,b),a.memoizedState=p.state,v&&Fg(a,d,!0),a.child}function F1(o){var a=o.stateNode;a.pendingContext?Lg(o,a.pendingContext,a.pendingContext!==a.context):a.context&&Lg(o,a.context,!1),df(o,a.containerInfo)}function j1(o,a,d,p,v){return Ns(),rf(v),a.flags|=256,Kt(o,a,d,p),a.child}var Nf={dehydrated:null,treeContext:null,retryLane:0};function Mf(o){return{baseLanes:o,cachePool:null,transitions:null}}function O1(o,a,d){var p=a.pendingProps,v=nt.current,b=!1,j=(a.flags&128)!==0,H;if((H=j)||(H=o!==null&&o.memoizedState===null?!1:(v&2)!==0),H?(b=!0,a.flags&=-129):(o===null||o.memoizedState!==null)&&(v|=1),$e(nt,v&1),o===null)return nf(a),o=a.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(a.mode&1?Ud(o)?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(j=p.children,o=p.fallback,b?(p=a.mode,b=a.child,j={mode:"hidden",children:j},!(p&1)&&b!==null?(b.childLanes=0,b.pendingProps=j):b=lu(j,p,0,null),o=Yi(o,p,d,null),b.return=a,o.return=a,b.sibling=o,a.child=b,a.child.memoizedState=Mf(d),a.memoizedState=Nf,o):Af(a,j));if(v=o.memoizedState,v!==null&&(H=v.dehydrated,H!==null))return _6(o,a,j,p,H,v,d);if(b){b=p.fallback,j=a.mode,v=o.child,H=v.sibling;var J={mode:"hidden",children:p.children};return!(j&1)&&a.child!==v?(p=a.child,p.childLanes=0,p.pendingProps=J,a.deletions=null):(p=oi(v,J),p.subtreeFlags=v.subtreeFlags&14680064),H!==null?b=oi(H,b):(b=Yi(b,j,d,null),b.flags|=2),b.return=a,p.return=a,p.sibling=b,a.child=p,p=b,b=a.child,j=o.child.memoizedState,j=j===null?Mf(d):{baseLanes:j.baseLanes|d,cachePool:null,transitions:j.transitions},b.memoizedState=j,b.childLanes=o.childLanes&~d,a.memoizedState=Nf,p}return b=o.child,o=b.sibling,p=oi(b,{mode:"visible",children:p.children}),!(a.mode&1)&&(p.lanes=d),p.return=a,p.sibling=null,o!==null&&(d=a.deletions,d===null?(a.deletions=[o],a.flags|=16):d.push(o)),a.child=p,a.memoizedState=null,p}function Af(o,a){return a=lu({mode:"visible",children:a},o.mode,0,null),a.return=o,o.child=a}function Gl(o,a,d,p){return p!==null&&rf(p),Ms(a,o.child,null,d),o=Af(a,a.pendingProps.children),o.flags|=2,a.memoizedState=null,o}function _6(o,a,d,p,v,b,j){if(d)return a.flags&256?(a.flags&=-257,p=Tf(Error(l(422))),Gl(o,a,j,p)):a.memoizedState!==null?(a.child=o.child,a.flags|=128,null):(b=p.fallback,v=a.mode,p=lu({mode:"visible",children:p.children},v,0,null),b=Yi(b,v,j,null),b.flags|=2,p.return=a,b.return=a,p.sibling=b,a.child=p,a.mode&1&&Ms(a,o.child,null,j),a.child.memoizedState=Mf(j),a.memoizedState=Nf,b);if(!(a.mode&1))return Gl(o,a,j,null);if(Ud(v))return p=R4(v).digest,b=Error(l(419)),p=Tf(b,p,void 0),Gl(o,a,j,p);if(d=(j&o.childLanes)!==0,on||d){if(p=Tt,p!==null){switch(j&-j){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(p.suspendedLanes|j)?0:v,v!==0&&v!==b.retryLane&&(b.retryLane=v,cr(o,v),An(p,o,v,-1))}return Zf(),p=Tf(Error(l(421))),Gl(o,a,j,p)}return Ig(v)?(a.flags|=128,a.child=o.child,a=R6.bind(null,o),F4(v,a),null):(o=b.treeContext,oe&&(bn=D4(v),yn=a,qe=!0,$n=null,zo=!1,o!==null&&(Tn[En++]=Er,Tn[En++]=br,Tn[En++]=Bi,Er=o.id,br=o.overflow,Bi=a)),a=Af(a,p.children),a.flags|=4096,a)}function D1(o,a,d){o.lanes|=a;var p=o.alternate;p!==null&&(p.lanes|=a),lf(o.return,a,d)}function If(o,a,d,p,v){var b=o.memoizedState;b===null?o.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:v}:(b.isBackwards=a,b.rendering=null,b.renderingStartTime=0,b.last=p,b.tail=d,b.tailMode=v)}function z1(o,a,d){var p=a.pendingProps,v=p.revealOrder,b=p.tail;if(Kt(o,a,p.children,d),p=nt.current,p&2)p=p&1|2,a.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=a.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&D1(o,d,a);else if(o.tag===19)D1(o,d,a);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}p&=1}if($e(nt,p),!(a.mode&1))a.memoizedState=null;else switch(v){case"forwards":for(d=a.child,v=null;d!==null;)o=d.alternate,o!==null&&Fl(o)===null&&(v=d),d=d.sibling;d=v,d===null?(v=a.child,a.child=null):(v=d.sibling,d.sibling=null),If(a,!1,v,d,b);break;case"backwards":for(d=null,v=a.child,a.child=null;v!==null;){if(o=v.alternate,o!==null&&Fl(o)===null){a.child=v;break}o=v.sibling,v.sibling=d,d=v,v=o}If(a,!0,d,null,b);break;case"together":If(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Vl(o,a){!(a.mode&1)&&o!==null&&(o.alternate=null,a.alternate=null,a.flags|=2)}function Nr(o,a,d){if(o!==null&&(a.dependencies=o.dependencies),Wi|=a.lanes,!(d&a.childLanes))return null;if(o!==null&&a.child!==o.child)throw Error(l(153));if(a.child!==null){for(o=a.child,d=oi(o,o.pendingProps),a.child=d,d.return=a;o.sibling!==null;)o=o.sibling,d=d.sibling=oi(o,o.pendingProps),d.return=a;d.sibling=null}return a.child}function S6(o,a,d){switch(a.tag){case 3:F1(a),Ns();break;case 5:Jg(a);break;case 1:sn(a.type)&&wl(a);break;case 4:df(a,a.stateNode.containerInfo);break;case 10:Yg(a,a.type._context,a.memoizedProps.value);break;case 13:var p=a.memoizedState;if(p!==null)return p.dehydrated!==null?($e(nt,nt.current&1),a.flags|=128,null):d&a.child.childLanes?O1(o,a,d):($e(nt,nt.current&1),o=Nr(o,a,d),o!==null?o.sibling:null);$e(nt,nt.current&1);break;case 19:if(p=(d&a.childLanes)!==0,o.flags&128){if(p)return z1(o,a,d);a.flags|=128}var v=a.memoizedState;if(v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),$e(nt,nt.current),p)break;return null;case 22:case 23:return a.lanes=0,I1(o,a,d)}return Nr(o,a,d)}function hr(o){o.flags|=4}function B1(o,a){if(o!==null&&o.child===a.child)return!0;if(a.flags&16)return!1;for(o=a.child;o!==null;){if(o.flags&12854||o.subtreeFlags&12854)return!1;o=o.sibling}return!0}var Xo,Yo,Wl,$l;if(ye)Xo=function(o,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)Q(o,d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Yo=function(){},Wl=function(o,a,d,p,v){if(o=o.memoizedProps,o!==p){var b=a.stateNode,j=dr(Nn.current);d=se(b,d,o,p,v,j),(a.updateQueue=d)&&hr(a)}},$l=function(o,a,d,p){d!==p&&hr(a)};else if(ie){Xo=function(o,a,d,p){for(var v=a.child;v!==null;){if(v.tag===5){var b=v.stateNode;d&&p&&(b=Mg(b,v.type,v.memoizedProps,v)),Q(o,b)}else if(v.tag===6)b=v.stateNode,d&&p&&(b=Ag(b,v.memoizedProps,v)),Q(o,b);else if(v.tag!==4){if(v.tag===22&&v.memoizedState!==null)b=v.child,b!==null&&(b.return=v),Xo(o,v,!0,!0);else if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===a)break;for(;v.sibling===null;){if(v.return===null||v.return===a)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};var U1=function(o,a,d,p){for(var v=a.child;v!==null;){if(v.tag===5){var b=v.stateNode;d&&p&&(b=Mg(b,v.type,v.memoizedProps,v)),Ng(o,b)}else if(v.tag===6)b=v.stateNode,d&&p&&(b=Ag(b,v.memoizedProps,v)),Ng(o,b);else if(v.tag!==4){if(v.tag===22&&v.memoizedState!==null)b=v.child,b!==null&&(b.return=v),U1(o,v,!0,!0);else if(v.child!==null){v.child.return=v,v=v.child;continue}}if(v===a)break;for(;v.sibling===null;){if(v.return===null||v.return===a)return;v=v.return}v.sibling.return=v.return,v=v.sibling}};Yo=function(o,a){var d=a.stateNode;if(!B1(o,a)){o=d.containerInfo;var p=Pg(o);U1(p,a,!1,!1),d.pendingChildren=p,hr(a),M4(o,p)}},Wl=function(o,a,d,p,v){var b=o.stateNode,j=o.memoizedProps;if((o=B1(o,a))&&j===p)a.stateNode=b;else{var H=a.stateNode,J=dr(Nn.current),re=null;j!==p&&(re=se(H,d,j,p,v,J)),o&&re===null?a.stateNode=b:(b=N4(b,re,d,j,p,a,o,H),Z(b,d,p,v,J)&&hr(a),a.stateNode=b,o?hr(a):Xo(b,a,!1,!1))}},$l=function(o,a,d,p){d!==p?(o=dr(Ls.current),d=dr(Nn.current),a.stateNode=ge(p,o,d,a),hr(a)):a.stateNode=o.stateNode}}else Yo=function(){},Wl=function(){},$l=function(){};function Ko(o,a){if(!qe)switch(o.tailMode){case"hidden":a=o.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?a||o.tail===null?o.tail=null:o.tail.sibling=null:p.sibling=null}}function Bt(o){var a=o.alternate!==null&&o.alternate.child===o.child,d=0,p=0;if(a)for(var v=o.child;v!==null;)d|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=o,v=v.sibling;else for(v=o.child;v!==null;)d|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=o,v=v.sibling;return o.subtreeFlags|=p,o.childLanes=d,a}function k6(o,a,d){var p=a.pendingProps;switch(ef(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(a),null;case 1:return sn(a.type)&&xl(),Bt(a),null;case 3:return d=a.stateNode,Rs(),Ye(rn),Ye(Dt),pf(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(o===null||o.child===null)&&(Pl(a)?hr(a):o===null||o.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,$n!==null&&(Kf($n),$n=null))),Yo(o,a),Bt(a),null;case 5:ff(a),d=dr(Ls.current);var v=a.type;if(o!==null&&a.stateNode!=null)Wl(o,a,v,p,d),o.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!p){if(a.stateNode===null)throw Error(l(166));return Bt(a),null}if(o=dr(Nn.current),Pl(a)){if(!oe)throw Error(l(175));o=z4(a.stateNode,a.type,a.memoizedProps,d,o,a,!zo),a.updateQueue=o,o!==null&&hr(a)}else{var b=K(v,p,d,o,a);Xo(b,a,!1,!1),a.stateNode=b,Z(b,v,p,d,o)&&hr(a)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Bt(a),null;case 6:if(o&&a.stateNode!=null)$l(o,a,o.memoizedProps,p);else{if(typeof p!="string"&&a.stateNode===null)throw Error(l(166));if(o=dr(Ls.current),d=dr(Nn.current),Pl(a)){if(!oe)throw Error(l(176));if(o=a.stateNode,d=a.memoizedProps,(p=B4(o,d,a,!zo))&&(v=yn,v!==null))switch(v.tag){case 3:Y4(v.stateNode.containerInfo,o,d,(v.mode&1)!==0);break;case 5:K4(v.type,v.memoizedProps,v.stateNode,o,d,(v.mode&1)!==0)}p&&hr(a)}else a.stateNode=ge(p,o,d,a)}return Bt(a),null;case 13:if(Ye(nt),p=a.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(qe&&bn!==null&&a.mode&1&&!(a.flags&128))Wg(),Ns(),a.flags|=98560,v=!1;else if(v=Pl(a),p!==null&&p.dehydrated!==null){if(o===null){if(!v)throw Error(l(318));if(!oe)throw Error(l(344));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(l(317));U4(v,a)}else Ns(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Bt(a),v=!1}else $n!==null&&(Kf($n),$n=null),v=!0;if(!v)return a.flags&65536?a:null}return a.flags&128?(a.lanes=d,a):(d=p!==null,d!==(o!==null&&o.memoizedState!==null)&&d&&(a.child.flags|=8192,a.mode&1&&(o===null||nt.current&1?yt===0&&(yt=3):Zf())),a.updateQueue!==null&&(a.flags|=4),Bt(a),null);case 4:return Rs(),Yo(o,a),o===null&&le(a.stateNode.containerInfo),Bt(a),null;case 10:return af(a.type._context),Bt(a),null;case 17:return sn(a.type)&&xl(),Bt(a),null;case 19:if(Ye(nt),v=a.memoizedState,v===null)return Bt(a),null;if(p=(a.flags&128)!==0,b=v.rendering,b===null)if(p)Ko(v,!1);else{if(yt!==0||o!==null&&o.flags&128)for(o=a.child;o!==null;){if(b=Fl(o),b!==null){for(a.flags|=128,Ko(v,!1),o=b.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),a.subtreeFlags=0,o=d,d=a.child;d!==null;)p=d,v=o,p.flags&=14680066,b=p.alternate,b===null?(p.childLanes=0,p.lanes=v,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=b.childLanes,p.lanes=b.lanes,p.child=b.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=b.memoizedProps,p.memoizedState=b.memoizedState,p.updateQueue=b.updateQueue,p.type=b.type,v=b.dependencies,p.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),d=d.sibling;return $e(nt,nt.current&1|2),a.child}o=o.sibling}v.tail!==null&&kt()>$f&&(a.flags|=128,p=!0,Ko(v,!1),a.lanes=4194304)}else{if(!p)if(o=Fl(b),o!==null){if(a.flags|=128,p=!0,o=o.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),Ko(v,!0),v.tail===null&&v.tailMode==="hidden"&&!b.alternate&&!qe)return Bt(a),null}else 2*kt()-v.renderingStartTime>$f&&d!==1073741824&&(a.flags|=128,p=!0,Ko(v,!1),a.lanes=4194304);v.isBackwards?(b.sibling=a.child,a.child=b):(o=v.last,o!==null?o.sibling=b:a.child=b,v.last=b)}return v.tail!==null?(a=v.tail,v.rendering=a,v.tail=a.sibling,v.renderingStartTime=kt(),a.sibling=null,o=nt.current,$e(nt,p?o&1|2:o&1),a):(Bt(a),null);case 22:case 23:return Qf(),d=a.memoizedState!==null,o!==null&&o.memoizedState!==null!==d&&(a.flags|=8192),d&&a.mode&1?vn&1073741824&&(Bt(a),ye&&a.subtreeFlags&6&&(a.flags|=8192)):Bt(a),null;case 24:return null;case 25:return null}throw Error(l(156,a.tag))}function C6(o,a){switch(ef(a),a.tag){case 1:return sn(a.type)&&xl(),o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 3:return Rs(),Ye(rn),Ye(Dt),pf(),o=a.flags,o&65536&&!(o&128)?(a.flags=o&-65537|128,a):null;case 5:return ff(a),null;case 13:if(Ye(nt),o=a.memoizedState,o!==null&&o.dehydrated!==null){if(a.alternate===null)throw Error(l(340));Ns()}return o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 19:return Ye(nt),null;case 4:return Rs(),null;case 10:return af(a.type._context),null;case 22:case 23:return Qf(),null;case 24:return null;default:return null}}var Hl=!1,Ut=!1,T6=typeof WeakSet=="function"?WeakSet:Set,de=null;function js(o,a){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(p){Je(o,a,p)}else d.current=null}function Lf(o,a,d){try{d()}catch(p){Je(o,a,p)}}var G1=!1;function E6(o,a){for(U(o.containerInfo),de=a;de!==null;)if(o=de,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,de=a;else for(;de!==null;){o=de;try{var d=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(d!==null){var p=d.memoizedProps,v=d.memoizedState,b=o.stateNode,j=b.getSnapshotBeforeUpdate(o.elementType===o.type?p:Hn(o.type,p),v);b.__reactInternalSnapshotBeforeUpdate=j}break;case 3:ye&&P4(o.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(H){Je(o,o.return,H)}if(a=o.sibling,a!==null){a.return=o.return,de=a;break}de=o.return}return d=G1,G1=!1,d}function Qo(o,a,d){var p=a.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&o)===o){var b=v.destroy;v.destroy=void 0,b!==void 0&&Lf(a,d,b)}v=v.next}while(v!==p)}}function Xl(o,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&o)===o){var p=d.create;d.destroy=p()}d=d.next}while(d!==a)}}function Rf(o){var a=o.ref;if(a!==null){var d=o.stateNode;switch(o.tag){case 5:o=$(d);break;default:o=d}typeof a=="function"?a(o):a.current=o}}function V1(o){var a=o.alternate;a!==null&&(o.alternate=null,V1(a)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(a=o.stateNode,a!==null&&Ie(a)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function W1(o){return o.tag===5||o.tag===3||o.tag===4}function $1(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||W1(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Ff(o,a,d){var p=o.tag;if(p===5||p===6)o=o.stateNode,a?_4(d,o,a):yl(d,o);else if(p!==4&&(o=o.child,o!==null))for(Ff(o,a,d),o=o.sibling;o!==null;)Ff(o,a,d),o=o.sibling}function jf(o,a,d){var p=o.tag;if(p===5||p===6)o=o.stateNode,a?Zr(d,o,a):Cs(d,o);else if(p!==4&&(o=o.child,o!==null))for(jf(o,a,d),o=o.sibling;o!==null;)jf(o,a,d),o=o.sibling}var Mt=null,Xn=!1;function pr(o,a,d){for(d=d.child;d!==null;)Of(o,a,d),d=d.sibling}function Of(o,a,d){if(lr&&typeof lr.onCommitFiberUnmount=="function")try{lr.onCommitFiberUnmount(Cl,d)}catch{}switch(d.tag){case 5:Ut||js(d,a);case 6:if(ye){var p=Mt,v=Xn;Mt=null,pr(o,a,d),Mt=p,Xn=v,Mt!==null&&(Xn?k4(Mt,d.stateNode):S4(Mt,d.stateNode))}else pr(o,a,d);break;case 18:ye&&Mt!==null&&(Xn?H4(Mt,d.stateNode):$4(Mt,d.stateNode));break;case 4:ye?(p=Mt,v=Xn,Mt=d.stateNode.containerInfo,Xn=!0,pr(o,a,d),Mt=p,Xn=v):(ie&&(p=d.stateNode.containerInfo,v=Pg(p),Bd(p,v)),pr(o,a,d));break;case 0:case 11:case 14:case 15:if(!Ut&&(p=d.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var b=v,j=b.destroy;b=b.tag,j!==void 0&&(b&2||b&4)&&Lf(d,a,j),v=v.next}while(v!==p)}pr(o,a,d);break;case 1:if(!Ut&&(js(d,a),p=d.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=d.memoizedProps,p.state=d.memoizedState,p.componentWillUnmount()}catch(H){Je(d,a,H)}pr(o,a,d);break;case 21:pr(o,a,d);break;case 22:d.mode&1?(Ut=(p=Ut)||d.memoizedState!==null,pr(o,a,d),Ut=p):pr(o,a,d);break;default:pr(o,a,d)}}function H1(o){var a=o.updateQueue;if(a!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new T6),a.forEach(function(p){var v=F6.bind(null,o,p);d.has(p)||(d.add(p),p.then(v,v))})}}function Yn(o,a){var d=a.deletions;if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];try{var b=o,j=a;if(ye){var H=j;e:for(;H!==null;){switch(H.tag){case 5:Mt=H.stateNode,Xn=!1;break e;case 3:Mt=H.stateNode.containerInfo,Xn=!0;break e;case 4:Mt=H.stateNode.containerInfo,Xn=!0;break e}H=H.return}if(Mt===null)throw Error(l(160));Of(b,j,v),Mt=null,Xn=!1}else Of(b,j,v);var J=v.alternate;J!==null&&(J.return=null),v.return=null}catch(re){Je(v,a,re)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)X1(a,o),a=a.sibling}function X1(o,a){var d=o.alternate,p=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(Yn(a,o),gr(o),p&4){try{Qo(3,o,o.return),Xl(3,o)}catch(ue){Je(o,o.return,ue)}try{Qo(5,o,o.return)}catch(ue){Je(o,o.return,ue)}}break;case 1:Yn(a,o),gr(o),p&512&&d!==null&&js(d,d.return);break;case 5:if(Yn(a,o),gr(o),p&512&&d!==null&&js(d,d.return),ye){if(o.flags&32){var v=o.stateNode;try{bg(v)}catch(ue){Je(o,o.return,ue)}}if(p&4&&(v=o.stateNode,v!=null)){var b=o.memoizedProps;if(d=d!==null?d.memoizedProps:b,p=o.type,a=o.updateQueue,o.updateQueue=null,a!==null)try{nn(v,a,p,d,b,o)}catch(ue){Je(o,o.return,ue)}}}break;case 6:if(Yn(a,o),gr(o),p&4&&ye){if(o.stateNode===null)throw Error(l(162));v=o.stateNode,b=o.memoizedProps,d=d!==null?d.memoizedProps:b;try{ke(v,d,b)}catch(ue){Je(o,o.return,ue)}}break;case 3:if(Yn(a,o),gr(o),p&4){if(ye&&oe&&d!==null&&d.memoizedState.isDehydrated)try{V4(a.containerInfo)}catch(ue){Je(o,o.return,ue)}if(ie){v=a.containerInfo,b=a.pendingChildren;try{Bd(v,b)}catch(ue){Je(o,o.return,ue)}}}break;case 4:if(Yn(a,o),gr(o),p&4&&ie){b=o.stateNode,v=b.containerInfo,b=b.pendingChildren;try{Bd(v,b)}catch(ue){Je(o,o.return,ue)}}break;case 13:Yn(a,o),gr(o),v=o.child,v.flags&8192&&(b=v.memoizedState!==null,v.stateNode.isHidden=b,!b||v.alternate!==null&&v.alternate.memoizedState!==null||(Wf=kt())),p&4&&H1(o);break;case 22:var j=d!==null&&d.memoizedState!==null;if(o.mode&1?(Ut=(d=Ut)||j,Yn(a,o),Ut=d):Yn(a,o),gr(o),p&8192){if(d=o.memoizedState!==null,(o.stateNode.isHidden=d)&&!j&&o.mode&1)for(de=o,p=o.child;p!==null;){for(a=de=p;de!==null;){j=de;var H=j.child;switch(j.tag){case 0:case 11:case 14:case 15:Qo(4,j,j.return);break;case 1:js(j,j.return);var J=j.stateNode;if(typeof J.componentWillUnmount=="function"){var re=j,pe=j.return;try{var Ce=re;J.props=Ce.memoizedProps,J.state=Ce.memoizedState,J.componentWillUnmount()}catch(ue){Je(re,pe,ue)}}break;case 5:js(j,j.return);break;case 22:if(j.memoizedState!==null){Q1(a);continue}}H!==null?(H.return=j,de=H):Q1(a)}p=p.sibling}if(ye){e:if(p=null,ye)for(a=o;;){if(a.tag===5){if(p===null){p=a;try{v=a.stateNode,d?C4(v):E4(a.stateNode,a.memoizedProps)}catch(ue){Je(o,o.return,ue)}}}else if(a.tag===6){if(p===null)try{b=a.stateNode,d?T4(b):b4(b,a.memoizedProps)}catch(ue){Je(o,o.return,ue)}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===o)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;p===a&&(p=null),a=a.return}p===a&&(p=null),a.sibling.return=a.return,a=a.sibling}}}break;case 19:Yn(a,o),gr(o),p&4&&H1(o);break;case 21:break;default:Yn(a,o),gr(o)}}function gr(o){var a=o.flags;if(a&2){try{if(ye){e:{for(var d=o.return;d!==null;){if(W1(d)){var p=d;break e}d=d.return}throw Error(l(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(bg(v),p.flags&=-33);var b=$1(o);jf(o,b,v);break;case 3:case 4:var j=p.stateNode.containerInfo,H=$1(o);Ff(o,H,j);break;default:throw Error(l(161))}}}catch(J){Je(o,o.return,J)}o.flags&=-3}a&4096&&(o.flags&=-4097)}function b6(o,a,d){de=o,Y1(o)}function Y1(o,a,d){for(var p=(o.mode&1)!==0;de!==null;){var v=de,b=v.child;if(v.tag===22&&p){var j=v.memoizedState!==null||Hl;if(!j){var H=v.alternate,J=H!==null&&H.memoizedState!==null||Ut;H=Hl;var re=Ut;if(Hl=j,(Ut=J)&&!re)for(de=v;de!==null;)j=de,J=j.child,j.tag===22&&j.memoizedState!==null?Z1(v):J!==null?(J.return=j,de=J):Z1(v);for(;b!==null;)de=b,Y1(b),b=b.sibling;de=v,Hl=H,Ut=re}K1(o)}else v.subtreeFlags&8772&&b!==null?(b.return=v,de=b):K1(o)}}function K1(o){for(;de!==null;){var a=de;if(a.flags&8772){var d=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Ut||Xl(5,a);break;case 1:var p=a.stateNode;if(a.flags&4&&!Ut)if(d===null)p.componentDidMount();else{var v=a.elementType===a.type?d.memoizedProps:Hn(a.type,d.memoizedProps);p.componentDidUpdate(v,d.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var b=a.updateQueue;b!==null&&qg(a,b,p);break;case 3:var j=a.updateQueue;if(j!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=$(a.child.stateNode);break;case 1:d=a.child.stateNode}qg(a,j,d)}break;case 5:var H=a.stateNode;d===null&&a.flags&4&&Xe(H,a.type,a.memoizedProps,a);break;case 6:break;case 4:break;case 12:break;case 13:if(oe&&a.memoizedState===null){var J=a.alternate;if(J!==null){var re=J.memoizedState;if(re!==null){var pe=re.dehydrated;pe!==null&&W4(pe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(l(163))}Ut||a.flags&512&&Rf(a)}catch(Ce){Je(a,a.return,Ce)}}if(a===o){de=null;break}if(d=a.sibling,d!==null){d.return=a.return,de=d;break}de=a.return}}function Q1(o){for(;de!==null;){var a=de;if(a===o){de=null;break}var d=a.sibling;if(d!==null){d.return=a.return,de=d;break}de=a.return}}function Z1(o){for(;de!==null;){var a=de;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{Xl(4,a)}catch(J){Je(a,d,J)}break;case 1:var p=a.stateNode;if(typeof p.componentDidMount=="function"){var v=a.return;try{p.componentDidMount()}catch(J){Je(a,v,J)}}var b=a.return;try{Rf(a)}catch(J){Je(a,b,J)}break;case 5:var j=a.return;try{Rf(a)}catch(J){Je(a,j,J)}}}catch(J){Je(a,a.return,J)}if(a===o){de=null;break}var H=a.sibling;if(H!==null){H.return=a.return,de=H;break}de=a.return}}var Yl=0,Kl=1,Ql=2,Zl=3,ql=4;if(typeof Symbol=="function"&&Symbol.for){var Zo=Symbol.for;Yl=Zo("selector.component"),Kl=Zo("selector.has_pseudo_class"),Ql=Zo("selector.role"),Zl=Zo("selector.test_id"),ql=Zo("selector.text")}function Df(o){var a=Ee(o);if(a!=null){if(typeof a.memoizedProps["data-testname"]!="string")throw Error(l(364));return a}if(o=ws(o),o===null)throw Error(l(362));return o.stateNode.current}function zf(o,a){switch(a.$$typeof){case Yl:if(o.type===a.value)return!0;break;case Kl:e:{a=a.value,o=[o,0];for(var d=0;d<o.length;){var p=o[d++],v=o[d++],b=a[v];if(p.tag!==5||!ar(p)){for(;b!=null&&zf(p,b);)v++,b=a[v];if(v===a.length){a=!0;break e}else for(p=p.child;p!==null;)o.push(p,v),p=p.sibling}}a=!1}return a;case Ql:if(o.tag===5&&ks(o.stateNode,a.value))return!0;break;case ql:if((o.tag===5||o.tag===6)&&(o=Ss(o),o!==null&&0<=o.indexOf(a.value)))return!0;break;case Zl:if(o.tag===5&&(o=o.memoizedProps["data-testname"],typeof o=="string"&&o.toLowerCase()===a.value.toLowerCase()))return!0;break;default:throw Error(l(365))}return!1}function Bf(o){switch(o.$$typeof){case Yl:return"<"+(L(o.value)||"Unknown")+">";case Kl:return":has("+(Bf(o)||"")+")";case Ql:return'[role="'+o.value+'"]';case ql:return'"'+o.value+'"';case Zl:return'[data-testname="'+o.value+'"]';default:throw Error(l(365))}}function q1(o,a){var d=[];o=[o,0];for(var p=0;p<o.length;){var v=o[p++],b=o[p++],j=a[b];if(v.tag!==5||!ar(v)){for(;j!=null&&zf(v,j);)b++,j=a[b];if(b===a.length)d.push(v);else for(v=v.child;v!==null;)o.push(v,b),v=v.sibling}}return d}function Uf(o,a){if(!Ot)throw Error(l(363));o=Df(o),o=q1(o,a),a=[],o=Array.from(o);for(var d=0;d<o.length;){var p=o[d++];if(p.tag===5)ar(p)||a.push(p.stateNode);else for(p=p.child;p!==null;)o.push(p),p=p.sibling}return a}var P6=Math.ceil,Jl=c.ReactCurrentDispatcher,Gf=c.ReactCurrentOwner,dt=c.ReactCurrentBatchConfig,Ne=0,Tt=null,pt=null,At=0,vn=0,Os=qr(0),yt=0,qo=null,Wi=0,eu=0,Vf=0,Jo=null,an=null,Wf=0,$f=1/0,Mr=null;function Ds(){$f=kt()+500}var tu=!1,Hf=null,ni=null,nu=!1,ri=null,ru=0,ea=0,Xf=null,iu=-1,su=0;function Gt(){return Ne&6?kt():iu!==-1?iu:iu=kt()}function ii(o){return o.mode&1?Ne&2&&At!==0?At&-At:c6.transition!==null?(su===0&&(su=jg()),su):(o=Oe,o!==0?o:Se()):1}function An(o,a,d,p){if(50<ea)throw ea=0,Xf=null,Error(l(185));Do(o,d,p),(!(Ne&2)||o!==Tt)&&(o===Tt&&(!(Ne&2)&&(eu|=d),yt===4&&si(o,At)),ln(o,p),d===1&&Ne===0&&!(a.mode&1)&&(Ds(),Tl&&ur()))}function ln(o,a){var d=o.callbackNode;t6(o,a);var p=kl(o,o===Tt?At:0);if(p===0)d!==null&&Dg(d),o.callbackNode=null,o.callbackPriority=0;else if(a=p&-p,o.callbackPriority!==a){if(d!=null&&Dg(d),a===1)o.tag===0?u6(em.bind(null,o)):zg(em.bind(null,o)),Fe?tn(function(){!(Ne&6)&&ur()}):Kd(Qd,ur),d=null;else{switch(Og(p)){case 1:d=Qd;break;case 4:d=s6;break;case 16:d=Zd;break;case 536870912:d=o6;break;default:d=Zd}d=um(d,J1.bind(null,o))}o.callbackPriority=a,o.callbackNode=d}}function J1(o,a){if(iu=-1,su=0,Ne&6)throw Error(l(327));var d=o.callbackNode;if(Xi()&&o.callbackNode!==d)return null;var p=kl(o,o===Tt?At:0);if(p===0)return null;if(p&30||p&o.expiredLanes||a)a=ou(o,p);else{a=p;var v=Ne;Ne|=2;var b=rm();(Tt!==o||At!==a)&&(Mr=null,Ds(),$i(o,a));do try{A6();break}catch(H){nm(o,H)}while(1);of(),Jl.current=b,Ne=v,pt!==null?a=0:(Tt=null,At=0,a=yt)}if(a!==0){if(a===2&&(v=Hd(o),v!==0&&(p=v,a=Yf(o,v))),a===1)throw d=qo,$i(o,0),si(o,p),ln(o,kt()),d;if(a===6)si(o,p);else{if(v=o.current.alternate,!(p&30)&&!N6(v)&&(a=ou(o,p),a===2&&(b=Hd(o),b!==0&&(p=b,a=Yf(o,b))),a===1))throw d=qo,$i(o,0),si(o,p),ln(o,kt()),d;switch(o.finishedWork=v,o.finishedLanes=p,a){case 0:case 1:throw Error(l(345));case 2:Hi(o,an,Mr);break;case 3:if(si(o,p),(p&130023424)===p&&(a=Wf+500-kt(),10<a)){if(kl(o,0)!==0)break;if(v=o.suspendedLanes,(v&p)!==p){Gt(),o.pingedLanes|=o.suspendedLanes&v;break}o.timeoutHandle=V(Hi.bind(null,o,an,Mr),a);break}Hi(o,an,Mr);break;case 4:if(si(o,p),(p&4194240)===p)break;for(a=o.eventTimes,v=-1;0<p;){var j=31-Vn(p);b=1<<j,j=a[j],j>v&&(v=j),p&=~b}if(p=v,p=kt()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*P6(p/1960))-p,10<p){o.timeoutHandle=V(Hi.bind(null,o,an,Mr),p);break}Hi(o,an,Mr);break;case 5:Hi(o,an,Mr);break;default:throw Error(l(329))}}}return ln(o,kt()),o.callbackNode===d?J1.bind(null,o):null}function Yf(o,a){var d=Jo;return o.current.memoizedState.isDehydrated&&($i(o,a).flags|=256),o=ou(o,a),o!==2&&(a=an,an=d,a!==null&&Kf(a)),o}function Kf(o){an===null?an=o:an.push.apply(an,o)}function N6(o){for(var a=o;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var p=0;p<d.length;p++){var v=d[p],b=v.getSnapshot;v=v.value;try{if(!Wn(b(),v))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function si(o,a){for(a&=~Vf,a&=~eu,o.suspendedLanes|=a,o.pingedLanes&=~a,o=o.expirationTimes;0<a;){var d=31-Vn(a),p=1<<d;o[d]=-1,a&=~p}}function em(o){if(Ne&6)throw Error(l(327));Xi();var a=kl(o,0);if(!(a&1))return ln(o,kt()),null;var d=ou(o,a);if(o.tag!==0&&d===2){var p=Hd(o);p!==0&&(a=p,d=Yf(o,p))}if(d===1)throw d=qo,$i(o,0),si(o,a),ln(o,kt()),d;if(d===6)throw Error(l(345));return o.finishedWork=o.current.alternate,o.finishedLanes=a,Hi(o,an,Mr),ln(o,kt()),null}function tm(o){ri!==null&&ri.tag===0&&!(Ne&6)&&Xi();var a=Ne;Ne|=1;var d=dt.transition,p=Oe;try{if(dt.transition=null,Oe=1,o)return o()}finally{Oe=p,dt.transition=d,Ne=a,!(Ne&6)&&ur()}}function Qf(){vn=Os.current,Ye(Os)}function $i(o,a){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==ae&&(o.timeoutHandle=ae,te(d)),pt!==null)for(d=pt.return;d!==null;){var p=d;switch(ef(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&xl();break;case 3:Rs(),Ye(rn),Ye(Dt),pf();break;case 5:ff(p);break;case 4:Rs();break;case 13:Ye(nt);break;case 19:Ye(nt);break;case 10:af(p.type._context);break;case 22:case 23:Qf()}d=d.return}if(Tt=o,pt=o=oi(o.current,null),At=vn=a,yt=0,qo=null,Vf=eu=Wi=0,an=Jo=null,Gi!==null){for(a=0;a<Gi.length;a++)if(d=Gi[a],p=d.interleaved,p!==null){d.interleaved=null;var v=p.next,b=d.pending;if(b!==null){var j=b.next;b.next=v,p.next=j}d.pending=p}Gi=null}return o}function nm(o,a){do{var d=pt;try{if(of(),jl.current=Bl,Ol){for(var p=rt.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}Ol=!1}if(Vi=0,Ct=mt=rt=null,Vo=!1,Wo=0,Gf.current=null,d===null||d.return===null){yt=1,qo=a,pt=null;break}e:{var b=o,j=d.return,H=d,J=a;if(a=At,H.flags|=32768,J!==null&&typeof J=="object"&&typeof J.then=="function"){var re=J,pe=H,Ce=pe.tag;if(!(pe.mode&1)&&(Ce===0||Ce===11||Ce===15)){var ue=pe.alternate;ue?(pe.updateQueue=ue.updateQueue,pe.memoizedState=ue.memoizedState,pe.lanes=ue.lanes):(pe.updateQueue=null,pe.memoizedState=null)}var Ke=b1(j);if(Ke!==null){Ke.flags&=-257,P1(Ke,j,H,b,a),Ke.mode&1&&E1(b,re,a),a=Ke,J=re;var Ve=a.updateQueue;if(Ve===null){var un=new Set;un.add(J),a.updateQueue=un}else Ve.add(J);break e}else{if(!(a&1)){E1(b,re,a),Zf();break e}J=Error(l(426))}}else if(qe&&H.mode&1){var Ar=b1(j);if(Ar!==null){!(Ar.flags&65536)&&(Ar.flags|=256),P1(Ar,j,H,b,a),rf(Fs(J,H));break e}}b=J=Fs(J,H),yt!==4&&(yt=2),Jo===null?Jo=[b]:Jo.push(b),b=j;do{switch(b.tag){case 3:b.flags|=65536,a&=-a,b.lanes|=a;var q=C1(b,J,a);Zg(b,q);break e;case 1:H=J;var Y=b.type,ee=b.stateNode;if(!(b.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&(ni===null||!ni.has(ee)))){b.flags|=65536,a&=-a,b.lanes|=a;var ce=T1(b,H,a);Zg(b,ce);break e}}b=b.return}while(b!==null)}sm(d)}catch(me){a=me,pt===d&&d!==null&&(pt=d=d.return);continue}break}while(1)}function rm(){var o=Jl.current;return Jl.current=Bl,o===null?Bl:o}function Zf(){(yt===0||yt===3||yt===2)&&(yt=4),Tt===null||!(Wi&268435455)&&!(eu&268435455)||si(Tt,At)}function ou(o,a){var d=Ne;Ne|=2;var p=rm();(Tt!==o||At!==a)&&(Mr=null,$i(o,a));do try{M6();break}catch(v){nm(o,v)}while(1);if(of(),Ne=d,Jl.current=p,pt!==null)throw Error(l(261));return Tt=null,At=0,yt}function M6(){for(;pt!==null;)im(pt)}function A6(){for(;pt!==null&&!r6();)im(pt)}function im(o){var a=lm(o.alternate,o,vn);o.memoizedProps=o.pendingProps,a===null?sm(o):pt=a,Gf.current=null}function sm(o){var a=o;do{var d=a.alternate;if(o=a.return,a.flags&32768){if(d=C6(d,a),d!==null){d.flags&=32767,pt=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{yt=6,pt=null;return}}else if(d=k6(d,a,vn),d!==null){pt=d;return}if(a=a.sibling,a!==null){pt=a;return}pt=a=o}while(a!==null);yt===0&&(yt=5)}function Hi(o,a,d){var p=Oe,v=dt.transition;try{dt.transition=null,Oe=1,I6(o,a,d,p)}finally{dt.transition=v,Oe=p}return null}function I6(o,a,d,p){do Xi();while(ri!==null);if(Ne&6)throw Error(l(327));d=o.finishedWork;var v=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(l(177));o.callbackNode=null,o.callbackPriority=0;var b=d.lanes|d.childLanes;if(n6(o,b),o===Tt&&(pt=Tt=null,At=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||nu||(nu=!0,um(Zd,function(){return Xi(),null})),b=(d.flags&15990)!==0,d.subtreeFlags&15990||b){b=dt.transition,dt.transition=null;var j=Oe;Oe=1;var H=Ne;Ne|=4,Gf.current=null,E6(o,d),X1(d,o),G(o.containerInfo),o.current=d,b6(d),i6(),Ne=H,Oe=j,dt.transition=b}else o.current=d;if(nu&&(nu=!1,ri=o,ru=v),b=o.pendingLanes,b===0&&(ni=null),a6(d.stateNode),ln(o,kt()),a!==null)for(p=o.onRecoverableError,d=0;d<a.length;d++)v=a[d],p(v.value,{componentStack:v.stack,digest:v.digest});if(tu)throw tu=!1,o=Hf,Hf=null,o;return ru&1&&o.tag!==0&&Xi(),b=o.pendingLanes,b&1?o===Xf?ea++:(ea=0,Xf=o):ea=0,ur(),null}function Xi(){if(ri!==null){var o=Og(ru),a=dt.transition,d=Oe;try{if(dt.transition=null,Oe=16>o?16:o,ri===null)var p=!1;else{if(o=ri,ri=null,ru=0,Ne&6)throw Error(l(331));var v=Ne;for(Ne|=4,de=o.current;de!==null;){var b=de,j=b.child;if(de.flags&16){var H=b.deletions;if(H!==null){for(var J=0;J<H.length;J++){var re=H[J];for(de=re;de!==null;){var pe=de;switch(pe.tag){case 0:case 11:case 15:Qo(8,pe,b)}var Ce=pe.child;if(Ce!==null)Ce.return=pe,de=Ce;else for(;de!==null;){pe=de;var ue=pe.sibling,Ke=pe.return;if(V1(pe),pe===re){de=null;break}if(ue!==null){ue.return=Ke,de=ue;break}de=Ke}}}var Ve=b.alternate;if(Ve!==null){var un=Ve.child;if(un!==null){Ve.child=null;do{var Ar=un.sibling;un.sibling=null,un=Ar}while(un!==null)}}de=b}}if(b.subtreeFlags&2064&&j!==null)j.return=b,de=j;else e:for(;de!==null;){if(b=de,b.flags&2048)switch(b.tag){case 0:case 11:case 15:Qo(9,b,b.return)}var q=b.sibling;if(q!==null){q.return=b.return,de=q;break e}de=b.return}}var Y=o.current;for(de=Y;de!==null;){j=de;var ee=j.child;if(j.subtreeFlags&2064&&ee!==null)ee.return=j,de=ee;else e:for(j=Y;de!==null;){if(H=de,H.flags&2048)try{switch(H.tag){case 0:case 11:case 15:Xl(9,H)}}catch(me){Je(H,H.return,me)}if(H===j){de=null;break e}var ce=H.sibling;if(ce!==null){ce.return=H.return,de=ce;break e}de=H.return}}if(Ne=v,ur(),lr&&typeof lr.onPostCommitFiberRoot=="function")try{lr.onPostCommitFiberRoot(Cl,o)}catch{}p=!0}return p}finally{Oe=d,dt.transition=a}}return!1}function om(o,a,d){a=Fs(d,a),a=C1(o,a,1),o=ti(o,a,1),a=Gt(),o!==null&&(Do(o,1,a),ln(o,a))}function Je(o,a,d){if(o.tag===3)om(o,o,d);else for(;a!==null;){if(a.tag===3){om(a,o,d);break}else if(a.tag===1){var p=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ni===null||!ni.has(p))){o=Fs(d,o),o=T1(a,o,1),a=ti(a,o,1),o=Gt(),a!==null&&(Do(a,1,o),ln(a,o));break}}a=a.return}}function L6(o,a,d){var p=o.pingCache;p!==null&&p.delete(a),a=Gt(),o.pingedLanes|=o.suspendedLanes&d,Tt===o&&(At&d)===d&&(yt===4||yt===3&&(At&130023424)===At&&500>kt()-Wf?$i(o,0):Vf|=d),ln(o,a)}function am(o,a){a===0&&(o.mode&1?(a=Sl,Sl<<=1,!(Sl&130023424)&&(Sl=4194304)):a=1);var d=Gt();o=cr(o,a),o!==null&&(Do(o,a,d),ln(o,d))}function R6(o){var a=o.memoizedState,d=0;a!==null&&(d=a.retryLane),am(o,d)}function F6(o,a){var d=0;switch(o.tag){case 13:var p=o.stateNode,v=o.memoizedState;v!==null&&(d=v.retryLane);break;case 19:p=o.stateNode;break;default:throw Error(l(314))}p!==null&&p.delete(a),am(o,d)}var lm;lm=function(o,a,d){if(o!==null)if(o.memoizedProps!==a.pendingProps||rn.current)on=!0;else{if(!(o.lanes&d)&&!(a.flags&128))return on=!1,S6(o,a,d);on=!!(o.flags&131072)}else on=!1,qe&&a.flags&1048576&&Bg(a,bl,a.index);switch(a.lanes=0,a.tag){case 2:var p=a.type;Vl(o,a),o=a.pendingProps;var v=Es(a,Dt.current);Is(a,d),v=yf(null,a,p,o,v,d);var b=vf();return a.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,sn(p)?(b=!0,wl(a)):b=!1,a.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,cf(a),v.updater=Ul,a.stateNode=v,v._reactInternals=a,Cf(a,p,o,d),a=Pf(null,a,p,!0,b,d)):(a.tag=0,qe&&b&&Jd(a),Kt(null,a,v,d),a=a.child),a;case 16:p=a.elementType;e:{switch(Vl(o,a),o=a.pendingProps,v=p._init,p=v(p._payload),a.type=p,v=a.tag=O6(p),o=Hn(p,o),v){case 0:a=bf(null,a,p,o,d);break e;case 1:a=R1(null,a,p,o,d);break e;case 11:a=N1(null,a,p,o,d);break e;case 14:a=M1(null,a,p,Hn(p.type,o),d);break e}throw Error(l(306,p,""))}return a;case 0:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Hn(p,v),bf(o,a,p,v,d);case 1:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Hn(p,v),R1(o,a,p,v,d);case 3:e:{if(F1(a),o===null)throw Error(l(387));p=a.pendingProps,b=a.memoizedState,v=b.element,Qg(o,a),Rl(a,p,null,d);var j=a.memoizedState;if(p=j.element,oe&&b.isDehydrated)if(b={element:p,isDehydrated:!1,cache:j.cache,pendingSuspenseBoundaries:j.pendingSuspenseBoundaries,transitions:j.transitions},a.updateQueue.baseState=b,a.memoizedState=b,a.flags&256){v=Fs(Error(l(423)),a),a=j1(o,a,p,d,v);break e}else if(p!==v){v=Fs(Error(l(424)),a),a=j1(o,a,p,d,v);break e}else for(oe&&(bn=O4(a.stateNode.containerInfo),yn=a,qe=!0,$n=null,zo=!1),d=Xg(a,null,p,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ns(),p===v){a=Nr(o,a,d);break e}Kt(o,a,p,d)}a=a.child}return a;case 5:return Jg(a),o===null&&nf(a),p=a.type,v=a.pendingProps,b=o!==null?o.memoizedProps:null,j=v.children,xe(p,v)?j=null:b!==null&&xe(p,b)&&(a.flags|=32),L1(o,a),Kt(o,a,j,d),a.child;case 6:return o===null&&nf(a),null;case 13:return O1(o,a,d);case 4:return df(a,a.stateNode.containerInfo),p=a.pendingProps,o===null?a.child=Ms(a,null,p,d):Kt(o,a,p,d),a.child;case 11:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Hn(p,v),N1(o,a,p,v,d);case 7:return Kt(o,a,a.pendingProps,d),a.child;case 8:return Kt(o,a,a.pendingProps.children,d),a.child;case 12:return Kt(o,a,a.pendingProps.children,d),a.child;case 10:e:{if(p=a.type._context,v=a.pendingProps,b=a.memoizedProps,j=v.value,Yg(a,p,j),b!==null)if(Wn(b.value,j)){if(b.children===v.children&&!rn.current){a=Nr(o,a,d);break e}}else for(b=a.child,b!==null&&(b.return=a);b!==null;){var H=b.dependencies;if(H!==null){j=b.child;for(var J=H.firstContext;J!==null;){if(J.context===p){if(b.tag===1){J=Pr(-1,d&-d),J.tag=2;var re=b.updateQueue;if(re!==null){re=re.shared;var pe=re.pending;pe===null?J.next=J:(J.next=pe.next,pe.next=J),re.pending=J}}b.lanes|=d,J=b.alternate,J!==null&&(J.lanes|=d),lf(b.return,d,a),H.lanes|=d;break}J=J.next}}else if(b.tag===10)j=b.type===a.type?null:b.child;else if(b.tag===18){if(j=b.return,j===null)throw Error(l(341));j.lanes|=d,H=j.alternate,H!==null&&(H.lanes|=d),lf(j,d,a),j=b.sibling}else j=b.child;if(j!==null)j.return=b;else for(j=b;j!==null;){if(j===a){j=null;break}if(b=j.sibling,b!==null){b.return=j.return,j=b;break}j=j.return}b=j}Kt(o,a,v.children,d),a=a.child}return a;case 9:return v=a.type,p=a.pendingProps.children,Is(a,d),v=Pn(v),p=p(v),a.flags|=1,Kt(o,a,p,d),a.child;case 14:return p=a.type,v=Hn(p,a.pendingProps),v=Hn(p.type,v),M1(o,a,p,v,d);case 15:return A1(o,a,a.type,a.pendingProps,d);case 17:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:Hn(p,v),Vl(o,a),a.tag=1,sn(p)?(o=!0,wl(a)):o=!1,Is(a,d),S1(a,p,v),Cf(a,p,v,d),Pf(null,a,p,!0,o,d);case 19:return z1(o,a,d);case 22:return I1(o,a,d)}throw Error(l(156,a.tag))};function um(o,a){return Kd(o,a)}function j6(o,a,d,p){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(o,a,d,p){return new j6(o,a,d,p)}function qf(o){return o=o.prototype,!(!o||!o.isReactComponent)}function O6(o){if(typeof o=="function")return qf(o)?1:0;if(o!=null){if(o=o.$$typeof,o===E)return 11;if(o===C)return 14}return 2}function oi(o,a){var d=o.alternate;return d===null?(d=In(o.tag,a,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=a,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,a=o.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function au(o,a,d,p,v,b){var j=2;if(p=o,typeof o=="function")qf(o)&&(j=1);else if(typeof o=="string")j=5;else e:switch(o){case h:return Yi(d.children,v,b,a);case m:j=8,v|=8;break;case x:return o=In(12,d,a,v|2),o.elementType=x,o.lanes=b,o;case _:return o=In(13,d,a,v),o.elementType=_,o.lanes=b,o;case S:return o=In(19,d,a,v),o.elementType=S,o.lanes=b,o;case k:return lu(d,v,b,a);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case y:j=10;break e;case w:j=9;break e;case E:j=11;break e;case C:j=14;break e;case g:j=16,p=null;break e}throw Error(l(130,o==null?o:typeof o,""))}return a=In(j,d,a,v),a.elementType=o,a.type=p,a.lanes=b,a}function Yi(o,a,d,p){return o=In(7,o,p,a),o.lanes=d,o}function lu(o,a,d,p){return o=In(22,o,p,a),o.elementType=k,o.lanes=d,o.stateNode={isHidden:!1},o}function Jf(o,a,d){return o=In(6,o,null,a),o.lanes=d,o}function eh(o,a,d){return a=In(4,o.children!==null?o.children:[],o.key,a),a.lanes=d,a.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},a}function D6(o,a,d,p,v){this.tag=a,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ae,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xd(0),this.expirationTimes=Xd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xd(0),this.identifierPrefix=p,this.onRecoverableError=v,oe&&(this.mutableSourceEagerHydrationData=null)}function cm(o,a,d,p,v,b,j,H,J){return o=new D6(o,a,d,H,J),a===1?(a=1,b===!0&&(a|=8)):a=0,b=In(3,null,null,a),o.current=b,b.stateNode=o,b.memoizedState={element:p,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},cf(b),o}function dm(o){if(!o)return Jr;o=o._reactInternals;e:{if(R(o)!==o||o.tag!==1)throw Error(l(170));var a=o;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(sn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(l(171))}if(o.tag===1){var d=o.type;if(sn(d))return Rg(o,d,a)}return a}function fm(o){var a=o._reactInternals;if(a===void 0)throw typeof o.render=="function"?Error(l(188)):(o=Object.keys(o).join(","),Error(l(268,o)));return o=O(a),o===null?null:o.stateNode}function hm(o,a){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<a?d:a}}function uu(o,a){hm(o,a),(o=o.alternate)&&hm(o,a)}function z6(o){return o=O(o),o===null?null:o.stateNode}function B6(){return null}return n.attemptContinuousHydration=function(o){if(o.tag===13){var a=cr(o,134217728);if(a!==null){var d=Gt();An(a,o,134217728,d)}uu(o,134217728)}},n.attemptDiscreteHydration=function(o){if(o.tag===13){var a=cr(o,1);if(a!==null){var d=Gt();An(a,o,1,d)}uu(o,1)}},n.attemptHydrationAtCurrentPriority=function(o){if(o.tag===13){var a=ii(o),d=cr(o,a);if(d!==null){var p=Gt();An(d,o,a,p)}uu(o,a)}},n.attemptSynchronousHydration=function(o){switch(o.tag){case 3:var a=o.stateNode;if(a.current.memoizedState.isDehydrated){var d=Oo(a.pendingLanes);d!==0&&(Yd(a,d|1),ln(a,kt()),!(Ne&6)&&(Ds(),ur()))}break;case 13:tm(function(){var p=cr(o,1);if(p!==null){var v=Gt();An(p,o,1,v)}}),uu(o,1)}},n.batchedUpdates=function(o,a){var d=Ne;Ne|=1;try{return o(a)}finally{Ne=d,Ne===0&&(Ds(),Tl&&ur())}},n.createComponentSelector=function(o){return{$$typeof:Yl,value:o}},n.createContainer=function(o,a,d,p,v,b,j){return cm(o,a,!1,null,d,p,v,b,j)},n.createHasPseudoClassSelector=function(o){return{$$typeof:Kl,value:o}},n.createHydrationContainer=function(o,a,d,p,v,b,j,H,J){return o=cm(d,p,!0,o,v,b,j,H,J),o.context=dm(null),d=o.current,p=Gt(),v=ii(d),b=Pr(p,v),b.callback=a??null,ti(d,b,v),o.current.lanes=v,Do(o,v,p),ln(o,p),o},n.createPortal=function(o,a,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:f,key:p==null?null:""+p,children:o,containerInfo:a,implementation:d}},n.createRoleSelector=function(o){return{$$typeof:Ql,value:o}},n.createTestNameSelector=function(o){return{$$typeof:Zl,value:o}},n.createTextSelector=function(o){return{$$typeof:ql,value:o}},n.deferredUpdates=function(o){var a=Oe,d=dt.transition;try{return dt.transition=null,Oe=16,o()}finally{Oe=a,dt.transition=d}},n.discreteUpdates=function(o,a,d,p,v){var b=Oe,j=dt.transition;try{return dt.transition=null,Oe=1,o(a,d,p,v)}finally{Oe=b,dt.transition=j,Ne===0&&Ds()}},n.findAllNodes=Uf,n.findBoundingRects=function(o,a){if(!Ot)throw Error(l(363));a=Uf(o,a),o=[];for(var d=0;d<a.length;d++)o.push(_s(a[d]));for(a=o.length-1;0<a;a--){d=o[a];for(var p=d.x,v=p+d.width,b=d.y,j=b+d.height,H=a-1;0<=H;H--)if(a!==H){var J=o[H],re=J.x,pe=re+J.width,Ce=J.y,ue=Ce+J.height;if(p>=re&&b>=Ce&&v<=pe&&j<=ue){o.splice(a,1);break}else if(p!==re||d.width!==J.width||ue<b||Ce>j){if(!(b!==Ce||d.height!==J.height||pe<p||re>v)){re>p&&(J.width+=re-p,J.x=p),pe<v&&(J.width=v-re),o.splice(a,1);break}}else{Ce>b&&(J.height+=Ce-b,J.y=b),ue<j&&(J.height=j-Ce),o.splice(a,1);break}}}return o},n.findHostInstance=fm,n.findHostInstanceWithNoPortals=function(o){return o=I(o),o=o!==null?B(o):null,o===null?null:o.stateNode},n.findHostInstanceWithWarning=function(o){return fm(o)},n.flushControlled=function(o){var a=Ne;Ne|=1;var d=dt.transition,p=Oe;try{dt.transition=null,Oe=1,o()}finally{Oe=p,dt.transition=d,Ne=a,Ne===0&&(Ds(),ur())}},n.flushPassiveEffects=Xi,n.flushSync=tm,n.focusWithin=function(o,a){if(!Ot)throw Error(l(363));for(o=Df(o),a=q1(o,a),a=Array.from(a),o=0;o<a.length;){var d=a[o++];if(!ar(d)){if(d.tag===5&&Nt(d.stateNode))return!0;for(d=d.child;d!==null;)a.push(d),d=d.sibling}}return!1},n.getCurrentUpdatePriority=function(){return Oe},n.getFindAllNodesFailureDescription=function(o,a){if(!Ot)throw Error(l(363));var d=0,p=[];o=[Df(o),0];for(var v=0;v<o.length;){var b=o[v++],j=o[v++],H=a[j];if((b.tag!==5||!ar(b))&&(zf(b,H)&&(p.push(Bf(H)),j++,j>d&&(d=j)),j<a.length))for(b=b.child;b!==null;)o.push(b,j),b=b.sibling}if(d<a.length){for(o=[];d<a.length;d++)o.push(Bf(a[d]));return`findAllNodes was able to match part of the selector:
  `+(p.join(" > ")+`

No matching component was found for:
  `)+o.join(" > ")}return null},n.getPublicRootInstance=function(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return $(o.child.stateNode);default:return o.child.stateNode}},n.injectIntoDevTools=function(o){if(o={bundleType:o.bundleType,version:o.version,rendererPackageName:o.rendererPackageName,rendererConfig:o.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:c.ReactCurrentDispatcher,findHostInstanceByFiber:z6,findFiberByHostInstance:o.findFiberByHostInstance||B6,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")o=!1;else{var a=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(a.isDisabled||!a.supportsFiber)o=!0;else{try{Cl=a.inject(o),lr=a}catch{}o=!!a.checkDCE}}return o},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(o,a,d,p){if(!Ot)throw Error(l(363));o=Uf(o,a);var v=Qr(o,d,p).disconnect;return{disconnect:function(){v()}}},n.registerMutableSourceForHydration=function(o,a){var d=a._getVersion;d=d(a._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[a,d]:o.mutableSourceEagerHydrationData.push(a,d)},n.runWithPriority=function(o,a){var d=Oe;try{return Oe=o,a()}finally{Oe=d}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(o,a,d,p){var v=a.current,b=Gt(),j=ii(v);return d=dm(d),a.context===null?a.context=d:a.pendingContext=d,a=Pr(b,j),a.payload={element:o},p=p===void 0?null:p,p!==null&&(a.callback=p),o=ti(v,a,j),o!==null&&(An(o,v,j,b),Ll(o,v,j)),j},n};l4.exports=RT;var FT=l4.exports;const jT=il(FT);var u4={exports:{}},xs={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */xs.ConcurrentRoot=1;xs.ContinuousEventPriority=4;xs.DefaultEventPriority=16;xs.DiscreteEventPriority=1;xs.IdleEventPriority=536870912;xs.LegacyRoot=0;u4.exports=xs;var c4=u4.exports;const M2={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let A2=!1,I2=!1;const Sg=".react-konva-event",OT=`ReactKonva: You have a Konva node with draggable = true and position defined but no onDragMove or onDragEnd events are handled.
Position of a node will be changed during drag&drop, so you should update state of the react app as well.
Consider to add onDragMove or onDragEnd events.
For more info see: https://github.com/konvajs/react-konva/issues/256
`,DT=`ReactKonva: You are using "zIndex" attribute for a Konva node.
react-konva may get confused with ordering. Just define correct order of elements in your render function of a component.
For more info see: https://github.com/konvajs/react-konva/issues/194
`,zT={};function Dd(t,e,n=zT){if(!A2&&"zIndex"in e&&(console.warn(DT),A2=!0),!I2&&e.draggable){var r=e.x!==void 0||e.y!==void 0,i=e.onDragEnd||e.onDragMove;r&&!i&&(console.warn(OT),I2=!0)}for(var s in n)if(!M2[s]){var l=s.slice(0,2)==="on",c=n[s]!==e[s];if(l&&c){var u=s.substr(2).toLowerCase();u.substr(0,7)==="content"&&(u="content"+u.substr(7,1).toUpperCase()+u.substr(8)),t.off(u,n[s])}var f=!e.hasOwnProperty(s);f&&t.setAttr(s,void 0)}var h=e._useStrictMode,m={},x=!1;const y={};for(var s in e)if(!M2[s]){var l=s.slice(0,2)==="on",w=n[s]!==e[s];if(l&&w){var u=s.substr(2).toLowerCase();u.substr(0,7)==="content"&&(u="content"+u.substr(7,1).toUpperCase()+u.substr(8)),e[s]&&(y[u]=e[s])}!l&&(e[s]!==n[s]||h&&e[s]!==t.getAttr(s))&&(x=!0,m[s]=e[s])}x&&(t.setAttrs(m),Di(t));for(var u in y)t.on(u+Sg,y[u])}function Di(t){if(!Pe.Konva.autoDrawEnabled){var e=t.getLayer()||t.getStage();e&&e.batchDraw()}}const d4={},BT={};nl.Node.prototype._applyProps=Dd;function UT(t,e){if(typeof e=="string"){console.error(`Do not use plain text as child of Konva.Node. You are using text: ${e}`);return}t.add(e),Di(t)}function GT(t,e,n){let r=nl[t];r||(console.error(`Konva has no node with the type ${t}. Group will be used instead. If you use minimal version of react-konva, just import required nodes into Konva: "import "konva/lib/shapes/${t}"  If you want to render DOM elements as part of canvas tree take a look into this demo: https://konvajs.github.io/docs/react/DOM_Portal.html`),r=nl.Group);const i={},s={};for(var l in e){var c=l.slice(0,2)==="on";c?s[l]=e[l]:i[l]=e[l]}const u=new r(i);return Dd(u,s),u}function VT(t,e,n){console.error(`Text components are not supported for now in ReactKonva. Your text is: "${t}"`)}function WT(t,e,n){return!1}function $T(t){return t}function HT(){return null}function XT(){return null}function YT(t,e,n,r){return BT}function KT(){}function QT(t){}function ZT(t,e){return!1}function qT(){return d4}function JT(){return d4}const eE=setTimeout,tE=clearTimeout,nE=-1;function rE(t,e){return!1}const iE=!1,sE=!0,oE=!0;function aE(t,e){e.parent===t?e.moveToTop():t.add(e),Di(t)}function lE(t,e){e.parent===t?e.moveToTop():t.add(e),Di(t)}function f4(t,e,n){e._remove(),t.add(e),e.setZIndex(n.getZIndex()),Di(t)}function uE(t,e,n){f4(t,e,n)}function cE(t,e){e.destroy(),e.off(Sg),Di(t)}function dE(t,e){e.destroy(),e.off(Sg),Di(t)}function fE(t,e,n){console.error(`Text components are not yet supported in ReactKonva. You text is: "${n}"`)}function hE(t,e,n){}function pE(t,e,n,r,i){Dd(t,i,r)}function gE(t){t.hide(),Di(t)}function mE(t){}function yE(t,e){(e.visible==null||e.visible)&&t.show()}function vE(t,e){}function xE(t){}function wE(){}const _E=()=>c4.DefaultEventPriority,SE=Object.freeze(Object.defineProperty({__proto__:null,appendChild:aE,appendChildToContainer:lE,appendInitialChild:UT,cancelTimeout:tE,clearContainer:xE,commitMount:hE,commitTextUpdate:fE,commitUpdate:pE,createInstance:GT,createTextInstance:VT,detachDeletedInstance:wE,finalizeInitialChildren:WT,getChildHostContext:JT,getCurrentEventPriority:_E,getPublicInstance:$T,getRootHostContext:qT,hideInstance:gE,hideTextInstance:mE,idlePriority:Sa.unstable_IdlePriority,insertBefore:f4,insertInContainerBefore:uE,isPrimaryRenderer:iE,noTimeout:nE,now:Sa.unstable_now,prepareForCommit:HT,preparePortalMount:XT,prepareUpdate:YT,removeChild:cE,removeChildFromContainer:dE,resetAfterCommit:KT,resetTextContent:QT,run:Sa.unstable_runWithPriority,scheduleTimeout:eE,shouldDeprioritizeSubtree:ZT,shouldSetTextContent:rE,supportsMutation:oE,unhideInstance:yE,unhideTextInstance:vE,warnsIfNotActing:sE},Symbol.toStringTag,{value:"Module"}));var kE=Object.defineProperty,CE=Object.defineProperties,TE=Object.getOwnPropertyDescriptors,L2=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,bE=Object.prototype.propertyIsEnumerable,R2=(t,e,n)=>e in t?kE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,F2=(t,e)=>{for(var n in e||(e={}))EE.call(e,n)&&R2(t,n,e[n]);if(L2)for(var n of L2(e))bE.call(e,n)&&R2(t,n,e[n]);return t},PE=(t,e)=>CE(t,TE(e)),j2,O2;typeof window<"u"&&((j2=window.document)!=null&&j2.createElement||((O2=window.navigator)==null?void 0:O2.product)==="ReactNative")?z.useLayoutEffect:z.useEffect;function h4(t,e,n){if(!t)return;if(n(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const i=h4(r,e,n);if(i)return i;r=e?null:r.sibling}}function p4(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const D2=console.error;console.error=function(){const t=[...arguments].join("");if(t!=null&&t.startsWith("Warning:")&&t.includes("useContext")){console.error=D2;return}return D2.apply(this,arguments)};const kg=p4(z.createContext(null));class g4 extends z.Component{render(){return z.createElement(kg.Provider,{value:this._reactInternals},this.props.children)}}function NE(){const t=z.useContext(kg);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=z.useId();return z.useMemo(()=>{for(const r of[t,t==null?void 0:t.alternate]){if(!r)continue;const i=h4(r,!1,s=>{let l=s.memoizedState;for(;l;){if(l.memoizedState===e)return!0;l=l.next}});if(i)return i}},[t,e])}function ME(){const t=NE(),[e]=z.useState(()=>new Map);e.clear();let n=t;for(;n;){if(n.type&&typeof n.type=="object"){const i=n.type._context===void 0&&n.type.Provider===n.type?n.type:n.type._context;i&&i!==kg&&!e.has(i)&&e.set(i,z.useContext(p4(i)))}n=n.return}return e}function AE(){const t=ME();return z.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>z.createElement(e,null,z.createElement(n.Provider,PE(F2({},r),{value:t.get(n)}))),e=>z.createElement(g4,F2({},e))),[t])}function IE(t){const e=$t.useRef({});return $t.useLayoutEffect(()=>{e.current=t}),$t.useLayoutEffect(()=>()=>{e.current={}},[]),e.current}const LE=t=>{const e=$t.useRef(),n=$t.useRef(),r=$t.useRef(),i=IE(t),s=AE(),l=c=>{const{forwardedRef:u}=t;u&&(typeof u=="function"?u(c):u.current=c)};return $t.useLayoutEffect(()=>(n.current=new nl.Stage({width:t.width,height:t.height,container:e.current}),l(n.current),r.current=_a.createContainer(n.current,c4.LegacyRoot,!1,null),_a.updateContainer($t.createElement(s,{},t.children),r.current),()=>{nl.isBrowser&&(l(null),_a.updateContainer(null,r.current,null),n.current.destroy())}),[]),$t.useLayoutEffect(()=>{l(n.current),Dd(n.current,t,i),_a.updateContainer($t.createElement(s,{},t.children),r.current,null)}),$t.createElement("div",{ref:e,id:t.id,accessKey:t.accessKey,className:t.className,role:t.role,style:t.style,tabIndex:t.tabIndex,title:t.title})},Nc="Layer",zd="Group",Mc="Rect",rl="Circle",lp="Line",On="Text",RE="Arrow",_a=jT(SE);_a.injectIntoDevTools({findHostInstanceByFiber:()=>null,bundleType:0,version:$t.version,rendererPackageName:"react-konva"});const FE=$t.forwardRef((t,e)=>$t.createElement(g4,{},$t.createElement(LE,{...t,forwardedRef:e}))),m4=()=>{const{elements:t,setElements:e,arcStart:n,setArcStart:r,setTempArcEnd:i,setSelectedElement:s,snapToGrid:l,gridSnappingEnabled:c}=qt(),u=z.useCallback((x,y)=>{if(x.id===y.id)return;if(x.type===y.type){console.warn("Invalid arc: Cannot connect elements of the same type."),r(null),i(null),s(null);return}const w={id:co(),source:x.id,target:y.id,weight:1,anglePoints:[],sourceType:x.type,targetType:y.type};e(E=>({...E,arcs:[...E.arcs,w]})),r(null),i(null),s(null)},[e,r,i,s]),f=z.useCallback((x,y)=>{e(w=>{const E=w.arcs.map(_=>{if(_.id===x){const S=c?l(y.x,y.y):y,C=_.anglePoints?[..._.anglePoints]:[];return C.push(S),{..._,anglePoints:C}}return _});return{...w,arcs:E}})},[e,c,l]),h=z.useCallback((x,y,w)=>{e(E=>{const _=E.arcs.map(S=>{if(S.id===x&&S.anglePoints&&S.anglePoints[y]){const C=c?l(w.x,w.y):w,g=[...S.anglePoints];return g[y]=C,{...S,anglePoints:g}}return S});return{...E,arcs:_}})},[e,c,l]),m=z.useCallback((x,y)=>{e(w=>{const E=w.arcs.map(_=>{if(_.id===x&&_.anglePoints&&_.anglePoints[y]){const S=[..._.anglePoints];return S.splice(y,1),{..._,anglePoints:S}}return _});return{...w,arcs:E}})},[e]);return{handleCompleteArc:u,handleAddAnglePoint:f,handleDragAnglePoint:h,handleDeleteAnglePoint:m}};function z2(t,e){if(!t||!e)return!1;const n=Math.min(e.x,e.x+e.w),r=Math.min(e.y,e.y+e.h),i=Math.max(e.x,e.x+e.w),s=Math.max(e.y,e.y+e.h);return t.x>=n&&t.x<=i&&t.y>=r&&t.y<=s}function B2(t,e){if(!t||!e)return[];const n=[];return(t.places||[]).forEach(r=>{z2({x:r.x,y:r.y},e)&&n.push({id:r.id,type:"place"})}),(t.transitions||[]).forEach(r=>{z2({x:r.x,y:r.y},e)&&n.push({id:r.id,type:"transition"})}),n}function jE(t,e){return t.some(r=>r.id===e.id&&r.type===e.type)?t.filter(r=>!(r.id===e.id&&r.type===e.type)):[...t,e]}function y4(t,e,n,r={}){if(!e||!e.startPositions)return t;const{dx:i,dy:s}=n||{dx:0,dy:0},{gridSnappingEnabled:l=!1,snapToGrid:c=(f,h)=>({x:f,y:h})}=r,u={...t};return u.places=(t.places||[]).map(f=>{const h=e.startPositions.get(f.id);if(!h||h.type!=="place")return f;const m=h.x+i,x=h.y+s,y=l?c(m,x):{x:m,y:x};return{...f,x:y.x,y:y.y}}),u.transitions=(t.transitions||[]).map(f=>{const h=e.startPositions.get(f.id);if(!h||h.type!=="transition")return f;const m=h.x+i,x=h.y+s,y=l?c(m,x):{x:m,y:x};return{...f,x:y.x,y:y.y}}),e.startArcPoints&&(u.arcs=(t.arcs||[]).map(f=>{const h=e.startArcPoints.get(f.id);if(!h)return f;const m=h.map(x=>({x:x.x+i,y:x.y+s}));return{...f,anglePoints:m}})),u}const Cg=()=>{var A,R;const{gridSnappingEnabled:t}=Po(),{elements:e,setElements:n,selectedElement:r,setSelectedElement:i,selectedElements:s,setSelectedElements:l,isIdSelected:c,setSelection:u,mode:f,arcStart:h,setArcStart:m,tempArcEnd:x,setTempArcEnd:y,snapToGrid:w,isShiftPressedRef:E}=qt(),{handleCompleteArc:_}=m4(),S=z.useCallback(()=>{if(!r)return;const{type:M,id:I}=r;let O=JSON.parse(JSON.stringify(e));M==="place"?(O.places=O.places.filter(W=>W.id!==I),O.arcs=O.arcs.filter(W=>W.source!==I&&W.target!==I)):M==="transition"?(O.transitions=O.transitions.filter(W=>W.id!==I),O.arcs=O.arcs.filter(W=>W.source!==I&&W.target!==I)):M==="arc"&&(O.arcs=O.arcs.filter(W=>W.id!==I)),n(O),i(null)},[r,e,n,i]),C=z.useCallback(()=>{n({places:[],transitions:[],arcs:[]}),i(null),m(null),y(null)},[n,i,m,y]),g=z.useCallback(M=>{var O,W;if(!M)return;let I=t?w(M.x,M.y):M;if(f==="place"){const B=((O=e==null?void 0:e.places)==null?void 0:O.length)||0,D={id:co(),x:I.x,y:I.y,label:`P${B+1}`,tokens:0};n($=>({...$,places:[...($==null?void 0:$.places)||[],D]}))}else if(f==="transition"){const B=((W=e==null?void 0:e.transitions)==null?void 0:W.length)||0,D={id:co(),x:I.x,y:I.y,label:`T${B+1}`};n($=>({...$,transitions:[...($==null?void 0:$.transitions)||[],D]}))}},[f,(A=e==null?void 0:e.places)==null?void 0:A.length,(R=e==null?void 0:e.transitions)==null?void 0:R.length,n,w,t]),k=z.useCallback((M,I,O)=>{var $,X;let W=null,B=null,D=null;typeof O<"u"?(W=M,B=I,D=O):(B=M,D=I),f==="select"||f==="arc_angle"?(!!(W&&(($=W.evt)!=null&&$.shiftKey||(X=W.evt)!=null&&X.getModifierState&&W.evt.getModifierState("Shift")))||!!(E&&E.current)?(l(U=>jE(U,{id:B.id,type:D})),i({...B,type:D})):u([{id:B.id,type:D}]),m(null),y(null)):f==="arc"&&(h?_(h.element,{...B,type:D}):(i({...B,type:D}),m({element:{id:B.id,type:D},point:{x:B.x,y:B.y}}),y({sourcePoint:{x:B.x,y:B.y},x:B.x,y:B.y,potentialTarget:null})))},[f,h,i,l,c,u,m,y,_]),T=z.useCallback((M,I,O)=>{const W=t?w(O.x,O.y):O;n(B=>{const D={...B};return I==="place"?D.places=B.places.map($=>$.id===M.id?{...$,x:W.x,y:W.y}:$):I==="transition"&&(D.transitions=B.transitions.map($=>$.id===M.id?{...$,x:W.x,y:W.y}:$)),D})},[n,t,w]),N=z.useCallback(M=>v5(e,M),[e]),L=z.useCallback((M,I={x:40,y:40})=>{if(!M)return null;const{newPlaces:O,newTransitions:W,newArcs:B,newSelection:D}=x5(M,co,I);return n($=>({...$,places:[...$.places,...O],transitions:[...$.transitions,...W],arcs:[...$.arcs,...B]})),D},[n]);return{handleDeleteElement:S,clearAllElements:C,handleCreateElement:g,handleElementClick:k,handleElementDragEnd:T,collectClipboard:N,pasteClipboard:L}},OE=30,DE=4,zE=4,Tg=4,er=2,BE=12,up=10,UE=10,Eg=.48,Kh=.25,GE={},v4=new WeakMap;function Lu(t,e,n){return v4.set(t,{baseRadius:e,visuals:n}),n}function VE(t,e,n=2){const r=t.x+t.width,i=t.y+t.height,s=e.x+e.width,l=e.y+e.height;return!(r+n<=e.x||s+n<=t.x||i+n<=e.y||l+n<=t.y)}function WE(t){if(t<=0)return[];const e=[[t]];if(t>=4){const n=Math.min(6,t-1);for(let r=n;r>=Math.ceil(t/2);r-=1){const i=t-r;i>=1&&e.push([r,i])}}if(t>=7){const n=Math.min(6,t-3),r=Math.max(2,Math.ceil((t-n)/2)),i=t-n-r;i>0&&e.push([n,r,i])}return e}function $E(t,e,n){const r=[...e].sort((l,c)=>n[c].width-n[l].width),i=[];let s=0;for(let l=0;l<t.length;l+=1){const c=t[l],u=r.slice(s,s+c);if(u.length<c)return null;i.push(u),s+=c}return i}function HE(t,e,n,r,i){const s=t.length;if(s===0)return[];const l=new Array(s),c=t[0],u=Math.max(...c.map(_=>e[_].diagonal),r);let f=n-u-er;if(f<=0)return null;const h=i?i+r+er:r+er;if(s===1)return l[0]=Math.max(f,h),l;const m=t[s-1],x=Math.max(...m.map(_=>e[_].diagonal),r),y=Math.max(h,x+er),w=f-y,E=Math.max(r+er,w/s);l[0]=f;for(let _=1;_<s;_+=1){const C=l[_-1]-E,g=t[_],k=Math.max(...g.map(N=>e[N].diagonal),r),T=Math.max(k+er,h);if(l[_]=Math.max(C,T),l[_]<=0)return null}return l[s-1]<y&&(l[s-1]=y),l}function Qu(t,e,n){if(!t||t.length===0)return e;let r=0;t.forEach(s=>{const l=s.x+s.width/2,c=s.y+s.height/2,u=Math.hypot(s.width/2,s.height/2),f=Math.hypot(l,c)+u+Tg;f>r&&(r=f)});const i=Math.ceil(r);return i>n&&n>=e?n:Math.max(e,i)}function Zu(t){return typeof t=="boolean"?t?"T":"F":typeof t=="string"?`'${t}'`:Array.isArray(t)?`[${t.map(Zu).join(", ")}]`:t&&typeof t=="object"&&t.__pair__?`(${Zu(t.fst)}, ${Zu(t.snd)})`:String(t)}function x4(t,e){return t.length?Math.max(e,t.length*e*Eg):e}function XE(t,e,n){const r=t.length;if(r===0)return null;const i=e-Tg;if(i<=0)return null;const s=i*2,l=[];for(let u=1;u<=r;u+=1){const f=Math.ceil(r/u);u===1&&r>4||f===1&&r>4||l.push({cols:u,rows:f})}l.sort((u,f)=>{const h=Math.abs(u.cols-u.rows)-Math.abs(f.cols-f.rows);return h!==0?h:u.cols-f.cols});const c=Math.max(...t.map(u=>u.length||1),1);for(const u of l){const f=u.cols,h=u.rows,m=s-er*(f-1),x=s-er*(h-1);if(m<=0||x<=0)continue;const y=m/f,w=x/h,E=w*.8,_=y/(c*Eg||1),S=Math.min(BE,E,_);if(S<up)continue;const C=[];let g=!0;const k=y+er,T=w+er,N=k*(f-1),L=T*(h-1),A=-N/2,R=-L/2;if(t.forEach((M,I)=>{if(!g)return;const O=Math.floor(I/f),W=I%f,B=r-O*f,D=O===h-1?Math.min(B,f):f,X=A+(f-D)*k/2+W*k,F=R+O*T,G=x4(M,S)/2,K=S/2,Q=Math.hypot(G,K);if(Math.hypot(X,F)+Q>i){g=!1;return}C.push({key:`token-${I}`,text:M,fontSize:S,x:X-y/2,y:F-S/2,width:y,height:S})}),g)return{radius:Qu(C,n,e),layout:C}}return null}function YE(t,e,n){const r=t.length;if(r===0)return{layout:[],radius:n};const i=e-Tg;if(i<=0)return null;const s=Math.max(...t.map(f=>f.length||1),1),l=Math.max(up,Math.min(12,i*2/(s*Eg))),c=t.map((f,h)=>h),u=f=>{const h=c.map(S=>{const C=x4(t[S],f);return{width:C,halfWidth:C/2,halfHeight:f/2,diagonal:Math.hypot(C/2,f/2)}});if(r===1){const S=h[0];if(S.diagonal>i)return null;const C=S.width*(1+Kh),g=[{key:"token-0",text:t[0],fontSize:f,x:-C/2,y:-S.halfHeight,width:C,height:f}];return{layout:g,radius:Qu(g,n,e)}}let m=null,x=0;if(r%2===1&&r>1){const C=[...c].sort((A,R)=>h[R].width-h[A].width)[0],g=h[C].diagonal,k=c.filter(A=>A!==C),T=k.length?Math.max(...k.map(A=>h[A].diagonal)):0,N=g+f*.5;i-T-2>=N&&(m=C,x=g)}const y=new Array(r);if(m!==null){const S=h[m];if(S.diagonal>i)return null;const C=S.width*(1+Kh);y[m]={key:`token-${m}`,text:t[m],fontSize:f,x:-C/2,y:-S.halfHeight,width:C,height:f}}const w=c.filter(S=>S!==m);if(w.length===0){const S=y.filter(Boolean);return{layout:S,radius:Qu(S,n,e)}}const E=y.slice(),_=WE(w.length);for(const S of _){const C=$E(S,w,h);if(!C)continue;const g=HE(C,h,i,f,x);if(!g)continue;const k=E.slice();let T=!0;if(C.forEach((A,R)=>{const M=g[R],I=A.length;if(!I)return;const O=R%2===1?Math.PI/I:0;A.forEach((W,B)=>{if(!T)return;const D=h[W],$=D.width*(1+Kh),X=$/2,F=-Math.PI/2+2*Math.PI*B/I+O,U=Math.cos(F)*M,G=Math.sin(F)*M;if(Math.hypot(U,G)+D.diagonal>i+er){T=!1;return}k[W]={key:`token-${W}`,text:t[W],fontSize:f,x:U-X,y:G-D.halfHeight,width:$,height:f}})}),!T)continue;const N=k.filter(Boolean);if(N.length!==r)continue;let L=!1;for(let A=0;A<N.length;A+=1){for(let R=A+1;R<N.length;R+=1)if(VE(N[A],N[R])){L=!0;break}if(L)break}if(!L){const A=Qu(N,n,e);return{layout:N,radius:A}}}return null};for(let f=l;f>=up;f-=.5){const h=u(f);if(h&&h.layout&&h.layout.length===r)return h}return null}function w4(t,e=OE){var c;const n=Array.isArray(t)?t:GE,r=v4.get(n);if(r&&r.baseRadius===e)return r.visuals;const i=Array.isArray(t)?t:[];if(i.length===0)return Lu(n,e,{radius:e,tokens:[],indicator:null});const s=i.map(Zu),l=e*DE;for(let u=e;u<=l;u+=zE){if(s.length<=UE){const h=YE(s,u,e);if(h&&((c=h.layout)==null?void 0:c.length)===s.length){const m=Math.max(e,Math.min(h.radius,u));return Lu(n,e,{radius:m,tokens:h.layout,indicator:null})}}const f=XE(s,u,e);if(f){const h=Math.max(e,Math.min(f.radius,u));return Lu(n,e,{radius:h,tokens:f.layout,indicator:null})}}return Lu(n,e,{radius:e,tokens:[],indicator:s.length})}const KE=({id:t,x:e,y:n,label:r,tokens:i,valueTokens:s,isSelected:l,onSelect:c,onChange:u})=>{const{setIsDragging:f,snapToGrid:h,netMode:m,elements:x,selectedElements:y,setElements:w,multiDragRef:E,isIdSelected:_,mode:S,arcStart:C}=qt(),{gridSnappingEnabled:g,setSnapIndicator:k}=Po(),T=30,N=z.useRef({pending:!1,rafId:null,delta:{dx:0,dy:0},lastApplied:{dx:0,dy:0}}),L=z.useCallback(()=>{const F=N.current;F.pending=!1,F.rafId=null,!(!E.current||!E.current.startPositions)&&w(U=>{if(!E.current||!E.current.startPositions)return U;const G=E.current,K=y4(U,G,F.delta,{gridSnappingEnabled:g,snapToGrid:h});return F.lastApplied={...F.delta},K})},[g,h,w,E]),A=z.useCallback(F=>{const U=N.current;if(!(U.pending&&U.delta&&U.delta.dx===F.dx&&U.delta.dy===F.dy||!U.pending&&U.lastApplied&&U.lastApplied.dx===F.dx&&U.lastApplied.dy===F.dy)){if(U.delta=F,typeof window>"u"||typeof window.requestAnimationFrame!="function"){L();return}U.pending||(U.pending=!0,U.rafId=window.requestAnimationFrame(L))}},[L]),R=z.useCallback(()=>{const F=N.current;typeof window<"u"&&typeof window.cancelAnimationFrame=="function"&&F.rafId!==null&&window.cancelAnimationFrame(F.rafId),(F.pending||F.rafId!==null)&&L()},[L]),M=m==="algebraic-int"||Array.isArray(s),I=z.useMemo(()=>M?w4(s||[],T):{radius:T,tokens:[],indicator:null},[M,s]),O=M?I.radius:T,W=z.useCallback(F=>{const U=new Map;x.places.forEach(K=>{F.has(K.id)&&U.set(K.id,{type:"place",x:K.x,y:K.y})}),x.transitions.forEach(K=>{F.has(K.id)&&U.set(K.id,{type:"transition",x:K.x,y:K.y})});const G=new Map;return x.arcs.forEach(K=>{if(F.has(K.source)&&F.has(K.target)){const Q=Array.isArray(K.anglePoints)?K.anglePoints.map(Z=>({x:Z.x,y:Z.y})):[];G.set(K.id,Q)}}),{startPositions:U,startArcPoints:G}},[x]),B=()=>{f(!0);const F=N.current;F.lastApplied={dx:0,dy:0};const U=_(t,"place");let G;U?G=new Set(y.filter(Q=>Q.type==="place"||Q.type==="transition").map(Q=>Q.id)):(G=new Set([t]),typeof c=="function"&&c(t));const K=W(G);E.current={baseId:t,...K}},D=F=>{let U={x:F.target.x(),y:F.target.y()};if(g){const G=h(U.x,U.y);k({visible:!0,position:G,elementType:"place"}),F.target.position({x:G.x,y:G.y}),U=G}if(E.current&&E.current.startPositions&&E.current.baseId===t){const G=E.current.startPositions.get(t);if(!G)return;const K=U.x-G.x,Q=U.y-G.y;A({dx:K,dy:Q})}},$=F=>{const U={x:F.target.x(),y:F.target.y()};f(!1),k({visible:!1,position:null,elementType:null}),R(),u(U),E.current=null},X=()=>M?I.tokens.length>0?P.jsx(P.Fragment,{children:I.tokens.map(F=>P.jsx(On,{text:F.text,fontSize:F.fontSize,fill:"black",x:F.x,y:F.y,width:F.width,align:"center",wrap:"none",listening:!1},F.key))}):I.indicator?P.jsx(On,{text:`(${I.indicator})`,fontSize:12,fill:"black",x:-O,y:-7,width:O*2,align:"center",wrap:"none",listening:!1}):null:i===0?m==="algebraic-int"||Array.isArray(s)?null:P.jsx(On,{text:"0",fontSize:14,fill:"black",x:-O,y:-7,width:O*2,align:"center",listening:!1}):i<=5?P.jsxs(P.Fragment,{children:[Array.from({length:i}).map((F,U)=>{const G=2*Math.PI*U/i,K=4,Q=O/2,Z=Math.cos(G)*Q,se=Math.sin(G)*Q;return P.jsx(rl,{x:Z,y:se,radius:K,fill:"black",listening:!1},U)}),P.jsx(On,{text:i.toString(),fontSize:14,fill:"black",x:-O,y:-7,width:O*2,align:"center",listening:!1})]}):P.jsx(On,{text:i.toString(),fontSize:16,fill:"black",x:-O,y:-8,width:O*2,align:"center",listening:!1});return P.jsxs(zd,{x:e,y:n,draggable:S!=="arc"||!C,onDragStart:B,onDragMove:D,onDragEnd:$,onClick:()=>c(t),onTap:()=>c(t),onTouchEnd:F=>{S==="arc"&&C&&C.element.id!==t&&c(t)},id:t,name:"element",elementType:"place",children:[P.jsx(rl,{radius:O,fill:"white",stroke:l?"blue":"black",strokeWidth:2}),P.jsx(On,{text:r,fontSize:12,fill:"black",x:-O,y:O+5,width:O*2,align:"center",listening:!1}),X()]})},Qh=11,QE=.48,U2=160,ZE=6,qE=({id:t,x:e,y:n,label:r,guard:i,isSelected:s,isEnabled:l,onSelect:c,onChange:u})=>{const{gridSnappingEnabled:m,setSnapIndicator:x}=Po(),{setIsDragging:y,snapToGrid:w,simulationSettings:E,netMode:_,elements:S,selectedElements:C,setElements:g,multiDragRef:k,isIdSelected:T,setSelection:N,mode:L,arcStart:A}=qt(),R=z.useRef({pending:!1,rafId:null,delta:{dx:0,dy:0},lastApplied:{dx:0,dy:0}}),M=z.useCallback(()=>{const G=R.current;G.pending=!1,G.rafId=null,!(!k.current||!k.current.startPositions)&&g(K=>{if(!k.current||!k.current.startPositions)return K;const Q=k.current,Z=y4(K,Q,G.delta,{gridSnappingEnabled:m,snapToGrid:w});return G.lastApplied={...G.delta},Z})},[m,w,g,k]),I=z.useCallback(G=>{const K=R.current;if(!(K.pending&&K.delta&&K.delta.dx===G.dx&&K.delta.dy===G.dy||!K.pending&&K.lastApplied&&K.lastApplied.dx===G.dx&&K.lastApplied.dy===G.dy)){if(K.delta=G,typeof window>"u"||typeof window.requestAnimationFrame!="function"){M();return}K.pending||(K.pending=!0,K.rafId=window.requestAnimationFrame(M))}},[M]),O=z.useCallback(()=>{const G=R.current;typeof window<"u"&&typeof window.cancelAnimationFrame=="function"&&G.rafId!==null&&window.cancelAnimationFrame(G.rafId),(G.pending||G.rafId!==null)&&M()},[M]),W=z.useCallback(G=>{const K=new Map;S.places.forEach(Z=>{G.has(Z.id)&&K.set(Z.id,{type:"place",x:Z.x,y:Z.y})}),S.transitions.forEach(Z=>{G.has(Z.id)&&K.set(Z.id,{type:"transition",x:Z.x,y:Z.y})});const Q=new Map;return S.arcs.forEach(Z=>{if(G.has(Z.source)&&G.has(Z.target)){const se=Array.isArray(Z.anglePoints)?Z.anglePoints.map(xe=>({x:xe.x,y:xe.y})):[];Q.set(Z.id,se)}}),{startPositions:K,startArcPoints:Q}},[S]),B=()=>{y(!0);const G=R.current;G.lastApplied={dx:0,dy:0};const K=T(t,"transition");let Q;K?Q=new Set(C.filter(se=>se.type==="place"||se.type==="transition").map(se=>se.id)):(Q=new Set([t]),typeof c=="function"&&c(t));const Z=W(Q);k.current={baseId:t,...Z}},D=G=>{let K={x:G.target.x(),y:G.target.y()};if(m){const Q=w(K.x,K.y);x({visible:!0,position:Q,elementType:"transition"}),G.target.position({x:Q.x,y:Q.y}),K=Q}if(k.current&&k.current.startPositions&&k.current.baseId===t){const Q=k.current.startPositions.get(t);if(!Q)return;const Z=K.x-Q.x,se=K.y-Q.y;I({dx:Z,dy:se})}},$=G=>{const K={x:G.target.x(),y:G.target.y()};y(!1),x({visible:!1,position:null,elementType:null}),O(),u(K),k.current=null},X=_==="algebraic-int"?String(i||""):"";let F=40,U="none";if(X){const G=X.length*Qh*QE+ZE*2;G<=U2?F=Math.max(40,G):(F=U2,U="char")}return P.jsxs(zd,{x:e,y:n,onClick:G=>c(t,G),onTap:G=>c(t,G),onTouchEnd:G=>{L==="arc"&&A&&A.element.id!==t&&c(t,G)},draggable:L!=="arc"||!A,onDragStart:B,onDragMove:D,onDragEnd:$,id:t,name:"element",elementType:"transition",children:[P.jsx(Mc,{x:-40/2,y:-50/2,width:40,height:50,fill:l?"rgba(255, 255, 0, 0.8)":"gray",stroke:s?"blue":l?"rgba(255, 180, 0, 1)":"black",strokeWidth:s||l?3:2}),P.jsx(On,{text:r,fontSize:14,fill:"black",x:-40/2,y:50/2+5,width:40,align:"center",listening:!1}),_==="algebraic-int"&&X&&P.jsx(On,{text:X,fontSize:Qh,fill:"#333",x:-F/2,y:-50/2-14,width:F,align:"center",wrap:U,listening:!1,ellipsis:U!=="none"}),_==="algebraic-int"&&!X&&P.jsx(On,{text:"",fontSize:Qh,fill:"gray",x:-40/2,y:-50/2-14,width:40,align:"center",listening:!1})]})},JE=({elements:t,selectedElement:e,handleElementClick:n,handleElementDragEnd:r,enabledTransitionIds:i})=>{var l,c;const{isIdSelected:s}=qt();return P.jsxs(Nc,{children:[(l=t==null?void 0:t.places)==null?void 0:l.map(u=>P.jsx(KE,{...u,isSelected:s(u.id,"place"),onSelect:f=>n(u,"place"),onChange:f=>r(u,"place",f)},u.id)),(c=t==null?void 0:t.transitions)==null?void 0:c.map(u=>P.jsx(qE,{...u,isSelected:s(u.id,"transition"),onSelect:f=>n(u,"transition"),onChange:f=>r(u,"transition",f),isEnabled:Array.isArray(i)?i.includes(u.id):!1},u.id))]})};function eb(t){return t!=null&&t.sourceType?t.sourceType:(t==null?void 0:t.type)==="place-to-transition"?"place":(t==null?void 0:t.type)==="transition-to-place"?"transition":"place"}function tb(t){return t!=null&&t.targetType?t.targetType:(t==null?void 0:t.type)==="place-to-transition"?"transition":(t==null?void 0:t.type)==="transition-to-place"?"place":"transition"}const nb=.52,Zh=(t="",e=12,{padding:n=4,maxWidth:r=1/0}={})=>{if(!t.length)return{width:0,wrap:"none"};const i=t.length*e*nb+n*2;return i<=r?{width:i,wrap:"none"}:{width:r,wrap:"char"}},qh=(t,e)=>t.width||e*2,Vs=t=>Number.isFinite(t),rb=()=>{var S;const{elements:t,selectedElement:e,selectedElements:n,mode:r,tempArcEnd:i,getVirtualPointerPosition:s,gridSnappingEnabled:l,snapToGrid:c,simulationSettings:u}=qt(),f=(u==null?void 0:u.netMode)||"pt",{handleElementClick:h}=Cg(),{handleAddAnglePoint:m,handleDragAnglePoint:x,handleDeleteAnglePoint:y}=m4(),w=C=>!C||typeof C!="string"?null:t.places.find(g=>g.id===C)||t.transitions.find(g=>g.id===C),E=C=>{if(!C)return 30;if(f==="algebraic-int"||Array.isArray(C.valueTokens)){const g=w4(C.valueTokens,30);if(g&&typeof g.radius=="number"&&Number.isFinite(g.radius))return g.radius}return 30},_=(C,g,k=[])=>{if(!C||!g||typeof C.x!="number"||typeof C.y!="number"||typeof g.x!="number"||typeof g.y!="number")return[0,0,100,100];const T={x:C.x,y:C.y},N={x:g.x,y:g.y},L=[{...C},...k,{...g}],A=40,R=50,M={...L[0]},I={...L[L.length-1]},O=L[1]||I,W=L[L.length-2]||M;let B=O.x-M.x,D=O.y-M.y,$=Math.atan2(D,B);if(C.type==="place"){const Z=E(C);M.x+=Z*Math.cos($),M.y+=Z*Math.sin($)}else{const Z=A/2,se=R/2,xe=Math.abs(Math.cos($)),ge=Math.abs(Math.sin($)),V=Math.tan($);if(Z*ge<=se*xe)M.x+=Math.sign(B)*Z,M.y+=Math.sign(B)*Z*V;else{const te=Math.abs(V)<1e-6?1e-6*Math.sign(V||1):V;M.x+=Math.sign(D)*se/te,M.y+=Math.sign(D)*se}}let X=I.x-W.x,F=I.y-W.y,U=Math.atan2(F,X);if(g.type==="place"){const Z=E(g);I.x-=Z*Math.cos(U),I.y-=Z*Math.sin(U)}else{const Z=A/2,se=R/2,xe=Math.abs(Math.cos(U)),ge=Math.abs(Math.sin(U)),V=Math.tan(U);if(Z*ge<=se*xe)I.x-=Math.sign(X)*Z,I.y-=Math.sign(X)*Z*V;else{const te=Math.abs(V)<1e-6?1e-6*Math.sign(V||1):V;I.x-=Math.sign(F)*se/te,I.y-=Math.sign(F)*se}}const G=[M.x,M.y];if(k.forEach(Z=>G.push(Z.x,Z.y)),G.push(I.x,I.y),G.every(Z=>Number.isFinite(Z)))return G;const Q=[T.x,T.y];return k.forEach(Z=>Q.push(Z.x,Z.y)),Q.push(N.x,N.y),Q};return[P.jsxs(Nc,{children:[(S=t==null?void 0:t.arcs)==null?void 0:S.map(C=>{if(!C||!C.source||!C.target)return null;const g=w(C.source),k=w(C.target);if(!g||!k)return null;const T=_({...g,type:eb(C)},{...k,type:tb(C)},Array.isArray(C.anglePoints)?C.anglePoints:[]),N=(T[0]+T[T.length-2])/2,L=(T[1]+T[T.length-1])/2,A=(n==null?void 0:n.some(Nt=>Nt.id===C.id&&Nt.type==="arc"))||(n==null?void 0:n.some(Nt=>Nt.id===g.id))&&(n==null?void 0:n.some(Nt=>Nt.id===k.id)),R=12,M=12,I=12,O=C.label?`${C.label}`:"",W=C.weight>1?`${C.weight}`:"",B=f==="algebraic-int"&&Array.isArray(C.bindings)&&C.bindings.length>0?C.bindings.map(r5).join(", "):"",D=Zh(O,R,{padding:6,maxWidth:220}),$=Zh(W,M,{padding:4,maxWidth:80}),X=Zh(B,I,{padding:6,maxWidth:240}),F=T[0],U=T[1],G=T[T.length-2],K=T[T.length-1],Q=G-F,Z=K-U,se=Math.hypot(Q,Z);let xe=0,ge=-1;se>.001&&(xe=-Z/se,ge=Q/se);const V=6,te=9,ae=8,ve=.66,ye=Math.abs(xe),ie=Math.abs(ge),oe=(Nt,Qr,Cs=4)=>Nt/2*ye+Qr/2*ie+Cs,Ee=qh($,M),le=qh(D,R),Se=qh(X,I),Ie=Math.max(V,oe(Ee,M)),Fe=Math.max(te,oe(le,R)),tn=Math.max(Fe+ae,oe(Se,I,6)*ve),Ot=N-xe*Ie,ws=L-ge*Ie,_s=N+xe*Fe,Ss=L+ge*Fe,ar=N+xe*tn,ks=L+ge*tn;return!Vs(Ot)||!Vs(ws)||!Vs(_s)||!Vs(Ss)||!Vs(ar)||!Vs(ks)?null:P.jsxs(zd,{children:[P.jsx(RE,{points:T,stroke:(e==null?void 0:e.id)===C.id||A?"blue":"black",strokeWidth:2,fill:"black",pointerLength:10,pointerWidth:10,hitStrokeWidth:12,onClick:Nt=>h(Nt,C,"arc"),onTap:Nt=>h(Nt,C,"arc"),onDblClick:Nt=>{if(r==="arc_angle"){const Qr=s();Qr&&m(C.id,Qr)}}}),C.weight>1&&P.jsx(On,{x:Ot,y:ws,text:W,fontSize:M,width:Ee,offsetX:Ee/2,offsetY:M/2,align:"center",listening:!1}),C.label&&P.jsx(On,{x:_s,y:Ss,text:O,fontSize:R,fill:"gray",width:le,offsetX:le/2,offsetY:R/2,align:"center",wrap:D.wrap,ellipsis:D.wrap!=="none",listening:!1}),B&&P.jsx(On,{x:ar,y:ks,text:B,fontSize:I,fill:"#333",width:Se,offsetX:Se/2,offsetY:I/2,align:"center",wrap:X.wrap,ellipsis:X.wrap!=="none",listening:!1})]},C.id)}),i&&i.sourcePoint&&P.jsx(lp,{points:[i.sourcePoint.x,i.sourcePoint.y,i.x,i.y],stroke:"grey",strokeWidth:2,dash:[5,5],listening:!1})]},"arcs-layer"),P.jsx(Nc,{children:(e==null?void 0:e.type)==="arc"&&r==="arc_angle"&&e.anglePoints.map((C,g)=>P.jsx(rl,{x:C.x,y:C.y,radius:6,fill:"red",stroke:"black",strokeWidth:1,draggable:!0,onDragEnd:k=>{const T={x:k.target.x(),y:k.target.y()},N=l?c(T.x,T.y):T;x(e.id,g,N)},onClick:k=>{k.evt.button===2&&(k.evt.preventDefault(),y(e.id,g))},onContextMenu:k=>{k.evt.preventDefault(),y(e.id,g)}},`angle-${e.id}-${g}`))},"handles-layer")]},ib=({width:t,height:e,gridSize:n})=>{const r=[],i=[],s=Math.ceil(e/n),l=Math.ceil(t/n);for(let c=0;c<=s;c++){const u=c*n;r.push(P.jsx(lp,{points:[0,u,t,u],stroke:"#ddd",strokeWidth:c%5===0?.5:.2,perfectDrawEnabled:!1,listening:!1},`h-${c}`))}for(let c=0;c<=l;c++){const u=c*n;i.push(P.jsx(lp,{points:[u,0,u,e],stroke:"#ddd",strokeWidth:c%5===0?.5:.2,perfectDrawEnabled:!1,listening:!1},`v-${c}`))}return P.jsxs(zd,{listening:!1,perfectDrawEnabled:!1,children:[r,i]})},G2=({orientation:t,contentSize:e,viewportSize:n,scrollPosition:r,onScroll:i})=>{const s=z.useRef(null),l=z.useRef(null),[c,u]=z.useState(!1),f=z.useRef(0),h=z.useRef(0),m=t==="horizontal",x=z.useCallback(A=>{A.preventDefault(),A.stopPropagation(),u(!0),f.current=r,h.current=m?A.clientX:A.clientY},[m,r]),y=z.useCallback(A=>{if(s.current&&l.current&&!l.current.contains(A.target)){const{left:R,top:M,width:I,height:O}=s.current.getBoundingClientRect(),W=m?I:O,B=Math.max(20,W*(n/e)),D=Math.max(0,e-n),$=Math.max(0,W-B);let F=((m?A.clientX-R:A.clientY-M)-B/2)/$*D;F=Math.max(0,Math.min(F,D)),i(F)}},[e,n,m,i]);if(z.useEffect(()=>{const A=M=>{if(!c||!s.current)return;const O=(m?M.clientX:M.clientY)-h.current,W=m?s.current.clientWidth:s.current.clientHeight,B=Math.max(20,W*(n/e)),D=Math.max(0,e-n),$=Math.max(0,W-B);if($<=0)return;const X=D/$,F=f.current+O*X;i(Math.max(0,Math.min(F,D)))},R=()=>{c&&u(!1)};return c&&(document.addEventListener("mousemove",A),document.addEventListener("mouseup",R),document.body.style.cursor=m?"ew-resize":"ns-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",R),document.body.style.cursor="default",document.body.style.userSelect="auto"}},[c,m,i,e,n]),e<=n)return null;const w=s.current?m?s.current.clientWidth:s.current.clientHeight:0,E=w>0?w*(n/e):0,_=Math.max(20,Math.min(E,w)),S=Math.max(0,e-n),C=Math.max(0,w-_),g=Math.max(0,Math.min(r,S)),k=S>0?Math.min(g/S*C,C):0,T={position:"absolute",zIndex:50,padding:0,margin:0,...m?{left:"0px",right:"0px",bottom:"0px",height:"10px"}:{top:"0px",bottom:"0px",right:"0px",width:"10px"}},N={position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"6px",overflow:"hidden"},L={position:"absolute",backgroundColor:"rgba(0,0,0,0.45)",borderRadius:"6px",cursor:"pointer",willChange:"transform",...m?{left:`${Math.round(k)}px`,top:"0px",width:`${Math.round(_)}px`,height:"100%"}:{top:`${Math.round(k)}px`,left:"0px",height:`${Math.round(_)}px`,width:"100%"}};return P.jsx("div",{style:T,children:P.jsx("div",{ref:s,style:N,onMouseDown:y,children:P.jsx("div",{ref:l,style:L,onMouseDown:x})})})},sb=({position:t,visible:e,elementType:n})=>!e||!t?null:n==="place"?P.jsx(rl,{x:t.x,y:t.y,radius:5,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}):n==="transition"?P.jsx(Mc,{x:t.x-5,y:t.y-5,width:10,height:10,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}):P.jsx(rl,{x:t.x,y:t.y,radius:5,fill:"rgba(0, 120, 255, 0.5)",stroke:"rgba(0, 120, 255, 0.8)",strokeWidth:1,perfectDrawEnabled:!1,listening:!1}),ob=({handleZoom:t,ZOOM_STEP:e,isSingleFingerPanningActive:n,isSelectionActiveRef:r})=>{const{stageDimensions:i,setStageDimensions:s,virtualCanvasDimensions:l,canvasScroll:c,setCanvasScroll:u,zoomLevel:f,setContainerRef:h,stageRef:m,gridSize:x,gridSnappingEnabled:y,snapIndicator:w,setSnapIndicator:E}=Po(),{mode:_,setMode:S,arcStart:C,setArcStart:g,tempArcEnd:k,setTempArcEnd:T,selectedElement:N,setSelectedElement:L,elements:A,enabledTransitionIds:R,snapToGrid:M,selectedElements:I,setSelection:O,isDragging:W}=qt(),{handleCreateElement:B,handleElementClick:D,handleElementDragEnd:$}=Cg(),X=z.useRef(null),F=z.useRef({isSelecting:!1,start:null}),[U,G]=z.useState(null),[K,Q]=z.useState(!1),Z=z.useRef({touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0}),se=400,xe=15;z.useEffect(()=>{if(typeof window>"u")return;const ie=window.matchMedia("(pointer: coarse)"),oe=Ee=>Q(Ee.matches);return oe(ie),ie.addEventListener?ie.addEventListener("change",oe):ie.addListener(oe),()=>{ie.removeEventListener?ie.removeEventListener("change",oe):ie.removeListener(oe)}},[]),z.useEffect(()=>{const ie=X.current;if(!ie)return;h(ie);const oe=new ResizeObserver(Ee=>{for(let le of Ee){const{width:Se,height:Ie}=le.contentRect;Se>0&&Ie>0&&s({width:Se,height:Ie})}});return oe.observe(ie),()=>{oe.disconnect()}},[s,h]);const ge=()=>{const ie=m.current;if(!ie)return null;const oe=ie.getPointerPosition();if(!oe)return null;const Ee=ie.getAbsoluteTransform().copy();Ee.invert();const{x:le,y:Se}=Ee.point(oe);return{x:le,y:Se}},V=ie=>{if(ie.target.name()!=="background")return;const oe=ge();oe&&B(oe)},te=ie=>{if(ie.target.name()!=="background")return;const oe=ge();oe&&B(oe)},ae=ie=>{const oe=ge();if(!oe)return;if(_==="arc"&&C){let le=null;const Se=m.current;if(Se){const Ie=Se.getPointerPosition(),Fe=Se.getIntersection(Ie);Fe&&(Fe.attrs.elementType==="place"||Fe.attrs.elementType==="transition")&&Fe.attrs.id!==C.element.id&&(le={id:Fe.attrs.id,type:Fe.attrs.elementType})}T({sourcePoint:C.point,x:oe.x,y:oe.y,potentialTarget:le})}const Ee=(r==null?void 0:r.current)||!1;if(n&&!Ee){F.current.isSelecting&&(F.current={isSelecting:!1,start:null},G(null),r&&(r.current=!1));return}if(K&&_==="select"&&Z.current.touchId!==null){const le=Z.current,Se=oe.x-le.startX,Ie=oe.y-le.startY,Fe=Math.hypot(Se,Ie);le.maxMovementDistance=Math.max(le.maxMovementDistance,Fe),Fe>xe&&!Ee&&(le.holdTimer&&(clearTimeout(le.holdTimer),le.holdTimer=null),Z.current={touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0})}if(_==="select"&&F.current.isSelecting&&F.current.start){const le=F.current.start;G({x:le.x,y:le.y,w:oe.x-le.x,h:oe.y-le.y})}if(y&&(_==="place"||_==="transition")){const le=M(oe.x,oe.y);E({visible:!0,position:le,elementType:_})}else w.visible&&E({visible:!1,position:null,elementType:null})},ve=z.useCallback(ie=>{if(ie.preventDefault(),ie.stopPropagation(),ie.ctrlKey||ie.metaKey){const oe=ie.deltaY>0?-e:e;t(oe,{clientX:ie.clientX,clientY:ie.clientY})}else{const oe=ie.deltaX/f,Ee=ie.deltaY/f;u(le=>{if(!l||!i)return le;const Se=Math.max(0,l.width-i.width/f),Ie=Math.max(0,l.height-i.height/f);return{x:Math.max(0,Math.min(Se,le.x+oe)),y:Math.max(0,Math.min(Ie,le.y+Ee))}})}},[e,t,u,f,l,i]);z.useEffect(()=>{const ie=X.current;if(!ie)return;const oe=Ee=>{ie.contains(Ee.target)&&ve(Ee)};return document.addEventListener("wheel",oe,{passive:!1}),()=>{document.removeEventListener("wheel",oe)}},[ve]);const ye=z.useCallback((ie,oe)=>{u(Ee=>{const le=Math.max(0,l.width-i.width/f),Se=Math.max(0,l.height-i.height/f),Ie=(tn,Ot)=>Math.max(0,Math.min(tn,Ot)),Fe={...Ee};return ie==="x"&&(Fe.x=Ie(oe,le)),ie==="y"&&(Fe.y=Ie(oe,Se)),Fe})},[u,l,i,f]);return P.jsxs("div",{ref:X,className:"canvas-container",style:{width:"100%",height:"100%",position:"relative",backgroundColor:"#f0f0f0",overflow:"hidden",touchAction:K?"none":"auto"},children:[P.jsxs(FE,{ref:m,width:i.width,height:i.height,listening:!0,onClick:V,onTap:te,onMouseMove:ae,onTouchMove:ae,onMouseDown:ie=>{if(_!=="select"||ie.target&&ie.target.name&&ie.target.name()!=="background")return;const oe=ge();oe&&(F.current={isSelecting:!0,start:oe},G({x:oe.x,y:oe.y,w:0,h:0}))},onTouchStart:ie=>{const oe=ie.target&&ie.target.name&&ie.target.name()==="background";if(n){F.current={isSelecting:!1,start:null},G(null),r&&(r.current=!1),Z.current.holdTimer&&clearTimeout(Z.current.holdTimer),Z.current={touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0};return}if(_==="select"&&oe&&ie.touches.length===1){const Ee=ie.touches[0],le=ge();if(!le)return;const Se=Z.current;Se.holdTimer&&clearTimeout(Se.holdTimer),Se.touchId=Ee.identifier,Se.startX=le.x,Se.startY=le.y,Se.startTime=Date.now(),Se.maxMovementDistance=0;const Ie=Ee.identifier,Fe={x:le.x,y:le.y};Se.holdTimer=setTimeout(()=>{const tn=(r==null?void 0:r.current)||!1;Se.touchId===Ie&&Se.maxMovementDistance<=xe&&!n&&!tn&&(r&&(r.current=!0),F.current={isSelecting:!0,start:Fe},G({x:Fe.x,y:Fe.y,w:0,h:0}),navigator.vibrate&&navigator.vibrate(10))},se)}else Z.current.holdTimer&&clearTimeout(Z.current.holdTimer),Z.current={touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0}},onMouseUp:()=>{if(_!=="select"||!F.current.isSelecting||!U)return;const ie=B2(A,U);O(ie),F.current={isSelecting:!1,start:null},G(null)},onTouchEnd:ie=>{const oe=Z.current;oe.holdTimer&&(clearTimeout(oe.holdTimer),oe.holdTimer=null);const Ee=(r==null?void 0:r.current)||!1;if(oe.touchId!==null&&!Ee&&(Z.current={touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0}),_==="select"){if(!F.current.isSelecting||!U){Z.current={touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0},r&&(r.current=!1);return}const le=B2(A,U);O(le),F.current={isSelecting:!1,start:null},G(null),r&&(r.current=!1),Z.current={touchId:null,startX:0,startY:0,startTime:0,holdTimer:null,maxMovementDistance:0}}else _==="arc"&&C&&setTimeout(()=>{if(_==="arc"&&C){const le=m.current;if(le){const Se=le.getPointerPosition();if(Se){const Ie=le.getIntersection(Se);(!Ie||Ie.attrs.elementType!=="place"&&Ie.attrs.elementType!=="transition")&&(g(null),T(null))}else g(null),T(null)}else g(null),T(null)}},20)},scaleX:f,scaleY:f,x:-c.x*f,y:-c.y*f,children:[P.jsxs(Nc,{children:[P.jsx(Mc,{x:0,y:0,width:l.width,height:l.height,fill:"#FFFFFF",name:"background",onClick:()=>{_==="arc"&&C&&(g(null),T(null)),L(null)},onTap:()=>{_==="arc"&&C&&(g(null),T(null)),L(null)},onTouchEnd:()=>{_==="arc"&&C&&(g(null),T(null)),L(null)}}),U&&P.jsx(Mc,{x:Math.min(U.x,U.x+U.w),y:Math.min(U.y,U.y+U.h),width:Math.abs(U.w),height:Math.abs(U.h),stroke:"#3399FF",strokeWidth:1,dash:[4,4],fill:"rgba(51,153,255,0.15)",listening:!1}),P.jsx(ib,{width:l.width,height:l.height,gridSize:x}),P.jsx(sb,{position:w.position,visible:w.visible,elementType:w.elementType})]}),P.jsx(JE,{elements:A,selectedElement:N,handleElementClick:D,handleElementDragEnd:$,enabledTransitionIds:R}),P.jsx(rb,{})]}),!K&&i.width>0&&l.width>i.width/f&&P.jsx(G2,{orientation:"horizontal",contentSize:l.width,viewportSize:i.width/f,scrollPosition:c.x,onScroll:ie=>ye("x",ie)}),!K&&i.height>0&&l.height>i.height/f&&P.jsx(G2,{orientation:"vertical",contentSize:l.height,viewportSize:i.height/f,scrollPosition:c.y,onScroll:ie=>{he.debug("Vertical scroll callback:",{newScroll:ie,currentScroll:c.y,maxScroll:Math.max(0,l.height-i.height/f)}),ye("y",ie)}})]})},ab=()=>{const{mode:t,setMode:e}=qt(),[n,r]=z.useState(!1);if(z.useEffect(()=>{if(typeof window>"u")return;const s=window.matchMedia("(pointer: coarse)"),l=c=>r(c.matches);return l(s),s.addEventListener?s.addEventListener("change",l):s.addListener(l),()=>{s.removeEventListener?s.removeEventListener("change",l):s.removeListener(l)}},[]),!n)return null;const i=s=>({width:"44px",height:"44px",borderRadius:"50%",backgroundColor:s?"#4338ca":"white",color:s?"white":"#374151",border:s?"2px solid #312e81":"1px solid #d1d5db",boxShadow:"0 2px 4px -1px rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",marginBottom:"8px",cursor:"pointer",position:"relative"});return P.jsxs("div",{className:"fixed bottom-32 left-6 z-50 flex flex-col items-center",children:[P.jsx("button",{style:i(t==="arc"),onClick:()=>e("arc"),title:"Arc Tool",className:"active:scale-95",children:P.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:P.jsx("path",{d:"M3 21l18-18M3 21l7-1M3 21l1-7"})})}),P.jsx("button",{style:i(t==="transition"),onClick:()=>e("transition"),title:"Transition Tool",className:"active:scale-95",children:P.jsx("div",{style:{width:"11px",height:"26px",backgroundColor:"currentColor"}})}),P.jsx("button",{style:i(t==="place"),onClick:()=>e("place"),title:"Place Tool",className:"active:scale-95",children:P.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",border:"2px solid currentColor",backgroundColor:"transparent"}})}),P.jsx("button",{style:i(t==="select"),onClick:()=>e("select"),title:"Select Tool",className:"active:scale-95",children:P.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:P.jsx("path",{d:"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"})})})]})};function lb({MIN_ZOOM:t,MAX_ZOOM:e,zoomLevel:n,setZoomLevel:r,virtualCanvasDimensions:i,canvasScroll:s,setCanvasScroll:l,setContainerRef:c,isDragging:u=!1,isSelectionActiveRef:f=null}){const h=z.useRef(null),m=z.useRef(!1),x=z.useRef({active:!1}),y=z.useRef({active:!1,startX:0,startY:0,lastX:0,lastY:0}),[w,E]=z.useState(!1),_=z.useRef({active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null,maxMovementDistance:0}),S=z.useRef(n);z.useEffect(()=>{S.current=n},[n]);const C=z.useCallback(R=>Math.max(t,Math.min(e,R)),[t,e]),g=z.useCallback((R,M,I)=>{if(!h.current||!i)return;const O=h.current,W=O.clientWidth||1,B=O.clientHeight||1,D=O.getBoundingClientRect(),$=I?Math.min(Math.max(I.clientX-D.left,0),W):W/2,X=I?Math.min(Math.max(I.clientY-D.top,0),B):B/2,F=(s.x+$)/R,U=(s.y+X)/R,G=Math.max(0,i.width-W/M),K=Math.max(0,i.height-B/M),Q=Math.max(0,Math.min(G,F*M-$)),Z=Math.max(0,Math.min(K,U*M-X));l({x:Q,y:Z})},[s,l,i]),k=z.useCallback((R,M,I)=>{if(!h.current||!i||!Number.isFinite(I)||I<=0)return;const O=h.current,W=O.clientWidth||1,B=O.clientHeight||1,D=Math.max(0,i.width-W/I),$=Math.max(0,i.height-B/I);l(X=>{const F=Math.max(0,Math.min(D,X.x-R/I)),U=Math.max(0,Math.min($,X.y-M/I));return F===X.x&&U===X.y?X:{x:F,y:U}})},[l,i]),T=z.useCallback((R,M)=>{r(I=>{const O=C(R(I));return O!==I&&g(I,O,M),O})},[g,C,r]),N=z.useCallback((R,M)=>{typeof R!="number"||Number.isNaN(R)||R===0||T(I=>I+R,M)},[T]),L=z.useCallback((R,M)=>{typeof R!="number"||Number.isNaN(R)||T(()=>R,M)},[T]),A=z.useCallback(R=>{if(m.current){m.current=!1;return}l&&l({x:R.target.scrollLeft,y:R.target.scrollTop})},[l]);return z.useEffect(()=>{h.current&&(m.current=!0,h.current.scrollLeft!==s.x&&(h.current.scrollLeft=s.x),h.current.scrollTop!==s.y&&(h.current.scrollTop=s.y))},[s,h]),z.useEffect(()=>{h.current&&c&&c(h.current)},[h,c]),z.useEffect(()=>{const R=h.current;if(!R)return;const M=D=>{const[$,X]=D;return Math.hypot($.clientX-X.clientX,$.clientY-X.clientY)},I=D=>{const[$,X]=D;return{clientX:($.clientX+X.clientX)/2,clientY:($.clientY+X.clientY)/2}},O=D=>{if(D.touches.length===2){_.current.holdTimer&&(clearTimeout(_.current.holdTimer),_.current.holdTimer=null),_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null};const $=I(D.touches),X=M(D.touches);x.current={active:!1,startDistance:X,startZoom:S.current,lastCenter:$},y.current={active:!1,startX:$.clientX,startY:$.clientY,lastX:$.clientX,lastY:$.clientY}}else if(D.touches.length===1){const $=(f==null?void 0:f.current)||!1;if(u||$){const U=_.current;U.holdTimer&&(clearTimeout(U.holdTimer),U.holdTimer=null),U.active=!1,E(!1);return}const X=D.touches[0],F=_.current;F.holdTimer&&clearTimeout(F.holdTimer),y.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},x.current={active:!1},F.startX=X.clientX,F.startY=X.clientY,F.lastX=X.clientX,F.lastY=X.clientY,F.active=!1,F.touchId=X.identifier,F.maxMovementDistance=0,F.holdTimer=setTimeout(()=>{const G=(f==null?void 0:f.current)||!1;!u&&!G&&D.touches.length===1&&D.touches[0].identifier===F.touchId&&F.maxMovementDistance>15&&(F.active=!0,E(!0),navigator.vibrate&&navigator.vibrate(10))},250)}else _.current.holdTimer&&(clearTimeout(_.current.holdTimer),_.current.holdTimer=null),_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null},E(!1),y.current={active:!1,startX:0,startY:0,lastX:0,lastY:0},x.current={active:!1}},W=D=>{if(D.touches.length===2){_.current.holdTimer&&(clearTimeout(_.current.holdTimer),_.current.holdTimer=null),_.current.active=!1,E(!1);const $=I(D.touches),X=M(D.touches),F=x.current,U=F.startDistance>0?X/F.startDistance:1;if(Math.abs(U-1)>.05){F.active||(x.current={...F,active:!0}),D.preventDefault(),D.stopPropagation();const Q=C(F.startZoom*U);L(Q,$),x.current={...F,active:!0,startDistance:F.startDistance,startZoom:F.startZoom,lastCenter:$}}else{const Q=y.current,Z=$.clientX-Q.lastX,se=$.clientY-Q.lastY,xe=$.clientX-Q.startX,ge=$.clientY-Q.startY,V=Math.hypot(xe,ge),te=5;!Q.active&&V>te&&(y.current={...Q,active:!0}),Q.active&&(D.preventDefault(),D.stopPropagation(),k(-Z,-se,S.current)),y.current={...Q,lastX:$.clientX,lastY:$.clientY}}return}else if(D.touches.length===1){const $=(f==null?void 0:f.current)||!1;if(u||$){const U=_.current;U.holdTimer&&(clearTimeout(U.holdTimer),U.holdTimer=null),U.active&&(U.active=!1,E(!1));return}const X=_.current,F=D.touches[0];if(F.identifier===X.touchId&&!X.active){const U=F.clientX-X.startX,G=F.clientY-X.startY,K=Math.hypot(U,G);X.maxMovementDistance=Math.max(X.maxMovementDistance,K)}if(X.active&&F.identifier===X.touchId){const U=F.clientX-X.lastX,G=F.clientY-X.lastY;D.preventDefault(),D.stopPropagation(),k(-U,-G,S.current),X.lastX=F.clientX,X.lastY=F.clientY}else F.identifier===X.touchId&&(X.lastX=F.clientX,X.lastY=F.clientY)}else _.current.holdTimer&&(clearTimeout(_.current.holdTimer),_.current.holdTimer=null),_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null},E(!1),x.current={active:!1},y.current={active:!1,startX:0,startY:0,lastX:0,lastY:0}},B=()=>{_.current.holdTimer&&(clearTimeout(_.current.holdTimer),_.current.holdTimer=null),_.current={active:!1,startX:0,startY:0,lastX:0,lastY:0,holdTimer:null,touchId:null},E(!1),x.current={active:!1},y.current={active:!1,startX:0,startY:0,lastX:0,lastY:0}};return R.addEventListener("touchstart",O,{passive:!1}),R.addEventListener("touchmove",W,{passive:!1}),R.addEventListener("touchend",B,{passive:!0}),R.addEventListener("touchcancel",B,{passive:!0}),()=>{R.removeEventListener("touchstart",O),R.removeEventListener("touchmove",W),R.removeEventListener("touchend",B),R.removeEventListener("touchcancel",B)}},[k,C,L,u,f]),{localCanvasContainerDivRef:h,handleZoom:N,handleNativeCanvasScroll:A,isSingleFingerPanningActive:w}}function ub({elements:t,selectedElements:e,mode:n,clipboardRef:r,simulationSettings:i,simulatorCore:s}){try{if(t&&(window.__PETRI_NET_STATE__={places:t.places,transitions:t.transitions,arcs:t.arcs,selectedElements:e||[]}),typeof n<"u"&&(window.__PETRI_NET_MODE__=n),r&&(window.__PETRI_NET_CLIPBOARD__=r),i){const c=!!(i!=null&&i.batchMode),u=!!(i!=null&&i.limitIterations),f=Number(i==null?void 0:i.maxIterations),h=Number.isFinite(f)&&f>0?Math.floor(f):2e5,m=!!(i!=null&&i.useNonVisualRun||c);window.__PETRI_NET_NON_VISUAL_RUN__=m,window.__PETRI_NET_SETTINGS__={...window.__PETRI_NET_SETTINGS__||{},batchMode:c,limitIterations:u,maxIterations:h}}s&&!window.__PETRI_NET_SIM_CORE__&&(window.__PETRI_NET_SIM_CORE__=s)}catch{}}const cb=()=>{const{stageDimensions:e,virtualCanvasDimensions:n,canvasScroll:r,setCanvasScroll:i,zoomLevel:s,setZoomLevel:l,gridSnappingEnabled:c,toggleGridSnapping:u,MIN_ZOOM:f,MAX_ZOOM:h,appRef:m,containerRef:x,setContainerRef:y,stageRef:w}=Po(),{elements:E,setElements:_,selectedElement:S,setSelectedElement:C,selectedElements:g,mode:k,setMode:T,arcStart:N,setArcStart:L,tempArcEnd:A,setTempArcEnd:R,clearSelection:M,setSelection:I,isSettingsDialogOpen:O,setIsSettingsDialogOpen:W,simulationSettings:B,setSimulationSettings:D,historyManagerRef:$,canUndo:X,canRedo:F,handleUndo:U,handleRedo:G,updateHistory:K,snapToGrid:Q,resetEditor:Z,simulatorCore:se,enabledTransitionIds:xe,clipboardRef:ge,setClipboard:V,getClipboard:te,isShiftPressedRef:ae}=qt(),[ve,ye]=z.useState(!1);z.useEffect(()=>{typeof SharedArrayBuffer>"u"?console.warn(" SharedArrayBuffer is not available. This is required for Z3 workers in batch mode. The COOP/COEP service worker should enable this. If this warning persists, the service worker may not be active. Try refreshing the page or checking browser console for service worker errors."):console.log(" SharedArrayBuffer is available - Z3 workers should work correctly")},[]);const{isDragging:ie}=qt(),oe=z.useRef(!1),{localCanvasContainerDivRef:Ee,handleZoom:le,handleNativeCanvasScroll:Se,isSingleFingerPanningActive:Ie}=lb({MIN_ZOOM:f,MAX_ZOOM:h,zoomLevel:s,setZoomLevel:l,virtualCanvasDimensions:n,canvasScroll:r,setCanvasScroll:i,setContainerRef:y,isDragging:ie,isSelectionActiveRef:oe}),{handleDeleteElement:Fe,clearAllElements:tn}=Cg();return z.useEffect(()=>{ub({elements:E,selectedElements:g,mode:k,clipboardRef:ge,simulationSettings:B,simulatorCore:se})},[E.places,E.transitions,E.arcs,g,k,B==null?void 0:B.useNonVisualRun,B==null?void 0:B.batchMode,B==null?void 0:B.limitIterations,B==null?void 0:B.maxIterations,ge,se]),w5({elements:E,setElements:_,selectedElement:S,selectedElements:g,clearSelection:M,setSelection:I,clipboardRef:ge,netMode:(B==null?void 0:B.netMode)||"pt",setClipboard:V,getClipboard:te,onClipboardMismatch:void 0,handleUndo:U,handleRedo:G,setMode:T,arcStart:N,setArcStart:L,setTempArcEnd:R,setSelectedElement:C,isShiftPressedRef:ae}),P.jsxs("div",{ref:m,className:"app-container h-screen max-h-screen overflow-hidden",tabIndex:-1,children:[P.jsx("button",{className:"fixed top-2.5 right-2 z-50 p-2 bg-white rounded-md shadow-md lg:hidden",onClick:()=>ye(!ve),children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})})}),P.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 bg-white",onWheel:Ot=>Ot.stopPropagation(),children:P.jsx(w_,{mode:k,setMode:T,onNew:tn,onUndo:U,canUndo:X,onRedo:G,canRedo:F,gridSnappingEnabled:c,onToggleGridSnapping:u,onOpenSettings:()=>W(!0),elements:E,setElements:_,updateHistory:K,simulationSettings:B,setSimulationSettings:D,resetEditor:Z})}),P.jsxs("div",{className:`fixed w-80 right-0 top-16 bottom-0 z-30 bg-gray-100/90 backdrop-blur-sm shadow-lg pt-4 flex flex-col overflow-hidden transform transition-transform duration-300 ease-in-out ${ve?"translate-x-0":"translate-x-full"} lg:translate-x-0`,onWheel:Ot=>Ot.stopPropagation(),children:[P.jsx("div",{className:"overflow-y-auto pr-2",children:P.jsx(I_,{selectedElement:S,elements:E,setElements:_,updateHistory:K,simulationSettings:B})}),P.jsx("div",{className:"flex-1 overflow-y-auto pr-2 border-t-2 border-gray-200",children:P.jsx(R_,{elements:E,enabledTransitionIds:xe})})]}),P.jsxs("div",{className:"fixed top-20 left-0 bottom-0 right-0 lg:right-80 transition-all duration-300",children:[P.jsx("div",{className:"absolute inset-0 overflow-hidden stage-container bg-gray-200 dark:bg-gray-700","data-testid":"canvas-container",ref:Ee,onScroll:Se,children:P.jsx(ob,{handleZoom:le,ZOOM_STEP:.1,isSingleFingerPanningActive:Ie,isSelectionActiveRef:oe})}),P.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-40",children:P.jsx(F_,{isMobile:!0})}),P.jsxs("div",{className:"hidden lg:flex fixed top-24 right-[336px] z-10 flex-col space-y-2 pointer-events-auto",children:[P.jsx("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none",onClick:()=>le(.1),title:"Zoom In",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),P.jsx("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none",onClick:()=>le(-.1),title:"Zoom Out",children:P.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})}),P.jsxs("button",{className:"bg-white p-2 rounded-full shadow-md hover:bg-gray-100 focus:outline-none text-xs font-mono",onClick:()=>{l(1),i({x:0,y:0})},title:"Reset Zoom",children:[Math.round(s*100),"%"]})]}),P.jsx(ab,{})]}),P.jsx(O_,{isOpen:O,onClose:()=>W(!1)})]})},db=()=>P.jsx(yw,{children:P.jsx(v_,{children:P.jsx(x_,{children:P.jsx(cb,{})})})});Jh.createRoot(document.getElementById("root")).render(P.jsx($t.StrictMode,{children:P.jsx(db,{})}));export{xo as a,Rn as b,ua as c,uo as d,tr as e,Ew as f,Cw as g,hb as h,fb as i,il as j,Tw as p};
//# sourceMappingURL=index-f7e5ebb1.js.map
